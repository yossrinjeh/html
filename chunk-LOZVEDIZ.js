import{a as $}from"./chunk-QEBKWPPX.js";import{t as R}from"./chunk-4ZXNYKJD.js";import{a as L,c as j,k as F,m as N,o as C}from"./chunk-HXFCOTNJ.js";import{Ba as U,Gb as i,Hb as a,Ib as y,Pb as w,Qc as E,Uc as D,Vc as O,Zb as r,_b as c,ab as d,bb as h,ha as f,ia as S,ic as b,kc as g,ra as A,sa as x,vb as v,xb as u}from"./chunk-OCYIH7HC.js";var B=(()=>{let t=class t{constructor(n){this.http=n,this.URL="http://20.49.205.136:3000/payrolls",this.httpOptions={headers:new L({"Content-Type":"application/json"})}}createPayroll(n){return this.http.post(this.URL,n,this.httpOptions)}getAllPayrolls(){return this.http.get(this.URL,this.httpOptions)}getPayrollsByMonth(n){return this.http.get(`${this.URL}/month/${n}`,this.httpOptions)}getPayrollsByUserId(n){return this.http.get(`${this.URL}/user/${n}`,this.httpOptions)}getUserIdByEmail(n){return this.http.get(`${this.URL}/getUserByEmail/${n}`,this.httpOptions)}getAllUsers(){return this.http.get(`${this.URL}/getAllUsers`,this.httpOptions)}};t.\u0275fac=function(e){return new(e||t)(U(j))},t.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();function J(o,t){if(o&1&&(i(0,"tr")(1,"td"),r(2),b(3,"date"),a(),i(4,"td"),r(5),a(),i(6,"td"),r(7),a(),i(8,"td"),r(9),a(),i(10,"td"),r(11),a()()),o&2){let m=t.$implicit;d(2),c(g(3,5,m.month,"MMM d, yyyy")),d(3),c(m.taxableSalary),d(2),c(m.irpp),d(2),c(m.css),d(2),c(m.netSalary)}}var k=(()=>{let t=class t{constructor(n,e,s,l,p){this.route=n,this.router=e,this.formB=s,this.payrollService=l,this.configService=p,this.data=[],this.isDate=!1}ngOnInit(){let n,e=new Date,s=e.getMonth()+1;this.configService.getConfig().subscribe(l=>{this.cssr=l[0].cssrate,this.cnssr=l[0].cnssrate;let p=Number(l[0].payDay),P=new Date().getFullYear();n=new Date(P,s-1,p)}),this.payrollService.getAllPayrolls().subscribe(l=>{this.data=l;let p=new Date(l[l.length-1].month);console.log("last ",p),console.log("paydate",n),console.log("current date",e),console.log("current month",s),p.getMonth()+1!==s&&e>=n?this.isDate=!1:this.isDate=!0})}getDataByDate(n){let e=n.target.value,s;if(e){let l=new Date(e),p=l.getFullYear(),M=l.getMonth()+1;s=`${p}-${M.toString().padStart(2,"0")}`,this.payrollService.getPayrollsByMonth(s).subscribe(P=>{this.data=P})}else this.payrollService.getAllPayrolls().subscribe(l=>{this.data=l})}pay(){this.payrollService.getAllUsers().subscribe(n=>{for(let e of n){this.totalAllowances=0,this.totalDeductions=0;for(let l of e.allowances)this.totalAllowances+=l.amount;for(let l of e.deductions)this.totalDeductions+=l.amount;this.taxableS=(e.basicSalary+this.totalAllowances-this.totalDeductions)*(1-this.cnssr),this.taxableBase=this.taxableS*12-2e3,e.familySituation==1&&(this.taxableBase-=300,this.taxableBase-=e.childrenNumber*100),this.taxAmount=0,this.taxableBase<=5e3?this.taxAmount=0:this.taxableBase<=2e4?this.taxAmount=(this.taxableBase-5e3)*.26:this.taxableBase<=3e4?this.taxAmount=3900+(this.taxableBase-2e4)*.28:this.taxableBase<=5e4?this.taxAmount=5600+(this.taxableBase-3e4)*.32:this.taxAmount=11920+(this.taxableBase-5e4)*.35,this.css=this.taxableBase*this.cssr/12;let s={id:"",userId:e.id,month:new Date().toISOString(),taxableSalary:this.taxableS,cnssdeduction:(e.basicSalary+this.totalAllowances-this.totalDeductions)*this.cnssr,irpp:this.taxAmount/12,css:this.css,netSalary:this.taxableS-this.taxAmount/12-this.css};this.payrollService.createPayroll(s).subscribe(()=>{console.log("Payroll created successfully for user: ",e.id)},l=>{console.error("Error creating payroll for user: ",e.id,l)})}})}};t.\u0275fac=function(e){return new(e||t)(h(F),h(N),h(R),h(B),h($))},t.\u0275cmp=f({type:t,selectors:[["app-list-payroll"]],decls:39,vars:2,consts:[[1,"pcoded-main-container"],[1,"pcoded-wrapper"],[1,"pcoded-content"],[1,"pcoded-inner-content"],[1,"main-body"],[1,"page-wrapper"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-header"],[1,"btn","btn-primary","btn-sm","float-right",3,"hidden","click"],["type","month",3,"change"],[1,"card-body"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"h5"),r(11,"Payroll"),a(),i(12,"button",10),w("click",function(){return s.pay()}),r(13,"Add"),a()(),i(14,"input",11),w("change",function(p){return s.getDataByDate(p)}),a(),i(15,"div",12),y(16,"h5")(17,"hr"),i(18,"table",13)(19,"thead")(20,"tr")(21,"th",14),r(22,"Month"),a(),i(23,"th",14),r(24,"Basic Salary"),a(),i(25,"th",14),r(26,"CNSS Deduction"),a(),i(27,"th",14),r(28,"Taxable Salary"),a(),i(29,"th",14),r(30,"IRPP"),a(),i(31,"th",14),r(32,"CSS"),a(),i(33,"th",14),r(34,"Net Salary"),a()()(),i(35,"tbody"),v(36,J,12,8,"tr",15),a()(),y(37,"hr")(38,"div",16),a()()()()()()()()()()),e&2&&(d(12),u("hidden",s.isDate),d(24),u("ngForOf",s.data))},dependencies:[E,D]});let o=t;return o})();function q(o,t){if(o&1&&(i(0,"tr")(1,"td"),r(2),b(3,"date"),a(),i(4,"td"),r(5),a(),i(6,"td"),r(7),a(),i(8,"td"),r(9),a(),i(10,"td"),r(11),a()()),o&2){let m=t.$implicit;d(2),c(g(3,5,m.month,"MMM d, yyyy")),d(3),c(m.taxableSalary),d(2),c(m.irpp),d(2),c(m.css),d(2),c(m.netSalary)}}var H=(()=>{let t=class t{constructor(n){this.payrollService=n}ngOnInit(){let n=localStorage.getItem("user");if(n){let e=JSON.parse(n).email;this.payrollService.getUserIdByEmail(e).subscribe(s=>{this.id=s.id,this.getDataByUser(this.id)})}}getDataByUser(n){this.payrollService.getPayrollsByUserId(n).subscribe(e=>{this.data=e})}};t.\u0275fac=function(e){return new(e||t)(h(B))},t.\u0275cmp=f({type:t,selectors:[["app-list-user-payroll"]],decls:36,vars:1,consts:[[1,"pcoded-main-container"],[1,"pcoded-wrapper"],[1,"pcoded-content"],[1,"pcoded-inner-content"],[1,"main-body"],[1,"page-wrapper"],[1,"row"],[1,"col-sm-12"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"table"],["scope","col"],[4,"ngFor","ngForOf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9)(10,"h5"),r(11,"Payroll"),a()(),i(12,"div",10),y(13,"h5")(14,"hr"),i(15,"table",11)(16,"thead")(17,"tr")(18,"th",12),r(19,"Month"),a(),i(20,"th",12),r(21,"Basic Salary"),a(),i(22,"th",12),r(23,"CNSS Deduction"),a(),i(24,"th",12),r(25,"Taxable Salary"),a(),i(26,"th",12),r(27,"IRPP"),a(),i(28,"th",12),r(29,"CSS"),a(),i(30,"th",12),r(31,"Net Salary"),a()()(),i(32,"tbody"),v(33,q,12,8,"tr",13),a()(),y(34,"hr")(35,"div",14),a()()()()()()()()()()),e&2&&(d(33),u("ngForOf",s.data))},dependencies:[E,D]});let o=t;return o})();var z=[{path:"",component:k},{path:"payslip",component:H}],Y=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=S({type:t}),t.\u0275inj=x({imports:[C.forChild(z),C]});let o=t;return o})();var ct=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=S({type:t}),t.\u0275inj=x({imports:[O,Y]});let o=t;return o})();export{B as a,ct as b};
