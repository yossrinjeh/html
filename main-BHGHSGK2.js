import{a as Yp,b as rm,c as im}from"./chunk-647Z6SS5.js";import{a as Kp,b as om,c as am,d as xl,e as Xs,f as sm,g as um,h as cm,i as bl,j as lm,k as hm,l as dm,m as fm,n as pm}from"./chunk-32C7MPRI.js";import{a as Gs,b as mm}from"./chunk-KV3D3T44.js";import{a as gm}from"./chunk-XB55WGRU.js";import{a as vm}from"./chunk-HRDKNTXW.js";import{f as xm,g as va,h as Ks,m as bm,n as Ys,p as ym,u as wm}from"./chunk-EB5QUVGL.js";import{a as Jp}from"./chunk-EDNATCPW.js";import"./chunk-YZQJ655K.js";import{a as Vr}from"./chunk-KXPX42HO.js";import{a as Qp}from"./chunk-4LCKFN4D.js";import"./chunk-QSFQZ2FF.js";import{c as lo}from"./chunk-TG267DBW.js";import{c as fo}from"./chunk-OGGY5HJQ.js";import{a as vl}from"./chunk-S4MG4CWE.js";import"./chunk-TWCV4VS3.js";import{a as Zp}from"./chunk-7JSXRWEJ.js";import{a as tm}from"./chunk-L5YRS4TL.js";import{a as qs,b as nm}from"./chunk-MFHJ2CRP.js";import{c as em}from"./chunk-EZ74PG5X.js";import{a as co,n as ho}from"./chunk-DBWB3LBE.js";import{c as so,w as uo}from"./chunk-DBA5FPW7.js";import{M as $p}from"./chunk-AWI2NUMG.js";import"./chunk-AESYL7IM.js";import"./chunk-HAJ3YRHB.js";import{a as xw,b as zr}from"./chunk-3DQUKV54.js";import"./chunk-KTNC6XIE.js";import{b as Hp,c as gn,e as fi,g as Je,h as Un,i as ro,j as Gp,k as pi,l as io,m as jn,n as qp,o as Ur,p as jr,t as Hr,v as Xp,w as oo,x as ao}from"./chunk-I7XF2BCB.js";import{a as Bp,b as ml,c as zn,d as Wp,e as zp,f as Us,g as Vp,h as js,j as Up,k as jp,l as Hs,m as $e,n as Vn,o as gl}from"./chunk-UHIV2YIU.js";import{$b as Nr,Ba as se,Bc as Tp,Ca as mn,Cb as to,Cc as Pp,Ea as ma,Ec as Fp,F as cp,H as lp,Ha as wp,Ia as ga,J as hl,K as Ji,Kb as $t,La as Dt,M as Ps,Ma as Zi,Mb as ct,N as hp,Nb as eo,O as dp,Q as fp,Ra as Ns,Vb as T,Wb as P,Xa as _p,Xb as Y,Yb as kp,Zb as Ip,_a as Cp,a as sr,ad as Ws,b as ur,ba as pp,c as ul,ca as mp,cc as kt,e as tp,ea as gp,ec as Tt,g as je,ga as dl,ha as Fs,hd as Op,ia as vp,id as no,j as cl,ja as xp,jb as fl,jc as cr,jd as Ne,ka as bp,kc as lr,la as yp,lc as hr,m as ep,mb as Q,mc as Mp,md as Np,n as np,nb as vt,nc as G,nd as zs,o as rp,ob as Sp,oc as Ye,p as ip,pc as de,pd as Vs,qb as Ls,qc as Rp,r as op,ra as Wt,rc as Lr,rd as Lp,s as ap,sa as pn,sb as Bs,sc as Br,tc as Wr,u as ll,ua as Bn,v as sp,va as Wn,vb as pl,wa as Qi,wc as Ap,xa as Os,xc as Dp,y as up,z as fn,zb as Ep}from"./chunk-WHIBKZZI.js";var Om=tp((go,Fm)=>{"use strict";Fm.exports=go=window.fetch;go.default=window.fetch.bind(window);go.Headers=window.Headers;go.Request=window.Request;go.Response=window.Response});var Nm=tp(()=>{"use strict"});var po=(()=>{let e=class e{constructor(n){this._http=n,this.URL="http://20.49.205.136:3000/auth/local/signin",this.LOGOUT_URL="http://20.49.205.136:3000/auth/logout",this.CODE_URL="http://20.49.205.136:3000/auth/sendsmscode/",this.CODE_URL_MAIL="http://20.49.205.136:3000/auth/sendmailcode/",this.VERIFY_URL="http://20.49.205.136:3000/auth/verifyCode/"}verifyCode(n,i){return this._http.post(this.VERIFY_URL+`${i}/${n}`,null)}sendVerificationCodeMail(n){return this._http.post(this.CODE_URL_MAIL+n,null)}sendVerificationCode(n){return this._http.post(this.CODE_URL+n,null)}login(n){return this._http.post(this.URL,n)}_is_logged(){return!!localStorage.getItem("token")}logout(){return this._http.post(this.LOGOUT_URL,{})}};e.\u0275fac=function(i){return new(i||e)(Dt(zn))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function bw(r,e){if(r&1&&(T(0,"div",18),G(1),P()),r&2){let t=Tt();Q(),Ye(t.errorMessage)}}var yw=()=>["/resetpassword"],_m=(()=>{let e=class e{constructor(n,i,o,a){this.encryptionService=n,this.authService=i,this.router=o,this.userService=a,this.authRequest={},this.authResponse={}}authenticate(){this.authService.login(this.authRequest).subscribe({next:n=>{if(this.authResponse=n,n.access_token=="sms"){let i={email:this.authRequest.email,method:n.access_token};localStorage.setItem("code",JSON.stringify(i)),this.router.navigate(["/sendcode"])}else if(n.access_token=="mail"){let i={email:this.authRequest.email,method:n.access_token};localStorage.setItem("code",JSON.stringify(i)),this.router.navigate(["/sendcode"])}else localStorage.setItem("token",n.access_token),this.userService.getUser(this.authRequest.email).subscribe({next:i=>{let o={firstname:i.firstname,lastname:i.lastname,email:i.email},a=this.encryptionService.encrypt(JSON.stringify(i.authorities),"2f7");localStorage.setItem("authorities",a),localStorage.setItem("user",JSON.stringify(o)),this.router.navigate(["/home/dashboard"])},error:i=>{}})},error:n=>{this.errorMessage="Invalid email or password"}})}};e.\u0275fac=function(i){return new(i||e)(vt(zr),vt(po),vt($e),vt(Vr))},e.\u0275cmp=Wt({type:e,selectors:[["app-login"]],decls:25,vars:5,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-unlock","auth-icon"],[3,"ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","required","","name","email",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","mb-4"],["type","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","shadow-2","mb-4"],["class","alert alert-danger",4,"ngIf"],[1,"mb-2","text-muted"],[3,"routerLink"],[1,"alert","alert-danger"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),Y(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),P(),T(7,"div",5)(8,"div",6)(9,"div",7),Y(10,"i",8),P(),T(11,"form",9),kt("ngSubmit",function(){return o.authenticate()}),T(12,"h3",7),G(13,"Login"),P(),T(14,"div",10)(15,"input",11),Wr("ngModelChange",function(s){return Br(o.authRequest.email,s)||(o.authRequest.email=s),s}),P()(),T(16,"div",12)(17,"input",13),Wr("ngModelChange",function(s){return Br(o.authRequest.password,s)||(o.authRequest.password=s),s}),P()(),T(18,"button",14),G(19,"Login"),P(),$t(20,bw,2,1,"div",15),P(),T(21,"p",16),G(22,"Forgot password? "),T(23,"a",17),G(24,"Reset"),P()()()()()()),i&2&&(Q(15),Lr("ngModel",o.authRequest.email),Q(2),Lr("ngModel",o.authRequest.password),Q(3),ct("ngIf",o.errorMessage),Q(3),ct("routerLink",Ap(4,yw)))},dependencies:[Ne,Vn,jn,gn,Je,Un,Hr,io,Gp]});let r=e;return r})();var Js=(()=>{let e=class e{constructor(n){this.http=n,this.baseUrl="http://20.49.205.136:3000/passwordreset"}request(n){let i=new ml().set("email",n);return this.http.post(`${this.baseUrl}/request`,null,{params:i})}reset(n,i){let o=new ml().set("token",n).set("password",i);return this.http.post(`${this.baseUrl}/reset`,null,{params:o})}};e.\u0275fac=function(i){return new(i||e)(Dt(zn))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Sm=(()=>{let e=class e{constructor(n,i){this.router=n,this.resetpasswordService=i,this.status="",this.formRequest=new ro({email:new pi("",[fi.required])})}sendmail(){this.formRequest.valid&&this.resetpasswordService.request(this.formRequest.value.email).subscribe({next:n=>{this.router.navigate(["/emailsended"])}}),this.router.navigate(["/emailsended"])}};e.\u0275fac=function(i){return new(i||e)(vt($e),vt(Js))},e.\u0275cmp=Wt({type:e,selectors:[["app-resetpassword"]],decls:18,vars:1,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","formControlName","email","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),Y(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),P(),T(7,"div",5)(8,"div",6)(9,"div",7),Y(10,"i",8),P(),T(11,"form",9),kt("ngSubmit",function(){return o.sendmail()}),T(12,"h3",7),G(13,"Reset Password"),P(),T(14,"div",10),Y(15,"input",11),P(),T(16,"button",12),G(17,"Reset Password"),P()()()()()()),i&2&&(Q(11),ct("formGroup",o.formRequest))},dependencies:[jn,gn,Je,Un,Hr,Ur,jr]});let r=e;return r})();function ww(r,e){if(r&1&&(T(0,"div",15),G(1),P()),r&2){let t=Tt();Q(),de(" ",t.status," ")}}var Em=(()=>{let e=class e{constructor(n,i,o){this.router=n,this.route=i,this.resetpasswordService=o,this.formRequest=new ro({password:new pi("",[fi.required]),confirmPassword:new pi("",[fi.required])})}ngOnInit(){this.token=this.route.snapshot.queryParamMap.get("token")}resetpassword(){this.formRequest.valid&&this.token&&this.formRequest.value.password===this.formRequest.value.confirmPassword?this.resetpasswordService.reset(this.token,this.formRequest.value.password).subscribe({next:n=>{this.router.navigate(["/login"])}}):this.status="Verify passwords!"}};e.\u0275fac=function(i){return new(i||e)(vt($e),vt(jp),vt(Js))},e.\u0275cmp=Wt({type:e,selectors:[["app-newpassword"]],decls:21,vars:3,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","password","placeholder","New password","formControlName","password","name","password","required","",1,"form-control"],["type","password","placeholder","Confirm password","formControlName","confirmPassword","required","",1,"form-control"],["class","alert alert-danger","role","alert",4,"ngIf","ngIfIs"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"],["role","alert",1,"alert","alert-danger"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),Y(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),P(),T(7,"div",5)(8,"div",6)(9,"div",7),Y(10,"i",8),P(),T(11,"form",9),kt("ngSubmit",function(){return o.resetpassword()}),T(12,"h3",7),G(13,"Reset Password"),P(),T(14,"div",10),Y(15,"input",11),P(),T(16,"div",10),Y(17,"input",12),P(),$t(18,ww,2,1,"div",13),T(19,"button",14),G(20,"Reset Password"),P()()()()()()),i&2&&(Q(11),ct("formGroup",o.formRequest),Q(7),ct("ngIf",o.status)("ngIfIs",o.undefind))},dependencies:[Ne,jn,gn,Je,Un,Hr,Ur,jr]});let r=e;return r})();var km=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Wt({type:e,selectors:[["app-emailsended"]],decls:18,vars:0,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[1,"input-group","mb-3"],["routerLink","/login",1,"btn","btn-primary","shadow-2","mb-4",2,"color","white"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),Y(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),P(),T(7,"div",5)(8,"div",6)(9,"div",7),Y(10,"i",8),P(),T(11,"h3",7),G(12,"Email is sent"),P(),Y(13,"div",9),T(14,"p",7),G(15,"Please check your email!"),P(),T(16,"a",10),G(17,"Login"),P()()()()())},dependencies:[Vn]});let r=e;return r})();var Cl=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Wt({type:e,selectors:[["app-not-found"]],decls:18,vars:0,consts:[[1,"maintenance-block"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-8"],[1,"card","error-card"],[1,"card-body"],[1,"error-image-block"],["src","../assets/images/404.png","alt","img",1,"img-fluid"],[1,"text-center"],[1,"mt-3"],[1,"mt-2","mb-4","text-muted"],["type","button","href","/home",1,"btn","btn-primary","mb-3"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),Y(7,"img",7),P(),T(8,"div",8)(9,"h1",9)(10,"b"),G(11,"Oops! Page not found!"),P()(),T(12,"p",10),G(13," The page you are looking was moved, removed,"),Y(14,"br"),G(15," renamed, or might never exist! "),P(),T(16,"a",11),G(17,"Go to home"),P()()()()()()()())}});let r=e;return r})();var Im=(()=>{let e=class e{constructor(n,i){this.encryptionService=n,this.router=i}canActivate(n,i){return localStorage.getItem("token")?!0:(localStorage.clear(),this.router.navigate(["/login"]),!1)}};e.\u0275fac=function(i){return new(i||e)(Dt(zr),Dt($e))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function _w(r,e){r&1&&(T(0,"li",11)(1,"a",22)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Projects"),P()()())}function Cw(r,e){r&1&&(T(0,"li",11)(1,"a",23)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Tasks"),P()()())}function Sw(r,e){r&1&&(T(0,"li",11)(1,"a",24)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Payroll"),P()()())}function Ew(r,e){r&1&&(T(0,"li",11)(1,"a",25)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Mission"),P()()())}function kw(r,e){r&1&&(T(0,"li",11)(1,"a",26)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Payslip"),P()()())}function Iw(r,e){r&1&&(T(0,"li",11)(1,"a",27)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Configuration"),P()()())}function Mw(r,e){r&1&&(T(0,"li",11)(1,"a",28)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Allowances"),P()()())}function Rw(r,e){r&1&&(T(0,"li",11)(1,"a",29)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Deductions"),P()()())}function Aw(r,e){r&1&&(T(0,"li",11)(1,"a",30)(2,"span",13),Y(3,"i",14),P(),T(4,"span",15),G(5,"Holiday"),P()()())}function Dw(r,e){if(r&1){let t=Nr();T(0,"li",31),kt("click",function(){Bn(t);let i=Tt();return Wn(i.toggleDropdownEmployee())}),P()}}function Tw(r,e){r&1&&(T(0,"li",35)(1,"a",36)(2,"span"),G(3," \xA0 \xA0Employees"),P()()())}function Pw(r,e){r&1&&(T(0,"li",35)(1,"a",37)(2,"span"),G(3," \xA0 \xA0Add Employees"),P()()())}function Fw(r,e){if(r&1){let t=Nr();T(0,"li",31),kt("click",function(){Bn(t);let i=Tt();return Wn(i.toggleDropdownEmployee())}),T(1,"a",32)(2,"span",13),Y(3,"i",14),P(),G(4," Employee Management "),P(),T(5,"ul",33),$t(6,Tw,4,0,"li",34)(7,Pw,4,0,"li",34),P()()}if(r&2){let t=Tt();Q(5),eo("display",t.EmployeeManagment?"block":"none"),Q(),ct("ngIf",t.displayEmployeeList),Q(),ct("ngIf",t.displayEmployeeAdd)}}function Ow(r,e){r&1&&(T(0,"li",35)(1,"a",38)(2,"span"),G(3," \xA0 \xA0Roles"),P()()())}function Nw(r,e){r&1&&(T(0,"li",35)(1,"a",39)(2,"span"),G(3," \xA0 \xA0Add Roles"),P()()())}function Lw(r,e){if(r&1){let t=Nr();T(0,"li",31),kt("click",function(){Bn(t);let i=Tt();return Wn(i.toggleDropdownRole())}),T(1,"a",32)(2,"span",13),Y(3,"i",14),P(),G(4," Role Management "),P(),T(5,"ul",33),$t(6,Ow,4,0,"li",34)(7,Nw,4,0,"li",34),P()()}if(r&2){let t=Tt();Q(5),eo("display",t.roleManagment?"block":"none"),Q(),ct("ngIf",t.displayRoleList),Q(),ct("ngIf",t.displayRoleAdd)}}function Bw(r,e){if(r&1){let t=Nr();T(0,"li",31),kt("click",function(){Bn(t);let i=Tt();return Wn(i.toggleDropdownAttendance())}),P()}}function Ww(r,e){r&1&&(T(0,"li",35)(1,"a",40)(2,"span"),G(3," \xA0 \xA0Attendance Sheet"),P()()())}function zw(r,e){r&1&&(T(0,"li",35)(1,"a",41)(2,"span"),G(3," \xA0 \xA0Create Attendance"),P()()())}function Vw(r,e){if(r&1){let t=Nr();T(0,"li",31),kt("click",function(){Bn(t);let i=Tt();return Wn(i.toggleDropdownAttendance())}),T(1,"a",32)(2,"span",13),Y(3,"i",14),P(),G(4," Attendances Management "),P(),T(5,"ul",33),$t(6,Ww,4,0,"li",34)(7,zw,4,0,"li",34),P()()}if(r&2){let t=Tt();Q(5),eo("display",t.AttendanceManagment?"block":"none"),Q(),ct("ngIf",t.displayAttendanceUpdate),Q(),ct("ngIf",t.displayAttendanceCreate)}}var Mm=(()=>{let e=class e{toggleDropdownRole(){this.roleManagment=!this.roleManagment}toggleDropdownEmployee(){this.EmployeeManagment=!this.EmployeeManagment}toggleDropdownAttendance(){this.AttendanceManagment=!this.AttendanceManagment}constructor(n){this.encryptionService=n,this.visibiliyRoleManagment=!1,this.roleManagment=!1,this.displayRoleList=!1,this.displayRoleAdd=!1,this.visibiliyEmployeeManagment=!1,this.EmployeeManagment=!1,this.displayEmployeeList=!1,this.displayEmployeeAdd=!1,this.visibiliyAttendanceManagment=!1,this.AttendanceManagment=!1,this.displayAttendanceList=!1,this.displayAttendanceAdd=!1,this.displayAttendanceUpdate=!1,this.displayAttendanceCreate=!1,this.visibiliyProjectManagment=!1,this.ProjectManagment=!1,this.displayProjectList=!1,this.visibiliyHolidayManagment=!1,this.visibiliyTaskManagment=!1,this.visibiliyConfigManagment=!1,this.visibiliyPayrollManagment=!1,this.visibiliyMissionManagment=!1}ngOnInit(){let n=localStorage.getItem("authorities"),i=this.encryptionService.decrypt(n,"2f7");i.includes("PAYROLL")&&(this.visibiliyPayrollManagment=!0),i.includes("MISSION")&&(this.visibiliyMissionManagment=!0),i.includes("CONFIG")&&(this.visibiliyConfigManagment=!0),i.includes("PROJECT")&&(this.visibiliyProjectManagment=!0),i.includes("TASK")&&(this.visibiliyTaskManagment=!0),i.includes("HOLIDAY")&&(this.visibiliyHolidayManagment=!0),i.includes("ATTENDANCE")&&(this.visibiliyAttendanceManagment=!0),i.includes("READ::ATTENDANCE")&&(this.displayAttendanceList=!0),i.includes("ADD::ATTENDANCE")&&(this.displayAttendanceAdd=!0),i.includes("EDIT::ATTENDANCE")&&(this.displayAttendanceUpdate=!0),i.includes("CREATE::ATTENDANCE")&&(this.displayAttendanceCreate=!0),i.includes("ROLE")&&(this.visibiliyRoleManagment=!0),i.includes("READ::ROLE")&&(this.displayRoleList=!0),i.includes("ADD::ROLE")&&(this.displayRoleAdd=!0),i.includes("USER")&&(this.visibiliyEmployeeManagment=!0),i.includes("READ::USER")&&(this.displayEmployeeList=!0),i.includes("ADD::USER")&&(this.displayEmployeeAdd=!0)}getPrivileges(){}};e.\u0275fac=function(i){return new(i||e)(vt(zr))},e.\u0275cmp=Wt({type:e,selectors:[["app-sidebar"]],decls:45,vars:14,consts:[[1,"pcoded-navbar"],[1,"navbar-wrapper"],[1,"navbar-brand","header-logo"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-collapse","href","javascript:",1,"mobile-menu"],[1,"slimScrollDiv",2,"position","relative","overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"navbar-content","scroll-div",2,"overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"nav","pcoded-inner-navbar"],["data-username","Table bootstrap datatable footable",1,"nav-item"],["routerLink","dashboard",1,"nav-link"],[1,"pcoded-micon"],[1,"feather","icon-server"],[1,"pcoded-mtext"],[1,"nav-item","pcoded-menu-caption"],["data-username","Table bootstrap datatable footable","class","nav-item",4,"ngIf"],["routerLink","department",1,"nav-link"],["class","nav-item pcoded-hasmenu",3,"click",4,"ngIf"],[1,"slimScrollBar",2,"background","rgba(0, 0, 0, 0.5)","width","5px","position","absolute","top","34px","opacity","0.4","display","none","border-radius","7px","z-index","99","right","1px","height","634.318px"],[1,"slimScrollRail",2,"width","5px","height","100%","position","absolute","top","0px","display","none","border-radius","7px","background","rgb(51, 51, 51)","opacity","0.2","z-index","90","right","1px"],["routerLink","projects",1,"nav-link"],["routerLink","tasks",1,"nav-link"],["routerLink","payroll",1,"nav-link"],["routerLink","missions",1,"nav-link"],["routerLink","payroll/payslip",1,"nav-link"],["routerLink","config",1,"nav-link"],["routerLink","allowance",1,"nav-link"],["routerLink","deduction",1,"nav-link"],["routerLink","holiday",1,"nav-link"],[1,"nav-item","pcoded-hasmenu",3,"click"],[1,"nav-item","dropdown-toggle"],[1,"nav-dropdown",2,"width","250px"],["class","nav-item",4,"ngIf"],[1,"nav-item"],["routerLink","users/",1,"nav-link"],["routerLink","users/add",1,"nav-link"],["routerLink","roles/",1,"nav-link"],["routerLink","roles/add",1,"nav-link"],["routerLink","attendance/updateAttendance",1,"nav-link"],["routerLink","attendance/createAttendance",1,"nav-link"]],template:function(i,o){i&1&&(T(0,"nav",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"div",4),Y(5,"i",5),P(),T(6,"span",6),G(7,"Talent Nest"),P()(),T(8,"a",7),Y(9,"span"),P()(),T(10,"div",8)(11,"div",9)(12,"ul",10)(13,"li",11)(14,"a",12)(15,"span",13),Y(16,"i",14),P(),T(17,"span",15),G(18,"Dashboard"),P()()(),T(19,"li",16)(20,"label"),G(21,"Navigation"),P()(),$t(22,_w,6,0,"li",17)(23,Cw,6,0,"li",17)(24,Sw,6,0,"li",17)(25,Ew,6,0,"li",17)(26,kw,6,0,"li",17)(27,Iw,6,0,"li",17)(28,Mw,6,0,"li",17)(29,Rw,6,0,"li",17)(30,Aw,6,0,"li",17),T(31,"li",11)(32,"a",18)(33,"span",13),Y(34,"i",14),P(),T(35,"span",15),G(36,"Department"),P()()(),$t(37,Dw,1,0,"li",19)(38,Fw,8,4,"li",19)(39,Lw,8,4,"li",19)(40,Bw,1,0,"li",19)(41,Vw,8,4,"li",19),P()(),Y(42,"div",20)(43,"div",21),P()()(),Y(44,"router-outlet")),i&2&&(Q(22),ct("ngIf",o.visibiliyProjectManagment),Q(),ct("ngIf",o.visibiliyTaskManagment),Q(),ct("ngIf",o.visibiliyPayrollManagment),Q(),ct("ngIf",o.visibiliyMissionManagment),Q(),ct("ngIf",o.visibiliyPayrollManagment),Q(),ct("ngIf",o.visibiliyConfigManagment),Q(),ct("ngIf",o.visibiliyConfigManagment),Q(),ct("ngIf",o.visibiliyConfigManagment),Q(),ct("ngIf",o.visibiliyHolidayManagment),Q(7),ct("ngIf",o.visibiliyEmployeeManagment),Q(),ct("ngIf",o.visibiliyEmployeeManagment),Q(),ct("ngIf",o.visibiliyRoleManagment),Q(),ct("ngIf",o.visibiliyAttendanceManagment),Q(),ct("ngIf",o.visibiliyAttendanceManagment))},dependencies:[Ne,Hs,Vn]});let r=e;return r})();var Rm=(()=>{let e=class e{constructor(n){this.http=n,this.URL="http://20.49.205.136:3000/notifications",this.httpOptions={headers:new Bp({"Content-Type":"application/json"})}}createNotification(n){return this.http.post(this.URL,n,this.httpOptions)}readNotification(n){return this.http.patch(`${this.URL}/${n}/read`,null,this.httpOptions)}unreadNotification(n){return this.http.patch(`${this.URL}/${n}/unread`,null,this.httpOptions)}cancelNotification(n){return this.http.patch(`${this.URL}/${n}/cancel`,null,this.httpOptions)}getNotificationsByRecipientId(n){return this.http.get(`${this.URL}/from/recipient/${n}`,this.httpOptions)}getReadNotifications(){return this.http.get(`${this.URL}/read`,this.httpOptions)}readAllNotifications(){return this.http.patch(`${this.URL}/read-all`,null,this.httpOptions)}cancelAllNotifications(){return this.http.patch(`${this.URL}/cancel-all`,null,this.httpOptions)}};e.\u0275fac=function(i){return new(i||e)(Dt(zn))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function Gw(r,e){if(r&1){let t=Nr();T(0,"li",56)(1,"div",57)(2,"img",58),kt("click",function(){Bn(t);let i=Tt(),o=i.$implicit,a=i.index,s=Tt();return Wn(s.changeStatus(o.id,a))}),P(),T(3,"div",59),kt("click",function(){Bn(t);let i=Tt(),o=i.$implicit,a=i.index,s=Tt();return Wn(s.changeStatus(o.id,a))}),T(4,"p")(5,"strong"),G(6),P(),T(7,"span",60),Y(8,"i",61),G(9),P()(),T(10,"p"),G(11),P()(),T(12,"div",62)(13,"a",63),kt("click",function(){Bn(t);let i=Tt().$implicit,o=Tt();return Wn(o.deleteNotification(i.id))}),Y(14,"i",64),P()()()()}if(r&2){let t=Tt(),n=t.index,i=t.$implicit,o=Tt();eo("background-color",o.readStatus[n]?"white":"greenyellow"),Q(6),Ye(i.category),Q(3),Ye(o.getTimeDifference(i.createdAt)),Q(2),Ye(i.content)}}function qw(r,e){if(r&1&&(T(0,"div"),$t(1,Gw,15,5,"li",55),P()),r&2){let t=e.$implicit;Q(),ct("ngIf",!t.canceledAt)}}var Xw=r=>({show:r}),Am=(()=>{let e=class e{getSettings(){this.userService.getSettings(this.email).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}toggleSMS(){this.smsEnabled&&(this.emailEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})),this.smsEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}toggleEmail(){this.emailEnabled&&(this.smsEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})),this.emailEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}constructor(n,i,o,a,s,u){this.router=n,this.notificationsService=i,this.payrollService=o,this.datePipe=a,this.authService=s,this.userService=u,this.user="",this.data=[],this.readStatus=[],this.isDropdownOpen=!1}ngOnInit(){return je(this,null,function*(){let n=yield localStorage.getItem("user");if(n){let i=JSON.parse(n);this.user=i.firstname+" "+i.lastname,this.payrollService.getUserIdByEmail(i.email).subscribe(o=>{this.id=o.id}),this.email=i.email}this.getSettings(),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(i=>{this.data=i.reverse(),this.readStatus=i.map(o=>o.readAt!=null)}),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(i=>{})})}stopPropagation(n){n.stopPropagation()}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.ngOnInit()}logout(){this.authService.logout().subscribe(()=>{localStorage.clear(),this.router.navigate(["login"])},n=>{}),localStorage.clear(),this.router.navigate(["login"])}changeStatus(n,i){this.readStatus[i]?this.notificationsService.unreadNotification(n).subscribe(o=>{}):this.notificationsService.readNotification(n).subscribe(o=>{}),this.readStatus[i]=!this.readStatus[i]}deleteNotification(n){this.notificationsService.cancelNotification(n).subscribe(i=>{i&&this.ngOnInit()})}clearAll(){this.notificationsService.cancelAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}getTimeDifference(n){let i=new Date;if(n){let o=new Date(n),a=i.getTime()-o.getTime(),s=Math.floor(a/(1e3*60)),u=this.datePipe.transform(new Date(0,0,0,0,s),s<=59?"mm":"HH"),c=u.startsWith("0")?u.substring(1):u;return s<=59?c+" minutes ago":c+" hours ago"}else return null}markAllAsRead(){this.notificationsService.readAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}deleteAll(){this.notificationsService.cancelAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}approveNotification(){}disapproveNotification(){}};e.\u0275fac=function(i){return new(i||e)(vt($e),vt(Rm),vt(Gs),vt(zs),vt(po),vt(Vr))},e.\u0275cmp=Wt({type:e,selectors:[["app-navbar"]],decls:87,vars:7,consts:[[1,"navbar","pcoded-header","navbar-expand-lg","navbar-light"],[1,"m-header"],["id","mobile-collapse1","href","javascript:",1,"mobile-menu"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-header","href","javascript:",1,"mobile-menu"],[1,"feather","icon-more-horizontal"],[1,"collapse","navbar-collapse"],[1,"navbar-nav","mr-auto"],["href","javascript:","onclick","javascript:toggleFullScreen()",1,"full-screen"],[1,"feather","icon-maximize"],[1,"nav-item","dropdown"],["href","javascript:","data-toggle","dropdown",1,"dropdown-toggle"],[1,"dropdown-menu"],["href","javascript:",1,"dropdown-item"],[1,"nav-item"],[1,"main-search"],[1,"input-group"],["type","text","id","m-search","placeholder","Search . . .",1,"form-control"],["href","javascript:",1,"input-group-append","search-close"],[1,"feather","icon-x","input-group-text"],[1,"input-group-append","search-btn","btn","btn-primary"],[1,"feather","icon-search","input-group-text"],[1,"navbar-nav","ml-auto"],[1,"dropdown"],["href","javascript:void(0);",1,"dropdown-toggle",3,"click"],[1,"icon","feather","icon-bell"],[1,"dropdown-menu","dropdown-menu-right","notification",3,"ngClass"],[1,"noti-head"],[1,"d-inline-block","m-b-0"],[1,"float-right"],["href","javascript:void(0);",1,"m-r-10",3,"click"],["href","javascript:void(0);",3,"click"],[1,"noti-body"],[4,"ngFor","ngForOf"],[1,"dropdown","drp-user"],[1,"icon","feather","icon-settings"],[1,"dropdown-menu","dropdown-menu-right","profile-notification"],[1,"pro-head"],["src","assets/images/user/avatar-1.jpg","alt","User-Profile-Image",1,"img-radius"],["title","Logout",1,"dud-logout",3,"click"],[1,"feather","icon-log-out"],[1,"pro-body"],["routerLink","profile",1,"dropdown-item"],[1,"feather","icon-user"],["href","",1,"dropdown-item"],[1,"feather","icon-mail"],[1,"dropdown-item"],[1,"feather","icon-settings"],["type","checkbox","id","smsToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],["type","checkbox","id","emailToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],[1,"dropdown-item",3,"click"],[1,"feather","icon-lock"],["class","notification",3,"background-color",4,"ngIf"],[1,"notification"],[1,"media"],["src","assets/images/user/avatar-1.jpg","alt","Generic placeholder image",1,"img-radius",3,"click"],[1,"media-body",3,"click"],[1,"n-time","text-muted"],[1,"icon","feather","icon-clock","m-r-10"],[1,"trash-icon"],["href","javascript:void(0);",1,"delete-btn",3,"click"],[1,"feather","icon-trash"]],template:function(i,o){i&1&&(T(0,"header",0)(1,"div",1)(2,"a",2),Y(3,"span"),P(),T(4,"a",3)(5,"div",4),Y(6,"i",5),P(),T(7,"span",6),G(8,"Talent Nest"),P()()(),T(9,"a",7),Y(10,"i",8),P(),T(11,"div",9)(12,"ul",10)(13,"li")(14,"a",11),Y(15,"i",12),P()(),T(16,"li",13)(17,"a",14),G(18,"Dropdown"),P(),T(19,"ul",15)(20,"li")(21,"a",16),G(22,"Action"),P()(),T(23,"li")(24,"a",16),G(25,"Another action"),P()(),T(26,"li")(27,"a",16),G(28,"Something else here"),P()()()(),T(29,"li",17)(30,"div",18)(31,"div",19),Y(32,"input",20),T(33,"a",21),Y(34,"i",22),P(),T(35,"span",23),Y(36,"i",24),P()()()()(),T(37,"ul",25)(38,"li")(39,"div",26)(40,"a",27),kt("click",function(){return o.toggleDropdown()}),Y(41,"i",28),P(),T(42,"div",29)(43,"div",30)(44,"h6",31),G(45,"Notifications"),P(),T(46,"div",32)(47,"a",33),kt("click",function(){return o.markAllAsRead()}),G(48,"mark as read"),P(),T(49,"a",34),kt("click",function(){return o.deleteAll()}),G(50,"clear all"),P()()(),T(51,"ul",35),$t(52,qw,2,1,"div",36),P()()()(),T(53,"li")(54,"div",37)(55,"a",14),Y(56,"i",38),P(),T(57,"div",39)(58,"div",40),Y(59,"img",41),T(60,"span"),G(61),P(),T(62,"a",42),kt("click",function(){return o.logout()}),Y(63,"i",43),P()(),T(64,"ul",44)(65,"li")(66,"a",45),Y(67,"i",46),G(68," Profile"),P()(),T(69,"li")(70,"a",47),Y(71,"i",48),G(72," My Messages"),P()(),T(73,"li")(74,"a",49),Y(75,"i",50),G(76," 2FA with SMS\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),T(77,"input",51),Wr("ngModelChange",function(s){return Br(o.smsEnabled,s)||(o.smsEnabled=s),s}),kt("change",function(){return o.toggleSMS()}),P()()(),T(78,"li")(79,"a",49),Y(80,"i",50),G(81," 2FA with Email\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),T(82,"input",52),Wr("ngModelChange",function(s){return Br(o.emailEnabled,s)||(o.emailEnabled=s),s}),kt("change",function(){return o.toggleEmail()}),P()()(),T(83,"li")(84,"a",53),kt("click",function(){return o.logout()}),Y(85,"i",54),G(86," Logout"),P()()()()()()()()()),i&2&&(Q(42),ct("ngClass",Dp(5,Xw,o.isDropdownOpen)),Q(10),ct("ngForOf",o.data),Q(9),Ye(o.user),Q(16),Lr("ngModel",o.smsEnabled),Q(5),Lr("ngModel",o.emailEnabled))},dependencies:[Op,no,Ne,Vn,Hp,Je,io],styles:[".notification[_ngcontent-%COMP%]{position:relative;padding:15px}.media[_ngcontent-%COMP%]{display:flex;align-items:center}.media-body[_ngcontent-%COMP%]{flex:1}.trash-icon[_ngcontent-%COMP%]{margin-left:auto}.delete-btn[_ngcontent-%COMP%]{color:red}"]});let r=e;return r})();var Dm=(()=>{let e=class e{constructor(n){this.http=n,this._refreshNeeded$=new ep}get refreshNeeded(){return this._refreshNeeded$.asObservable()}sendMessage(n){return this.http.post("http://127.0.0.1:5000/predict",{message:n}).pipe(xp(()=>{this._refreshNeeded$.next()}))}};e.\u0275fac=function(i){return new(i||e)(Dt(zn))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Jw=["chatBox"];function Qw(r,e){if(r&1&&(T(0,"div",20)(1,"p",21)(2,"b",22),G(3),P(),G(4),P()()),r&2){let t=Tt().$implicit,n=Tt();Q(3),de(" ",n.user.firstname," "),Q(),de(" : ",t," ")}}function Zw(r,e){r&1&&(T(0,"div",20)(1,"div",23)(2,"span",24),Y(3,"span",25)(4,"span",26)(5,"span",27),P()()())}function t_(r,e){if(r&1&&(T(0,"div",15),$t(1,Qw,5,2,"div",16),T(2,"div",17)(3,"p",18)(4,"b",19),G(5,"Sam "),P(),G(6),P()(),$t(7,Zw,6,0,"div",16),P()),r&2){let t=e.index,n=Tt();Q(),ct("ngIf",!n.isResponding||t!==n.inputMessages.length-1),Q(5),de(" : ",n.responseMessages[t]," "),Q(),ct("ngIf",n.isResponding&&t===n.inputMessages.length-1)}}var Tm=(()=>{let e=class e{constructor(n,i,o){this.chatService=n,this.cdr=i,this.attendanceService=o,this.isOpen=!1,this.newMessage="",this.messages=[],this.inputMessages$=new np([]),this.isResponding=!1,this.inputMessages=[],this.responseMessages=[]}ngOnInit(){let n=localStorage.getItem("user");if(n){let i=JSON.parse(n).email;this.attendanceService.getUserIdByEmail(i).subscribe(o=>{this.id=o.id,this.attendanceService.find(this.id).subscribe(a=>{this.user=a})})}}toggleChat(){let n=document.getElementById("chat1");n?n.classList.toggle("chat-hidden"):console.error("Chat section not found.")}sendMessage(){return je(this,null,function*(){this.inputMessages.push(this.newMessage),this.isResponding=!0;let n=this.inputMessages.length-1;try{let i=this.chatService.sendMessage(this.newMessage).toPromise(),o=setTimeout(()=>{this.isResponding=!1},1e3),a=yield i;clearTimeout(o),console.log(a.answer),this.responseMessages.push(a.answer),this.newMessage="",this.cdr.detectChanges()}catch(i){console.error("Error:",i)}finally{this.isResponding=!1}})}};e.\u0275fac=function(i){return new(i||e)(vt(Dm),vt(Ep),vt(qs))},e.\u0275cmp=Wt({type:e,selectors:[["app-recruitement-assistant"]],viewQuery:function(i,o){if(i&1&&cr(Jw,5),i&2){let a;lr(a=hr())&&(o.chatBox=a.first)}},decls:17,vars:3,consts:[[2,"background-color","#eee"],["id","chatContainer",1,"container","py-2"],[1,"row","d-flex","justify-content-center"],[1,"col-md-8","col-lg-6","col-xl-4"],["id","chat1",1,"card",2,"border-radius","15px"],[1,"card-header","d-flex","justify-content-between","align-items-center","p-3","bg-info","text-white","border-bottom-0",2,"border-top-left-radius","15px","border-top-right-radius","15px"],["src","assets/images/image.png","alt","Chatbot Avatar",2,"width","50px","height","50px","border-radius","50%","margin-right","10px"],[1,"mb-0","fw-bold"],[1,"card-body"],["class","message",4,"ngFor","ngForOf"],[1,"input-group","mb-3"],["type","text","placeholder","Type your message here...",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["id","toggleChatBtn",3,"click"],[1,"fas","fa-comments"],[1,"message"],["class","input-message",4,"ngIf"],[1,"response-message"],[1,"message-text2"],[2,"color","rgb(5, 5, 122)"],[1,"input-message"],[1,"message-text1"],[2,"color","rgb(131, 131, 244)"],[1,"my","message"],[1,"jumping-dots"],[1,"dot-1"],[1,"dot-2"],[1,"dot-3"]],template:function(i,o){i&1&&(T(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),Y(6,"img",6),T(7,"p",7),G(8," Hi, I'm Sam, your dependable Recruitment Assistant Chatbot, here to elevate your hiring experience. "),P()(),T(9,"div",8),$t(10,t_,8,3,"div",9),T(11,"div",10)(12,"input",11),Wr("ngModelChange",function(s){return Br(o.newMessage,s)||(o.newMessage=s),s}),P(),T(13,"button",12),kt("click",function(){return o.sendMessage()}),G(14," Send "),P()()()()()()()(),T(15,"button",13),kt("click",function(){return o.toggleChat()}),Y(16,"i",14),P()),i&2&&(Q(10),ct("ngForOf",o.inputMessages),Q(2),Lr("ngModel",o.newMessage),Q(),ct("disabled",o.isResponding))},dependencies:[no,Ne,gn,Je,io],styles:["#chatContainer[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:-350px}#toggleChatBtn[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;background-color:#007bff;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:24px;cursor:pointer;box-shadow:0 2px 5px #0000004d}.chat-hidden[_ngcontent-%COMP%]{display:none}.jumping-dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:auto;animation:_ngcontent-%COMP%_jump 1s infinite;display:inline-block}.jumping-dots[_ngcontent-%COMP%]   .dot-1[_ngcontent-%COMP%]{background-color:#ed49fe;width:12px;height:12px;border-radius:50%;margin-right:3px;animation-delay:.2s}.jumping-dots[_ngcontent-%COMP%]   .dot-2[_ngcontent-%COMP%]{background-color:#ed49fe;width:12px;height:12px;border-radius:50%;margin-right:3px;animation-delay:.4s}.jumping-dots[_ngcontent-%COMP%]   .dot-3[_ngcontent-%COMP%]{background-color:#ed49fe;width:12px;height:12px;border-radius:50%;margin-right:3px;animation-delay:.6s}@keyframes _ngcontent-%COMP%_jump{0%{bottom:0}20%{bottom:5px}40%{bottom:0}}.message.response-message.message-text2[_ngcontent-%COMP%]{text-align:right}.message.input-message.message-text1[_ngcontent-%COMP%]{text-align:left}.message[_ngcontent-%COMP%]{border-radius:10px;box-shadow:0 1px 2px #0000001a;border:1px solid #ccc;margin-bottom:10px;padding:10px}"],changeDetection:0});let r=e;return r})();var Pm=(()=>{let e=class e{constructor(){}ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Wt({type:e,selectors:[["app-home"]],decls:3,vars:0,template:function(i,o){i&1&&Y(0,"app-navbar")(1,"app-sidebar")(2,"app-recruitement-assistant")},dependencies:[Mm,Am,Tm]});let r=e;return r})();var yg=function(r,e){return(yg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function In(r,e){function t(){this.constructor=r}yg(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function it(r,e,t,n){return new(t||(t=Promise))(function(i,o){function a(c){try{u(n.next(c))}catch(l){o(l)}}function s(c){try{u(n.throw(c))}catch(l){o(l)}}function u(c){c.done?i(c.value):new t(function(l){l(c.value)}).then(a,s)}u((n=n.apply(r,e||[])).next())})}function ot(r,e){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(l[0]===6&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(r,a)}catch(h){l=[6,h],n=0}finally{t=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var n_=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,i=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return r_(n,a[0],a[1]),a.join("=")}),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,u)})}},r}();function r_(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function j(){return wg}var wg=null,pu=new Map,Gl=new Map;function _g(r,e){var t=Sg(r,e);return pu.get(t)}function i_(r){return Gl.get(r)}function Lm(r){for(var e=pu.entries(),t=[];;){var n=e.next(),i=n.done,o=n.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===r&&t.push(s)}return t}function Cg(r){var e=r.kernelName,t=r.backendName,n=Sg(e,t);if(pu.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");pu.set(n,r)}function o_(r){var e=r.kernelName;Gl.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Gl.set(e,r)}function Sg(r,e){return e+"_"+r}function Bm(r){for(var e=r.length,t=0,n=0;e>0;)n=Math.random()*e|0,t=r[--e],r[e]=r[n],r[n]=t}function mu(r,e,t){return Math.max(r,Math.min(e,t))}function dh(r){return r%2==0?r:r+1}function Eg(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function M(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Pt(r,e,t){t===void 0&&(t=""),M(fe(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function Mi(r){M(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function vr(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||Ae(r)&&!t)for(var n=0;n<r.length;++n)vr(r[n],e,t);else e.push(r);return e}function at(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function fe(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ne(r){return r%1==0}function kg(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function gu(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function _i(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function ql(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,i){var o=0,a=function(){if(r())n();else{o++;var s=e(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function Ig(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=r.slice();return o[n]=e/t,o}function me(r,e){var t=e.length;return M((r=r==null?e.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),M(r.every(function(n){return ne(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function Gr(r,e){for(var t=[],n=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:me(e,r).sort(),a=0,s=0;s<r.length;++s){if(o!=null){if(o[a]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(o[a]==null||o[a]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),o[a]<=s&&a++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Mo(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function Ia(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function Mg(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function Rg(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Ag(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function Ae(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function fh(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Dg(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function qr(r){return typeof r=="string"||r instanceof String}function Tg(r){return typeof r=="boolean"}function Pg(r){return typeof r=="number"}function Ao(r){return Array.isArray(r)?Ao(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Pg(r)?"float32":qr(r)?"string":Tg(r)?"bool":"float32"}function vu(r){return!!(r&&r.constructor&&r.call&&r.apply)}function xu(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function En(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function ph(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=vr(r)),t&&Mg(r,e),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function Xl(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,i){return n*i});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return function n(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],c=0;c<u;c++)s[c]=a[i+c];else{u=o[0];var l=o.slice(1),h=l.reduce(function(d,f){return d*f});for(c=0;c<u;c++)s[c]=n(i+c*h,l,a)}return s}(0,r,e)}function mh(r,e){for(var t=Do(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Do(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function Sn(){return j().platform.now()}function gh(r){r.forEach(function(e){M(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function Fg(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",j().platform.encode(r,e)}function Ma(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",j().platform.decode(r,e)}function Kl(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],i=0;i<r.length-1;++i)n+=t[i]*r[i];return n}function Og(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),i=0;i<n.length-1;++i)n[i]=Math.floor(r/t[i]),r-=n[i]*t[i];return n[n.length-1]=r,n}var OT=Object.freeze({shuffle:Bm,clamp:mu,nearestLargerEven:dh,sum:Eg,randUniform:function(r,e){var t=Math.random();return e*t+(1-t)*r},distSquared:function(r,e){for(var t=0,n=0;n<r.length;n++){var i=Number(r[n])-Number(e[n]);t+=i*i}return t},assert:M,assertShapesMatch:Pt,assertNonNull:Mi,flatten:vr,sizeFromShape:at,isScalarShape:function(r){return r.length===0},arraysEqual:fe,isInt:ne,tanh:kg,sizeToSquarishShape:gu,createShuffledIndices:function(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return Bm(e),e},rightPad:_i,repeatedTry:ql,inferFromImplicitShape:Ig,parseAxisParam:me,squeezeShape:Gr,getTypedArrayFromDType:Mo,getArrayFromDType:Ia,checkConversionForErrors:Mg,isValidDtype:Rg,hasEncodingLoss:Ag,isTypedArray:Ae,bytesPerElement:fh,bytesFromStringArray:Dg,isString:qr,isBoolean:Tg,isNumber:Pg,inferDtype:Ao,isFunction:vu,nearestDivisor:xu,computeStrides:En,toTypedArray:ph,toNestedArray:Xl,makeOnesTypedArray:mh,makeZerosTypedArray:Do,now:Sn,assertNonNegativeIntegerDimensions:gh,fetch:function(r,e){return j().platform.fetch(r,e)},encodeString:Fg,decodeString:Ma,locToIndex:Kl,indexToLoc:Og}),a_=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new s_)}return r.prototype.profileKernel=function(e,t,n){var i,o=this,a=this.backendTimer.time(function(){i=n()});return i.forEach(function(s){s.data().then(function(u){(function(c,l,h){if(l!=="float32")return!1;for(var d=0;d<c.length;d++){var f=c[d];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then(function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,c.kernelMs,t,l)})})}),i},r}(),s_=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,o,a){var s=typeof i=="number"?_i(i+"ms",9):i.error,u=_i(e,25),c=t.rank,l=t.size,h=_i(t.shape.toString(),14),d="";for(var f in o){var p=o[f].shape||t.shape,m=p.length;d+=f+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+h+"	%c"+l+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),Wm=20,xa=3,Sl=7;function u_(r,e,t,n){var i=En(e),o=function(c,l,h,d){var f=at(l),p=d[d.length-1],m=new Array(p).fill(0),g=l.length,v=h==="complex64"?ya(c):c;if(g>1)for(var x=0;x<f/p;x++)for(var w=x*p,b=0;b<p;b++)m[b]=Math.max(m[b],ba(v[w+b],0,h).length);return m}(r,e,t,i),a=e.length,s=function c(l,h,d,f,p,m){m===void 0&&(m=!0);var g=d==="complex64"?2:1,v=h[0],x=h.length;if(x===0)return d==="complex64"?[ba(ya(l)[0],0,d)]:d==="bool"?[Ng(l[0])]:[l[0].toString()];if(x===1){if(v>Wm){var w=xa*g,b=Array.from(l.slice(0,w)),y=Array.from(l.slice((v-xa)*g,v*g));return d==="complex64"&&(b=ya(b),y=ya(y)),["["+b.map(function(O,V){return ba(O,p[V],d)}).join(", ")+", ..., "+y.map(function(O,V){return ba(O,p[v-xa+V],d)}).join(", ")+"]"]}return["["+(d==="complex64"?ya(l):Array.from(l)).map(function(O,V){return ba(O,p[V],d)}).join(", ")+"]"]}var _=h.slice(1),S=f.slice(1),C=f[0]*g,E=[];if(v>Wm){for(var I=0;I<xa;I++){var A=(R=I*C)+C;E.push.apply(E,c(l.slice(R,A),_,d,S,p,!1))}for(E.push("..."),I=v-xa;I<v;I++)A=(R=I*C)+C,E.push.apply(E,c(l.slice(R,A),_,d,S,p,I===v-1))}else for(I=0;I<v;I++){var R;A=(R=I*C)+C,E.push.apply(E,c(l.slice(R,A),_,d,S,p,I===v-1))}var L=x===2?",":"";for(E[0]="["+E[0]+L,I=1;I<E.length-1;I++)E[I]=" "+E[I]+L;var B=`,
`;for(I=2;I<x;I++)B+=`
`;return E[E.length-1]=" "+E[E.length-1]+"]"+(m?"":B),E}(r,e,t,i,o),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ba(r,e,t){return _i(Array.isArray(r)?parseFloat(r[0].toFixed(Sl))+" + "+parseFloat(r[1].toFixed(Sl))+"j":qr(r)?"'"+r+"'":t==="bool"?Ng(r):parseFloat(r.toFixed(Sl)).toString(),e)}function Ng(r){return r===0?"false":"true"}function ya(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Ra=function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=at(e),n!=null){var o=n.length;M(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ia(t,this.size),this.strides=En(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),M(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var u=e[e.length-1],c=0;c<e.length-1;++c)u+=this.strides[c]*e[c];return this.values[u]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return Hn().makeTensor(this.values,this.shape,this.dtype)},r}(),Hn=null,W=null,Lg=null,zt=function(){function r(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=at(e),this.strides=En(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),M(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,o){return this.throwIfDisposed(),this.reshape([e,t,n,i,o])},r.prototype.asType=function(e){return this.throwIfDisposed(),W.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return it(this,void 0,void 0,function(){var e;return ot(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,W.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return W.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return it(this,void 0,void 0,function(){var e;return ot(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Xl(this.shape,e)]}})})},r.prototype.arraySync=function(){return Xl(this.shape,this.dataSync())},r.prototype.data=function(){return it(this,void 0,void 0,function(){var e,t;return ot(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Hn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(i){return Ma(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Hn().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Ma(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return it(this,void 0,void 0,function(){var e;return ot(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Hn().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(Hn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),W.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),W.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),W.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),W.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),W.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),W.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),W.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),u_(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),W.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),W.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),W.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),W.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),W.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),W.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),W.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),W.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),W.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),W.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),W.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),W.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,i,o){return n===void 0&&(n=.001),Lg("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,n)},r.prototype.batchNorm=function(e,t,n,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),W.batchNorm(this,e,t,n,i,o)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),W.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),W.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),W.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),W.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),W.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),W.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),W.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),W.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),W.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),W.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),W.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),W.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),W.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),W.div(this,e)},r.prototype.divNoNan=function(e){return this.throwIfDisposed(),W.divNoNan(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),W.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),W.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),W.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),W.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),W.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),W.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),W.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),W.modStrict(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),W.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),W.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),W.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),W.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),W.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),W.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),W.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),W.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),W.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),W.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),W.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),W.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),W.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),W.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),W.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),W.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),W.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),W.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),W.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),W.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),W.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),W.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),W.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),W.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),W.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),W.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),W.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),W.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),W.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),W.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),W.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),W.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),W.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),W.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),W.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),W.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),W.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),W.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),W.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),W.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),W.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),W.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),W.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),W.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),W.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),W.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),W.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),W.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),W.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),W.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),W.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),W.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),W.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),W.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),W.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),W.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),W.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),W.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),W.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),W.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),W.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),W.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),W.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),W.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),W.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),W.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),W.conv1d(this,e,t,n,i,o,a)},r.prototype.conv2d=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),W.conv2d(this,e,t,n,i,o,a)},r.prototype.conv2dTranspose=function(e,t,n,i,o){return this.throwIfDisposed(),W.conv2dTranspose(this,e,t,n,i,o)},r.prototype.depthwiseConv2D=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),W.depthwiseConv2d(this,e,t,n,i,o,a)},r.prototype.separableConv2d=function(e,t,n,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),W.separableConv2d(this,e,t,n,i,o,a)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),W.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),W.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),W.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,o){return this.throwIfDisposed(),W.pool(this,e,t,n,i,o)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Hn().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),W.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),W.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),W.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),W.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),W.stridedSlice(this,e,t,n,i,o,a,s,u)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),W.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),W.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),W.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),W.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),W.spectral.irfft(this)},r}();Object.defineProperty(zt,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var zm,Yl,$l,Jl,Ql,Si=function(r){function e(t,n,i,o){var a=r.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=i,a}return In(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!fe(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Hn().disposeTensor(this),this.dataId=t.dataId,Hn().incRef(this,null)},e.prototype.dispose=function(){Hn().disposeVariable(this),this.isDisposedInternal=!0},e}(zt);Object.defineProperty(Si,Symbol.hasInstance,{value:function(r){return r instanceof zt&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(zm||(zm={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(Yl||(Yl={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}($l||($l={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(Jl||(Jl={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Ql||(Ql={}));var c_={float32:Jl,int32:Yl,bool:$l,complex64:Ql};function _e(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return c_[r][e]}function El(r){return _e(r,"int32")}function Qt(r,e){if(r.dtype===e.dtype)return[r,e];var t=_e(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function Bg(r,e){M(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function vh(r){var e=[];return function t(n,i,o){if(n!=null){if(n instanceof zt)return void i.push(n);if(a=n,!(!Array.isArray(a)&&typeof a!="object")){var a,s=n;for(var u in s){var c=s[u];o.has(c)||(o.add(c),t(c,i,o))}}}}(r,e,new Set),e}var kl,NT=Object.freeze({makeTypesMatch:Qt,assertTypesMatch:Bg,isTensorInList:function(r,e){return e.some(function(t){return t.id===r.id})},getTensorsInContainer:vh}),Vm=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),l_=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Vm}return r.prototype.ready=function(){return it(this,void 0,void 0,function(){var e,t,n;return ot(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return it(this,void 0,void 0,function(){var t,n,i;return ot(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=n,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new a_(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this;Lm(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this;Lm(e).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),o=i.success,a=i.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),i=n.backend,o=this.readSync(t);i.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(o){throw t(),o}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},r.prototype.runKernel=function(e,t,n,i,o){return this.runKernelFunc(null,t,null,e,n,i,o)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var i=this.backend.numDataIds(),o=0;n.forEach(function(u){o+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,i,o,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var d,f=function(x){h&&(l=x.map(function(w){return c.keep(c.clone(w))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=_g(i,this.backendName);return d=v!=null?function(){var x=c.backend.numDataIds();g=v.kernelFunc({inputs:t,attrs:o,backend:c.backend});var w=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,x,w);var b=w.map(function(_){var S=_.dataId,C=_.shape,E=_.dtype;return c.makeTensorFromDataId(S,C,E)}),y=b.filter(function(_,S){return s[S]});return f((a||[]).slice().concat(y)),b}:function(){var x=c.backend.numDataIds();g=c.tidy(function(){return e(c.backend,f)});var w=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(i,x,w),w},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(i,t,function(){return d()}):d()}),h&&this.addTapeNode(i,t,u,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(x){return t[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(g)?u:u[0]},r.prototype.makeTensor=function(e,t,n,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var o=e;n==="string"&&qr(e[0])&&(o=e.map(function(l){return Fg(l)}));var a=i.write(o,t,n),s=new zt(t,n,a,this.nextTensorId());if(this.incRef(s,i),n==="string"){var u=this.state.tensorInfo.get(a),c=Dg(o);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,i){var o=new zt(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,i),o},r.prototype.makeVariable=function(e,t,n,i){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Si(e,t,n,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*fh(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Si||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return it(this,void 0,void 0,function(){var t,n;return ot(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,i,o){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},u=i_(e);u!=null&&(i=u.gradFunc),i!=null&&(s.gradient=function(c){return c=c.map(function(l,h){if(l==null){var d=n[h],f=Do(d.size,d.dtype);return a.makeTensor(f,d.shape,d.dtype)}return l}),i(c.length>1?c:c[0],o)}),this.state.activeTape.push(s)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=vh(e),i=new Set(n.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},r.prototype.gradients=function(e,t,n,i){var o=this;if(i===void 0&&(i=!1),M(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});M(a instanceof zt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var h={},d={},f=0;f<c.length;f++)h[c[f].id]=!0;for(f=0;f<u.length;f++){var p=(_=u[f]).inputs;for(var m in p){for(var g=p[m],v=!1,x=0;x<c.length;x++)if(h[g.id]){_.outputs.forEach(function(I){return h[I.id]=!0}),v=!0,d[_.id]=!0;break}if(v)break}}var w={};w[l.id]=!0;var b={};for(f=u.length-1;f>=0;f--)for(p=(_=u[f]).inputs,x=0;x<_.outputs.length;x++)if(w[_.outputs[x].id]){for(var m in p)w[p[m].id]=!0,b[_.id]=!0;break}var y=[];for(f=0;f<u.length;f++){var _;if(d[(_=u[f]).id]&&b[_.id]){var S={};for(var m in _.inputs){var C=_.inputs[m];h[C.id]&&(S[m]=C)}var E=Object.assign({},_);E.inputs=S,E.outputs=_.outputs,y.push(E)}}return y}(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=n??(u=a.shape,c=mh(at(u),"float32"),F.makeTensor(c,u,"float32")),function(d,f,p){for(var m=function(v){var x=f[v],w=[];if(x.outputs.forEach(function(S){var C=d[S.id];C!=null?w.push(C):w.push(null)}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var b=x.gradient(w),y=function(S){if(!(S in b))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(b)+".");var C=p(function(){return b[S]()});if(C.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+C.dtype+"'");var E=x.inputs[S];if(!fe(C.shape,E.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+S+"' has shape '"+C.shape+"', which does not match the shape of the input '"+E.shape+"'");if(d[E.id]==null)d[E.id]=C;else{var I=d[E.id];d[E.id]=I.add(C),I.dispose()}};for(var _ in x.inputs)y(_)},g=f.length-1;g>=0;g--)m(g)}(l,s,function(d){return o.tidy(d)});var h=t.map(function(d){return l[d.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(d){for(var f=0,p=d.saved;f<p.length;f++)p[f].dispose()}),o.state.activeTape=null),{value:a,grads:h}})},r.prototype.customGrad=function(e){var t=this;return M(vu(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];M(i.every(function(s){return s instanceof zt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernelFunc(function(s,u){return M((n=e.apply(void 0,i.concat([u]))).value instanceof zt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),M(vu(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(s,u){var c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];M(l.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),M(l.every(function(d){return d instanceof zt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return l.forEach(function(d,f){h[f]=function(){return d}}),h})}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.time=function(e){return it(this,void 0,void 0,function(){var t,n;return ot(this,function(i){switch(i.label){case 0:return t=Sn(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=Sn()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Vm,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),F=function(){var r=function(){if(kl==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}kl=t}return kl}();if(r._tfengine==null){var e=new n_(r);r._tfengine=new l_(e)}return function(t){wg=t}(r._tfengine.ENV),Hn=function(){return r._tfengine},r._tfengine}();function Wg(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var fr=j();fr.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),fr.registerFlag("IS_BROWSER",function(){return Wg()}),fr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),fr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),fr.registerFlag("PROD",function(){return!1}),fr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return fr.getBool("DEBUG")}),fr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),fr.registerFlag("IS_TEST",function(){return!1});var Aa,cn,un,xi={},Il={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function zg(r,e){xi[r]=e}function Kn(r){r in xi||(xi[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete xi[t]},!1),t===1?n.getContext("webgl",Il)||n.getContext("experimental-webgl",Il):n.getContext("webgl2",Il)}(r));var e=xi[r];return e.isContextLost()?(delete xi[r],Kn(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),xi[r])}function Au(r,e){return[e,r]}function Ea(r){var e=at(r);return gu(Math.ceil(e/4))}function La(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function xh(r,e){var t,n,i,o,a,s,u,c,l,h=r;return j().getNumber("WEBGL_VERSION")===2?(t=h.R32F,n=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,o=h.RGBA,a=r.RGBA,s=4,u=4,c=e!=null?e.HALF_FLOAT_OES:null,l=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function rt(r,e,t){var n=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+Ug(i,o))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Aa||(Aa={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(cn||(cn={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(un||(un={}));var h_=596e-10,d_=65504;function Vg(r){return!!(j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||h_<Math.abs(r)&&Math.abs(r)<d_)}function Ug(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function _a(r,e,t){return xr(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function jg(r,e,t){var n=xr(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(rt(r,e,function(){return r.shaderSource(n,t)}),rt(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Hg(r,e,t){var n=xr(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(rt(r,e,function(){return r.shaderSource(n,t)}),rt(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(i,o){var a=f_.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),c=u.length.toString().length+2,l=u.map(function(g,v){return _i((v+1).toString(),c)+g}),h=0,d=0;d<l.length;d++)h=Math.max(l[d].length,h);var f=l.slice(0,s-1),p=l.slice(s-1,s),m=l.slice(s);console.log(f.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+_i(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var su,uu,f_=/ERROR: [0-9]+:([0-9]+):/g;function Gg(r,e){return xr(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function qg(r,e,t){if(rt(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function cu(r,e,t){if(rt(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Xg(r,e,t){var n=xr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return rt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),rt(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function Kg(r,e,t){var n=xr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return rt(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),rt(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function Yg(r,e){return xr(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function $g(r,e){var t=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function Jg(r,e){return xr(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Zl(r,e,t,n,i,o,a,s){var u=r.getAttribLocation(t,n);return u!==-1&&(rt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),rt(r,e,function(){return r.vertexAttribPointer(u,o,r.FLOAT,!1,a,s)}),rt(r,e,function(){return r.enableVertexAttribArray(u)}),!0)}function Qg(r,e,t,n){rv(r,n),rt(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function Zg(r,e,t,n){return xr(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function tv(r,e,t){return r.getUniformLocation(e,t)}function ev(r,e,t,n,i,o){rt(r,e,function(){return Qg(r,e,n,o)}),rt(r,e,function(){return r.uniform1i(i,o)})}function lu(r,e,t,n){rt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),rt(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function th(r,e,t){rt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),rt(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function Ca(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+nv(r,e))}function nv(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function xr(r,e,t,n){var i=rt(r,e,function(){return t()});if(i==null)throw new Error(n);return i}function rv(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Da(r,e){return e===void 0&&(e=2),at(r.slice(0,r.length-e))}function Ta(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function hu(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[Da(r)].concat(Ta(r))),e}function iv(r,e){var t;e===void 0&&(e=!1);var n=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(c,l){return l>=r.length-2?dh(r[l]):r[l]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=Gr(r);r=i.newShape}var o=at(r);if(r.length<=1&&o<=n)return[1,o];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var a=Da(r),s=2,u=2;return r.length&&(s=(t=Ta(r))[0],u=t[1]),gu(o=a*(s/2)*(u/2)).map(function(c){return 2*c})}return gu(o)}function Qs(r){return r%2==0}function Sa(r,e){if(fe(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||Qs(t)&&Qs(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&Qs(r[0])&&Qs(e[0])}function ov(r){if(su==null){var e=Kn(r);su=e.getParameter(e.MAX_TEXTURE_SIZE)}return su}function av(r){if(uu==null){var e=Kn(r);uu=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,uu)}function sv(r){if(r===0)return 0;var e=Kn(r);return ln(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ln(e,"EXT_disjoint_timer_query")?1:0}function ln(r,e){return r.getExtension(e)!=null}function eh(r){try{if(Kn(r)!=null)return!0}catch{return!1}return!1}function uv(r){if(r===0)return!1;var e=Kn(r);if(r===1){if(!ln(e,"OES_texture_float"))return!1}else if(!ln(e,"EXT_color_buffer_float"))return!1;return nh(e)}function cv(r){if(r===0)return!1;var e=Kn(r);if(r!==1){if(ln(e,"EXT_color_buffer_float"))return nh(e);if(ln(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(n,i){var o=xh(n,i),a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0);var u=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(a),n.deleteFramebuffer(s),u}(e,t)}return!1}return!!ln(e,"OES_texture_float")&&!!ln(e,"WEBGL_color_buffer_float")&&nh(e)}function nh(r){var e=xh(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),i}function lv(r){return r===2&&Kn(r).fenceSync!=null}var p_=Object.freeze({callAndCheck:rt,canBeRepresented:Vg,getWebGLErrorMessage:Ug,getExtensionOrThrow:_a,createVertexShader:jg,createFragmentShader:Hg,createProgram:Gg,linkProgram:qg,validateProgram:cu,createStaticVertexBuffer:Xg,createStaticIndexBuffer:Kg,getNumChannels:function(){return j().getNumber("WEBGL_VERSION")===2?1:4},createTexture:Yg,validateTextureSize:$g,createFramebuffer:Jg,bindVertexBufferToProgramAttribute:Zl,bindTextureUnit:Qg,unbindTextureUnit:function(r,e,t){rv(r,t),rt(r,e,function(){return r.activeTexture(r.TEXTURE0+t)}),rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Zg,getProgramUniformLocation:tv,bindTextureToProgramUniformSampler:ev,bindCanvasToFramebuffer:function(r,e){rt(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),rt(r,e,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),rt(r,e,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:lu,unbindColorTextureFromFramebuffer:th,validateFramebuffer:Ca,getFramebufferErrorMessage:nv,getBatchDim:Da,getRowsCols:Ta,getShapeAs3D:hu,getTextureShapeFromLogicalShape:iv,isReshapeFree:Sa,getWebGLMaxTextureSize:ov,resetMaxTextureSize:function(){su=null},resetMaxTexturesInShader:function(){uu=null},getMaxTexturesInShader:av,getWebGLDisjointQueryTimerVersion:sv,hasExtension:ln,isWebGLVersionEnabled:eh,isCapableOfRenderingToFloatTexture:uv,isDownloadFloatTextureEnabled:cv,isWebGLFenceEnabled:lv}),dt=j();function hv(r){j().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function X(r,e){return F.tidy(r,e)}function tn(r){vh(r).forEach(function(e){return e.dispose()})}function m_(r){return F.keep(r)}function bu(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];j().getBool("IS_TEST")||console.warn.apply(console,r)}function Xn(r,e){var t=r;if(Ae(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||Ae(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&j().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!Ae(o))return void M(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});M(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),M(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var u=a.slice(1),c=0;c<o.length;++c)i(o[c],u,s.concat(c))}(r,n,[]),n}function Um(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function k(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof zt)return Um(n,r.dtype,e,t),r;var i=Ao(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),Um(n,i,e,t),r==null||!Ae(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var o=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Xn(r,i);Ae(r)||Array.isArray(r)||(r=[r]);var s=i!=="string"?ph(r,i,j().getBool("DEBUG")):vr(r,[],!0);return F.makeTensor(s,a,i)}function yu(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,o){return k(i,e+"["+o+"]",t)},n)}function bh(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function dv(r,e,t){for(var n=r.length+e.length,i=[],o=0,a=0,s=0;s<n;s++)t.indexOf(s)===-1?i.push(r[o++]):i.push(e[a++]);return i}function Re(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map(function(o){return r[o]})]}function He(r,e){return dv(r,e.map(function(t){return 1}),e)}function Qe(r,e,t){M(bh(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Mn(r,e){if(bh(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(i){return t.push(i)}),t}function Du(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Rn(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function fv(r,e){var t=r[0].length;r.forEach(function(i,o){M(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),M(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(i,o){for(var a=0;a<t;a++)M(a===e||i[a]===n[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."})})}function Ei(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function D(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];F.startScope(t);try{var s=n.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),F.endScope(s),s}catch(u){throw F.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}dt.registerFlag("HAS_WEBGL",function(){return dt.getNumber("WEBGL_VERSION")>0}),dt.registerFlag("WEBGL_VERSION",function(){return eh(2)?2:eh(1)?1:0}),dt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return dt.get("WEBGL_VERSION")===2}),dt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),dt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),dt.registerFlag("WEBGL_PACK",function(){return dt.getBool("HAS_WEBGL")}),dt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_CLIP",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),dt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_PACK_REDUCE",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_CONV_IM2COL",function(){return dt.getBool("WEBGL_PACK")}),dt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ov(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return av(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=dt.getNumber("WEBGL_VERSION");return r===0?0:sv(r)}),dt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return dt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),dt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return uv(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!dt.getBool("WEBGL_FORCE_F16_TEXTURES")&&dt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),dt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return cv(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return lv(dt.getNumber("WEBGL_VERSION"))}),dt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return dt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Lg=hv;var Me=D({complex_:function(r,e){var t=k(r,"real","complex"),n=k(e,"imag","complex");return Pt(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),F.runKernelFunc(function(i){return i.complex(t,n)},{$real:t,$imag:n})}}),vn=D({real_:function(r){var e=k(r,"input","real");return F.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Gn=D({imag_:function(r){var e=k(r,"input","imag");return F.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Ce(r,e,t){return Yr(r,e,Xn(r,t),t)}function Yr(r,e,t,n){if(n==null&&(n=Ao(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ae(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){gh(e);var i=at(e),o=at(t);M(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==at(e.slice(a));M(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Ae(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?ph(r,n,j().getBool("DEBUG")):vr(r,[],!0),F.makeTensor(r,e,n)}function Z(r,e){if((Ae(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ae(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Yr(r,[],[],e)}function jt(r,e){Mi(r);var t=Xn(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Yr(r,null,t,e)}function qn(r,e,t){if(Mi(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Xn(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Yr(r,e,n,t)}function Tu(r,e,t){if(Mi(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Xn(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Yr(r,e,n,t)}function xe(r,e,t){if(Mi(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Xn(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Yr(r,e,n,t)}function g_(r,e,t){if(Mi(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Xn(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Yr(r,e,n,t)}function v_(r,e,t){if(Mi(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Xn(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Yr(r,e=e||n,n,t)}function x_(r,e,t,n){return e===void 0&&(e=!0),F.makeVariable(r,e,t,n)}function To(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=To(r,"float32"),n=Gt(r,"float32");return Me(t,n)}var i=mh(at(r),e);return F.makeTensor(i,r,e)}function Gt(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Gt(r,"float32"),n=Gt(r,"float32");return Me(t,n)}var i=Do(at(r),e);return F.makeTensor(i,r,e)}function dn(r,e,t){return F.runKernelFunc(function(n){return n.fill(r,e,t)},{})}function b_(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return F.runKernelFunc(function(n){return n.linspace(r,e,t)},{})}function wu(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Gt([0],n);var i=Do(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return jt(i,n)}var pv=D({onesLike_:function(r){var e=k(r,"x","onesLike");if(e.dtype==="complex64"){var t=pv(vn(e)),n=It(Gn(e));return Me(t,n)}return F.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return It(i)}}})}}),It=D({zerosLike_:function(r){var e=k(r,"x","zerosLike");return F.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return It(t)}}})}}),Jt=D({concat_:function(r,e){e===void 0&&(e=0),M(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=yu(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=me(e,t[0].shape)[0];var n=Ei(t.map(function(s){return s.shape}),e);if(at(n)===0)return Ce([],n);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});fv(i,e);var o=t,a={axis:e};return F.runKernelFunc(function(s){return s.concat(t,e)},o,function(s){var u=i.map(function(c){return c[e]});return yh(s,u,e).map(function(c){return function(){return c}})},"Concat",a)}}),y_=D({concat1d_:function(r){return Jt(r,0)}}),w_=D({concat2d_:function(r,e){return Jt(r,e)}}),__=D({concat3d_:function(r,e){return Jt(r,e)}}),C_=D({concat4d_:function(r,e){return Jt(r,e)}}),yh=D({split_:function(r,e,t){t===void 0&&(t=0);var n,i=k(r,"x","split");return t=me(t,i.shape)[0],typeof e=="number"?(M(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(i.shape[t]/e)):(M(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),F.runKernelFunc(function(o){return o.split(i,n,t)},{$x:i},function(o){return{$x:function(){return Jt(o,t)}}})}});function Ri(r,e){return r(e={exports:{}},e.exports),e.exports}var S_=Ri(function(r){(function(e,t,n){function i(s){var u,c=this,l=(u=4022871197,function(h){h=h.toString();for(var d=0;d<h.length;d++){var f=.02519603282416938*(u+=h.charCodeAt(d));f-=u=f>>>0,u=(f*=u)>>>0,u+=4294967296*(f-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var h=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=0|h)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new i(s),l=u&&u.state,h=c.next;return h.int32=function(){return 4294967296*c.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,l&&(typeof l=="object"&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.alea=a})(0,r,!1)}),E_=Ri(function(r){(function(e,t,n){function i(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new i(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.xor128=a})(0,r,!1)}),k_=Ri(function(r){(function(e,t,n){function i(s){var u=this,c="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new i(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.xorwow=a})(0,r,!1)}),I_=Ri(function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var c,l,h=u.x,d=u.i;return c=h[d],l=(c^=c>>>7)^c<<24,l^=(c=h[d+1&7])^c>>>10,l^=(c=h[d+3&7])^c>>>3,l^=(c=h[d+4&7])^c<<7,c=h[d+7&7],l^=(c^=c<<13)^c<<9,h[d]=l,u.i=d+1&7,l},function(c,l){var h,d=[];if(l===(0|l))d[0]=l;else for(l=""+l,h=0;h<l.length;++h)d[7&h]=d[7&h]<<15^l.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(l.x&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.xorshift7=a})(0,r,!1)}),M_=Ri(function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var c,l,h=u.w,d=u.X,f=u.i;return u.w=h=h+1640531527|0,l=d[f+34&127],c=d[f=f+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=d[f]=l^c,u.i=f,l+(h^h>>>16)|0},function(c,l){var h,d,f,p,m,g=[],v=128;for(l===(0|l)?(d=l,l=null):(l+="\0",d=0,v=Math.max(v,l.length)),f=0,p=-32;p<v;++p)l&&(d^=l.charCodeAt((p+32)%l.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,f=(h=g[127&p]^=d+m)==0?f+1:0);for(f>=128&&(g[127&(l&&l.length||0)]=-1),f=127,p=512;p>0;--p)d=g[f+34&127],h=g[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[f]=d^h;c.w=m,c.X=g,c.i=f}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new i(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(l.X&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.xor4096=a})(0,r,!1)}),R_=Ri(function(r){(function(e,t,n){function i(s){var u=this,c="";u.next=function(){var h=u.b,d=u.c,f=u.d,p=u.a;return h=h<<25^h>>>7^d,d=d-f|0,f=f<<24^f>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^d,u.c=d=d-f|0,u.d=f<<16^d>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new i(s),l=u&&u.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},h.int32=c.next,h.quick=h,l&&(typeof l=="object"&&o(l,c),h.state=function(){return o(c,{})}),h}t&&t.exports?t.exports=a:n&&n.amd?n(function(){return a}):this.tychei=a})(0,r,!1)}),bi=Ri(function(r){(function(e,t){var n,i=this,o=256,a=6,s="random",u=t.pow(o,a),c=t.pow(2,52),l=2*c,h=o-1;function d(v,x,w){var b=[],y=m(function C(E,I){var A,R=[],L=typeof E;if(I&&L=="object")for(A in E)try{R.push(C(E[A],I-1))}catch{}return R.length?R:L=="string"?E:E+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[v,g(e)]:v??function(){try{var C;return n&&(C=n.randomBytes)?C=C(o):(C=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(C)),g(C)}catch{var E=i.navigator,I=E&&E.plugins;return[+new Date,i,I,i.screen,g(e)]}}(),3),b),_=new f(b),S=function(){for(var C=_.g(a),E=u,I=0;C<c;)C=(C+I)*o,E*=o,I=_.g(1);for(;C>=l;)C/=2,E/=2,I>>>=1;return(C+I)/E};return S.int32=function(){return 0|_.g(4)},S.quick=function(){return _.g(4)/4294967296},S.double=S,m(g(_.S),e),(x.pass||w||function(C,E,I,A){return A&&(A.S&&p(A,_),C.state=function(){return p(_,{})}),I?(t[s]=C,E):C})(S,y,"global"in x?x.global:this==t,x.state)}function f(v){var x,w=v.length,b=this,y=0,_=b.i=b.j=0,S=b.S=[];for(w||(v=[w++]);y<o;)S[y]=y++;for(y=0;y<o;y++)S[y]=S[_=h&_+v[y%w]+(x=S[y])],S[_]=x;(b.g=function(C){for(var E,I=0,A=b.i,R=b.j,L=b.S;C--;)E=L[A=h&A+1],I=I*o+L[h&(L[A]=L[R=h&R+E])+(L[R]=E)];return b.i=A,b.j=R,I})(o)}function p(v,x){return x.i=v.i,x.j=v.j,x.S=v.S.slice(),x}function m(v,x){for(var w,b=v+"",y=0;y<b.length;)x[h&y]=h&(w^=19*x[h&y])+b.charCodeAt(y++);return g(x)}function g(v){return String.fromCharCode.apply(0,v)}if(t["seed"+s]=d,m(t.random(),e),r.exports){r.exports=d;try{n=xw()}catch{}}})([],Math)});bi.alea=S_,bi.xor128=E_,bi.xorwow=k_,bi.xorshift7=I_,bi.xor4096=M_,bi.tychei=R_;var Pu=bi.alea,wh=function(){function r(e,t,n,i,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Pu(a.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,n=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),A_=function(){function r(e,t,n,i){this.alpha=e,this.beta=1/t,this.dtype=n;var o=i||Math.random();this.randu=Pu(o.toString()),this.randn=new wh(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(e=i*i)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),D_=function(){function r(e,t,n,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Pu(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function mt(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",gh(r),new Ra(r,e,t)}function T_(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var mv=D({batchToSpaceND_:function(r,e,t){var n=k(r,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return M(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),M(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),M(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),F.runKernelFunc(function(o){return o.batchToSpaceND(n,e,t)},{$x:n},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),P_=D({broadcastTo_:function(r,e){var t=k(r,"broadcastTo","x"),n=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(e),a=e.length-1;a>=0;a--)if(t.shape[a]===e[a])o[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var s=o.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return s.length===0?t.clone():F.runKernelFunc(function(u){return u.tile(t,o)},{input:t},function(u){return{input:function(){return u.sum(s,!0)}}})}}),F_=D({cast_:function(r,e){var t=k(r,"x","cast");if(!Rg(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return F.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",n)}}),O_=D({clone_:function(r){var e=k(r,"x","clone",null);return F.runKernelFunc(function(){return F.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),N_=D({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=k(r,"x","cumsum"),o=Mn([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=Rn(1,i.rank)[0],u=F.runKernelFunc(function(c){return c.cumsum(a,s,t,n)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(e,t,!n)}}});return o!=null&&(u=u.transpose(o)),u}}),L_=D({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=k(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],o=t==="NHWC"?n.shape[2]:n.shape[3],a=t==="NHWC"?n.shape[3]:n.shape[1];return M(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),M(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+n.shape}),M(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+n.shape}),F.runKernelFunc(function(s){return s.depthToSpace(n,e,t)},{$x:n})}}),Le=D({expandDims_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","expandDims",null);M(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&(M(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),qe(t,n)}}),gv=D({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=mt([r,e],n),o=r<=e?r:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(r,e);if(t==null)return s;if(t.length===1)return Ci(Le(s,0),[t[0],1,1]);if(t.length===2)return Ci(Le(Le(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ci(Le(Le(Le(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),B_=D({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=k(r,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=F.runKernelFunc(function(c){return c.multinomial(s,n,e,t)},{logits2D:s});return a===1?u.as1D():u}}),rh=D({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=k(r,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),F.runKernelFunc(function(a){return a.oneHot(i,e,t,n)},{$indices:i},function(a){return{$indices:function(){return Gt(i.shape,"float32")}}}).reshape(o)}}),br=D({pad_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return F.runKernelFunc(function(o){return o.pad(n,e,t)},{x:n},function(o){var a=e.map(function(s){return s[0]});return{x:function(){return o.slice(a,n.shape)}}},"PadV2",i)}}),W_=D({pad1d_:function(r,e,t){return t===void 0&&(t=0),M(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),br(r,[e],t)}}),z_=D({pad2d_:function(r,e,t){return t===void 0&&(t=0),M(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),br(r,e,t)}}),V_=D({pad3d_:function(r,e,t){return t===void 0&&(t=0),M(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),br(r,e,t)}}),U_=D({pad4d_:function(r,e,t){return t===void 0&&(t=0),M(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),br(r,e,t)}}),j_=D({rand_:function(r,e,t){var n=at(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var o=0;o<n;o++)i[o]=e();return F.makeTensor(i,r,t)}}),H_=D({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new wh(e,t,n,!1,i),a=mt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),G_=D({randomGamma_:function(r,e,t,n,i){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var o=new A_(e,t,n,i),a=mt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),vv=D({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var o=mt(r,n),a=new D_(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),qe=D({reshape_:function(r,e){var t=k(r,"x","reshape",null);e=Ig(e,t.size),M(t.size===at(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return F.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",n)}}),xv=D({spaceToBatchND_:function(r,e,t){var n=k(r,"x","spaceToBatchND");return M(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),M(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),M(n.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),F.runKernelFunc(function(i){return i.spaceToBatchND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),bv=D({squeeze_:function(r,e){var t=k(r,"x","squeeze");return qe(t,Gr(t.shape,e).newShape)}}),De=D({stack_:function(r,e){e===void 0&&(e=0);var t=yu(r,"tensors","stack");if(M(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,o=t[0].dtype;M(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Pt(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){M(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Jt(a,e)}}),Ci=D({tile_:function(r,e){var t=k(r,"x","tile",null);M(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var n=[t],i={reps:e};return F.runKernelFunc(function(o,a){var s=o.tile(t,e);return a([t]),s},{x:t},function(o,a){var s=a[0];return{x:function(){var u=It(s);if(s.rank===1)for(var c=0;c<e[0];++c)u=u.add(o.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<e[0];++c)for(var l=0;l<e[1];++l)u=u.add(o.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(var h=0;h<e[2];++h)u=u.add(o.slice([c*s.shape[0],l*s.shape[1],h*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<e[0];++c)for(l=0;l<e[1];++l)for(h=0;h<e[2];++h)for(var d=0;d<e[3];++d)u=u.add(o.slice([c*s.shape[0],l*s.shape[1],h*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",i,n)}}),q_=D({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new wh(e,t,n,!0,i),a=mt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Nt=D({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=k(r,"x","unstack");M(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var n={axis:e};return F.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return De(i,e)}}},"Unpack",n)}}),X_=function(r,e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s,u,c,l,h;return ot(this,function(d){switch(d.label){case 0:return t=k(r,"x","setdiff1d"),n=k(e,"y","setdiff1d"),M(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),M(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),M(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return i=d.sent(),[4,n.data()];case 2:for(o=d.sent(),a=new Set(o),s=0,l=0;l<i.length;l++)a.has(i[l])||s++;for(u=new Ra([s],t.dtype),c=new Ra([s],"int32"),l=0,h=0;l<i.length;l++)a.has(i[l])||(u.values[h]=i[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})};function _u(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([r[a+1]/e[a],e[a]]);i=i.concat(r.slice(o+1))}return i}function Cu(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var o=[],a=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function Su(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var o=1;o<r.length;++o)o<=e.length?n?i.push(e[o-1]*r[o]):i.push(r[o]/e[o-1]):i.push(r[o]);return i}function yv(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function wv(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}function _h(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=r.shape,s=t.slice();s.pop();var u=1;for(o=n;o<r.rank;++o)u*=a[o],s.push(a[o]);var c=En(r.shape).map(function(l){return l/u}).concat([1]).slice(0,n);return[s,i,u,c]}var LT=Object.freeze({prepareAndValidate:_h}),Ch=30;function du(r){return r<=Ch?r:xu(r,Math.floor(Math.sqrt(r)))}function _v(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(r.length<n+(t.rank-i))throw new Error(o+" Output shape length < "+(n+(t.rank-i)));if(t.rank!==i+r.length-n)throw new Error(o+" update.rank != "+(i+r.length-n));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==r[a+n])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+r[a+i]+")")}function Cv(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}_v(t,e,r)}function Pa(r,e,t){for(var n=e.shape.length,i=n>1?e.shape[n-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:at(e.shape)/u,sliceSize:a,strides:En(t.slice(0,i)).concat([1]),outputSize:at(t)}}var BT=Object.freeze({validateUpdateShape:_v,validateInput:Cv,calculateShapes:Pa});function Sv(r,e,t){M(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."}),M(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var n=function(o){M(e[o]+t[o]<=r.shape[o],function(){return"Error in slice"+r.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")"})},i=0;i<r.rank;++i)n(i)}function ih(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function Fu(r,e,t){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((e[i]-r[i])/t[i]);return n}function Ev(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=mu(0,o,s-1)}function kv(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=a>0?mu(0,o,s):mu(-1,o,s-1)}function Sh(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function Eh(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}var WT=Object.freeze({assertParamsValid:Sv,maskToAxes:ih,computeOutShape:Fu,startForAxis:Ev,stopForAxis:kv,isSliceContinous:Sh,computeFlatOffset:Eh});function K_(r,e){M(vu(r),function(){return"The f passed in variableGrads(f) must be a function"}),M(e==null||Array.isArray(e)&&e.every(function(l){return l instanceof Si}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],F.registeredVariables)e.push(F.registeredVariables[n]);var i=t?e.filter(function(l){return!l.trainable}):null,o=e.length;M((e=e.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=F.gradients(r,e,null,!0),s=a.value,u=a.grads;M(u.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),M(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return e.forEach(function(l,h){u[h]!=null&&(c[l.name]=u[h])}),i?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}function Ou(r){return F.customGrad(r)}var Xe=D({softmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return F.runKernelFunc(function(n,i){var o=n.softmax(t,e);return i([o]),o},{logits:t},function(n,i){var o=i[0],a=n.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),Y_=D({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Ou(function(n,i){var o=n.max(e,!0),a=n.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(e,!0).mul(l))}}})(t)}}),Iv=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Mv=function(){function r(){}return r.prototype.time=function(e){return N("time")},r.prototype.read=function(e){return N("read")},r.prototype.readSync=function(e){return N("readSync")},r.prototype.numDataIds=function(){return N("numDataIds")},r.prototype.disposeData=function(e){return N("disposeData")},r.prototype.write=function(e,t,n){return N("write")},r.prototype.move=function(e,t,n,i){return N("move")},r.prototype.memory=function(){return N("memory")},r.prototype.floatPrecision=function(){return N("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,i){return N("batchMatMul")},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,N("fusedBatchMatMul")},r.prototype.slice=function(e,t,n){return N("slice")},r.prototype.stridedSlice=function(e,t,n,i){return N("stridedSlice")},r.prototype.unstack=function(e,t){return N("unstack")},r.prototype.reverse=function(e,t){return N("reverse")},r.prototype.concat=function(e,t){return N("concat")},r.prototype.neg=function(e){return N("neg")},r.prototype.add=function(e,t){return N("add")},r.prototype.addN=function(e){return N("addN")},r.prototype.subtract=function(e,t){return N("subtract")},r.prototype.multiply=function(e,t){return N("multiply")},r.prototype.realDivide=function(e,t){return N("realDivide")},r.prototype.floorDiv=function(e,t){return N("floorDiv")},r.prototype.sum=function(e,t){return N("sum")},r.prototype.prod=function(e,t){return N("prod")},r.prototype.unsortedSegmentSum=function(e,t,n){return N("unsortedSegmentSum")},r.prototype.argMin=function(e,t){return N("argMin")},r.prototype.argMax=function(e,t){return N("argMax")},r.prototype.equal=function(e,t){return N("equal")},r.prototype.notEqual=function(e,t){return N("notEqual")},r.prototype.less=function(e,t){return N("less")},r.prototype.lessEqual=function(e,t){return N("lessEqual")},r.prototype.greater=function(e,t){return N("greater")},r.prototype.greaterEqual=function(e,t){return N("greaterEqual")},r.prototype.logicalNot=function(e){return N("logicalNot")},r.prototype.logicalAnd=function(e,t){return N("logicalAnd")},r.prototype.logicalOr=function(e,t){return N("logicalOr")},r.prototype.where=function(e){return N("where")},r.prototype.select=function(e,t,n){return N("select")},r.prototype.topk=function(e,t,n){return N("topk")},r.prototype.min=function(e,t){return N("min")},r.prototype.minimum=function(e,t){return N("minimum")},r.prototype.mod=function(e,t){return N("mod")},r.prototype.max=function(e,t){return N("max")},r.prototype.maximum=function(e,t){return N("maximum")},r.prototype.all=function(e,t){return N("all")},r.prototype.any=function(e,t){return N("any")},r.prototype.squaredDifference=function(e,t){return N("squaredDifference")},r.prototype.ceil=function(e){return N("ceil")},r.prototype.floor=function(e){return N("floor")},r.prototype.round=function(e){return N("round")},r.prototype.sign=function(e){return N("sign")},r.prototype.isNaN=function(e){return N("isNaN")},r.prototype.isInf=function(e){return N("isInf")},r.prototype.isFinite=function(e){return N("isFinite")},r.prototype.pow=function(e,t){return N("pow")},r.prototype.exp=function(e){return N("exp")},r.prototype.expm1=function(e){return N("expm1")},r.prototype.softmax=function(e,t){return N("softmax")},r.prototype.log=function(e){return N("log")},r.prototype.log1p=function(e){return N("log1p")},r.prototype.sqrt=function(e){return N("sqrt")},r.prototype.rsqrt=function(e){return N("rsqrt")},r.prototype.square=function(e){return N("square")},r.prototype.reciprocal=function(e){return N("reciprocal")},r.prototype.relu=function(e){return N("relu")},r.prototype.relu6=function(e){return N("relu6")},r.prototype.prelu=function(e,t){return N("prelu")},r.prototype.elu=function(e){return N("elu")},r.prototype.eluDer=function(e,t){return N("eluDer")},r.prototype.selu=function(e){return N("selu")},r.prototype.int=function(e){return N("int")},r.prototype.clip=function(e,t,n){return N("clip")},r.prototype.abs=function(e){return N("abs")},r.prototype.complexAbs=function(e){return N("complexAbs")},r.prototype.sigmoid=function(e){return N("sigmoid")},r.prototype.softplus=function(e){return N("softplus")},r.prototype.sin=function(e){return N("sin")},r.prototype.cos=function(e){return N("cos")},r.prototype.tan=function(e){return N("tan")},r.prototype.asin=function(e){return N("asin")},r.prototype.acos=function(e){return N("acos")},r.prototype.atan=function(e){return N("atan")},r.prototype.atan2=function(e,t){return N("atan2")},r.prototype.sinh=function(e){return N("sinh")},r.prototype.cosh=function(e){return N("cosh")},r.prototype.tanh=function(e){return N("tanh")},r.prototype.asinh=function(e){return N("asinh")},r.prototype.acosh=function(e){return N("acosh")},r.prototype.atanh=function(e){return N("atanh")},r.prototype.erf=function(e){return N("erf")},r.prototype.step=function(e,t){return N("step")},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,N("fusedConv2d")},r.prototype.conv2d=function(e,t,n){return N("conv2d")},r.prototype.conv2dDerInput=function(e,t,n){return N("conv2dDerInput")},r.prototype.conv2dDerFilter=function(e,t,n){return N("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,N("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(e,t,n){return N("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return N("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return N("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(e,t,n){return N("conv3d")},r.prototype.conv3dDerInput=function(e,t,n){return N("conv3dDerInput")},r.prototype.conv3dDerFilter=function(e,t,n){return N("conv3dDerFilter")},r.prototype.maxPool=function(e,t){return N("maxPool")},r.prototype.maxPoolBackprop=function(e,t,n,i){return N("maxPoolBackprop")},r.prototype.avgPool=function(e,t){return N("avgPool")},r.prototype.avgPoolBackprop=function(e,t,n){return N("avgPoolBackprop")},r.prototype.avgPool3d=function(e,t){return N("avgPool3d")},r.prototype.avgPool3dBackprop=function(e,t,n){return N("avgPool3dBackprop")},r.prototype.maxPool3d=function(e,t){return N("maxPool3d")},r.prototype.maxPool3dBackprop=function(e,t,n,i){return N("maxPool3dBackprop")},r.prototype.reshape=function(e,t){return N("reshape")},r.prototype.cast=function(e,t){return N("cast")},r.prototype.tile=function(e,t){return N("tile")},r.prototype.pad=function(e,t,n){return N("pad")},r.prototype.transpose=function(e,t){return N("transpose")},r.prototype.gather=function(e,t,n){return N("gather")},r.prototype.gatherND=function(e,t){return N("gatherND")},r.prototype.scatterND=function(e,t,n){return N("scatterND")},r.prototype.batchToSpaceND=function(e,t,n){return N("batchToSpaceND")},r.prototype.spaceToBatchND=function(e,t,n){return N("spaceToBatchND")},r.prototype.resizeBilinear=function(e,t,n,i){return N("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(e,t,n){return N("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(e,t,n,i){return N("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return N("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(e,t,n,i,o,a){return N("batchNormalization")},r.prototype.localResponseNormalization4D=function(e,t,n,i,o){return N("localResponseNormalization4D")},r.prototype.LRNGrad=function(e,t,n,i,o,a,s){return N("LRNGrad")},r.prototype.multinomial=function(e,t,n,i){return N("multinomial")},r.prototype.oneHot=function(e,t,n,i){return N("oneHot")},r.prototype.cumsum=function(e,t,n,i){return N("cumsum")},r.prototype.nonMaxSuppression=function(e,t,n,i,o){return N("nonMaxSuppression")},r.prototype.fft=function(e){return N("fft")},r.prototype.ifft=function(e){return N("ifft")},r.prototype.complex=function(e,t){return N("complex")},r.prototype.real=function(e){return N("real")},r.prototype.imag=function(e){return N("imag")},r.prototype.cropAndResize=function(e,t,n,i,o,a){return N("cropAndResize")},r.prototype.depthToSpace=function(e,t,n){return N("depthToSpace")},r.prototype.split=function(e,t,n){return N("split")},r.prototype.sparseToDense=function(e,t,n,i){return N("sparseToDense")},r.prototype.diag=function(e){return N("diag")},r.prototype.fill=function(e,t,n){return N("fill")},r.prototype.onesLike=function(e){return N("onesLike")},r.prototype.zerosLike=function(e){return N("zerosLike")},r.prototype.linspace=function(e,t,n){return N("linspace")},r.prototype.dispose=function(){return N("dispose")},r}();function N(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function gr(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var o=t-1-i,a=r[o]||1;(e[e.length-1-i]||1)>1&&a===1&&n.unshift(o)}return n}function pe(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],o=e.length-n-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function yt(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var o=r[r.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(o)}}return t}function Ro(r,e,t,n,i,o,a){a===void 0&&(a="channelsLast");var s,u=Eu(e),c=u[0],l=u[1];if(a==="channelsLast")s=[c,l,r[3],r[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,l,r[1],r[1]]}return $r(r,s,t,n,i,o,!1,a)}function Fa(r,e,t,n,i,o,a){a===void 0&&(a="NDHWC");var s,u,c=oh(e),l=c[0],h=c[1],d=c[2];if(a==="NDHWC")u="channelsLast",s=[l,h,d,r[4],r[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,d,r[1],r[1]]}return Oa(r,s,t,n,i,!1,u,o)}function $r(r,e,t,n,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if(s==="channelsLast")c=r[0],l=r[1],h=r[2],d=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=r[0],d=r[1],l=r[2],h=r[3]}var f,p=e[0],m=e[1],g=e[3],v=Eu(t),x=v[0],w=v[1],b=Eu(n),y=b[0],_=b[1],S=So(p,y),C=So(m,_),E=function(B,O,V,z,U,H,K,et){var nt,st,ht;if(typeof B=="number"){nt={top:B,bottom:B,left:B,right:B,type:B===0?"VALID":"NUMBER"};var ft=function(Ct,Bt,At,ae,Zt){ae==null&&(ae=kh(Ct,Bt,At));var te=Ct[0],On=Ct[1],Nn=ka((te-Bt+2*ae)/At+1,Zt);M(ne(Nn),function(){return"The output # of rows ("+Nn+") must be an integer. Change the stride and/or zero pad parameters"});var sn=ka((On-Bt+2*ae)/At+1,Zt);return M(ne(sn),function(){return"The output # of columns ("+sn+") must be an integer. Change the stride and/or zero pad parameters"}),[Nn,sn]}([O,V],H,z,B,et);st=ft[0],ht=ft[1]}else if(B==="same"){st=Math.ceil(O/z),ht=Math.ceil(V/U);var pt=Math.max(0,(st-1)*z+H-O),St=Math.max(0,(ht-1)*U+K-V),_t=Math.floor(pt/2),Et=pt-_t,le=Math.floor(St/2);nt={top:_t,bottom:Et,left:le,right:St-le,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);nt={top:0,bottom:0,left:0,right:0,type:"VALID"},st=Math.ceil((O-H+1)/z),ht=Math.ceil((V-K+1)/U)}return{padInfo:nt,outHeight:st,outWidth:ht}}(i,l,h,x,w,S,C,o),I=E.padInfo,A=E.outHeight,R=E.outWidth,L=a?g*d:g;return s==="channelsFirst"?f=[c,L,A,R]:s==="channelsLast"&&(f=[c,A,R,L]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:A,outWidth:R,outChannels:L,padInfo:I,strideHeight:x,strideWidth:w,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:y,dilationWidth:_,inShape:r,outShape:f,filterShape:e}}function Oa(r,e,t,n,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],f=u[4];if(a==="channelsLast")c=r[0],l=r[1],h=r[2],d=r[3],f=r[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=r[0],f=r[1],l=r[2],h=r[3],d=r[4]}var p,m=e[0],g=e[1],v=e[2],x=e[4],w=oh(t),b=w[0],y=w[1],_=w[2],S=oh(n),C=S[0],E=S[1],I=S[2],A=So(m,C),R=So(g,E),L=So(v,I),B=function(K,et,nt,st,ht,ft,pt,St,_t,Et,le){var Ct,Bt,At,ae;if(typeof K=="number"){Ct={top:K,bottom:K,left:K,right:K,front:K,back:K,type:K===0?"VALID":"NUMBER"};var Zt=function(Yi,ar,rl,$i,Ln,il){Ln==null&&(Ln=kh(Yi,ar,$i));var mw=Yi[0],gw=Yi[1],vw=Yi[2],ol=ka((mw-ar+2*Ln)/$i+1,il);M(ne(ol),function(){return"The output # of depths ("+ol+") must be an integer. Change the stride and/or zero pad parameters"});var al=ka((gw-ar+2*Ln)/$i+1,il);M(ne(al),function(){return"The output # of rows ("+al+") must be an integer. Change the stride and/or zero pad parameters"});var sl=ka((vw-ar+2*Ln)/$i+1,il);return M(ne(sl),function(){return"The output # of columns ("+sl+") must be an integer. Change the stride and/or zero pad parameters"}),[ol,al,sl,rl]}([et,nt,st,1],St,1,ht,K,le);Bt=Zt[0],At=Zt[1],ae=Zt[2]}else if(K==="same"){Bt=Math.ceil(et/ht),At=Math.ceil(nt/ft),ae=Math.ceil(st/pt);var te=(Bt-1)*ht+St-et,On=(At-1)*ft+_t-nt,Nn=(ae-1)*pt+Et-st,sn=Math.floor(te/2),Ki=te-sn,ir=Math.floor(On/2),Or=On-ir,or=Math.floor(Nn/2);Ct={top:ir,bottom:Or,left:or,right:Nn-or,front:sn,back:Ki,type:"SAME"}}else{if(K!=="valid")throw Error("Unknown padding parameter: "+K);Ct={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Bt=Math.ceil((et-St+1)/ht),At=Math.ceil((nt-_t+1)/ft),ae=Math.ceil((st-Et+1)/pt)}return{padInfo:Ct,outDepth:Bt,outHeight:At,outWidth:ae}}(i,l,h,d,b,y,_,A,R,L,s),O=B.padInfo,V=B.outDepth,z=B.outHeight,U=B.outWidth,H=o?x*f:x;return a==="channelsFirst"?p=[c,H,V,z,U]:a==="channelsLast"&&(p=[c,V,z,U,H]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:d,inChannels:f,outDepth:V,outHeight:z,outWidth:U,outChannels:H,padInfo:O,strideDepth:b,strideHeight:y,strideWidth:_,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:L,dilationDepth:C,dilationHeight:E,dilationWidth:I,inShape:r,outShape:p,filterShape:e}}function kh(r,e,t,n){n===void 0&&(n=1);var i=So(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function Eu(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function oh(r){return typeof r=="number"?[r,r,r]:r}function So(r,e){return e<=1?r:r+(r-1)*(e-1)}function ka(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function ki(r){var e=Eu(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function Ge(r,e){return ki(r)||ki(e)}function Nu(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Ih(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Gt(r.shape),i=r.toFloat(),o=t.complex(i,n);return n.dispose(),i.dispose(),o}if(!Ag(r.dtype,e))return F.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var a=t.real(r);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(r);if(e==="bool"){var s=Z(0,r.dtype);return o=t.notEqual(r,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function ku(r,e){return F.makeTensorFromDataId(r.dataId,e,r.dtype)}function Mh(r,e,t){var n=(e-r)/(t-1),i=Do(t,"float32");i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return jt(i,"float32")}var zT=Object.freeze({castTensor:Ih,reshapeTensor:ku,linspaceImpl:Mh,upcastType:_e,axesAreInnerMostDims:bh,combineLocations:dv,computeOutAndReduceShapes:Re,expandShapeToKeepDim:He,assertAxesAreInnerMostDims:Qe,getAxesPermutation:Mn,getUndoAxesPermutation:Du,getInnerMostAxes:Rn,getBroadcastDims:gr,getReductionAxes:pe,assertAndGetBroadcastShape:yt,assertParamsConsistent:fv,computeOutShape:Ei,computePool2DInfo:Ro,computePool3DInfo:Fa,computeConv2DInfo:$r,computeConv3DInfo:Oa,computeDefaultPad:kh,tupleValuesAreOne:ki,eitherStridesOrDilationsAreOne:Ge,convertConv2DDataFormat:Nu,PARALLELIZE_THRESHOLD:Ch,computeOptimalWindowSize:du});function ah(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function jm(r,e){return{real:r[2*e],imag:r[2*e+1]}}function $_(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function J_(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function Q_(r,e,t){var n=function(o,a,s){return function(u,c,l){for(var h=0,d=u.length,f=0,p=!1;h<d;){var m=l(c,u[f=h+(d-h>>>1)]);m>0?h=f+1:(d=f,p=!m)}return p?h:-h-1}(o,a,s||Z_)}(r,e,t),i=n<0?-(n+1):n;r.splice(i,0,e)}function Z_(r,e){return r>e?1:r<e?-1:0}function Rh(r,e,t,n,i){return Rv(r,e,t,n,i,0).selectedIndices}function Ah(r,e,t,n,i,o){var a=Rv(r,e,t,n,i,o,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function Rv(r,e,t,n,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s=!1);for(var u=Array.from(e).map(function(b,y){return{score:b,boxIndex:y,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(Hm),c=o>0?-.5/o:0,l=[],h=[];l.length<t&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<i)break;for(var g=!1,v=l.length-1;v>=m;--v){var x=t2(r,p,l[v]);if(x>=n){g=!0;break}if(d.score=d.score*e2(n,c,x),d.score<=i)break}d.suppressBeginIndex=l.length,g||(d.score===f?(l.push(p),h.push(d.score)):d.score>i&&Q_(u,d,Hm))}var w=l.length;return s&&(l.fill(0,w),h.fill(0,w)),{selectedIndices:jt(l,"int32"),selectedScores:jt(h,"float32"),numValidOutputs:Z(w,"int32")}}function t2(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),o=Math.min(n[0],n[2]),a=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),f=(s-o)*(u-a),p=(h-c)*(d-l);if(f<=0||p<=0)return 0;var m=Math.max(o,c),g=Math.max(a,l),v=Math.min(s,h),x=Math.min(u,d),w=Math.max(v-m,0)*Math.max(x-g,0);return w/(f+p-w)}function e2(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function Hm(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function Av(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map(function(o){i[t]=o;var a=r.slice(n,i);return n[t]+=o,a})}function Dv(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=mt(t,r.dtype);for(n=0;n<i.values.length;++n){for(var o=i.indexToLoc(n),a=new Array(r.rank),s=0;s<a.length;s++)a[s]=o[s]%r.shape[s];var u=r.locToIndex(a);i.values[n]=r.values[u]}return i.toTensor()}function Tv(r,e,t,n,i){for(var o=e[e.length-1],a=[r.length/o,o],s=a[0],u=a[1],c=Mo(t,s*n),l=Mo("int32",s*n),h=0;h<s;h++){for(var d=h*u,f=r.subarray(d,d+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(b,y){return y.value-b.value});var g=h*n,v=c.subarray(g,g+n),x=l.subarray(g,g+n);for(m=0;m<n;m++)v[m]=p[m].value,x[m]=p[m].index}var w=e.slice();return w[w.length-1]=n,[Ce(c,w,t),Ce(l,w,"int32")]}function Dh(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=mt(r,"int32"),o=mt([t.length,r.length],"int32");for(n=0;n<t.length;n++){var a=i.indexToLoc(t[n]),s=n*r.length;o.values.set(a,s)}return o.toTensor()}var n2=function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},r2=function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},i2=function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,o=r.inSize,a=Math.ceil(o/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Pv(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function Ze(r,e){return e===1?[r]:Pv(r,e)}function Be(){var r,e,t,n,i,o,a,s,u,c;return j().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function yi(r,e,t){t===void 0&&(t="index");var n=En(e);return n.map(function(i,o){return"int "+r[o]+" = "+t+" / "+i+"; "+(o===n.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+i:"index -= "+r[o]+" * "+i)+";"}).join("")}function Th(r){var e=En(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Fv=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function o2(r,e,t,n){var i=[];r.forEach(function(f){var p=at(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,a,s=i.join(`
`),u=r.map(function(f){return function(p,m,g){g===void 0&&(g=!1);var v="";v+=g?Ov(p):yo(p);var x=p.shapeInfo.logicalShape,w=m.logicalShape;return x.length<=w.length&&(v+=g?function(b,y){var _,S=b.name,C=S.charAt(0).toUpperCase()+S.slice(1),E="get"+C+"AtOutCoords",I=b.shapeInfo.logicalShape.length,A=y.logicalShape.length,R=gr(b.shapeInfo.logicalShape,y.logicalShape),L=qt(A),B=A-I,O=["x","y","z","w","u","v"];_=I===0?"":A<2&&R.length>=1?"coords = 0;":R.map(function(nt){return"coords."+O[nt+B]+" = 0;"}).join(`
`);var V="";V=A<2&&I>0?"coords":b.shapeInfo.logicalShape.map(function(nt,st){return"coords."+O[st+B]}).join(", ");var z="return outputValue;",U=at(b.shapeInfo.logicalShape)===1,H=at(y.logicalShape)===1;if(I!==1||U||H){if(U&&!H)z=A===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(R.length){var K=I-2,et=I-1;R.indexOf(K)>-1&&R.indexOf(et)>-1?z="return vec4(outputValue.x);":R.indexOf(K)>-1?z="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":R.indexOf(et)>-1&&(z="return vec4(outputValue.xx, outputValue.zz);")}}else z=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+E+`() {
      `+L+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+C+"("+V+`);
      `+z+`
    }
  `}(p,m):function(b,y){var _=b.name,S=_.charAt(0).toUpperCase()+_.slice(1),C="get"+S+"AtOutCoords",E=y.texShape,I=b.shapeInfo.texShape,A=b.shapeInfo.logicalShape.length,R=y.logicalShape.length;if(!b.shapeInfo.isUniform&&A===R&&b.shapeInfo.flatOffset==null&&fe(I,E))return`
      float `+C+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var L,B=qt(R),O=gr(b.shapeInfo.logicalShape,y.logicalShape),V=R-A,z=["x","y","z","w","u","v"];L=A===0?"":R<2&&O.length>=1?"coords = 0;":O.map(function(H){return"coords."+z[H+V]+" = 0;"}).join(`
`);var U="";return U=R<2&&A>0?"coords":b.shapeInfo.logicalShape.map(function(H,K){return"coords."+z[K+V]}).join(", "),`
    float `+C+`() {
      `+B+` coords = getOutputCoords();
      `+L+`
      return get`+S+"("+U+`);
    }
  `}(p,m)),v}(f,e,n)}).join(`
`),c=e.texShape,l=Be(),h=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(l),d=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+a2+`
    `+s2+`
    `+u2+`
  `}(l);return e.isPacked?(o=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,y){var _=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,y){var _=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)];if(fe(b,y))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var S=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=f,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],x=Math.ceil(m[2]/2),w=x*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+w+`;
      index -= b * `+w+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,y){for(var _=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],S=Math.ceil(b[b.length-1]/2),C=S*Math.ceil(b[b.length-2]/2),E=C,I="",A="b, r, c",R=2;R<b.length-1;R++)E*=b[b.length-R-1],I=`
      int b`+R+" = index / "+E+`;
      index -= b`+R+" * "+E+`;
    `+I,A="b"+R+", "+A;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+I+`

      int b = index / `+C+`;
      index -= b * `+C+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+b.length+"("+A+`);
    }
  `}(f,p)}var m,g,v,x,w}(e.logicalShape,c),a=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(l)):(o=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,x){return fe(v,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=p,g=yi(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,x){var w=yi(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+w+`
      return ivec4(r, c, d, d2);
    }
  `}(f,p);case 5:return function(v,x){var w=yi(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+w+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,p);case 6:return function(v,x){var w=yi(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+w+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var m,g}(e.logicalShape,c),a=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),n&&(d+=c2),[d,h,a,s,o,u,t].join(`
`)}function yo(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,c=u[0],l=u[1],h=gi(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+h+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+vo(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=gi(n);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&fe(n,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var c=Gr(n),l=c.newShape,h=c.keptDims,d=l;if(d.length<n.length){var f=wo(t,d);return`
      `+yo(f)+`
      float `+o+`(int row, int col) {
        return `+o+"("+_o(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+vo(t)+`
      }
    `;var p=a[0],m=a[1],g=gi(i);return m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(r);case 3:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],s=n[2],u=Gr(n),c=u.newShape,l=u.keptDims,h=c;if(h.length<n.length){var d=wo(t,h);return`
        `+yo(d)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+_o(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+vo(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],m=f[1],g=t.shapeInfo.flatOffset;if(m===a&&g==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(m===s&&g==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var v=gi(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(r);case 4:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],s=n[2]*a,u=n[1]*s,c=Gr(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var d=wo(t,l);return`
      `+yo(d)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+_o(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+vo(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],g=p[1];if(g===u&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===a&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var v=gi(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+v+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 5:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[4],s=n[3]*a,u=n[2]*s,c=n[1]*u,l=Gr(n),h=l.newShape,d=l.keptDims;if(h.length<n.length){var f=wo(t,h);return`
      `+yo(f)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+_o(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+vo(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],v=m[1];if(v===c&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=gi(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 6:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Gr(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var c=wo(t,s);return`
      `+yo(c)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+_o(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=n[5],h=n[4]*l,d=n[3]*h,f=n[2]*d,p=n[1]*f;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+d+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+vo(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,v=g[0],x=g[1];if(x===p&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+d+", "+h+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===l&&m==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var w=gi(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+d+` +
          depth2 * `+h+" + depth3 * "+l+" + depth4 + "+w+`;
      vec2 uv = uvFromFlat(`+v+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Ov(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Be(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Be();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+o+`, uv);
    }
  `}(r);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=u[0],l=u[1],h=Be();if(u!=null&&fe(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],f=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+d[0]+", "+d[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `}(r);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var l=o.slice(1),h=wo(i,l);return`
        `+Ov(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+_o(["b","row","col"],[1,2])+`);
        }
      `}var d=c[0],f=c[1],p=Math.ceil(o[2]/2),m=p*Math.ceil(o[1]/2),g=Be();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+f+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+a+`, uv);
    }
  `}(r);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=i.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],h=l[0],d=l[1],f=Math.ceil(o[a-1]/2),p=f*Math.ceil(o[a-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+f+" + (col / 2)",v=2;v<a-1;v++)m="int b"+v+", "+m,p*=o[a-v-1],g="b"+v+" * "+p+" + "+g;var x=Be();return`
    vec4 `+u+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `}(r)}}var a2=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,s2=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,u2=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,c2=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function gi(r){return"offset"+r}function vo(r){var e=r.name,t=at(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function qt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function wo(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function _o(r,e){return e.map(function(t){return r[t]}).join(", ")}var l2=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,M(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],o=Math.ceil(i/e);this.outputShape=r.slice(0,-1),o>1&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=qt(c),h=Ze("coords",c);if(o===1){var d=qt(s=c+1);a=`
        `+d+" sourceLocR = "+d+"("+h.join()+`, 0);
        ++`+h[c-1]+`;
        `+d+" sourceLocG = "+d+"("+h.join()+`, 0);
        ++`+h[c-2]+`;
        `+d+" sourceLocA = "+d+"("+h.join()+`, 0);
        --`+h[c-1]+`;
        `+d+" sourceLocB = "+d+"("+h.join()+`, 0);
        --`+h[c-2]+";"}else s=c,a=`
        `+l+` sourceLocR = coords;
        ++`+h[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+h[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+h[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+h[c-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(C){return"int "+C}),g=Ze("sourceLocR",s-1).concat("inIdx.r"),v=Ze("sourceLocG",s-1).concat("inIdx.g"),x=Ze("sourceLocB",s-1).concat("inIdx.b"),w=Ze("sourceLocA",s-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",y=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",_=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",S=n?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+h[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+h[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+y+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},h2=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,c=s-1-r.padInfo.top,l=u-1-r.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},d2=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=l-1-r.padInfo.front,p=h-1-r.padInfo.top,m=d-1-r.padInfo.left,g=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},f2=function(r,e,t,n,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],yt(r,e),yt(r,t);var a="0.0";n!=null&&(yt(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(yt(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},p2=function(r,e,t,n,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],yt(r,e),yt(r,t);var a="vec4(0.0)";n!=null&&(yt(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(yt(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},m2="return areal * breal - aimag * bimag;",g2="return areal * bimag + aimag * breal;",Gm=function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=yt(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Ml="return a + b;",Rl="return a - b;",qm="return a * b;",Nv="return (a < 0.) ? b * a : a;",ue=function(r,e,t){this.variableNames=["A","B"],this.outputShape=yt(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Lv=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,pr=function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=yt(e,t);var i=this.outputShape.length,o="";if(n)if(i===0||at(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+qt(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Ze("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},v2=function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),x2=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),b2=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},y2=function(r){this.outputShape=[],this.outputShape=Ei(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},w2=function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ei(r,e);var t=this.outputShape,n=t.length,i=qt(n),o=Ze("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(g,v){return"T"+v});var s=new Array(r.length-1);s[0]=r[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][e];var c=a[e],l=a.slice(-2),h=a.join(),d="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var f=s[u-1];d+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Zs(a,c,f)+`),
            vec2(`+Zs(l,c,f)+`));
        }`}var p=s.length,m=s[s.length-1];d+=`
        return getChannel(
          getT`+p+"("+Zs(a,c,m)+`),
          vec2(`+Zs(l,c,m)+"));",this.userCode=`
      float getValue(`+a.map(function(g){return"int "+g})+`) {
        `+d+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[n-1]+" = "+o[n-1]+` + 1;
        if (`+o[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[n-2]+" = "+o[n-2]+` + 1;
        if (`+o[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[n-1]+" = "+o[n-1]+` - 1;
        if (`+o[n-2]+" < "+t[n-2]+` &&
            `+o[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Zs(r,e,t){var n=r.indexOf(e);return r.map(function(i,o){return o===n?i+" - "+t:i}).join()}var _2=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},C2=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dataFormat==="channelsLast",a=e-1-r.padInfo.top,s=t-1-r.padInfo.left,u=o?1:2,c=o?2:3,l=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},S2=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,o=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+a+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},E2=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=e-1-r.padInfo.front,u=t-1-r.padInfo.top,c=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},k2=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},I2=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=e-1-r.padInfo.top,a=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Xm=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,o=r.padInfo.left,a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterHeight,h=r.filterWidth,d=4*Math.floor(r.inChannels/4),f=r.inChannels%4,p=r.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,v=p?3:1,x="",w="";t&&(x=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,w="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+w+`
        setOutput(result);
      }
    `},M2=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterDepth,h=r.filterHeight,d=r.filterWidth,f=4*Math.floor(r.inChannels/4),p=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Km=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,d=r.filterHeight,f=r.filterWidth,p=r.outChannels/r.inChannels,m="",g="";t&&(m=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,g="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+g+`
        setOutput(result);
      }
    `},Ym=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,h=r.dilationWidth,d=r.filterHeight,f=r.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<f;v++)m+=`
          vec4 xTexelR`+g+"C"+2*v+` = vec4(0.);
          vec4 wR`+g+"C"+v+` = vec4(0.);
          vec4 xR`+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var x=0;x<p;x++){if(m+=`
          xR = xRCorner + `+g*l+`;
          xC = xCCorner + `+(v=2*x)*h+`;
        `,c===1){if(v<f&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+g+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+`.xy);
                } else {
                  xR`+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xR`+g+"C"+v+" = xTexelR"+g+"C"+v+`;
              `,v+1<f)){var w=s%2==0?dh(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+`;
                `}}else v<f&&(m+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
              `,v+1<f&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+`.xy);
              `,v+1<f&&(m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
                `)),m+="}");v<f&&(m+=`
            vec4 wTexelR`+g+"C"+v+" = getW("+g+", "+v+`, d1, q);
            wR`+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+`.xz);
          `,v+1<f&&(m+=`
              vec4 wTexelR`+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+`, d1, q);
              wR`+g+"C"+(v+1)+` =
                vec4(wTexelR`+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var b="",y="";t&&(b=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,y="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+_+`
        `+y+`
        setOutput(result);
      }
    `},R2=function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=r[0],a=r[1],s=r[2],u=r[3],c=e[0],l=t[0],h=t[1];this.outputShape=[c,l,h,u];var d=n==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],p=f[0],m=f[1],g=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],x=g[1],w=g[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],y=b[0],_=b[1],S=b[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+y+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+_+`;

        float in_y = `+w+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},A2=function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+qt(n)+` coords = getOutputCoords();
        int end = `+$m(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+$m(n,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function $m(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var D2=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Aa.DENSE;var e=Ea(r),t=Be();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+yi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},T2=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Aa.DENSE;var e=Ea(r),t=Be();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+yi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},P2=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),F2=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},O2=function(r){this.variableNames=["A"],this.outTexUsage=cn.DOWNLOAD;var e=Be();this.outputShape=r,this.userCode=`
      `+Fv+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},N2=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=cn.DOWNLOAD;var e=Be();this.outputShape=r,this.userCode=`
      `+Fv+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},L2=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=Be(),i=e[0],o=e[1];this.outputShape=r;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Th(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},B2=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Be(),i=e[0],o=e[1];this.outputShape=r;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+r[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Th(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+n.output+" = "+s+`;
      }
    `},W2="return real * expR - imag * expI;",z2="return real * expI + imag * expR;",Jm=function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},V2=function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r}(),U2=function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=qt(this.rank),o=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],h=0;h<a.length;h++)h===s?l.push("int(getIndices("+c[h]+"))"):l.push(""+c[h]);return l.join()}(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},j2=function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=qt(e.length),i=qt(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Bv(r,e){var t=Be();return jg(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Wv(r,e){return Xg(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function zv(r,e){return Kg(r,e,new Uint16Array([0,1,2,2,1,3]))}function Ba(r,e,t,n,i,o,a){$g(t,n);var s=Yg(r,e),u=r.TEXTURE_2D;return rt(r,e,function(){return r.bindTexture(u,s)}),rt(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),rt(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),rt(r,e,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),rt(r,e,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),rt(r,e,function(){return r.texImage2D(u,0,i,t,n,0,o,a,null)}),rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function Vv(r,e,t,n,i){var o=Au(t,n);return Ba(r,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function Uv(r,e,t,n,i){var o=Au(t,n);return Ba(r,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function jv(r,e,t,n,i){var o=Au(t,n);return Ba(r,e,o[0],o[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function Hv(r,e,t,n,i){var o=La(t,n);return Ba(r,e,o[0],o[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function Gv(r,e,t,n,i){var o=La(t,n);return Ba(r,e,o[0],o[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function qv(r,e,t,n){return rt(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Zl(r,e,t,"clipSpacePos",n,3,20,0)&&Zl(r,e,t,"uv",n,2,20,12)}function Xv(r,e,t,n,i,o,a){var s,u,c;rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(n*i*4),u=r.UNSIGNED_BYTE,c=r.RGBA):(s=new Float32Array(n*i*4),u=r.FLOAT,c=a.internalFormatPackedFloat),s.set(o),rt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,c,n,i,0,r.RGBA,u,s)}),rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Kv(r,e,t,n){rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?rt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):rt(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),rt(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Yv(r,e,t,n,i){var o=r.createBuffer();rt(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,o)});var a=16*t*n;return rt(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)}),rt(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),rt(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),o}function $v(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function Jv(r,e,t,n,i){var o=Au(t,n),a=o[0],s=o[1],u=new Uint8Array(t*n*4);return rt(r,e,function(){return r.readPixels(0,0,a,s,i.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Qv(r,e,t,n,i,o,a,s){var u=r,c=new Float32Array(function(l,h){var d=La(l,h);return d[0]*d[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Zv(r,e,t,n){var i=new Float32Array(t*n*4);return rt(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)}),i}var H2=Object.freeze({createVertexShader:Bv,createVertexBuffer:Wv,createIndexBuffer:zv,createFloat32MatrixTexture:Vv,createFloat16MatrixTexture:Uv,createUnsignedBytesMatrixTexture:jv,createPackedMatrixTexture:Hv,createFloat16PackedMatrixTexture:Gv,bindVertexProgramAttributeStreams:qv,uploadDenseMatrixToTexture:Xv,uploadPixelDataToTexture:Kv,createBufferFromOutputTexture:Yv,downloadFloat32MatrixFromBuffer:$v,downloadByteEncodedFloatMatrixFromOutputTexture:Jv,downloadPackedMatrixFromBuffer:Qv,downloadMatrixFromPackedOutputTexture:Zv}),t0=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=j().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,zg(t,e)):this.gl=Kn(t);var n="WEBGL_color_buffer_float";if(j().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=_a(this.gl,this.debug,"OES_texture_float"),ln(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=_a(this.gl,this.debug,"OES_texture_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ln(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=_a(this.gl,this.debug,"EXT_color_buffer_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ln(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ln(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Wv(this.gl,this.debug),this.indexBuffer=zv(this.gl,this.debug),this.framebuffer=Jg(this.gl,this.debug),this.textureConfig=xh(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return j().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;rt(t,this.debug,function(){return t.finish()}),rt(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),rt(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),rt(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),rt(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),rt(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Vv(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Uv(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),jv(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Kv(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),Xv(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Gv(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Hv(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(th(this.gl,this.debug,this.framebuffer),this.outputTexture=null),rt(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return Jv(i.gl,i.debug,t,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,o,a){return Qv(this.gl,e,0,0,0,o,a,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return $v(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=Yv(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(j().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return Zv(i.gl,i.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Hg(t,this.debug,e),i=Bv(t,this.debug),o=Gg(t,this.debug);return rt(t,this.debug,function(){return t.attachShader(o,i)}),rt(t,this.debug,function(){return t.attachShader(o,n)}),qg(t,this.debug,o),this.debug&&cu(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=qv(t,this.debug,this.program,this.vertexBuffer)),o},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&rt(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&cu(this.gl,this.debug,this.program),rt(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?Zg(this.gl,this.debug,e,t):tv(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),rt(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),ev(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=La(t,n),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&cu(this.gl,this.debug,this.program),Ca(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),rt(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),rt(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=_a(this.gl,this.debug,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},r.prototype.endQuery=function(){if(j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return it(this,void 0,void 0,function(){var t=this;return ot(this,function(n){switch(n.label){case 0:return[4,ql(function(){return t.disposed||t.isQueryAvailable(e,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=function(n){for(var i=0;i<n.length&&n[i]();++i);return i-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ql(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),lu(this.gl,this.debug,e,this.framebuffer),this.debug&&Ca(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(lu(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ca(this.gl)):th(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;lu(i,this.debug,e,this.framebuffer),this.debug&&Ca(i),this.outputTexture=e,rt(i,this.debug,function(){return i.viewport(0,0,t,n)}),rt(i,this.debug,function(){return i.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var o=this;this.throwIfDisposed(),rt(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function Qm(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var i=t.logicalShape,o=e[n],a=o.shape;if(!fe(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!fe(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var G2=function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,h=t.dataFormat,d=s.left,f=s.top,p=i*n,m=Be(),g=h==="channelsLast",v=g?0:1,x=g?1:2,w="",b=0;b<=1;b++)for(var y=0;y<=1;y++)w+=`
          blockIndex = rc.y + `+y+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+d+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+y)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+y)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+w+`

        `+m.output+` = result;
      }
    `},q2=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},X2=function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},K2=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},Y2=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,o=r.effectiveFilterWidth,a=i-1-r.padInfo.top,s=o-1-r.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},$2=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=s-1-r.padInfo.front,h=u-1-r.padInfo.top,d=c-1-r.padInfo.left,f=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+h+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Al=function(r,e,t,n,i,o,a){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?r[1]:r[2],u=Math.ceil(s/2),c=t?"i * 2, rc.y":"rc.y, i * 2",l=n?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";o&&(f=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+d[0]+`);
          result += (`+h[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},J2=function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r}(),Q2=function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},Z2=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Ze("rc",e),n=qt(e),i=function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",h=s-2;h<s;h++)l+=c[h]+" >= "+u[h],h<s-1&&(l+="||");return l}(e,r,t),o=function(s,u,c,l){if(s===1)return"";var h=l.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(e,r[r.length-1],r[r.length-2],t),a=function(s,u){var c=s.length,l=function(h,d){for(var f=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<h;v++)g=d[d.length-1-v]+","+g;f.push(g)}return f}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},tC=function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,c){return u[0]+r[c]+u[1]});var n=r.length,i=qt(n),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,c){return u[0]+r[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},eC=function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(g,v){return g[0]+r[v]+g[1]});for(var n=r.length,i=qt(n),o=e.map(function(g){return g[0]}).join(","),a=e.map(function(g,v){return g[0]+r[v]}).join(","),s=Ze("rc",n),u=Ze("source",n),c=s[n-1]+" < "+this.outputShape[n-1],l=n===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+c+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+c+") {"],d=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=n===1?2:4;p<m;p++)f+=`
        `+h[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;f+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},Dl=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=r.padInfo.top,h=r.padInfo.left;this.outputShape=r.outShape;var d=e==="avg",f="0.0";if(d||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+l+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var m=4*Math.floor(n/4),g=n%4,v=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+l+", "+h+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},Tl=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.front,p=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var g=e==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+a+`);
        const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+h+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+h+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var w=4*Math.floor(n/4),b=n%4,y=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+w+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+y+`
            }

            int xC = xCCorner + `+w+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+y+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+y+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+y+`
            }
          }
          setOutput(`+x+`);
        }
      }
    `}},nC=function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=Math.ceil(i/t);this.outputShape=[n,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(l===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(l===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},rC=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+yi(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Th(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},iC=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],c=[t&&s>1?i-1:i,t&&u>1?o-1:o],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},oC=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},aC=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},sC=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],c=[t&&s>1?i-1:i,t&&u>1?o-1:o],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},uC=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],c=[n&&e>1?e-1:e,n&&t>1?t-1:t],l=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},cC=function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(o,a){return function(s){return e.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=qt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},lC=function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=Ze("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],o=n[t-2]+" + 1 < "+this.outputShape[t-2],a=qt(t);function s(u){var c=r.map(function(l,h){return function(d,f){return e.indexOf(d)!==-1&&r[d]!==1?r[d]+" - "+f[d]+" - 1":""+f[d]}(h,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(n.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)}(n.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)}(n.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Zm=function(r,e,t,n,i,o,a){a===void 0&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=qt(i.length),u=qt(o.length),c="";t===1?c="i":t===2&&(c="i, j");var l="getIndices("+c+")",h="";n===1?h="i":n===2&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},hC=function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=r.numSegments,a=o*Math.ceil(i/t);this.outputShape=[n,a];var s=4*Math.floor(t/4),u=t%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";i%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},dC=function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<r&&a.push(""+o[u]);n=a.join(),i=s.join()}var c=qt(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},fC=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=qt(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return Pl.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+Pl[s]+" = start["+s+"] + coords."+Pl[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),Pl=["x","y","z","w","u","v"],pC=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=qt(this.rank),n=Ze("coords",this.rank),i=Ze("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(l,h){return"start["+h+"]"}).join()+");":e.map(function(l,h){return i[h]+" = "+n[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),mC=function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,i=qt(t.length),o=qt(t.length),a="";if(n===1)a="coords * strides + begin";else{var s=0;a=t.map(function(u,c){return s++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},gC=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,o=tg(t,n),a=eg(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===un.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===un.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===un.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var o=eg(t,tg(n,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function tg(r,e){if(r===cn.UPLOAD)return un.PACKED_2X2_FLOAT32;if(r===cn.RENDER||r==null)return function(t){return j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?un.PACKED_2X2_FLOAT32:un.UNPACKED_FLOAT32:t?un.PACKED_2X2_FLOAT16:un.UNPACKED_FLOAT16}(e);if(r===cn.DOWNLOAD||r===cn.PIXELS)return un.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function eg(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var vC=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=qt(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},xC=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=qt(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},bC=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=qt(this.rank),o=Pv("rc",this.rank),a=new Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=o[n];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},Ph=1.7580993408473768,Fh=1.0507009873554805,xt=function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},An="if (isnan(x)) return x;",yC="return x;",ng="return abs(x);",e0=An+`
  return (x < 0.0) ? 0.0 : x;
`,n0=An+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,r0="return (x >= 0.0) ? x : (exp(x) - 1.0);",wC=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Ph+`;
  float scale = `+Fh+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,rg="return -x;",ig="return ceil(x);",og="return floor(x);",ag="return exp(x);",sg="return exp(x) - 1.0;",_C=An+`
  return sin(x);
`,CC=An+`
  return cos(x);
`,SC=An+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,EC=An+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,kC=An+`
  return atan(x);
`,IC=An+"return log(x + sqrt(x * x + 1.0));",MC=An+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,RC=An+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,tu="return x;",AC="return x;",i0=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,o0=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,a0=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,wa=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},DC=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=Ze("rc",e),n=qt(e),i=function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},eu={};function nu(r,e){if(e===void 0&&(e=!1),r==="linear")return e?AC:yC;if(r==="relu")return e?i0:e0;if(r==="elu")return e?a0:r0;if(r==="relu6")return e?o0:n0;if(r==="prelu")return e?Lv:Nv;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var TC=600,s0=function(r){function e(t){var n,i=r.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!j().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=Kn(j().getNumber("WEBGL_VERSION"));i.binaryCache=((n=j().getNumber("WEBGL_VERSION"))in eu||(eu[n]={}),eu[n]),i.gpgpu=new t0(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new gC(i.gpgpu),i.numMBBeforeWarning=j().global.screen==null?1024:j().global.screen.height*j().global.screen.width*window.devicePixelRatio*TC/1024/1024,i.texData=new Iv(i,F),i}return In(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,n,i){if(j().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:n,dtype:i,values:t,usage:cn.UPLOAD}),o},e.prototype.move=function(t,n,i,o){if(j().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:n,usage:cn.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),i=n.values,o=n.dtype,a=n.complexTensors,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;l=c?new wa(u,tu):new xt(u,tu);var h=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:o}],o),d=this.readSync(h.dataId);return this.disposeData(h.dataId),d}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var f,p,m=this.activeTimers!=null;return m&&(f=Sn()),o==="complex64"?p=ah(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(t),m&&(this.downloadWaitMs+=Sn()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return it(this,void 0,void 0,function(){var n,i,o,a,s,u,c,l,h,d,f,p,m,g,v,x,w,b,y,_,S,C;return ot(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(I){return n.push(I)})];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,u=i.dtype,c=i.complexTensors,l=i.isPacked,s!=null)return h=void 0,h=l?new wa(a,tu):new xt(a,tu),d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),f=this.read(d.dataId),this.disposeData(d.dataId),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&j().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&j().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,[g.texture].concat(Ea(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return x=E.sent(),w=x[0],b=x[1],v=ah(w,b),[3,5];case 4:p==null?v=this.getValuesFromTexture(t):(y=at(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,y)),E.label=5;case 5:return m!=null&&this.disposeData(m.dataId),_=this.convertAndCacheOnCPU(t,v),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach(function(I){return I(_)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var i=t[n];if(!Vg(i))throw j().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,u=at(o);if(j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),h=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[l.texture].concat(Ea(o))).subarray(0,u);return this.disposeData(c.dataId),h}var d=j().getBool("WEBGL_PACK")&&s===!0,f=d?hu(o):o,p=d?new N2(f):new O2(f),m=this.runWebGLProgram(p,[{shape:f,dtype:a,dataId:t}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),v},e.prototype.time=function(t){return it(this,void 0,void 0,function(){var n,i,o,a,s,u,c;return ot(this,function(l){switch(l.label){case 0:return n=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=vr(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),s=vr(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=n,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=Eg(c),u.getExtraProfileInfo=function(){return c.map(function(h,d){return{name:s[d],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Sn(),endMs:null}},e.prototype.endTimer=function(t){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Sn(),t)},e.prototype.getQueryTime=function(t){return it(this,void 0,void 0,function(){var n;return ot(this,function(i){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),i=n.texture,o=n.dtype,a=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,h=this.dataRefCount.get(l);h>1?this.dataRefCount.set(l,h-1):(this.dataRefCount.delete(l),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return j().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=F.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:F.keep(t.clone()),imag:F.keep(n.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,i);if(at(i)===0)return Ce([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=Sh(t.shape,n,i);if(o||!a){var s=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pC(i):new fC(i),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,i)},e.prototype.shallowSlice=function(t,n,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var u=Eh(n,t.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},e.prototype.stridedSlice=function(t,n,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,i,o);var a=Fu(n,i,o);if(a.some(function(u){return u===0}))return Ce([],a);var s=new mC(n,o,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,n){var i=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lC(t.shape,n):new cC(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var i=t.map(function(f){return vn(f)}),o=t.map(function(f){return Gn(f)});return Me(this.concat(i,n),this.concat(o,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>j().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),n),u=this.concat(t.slice(a),n);return this.concat([s,u],n)}if(j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new w2(t.map(function(f){return f.shape}),n);return this.compileAndRun(c,t)}var l=Ei(t.map(function(f){return f.shape}),n),h=t.map(function(f){return f.as2D(-1,at(f.shape.slice(n)))}),d=new y2(h.map(function(f){return f.shape}));return this.compileAndRun(d,h).reshape(l)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rg,t.dtype);var n=new xt(t.shape,rg);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,i,o){var a=i?t.shape[2]:t.shape[1],s=o?n.shape[1]:n.shape[2],u=i?t.shape[1]:t.shape[2],c=t.shape[0];if((a===1||s===1)&&u>1e3){i&&(t=t.transpose([0,2,1])),o&&(n=n.transpose([0,2,1]));var l=s===1?t:t.as3D(c,u,1),h=s===1?2:1,d=s===1?n.as3D(c,1,u):n;return this.multiply(l,d).sum(h,!0)}var f=_e(t.dtype,n.dtype),p=new Al(t.shape,[c,a,s],i,o);return this.compileAndRun(p,[t,n],f)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=o?n.shape[2]:n.shape[1],h=a?i.shape[1]:i.shape[2],d=n.shape[0],f=_e(n.dtype,i.dtype),p=s!=null,m=c!=null,g=u?nu(u,!0):null,v=new Al(n.shape,[d,l,h],o,a,p,g,m),x=[n,i];return s&&x.push(s),c&&x.push(c),this.compileAndRun(v,x,f)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(n.dataId),a=new Gm(m2,t.shape,n.shape),s=new Gm(g2,t.shape,n.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),h=this.complex(c,l);return c.dispose(),l.dispose(),h}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,qm,t.dtype);var d=new ue(qm,t.shape,n.shape);return this.compileAndRun(d,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,i,o,a,s){var u=[t,n,i],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(a!=null&&(l=a.shape,u.push(a)),j().getBool("WEBGL_PACK_NORMALIZATION")){var h=new p2(t.shape,n.shape,i.shape,c,l,o);return this.compileAndRun(h,u)}var d=new f2(t.shape,n.shape,i.shape,c,l,o);return this.compileAndRun(d,u)},e.prototype.localResponseNormalization4D=function(t,n,i,o,a){var s=j().getBool("WEBGL_PACK_NORMALIZATION")?new K2(t.shape,n,i,o,a):new q2(t.shape,n,i,o,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,n,i,o,a,s,u){var c=new X2(n.shape,o,a,s,u);return this.compileAndRun(c,[n,i,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(a){return Ma(a)});return Dv(mt(t.shape,t.dtype,i),n)}var o=new vC(t.shape,n);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,n,i){var o=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eC(t.shape,n,i):new tC(t.shape,n,i);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,n);var i=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bC(t.shape,n):new xC(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,n,i){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,i);var o=new U2(t.shape,n.size,i);return this.compileAndRun(o,[t,n])},e.prototype.batchToSpaceND=function(t,n,i){M(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=n.reduce(function(h,d){return h*d}),a=_u(t.shape,n,o),s=Cu(a.length,n.length),u=Su(t.shape,n,o),c=yv(i,n.length),l=wv(u,i,n.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,n,i){M(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=n.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=_u(u.shape,n,o,!1),l=Cu(c.length,n.length,!1),h=Su(u.shape,n,o,!1);return u.reshape(c).transpose(l).reshape(h)},e.prototype.reduce=function(t,n,i){var o=t.shape[0],a=t.shape[1],s=du(a),u=new nC({windowSize:s,inSize:a,batchSize:o},n),c=this.compileAndRun(u,[t],i);return c.shape[1]===1?c:this.reduce(c,n,i)},e.prototype.argReduce=function(t,n,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=du(a),u=new i2({windowSize:s,inSize:a,batchSize:o},n,i==null),c=[t];i!=null&&c.push(i);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(t,n,l)},e.prototype.argReducePacked=function(t,n,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=du(o[o.length-1]),s=new l2(o,a,n,i==null),u=i==null?[t]:[t,i],c=this.compileAndRun(s,u,"int32");return c.rank===t.rank?this.argReducePacked(t,n,c):c},e.prototype.sum=function(t,n){Qe("sum",n,t.rank);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a),u=El(t.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a),u=El(t.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,n,i){var o=0,a=Mn([o],t.rank),s=t;a!=null&&(s=t.transpose(a),o=Rn(1,t.rank)[0]);var u=function(f,p,m){for(var g=[],v=f.length,x=0;x<v;x++)x!==p?g.push(f[x]):g.push(m);return g}(s.shape,o,i),c=at([s.shape[o]]),l=s.as2D(-1,c),h=El(t.dtype),d=this.segOpCompute(l,"unsortedSegmentSum",n,h,i).reshape(u);return a!=null&&(d=d.transpose(Du(a))),d},e.prototype.segOpCompute=function(t,n,i,o,a){var s=t.shape[0],u=t.shape[1],c=function(d,f){var p,m=!1;for(d<=Ch?(p=d,m=!0):p=xu(d,Math.floor(Math.sqrt(d)));!m;)p>f||p===d?m=!0:p=xu(d,p+1);return p}(u,a),l=new hC({windowSize:c,inSize:u,batchSize:s,numSegments:a},n),h=this.compileAndRun(l,[t,i],o);return h.shape[1]===a?h:(i=wu(0,a).tile([u/c]),this.segOpCompute(h,n,i,o,a))},e.prototype.argMinMaxReduce=function(t,n,i){var o=[n];if(Qe("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!j().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Re(t.shape,o),s=a[0],u=at(a[1]),c=t.as2D(-1,u);return this.argReduce(c,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,i,o){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var a=new A2(t.shape,i,o);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var i=new ue("return float(a == b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new ue("return float(a != b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new ue("return float(a < b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new ue("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new ue("return float(a > b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new ue("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new xt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new ue("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new ue("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.select=function(t,n,i){var o=new dC(t.rank,n.shape,n.rank);return this.compileAndRun(o,[t,n,i],_e(n.dtype,i.dtype))},e.prototype.where=function(t){bu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return Dh(t.shape,n)},e.prototype.topk=function(t,n,i){return Tv(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Qe("min",n,t.rank);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ue(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.mod=function(t,n){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ue(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);Qe("max",n,t.rank);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ue(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.all=function(t,n){Qe("all",n,t.rank);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(t,n){Qe("any",n,t.rank);var i=Re(t.shape,n),o=i[0],a=at(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.realDivide=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new ue(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"float32")},e.prototype.floorDiv=function(t,n){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new ue(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,Ml);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var i=_e(t.dtype,n.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Ml,i);var o=new ue(Ml,t.shape,n.shape);return this.compileAndRun(o,[t,n],i)},e.prototype.packedUnaryOp=function(t,n,i){var o=new wa(t.shape,n);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,n,i,o,a){a===void 0&&(a=!1);var s=new pr(i,t.shape,n.shape,a);return this.compileAndRun(s,[t,n],o)},e.prototype.complexSeparableBinaryOp=function(t,n,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(n.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(d){var f=d[0],p=d[1],m=o.makeComplexComponentTensorInfo(t,f),g=o.makeComplexComponentTensorInfo(n,p),v=new ue(i,t.shape,n.shape);return o.compileAndRun(v,[m,g],_e(f.dtype,p.dtype))}),c=u[0],l=u[1],h=this.complex(c,l);return c.dispose(),l.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>j().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),i=this.addN(t.slice(0,n)),o=this.addN(t.slice(n));return this.addN([i,o])}var a=t.map(function(c){return c.dtype}).reduce(function(c,l){return _e(c,l)}),s=t.map(function(c){return c.shape}),u=j().getBool("WEBGL_PACK")?new r2(t[0].shape,s):new n2(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,Rl);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var i=_e(t.dtype,n.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Rl,t.dtype);var o=new ue(Rl,t.shape,n.shape);return this.compileAndRun(o,[t,n],i)},e.prototype.pow=function(t,n){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ue(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),o=_e(t.dtype,n.dtype);return this.compileAndRun(i,[t,n],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ig,t.dtype);var n=new xt(t.shape,ig);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,og,t.dtype);var n=new xt(t.shape,og);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new xt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new xt(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new xt(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new xt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new xt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ag,t.dtype);var n=new xt(t.shape,ag);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,sg,t.dtype);var n=new xt(t.shape,sg);return this.compileAndRun(n,[t])},e.prototype.softmax=function(t,n){var i=me([n],t.shape),o=this.max(t,i),a=He(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),c=this.sum(u,i).reshape(a);return this.realDivide(u,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new xt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new xt(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new xt(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new xt(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new xt(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=j().getBool("WEBGL_PACK")?new wa(t.shape,i0):new xt(t.shape,e0),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=j().getBool("WEBGL_PACK")?new wa(t.shape,o0):new xt(t.shape,n0),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(Lv,t.shape,n.shape):new ue(Nv,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.elu=function(t){if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,a0,t.dtype);var n=new xt(t.shape,r0);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new ue("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.selu=function(t){var n=new xt(t.shape,wC);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new xt(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,i){var o,a=(o=j().getBool("WEBGL_PACK_CLIP")?new x2(t.shape):new v2(t.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(o,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ng,t.dtype);var n=new xt(t.shape,ng);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),i=new b2(t.shape),o=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var n=new xt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new xt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new xt(t.shape,_C);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new xt(t.shape,CC);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new xt(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new xt(t.shape,SC);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new xt(t.shape,EC);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new xt(t.shape,kC);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ue(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.sinh=function(t){var n=new xt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new xt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new xt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new xt(t.shape,IC);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new xt(t.shape,MC);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new xt(t.shape,RC);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new xt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var i=new xt(t.shape,function(o){return o===void 0&&(o=0),An+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(n));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,n,i,o,a,s){var u=t.shape,c=this.texData.get(t.dataId),l=i.inChannels,h=u[0]*u[1]*u[2],d=i.outChannels,f=i.dataFormat==="channelsLast",p=(h===1||d===1)&&l>1e3,m=u[2]%2!=0&&!!c.isPacked;if(p||!j().getBool("WEBGL_LAZILY_UNPACK")||!j().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(t,[1,g,i.inChannels]),x=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:x,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var w=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),b={dataId:t.dataId,shape:[1,w,i.inChannels],dtype:t.dtype},y=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,M(Sa(c.shape,b.shape),function(){return"packed reshape "+c.shape+" to "+b.shape+" isn't free"});var _=this.reshape(n,[1,i.inChannels,i.outChannels]),S=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),C=this.texData.get(S.dataId);return M(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=y,C.shape=i.outShape,F.makeTensorFromDataId(S.dataId,i.outShape,S.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,i,o,a,s){var u=i.filterWidth,c=i.filterHeight,l=i.inChannels,h=i.outWidth,d=i.outHeight,f=i.dataFormat==="channelsLast",p=u*c*l,m=d*h,g=[p,m],v=t.squeeze([0]),x=n.reshape([1,p,-1]),w=new G2(g,v.shape,i),b=this.compileAndRun(w,[v]).reshape([1,g[0],g[1]]),y=o!=null,_=s!=null,S=a?nu(a,!0):null,C=new Al(b.shape,[1,m,i.outChannels],!0,!1,y,S,_),E=[b,x];o&&E.push(o),_&&E.push(s);var I=this.compileAndRun(C,E);return f?I.reshape([1,d,h,i.outChannels]):I.reshape([1,i.outChannels,d,h])},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,o,a,s,u);if(j().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,o,a,s,u);var c=a!=null,l=u!=null,h=s?nu(s,!1):null,d=new Xm(o,c,h,l),f=[n,i];return a&&f.push(a),u&&f.push(u),this.compileAndRun(d,f)},e.prototype.conv2d=function(t,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,i);if(j().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,i);var o=new Xm(i);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerInput=function(t,n,i){var o=new C2(i);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerFilter=function(t,n,i){var o=new _2(i);return this.compileAndRun(o,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=j().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?nu(u,l):null,d=[i,o],f=s!=null,p=c!=null;return f&&d.push(s),p&&d.push(c),l?(n=new Ym(a,f,h,p),this.compileAndRun(n,d)):(n=new Km(a,f,h,p),this.compileAndRun(n,d))},e.prototype.depthwiseConv2D=function(t,n,i){var o;return j().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new Ym(i),this.compileAndRun(o,[t,n])):(o=new Km(i),this.compileAndRun(o,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,i){var o=new I2(i);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){var o=new k2(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3d=function(t,n,i){var o=new M2(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerInput=function(t,n,i){var o=new E2(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerFilter=function(t,n,i){var o=new S2(i);return this.compileAndRun(o,[t,n])},e.prototype.maxPool=function(t,n){var i=new Dl(n,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,n){var i=new Dl(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,i,o){var a=new Dl(o,"max",!0),s=this.compileAndRun(a,[n]),u=new Y2(o),c=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),c},e.prototype.avgPoolBackprop=function(t,n,i){var o=new h2(i);return this.compileAndRun(o,[t],n.dtype)},e.prototype.cast=function(t,n){return Ih(t,n,this)},e.prototype.unstack=function(t,n){for(var i=t.shape[n],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[n]=1;var l=new Array(i);for(s=0;s<l.length;s++)u[n]=s,l[s]=this.slice(t,u,c).reshape(o);return l},e.prototype.avgPool3d=function(t,n){var i=new Tl(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,i){var o=new d2(i);return this.compileAndRun(o,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var i=new Tl(n,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,i,o){var a=new Tl(o,"max",!0),s=this.compileAndRun(a,[n]),u=new $2(o),c=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),c},e.prototype.reshape=function(t,n){var i=this.texData.get(t.dataId);if(i.isPacked&&!Sa(t.shape,n)&&(i.texture===null||!Sa(i.shape,n))){var o=this.packedReshape(t,n);return F.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return ku(t,n)},e.prototype.resizeBilinear=function(t,n,i,o){var a=j().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new aC(t.shape,n,i,o):new oC(t.shape,n,i,o);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,n,i){var o=new iC(t,n,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,n,i,o){var a=new uC(t.shape,n,i,o);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){var o=new sC(t,n,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,n,i,o){var a=n?t:Xe(t),s=a.shape[0],u=a.shape[1],c=new J2(s,u,i),l=c.getCustomSetupFunc(o);return this.compileAndRun(c,[a],"int32",l)},e.prototype.oneHot=function(t,n,i,o){var a=new Q2(t.size,n,i,o);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var n=new F2(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,i,o,a){return bu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Rh(t.dataSync(),n.dataSync(),i,o,a)},e.prototype.cropAndResize=function(t,n,i,o,a,s){var u=new R2(t.shape,n.shape,o,a,s);return this.compileAndRun(u,[t,n,i],"float32")},e.prototype.depthToSpace=function(t,n,i){M(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],c=a*n,l=s*n,h=u/(n*n),d=new P2(i==="NHWC"?[o,c,l,h]:[o,h,c,l],n,i);return this.compileAndRun(d,[t])},e.prototype.split=function(t,n,i){return Av(t,n,i)},e.prototype.scatterND=function(t,n,i){var o=Pa(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,h=[l/u,u],d=t.reshape([s,a]),f=n.reshape([s,u]);if(l===0)return ku(Ce([]),i);var p=Z(0),m=new Zm(s,a,d.rank,f.rank,c,h);return this.compileAndRun(m,[f,d,p]).reshape(i)},e.prototype.sparseToDense=function(t,n,i,o){var a=Pa(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.strides,l=a.outputSize,h=new Zm(u,s,t.rank,n.rank,c,[l,1],!1);return this.compileAndRun(h,[n,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var i=this.texData.get(t.dataId),o=new Jm(W2,t.shape,n),a=new Jm(z2,t.shape,n),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),l},e.prototype.gatherND=function(t,n){var i=n.shape,o=i[i.length-1],a=_h(t,n),s=a[0],u=a[1],c=a[2],l=a[3],h=n.reshape([u,o]),d=t.reshape([t.size/c,c]),f=new j2(o,l,[u,c]);return this.compileAndRun(f,[d,h]).reshape(s)},e.prototype.fill=function(t,n,i){if((i=i||Ao(n))==="string"){var o=Ia(i,at(t));return o.fill(n),F.makeTensor(o,t,i,this)}var a=new V2(t,n),s=a.getCustomSetupFunc(n);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,i){return Mh(t,n,i)},e.prototype.makeTensorInfo=function(t,n){var i=this.write(null,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var i=this.makeTensorInfo(t,n).dataId;return F.makeTensorFromDataId(i,t,n,this)},e.prototype.unpackTensor=function(t){var n=new DC(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new Z2(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var i=[Da(t.shape)].concat(Ta(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[Da(n)].concat(Ta(n)),s=new rC(a,i),u=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:n,dtype:u.dtype}},e.prototype.decode=function(t){var n,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,u=hu(a);return n=o?new T2(u):new D2(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(n,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,i),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===Aa.DENSE){var l=Ea(t.outputShape);c.texShape=l.map(function(w){return 2*w})}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),at(u.shape)===0)return c.values=Mo(u.dtype,0),u;var h=[],d=n.map(function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(w.dataId);if(b.texture==null){if(!t.packedInputs&&at(w.shape)<=j().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=w.shape)}else if(!!b.isPacked!=!!t.packedInputs)w=b.isPacked?s.unpackTensor(w):s.packTensor(w),h.push(w),b=s.texData.get(w.dataId);else if(b.isPacked&&!Sa(b.shape,w.shape)){var y=w,_=w.shape;w.shape=b.shape,w=s.packedReshape(w,_),h.push(w),b=s.texData.get(w.dataId),y.shape=_}return s.uploadToGPU(w.dataId),{shape:w.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var f,p={shape:u.shape,texData:c,isUniform:!1},m=function(w,b,y){var _="";b.concat(y).forEach(function(E){var I=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,A=E.isUniform?"uniform":E.texData.texShape;_+=E.shape+"_"+A+"_"+I});var S=w.userCode,C=w.constructor.name;return C+="_"+_+"_"+S}(t,d,p),g=this.getAndSaveBinary(m,function(){return function(w,b,y,_){var S=b.userCode,C=y.map(function(U,H){var K={logicalShape:U.shape,texShape:U.isUniform?null:U.texData.texShape,isUniform:U.isUniform,isPacked:!U.isUniform&&U.texData.isPacked,flatOffset:null};return U.texData!=null&&U.texData.slice!=null&&U.texData.slice.flatOffset>0&&(K.flatOffset=U.texData.slice.flatOffset),{name:b.variableNames[H],shapeInfo:K}}),E=C.map(function(U){return U.shapeInfo}),I={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},A=o2(C,I,S,b.packedInputs),R=w.createProgram(A),L=null,B=w.getUniformLocation(R,"NAN",!1);j().getNumber("WEBGL_VERSION")===1&&(L=w.getUniformLocation(R,"INFINITY",!1));for(var O={},V=0;V<b.variableNames.length;V++){var z=b.variableNames[V];O[z]=w.getUniformLocation(R,z,!1),O["offset"+z]=w.getUniformLocation(R,"offset"+z,!1)}return{program:b,source:A,webGLProgram:R,uniformLocations:O,inShapeInfos:E,outShapeInfo:I,infLoc:L,nanLoc:B}}(s.gpgpu,t,d,p)}),v=this.activeTimers!=null;if(v&&(f=this.startTimer()),function(w,b,y,_,S){Qm(b.inShapeInfos,y),Qm([b.outShapeInfo],[_]);var C=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?w.setOutputPackedMatrixTexture(C,E[0],E[1]):w.setOutputMatrixTexture(C,E[0],E[1]),w.setProgram(b.webGLProgram),j().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&w.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&w.gl.uniform1f(b.nanLoc,NaN),y.forEach(function(I,A){var R=b.program.variableNames[A],L=b.uniformLocations[R],B=b.uniformLocations["offset"+R];if(L!=null)if(I.isUniform)if(at(I.shape)<2)w.gl.uniform1f(L,I.uniformValues[0]);else{var O=I.uniformValues;O instanceof Float32Array||(O=new Float32Array(O)),w.gl.uniform1fv(L,O)}else I.texData.slice!=null&&B!=null&&w.gl.uniform1i(B,I.texData.slice.flatOffset),w.setInputMatrixTexture(I.texData.texture,L,A)}),S?.(w,b.webGLProgram),w.executeProgram()}(this.gpgpu,g,d,p,o),h.forEach(function(w){return s.disposeData(w.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!j().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(t,n,i,o,a){a===void 0&&(a=!1),i=i||n[0].dtype;var s=this.runWebGLProgram(t,n,i,o,a);return F.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(j().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(n){t.gpgpu.deleteProgram(t.binaryCache[n].webGLProgram),delete t.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=X(function(){if(!j().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=j().getBool("DEBUG");j().set("DEBUG",!1);var i=t.abs(Z(1e-8)).dataSync()[0];if(j().set("DEBUG",n),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,u=i.texture,c=i.usage,l=i.isPacked;if(u==null){var h,d=this.activeTimers!=null;d&&(h=Sn());var f=i.texShape;if(f==null&&(f=iv(o,l),i.texShape=f),s!=null){var p=hu(o),m=void 0,g=f[1],v=f[0],x=s instanceof Uint8Array;l?(g=(n=La(f[0],f[1]))[0],v=n[1],m=new B2(p,[v,g],x)):m=new L2(p,[v,g],x);var w=this.makeTensorInfo([v,g],a);this.texData.get(w.dataId).usage=x?cn.PIXELS:cn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),g,v,s);var b=this.runWebGLProgram(m,[w],a,null,!0),y=this.texData.get(b.dataId);i.texture=y.texture,i.texShape=y.texShape,i.isPacked=y.isPacked,i.usage=y.usage,this.disposeData(w.dataId),this.texData.delete(b.dataId),i.values=null,d&&(this.uploadWaitMs+=Sn()-h)}else{var _=this.acquireTexture(f,c,a,l);i.texture=_}}},e.prototype.convertAndCacheOnCPU=function(t,n){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),n!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(n,o)),i.values},e.prototype.acquireTexture=function(t,n,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,o)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*fh(n)},e}(Mv);Wg()&&F.registerBackend("webgl",function(){return new s0},2);var PC=D({square_:function(r){var e=k(r,"x","square"),t=[e];return F.runKernelFunc(function(n,i){return i([e]),n.square(e)},{x:e},null,"Square",{},t,[])}}),Na="SquaredDifference",u0=D({squaredDifference_:function(r,e){var t,n=k(r,"a","squaredDifference"),i=k(e,"b","squaredDifference");t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape);var o={a:n,b:i},a=[n,i];return F.runKernelFunc(function(s,u){var c=s.squaredDifference(n,i);return u([n,i]),c},o,function(s,u){var c=u[0],l=u[1],h=Z(2);return{a:function(){return s.mul(c.sub(l).mul(h))},b:function(){return s.mul(l.sub(c).mul(h))}}},Na,{},a,[])}}),FC=D({abs_:function(r){var e=k(r,"x","abs");return e.dtype==="complex64"?F.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):F.runKernelFunc(function(t,n){var i=t.abs(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),OC=D({acos_:function(r){var e=k(r,"x","acos");return F.runKernelFunc(function(t,n){var i=t.acos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),NC=D({acosh_:function(r){var e=k(r,"x","acosh");return F.runKernelFunc(function(t,n){var i=t.acosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),LC=D({asin_:function(r){var e=k(r,"x","asin");return F.runKernelFunc(function(t,n){var i=t.asin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).sub(i.toFloat().square()).sqrt())}}})}}),BC=D({asinh_:function(r){var e=k(r,"x","asinh");return F.runKernelFunc(function(t,n){var i=t.asinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).add(i.toFloat().square()).sqrt())}}})}}),WC=D({atan_:function(r){var e=k(r,"x","atan");return F.runKernelFunc(function(t,n){var i=t.atan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),zC=D({atanh_:function(r){var e=k(r,"x","atanh");return F.runKernelFunc(function(t,n){var i=t.atanh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(Z(1).sub(i.toFloat().square()))}}})}}),VC=D({ceil_:function(r){var e=k(r,"x","ceil");return F.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),Wa=D({clipByValue_:function(r,e,t){var n=k(r,"x","clipByValue");M(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[n],o={min:e,max:t};return F.runKernelFunc(function(a,s){var u=a.clip(n,e,t);return s([n]),u},{x:n},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),It(a))}}},"ClipByValue",o,i)}}),UC=D({cos_:function(r){var e=k(r,"x","cos"),t=[e];return F.runKernelFunc(function(n,i){var o=n.cos(e);return i([e]),o},{x:e},function(n,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(n)}}},"Cos",{},t)}}),jC=D({cosh_:function(r){var e=k(r,"x","cosh");return F.runKernelFunc(function(t,n){var i=t.cosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),HC=D({erf_:function(r){var e=k(r,"x","erf");return M(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),F.runKernelFunc(function(t,n){var i=t.erf(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Lu=D({exp_:function(r){var e=k(r,"x","exp");return F.runKernelFunc(function(t,n){var i=t.exp(e);return n([i]),i},{x:e},function(t,n){return{x:function(){return t.mulStrict(n[0])}}},"Exp",{},[],[!0])}}),GC=D({expm1_:function(r){var e=k(r,"x","expm1");return F.runKernelFunc(function(t,n){var i=t.expm1(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}})}}),qC=D({floor_:function(r){var e=k(r,"x","floor");return F.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),XC=D({log_:function(r){var e=k(r,"x","log"),t=[e];return F.runKernelFunc(function(n,i){var o=n.log(e);return i([e]),o},{x:e},function(n,i){var o=i[0];return{x:function(){return n.div(o.toFloat())}}},"Log",{},t)}}),KC=D({log1p_:function(r){var e=k(r,"x","log1p");return F.runKernelFunc(function(t,n){var i=t.log1p(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}})}}),YC=D({logSigmoid_:function(r){var e=k(r,"x","logSigmoid");return F.runKernelFunc(function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),za=D({neg_:function(r){var e=k(r,"x","neg"),t=[e];return F.runKernelFunc(function(n){return n.neg(e)},{x:e},function(n){return{x:function(){return n.neg()}}},"Neg",{},t)}}),$C=D({reciprocal_:function(r){var e=k(r,"x","reciprocal");return F.runKernelFunc(function(t,n){var i=t.reciprocal(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}})}}),JC=D({round_:function(r){var e=k(r,"x","round");return F.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),c0=D({rsqrt_:function(r){var e=k(r,"x","rsqrt"),t=[e];return F.runKernelFunc(function(n,i){var o=n.rsqrt(e);return i([e]),o},{x:e},function(n,i){var o=i[0];return{x:function(){return n.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),Oh=D({sigmoid_:function(r){var e=k(r,"x","sigmoid");return F.runKernelFunc(function(t,n){var i=t.sigmoid(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.mul(Z(1).sub(i)))}}},"Sigmoid")}}),QC=D({sign_:function(r){var e=k(r,"x","sign");return F.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),ZC=D({isNaN_:function(r){var e=k(r,"x","isNaN");return F.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),tS=D({isInf_:function(r){var e=k(r,"x","isInf");return F.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),eS=D({isFinite_:function(r){var e=k(r,"x","isFinite");return F.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return It(t)}}})}}),nS=D({sin_:function(r){var e=k(r,"x","sin"),t=[e];return F.runKernelFunc(function(n,i){var o=n.sin(e);return i([e]),o},{x:e},function(n,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(n)}}},"Sin",{},t)}}),rS=D({sinh_:function(r){var e=k(r,"x","sinh");return F.runKernelFunc(function(t,n){var i=t.sinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),iS=D({softplus_:function(r){var e=k(r,"x","softplus");return F.runKernelFunc(function(t,n){var i=t.softplus(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),oS=D({sqrt_:function(r){var e=k(r,"x","sqrt");return F.runKernelFunc(function(t,n){var i=t.sqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),aS=D({step_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","step");return F.runKernelFunc(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return It(n)}}})}}),sS=D({tan_:function(r){var e=k(r,"x","tan");return F.runKernelFunc(function(t,n){var i=t.tan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}})}}),uS=D({tanh_:function(r){var e=k(r,"x","tanh");return F.runKernelFunc(function(t,n){var i=t.tanh(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return Z(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function l0(r,e,t,n,i,o){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(a=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),M(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),M(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),M(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),a!=null&&M(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&M(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Va(u,c,l,s,a,o)}function h0(r,e,t,n,i,o){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(a=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),M(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),M(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),M(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),a!=null&&M(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&M(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Va(u,c,l,s,a,o)}function d0(r,e,t,n,i,o){var a,s,u=k(r,"x","batchNorm"),c=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(a=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),M(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),M(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),M(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),a!=null&&M(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&M(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Va(u,c,l,s,a,o)}function Va(r,e,t,n,i,o){o==null&&(o=.001);var a,s,u,c=k(r,"x","batchNorm"),l=k(e,"mean","batchNorm"),h=k(t,"variance","batchNorm");i!=null&&(a=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),M(l.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),M(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),M(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,h,a];return F.runKernelFunc(function(f,p){var m=f.batchNormalization(u,ru(l),ru(h),o,ru(a),ru(s));return p([c,l,h,a]),m},{x:c,mean:l,variance:h,scale:a,offset:s},function(f,p){var m=p,g=m[0],v=m[1],x=m[2],w=m[3],b=w??Z(1),y=pe(v.shape,u.shape),_=[];if(v.rank===1){for(var S=0;S<u.shape.length-1;++S)_.push(u.shape[S]);_.push(1)}var C=g.sub(v),E=f.mul(b),I=c0(x.add(Z(o))),A=I.mul(I).mul(I).mul(Z(-.5));return{x:function(){return v.rank===1?f.mul(Ci(I.as4D(1,1,1,v.shape[0]),_)).mul(b).reshape(g.shape):f.mul(I).mul(b).reshape(g.shape)},mean:function(){var R=I.mul(Z(-1)).mul(E);return v.rank===1&&(R=R.sum(y)),R.reshape(v.shape)},variance:function(){var R=A.mul(C).mul(E);return v.rank===1&&(R=R.sum(y)),R.reshape(v.shape)},scale:function(){var R=C.mul(I),L=f.mul(R);return v.rank===1&&(L=L.sum(y)),L.reshape(v.shape)},offset:function(){var R=f;return v.rank===1&&(R=R.sum(y)),R.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:o},d).reshape(c.shape)}function ru(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Bu(){hv("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var cS=D({batchNormalization2d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),Bu(),l0(r,e,t,o,i,n)}}),lS=D({batchNormalization3d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),Bu(),h0(r,e,t,o,i,n)}}),hS=D({batchNormalization4d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),Bu(),d0(r,e,t,o,i,n)}}),dS=D({batchNormalization_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),Bu(),Va(r,e,t,o,i,n)}}),Nh=D({batchNorm_:Va}),fS=D({batchNorm2d_:l0}),pS=D({batchNorm3d_:h0}),mS=D({batchNorm4d_:d0}),Wu=D({logicalAnd_:function(r,e){var t=k(r,"a","logicalAnd","bool"),n=k(e,"b","logicalAnd","bool");return yt(t.shape,n.shape),F.runKernelFunc(function(i){return i.logicalAnd(t,n)},{a:t,b:n},null,"LogicalAnd")}}),gS=D({logicalNot_:function(r){var e=k(r,"x","logicalNot","bool");return F.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),f0=D({logicalOr_:function(r,e){var t=k(r,"a","logicalOr","bool"),n=k(e,"b","logicalOr","bool");return yt(t.shape,n.shape),F.runKernelFunc(function(i){return i.logicalOr(t,n)},{$a:t,$b:n})}}),vS=D({logicalXor_:function(r,e){var t=k(r,"a","logicalXor","bool"),n=k(e,"b","logicalXor","bool");return yt(t.shape,n.shape),f0(r,e).logicalAnd(Wu(r,e).logicalNot())}}),Ii=D({where_:function(r,e,t){var n=k(e,"a","where"),i=k(t,"b","where"),o=k(r,"condition","where","bool");return Pt(n.shape,i.shape,"Error in where: "),o.rank===1?M(o.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Pt(o.shape,i.shape,"Error in where: "),F.runKernelFunc(function(a,s){var u=a.select(o,n,i);return s([o]),u},{$condition:o,$a:n,$b:i},function(a,s){var u=s[0];return{$condition:function(){return It(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),p0=function(r){return it(this,void 0,void 0,function(){var e,t,n;return ot(this,function(i){switch(i.label){case 0:return[4,(e=k(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=Dh(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},lt=D({add_:function(r,e){var t,n=k(r,"a","add"),i=k(e,"b","add");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a){return a.add(n,i)},{a:n,b:i},function(a){return{a:function(){var s=a,u=pe(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=pe(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}},"Add")}}),xS=D({addN_:function(r){M(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),M(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(i,o){return k(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!fe(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return F.runKernelFunc(function(i){return i.addN(e)},n,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o},"AddN")}}),bS=D({addStrict_:function(r,e){var t=k(r,"a","addStrict"),n=k(e,"b","addStrict");return Pt(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),yS=D({atan2_:function(r,e){var t,n=k(r,"a","atan2"),i=k(e,"b","atan2");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a,s){var u=a.atan2(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=lt(u.square(),c.square()),h=a.mul(c.div(l)),d=pe(u.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(u.shape)},$b:function(){var l=lt(u.square(),c.square()),h=za(a.mul(u.div(l))),d=pe(c.shape,o);return d.length>0&&(h=h.sum(d)),h.reshape(c.shape)}}})}}),xn=D({div_:function(r,e){var t,n=k(r,"a","div"),i=k(e,"b","div");if(t=Qt(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return m0(n,i);var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a,s){var u=a.realDivide(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),h=pe(u.shape,o);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=pe(c.shape,o);h.length>0&&(l=l.sum(h).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}},"Div")}}),wS=D({divNoNan_:function(r,e){var t,n=k(r,"a","div"),i=k(e,"b","div");n=(t=Qt(n,i))[0],i=t[1];var o=xn(n,i),a=It(o),s=i.equal(a);return Ii(s,a,o)}}),_S=D({divStrict_:function(r,e){var t=k(r,"a","div"),n=k(e,"b","div");return Pt(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),m0=D({floorDiv_:function(r,e){var t,n=k(r,"a","floorDiv"),i=k(e,"b","floorDiv");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a,s){var u=a.floorDiv(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),h=pe(u.shape,o);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=pe(c.shape,o);h.length>0&&(l=l.sum(h).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}},"FloorDiv")}}),Lh=D({maximum_:function(r,e){var t,n=k(r,"a","maximum"),i=k(e,"b","maximum");return t=Qt(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),yt(n.shape,i.shape),F.runKernelFunc(function(o,a){var s=o.maximum(n,i);return a([n,i]),s},{a:n,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}},"Maximum")}}),CS=D({maximumStrict_:function(r,e){var t=k(r,"a","maximumStrict"),n=k(e,"b","maximumStrict");return Pt(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),g0=D({minimum_:function(r,e){var t,n=k(r,"a","minimum"),i=k(e,"b","minimum");return t=Qt(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),yt(n.shape,i.shape),F.runKernelFunc(function(o,a){var s=o.minimum(n,i);return a([n,i]),s},{a:n,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}},"Minimum")}}),SS=D({minimumStrict_:function(r,e){var t=k(r,"a","minimumStrict"),n=k(e,"b","minimumStrict");return Pt(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),ES=D({mod_:function(r,e){var t,n=k(r,"a","mod"),i=k(e,"b","mod");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a,s){var u=a.mod(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=pe(u.shape,o);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),h=pe(c.shape,o);return h.length>0?l.sum(h).reshape(c.shape):l}}})}}),kS=D({modStrict_:function(r,e){var t=k(r,"a","modStrict"),n=k(e,"b","modStrict");return Pt(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),ee=D({mul_:function(r,e){var t,n=k(r,"a","mul"),i=k(e,"b","mul");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a,s){var u=a.multiply(n,i);return s([n,i]),u},{a:n,b:i},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),h=pe(u.shape,o);return h.length>0?l.sum(h).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),h=pe(c.shape,o);return h.length>0?l.sum(h).reshape(c.shape):l}}},"Mul")}}),IS=D({mulStrict_:function(r,e){var t=k(r,"a","mul"),n=k(e,"b","mul");return Pt(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),Iu=D({pow_:function(r,e){var t,n=k(r,"base","pow"),i=k(e,"exp","pow");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape),a=[n,i];return F.runKernelFunc(function(s,u){var c=s.pow(n,i);return u([n,i,c]),c},{a:n,b:i},function(s,u){var c=u[0],l=u[1],h=u[2];return{a:function(){var d=l.toFloat(),f=s.mul(d.mul(c.pow(d.sub(Z(1))))),p=pe(c.shape,o);return p.length>0&&(f=f.sum(p)),f.reshape(c.shape)},b:function(){var d=c.greater(0),f=c.log().where(d,It(c)),p=s.mul(h.mul(f)),m=pe(l.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)}}},"Pow",{},a,[!0])}}),MS=D({powStrict_:function(r,e){return Pt(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),RS=D({squaredDifferenceStrict_:function(r,e){var t=k(r,"a","squaredDifferenceStrict"),n=k(e,"b","squaredDifferenceStrict");return Pt(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),Vt=D({sub_:function(r,e){var t,n=k(r,"a","sub"),i=k(e,"b","sub");t=Qt(n,i),n=t[0],i=t[1];var o=yt(n.shape,i.shape);return F.runKernelFunc(function(a){return a.subtract(n,i)},{a:n,b:i},function(a){return{a:function(){var s=a,u=pe(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=pe(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}},"Sub")}}),AS=D({subStrict_:function(r,e){var t=k(r,"a","subStrict"),n=k(e,"b","subStrict");return Pt(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),v0=D({equal_:function(r,e){var t,n=k(r,"a","equal"),i=k(e,"b","equal");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o){return o.equal(n,i)},{$a:n,$b:i})}}),DS=D({equalStrict_:function(r,e){var t=k(r,"a","equalStrict"),n=k(e,"b","equalStrict");return Pt(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),TS=D({greater_:function(r,e){var t,n=k(r,"a","greater"),i=k(e,"b","greater");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o){return o.greater(n,i)},{a:n,b:i},null,"Greater")}}),x0=D({greaterEqual_:function(r,e){var t,n=k(r,"a","greaterEqual"),i=k(e,"b","greaterEqual");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o,a){var s=o.greaterEqual(n,i);return a([n,i]),s},{a:n,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return It(s)},b:function(){return It(u)}}},"GreaterEqual")}}),PS=D({greaterEqualStrict_:function(r,e){var t=k(r,"a","greaterEqualStrict"),n=k(e,"b","greaterEqualStrict");return Pt(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),FS=D({greaterStrict_:function(r,e){var t=k(r,"a","greaterStrict"),n=k(e,"b","greaterStrict");return Pt(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),OS=D({less_:function(r,e){var t,n=k(r,"a","less"),i=k(e,"b","less");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o){return o.less(n,i)},{a:n,b:i},null,"Less")}}),NS=D({lessEqual_:function(r,e){var t,n=k(r,"a","lessEqual"),i=k(e,"b","lessEqual");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o,a){var s=o.lessEqual(n,i);return a([n,i]),s},{a:n,b:i},null,"LessEqual")}}),LS=D({lessEqualStrict_:function(r,e){var t=k(r,"a","lessEqualStrict"),n=k(e,"b","lessEqualStrict");return Pt(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),BS=D({lessStrict_:function(r,e){var t=k(r,"a","lessStrict"),n=k(e,"b","lessStrict");return Pt(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),WS=D({notEqual_:function(r,e){var t,n=k(r,"a","notEqual"),i=k(e,"b","notEqual");return t=Qt(n,i),n=t[0],i=t[1],yt(n.shape,i.shape),F.runKernelFunc(function(o){return o.notEqual(n,i)},{a:n,b:i},null,"NotEqual")}}),zS=D({notEqualStrict_:function(r,e){var t=k(r,"a","notEqualStrict"),n=k(e,"b","notEqualStrict");return Pt(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function ug(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function cg(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Bh=D({gather_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","gather"),i=k(e,"indices","gather","int32");t=me(t,n.shape)[0];var o=function(a,s,u){for(var c=a.shape[u],l=[],h=1,d=1,f=0;f<u;f++)l.push(a.shape[f]),h*=a.shape[f];for(f=0;f<s.rank;f++)l.push(s.shape[f]);for(f=u+1;f<a.rank;f++)l.push(a.shape[f]),d*=a.shape[f];return{batchSize:h,sliceSize:d,dimSize:c,outputShape:l}}(n,i,t);return F.runKernelFunc(function(a,s){var u=a.gather(n,i.flatten(),t);return s([i]),u},{x:n,indices:i},function(a,s){var u=s[0];return{x:function(){var c=n.shape,l=u.size,h=c.slice(0,t),d=h.length,f=c.slice(t,c.length).slice(1),p=f.length,m=ug(0,d),g=ug(d+1,d+1+p),v=cg([h,[l],f]),x=a.reshape(v),w=u.reshape([l]),b=cg([[d],m,g]),y=x.transpose(b),_=b0(y,w,n.shape[t]),S=Du(b);return _=_.transpose(S)},indices:function(){return u}}},"Gather",{axis:t}).reshape(o.outputShape)}}),b0=D({unsortedSegmentSum_:function(r,e,t){var n=k(r,"x","unsortedSegmentSum"),i=k(e,"segmentIds","unsortedSegmentSum","int32");return M(ne(t),function(){return"numSegments must be of dtype int"}),F.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(n,i,t);return a([i]),s},{$x:n},function(o,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=Lh(c,It(c)),h=Bh(u,l),d=x0(c,Z(0,"int32")),f=h.rank-d.rank,p=0;p<f;++p)d=Le(d,p+1);d=Wu(d,To(h.shape,"bool"));var m=It(h);return Ii(d,h,m)}(o,s)}}})}}),VS=function(r,e,t){return it(this,void 0,void 0,function(){var n,i,o,a,s,u,c,l,h,d,f,p,m;return ot(this,function(g){switch(g.label){case 0:for(n=k(r,"tensor","boolMask"),i=k(e,"mask","boolMask","bool"),o=t??0,a=i.rank,s=n.shape,M(a>0,function(){return"mask cannot be scalar"}),Pt(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+a;c++)u*=s[c];return l=s.slice(0,o).concat([u],s.slice(o+a)),h=n.reshape(l),d=i.reshape([-1]),[4,p0(d)];case 1:return f=g.sent(),p=f.squeeze([1]),m=Bh(h,p,o),r!==n&&n.dispose(),e!==i&&i.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,m]}})})};function y0(r,e,t,n,i,o,a){o===void 0&&(o="NHWC"),M(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,r[0],r[1],r[2]]),M(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),M(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),M(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var l=o==="NHWC"?s[3]:s[1],h=o==="NHWC"?u.shape[3]:u.shape[1];M(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),M(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),a!=null&&M(ne(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=Nu(o),f=$r(s,t.shape,n,1,i,a,!1,d),p=F.runKernelFunc(function(m,g){var v=m.conv2dDerInput(u,t,f);return g([t,u]),v},{dy4D:u,filter:t},function(m,g){var v=g[0],x=g[1];return{dy4D:function(){return Se(m,v,n,i,o,1,a)},filter:function(){return Wh(m,x,v.shape,n,i,o,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Fl(r){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function w0(r,e,t,n,i){M(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var o=r,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,r[0],r[1],r[2],r[3]]);var u=o[4],c=a.shape[4];M(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),M(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),M(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),M(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),M(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."});var l=Oa(o,t.shape,n,1,i),h=F.runKernelFunc(function(d){return d.conv3dDerInput(a,t,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var US=D({conv1d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=k(r,"x","conv1d"),u=k(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),M(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),M(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&M(ne(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),M(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),M(Ge(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),M(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=Se(d,h,[1,t],n,"NHWC",[1,o],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),Se=D({conv2d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=k(r,"x","conv2d"),u=k(e,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),M(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),M(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&M(ne(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var h=i==="NHWC"?c.shape[3]:c.shape[1];M(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),M(Ge(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var d=Nu(i),f=$r(c.shape,u.shape,t,o,n,a,!1,d),p=[u,c],m=F.runKernelFunc(function(g,v){var x=g.conv2d(c,u,f);return v([u,c]),x},{x:c,filter:u},function(g,v){var x=v,w=x[0],b=x[1];return M(ki(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return _0(b.shape,g,w,t,n,i)},filter:function(){return Wh(b,g,w.shape,t,n,i)}}},"Conv2D",f,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),jS=D({conv3d_:function(r,e,t,n,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=k(r,"x","conv3d"),s=k(e,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),M(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),M(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),M(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),M(function(d,f){return Fl(d)||Fl(f)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),M(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=Oa(u.shape,s.shape,t,o,n),h=F.runKernelFunc(function(d,f){var p=d.conv3d(u,s,l);return f([u,s]),p},{x:u,$filter:s},function(d,f){M(Fl(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=f[0],m=f[1];return{x:function(){return w0(p.shape,d,m,t,n)},$filter:function(){return function(g,v,x,w,b){var y=g;g.rank===4&&(y=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var _=v;_.rank===4&&(_=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),M(y.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+y.shape+"."}),M(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),M(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),M(y.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+y.shape[4]+") must match input depth in filter ("+x[3]+"."}),M(_.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+x[4]+")."});var S=Oa(y.shape,x,w,1,b);return F.runKernelFunc(function(C){return C.conv3dDerFilter(y,_,S)},{x5D:y,dy5D:_})}(p,d,m.shape,t,n)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Wh=D({conv2dDerFilter_:function(r,e,t,n,i,o,a){o===void 0&&(o="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),M(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),M(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),M(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var c=o==="NHWC"?s.shape[3]:s.shape[1],l=o==="NHWC"?u.shape[3]:u.shape[1];M(c===t[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."}),M(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."}),a!=null&&M(ne(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=Nu(o),d=$r(s.shape,t,n,1,i,a,!1,h);return F.runKernelFunc(function(f){return f.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),_0=D({conv2dDerInput_:y0}),Ua=D({depthwiseConv2d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=k(r,"x","depthwiseConv2d"),u=k(e,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),M(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),M(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),M(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),M(Ge(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&M(ne(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var h=$r(c.shape,u.shape,t,o,n,a,!0),d=[c,u],f=F.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(c,u,h);return m([c,u]),g},{x:c,filter:u},function(p,m){M(ki(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var g=m[0],v=m[1];return{x:function(){return C0(g.shape,p,v,h)},filter:function(){return S0(g,p,v.shape,h)}}},"DepthwiseConv2dNative",h,d);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),C0=D({depthwiseConv2dDerInput_:function(r,e,t,n){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=F.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,t,n)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),S0=D({depthwiseConv2dDerFilter_:function(r,e,t,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),F.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,n)},{x4D:i,dy4D:o})}}),ja=D({separableConv2d_:function(r,e,t,n,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=k(r,"x","separableConv2d"),u=k(e,"depthwiseFilter","separableConv2d"),c=k(t,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(s.rank===3&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");M(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),M(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),M(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),M(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),M(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],f=u.shape[3];M(c.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."});var p=Ua(l,u,n,i,a,o),m=Se(p,c,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),HS=D({conv2dTranspose_:function(r,e,t,n,i,o){return y0(t,k(r,"x","conv2dTranspose"),k(e,"filter","conv2dTranspose"),n,i,"NHWC",o)}}),GS=D({conv3dTranspose_:function(r,e,t,n,i){return w0(t,k(r,"x","conv3dTranspose"),k(e,"filter","conv3dTranspose"),n,i)}}),Po=D({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var o=k(r,"a","matMul"),a=k(e,"b","matMul");i=Qt(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?o.shape[o.rank-1]:o.shape[o.rank-2],l=n?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),d=a.shape.slice(0,-2),f=at(h),p=at(d);M(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),M(fe(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),M(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var m=o.shape.slice(0,-2).concat([c,l]),g=t?o.as3D(f,s,c):o.as3D(f,c,s),v=n?a.as3D(p,l,u):a.as3D(p,u,l),x={transposeA:t,transposeB:n};return F.runKernelFunc(function(w,b){var y=w.batchMatMul(g,v,t,n);return b([g,v]),y},{a:g,b:v},function(w,b){var y=b,_=y[0],S=y[1];return t||n?!t&&n?{a:function(){return w.matMul(S,!1,!1)},b:function(){return w.matMul(_,!0,!1)}}:t&&!n?{a:function(){return S.matMul(w,!1,!0)},b:function(){return _.matMul(w,!1,!1)}}:{a:function(){return S.matMul(w,!0,!0)},b:function(){return w.matMul(_,!0,!0)}}:{a:function(){return w.matMul(S,!1,!0)},b:function(){return _.matMul(w,!0,!1)}}},"BatchMatMul",x).reshape(m)}}),qS=D({dot_:function(r,e){var t=k(r,"t1","dot"),n=k(e,"t2","dot");M(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=n.rank===1?n.size:n.shape[0];return M(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),XS=D({outerProduct_:function(r,e){var t=k(r,"v1","outerProduct"),n=k(e,"v2","outerProduct");return M(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),Ha=D({reverse_:function(r,e){var t=k(r,"x","reverse");if(t.rank===0)return t.clone();var n=me(e,t.shape);return F.runKernelFunc(function(i){return i.reverse(t,n)},{$x:t},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(t)}}),KS=D({reverse1d_:function(r){var e=k(r,"x","reverse");return M(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Ha(e,0)}}),YS=D({reverse2d_:function(r,e){var t=k(r,"x","reverse");return M(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Ha(t,e)}}),$S=D({reverse3d_:function(r,e){var t=k(r,"x","reverse");return M(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Ha(t,e)}}),JS=D({reverse4d_:function(r,e){var t=k(r,"x","reverse");return M(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Ha(t,e)}});function E0(r,e,t,n,i,o){var a=k(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),n==null&&(n=[1,1]),M(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),M(Ge(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),o!=null&&M(ne(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=Ro(s.shape,e,t,n,i,o);if(c.filterWidth===1&&c.filterHeight===1&&fe(c.inShape,c.outShape))return a.clone();var l=[s],h=F.runKernelFunc(function(d,f){var p=d.maxPool(s,c);return f([s,p]),p},{x:s},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,x,w,b,y,_,S){var C=k(g,"dy","maxPoolBackprop"),E=k(v,"input","maxPoolBackprop"),I=k(x,"output","maxPoolBackprop");M(E.rank===C.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+C.rank+")"}),y==null&&(y=[1,1]),M(Ge(b,y),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+y+"'"}),M(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),M(E.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."}),S!=null&&M(ne(_),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."});var A=Ro(E.shape,w,b,y,_,S);return F.runKernelFunc(function(R){return R.maxPoolBackprop(C,E,I,A)},{$dy:C,$input:E})}(d,p,m,e,t,n,i)}}},"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function k0(r,e,t,n,i,o){var a=k(r,"x","avgPool","float32");n==null&&(n=[1,1]),M(Ge(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),M(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&M(ne(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=Ro(s.shape,e,t,n,i,o);if(c.filterWidth===1&&c.filterHeight===1&&fe(c.inShape,c.outShape))return a.clone();var l=F.runKernelFunc(function(h){return h.avgPool(s,c)},{x:s},function(h){return{x:function(){return function(d,f,p,m,g,v){var x=k(d,"dy","avgPoolBackprop"),w=k(f,"input","avgPoolBackprop");M(w.rank===x.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+x.rank+")"}),g==null&&(g=[1,1]),M(Ge(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var b=w,y=x,_=!1;w.rank===3&&(_=!0,b=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),y=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),M(y.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+y.rank+"."}),M(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var S=Ro(b.shape,p,m,g,v),C=F.runKernelFunc(function(E){return E.avgPoolBackprop(y,b,S)},{dy4D:y,input4D:b});return _?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(h,s,e,t,n,i)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var re=D({maxPool_:function(r,e,t,n,i){return E0(r,e,t,1,n,i)}}),yr=D({avgPool_:function(r,e,t,n,i){return k0(r,e,t,1,n,i)}}),QS=D({pool_:function(r,e,t,n,i,o){i==null&&(i=[1,1]),o==null&&(o=1),n===0&&(n="valid");var a=k(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),M(Ge(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,l=Ro(s.shape,e,o,i,n),h=[l.dilationHeight,l.dilationWidth];c=n==="same"?function(b,y){var _=b.map(function(E,I){return E+(E-1)*(y[I]-1)}).map(function(E){return E-1}),S=_.map(function(E){return Math.floor(E/2)}),C=_.map(function(E,I){return E-S[I]});return _.map(function(E,I){return[S[I],C[I]]})}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=h[0]===1&&h[1]===1,f=function(b,y,_){var S=_.map(function(B){return B[0]}),C=_.map(function(B){return B[1]}),E=b.concat(S,C),I=y.map(function(B,O){return(B-E[O]%B)%B}),A=C.map(function(B,O){return B+I[O]}),R=y.map(function(B,O){return[S[O],A[O]]}),L=y.map(function(B,O){return[0,I[O]]});return[R,L]}([l.inHeight,l.inWidth],h,c),p=f[0],m=f[1],g=d?n:"valid",v=d?s:xv(s,h,p),x=(t==="avg"?function(){return k0(v,e,o,1,g)}:function(){return E0(v,e,o,1,g)})(),w=d?x:mv(x,h,m);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),ZS=D({maxPool3d_:function(r,e,t,n,i,o,a){o===void 0&&(o="NDHWC");var s=k(r,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),M(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),M(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),M(Ge(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&M(ne(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var l=Fa(u.shape,e,t,a,n,i,o),h=F.runKernelFunc(function(d,f){var p=d.maxPool3d(u,l);return f([u,p]),p},{x:u},function(d,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,x,w,b,y,_,S){var C=k(g,"dy","maxPool3dBackprop"),E=k(v,"input","maxPool3dBackprop"),I=k(x,"output","maxPool3dBackprop"),A=C,R=E,L=I,B=!1;E.rank===4&&(B=!0,A=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),R=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),L=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3])),M(A.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."}),M(R.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."}),M(L.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+L.rank+"."}),y==null&&(y=[1,1,1]),M(Ge(b,y),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+y+"'"}),S!=null&&M(ne(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."});var O=Fa(R.shape,w,b,y,_,S),V=F.runKernelFunc(function(z){return z.maxPool3dBackprop(A,R,L,O)},{dy5D:A,input5D:R});return B?V.as4D(V.shape[1],V.shape[2],V.shape[3],V.shape[4]):V}(d,p,m,e,t,a,n,i)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),tE=D({avgPool3d_:function(r,e,t,n,i,o,a){o===void 0&&(o="NDHWC");var s=k(r,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),M(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),M(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),M(Ge(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&M(ne(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var l=Fa(u.shape,e,t,a,n,i,o),h=F.runKernelFunc(function(d){return d.avgPool3d(u,l)},{x:u},function(d){return{x:function(){return function(f,p,m,g,v,x,w){var b=k(f,"dy","avgPool3dBackprop"),y=k(p,"input","avgPool3dBackprop"),_=b,S=y,C=!1;y.rank===4&&(C=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),S=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),M(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),M(S.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."}),v==null&&(v=[1,1,1]),M(Ge(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),w!=null&&M(ne(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+x+"."});var E=Fa(S.shape,m,g,v,x,w),I=F.runKernelFunc(function(A){return A.avgPool3dBackprop(_,S,E)},{dy5D:_,input5D:S});return C?I.as4D(I.shape[1],I.shape[2],I.shape[3],I.shape[4]):I}(d,u,e,t,a,n,i)}}});return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),kn=D({slice_:function(r,e,t){var n,i,o=k(r,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){M(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(u,c){return u>=0?u:(M(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),o.shape[c]-n[c])}),Sv(o,n,i);var a=o.shape,s={begin:n,size:i};return F.runKernelFunc(function(u){return u.slice(o,n,i)},{x:o},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([n[l],a[l]-n[l]-i[l]]);return{x:function(){return u.pad(c)}}},"Slice",s)}}),eE=D({slice1d_:function(r,e,t){var n=k(r,"x","slice1d");return M(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),kn(n,[e],[t])}}),nE=D({slice2d_:function(r,e,t){var n=k(r,"x","slice2d");return M(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),kn(n,e,t)}}),zh=D({slice3d_:function(r,e,t){var n=k(r,"x","slice3d");return M(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),kn(n,e,t)}}),rE=D({slice4d_:function(r,e,t){var n=k(r,"x","slice4d");return M(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),kn(n,e,t)}});function I0(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(He(e.shape,n))),r.rank<t.rank&&(r=r.reshape(He(r.shape,n))),{x:function(){var o=r.mul(t.equal(e).cast(r.dtype));return i==null?o:o.transpose(i)}}}var iE=D({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","all","bool"),i=me(e,n.shape),o=i,a=Mn(o,n.rank);a!=null&&(n=n.transpose(a),o=Rn(o.length,n.rank));var s=F.runKernelFunc(function(c){return c.all(n,o)},{$x:n});if(t){var u=He(s.shape,i);return s.reshape(u)}return s}}),oE=D({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","any","bool"),i=me(e,n.shape),o=i,a=Mn(o,n.rank);a!=null&&(n=n.transpose(a),o=Rn(o.length,n.rank));var s=F.runKernelFunc(function(c){return c.any(n,o)},{$x:n});if(t){var u=He(s.shape,i);return s.reshape(u)}return s}}),aE=D({argMax_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMax");e==null&&(e=0);var n=me(e,t.shape),i=Mn(n,t.rank);i!=null&&(t=t.transpose(i),n=Rn(n.length,t.rank));var o={axis:n[0]},a=[t];return F.runKernelFunc(function(s,u){var c=s.argMax(t,n[0]);return u([t]),c},{x:t},function(s,u){var c=u[0];return{x:function(){return It(c)}}},"ArgMax",o,a)}}),sE=D({argMin_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMin");e==null&&(e=0);var n=me(e,t.shape),i=Mn(n,t.rank);return i!=null&&(t=t.transpose(i),n=Rn(n.length,t.rank)),F.runKernelFunc(function(o,a){var s=o.argMin(t,n[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return It(s)}}})}}),uE=D({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","logSumExp"),i=me(e,n.shape),o=n.max(i,!0),a=n.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=He(s.shape,i);return s.reshape(u)}return s}}),Ai=D({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","max"),i=n,o=me(e,n.shape),a=o,s=Mn(a,n.rank);s!=null&&(n=n.transpose(s),a=Rn(a.length,n.rank));var u=[n],c=F.runKernelFunc(function(h,d){var f=h.max(n,a);return d([i,f]),f},{x:n},function(h,d){return I0(h,d[1],d[0],o,s)},"Max",{axes:a},u,[!0]);if(t){var l=He(c.shape,o);c=c.reshape(l)}return c}}),cE=D({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","mean"),i=me(e,n.shape),o=at(Re(n.shape,i)[1]);return Ou(function(a){var s=Z(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var c=a.shape.slice();return i.forEach(function(l){c[l]=1}),u.reshape(c).mul(To(a.shape,"float32")).div(o)}}})(n)}}),lE=D({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","min"),i=n,o=me(e,n.shape),a=o,s=Mn(a,n.rank);s!=null&&(n=n.transpose(s),a=Rn(a.length,n.rank));var u=[n],c=F.runKernelFunc(function(h,d){var f=h.min(n,a);return d([i,f]),f},{x:n},function(h,d){return I0(h,d[1],d[0],o,s)},"Min",{axes:a},u,[!0]);if(t){var l=He(c.shape,o);c=c.reshape(l)}return c}}),hE=D({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=me(e,(r=k(r,"x","moments")).shape),i=r.mean(n,t),o=i.shape;t||(o=He(i.shape,n));var a=r.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(n,t)}}}),M0=D({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=me(e,n.shape);return Ou(function(o){var a=Mn(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=Rn(s.length,o.rank));var c=function(f){var p=o.shape.slice();return i.forEach(function(m){p[m]=1}),f.reshape(p).mul(To(o.shape,"float32"))},l={axes:s},h=F.runKernelFunc(function(f){return f.sum(u,s)},{x:u},function(f){return{x:function(){return c(f)}}},"Sum",l);if(t){var d=He(h.shape,i);h=h.reshape(d)}return{value:h,gradFunc:c}})(n)}}),dE=D({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=me(e,n.shape),o=Mn(i,n.rank),a=i,s=n;o!=null&&(s=n.transpose(o),a=Rn(a.length,n.rank));var u=F.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(t){var c=He(u.shape,i);u=u.reshape(c)}return u}}),R0=D({elu_:function(r){var e=k(r,"x","elu");return F.runKernelFunc(function(t,n){var i=t.elu(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return F.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),fE=D({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=k(r,"x","leakyRelu");return Lh(Z(e).mul(t),t)}}),A0=D({prelu_:function(r,e){var t=k(r,"x","prelu"),n=k(e,"alpha","prelu");return F.runKernelFunc(function(i,o){var a=i.prelu(t,n);return o([t,n]),a},{x:t,alpha:n},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return Ii(u,i,i.mul(s))},alpha:function(){var c=Ii(u,It(i),i.mul(a)),l=pe(s.shape,i.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),Ft=D({relu_:function(r){var e=k(r,"x","relu");return e.dtype==="bool"?e.toInt():F.runKernelFunc(function(t,n){var i=t.relu(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),D0=D({relu6_:function(r){var e=k(r,"x","relu6");return e.dtype==="bool"?e.toInt():F.runKernelFunc(function(t,n){var i=t.relu6(e);return n([e]),i},{x:e},function(t,n){var i=n[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),pE=D({selu_:function(r){var e=k(r,"x","selu");return F.runKernelFunc(function(t,n){var i=t.selu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){var o=i.greater(Z(0)),a=Z(Ph),s=Z(Fh),u=t.mul(s),c=t.mul(a).mul(i.toFloat().exp());return Ii(o,u,c)}}})}}),bn=D({transpose_:function(r,e){var t=k(r,"x","transpose");if(e==null&&(e=t.shape.map(function(i,o){return o}).reverse()),M(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){M(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var n={perm:e};return F.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var o=Du(e);return{x:function(){return i.transpose(o)}}},"Transpose",n)}}),mE=D({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var o=k(r,"x","localResponseNormalization");M(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),M(ne(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=F.runKernelFunc(function(c,l){var h=c.localResponseNormalization4D(a,e,t,n,i);return l([a,h]),h},{x4D:a},function(c,l){var h=l[0],d=l[1];return{x4D:function(){return F.runKernelFunc(function(f){return f.LRNGrad(c,h,d,e,t,n,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),T0=D({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(Z(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(r=k(r,"x","norm"),e,t),o=i.shape;if(n){var a=me(t,r.shape);o=He(i.shape,a)}return i.reshape(o)}}),gE=D({basicLSTMCell_:function(r,e,t,n,i,o){var a=k(r,"forgetBias","basicLSTMCell"),s=k(e,"lstmKernel","basicLSTMCell"),u=k(t,"lstmBias","basicLSTMCell"),c=k(n,"data","basicLSTMCell"),l=k(i,"c","basicLSTMCell"),h=k(o,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),v=d.slice([0,p],m),x=d.slice([0,2*p],m),w=d.slice([0,3*p],m),b=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(x).sigmoid())),y=b.tanh().mulStrict(w.sigmoid());return[b,y]}}),vE=D({multiRNNCell_:function(r,e,t,n){for(var i=k(e,"data","multiRNNCell"),o=yu(t,"c","multiRNNCell"),a=yu(n,"h","multiRNNCell"),s=i,u=[],c=0;c<r.length;c++){var l=r[c](s,o[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),xE=D({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var o=k(r,"v","movingAverage"),a=k(e,"x","movingAverage"),s=k(t,"decay","movingAverage");Bg(o,a),M(fe(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Z(1),c=u.sub(s),l=a.sub(o).mul(c);if(i){M(n!=null,function(){return"When using zeroDebias: true, step is required."});var h=k(n,"step","movingAverage");l=l.div(u.sub(Iu(s,h)))}return o.add(l)}}),bE=D({stridedSlice_:function(r,e,t,n,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),n==null&&(n=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=k(r,"x","stridedSlice"),l=ih(s),h=c.shape.slice();l.forEach(function(g){e[g]=0,t[g]=1,h.splice(g,0,1)}),c=c.reshape(h);for(var d=0;d<c.rank;d++)e[d]=Ev(i,e,n,c.shape,d),t[d]=kv(o,t,n,c.shape,d),n[d]=n[d]||1;var f=ih(u);f.forEach(function(g){t[g]=e[g]+1,n[g]=1});var p=Fu(e,t,n),m=p.filter(function(g,v){return f.indexOf(v)===-1});return n.every(function(g){return g===1})?kn(c,e,p).reshape(m):F.runKernelFunc(function(g){return g.stridedSlice(c,e,t,n)},{$x:c}).reshape(m)}}),yE=D({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=k(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=F.runKernelFunc(function(a){return a.topk(n,e,t)},{$x:n});return{values:o[0],indices:o[1]}}}),wE=D({scatterND_:function(r,e,t){var n=k(r,"indices","scatterND","int32"),i=k(e,"updates","scatterND");return Cv(i,n,t),F.runKernelFunc(function(o){return o.scatterND(n,i,t)},{indices:n,updates:i},null,"ScatterNd",{shape:t})}}),Vh=D({fft_:function(r){M(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return F.runKernelFunc(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),Mu=D({ifft_:function(r){M(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return F.runKernelFunc(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),Uh=D({rfft_:function(r,e){M(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var o=r.shape.map(function(v){return 0}),a=r.shape.map(function(v){return v});a[r.shape.length-1]=e,t=r.slice(o,a),n=e}else if(e!=null&&e>n){var s=r.shape.map(function(v){return v});s[r.shape.length-1]=e-n,t=r.concat(Gt(s),r.shape.length-1),n=e}else t=r;var u=t.zerosLike(),c=Me(t,u).as2D(i,n),l=Vh(c),h=Math.floor(n/2)+1,d=vn(l),f=Gn(l),p=d.split([h,n-h],d.shape.length-1),m=f.split([h,n-h],f.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=h,Me(p[0],m[0]).reshape(g)}}),P0=D({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=Mu(n);return vn(i)}var o=[t,2*(e-1)],a=vn(r).as2D(t,e),s=Gn(r).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),c=s.slice([0,1],[t,e-2]).reverse(1).mul(Z(-1)),l=a.concat(u,1),h=s.concat(c,1);return n=Me(l,h).as2D(o[0],o[1]),i=Mu(n),vn(i)}}),_E=Object.freeze({fft:Vh,ifft:Mu,rfft:Uh,irfft:P0}),CE=D({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=k(r,"sparseIndices","sparseToDense","int32"),o=k(e,"sparseValues","sparseToDense"),a=k(n,"defaultValue","sparseToDense",o.dtype);return function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(c.length!==d)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+d+".");var f=u.size;if(u.rank!==0&&(u.rank!==1||f!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,a),F.runKernelFunc(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),SE=D({gatherND_:function(r,e){var t=k(e,"indices","gatherND","int32"),n=k(r,"x","gatherND");return F.runKernelFunc(function(i){return i.gatherND(n,t)},{x:n,indices:t},null,"GatherNd")}}),EE=D({diag_:function(r){var e=k(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return F.runKernelFunc(function(n){return n.diag(e)},{$x:e}).reshape(t)}}),kE=D({dropout_:function(r,e,t,n){var i=k(r,"x","dropout");if(M(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),M(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof zt?i.clone():i;var o=function(u,c){if(c==null)return u.shape.slice();if(fe(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],h=0;h<u.shape.length;h++)c[h]==null&&u.shape[h]!=null?l.push(u.shape[h]):l.push(c[h]);return l}return c}(i,t),a=1-e,s=vv(o,0,1,"float32",n).add(a).floor().div(a);return i.mul(s)}});function F0(r,e,t){for(var n=1-r%2,i=new Float32Array(r),o=0;o<r;++o){var a=2*Math.PI*o/(r+n-1);i[o]=e-t*Math.cos(a)}return jt(i,"float32")}var jh=D({hannWindow_:function(r){return F0(r,.5,.5)}}),O0=D({hammingWindow_:function(r){return F0(r,.54,.46)}}),Hh=D({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=r.size;)a.push(kn(r,o,e)),o+=t;if(n)for(;o<r.size;){var s=o+e-r.size,u=Jt([kn(r,o,e-s),dn([s],i)]);a.push(u),o+=t}return a.length===0?qn([],[0,e]):Jt(a).as2D(a.length,e)}}),N0=D({stft_:function(r,e,t,n,i){var o;i===void 0&&(i=jh),n==null&&(o=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=Hh(r,e,t),s=ee(a,i(e)),u=[],c=0;c<a.shape[0];c++)u.push(Uh(s.slice([c,0],[1,e]),n));return Jt(u)}}),IE=Object.freeze({hannWindow:jh,hammingWindow:O0,frame:Hh,stft:N0}),We,ME=function(r,e,t){return t===void 0&&(t=1),it(this,void 0,void 0,function(){var n,i,o,a,s,u,c,l,h,d,f,p,m,g;return ot(this,function(v){switch(v.label){case 0:return n=k(r,"predictions","inTopK"),i=k(e,"targets","inTopK"),M(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),M(n.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank}),Pt(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=n.shape[n.shape.length-1],M(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,n.data()];case 1:return a=v.sent(),[4,i.data()];case 2:for(s=v.sent(),u=[a.length/o,o],l=u[1],h=Mo("bool",c=u[0]),d=0;d<c;d++){for(f=d*l,p=a.subarray(f,f+l),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(x,w){return w.value-x.value}),h[d]=0,g=0;g<t;g++)if(m[g].index===s[d]){h[d]=1;break}}return r!==n&&n.dispose(),e!==i&&i.dispose(),[2,Ce(h,i.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(We||(We={}));var RE=D({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=We.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","absoluteDifference"),o=k(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=k(t,"weights","absoluteDifference")),Pt(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return wr(s,a,n)}}),wr=D({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=We.SUM_BY_NONZERO_WEIGHTS);var n=k(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=k(e,"weights","computeWeightedLoss"));var o=i==null?n:n.mul(i);if(t===We.NONE)return o;if(t===We.SUM)return o.sum();if(t===We.MEAN){if(i==null)return o.mean();var a=n.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Z(a)):s}if(t===We.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Z(n.size));var u=i.mul(To(n.shape)).notEqual(Z(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),AE=D({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=We.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","cosineDistance"),a=k(e,"predictions","cosineDistance"),s=null;n!=null&&(s=k(n,"weights","cosineDistance")),Pt(o.shape,a.shape,"Error in cosineDistance: ");var u=Z(1).sub(o.mul(a).sum(t,!0));return wr(u,s,i)}}),DE=D({hingeLoss_:function(r,e,t,n){n===void 0&&(n=We.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","hingeLoss"),o=k(e,"predictions","hingeLoss"),a=null;t!=null&&(a=k(t,"weights","hingeLoss")),Pt(i.shape,o.shape,"Error in hingeLoss: ");var s=Z(1);i=Z(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return wr(u,a,n)}}),TE=D({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=We.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","huberLoss"),a=k(e,"predictions","huberLoss"),s=null;t!=null&&(s=k(t,"weights","huberLoss")),Pt(o.shape,a.shape,"Error in huberLoss: ");var u=Z(n),c=a.sub(o).abs(),l=g0(c,u),h=c.sub(l),d=Z(.5).mul(l.square()).add(u.mul(h));return wr(d,s,i)}}),PE=D({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=We.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"labels","logLoss"),a=k(e,"predictions","logLoss"),s=null;t!=null&&(s=k(t,"weights","logLoss")),Pt(o.shape,a.shape,"Error in logLoss: ");var u=Z(1),c=Z(n),l=o.mul(a.add(c).log()).neg().sub(u.sub(o).mul(u.sub(a).add(c).log()));return wr(l,s,i)}}),FE=D({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=We.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","meanSquaredError"),o=k(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=k(t,"weights","meanSquaredError")),Pt(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return wr(s,a,n)}}),OE=D({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=We.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"multiClassLabels","sigmoidCrossEntropy"),a=k(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","sigmoidCrossEntropy")),Pt(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Z(n),c=Z(1),l=Z(.5);o=o.mul(c.sub(u)).add(l.mul(u))}var h=function(d,f){var p=k(d,"labels","sigmoidCrossEntropyWithLogits"),m=k(f,"logits","sigmoidCrossEntropyWithLogits");Pt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),x=m.abs().neg().exp().log1p();return g.sub(v).add(x)}(o,a);return wr(h,s,i)}}),NE=D({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=We.SUM_BY_NONZERO_WEIGHTS);var o=k(r,"onehotLabels","softmaxCrossEntropy"),a=k(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","softmaxCrossEntropy")),Pt(o.shape,a.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Z(n),c=Z(1),l=Z(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(l))}var h=function(d,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return Ou(function(m,g,v){var x=g.logSumExp([p],!0),w=g.toFloat().sub(x);return v([m,w]),{value:w.mul(m).neg().sum([p]),gradFunc:function(b,y){var _=y[0],S=y[1],C=He(b.shape,[p]);return[b.reshape(C).mul(_.toFloat().sub(S.exp())),b.reshape(C).mul(S.exp().sub(_.toFloat()))]}}})(d,f)}(o,a);return wr(h,s,i)}}),LE=Object.freeze({get Reduction(){return We},absoluteDifference:RE,computeWeightedLoss:wr,cosineDistance:AE,hingeLoss:DE,huberLoss:TE,logLoss:PE,meanSquaredError:FE,sigmoidCrossEntropy:OE,softmaxCrossEntropy:NE});function lg(r,e){return e===void 0&&(e=!1),F.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=gv(t),o=r.clone(),a=qn([[1]],[1,1]),s=a.clone(),u=t>=n?n:t,c=function(h){var d,f=o,p=s,m=i;d=F.tidy(function(){var g=o.slice([h,h],[t-h,1]),v=g.norm(),x=o.slice([h,h],[1,1]),w=qn([[-1]]).where(x.greater(0),qn([[1]])),b=x.sub(w.mul(v)),y=g.div(b);s=y.shape[0]===1?a.clone():a.concat(y.slice([1,0],[y.shape[0]-1,y.shape[1]]),0);var _=w.matMul(b).div(v).neg(),S=o.slice([h,0],[t-h,n]),C=_.mul(s);if(h===0)o=S.sub(C.matMul(s.transpose().matMul(S)));else{var E=S.sub(C.matMul(s.transpose().matMul(S)));o=o.slice([0,0],[h,n]).concat(E,0)}var I=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=I.sub(I.matMul(s).matMul(C.transpose()));else{var A=I.sub(I.matMul(s).matMul(C.transpose()));i=i.slice([0,0],[t,h]).concat(A,1)}return[s,o,i]}),s=d[0],o=d[1],i=d[2],tn([f,p,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(i=i.slice([0,0],[t,n]),o=o.slice([0,0],[n,n])),[i,o]})}var BE=D({bandPart_:function(r,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var n=k(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var i=n.shape,o=n.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=wu(0,a,1,"int32").reshape([-1,1]),c=wu(0,s,1,"int32"),l=Vt(u,c),h=Wu(l.lessEqual(Z(+e,"int32")),l.greaterEqual(Z(-t,"int32"))),d=Gt([a,s],n.dtype);return De(Nt(n.reshape([-1,a,s])).map(function(f){return Ii(h,f,d)})).reshape(i)}}),WE=D({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,M(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){M(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+t+")"})},i=1;i<r.length;++i)n(i)}else e=!0,r=yh(r,r.shape[0],0).map(function(u){return bv(u,[0])});M(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var o=[],a=r,s=function(u){o.push(F.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var h=M0(o[l].mulStrict(c)).mul(o[l]);c=c.sub(h)}return c.div(T0(c,"euclidean"))}))};for(i=0;i<r.length;++i)s(i);return e?De(o,0):o}}),zE=D({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return lg(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(a,s){return a*s}),n=Nt(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],o=[];return n.forEach(function(a){var s=lg(a,e),u=s[0],c=s[1];i.push(u),o.push(c)}),[De(i,0).reshape(r.shape),De(o,0).reshape(r.shape)]}}),VE=Object.freeze({bandPart:BE,gramSchmidt:WE,qr:zE});function zu(r,e,t,n,i,o){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=r.shape[0];return t=Math.min(t,a),M(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),M(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),M(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),M(e.rank===1,function(){return"scores must be a 1D tensor"}),M(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),M(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i,softNmsSigma:o}}var UE=D({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeBilinear");M(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),M(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=F.runKernelFunc(function(c,l){return l([i]),c.resizeBilinear(i,a,s,t)},{x:i},function(c,l){return{x:function(){return F.runKernelFunc(function(h){return h.resizeBilinearBackprop(c,l[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jE=D({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeNearestNeighbor");M(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),M(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),M(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=F.runKernelFunc(function(c,l){return l([i]),c.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(c,l){return{batchImages:function(){return F.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(c,l[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),HE=D({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=k(r,"boxes","nonMaxSuppression"),a=k(e,"scores","nonMaxSuppression"),s=zu(o,a,t,n,i);t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:i};return F.runKernelFunc(function(c){return c.nonMaxSuppression(o,a,t,n,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),GE=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),it(this,void 0,void 0,function(){var o,a,s,u,c,l,h;return ot(this,function(d){switch(d.label){case 0:return o=k(r,"boxes","nonMaxSuppressionAsync"),a=k(e,"scores","nonMaxSuppressionAsync"),s=zu(o,a,t,n,i),t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],h=Rh(c,l,t,n,i),o!==r&&o.dispose(),a!==e&&a.dispose(),[2,h]}})})},qE=D({nonMaxSuppressionWithScore_:function(r,e,t,n,i,o){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=k(r,"boxes","nonMaxSuppression"),s=k(e,"scores","nonMaxSuppression"),u=zu(a,s,t,n,i,o),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:n=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},l=F.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),XE=function(r,e,t,n,i,o){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),it(this,void 0,void 0,function(){var a,s,u,c,l,h,d;return ot(this,function(f){switch(f.label){case 0:return a=k(r,"boxes","nonMaxSuppressionAsync"),s=k(e,"scores","nonMaxSuppressionAsync"),u=zu(a,s,t,n,i,o),t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=f.sent(),l=c[0],h=c[1],d=Ah(l,h,t,n,i,o),a!==r&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},KE=D({cropAndResize_:function(r,e,t,n,i,o){var a=k(r,"image","cropAndResize"),s=k(e,"boxes","cropAndResize","float32"),u=k(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=s.shape[0];return M(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),M(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),M(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),M(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),M(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),M(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),F.runKernelFunc(function(l,h){return l.cropAndResize(a,s,u,n,i,o)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:n})}}),Ga=Object.freeze({resizeBilinear:UE,resizeNearestNeighbor:jE,nonMaxSuppression:HE,nonMaxSuppressionAsync:GE,nonMaxSuppressionWithScore:qE,nonMaxSuppressionWithScoreAsync:XE,cropAndResize:KE}),Gh=function(r,e){return!(r>0)||e==="linear"},qh=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Xh=function(r,e){var t=e,n=pe(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},Kh=function(r,e,t){if(e==="linear")return r;if(e==="relu")return Ft(r);if(e==="elu")return R0(r);if(e==="relu6")return D0(r);if(e==="prelu")return A0(r,t);throw new Error("Unknown fused activation "+e+".")},YE=D({fusedMatMul_:function(r){var e,t=r.a,n=r.b,i=r.transposeA,o=i!==void 0&&i,a=r.transposeB,s=a!==void 0&&a,u=r.bias,c=r.activation,l=c===void 0?"linear":c,h=r.preluActivationWeights;if(Gh(F.state.gradientDepth,l)===!1){var d=Po(t,n,o,s);return u!=null&&(d=lt(d,u)),Kh(d,l,h)}var f=k(t,"a","fused matMul"),p=k(n,"b","fused matMul");e=Qt(f,p),f=e[0],p=e[1];var m=o?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=o?f.shape[f.rank-1]:f.shape[f.rank-2],x=s?p.shape[p.rank-2]:p.shape[p.rank-1],w=f.shape.slice(0,-2),b=p.shape.slice(0,-2),y=at(w),_=at(b);M(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),M(fe(w,b),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+b+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),M(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var S,C,E=f.shape.slice(0,-2).concat([v,x]),I=o?f.as3D(y,m,v):f.as3D(y,v,m),A=s?p.as3D(_,x,g):p.as3D(_,g,x);u!=null&&yt(E,(S=Qt(S=k(u,"bias","fused matMul"),f)[0]).shape),h!=null&&(C=k(h,"prelu weights","fused matMul"));var R={a:I,b:A};u!=null&&(R.bias=S),h!=null&&(R.preluActivationWeights=C);var L=[I,A];return F.runKernelFunc(function(B,O){var V=B.fusedBatchMatMul({a:I,b:A,transposeA:o,transposeB:s,bias:S,activation:l,preluActivationWeights:C});return O([I,A,V]),V},R,function(B,O){var V=O[0],z=O[1],U=O[2],H=qh(B,U,l),K={};return u!=null&&(K={bias:function(){return Xh(S,H)}}),Object.assign(o||s?!o&&s?{a:function(){return H.matMul(z,!1,!1)},b:function(){return H.matMul(V,!0,!1)}}:o&&!s?{a:function(){return z.matMul(H,!1,!0)},b:function(){return V.matMul(H,!1,!1)}}:{a:function(){return z.matMul(H,!0,!0)},b:function(){return H.matMul(V,!0,!0)}}:{a:function(){return H.matMul(z,!1,!0)},b:function(){return V.matMul(H,!0,!1)}},K)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:l},L,[!0]).reshape(E)}}),$E=D({fusedConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,h=r.activation,d=h===void 0?"linear":h,f=r.preluActivationWeights;if(d=d||"linear",Gh(F.state.gradientDepth,d)===!1){var p=Se(e,t,n,i,a,u,c);return l!=null&&(p=lt(p,l)),Kh(p,d,f)}var m=k(e,"x","conv2d"),g=k(t,"filter","conv2d"),v=m,x=!1;m.rank===3&&(x=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),M(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),M(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),c!=null&&M(ne(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),M(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),M(Ge(n,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),M(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var w,b,y=$r(v.shape,g.shape,n,u,i,c);l!=null&&(w=Qt(w=k(l,"bias","fused conv2d"),m)[0],yt(y.outShape,w.shape)),f!=null&&(b=k(f,"prelu weights","fused conv2d"));var _={x:v,filter:g};l!=null&&(_.bias=w),f!=null&&(_.preluActivationWeights=b);var S=[g,v],C=F.runKernelFunc(function(E,I){var A=E.fusedConv2d({input:v,filter:g,convInfo:y,bias:w,activation:d,preluActivationWeights:b});return I([g,v,A]),A},_,function(E,I){var A=I,R=A[0],L=A[1],B=A[2],O=qh(E,B,d);M(ki(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var V={};return l!=null&&(V={bias:function(){return Xh(w,O)}}),Object.assign({x:function(){return _0(L.shape,O,R,n,i)},filter:function(){return Wh(L,O,R.shape,n,i)}},V)},"FusedConv2D",{convInfo:y,activation:d},S,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),JE=D({fusedDepthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,h=r.activation,d=h===void 0?"linear":h,f=r.preluActivationWeights;if(Gh(F.state.gradientDepth,d)===!1){var p=Ua(e,t,n,i,a,u,c);return l!=null&&(p=lt(p,l)),Kh(p,d,f)}var m=k(e,"x","depthwiseConv2d"),g=k(t,"filter","depthwiseConv2d"),v=m,x=!1;m.rank===3&&(x=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),M(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),M(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),M(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),M(Ge(n,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"}),c!=null&&M(ne(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var w,b,y=$r(v.shape,g.shape,n,u,i,c,!0);l!=null&&(w=Qt(w=k(l,"bias","fused conv2d"),m)[0],yt(y.outShape,w.shape)),f!=null&&(b=k(f,"prelu weights","fused depthwiseConv2d"));var _={x:v,filter:g};l!=null&&(_.bias=w),f!=null&&(_.preluActivationWeights=b);var S=[g,v],C=F.runKernelFunc(function(E,I){var A=E.fusedDepthwiseConv2D({input:v,filter:g,convInfo:y,bias:w,activation:d,preluActivationWeights:b});return I([g,v,A]),A},_,function(E,I){M(ki(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var A=I[0],R=I[1],L=I[2],B=qh(E,L,d),O={};return l!=null&&(O={bias:function(){return Xh(w,B)}}),Object.assign({x:function(){return C0(R.shape,B,A,y)},filter:function(){return S0(R,B,A.shape,y)}},O)},"FusedDepthwiseConv2D",{convInfo:y,activation:d},S,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),QE=Object.freeze({matMul:YE,conv2d:$E,depthwiseConv2d:JE}),ZE=Object.freeze({image:Ga,linalg:VE,losses:LE,spectral:_E,fused:QE,signal:IE,square:PC,squaredDifference:u0,conv1d:US,conv2d:Se,conv3d:jS,depthwiseConv2d:Ua,separableConv2d:ja,conv2dTranspose:HS,conv3dTranspose:GS,op:D,batchNormalization2d:cS,batchNormalization3d:lS,batchNormalization4d:hS,batchNormalization:dS,batchNorm:Nh,batchNorm2d:fS,batchNorm3d:pS,batchNorm4d:mS,booleanMaskAsync:VS,complex:Me,real:vn,imag:Gn,concat:Jt,concat1d:y_,concat2d:w_,concat3d:__,concat4d:C_,split:yh,matMul:Po,dot:qS,outerProduct:XS,reverse:Ha,reverse1d:KS,reverse2d:YS,reverse3d:$S,reverse4d:JS,maxPool:re,avgPool:yr,pool:QS,maxPool3d:ZS,avgPool3d:tE,slice:kn,slice1d:eE,slice2d:nE,slice3d:zh,slice4d:rE,abs:FC,acos:OC,acosh:NC,asin:LC,asinh:BC,atan:WC,atanh:zC,ceil:VC,clipByValue:Wa,cos:UC,cosh:jC,erf:HC,exp:Lu,expm1:GC,floor:qC,log:XC,log1p:KC,logSigmoid:YC,neg:za,reciprocal:$C,round:JC,rsqrt:c0,sigmoid:Oh,sign:QC,isNaN:ZC,isInf:tS,isFinite:eS,sin:nS,sinh:rS,softplus:iS,sqrt:oS,step:aS,tan:sS,tanh:uS,all:iE,any:oE,argMax:aE,argMin:sE,logSumExp:uE,max:Ai,mean:cE,min:lE,moments:hE,sum:M0,prod:dE,equal:v0,equalStrict:DS,greater:TS,greaterEqual:x0,greaterEqualStrict:PS,greaterStrict:FS,less:OS,lessEqual:NS,lessEqualStrict:LS,lessStrict:BS,notEqual:WS,notEqualStrict:zS,add:lt,addN:xS,addStrict:bS,atan2:yS,div:xn,divNoNan:wS,divStrict:_S,floorDiv:m0,maximum:Lh,maximumStrict:CS,minimum:g0,minimumStrict:SS,mod:ES,modStrict:kS,mul:ee,mulStrict:IS,pow:Iu,powStrict:MS,squaredDifferenceStrict:RS,sub:Vt,subStrict:AS,elu:R0,leakyRelu:fE,prelu:A0,relu:Ft,relu6:D0,selu:pE,logicalAnd:Wu,logicalNot:gS,logicalOr:f0,logicalXor:vS,where:Ii,whereAsync:p0,buffer:mt,print:T_,batchToSpaceND:mv,broadcastTo:P_,cast:F_,clone:O_,cumsum:N_,depthToSpace:L_,expandDims:Le,eye:gv,multinomial:B_,oneHot:rh,pad:br,pad1d:W_,pad2d:z_,pad3d:V_,pad4d:U_,rand:j_,randomNormal:H_,randomGamma:G_,randomUniform:vv,reshape:qe,spaceToBatchND:xv,squeeze:bv,stack:De,tile:Ci,truncatedNormal:q_,unstack:Nt,setdiff1dAsync:X_,fill:dn,linspace:b_,ones:To,range:wu,scalar:Z,tensor:Ce,tensor1d:jt,tensor2d:qn,tensor3d:Tu,tensor4d:xe,tensor5d:g_,tensor6d:v_,variable:x_,zeros:Gt,onesLike:pv,zerosLike:It,transpose:bn,softmax:Xe,logSoftmax:Y_,localResponseNormalization:mE,norm:T0,gather:Bh,unsortedSegmentSum:b0,basicLSTMCell:gE,multiRNNCell:vE,movingAverage:xE,stridedSlice:bE,topk:yE,scatterND:wE,fft:Vh,ifft:Mu,rfft:Uh,irfft:P0,sparseToDense:CE,gatherND:SE,diag:EE,dropout:kE,hannWindow:jh,hammingWindow:O0,frame:Hh,stft:N0,inTopKAsync:ME});function q(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&M(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function Ol(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var tk=function(r){function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Iv(t,F),t}return In(e,r),e.prototype.write=function(t,n,i){this.firstUse&&(this.firstUse=!1,j().get("IS_NODE")&&bu(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,n,i,o){this.data.set(t,{values:n,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),i=n.dtype,o=n.complexTensors;return i==="complex64"?ah(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),i=n;if(t.dtype==="string")try{i=n.map(function(o){return Ma(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return mt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,n,i){var o=this.write(t,n,i);return F.makeTensorFromDataId(o,n,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return it(this,void 0,void 0,function(){var n;return ot(this,function(i){return n=Sn(),t(),[2,{kernelMs:Sn()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:F.keep(t.clone()),imag:F.keep(n.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(q(t,"slice"),Sh(t.shape,n,i)){var o=Eh(n,t.strides),a=at(i);return Ce(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=mt(i,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(h,d){return h+n[d]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},e.prototype.stridedSlice=function(t,n,i,o){q(t,"stridedSlice");var a=Fu(n,i,o);if(a.some(function(f){return f===0}))return Ce([],a);for(var s=mt(a,t.dtype),u=this.bufferSync(t),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),h=new Array(l.length),d=0;d<h.length;d++)h[d]=l[d]*o[d]+n[d];s.set.apply(s,[u.get.apply(u,h)].concat(l))}return s.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),i=mt([t.size,t.size],t.dtype),o=i.values,a=0;a<n.length;a++)o[a*t.size+a]=n[a];return i.toTensor()},e.prototype.unstack=function(t,n){for(var i=t.shape[n],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[n]=1;var l=new Array(i);for(s=0;s<l.length;s++)u[n]=s,l[s]=this.slice(t,u,c).reshape(o);return l},e.prototype.reverse=function(t,n){q(t,"reverse");for(var i=mt(t.shape,t.dtype),o=this.bufferSync(t),a=function(u){var c=i.indexToLoc(u),l=c.slice();n.forEach(function(h){return l[h]=t.shape[h]-1-l[h]}),i.set.apply(i,[o.get.apply(o,l)].concat(c))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(t,n){var i=this;if(t[0].dtype==="complex64"){var o=t.map(function(f){return vn(f)}),a=t.map(function(f){return Gn(f)});return Me(this.concat(o,n),this.concat(a,n))}var s=t.map(function(f){var p=at(f.shape.slice(n));return f.as2D(-1,p)}),u=Ei(s.map(function(f){return f.shape}),1),c=mt(u,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(f){c.set(i.readSync(f.dataId),l),l+=f.size})}else{var h=0;s.forEach(function(f){for(var p=i.readSync(f.dataId),m=0,g=0;g<f.shape[0];++g)for(var v=g*u[1]+h,x=0;x<f.shape[1];++x)c[v+x]=p[m++];h+=f.shape[1]})}var d=Ei(t.map(function(f){return f.shape}),n);return Ce(c,d,t[0].dtype)},e.prototype.neg=function(t){return q(t,"neg"),this.multiply(Z(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(t,n,_e(t.dtype,n.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var n=this;q(t,"addN");for(var i=t.map(function(l){return n.readSync(l.dataId)}),o=mt(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var u=i[s],c=0;c<a.length;c++)a[c]+=u[c];return o.toTensor()},e.prototype.softmax=function(t,n){var i=me([n],t.shape),o=this.max(t,i),a=He(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),c=this.sum(u,i).reshape(a);return this.realDivide(u,c)},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(t,n,_e(t.dtype,n.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,n){return q([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,n,i,o){q([t,n],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],u=o?n.shape[1]:n.shape[2],c=t.shape[0],l=this.readSync(t.dataId),h=this.readSync(n.dataId),d=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=d[0],p=d[1],m=d[2],g=o?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],v=g[0],x=g[1],w=g[2],b=s*u,y=mt([c,s,u],t.dtype),_=y.values,S=this.blockSize,C=0;C<c;C++)for(var E=0;E<s;E+=S)for(var I=0;I<u;I+=S)for(var A=0;A<a;A+=S)for(var R=Math.min(E+S,s),L=Math.min(I+S,u),B=Math.min(A+S,a),O=E;O<R;O++)for(var V=I;V<L;V++){for(var z=0,U=A;U<B;U++)z+=l[C*f+O*p+U*m]*h[U*v+V*x+C*w];_[C*b+(O*u+V)]+=z}return y.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=this.batchMatMul(n,i,o,a);return s&&(l=this.add(l,s)),u&&(l=Ol(this,l,u,c)),l},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(t,n,_e(t.dtype,n.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(t,n){return q([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(t,n){return q([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,n){q(t,"sum"),Qe("sum",n,t.rank);for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,_e(t.dtype,"int32")),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=0,p=0;p<u;++p)f+=l[d+p];c[h]=f}return s},e.prototype.prod=function(t,n){q(t,"sum");for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,_e(t.dtype,"int32")),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=1,p=0;p<u;++p)f*=l[d+p];c[h]=f}return s},e.prototype.unsortedSegmentSum=function(t,n,i){q(t,"unsortedSegmentSum");for(var o=[],a=t.rank-n.rank,s=0;s<a;++s)n=n.expandDims(s+1);for(s=0;s<i;++s){var u=Z(s,"int32"),c=v0(u,n).asType("float32").mul(t).sum(0);o.push(c)}return De(o)},e.prototype.argMin=function(t,n){q(t,"argMin");var i=[n];Qe("argMin",i,t.rank);for(var o=Re(t.shape,i),a=o[0],s=o[1],u=Gt(a,"int32"),c=at(s),l=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*c,p=h[f],m=0,g=0;g<c;++g){var v=h[f+g];v<p&&(p=v,m=g)}l[d]=m}return u},e.prototype.argMax=function(t,n){q(t,"argMax");var i=[n];Qe("argMax",i,t.rank);for(var o=Re(t.shape,i),a=o[0],s=o[1],u=Gt(a,"int32"),c=at(s),l=this.readSync(u.dataId),h=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*c,p=h[f],m=0,g=0;g<c;++g){var v=h[f+g];v>p&&(p=v,m=g)}l[d]=m}return u},e.prototype.cumsum=function(t,n,i,o){if(q(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var a=_e(t.dtype,"int32"),s=Gt(t.shape,a),u=this.readSync(s.dataId),c=this.readSync(t.dataId),l=t.shape[t.rank-1],h=o?function(g,v){return g+l-v-1}:function(g,v){return g+v},d=0;d<c.length;d+=l)for(var f=0;f<l;f++){var p=h(d,f);if(f===0)u[p]=i?0:c[p];else{var m=h(d,f-1);u[p]=i?c[m]+u[m]:c[p]+u[m]}}return s},e.prototype.equal=function(t,n){return q([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,n){return q([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,n){return q([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,n){return q([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,n){return q([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,n){return q([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){q(t,"logicalNot");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return q([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,n){return q([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(i,o){return i||o})},e.prototype.select=function(t,n,i){q([t,n,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(n.dataId),s=this.readSync(i.dataId),u=Gt(n.shape,_e(n.dtype,i.dtype)),c=this.readSync(u.dataId),l=0,h=t.rank===0||t.rank>1||n.rank===1?1:at(n.shape.slice(1)),d=0;d<o.length;d++)for(var f=0;f<h;f++)o[d]===1?c[l++]=a[d]:c[l++]=s[d];return u},e.prototype.where=function(t){q([t],"where");var n=this.readSync(t.dataId);return Dh(t.shape,n)},e.prototype.topk=function(t,n,i){return q(t,"topk"),Tv(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){q(t,"min"),Qe("min",n,t.rank);for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,t.dtype),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var m=l[d+p];m<f&&(f=m)}c[h]=f}return s},e.prototype.minimum=function(t,n){return q([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,n){return q([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},e.prototype.max=function(t,n){q(t,"max"),Qe("max",n,t.rank);for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,t.dtype),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var m=l[d+p];m>f&&(f=m)}c[h]=f}return s},e.prototype.maximum=function(t,n){return q([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,n){q(t,"all"),Qe("all",n,t.rank);for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,t.dtype),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var m=l[d+p];f=f&&m}c[h]=f}return s},e.prototype.any=function(t,n){q(t,"any"),Qe("any",n,t.rank);for(var i=Re(t.shape,n),o=i[0],a=i[1],s=Gt(o,t.dtype),u=at(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),h=0;h<c.length;++h){for(var d=h*u,f=l[d],p=0;p<u;++p){var m=l[d+p];f=f||m}c[h]=f}return s},e.prototype.squaredDifference=function(t,n){return q([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){var a=i-o;return a*a})},e.prototype.ceil=function(t){q(t,"ceil");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.ceil(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){q(t,"floor");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.floor(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){q(t,"x");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)n[o]<0?i[o]=-1:n[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){q(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isNaN(n[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){q(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Math.abs(n[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){q(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isFinite(n[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){q(t,"round");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=Math.floor(n[o]);n[o]-a<.5?i[o]=Math.floor(n[o]):n[o]-a>.5?i[o]=Math.ceil(n[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){q(t,"exp");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.exp(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){q(t,"expm1");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.expm1(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){q(t,"log");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){q(t,"log1p");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){q(t,"sqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){q(t,"rsqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){q(t,"reciprocal");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=1/n[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){q(t,"relu");for(var n=Gt(t.shape,t.dtype),i=this.readSync(n.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return n},e.prototype.relu6=function(t){q(t,"relu");for(var n=Gt(t.shape,t.dtype),i=this.readSync(n.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return n},e.prototype.prelu=function(t,n){return q([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){q(t,"elu");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];n[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){q([t,n],"eluDer");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,n.shape,"float32")},e.prototype.selu=function(t){q(t,"selu");for(var n=Ph,i=Fh,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:n*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,n,i){q(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<n?n:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.abs(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];n[o]=Math.hypot(a,s)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){q(t,"int");for(var n=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=i[o];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){q(t,"sigmoid");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){q(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-n,u=o[a]<n,c=Math.exp(o[a]),l=void 0;l=u?c:s?o[a]:Math.log(1+c),i[a]=l}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){q(t,"sin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.sin(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){q(t,"cos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.cos(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){q(t,"tan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.tan(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){q(t,"asin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.asin(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){q(t,"acos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.acos(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){q(t,"atan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.atan(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return q([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){q(t,"sinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.sinh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){q(t,"cosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.cosh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){q(t,"tanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=kg(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){q(t,"asinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.asinh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){q(t,"acosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.acosh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){q(t,"atanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.atanh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){q(t,"erf");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);n[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),q(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:n}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.conv2d(n,i,o);return a&&(c=this.add(c,a)),s&&(c=Ol(this,c,s,u)),c},e.prototype.conv2d=function(t,n,i){q([t,n],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,h=i.dataFormat==="channelsLast",d=mt(i.outShape,t.dtype),f=t.strides[0],p=h?t.strides[1]:t.strides[2],m=h?t.strides[2]:1,g=h?1:t.strides[1],v=d.strides[0],x=h?d.strides[1]:d.strides[2],w=h?d.strides[2]:1,b=h?1:d.strides[1],y=this.readSync(t.dataId),_=this.readSync(n.dataId),S=d.values,C=0;C<i.batchSize;++C)for(var E=C*f,I=C*v,A=0;A<i.outHeight;++A)for(var R=I+A*x,L=A*i.strideHeight-l,B=0;B<o;B++){var O=L+B*s;if(!(O<0||O>=i.inHeight))for(var V=B*n.strides[0],z=E+O*p,U=0;U<i.outWidth;++U)for(var H=R+U*w,K=U*i.strideWidth-c,et=0;et<a;et++){var nt=K+et*u;if(!(nt<0||nt>=i.inWidth))for(var st=z+nt*m,ht=V+et*n.strides[1],ft=0;ft<i.inChannels;++ft){for(var pt=y[st+ft*g],St=0;St<i.outChannels;++St)S[H+St*b]+=pt*_[ht+St];ht+=i.outChannels}}}return d.toTensor()},e.prototype.conv3d=function(t,n,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,c=i.dilationHeight,l=i.dilationWidth,h=i.padInfo.front,d=i.padInfo.left,f=i.padInfo.top,p=mt(i.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=p.values,x=0;x<i.batchSize;++x)for(var w=x*t.strides[0],b=x*p.strides[0],y=0;y<i.outDepth;++y)for(var _=b+y*p.strides[1],S=y*i.strideDepth-h,C=0;C<o;C++){var E=S+C*u;if(!(E<0||E>=i.inDepth))for(var I=C*n.strides[0],A=w+E*t.strides[1],R=0;R<i.outHeight;++R)for(var L=_+R*p.strides[2],B=R*i.strideHeight-f,O=0;O<a;O++){var V=B+O*c;if(!(V<0||V>=i.inHeight))for(var z=I+O*n.strides[1],U=A+V*t.strides[2],H=0;H<i.outWidth;++H)for(var K=L+H*i.outChannels,et=H*i.strideWidth-d,nt=0;nt<s;nt++){var st=et+nt*l;if(!(st<0||st>=i.inWidth))for(var ht=z+nt*n.strides[2],ft=U+st*i.inChannels,pt=ht,St=0;St<i.inChannels;++St){for(var _t=m[ft+St],Et=0;Et<i.outChannels;++Et)v[K+Et]+=_t*g[pt+Et];pt+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,n,i){q([t,n],"conv2dDerInput");for(var o=mt(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=n.strides,l=c[0],h=c[1],d=c[2],f=i.batchSize,p=i.filterHeight,m=i.filterWidth,g=i.inChannels,v=i.inHeight,x=i.inWidth,w=i.outChannels,b=i.outHeight,y=i.outWidth,_=i.strideHeight,S=i.strideWidth,C=i.dataFormat,E=p-1-i.padInfo.top,I=m-1-i.padInfo.left,A=C==="channelsLast",R=o.strides[0],L=A?o.strides[1]:o.strides[2],B=A?o.strides[2]:1,O=A?1:o.strides[1],V=t.strides[0],z=A?t.strides[1]:t.strides[2],U=A?t.strides[2]:1,H=A?1:t.strides[1],K=0;K<f;++K)for(var et=0;et<g;++et)for(var nt=0;nt<v;++nt)for(var st=nt-E,ht=Math.max(0,Math.ceil(st/_)),ft=Math.min(b,(p+st)/_),pt=0;pt<x;++pt){for(var St=pt-I,_t=Math.max(0,Math.ceil(St/S)),Et=Math.min(y,(m+St)/S),le=0,Ct=ht;Ct<ft;++Ct)for(var Bt=Ct*_-st,At=_t;At<Et;++At)for(var ae=V*K+z*Ct+U*At,Zt=l*(p-1-Bt)+h*(m-1-(At*S-St))+d*et,te=0;te<w;++te)le+=s[ae+H*te]*u[Zt+te];a[R*K+L*nt+B*pt+O*et]=le}return o.toTensor()},e.prototype.conv3dDerInput=function(t,n,i){for(var o=mt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],c=s[1],l=s[2],h=s[3],d=this.readSync(t.dataId),f=t.strides,p=f[0],m=f[1],g=f[2],v=f[3],x=this.readSync(n.dataId),w=n.strides,b=w[0],y=w[1],_=w[2],S=w[3],C=i.batchSize,E=i.filterDepth,I=i.filterHeight,A=i.filterWidth,R=i.inChannels,L=i.inDepth,B=i.inHeight,O=i.inWidth,V=i.outChannels,z=i.outDepth,U=i.outHeight,H=i.outWidth,K=i.strideDepth,et=i.strideHeight,nt=i.strideWidth,st=E-1-i.padInfo.front,ht=I-1-i.padInfo.top,ft=A-1-i.padInfo.left,pt=0;pt<C;++pt)for(var St=0;St<R;++St)for(var _t=0;_t<L;++_t)for(var Et=_t-st,le=Math.max(0,Math.ceil(Et/K)),Ct=Math.min(z,(E+Et)/K),Bt=0;Bt<B;++Bt)for(var At=Bt-ht,ae=Math.max(0,Math.ceil(At/et)),Zt=Math.min(U,(I+At)/et),te=0;te<O;++te){for(var On=te-ft,Nn=Math.max(0,Math.ceil(On/nt)),sn=Math.min(H,(A+On)/nt),Ki=0,ir=le;ir<Ct;++ir)for(var Or=ir*K-Et,or=ae;or<Zt;++or)for(var Yi=or*et-At,ar=Nn;ar<sn;++ar)for(var rl=p*pt+m*ir+g*or+v*ar,$i=b*(E-1-Or)+y*(I-1-Yi)+_*(A-1-(ar*nt-On))+S*St,Ln=0;Ln<V;++Ln)Ki+=d[rl+Ln]*x[$i+Ln];a[u*pt+c*_t+l*Bt+h*te+St]=Ki}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,n,i){q([t,n],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=i.dataFormat==="channelsLast",l=mt(i.filterShape,"float32"),h=i.padInfo.left,d=i.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(n),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/o)),v=Math.min(i.outHeight,(i.inHeight+d-m)/o),x=0;x<u;++x)for(var w=Math.max(0,Math.ceil((h-x)/a)),b=Math.min(i.outWidth,(i.inWidth+h-x)/a),y=0;y<i.inChannels;++y)for(var _=0;_<i.outChannels;++_){for(var S=0,C=0;C<i.batchSize;++C)for(var E=g;E<v;++E)for(var I=m+E*o-d,A=w;A<b;++A){var R=x+A*a-h;S+=c?f.get(C,I,R,y)*p.get(C,E,A,_):f.get(C,y,I,R)*p.get(C,_,E,A)}l.set(S,m,x,y,_)}return l.toTensor()},e.prototype.conv3dDerFilter=function(t,n,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,h=mt(i.filterShape,"float32"),d=h.values,f=h.strides,p=f[0],m=f[1],g=f[2],v=f[3],x=this.readSync(n.dataId),w=n.strides,b=w[0],y=w[1],_=w[2],S=w[3],C=this.readSync(t.dataId),E=t.strides,I=E[0],A=E[1],R=E[2],L=E[3],B=i.padInfo.front,O=i.padInfo.left,V=i.padInfo.top,z=0;z<u;++z)for(var U=Math.max(0,Math.ceil((B-z)/o)),H=Math.min(i.outDepth,(i.inDepth+B-z)/o),K=z*p,et=0;et<c;++et)for(var nt=Math.max(0,Math.ceil((V-et)/a)),st=Math.min(i.outHeight,(i.inHeight+V-et)/a),ht=et*m+K,ft=0;ft<l;++ft)for(var pt=Math.max(0,Math.ceil((O-ft)/s)),St=Math.min(i.outWidth,(i.inWidth+O-ft)/s),_t=ft*g+ht,Et=0;Et<i.inChannels;++Et)for(var le=Et*v+_t,Ct=0;Ct<i.outChannels;++Ct){for(var Bt=0,At=0;At<i.batchSize;++At)for(var ae=At*I,Zt=At*b,te=U;te<H;++te)for(var On=(z+te*o-B)*A+ae,Nn=te*y+Zt,sn=nt;sn<st;++sn)for(var Ki=(et+sn*a-V)*R+On,ir=sn*_+Nn,Or=pt;Or<St;++Or){var or=Or*S+ir;Bt+=C[(ft+Or*s-O)*L+Ki+Et]*x[or+Ct]}d[le+Ct]=Bt}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(n,i,o);return a&&(c=this.add(c,a)),s&&(c=Ol(this,c,s,u)),c},e.prototype.depthwiseConv2D=function(t,n,i){q([t,n],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,c=i.padInfo.left,l=i.padInfo.top,h=i.outChannels/i.inChannels,d=mt(i.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(n.dataId),m=d.values,g=0;g<i.batchSize;++g)for(var v=g*t.strides[0],x=g*d.strides[0],w=0;w<i.outHeight;++w)for(var b=x+w*d.strides[1],y=w*i.strideHeight-c,_=0;_<o;++_){var S=y+_*s;if(!(S<0||S>=i.inHeight))for(var C=_*n.strides[0],E=v+S*t.strides[1],I=0;I<i.outWidth;++I)for(var A=b+I*d.strides[2],R=I*i.strideWidth-l,L=0;L<a;++L){var B=R+L*u;if(!(B<0||B>=i.inWidth))for(var O=C+L*n.strides[1],V=E+B*i.inChannels,z=A,U=O,H=0;H<i.inChannels;++H){for(var K=f[V+H],et=0;et<h;++et)m[z+et]+=K*p[U+et];z+=h,U+=h}}}return d.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,i){q([t,n],"depthwiseConv2DDerInput");for(var o=mt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],c=s[1],l=s[2],h=this.readSync(t.dataId),d=t.strides,f=d[0],p=d[1],m=d[2],g=this.readSync(n.dataId),v=n.strides,x=v[0],w=v[1],b=v[2],y=i.batchSize,_=i.filterHeight,S=i.filterWidth,C=i.inChannels,E=i.inHeight,I=i.inWidth,A=i.outChannels,R=i.outHeight,L=i.outWidth,B=i.strideHeight,O=i.strideWidth,V=_-1-i.padInfo.top,z=S-1-i.padInfo.left,U=A/C,H=0;H<y;++H)for(var K=0;K<C;++K)for(var et=0;et<E;++et)for(var nt=et-V,st=Math.max(0,Math.ceil(nt/B)),ht=Math.min(R,(_+nt)/B),ft=0;ft<I;++ft){for(var pt=ft-z,St=Math.max(0,Math.ceil(pt/O)),_t=Math.min(L,(S+pt)/O),Et=0,le=st;le<ht;++le)for(var Ct=le*B-nt,Bt=St;Bt<_t;++Bt)for(var At=f*H+p*le+m*Bt,ae=x*(_-1-Ct)+w*(S-1-(Bt*O-pt))+b*K,Zt=0;Zt<U;++Zt)Et+=h[At+(K*U+Zt)]*g[ae+Zt];a[u*H+c*et+l*ft+K]=Et}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){q([t,n],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=mt(i.filterShape,"float32"),l=i.padInfo.left,h=i.padInfo.top,d=i.outChannels/i.inChannels,f=this.bufferSync(t),p=this.bufferSync(n),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((h-m)/o)),v=Math.min(i.outHeight,(i.inHeight+h-m)/o),x=0;x<u;++x)for(var w=Math.max(0,Math.ceil((l-x)/a)),b=Math.min(i.outWidth,(i.inWidth+l-x)/a),y=0;y<i.outChannels;++y){for(var _=Math.trunc(y/d),S=y%d,C=0,E=0;E<i.batchSize;++E)for(var I=g;I<v;++I)for(var A=m+I*o-h,R=w;R<b;++R){var L=x+R*a-l;C+=f.get(E,A,L,_)*p.get(E,I,R,y)}c.set(C,m,x,_,S)}return c.toTensor()},e.prototype.tile=function(t,n){return q(t,"tile"),Dv(this.bufferSync(t),n)},e.prototype.pad=function(t,n,i){q(t,"pad");var o=n.map(function(d,f){return d[0]+t.shape[f]+d[1]}),a=n.map(function(d){return d[0]}),s=this.bufferSync(t),u=mt(o,t.dtype);i!==0&&u.values.fill(i);for(var c=0;c<t.size;c++){var l=s.indexToLoc(c),h=l.map(function(d,f){return d+a[f]});u.set.apply(u,[s.get.apply(s,l)].concat(h))}return u.toTensor()},e.prototype.transpose=function(t,n){q(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[n[o]];var a=this.readSync(t.dataId),s=mt(i,t.dtype),u=this.bufferSync(t);for(o=0;o<t.size;++o){for(var c=u.indexToLoc(o),l=new Array(c.length),h=0;h<l.length;h++)l[h]=c[n[h]];var d=s.locToIndex(l);s.values[d]=a[o]}return s.toTensor()},e.prototype.gather=function(t,n,i){q([t,n],"gather");var o=t.shape.slice(),a=this.readSync(n.dataId);o[i]=a.length;for(var s=mt(o,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c),h=l.slice();h[i]=a[l[i]];var d=u.locToIndex(h);s.values[c]=u.values[d]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,n,i){q([t],"batchToSpaceND");var o=n.reduce(function(h,d){return h*d}),a=_u(t.shape,n,o),s=Cu(a.length,n.length),u=Su(t.shape,n,o),c=yv(i,n.length),l=wv(u,i,n.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},e.prototype.spaceToBatchND=function(t,n,i){q([t],"spaceToBatchND");var o=n.reduce(function(d,f){return d*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=_u(u.shape,n,o,!1),l=Cu(c.length,n.length,!1),h=Su(u.shape,n,o,!1);return u.reshape(c).transpose(l).reshape(h)},e.prototype.pool=function(t,n,i){q(t,"pool");for(var o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=n.padInfo.top,d=n.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),m=mt(n.outShape,t.dtype),g=m.values,v=n.outShape[1]*n.outShape[2]*n.outShape[3],x=n.outShape[2]*n.outShape[3],w=n.outShape[3],b=0;b<n.batchSize;++b)for(var y=b*v,_=b*t.strides[0],S=0;S<n.inChannels;++S)for(var C=0;C<n.outHeight;++C)for(var E=C*o-h,I=Math.max(0,E),A=Math.min(n.inHeight,c+E),R=y+C*x,L=0;L<n.outWidth;++L){for(var B=L*a-d,O=Math.max(0,B),V=Math.min(n.inWidth,l+B),z=f,U=0,H=0,K=I;K<A;K+=s){for(var et=_+K*t.strides[1],nt=O;nt<V;nt+=u){var st=p[et+nt*t.strides[2]+S];i==="max"&&st>z?z=st:i==="avg"&&(U+=st,H++)}if(isNaN(z))break}g[R+L*w+S]=i==="avg"?U/H:z}return m.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var i=mt(n.outShape,"int32"),o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=n.padInfo.top,d=n.padInfo.left,f=this.bufferSync(t),p=0;p<n.batchSize;++p)for(var m=0;m<n.inChannels;++m)for(var g=0;g<n.outHeight;++g){for(var v=g*o-h,x=v;x<0;)x+=s;for(var w=Math.min(n.inHeight,c+v),b=0;b<n.outWidth;++b){for(var y=b*a-d,_=y;_<0;)_+=u;for(var S=Math.min(n.inWidth,l+y),C=Number.NEGATIVE_INFINITY,E=-1,I=x;I<w;I+=s)for(var A=I-v,R=_;R<S;R+=u){var L=R-y,B=f.get(p,I,R,m);B>C&&(C=B,E=A*l+L)}i.set(E,p,g,b,m)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,n,i,o){q([n,i],"maxPoolBackprop");for(var a=this.maxPoolPositions(n,o),s=o.strideHeight,u=o.strideWidth,c=o.dilationHeight,l=o.dilationWidth,h=o.effectiveFilterHeight,d=o.effectiveFilterWidth,f=d-1-o.padInfo.left,p=h-1-o.padInfo.top,m=mt(n.shape,"float32"),g=this.bufferSync(a),v=this.bufferSync(t),x=0;x<o.batchSize;++x)for(var w=0;w<o.inChannels;++w)for(var b=0;b<o.inHeight;++b)for(var y=0;y<o.inWidth;++y){for(var _=b-p,S=y-f,C=0,E=0;E<h;E+=c){var I=(_+E)/s;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var A=0;A<d;A+=l){var R=(S+A)/u;if(!(R<0||R>=o.outWidth||Math.floor(R)!==R)){var L=h*d-1-g.get(x,I,R,w)===E*d+A?1:0;L!==0&&(C+=v.get(x,I,R,w)*L)}}}m.set(C,x,b,y,w)}return m.toTensor()},e.prototype.avgPoolBackprop=function(t,n,i){q([t,n],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,c=i.dilationHeight,l=i.dilationWidth,h=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=d-1-i.padInfo.left,p=h-1-i.padInfo.top,m=mt(n.shape,"float32"),g=1/(s*u),v=this.bufferSync(t),x=0;x<i.batchSize;++x)for(var w=0;w<i.inChannels;++w)for(var b=0;b<i.inHeight;++b)for(var y=0;y<i.inWidth;++y){for(var _=b-p,S=y-f,C=0,E=0;E<h;E+=c){var I=(_+E)/o;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var A=0;A<d;A+=l){var R=(S+A)/a;R<0||R>=i.outWidth||Math.floor(R)!==R||(C+=v.get(x,I,R,w))}}m.set(C*g,x,b,y,w)}return m.toTensor()},e.prototype.pool3d=function(t,n,i){q(t,"pool3d");for(var o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,g=n.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),w=mt(n.outShape,t.dtype),b=w.values,y=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],_=n.outShape[2]*n.outShape[3]*n.outShape[4],S=n.outShape[3]*n.outShape[4],C=n.outShape[4],E=0;E<n.batchSize;++E)for(var I=E*y,A=E*t.strides[0],R=0;R<n.inChannels;++R)for(var L=0;L<n.outDepth;++L){for(var B=L*o-p,O=B;O<0;)O+=u;for(var V=Math.min(n.inDepth,h+B),z=I+L*_,U=0;U<n.outHeight;++U){for(var H=U*a-m,K=H;K<0;)K+=c;for(var et=Math.min(n.inHeight,d+H),nt=z+U*S,st=0;st<n.outWidth;++st){for(var ht=st*s-g,ft=ht;ft<0;)ft+=l;for(var pt=Math.min(n.inWidth,f+ht),St=nt+st*C,_t=v,Et=0,le=0,Ct=O;Ct<V;Ct+=u){for(var Bt=A+Ct*t.strides[1],At=K;At<et;At+=c){for(var ae=Bt+At*t.strides[2],Zt=ft;Zt<pt;Zt+=l){var te=x[ae+Zt*t.strides[3]+R];if(i==="max"&&te>_t?_t=te:i==="avg"&&(Et+=te,le++),isNaN(_t))break}if(isNaN(_t))break}if(isNaN(_t))break}b[St+R]=i==="avg"?Et/le:_t}}}return w.toTensor()},e.prototype.avgPool3d=function(t,n){return q(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,i){q([t,n],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,c=i.filterHeight,l=i.filterWidth,h=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=p-1-i.padInfo.front,x=g-1-i.padInfo.left,w=m-1-i.padInfo.top,b=mt(n.shape,"float32"),y=1/(u*c*l),_=this.bufferSync(t),S=0;S<i.batchSize;++S)for(var C=0;C<i.inChannels;++C)for(var E=0;E<i.inDepth;++E)for(var I=0;I<i.inHeight;++I)for(var A=0;A<i.inWidth;++A){for(var R=E-v,L=I-w,B=A-x,O=0,V=0;V<p;V+=h){var z=(R+V)/o;if(!(z<0||z>=i.outDepth||Math.floor(z)!==z))for(var U=0;U<m;U+=d){var H=(L+U)/a;if(!(H<0||H>=i.outHeight||Math.floor(H)!==H))for(var K=0;K<g;K+=f){var et=(B+K)/s;et<0||et>=i.outWidth||Math.floor(et)!==et||(O+=_.get(S,z,H,et,C))}}}b.set(O*y,S,E,I,A,C)}return b.toTensor()},e.prototype.maxPool3d=function(t,n){return q(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var i=mt(n.outShape,"int32"),o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,c=n.dilationHeight,l=n.dilationWidth,h=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,g=n.padInfo.left,v=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var w=0;w<n.inChannels;++w)for(var b=0;b<n.outDepth;++b){for(var y=b*o-p,_=y;_<0;)_+=u;for(var S=Math.min(n.inDepth,h+y),C=0;C<n.outHeight;++C){for(var E=C*a-m,I=E;I<0;)I+=c;for(var A=Math.min(n.inHeight,d+E),R=0;R<n.outWidth;++R){for(var L=R*s-g,B=L;B<0;)B+=l;for(var O=Math.min(n.inWidth,f+L),V=Number.NEGATIVE_INFINITY,z=-1,U=_;U<S;U+=u)for(var H=U-y,K=I;K<A;K+=c)for(var et=K-E,nt=B;nt<O;nt+=l){var st=nt-L,ht=v.get(x,U,K,nt,w);ht>=V&&(V=ht,z=H*d*f+et*d+st)}i.set(z,x,b,C,R,w)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,i,o){q([n,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(n,o),s=o.strideDepth,u=o.strideHeight,c=o.strideWidth,l=o.dilationDepth,h=o.dilationHeight,d=o.dilationWidth,f=o.effectiveFilterDepth,p=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=f-1-o.padInfo.front,v=m-1-o.padInfo.left,x=p-1-o.padInfo.top,w=mt(n.shape,"float32"),b=this.bufferSync(a),y=this.bufferSync(t),_=0;_<o.batchSize;++_)for(var S=0;S<o.inChannels;++S)for(var C=0;C<o.inDepth;++C)for(var E=0;E<o.inHeight;++E)for(var I=0;I<o.inWidth;++I){for(var A=C-g,R=E-x,L=I-v,B=0,O=0;O<f;O+=l){var V=(A+O)/s;if(!(V<0||V>=o.outDepth||Math.floor(V)!==V))for(var z=0;z<p;z+=h){var U=(R+z)/u;if(!(U<0||U>=o.outHeight||Math.floor(U)!==U))for(var H=0;H<m;H+=d){var K=(L+H)/c;if(!(K<0||K>=o.outWidth||Math.floor(K)!==K)){var et=f*p*m-1-b.get(_,V,U,K,S)===O*p*m+z*m+H?1:0;et!==0&&(B+=y.get(_,V,U,K,S)*et)}}}}w.set(B,_,C,E,I,S)}return w.toTensor()},e.prototype.cast=function(t,n){return Ih(t,n,this)},e.prototype.reshape=function(t,n){return ku(t,n)},e.prototype.avgPool=function(t,n){return q(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,i,o){q(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=this.readSync(t.dataId),d=new Float32Array(at([s,n,i,l])),f=[o&&n>1?u-1:u,o&&i>1?c-1:c],p=[o&&n>1?n-1:n,o&&i>1?i-1:i],m=0,g=f[0]/p[0],v=f[1]/p[1],x=0;x<s;x++)for(var w=0;w<n;w++)for(var b=g*w,y=Math.floor(b),_=b-y,S=Math.min(u-1,Math.ceil(b)),C=x*t.strides[0]+y*t.strides[1],E=x*t.strides[0]+S*t.strides[1],I=0;I<i;I++)for(var A=v*I,R=Math.floor(A),L=A-R,B=Math.min(c-1,Math.ceil(A)),O=C+R*t.strides[2],V=E+R*t.strides[2],z=C+B*t.strides[2],U=E+B*t.strides[2],H=0;H<l;H++){var K=h[O+H],et=h[V+H],nt=K+(h[z+H]-K)*L,st=nt+(et+(h[U+H]-et)*L-nt)*_;d[m++]=st}return Ce(d,[s,n,i,l])},e.prototype.resizeBilinearBackprop=function(t,n,i){q([t,n],"resizeBilinearBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],c=o[3],l=t.shape,h=l[1],d=l[2],f=new Float32Array(a*s*u*c),p=[i&&h>1?s-1:s,i&&d>1?u-1:u],m=[i&&h>1?h-1:h,i&&d>1?d-1:d],g=p[0]/m[0],v=p[1]/m[1],x=this.readSync(t.dataId),w=0,b=0;b<a;b++)for(var y=b*n.strides[0],_=0;_<h;_++)for(var S=_*g,C=Math.floor(S),E=Math.min(Math.ceil(S),s-1),I=y+C*n.strides[1],A=y+E*n.strides[1],R=S-C,L=1-R,B=0;B<d;B++)for(var O=B*v,V=Math.floor(O),z=Math.min(Math.ceil(O),u-1),U=O-V,H=1-U,K=I+V*n.strides[2],et=I+z*n.strides[2],nt=A+V*n.strides[2],st=A+z*n.strides[2],ht=L*H,ft=L*U,pt=R*H,St=R*U,_t=0;_t<c;_t++){var Et=x[w++];f[K+_t]+=Et*ht,f[et+_t]+=Et*ft,f[nt+_t]+=Et*pt,f[st+_t]+=Et*St}return xe(f,[a,u,s,c],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,i,o){q(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=this.readSync(t.dataId),d=new Float32Array(s*n*i*l),f=[o&&n>1?u-1:u,o&&i>1?c-1:c],p=[o&&n>1?n-1:n,o&&i>1?i-1:i],m=f[0]/p[0],g=f[1]/p[1],v=0,x=0;x<s;x++)for(var w=x*t.strides[0],b=0;b<n;b++)for(var y=m*b,_=w+Math.min(u-1,o?Math.round(y):Math.floor(y))*t.strides[1],S=0;S<i;S++)for(var C=g*S,E=_+Math.min(c-1,o?Math.round(C):Math.floor(C))*t.strides[2],I=0;I<l;I++){var A=h[E+I];d[v++]=A}return Ce(d,[s,n,i,l],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){q([t,n],"resizeNearestNeighborBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],c=o[3],l=t.shape,h=l[1],d=l[2],f=new Float32Array(a*s*u*c),p=this.readSync(t.dataId),m=[i&&h>1?s-1:s,i&&d>1?u-1:u],g=[i&&h>1?h-1:h,i&&d>1?d-1:d],v=m[0]/g[0],x=m[1]/g[1],w=1/v,b=1/x,y=2*Math.ceil(w)+2,_=2*Math.ceil(b)+2,S=0;S<a;S++)for(var C=S*n.strides[0],E=0;E<s;E++)for(var I=C+E*n.strides[1],A=Math.floor(E*w),R=Math.floor(A-y/2),L=0;L<u;L++)for(var B=I+L*n.strides[2],O=Math.floor(L*b),V=Math.floor(O-_/2),z=0;z<c;z++){for(var U=0,H=0;H<y;H++){var K=H+R;if(!(K<0||K>=h)){var et=C+K*t.strides[1],nt=K*v;if(E===Math.min(s-1,i?Math.round(nt):Math.floor(nt)))for(var st=0;st<_;st++){var ht=st+V;if(!(ht<0||ht>=d)){var ft=et+ht*t.strides[2],pt=ht*x;L===Math.min(u-1,i?Math.round(pt):Math.floor(pt))&&(U+=p[ft+z])}}}}f[B+z]=U}return xe(f,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,i,o,a,s){q([t,n,i,a,s],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=this.readSync(i.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(u.length),p=d.length,m=h.length,g=l.length,v=c.length,x=0,w=0,b=0,y=0,_=0;_<u.length;++_)f[_]=d[x++]+(u[_]-c[w++])*h[b++]/Math.sqrt(l[y++]+o),x>=p&&(x=0),w>=v&&(w=0),b>=m&&(b=0),y>=g&&(y=0);return xe(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,i,o,a){q(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,c=this.readSync(t.dataId),l=t.size,h=new Float32Array(l);function d(g){for(var v=g%s,x=g-v+Math.max(0,v-n),w=g-v+Math.min(v+n,u),b=0;x<=w;x++){var y=c[x];b+=y*y}return b}for(var f=0;f<l;f++){var p=d(f),m=c[f]*Math.pow(i+o*p,-a);h[f]=m}return xe(h,t.shape)},e.prototype.LRNGrad=function(t,n,i,o,a,s,u){q(t,"LRNGrad");for(var c=t.shape[3],l=this.readSync(t.dataId),h=this.readSync(n.dataId),d=this.readSync(i.dataId),f=new Float32Array(t.size),p=t.size,m=0;m<p;m++){for(var g=m%c,v=m-g+Math.max(0,g-o),x=m-g+Math.min(c,g+o+1),w=0,b=v;b<x;b++)w+=Math.pow(h[b],2);for(w=s*w+a,b=v;b<x;b++){var y=-2*s*u*h[b]*d[m]/w;m===b&&(y+=Math.pow(w,-u)),y*=l[m],f[b]+=y}}return xe(f,t.shape)},e.prototype.multinomial=function(t,n,i,o){q(t,"multinomial");for(var a=n?t:Xe(t),s=a.shape[0],u=a.shape[1],c=Gt([s,i],"int32"),l=this.readSync(c.dataId),h=this.readSync(a.dataId),d=0;d<s;++d){var f=d*u,p=new Float32Array(u-1);p[0]=h[f];for(var m=1;m<p.length;++m)p[m]=p[m-1]+h[f+m];for(var g=Pu(o.toString()),v=d*i,x=0;x<i;++x){var w=g();l[v+x]=p.length;for(var b=0;b<p.length;b++)if(w<p[b]){l[v+x]=b;break}}}return c},e.prototype.oneHot=function(t,n,i,o){q(t,"oneHot");var a=new Float32Array(t.size*n);a.fill(o);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<n&&(a[u*n+s[u]]=i);return qn(a,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,i,o,a){return q(t,"nonMaxSuppression"),Rh(this.readSync(t.dataId),this.readSync(n.dataId),i,o,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var i=t.shape[0],o=t.shape[1],a=mt(t.shape,"float32"),s=mt(t.shape,"float32"),u=vn(t).as2D(i,o),c=Gn(t).as2D(i,o),l=0;l<i;l++)for(var h=u.slice([l,0],[1,o]),d=c.slice([l,0],[1,o]),f=Me(h,d),p=this.readSync(this.fftImpl(f,n).dataId),m=0;m<o;m++){var g=jm(p,m);a.values[l*o+m]=g.real,s.values[l*o+m]=g.imag}return Me(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,n){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,n).as2D(t.shape[0],t.shape[1]);return n&&(a=Me(vn(a).div(Z(o)),Gn(a).div(Z(o)))),a}var s=this.readSync(t.dataId),u=function(c){for(var l=new Float32Array(c.length/2),h=new Float32Array(c.length/2),d=0;d<c.length;d+=2)l[d/2]=c[d],h[d/2]=c[d+1];return{real:l,imag:h}}(this.fourierTransformByMatmul(s,o,n));return Me(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,i){if(n===1)return t;var o=this.readSync(t.dataId),a=n/2,s=function(v){for(var x=Math.ceil(v.length/4),w=new Float32Array(x),b=new Float32Array(x),y=0;y<v.length;y+=4)w[Math.floor(y/4)]=v[y],b[Math.floor(y/4)]=v[y+1];return{real:w,imag:b}}(o),u=Me(s.real,s.imag).as1D(),c=function(v){for(var x=Math.floor(v.length/4),w=new Float32Array(x),b=new Float32Array(x),y=2;y<v.length;y+=4)w[Math.floor(y/4)]=v[y],b[Math.floor(y/4)]=v[y+1];return{real:w,imag:b}}(o),l=Me(c.real,c.imag).as1D();u=this.fftRadix2(u,a,i),l=this.fftRadix2(l,a,i);var h=function(v,x){for(var w=new Float32Array(v/2),b=new Float32Array(v/2),y=0;y<Math.ceil(v/2);y++){var _=(x?2:-2)*Math.PI*(y/v);w[y]=Math.cos(_),b[y]=Math.sin(_)}return{real:w,imag:b}}(n,i),d=Me(h.real,h.imag).mul(l),f=u.add(d),p=u.sub(d),m=vn(f).concat(vn(p)),g=Gn(f).concat(Gn(p));return Me(m,g).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,i){for(var o=new Float32Array(2*n),a=0;a<n;a++){for(var s=0,u=0,c=0;c<n;c++){var l=J_(a*c,n,i),h=jm(t,c);s+=h.real*l.real-h.imag*l.imag,u+=h.real*l.imag+h.imag*l.real}i&&(s/=n,u/=n),$_(o,s,u,a)}return o},e.prototype.depthToSpace=function(t,n,i){M(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),M(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],c=a*n,l=s*n,h=u/(n*n),d=this.readSync(t.dataId),f=new Float32Array(o*c*l*h),p=0,m=0;m<o;++m)for(var g=0;g<c;++g)for(var v=Math.floor(g/n),x=g%n,w=0;w<l;++w)for(var b=Math.floor(w/n),y=(x*n+w%n)*h,_=0;_<h;++_){var S=_+y+u*(b+s*(v+a*m));f[p++]=d[S]}return xe(f,[o,c,l,h])},e.prototype.broadcastedBinaryOp=function(t,n,i,o){var a=yt(t.shape,n.shape),s=mt(a,i),u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=gr(t.shape,a),h=gr(n.shape,a),d=s.values;if(l.length+h.length===0)for(var f=0;f<d.length;++f)d[f]=o(u[f%u.length],c[f%c.length]);else{var p=this.bufferSync(t),m=this.bufferSync(n),g=function(v){var x=s.indexToLoc(v),w=x.slice(-t.rank);l.forEach(function(S){return w[S]=0});var b=p.locToIndex(w),y=x.slice(-n.rank);h.forEach(function(S){return y[S]=0});var _=m.locToIndex(y);d[v]=o(u[b],c[_])};for(f=0;f<d.length;++f)g(f)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,i){var o=yt(t.shape,n.shape),a=mt(o,"float32"),s=mt(o,"float32"),u=this.readSync(t.dataId),c=this.readSync(n.dataId),l=gr(t.shape,o),h=gr(n.shape,o),d=a.values,f=s.values;if(l.length+h.length===0)for(var p=0;p<d.length;p++){var m=p%u.length,g=p%c.length,v=i(u[2*m],u[2*m+1],c[2*g],c[2*g+1]);d[p]=v.real,f[p]=v.imag}else{var x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),w=this.bufferSync(this.data.get(n.dataId).complexTensors.real),b=function(y){var _=a.indexToLoc(y),S=_.slice(-t.rank);l.forEach(function(R){return S[R]=0});var C=x.locToIndex(S),E=_.slice(-n.rank);h.forEach(function(R){return E[R]=0});var I=w.locToIndex(E),A=i(u[2*C],u[2*C+1],c[2*I],c[2*I+1]);d[y]=A.real,f[y]=A.imag};for(p=0;p<d.length;p++)b(p)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,n,i){return Av(t,n,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,i,o,a,s){for(var u=t.shape,c=u[0],l=u[1],h=u[2],d=u[3],f=n.shape[0],p=o[0],m=o[1],g=mt([f,p,m,d],"float32"),v=this.readSync(n.dataId),x=this.readSync(i.dataId),w=this.readSync(t.dataId),b=t.strides,y=g.strides,_=0;_<f;_++){var S=4*_,C=v[S],E=v[S+1],I=v[S+2],A=v[S+3],R=x[_];if(!(R>=c))for(var L=p>1?(I-C)*(l-1)/(p-1):0,B=m>1?(A-E)*(h-1)/(m-1):0,O=0;O<p;O++){var V=p>1?C*(l-1)+O*L:.5*(C+I)*(l-1);if(V<0||V>l-1)for(var z=0;z<m;z++)for(var U=0;U<d;U++){var H=U+z*y[2]+O*y[1]+_*y[0];g.values[H]=s}else if(a==="bilinear"){var K=Math.floor(V),et=Math.ceil(V),nt=V-K;for(z=0;z<m;z++)if((Ct=m>1?E*(h-1)+z*B:.5*(E+A)*(h-1))<0||Ct>h-1)for(U=0;U<d;U++)H=U+z*y[2]+O*y[1]+_*y[0],g.values[H]=s;else{var st=Math.floor(Ct),ht=Math.ceil(Ct),ft=Ct-st;for(U=0;U<d;U++){var pt=w[H=U+st*b[2]+K*b[1]+R*b[0]],St=w[H=U+ht*b[2]+K*b[1]+R*b[0]],_t=w[H=U+st*b[2]+et*b[1]+R*b[0]],Et=pt+(St-pt)*ft,le=_t+(w[H=U+ht*b[2]+et*b[1]+R*b[0]]-_t)*ft;H=U+z*y[2]+O*y[1]+_*y[0],g.values[H]=Et+(le-Et)*nt}}}else for(z=0;z<m;++z){var Ct;if((Ct=m>1?E*(h-1)+z*B:.5*(E+A)*(h-1))<0||Ct>h-1)for(U=0;U<d;U++)H=U+z*y[2]+O*y[1]+_*y[0],g.values[H]=s;else{var Bt=Math.round(Ct),At=Math.round(V);for(U=0;U<d;U++){var ae=U+Bt*b[2]+At*b[1]+R*b[0],Zt=U+z*y[2]+O*y[1]+_*y[0];g.values[Zt]=w[ae]}}}}}return g.toTensor()},e.prototype.sparseToDense=function(t,n,i,o){var a=Pa(0,t,i),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,l=a.strides,h=a.outputSize;return this.scatter(t,n,i,h,c,u,s,l,o,!1)},e.prototype.gatherND=function(t,n){var i=n.shape,o=i[i.length-1],a=_h(t,n),s=a[0],u=a[1],c=a[2],l=a[3];if(u===0)return Ce([],s,t.dtype);for(var h=new Ra([u,c],t.dtype),d=this.readSync(n.dataId),f=this.readSync(t.dataId),p=0;p<u;p++){for(var m=[],g=0,v=0;v<o;v++){var x=d[p*o+v];g+=x*l[v],m.push(x)}if(g<0||g>=t.size/c)throw new Error("Invalid indices: "+m+" does not index into "+t.shape);for(var w=0;w<c;w++)h.values[p*c+w]=f[g*c+w]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,n,i){var o=Pa(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,c=o.strides,l=o.outputSize,h=Z(0);return this.scatter(t,n,i,l,u,s,a,c,h,!0)},e.prototype.fill=function(t,n,i){var o=Ia(i=i||Ao(n),at(t));return o.fill(n),F.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=Ia(t.dtype,at(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,i){return Mh(t,n,i)},e.prototype.scatter=function(t,n,i,o,a,s,u,c,l,h){var d=[o/a,a],f=this.readSync(t.dataId),p=this.readSync(n.dataId);if(o===0)return Ce([],i,n.dtype);var m=new Ra(d,n.dtype);m.values.fill(this.readSync(l.dataId)[0]);for(var g=0;g<s;g++){for(var v=[],x=0,w=0;w<u;w++){var b=f[g*u+w];v.push(b),x+=b*c[w]}if(x<0||x>=o/a)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var y=0;y<a;y++)h?m.values[x*a+y]+=p[g*a+y]:m.values[x*a+y]=n.rank===0?p[0]:p[g*a+y]}return m.toTensor().reshape(i)},e}(Mv);F.registerBackend("cpu",function(){return new tk},1);for(iu=0,Nl=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e,o=i.boxes,a=i.scores,s=n,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=t;q(o,"NonMaxSuppressionWithScore");var f=Ah(d.data.get(o.dataId).values,d.data.get(a.dataId).values,u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t;q(n,"square");for(var o=i.data.get(n.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:Na,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,o=n.b,a=t;q([i,o],Na);var s=a.data.get(i.dataId).values,u=a.data.get(o.dataId).values,c=function(d,f,p,m,g,v){var x=yt(d,f),w=x.length,b=En(x),y=Mo(g,at(x)),_=d.length,S=f.length,C=En(d),E=En(f),I=gr(d,x),A=gr(f,x);if(I.length+A.length===0)for(var R=0;R<y.length;++R)y[R]=v(p[R%p.length],m[R%m.length]);else{var L=function(B){var O=Og(B,w,b),V=O.slice(-_);I.forEach(function(K){return V[K]=0});var z=Kl(V,_,C),U=O.slice(-S);A.forEach(function(K){return U[K]=0});var H=Kl(U,S,E);y[B]=v(p[z],m[H])};for(R=0;R<y.length;++R)L(R)}return[y,x]}(i.shape,o.shape,s,u,i.dtype,function(d,f){var p=d-f;return p*p}),l=c[0],h=c[1];return{dataId:a.write(l,h,i.dtype),shape:h,dtype:i.dtype}}}];iu<Nl.length;iu++)Cg(Nl[iu]);var iu,Nl,xo,ek=function(r){this.variableNames=["A"];var e=Be(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},nk=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Be(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(ou=0,Ll=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e.pixels,o=n.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],h=[l,c],d=[l,c,o];(s||a)&&(xo==null&&(xo=document.createElement("canvas").getContext("2d")),xo.canvas.width=c,xo.canvas.height=l,xo.drawImage(i,0,0,c,l),i=xo.canvas);var f=t.makeTensorInfo(h,"int32");t.texData.get(f.dataId).usage=cn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),i);var p=j().getBool("WEBGL_PACK")?new nk(d):new ek(d),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs;bu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=n,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=t,f=Ah(d.readSync(o.dataId),d.readSync(a.dataId),u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t,o=new xt(n.shape,"return x * x;");return i.runWebGLProgram(o,[n],n.dtype)}},{kernelName:Na,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,o=n.b,a=t,s=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pr("return (a - b) * (a - b);",i.shape,o.shape):new ue("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}}];ou<Ll.length;ou++)Cg(Ll[ou]);var ou,Ll;for(au=0,Bl=[{kernelName:"Square",gradFunc:function(r,e){var t=e[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:Na,gradFunc:function(r,e){var t=e[0],n=e[1],i=Z(2);return{a:function(){return ee(r,ee(i,Vt(t,n)))},b:function(){return ee(r,ee(i,Vt(n,t)))}}}}];au<Bl.length;au++)o_(Bl[au]);var au,Bl,rk=function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r}();j().get("IS_BROWSER")&&j().setPlatform("browser",new rk);var Wl,ik=function(){return Om()},ok=function(){function r(){this.util=Nm(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return j().global.fetch!=null?j().global.fetch(e,t):(Wl==null&&(Wl=ik()),Wl(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();j().get("IS_NODE")&&j().setPlatform("node",new ok);var sh={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ru=4;function L0(r,e){for(var t={},n=0,i=function(s){var u=s.name,c=s.dtype,l=s.shape,h=at(l),d=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=sh[f.dtype],m=r.slice(n,n+h*p),g=f.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(c==="float32")d=Float32Array.from(g,function(_){return _*f.scale+f.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=Int32Array.from(g,function(_){return Math.round(_*f.scale+f.min)})}n+=h*p}else if(c==="string"){var v=at(s.shape);d=[];for(var x=0;x<v;x++){var w=new Uint32Array(r.slice(n,n+Ru))[0];n+=Ru;var b=new Uint8Array(r.slice(n,n+w));d.push(b),n+=w}}else{var y=sh[c];if(m=r.slice(n,n+h*y),c==="float32")d=new Float32Array(m);else if(c==="int32")d=new Int32Array(m);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Uint8Array(m)}n+=h*y}t[u]=Ce(d,l,c)},o=0,a=e;o<a.length;o++)i(a[o]);return t}function ak(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var n=new Uint8Array(e),i=0;return t.forEach(function(o){n.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),n.buffer}var uh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function hg(r){return uh?Buffer.byteLength(r):new Blob([r]).size}function Yh(r){var e=0;r.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(i){t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function dg(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function qa(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:hg(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:hg(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var hn=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(o){var a=o(e,n);a!==null&&i.push(a)}),i},r}(),Eo="://",Kr=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){M(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Eo)&&(e=e.slice(0,e.indexOf(Eo))),M(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();M(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function fu(r){if(r.indexOf(Eo)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Kr.getSchemes().join(","));return{scheme:r.split(Eo)[0],path:r.split(Eo)[1]}}function fg(r,e,t){return t===void 0&&(t=!1),it(this,void 0,void 0,function(){var n,i,o,a,s,u,c,l,h;return ot(this,function(d){switch(d.label){case 0:return M(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),M((n=hn.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),M(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),i=n[0],M((o=hn.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),M(o.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),a=o[0],s=fu(r).scheme,u=fu(r).path,c=s===fu(r).scheme,[4,i.load()];case 1:return l=d.sent(),t&&c?[4,Kr.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return h=d.sent(),!t||c?[3,6]:[4,Kr.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var wi="models_store",Xr="model_info_store";function B0(){if(!j().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ch(r){var e=r.result;e.createObjectStore(wi,{keyPath:"modelPath"}),e.createObjectStore(Xr,{keyPath:"modelPath"})}var ko=function(){function r(e){if(this.indexedDB=B0(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return it(this,void 0,void 0,function(){return ot(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return it(this,void 0,void 0,function(){return ot(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(i,o){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return ch(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(wi,"readonly"),c=u.objectStore(wi).get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),o(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(c.result.modelArtifacts)},c.onerror=function(m){return s.close(),o(c.error)},u.oncomplete=function(){return s.close()}}else{var l,h=qa(t),d=s.transaction(Xr,"readwrite"),f=d.objectStore(Xr),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var m=(l=s.transaction(wi,"readwrite")).objectStore(wi).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:h});m.onsuccess=function(){return i({modelArtifactsInfo:h})},m.onerror=function(g){var v=(f=d.objectStore(Xr)).delete(n.modelPath);v.onsuccess=function(){return s.close(),o(m.error)},v.onerror=function(x){return s.close(),o(m.error)}}},p.onerror=function(m){return s.close(),o(p.error)},d.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},r.URL_SCHEME="indexeddb://",r}(),pg=function(r){return j().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ko.URL_SCHEME)?(e=r.slice(ko.URL_SCHEME.length),new ko(e)):null;var e};hn.registerSaveRouter(pg),hn.registerLoadRouter(pg);var sk=function(){function r(){this.indexedDB=B0()}return r.prototype.listModels=function(){return it(this,void 0,void 0,function(){var e=this;return ot(this,function(t){return[2,new Promise(function(n,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ch(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Xr,"readonly"),u=s.objectStore(Xr).getAll();u.onsuccess=function(){for(var c={},l=0,h=u.result;l<h.length;l++){var d=h[l];c[d.modelPath]=d.modelArtifactsInfo}n(c)},u.onerror=function(c){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},r.prototype.removeModel=function(e){return it(this,void 0,void 0,function(){var t=this;return ot(this,function(n){var i;return e=(i=e).startsWith(ko.URL_SCHEME)?i.slice(ko.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return ch(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Xr,"readwrite"),h=l.objectStore(Xr),d=h.get(e);d.onsuccess=function(){if(d.result==null)return c.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=h.delete(e),p=function(){var m=(u=c.transaction(wi,"readwrite")).objectStore(wi).delete(e);m.onsuccess=function(){return o(d.result.modelArtifactsInfo)},m.onerror=function(g){return a(d.error)}};f.onsuccess=p,f.onerror=function(m){return p(),c.close(),a(d.error)}},d.onerror=function(f){return c.close(),a(d.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},r}();if(j().getBool("IS_BROWSER"))try{Kr.registerManager(ko.URL_SCHEME,new sk)}catch{}var mr="/",Co="tensorflowjs_models",W0="info",uk="model_topology",ck="weight_specs",lk="weight_data",hk="model_metadata";function z0(r){return{info:[Co,r,W0].join(mr),topology:[Co,r,uk].join(mr),weightSpecs:[Co,r,ck].join(mr),weightData:[Co,r,lk].join(mr),modelMetadata:[Co,r,hk].join(mr)}}function dk(r){var e=r.split(mr);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(mr)}var Io=function(){function r(e){if(!j().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=z0(this.modelPath)}return r.prototype.save=function(e){return it(this,void 0,void 0,function(){var t,n,i;return ot(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=qa(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(a){if(uh)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return it(this,void 0,void 0,function(){var e,t,n,i,o,a,s;return ot(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(c){if(uh){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var h=atob(c),d=new Uint8Array(h.length),f=0;f<h.length;++f)d.set([h.charCodeAt(f)],f);return d.buffer}(s),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),mg=function(r){return j().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Io.URL_SCHEME)?(e=r.slice(Io.URL_SCHEME.length),new Io(e)):null;var e};hn.registerSaveRouter(mg),hn.registerLoadRouter(mg);var fk=function(){function r(){M(j().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),M(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return it(this,void 0,void 0,function(){var e,t,n,i,o,a;return ot(this,function(s){for(e={},t=Co+mr,n=mr+W0,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(n)&&(a=dk(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},r.prototype.removeModel=function(e){return it(this,void 0,void 0,function(){var t,n;return ot(this,function(i){var o;if(e=(o=e).startsWith(Io.URL_SCHEME)?o.slice(Io.URL_SCHEME.length):o,t=z0(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r}();if(j().getBool("IS_BROWSER"))try{Kr.registerManager(Io.URL_SCHEME,new fk)}catch{}var pk="model",mk=".json",gk=".weights.bin";function gg(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var zl=function(){function r(e){if(!j().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=pk),this.modelTopologyFileName=e+mk,this.weightDataFileName=e+gk}return r.prototype.save=function(e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s;return ot(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,gg(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,gg(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:qa(e)}]}})})},r.URL_SCHEME="downloads://",r}(),vk=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return it(this,void 0,void 0,function(){var e,t,n=this;return ot(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){t.length===0&&o({modelTopology:l});var h=c.weightsManifest;if(h!=null){var d;try{d=n.checkManifestAndWeightFiles(h,t)}catch(g){return void a(g)}var f=[],p=[],m=[];h.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),f.push.apply(f,g.weights)}),h.forEach(function(g){g.paths.forEach(function(v){var x=new FileReader;x.onload=function(w){var b=w.target.result,y=p.indexOf(v);m[y]=b,m.indexOf(null)===-1&&o({modelTopology:l,weightSpecs:f,weightData:Yh(m),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},x.onerror=function(w){return a("Failed to weights data from file of path '"+v+"'.")},x.readAsArrayBuffer(d[v])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],i=t.map(function(u){return dg(u.name)}),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var c=dg(u);if(n.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(n.push(c),i.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");o[u]=t[i.indexOf(c)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},r}();function vg(r,e,t,n){(function(o){M(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(r),function(o,a){M(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),M(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),M(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(t=t??0,n=n??1);var i=0;return Promise.all(r.map(function(o){return o.then(function(a){var s=t+ ++i/r.length*(n-t);return e(s),a}),o}))}function V0(r,e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s,u,c,l;return ot(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?j().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return a=h.sent(),[3,4];case 2:return[4,vg(n,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(d){return d.arrayBuffer()}),u=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,vg(s,e.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}})})}function xg(r){var e=this;return function(t,n,i){return n===void 0&&(n=""),it(e,void 0,void 0,function(){var o,a,s,u,c,l,h,d,f,p;return ot(this,function(m){switch(m.label){case 0:if(o=t.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],u=[],t.forEach(function(g,v){var x=0;g.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,y=sh[b]*at(w.shape),_=function(){o[v]=!0,a[v]==null&&(a[v]=[]),a[v].push({manifestEntry:w,groupOffset:x,sizeBytes:y})};i!=null?i.forEach(function(S,C){S===w.name&&(_(),s[C]=!0)}):_(),u.push(w.name),x+=y})}),!s.every(function(g){return g}))throw c=i.filter(function(g,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=o.reduce(function(g,v,x){return v&&g.push(x),g},[]),h=[],l.forEach(function(g){t[g].paths.forEach(function(v){var x=n+(n.endsWith("/")?"":"/")+v;h.push(x)})}),[4,r(h)];case 1:return d=m.sent(),f={},p=0,l.forEach(function(g){for(var v=t[g].paths.length,x=0,w=0;w<v;w++)x+=d[p+w].byteLength;for(var b=new ArrayBuffer(x),y=new Uint8Array(b),_=0,S=0;S<v;S++){var C=new Uint8Array(d[p+S]);y.set(C,_),_+=C.byteLength}a[g].forEach(function(E){var I=L0(b.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var A in I)f[A]=I[A]}),p+=v}),[2,f]}})})}}hn.registerSaveRouter(function(r){return j().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(zl.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new zl(e)}(r.slice(zl.URL_SCHEME.length)):null});var U0=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(M(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=j().platform.fetch,M(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&M(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return it(this,void 0,void 0,function(){var t,n,i,o;return ot(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:qa(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},r.prototype.load=function(){return it(this,void 0,void 0,function(){var e,t,n,i,o,a,s,u,c,l,h,d;return ot(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:d=f.sent(),l=d[0],h=d[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:l,weightData:h,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},r.prototype.loadWeights=function(e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s,u,c,l,h,d;return ot(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),v=p.substring(0,m),x=g>m?p.substring(g):"";return[v+"/",x]}(t),i=n[0],o=n[1],a=this.weightPathPrefix||i,s=[],u=0,c=e;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(m){h.push(a+m+o)})}),[4,V0(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[s,Yh(d)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function lh(r){return r.match(U0.URL_SCHEME_REGEX)!=null}var bg=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return lh(t)}):lh(r))?hh(r,{onProgress:e}):null};function hh(r,e){return new U0(r,e)}hn.registerSaveRouter(bg),hn.registerLoadRouter(bg);var Vl=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return it(this,void 0,void 0,function(){return ot(this,function(e){return[2,this.modelArtifacts]})})},r}(),xk=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return it(this,void 0,void 0,function(){return ot(this,function(t){return[2,this.saveHandler(e)]})})},r}(),Vu=Object.freeze({browserFiles:function(r){return new vk(r)},browserHTTPRequest:function(r,e){return hh(r,e)},concatenateArrayBuffers:Yh,decodeWeights:L0,encodeWeights:function(r,e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s=this;return ot(this,function(u){switch(u.label){case 0:for(t=[],n=[],i=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),o=function(c){var l=i[c],h=Array.isArray(r)?r[c].tensor:r[l];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+h.dtype);var d={name:l,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var f=new Promise(function(p){return it(s,void 0,void 0,function(){var m,g,v,x,w,b,y;return ot(this,function(_){switch(_.label){case 0:return[4,h.bytes()];case 1:for(m=_.sent(),g=m.reduce(function(S,C){return S+C.length},0)+Ru*m.length,v=new Uint8Array(g),x=0,w=0;w<m.length;w++)b=m[w],y=new Uint8Array(new Uint32Array([b.length]).buffer),v.set(y,x),x+=Ru,v.set(b,x),x+=b.length;return p(v),[2]}})})});n.push(f)}else n.push(h.data());e!=null&&(d.group=e),t.push(d)},a=0;a<i.length;++a)o(a);return[4,Promise.all(n)];case 1:return[2,{data:ak(u.sent()),specs:t}]}})})},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new Vl(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vl({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vl({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return hn.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:qa,getSaveHandlers:function(r){return hn.getSaveHandlers(r)},http:hh,isHTTPScheme:lh,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),it(this,void 0,void 0,function(){return ot(this,function(i){return[2,xg(function(o){return V0(o,{requestInit:n})})(r,e,t)]})})},registerLoadRouter:function(r){return hn.registerLoadRouter(r)},registerSaveRouter:function(r){return hn.registerSaveRouter(r)},weightsLoaderFactory:xg,withSaveHandler:function(r){return new xk(r)},copyModel:function(r,e){return it(this,void 0,void 0,function(){return ot(this,function(t){return[2,fg(r,e,!1)]})})},listModels:function(){return it(this,void 0,void 0,function(){var r,e,t,n,i,o,a;return ot(this,function(s){switch(s.label){case 0:r=Kr.getSchemes(),e={},t=0,n=r,s.label=1;case 1:return t<n.length?(i=n[t],[4,Kr.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+Eo+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(r,e){return it(this,void 0,void 0,function(){return ot(this,function(t){return[2,fg(r,e,!0)]})})},removeModel:function(r){return it(this,void 0,void 0,function(){var e;return ot(this,function(t){return e=fu(r),[2,Kr.getManager(e.scheme).removeModel(e.path)]})})}}),bo,bk=D({confusionMatrix_:function(r,e,t){var n=k(r,"labels","confusionMatrix"),i=k(e,"predictions","confusionMatrix");M(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),M(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),M(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),M(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),M(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=rh(n.asType("int32"),t),a=rh(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}}),VT=Object.freeze({confusionMatrix:bk}),yk=D({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,i=!1,o=!1,a=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)o=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);a=!0}if(i&&i&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(_g("FromPixels",F.backendName)!=null)return F.runKernel("FromPixels",{pixels:r},{numChannels:e});var s,u,c=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],l=c[0],h=c[1];if(a?s=r.getContext("2d").getImageData(0,0,l,h).data:n||t?s=r.data:(o||i)&&(bo==null&&(bo=document.createElement("canvas").getContext("2d")),bo.canvas.width=l,bo.canvas.height=h,bo.drawImage(r,0,0,l,h),s=bo.getImageData(0,0,l,h).data),e===4)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var f=0;f<d;f++)for(var p=0;p<e;++p)u[f*e+p]=s[4*f+p]}return Tu(u,[h,l,e],"int32")}}),Fo=Object.freeze({toPixels:function(r,e){return it(this,void 0,void 0,function(){var t,n,i,o,a,s,u,c,l,h,d,f,p,m,g,v,x,w,b,y,_,S,C;return ot(this,function(E){switch(E.label){case 0:if(t=k(r,"img","toPixels"),r instanceof zt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],o=n[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=E.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=E.sent(),h=l[0],d=l[1],f=h[0],p=d[0],u.dispose(),c.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)x=void 0,w=void 0,b=void 0,y=void 0,a===1?(x=s[v]*m,w=s[v]*m,b=s[v]*m,y=255):a===3?(x=s[3*v]*m,w=s[3*v+1]*m,b=s[3*v+2]*m,y=255):a===4&&(x=s[4*v]*m,w=s[4*v+1]*m,b=s[4*v+2]*m,y=s[4*v+3]*m),g[(_=4*v)+0]=Math.round(x),g[_+1]=Math.round(w),g[_+2]=Math.round(b),g[_+3]=Math.round(y);return e!=null&&(e.width=o,e.height=i,S=e.getContext("2d"),C=new ImageData(g,o,i),S.putImageData(C,0,0)),t!==r&&t.dispose(),[2,g]}})})},fromPixels:yk}),j0=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),H0=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function Jr(r){M(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),M(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),M(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),H0.register(r)}var UT=Object.freeze({Serializable:j0,SerializationMap:H0,registerClass:Jr}),wk=.001,G0=.1;function Ul(){return F.backend.floatPrecision()===32?wk:G0}function jl(r,e,t){var n=!0;if((Ae(r)||Ae(e))&&(n=!1),Ae(r)&&Ae(e)&&(n=!0),n){var i=r.constructor.name,o=e.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(r)&&Array.isArray(e)){var a=Xn(r),s=Xn(e);if(!fe(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Ae(r)?r:vr(r),c=Ae(e)?e:vr(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+`.
Actual:   `+u+`.
Expected: `+c+".");for(var l=0;l<c.length;++l){var h=u[l],d=c[l];if(!t(h,d))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+d+`.
Actual:   `+u+`.
Expected: `+c+".")}}function Hl(r,e,t){return!isFinite(r)&&!isFinite(e)||!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}var jT=Object.freeze({TEST_EPSILON_FLOAT16:G0,expectArraysClose:function(r,e,t){return t==null&&(t=Ul()),jl(r,e,function(n,i){return Hl(n,i,t)})},testEpsilon:Ul,expectPromiseToFail:function(r,e){r().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return qr(r)||qr(r[0])||qr(e)||qr(e[0])?jl(r,t,function(n,i){return n==i}):jl(r,e,function(n,i){return Hl(n,i,0)})},expectNumbersClose:function(r,e,t){if(t==null&&(t=Ul()),!Hl(r,e,t))throw new Error("Numbers differ: actual === "+r+", expected === "+e)},expectValuesInRange:function(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:"+r[n]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(r,e){expect(new Float32Array(r)).toEqual(new Float32Array(e))}});var HT=Object.freeze({gpgpu_util:H2,webgl_util:p_,forceHalfFloat:function(){j().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:s0,setWebGLContext:zg,GPGPUContext:t0}),Di=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return In(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return tn(s),n?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return K_(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&tn(this.iterations_)},e.prototype.saveIterations=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Z(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return it(this,void 0,void 0,function(){var n;return ot(this,function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(j0);Object.defineProperty(Di,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var q0=function(r){function e(t,n,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=F.backend.epsilon()),o}return In(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=F.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:X(function(){return It(a).variable(!1)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:X(function(){return It(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable,c=n.accumulatedUpdates[o].variable;X(function(){var l=u.mul(n.rho).add(s.square().mul(1-n.rho)),h=c.add(n.epsilon).sqrt().div(u.add(n.epsilon).sqrt()).mul(s),d=c.mul(n.rho).add(h.square().mul(1-n.rho));u.assign(l),c.assign(d);var f=h.mul(-n.learningRate).add(a);a.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(tn(this.accumulatedGrads.map(function(t){return t.variable})),tn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){var t;return ot(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){var n;return ot(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e}(Di);Jr(q0);var X0=function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return In(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=F.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:X(function(){return dn(a.shape,n.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable;X(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(F.backend.epsilon()).sqrt()).mul(-n.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&tn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e}(Di);Jr(X0);var K0=function(r){function e(t,n,i,o){o===void 0&&(o=null);var a=r.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],X(function(){a.accBeta1=Z(n).variable(),a.accBeta2=Z(i).variable()}),o==null&&(a.epsilon=F.backend.epsilon()),a}return In(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);X(function(){var o=Vt(1,n.accBeta1),a=Vt(1,n.accBeta2);i.forEach(function(s,u){var c=F.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:X(function(){return It(c).variable(!1)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:X(function(){return It(c).variable(!1)})});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var h=n.accumulatedFirstMoment[u].variable,d=n.accumulatedSecondMoment[u].variable,f=h.mul(n.beta1).add(l.mul(1-n.beta1)),p=d.mul(n.beta2).add(l.square().mul(1-n.beta2)),m=f.div(o),g=p.div(a);h.assign(f),d.assign(p);var v=m.div(g.sqrt().add(n.epsilon)).mul(-n.learningRate).add(c);c.assign(v)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&tn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&tn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){var t;return ot(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){var n,i=this;return ot(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),X(function(){i.accBeta1.assign(Iu(i.beta1,i.iterations_+1)),i.accBeta2.assign(Iu(i.beta2,i.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e}(Di);Jr(K0);var Y0=function(r){function e(t,n,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],X(function(){s.iteration=Z(0).variable(),s.accBeta1=Z(n).variable()}),o==null&&(s.epsilon=F.backend.epsilon()),s}return In(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);X(function(){var o=Vt(1,n.accBeta1),a=xn(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(s,u){var c=F.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:It(c).variable(!1)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:It(c).variable(!1)});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var h=n.accumulatedFirstMoment[u].variable,d=n.accumulatedWeightedInfNorm[u].variable,f=h.mul(n.beta1).add(l.mul(1-n.beta1)),p=d.mul(n.beta2),m=l.abs(),g=p.maximum(m);h.assign(f),d.assign(g);var v=a.div(o).mul(f.div(g.add(n.epsilon))).add(c);c.assign(v)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&tn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&tn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e}(Di);Jr(Y0);var $h=function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return In(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=F.registeredVariables[i];X(function(){var u=n.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=m_(Z(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e}(Di);Jr($h);var $0=function(r){function e(t,n,i){i===void 0&&(i=!1);var o=r.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=i,o.accumulations=[],o.m=Z(o.momentum),o}return In(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=F.registeredVariables[i];n.accumulations[o]==null&&(n.accumulations[o]={originalName:i+"/momentum",variable:X(function(){return It(a).variable(!1)})});var s=n.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&X(function(){var c,l=n.m.mul(s).add(u);c=n.useNesterov?n.c.mul(u.add(l.mul(n.m))).add(a):n.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&tn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){return ot(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){return ot(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e}($h);Jr($0);var J0=function(r){function e(t,n,i,o,a){n===void 0&&(n=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=F.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return In(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=F.registeredVariables[i];n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:X(function(){return It(a).variable(!1)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:X(function(){return It(a).variable(!1)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:X(function(){return It(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedMeanSquares[o].variable,c=n.accumulatedMoments[o].variable;X(function(){var l=u.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var h=n.accumulatedMeanGrads[o].variable,d=h.mul(n.decay).add(s.mul(1-n.decay)),f=c.mul(n.momentum).add(s.mul(n.learningRate).div(l.sub(d.square().add(n.epsilon)).sqrt()));u.assign(l),h.assign(d),c.assign(f);var p=a.sub(f);a.assign(p)}else{var m=u.mul(n.decay).add(s.square().mul(1-n.decay));f=c.mul(n.momentum).add(s.mul(n.learningRate).div(m.add(n.epsilon).sqrt())),u.assign(m),c.assign(f),p=a.sub(f),a.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&tn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&tn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&tn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return it(this,void 0,void 0,function(){var t;return ot(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return it(this,void 0,void 0,function(){var n;return ot(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e}(Di);Jr(J0);var vi=function(){function r(){}return r.sgd=function(e){return new $h(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new $0(e,t,n)},r.rmsprop=function(e,t,n,i,o){return t===void 0&&(t=.9),n===void 0&&(n=0),i===void 0&&(i=null),o===void 0&&(o=!1),new J0(e,t,n,i,o)},r.adam=function(e,t,n,i){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),new K0(e,t,n,i)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new q0(e,t,n)},r.adamax=function(e,t,n,i,o){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),o===void 0&&(o=0),new Y0(e,t,n,i,o)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new X0(e,t)},r}(),GT={sgd:vi.sgd,momentum:vi.momentum,adadelta:vi.adadelta,adagrad:vi.adagrad,rmsprop:vi.rmsprop,adamax:vi.adamax,adam:vi.adam};zt.prototype.squaredDifference=function(r){return u0(this,r)},W=ZE;function Qr(r,e,t){if(t===void 0&&(t=!1),r.beginPath(),e.slice(1).forEach(function(o,a){var s=o.x,u=o.y,c=e[a];r.moveTo(c.x,c.y),r.lineTo(s,u)}),t){var n=e[e.length-1],i=e[0];if(!n||!i)return;r.moveTo(n.x,n.y),r.lineTo(i.x,i.y)}r.stroke()}var Jh=function(r,e){return Jh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Jh(r,e)};function tt(r,e){Jh(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ge=function(){return ge=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},ge.apply(this,arguments)};function $(r,e,t,n){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(l){try{c(n.next(l))}catch(h){a(h)}}function u(l){try{c(n.throw(l))}catch(h){a(h)}}function c(l){l.done?o(l.value):i(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function J(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ti(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}var Dn=function(){function r(e,t){if(!Yn(e)||!Yn(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function Xa(r,e){return r instanceof zt&&r.shape.length===e}function Q0(r){return Xa(r,2)}function Zr(r){return Xa(r,3)}function yn(r){return Xa(r,4)}function Z0(r){return r%1!==0}function Qh(r){return r%2===0}function Uu(r,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(r*t)/t}function Zh(r){return r&&r.width&&r.height}function tx(r,e){var t=r.width,n=r.height,i=e/Math.max(n,t);return new Dn(Math.round(t*i),Math.round(n*i))}function Oo(r){return r.reduce(function(e,t){return e.add(t)},new bt(0,0)).div(new bt(r.length,r.length))}function _r(r,e,t){return Array(r).fill(0).map(function(n,i){return e+i*t})}function Yn(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function ju(r){return Yn(r)&&0<=r&&r<=1}var bt=function(){function r(e,t){this._x=e,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.sub=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.mul=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.div=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}();var Te=function(){function r(e,t){t===void 0&&(t=!0);var n=e||{},i=[n.left,n.top,n.right,n.bottom].every(Yn),o=[n.x,n.y,n.width,n.height].every(Yn);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var a=o?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=a[0],u=a[1],c=a[2],l=a[3];r.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",t),this._x=s,this._y=u,this._width=c,this._height=l}return r.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Yn)},r.assertIsValidBox=function(e,t,n){if(n===void 0&&(n=!1),!r.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new bt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new bt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new bt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new bt(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],n=e[1],i=e[2],o=e[3];return new r({x:t,y:n,width:i,height:o})},r.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],n=e[1],i=e[2],o=e[3];return new r({x:t,y:n,width:i,height:o})},r.prototype.toSquare=function(){var e=this,t=e.x,n=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(n-=a/2,o+=a),new r({x:t,y:n,width:i,height:o})},r.prototype.rescale=function(e){var t=Zh(e)?e.width:e,n=Zh(e)?e.height:e;return new r({x:this.x*t,y:this.y*n,width:this.width*t,height:this.height*n})},r.prototype.pad=function(e,t){var n=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=n[0],o=n[1],a=n[2],s=n[3];return new r({x:i,y:o,width:a,height:s})},r.prototype.clipAtImageBorders=function(e,t){var n=this,i=n.x,o=n.y,a=n.right,s=n.bottom,u=Math.max(i,0),c=Math.max(o,0),l=a-u,h=s-c,d=Math.min(l,e-u),f=Math.min(h,t-c);return new r({x:u,y:c,width:d,height:f}).floor()},r.prototype.shift=function(e,t){var n=this,i=n.width,o=n.height,a=this.x+e,s=this.y+t;return new r({x:a,y:s,width:i,height:o})},r.prototype.padAtBorders=function(e,t){var n=this.width+1,i=this.height+1,o=1,a=1,s=n,u=i,c=this.left,l=this.top,h=this.right,d=this.bottom;return h>t&&(s=-h+t+n,h=t),d>e&&(u=-d+e+i,d=e),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:a,edy:u,dx:o,edx:s,y:l,ey:d,x:c,ex:h,w:n,h:i}},r.prototype.calibrate=function(e){return new r({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},r}();var Pi=function(r){tt(e,r);function e(t,n,i,o,a){return a===void 0&&(a=!1),r.call(this,{left:t,top:n,right:i,bottom:o},a)||this}return e}(Te);var Hu=function(){function r(e,t,n,i,o){this._imageDims=new Dn(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new Te(i).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Te(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},r}();var he=function(r){tt(e,r);function e(t,n,i){return r.call(this,t,t,"",n,i)||this}return e.prototype.forSize=function(t,n){var i=r.prototype.forSize.call(this,t,n),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e}(Hu);function ex(r,e,t){t===void 0&&(t=!0);var n=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),i=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top)),o=n*i;return t?o/(r.area+e.area-o):o/Math.min(r.area,e.area)}function nx(r){var e=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),n=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new Pi(n,i,o,a)}function Cr(r,e,t,n){n===void 0&&(n=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,c=[],l=0;l<u.length;l++){var h=u[l],d=r[s],f=r[h];c.push(ex(d,f,n))}i=i.filter(function(p,m){return c[m]<=t})};i.length>0;)a();return o}function $n(r,e){return X(function(){var t=e[0],n=e[1],i=e[2],o=dn(Ti(r.shape.slice(0,3),[1]),t),a=dn(Ti(r.shape.slice(0,3),[1]),n),s=dn(Ti(r.shape.slice(0,3),[1]),i),u=Jt([o,a,s],3);return Vt(r,u)})}function rx(r,e){return e===void 0&&(e=!1),X(function(){var t=r.shape.slice(1),n=t[0],i=t[1];if(n===i)return r;var o=Math.abs(n-i),a=Math.round(o*(e?.5:1)),s=n>i?2:1,u=function(f){var p=r.shape.slice();return p[s]=f,dn(p,0)},c=u(a),l=o-c.shape[s],h=e&&l?u(l):null,d=[h,r,c].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return Jt(d,s)})}function Gu(r){return 1/(1+Math.exp(-r))}var No=function(r){tt(e,r);function e(t,n,i,o,a){return a===void 0&&(a=!1),r.call(this,{x:t,y:n,width:i,height:o},a)||this}return e}(Te);var Ck=.5,Sk=.43,Ek=.45,Sr=function(){function r(e,t,n){n===void 0&&(n=new bt(0,0));var i=t.width,o=t.height;this._imgDims=new Dn(i,o),this._shift=n,this._positions=e.map(function(a){return a.mul(new bt(i,o)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new bt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new bt(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},r.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new bt(e,t))},r.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},r.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var n=e instanceof he?e.box.floor():new Te(e);return this.shiftBy(n.x,n.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},r.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},a=(o(t)+o(n))/2,s=Math.floor(a/Ek),u=Oo(e),c=Math.floor(Math.max(0,u.x-Ck*s)),l=Math.floor(Math.max(0,u.y-Sk*s));return new No(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},r.prototype.alignMinBbox=function(e){var t=nx(this.positions);return t.pad(t.width*e,t.height*e)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}();var ix=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Oo([t[3],t[4]])]},e}(Sr);var qu=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Oo)},e}(Sr);var td=function(){function r(e,t){this._label=e,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+Uu(this.distance)+")":"")},r}();var ed=function(r){tt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._label=n,i}return e.assertIsValidLabeledBox=function(t,n){if(Te.assertIsValidBox(t,n),!Yn(t.label))throw new Error(n+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Te);var Ka=function(){function r(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},r.fromJSON=function(e){var t=e.descriptors.map(function(n){return new Float32Array(n)});return new r(e.label,t)},r}();var nF=function(r){tt(e,r);function e(t,n,i,o){var a=r.call(this,t,n)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(t,n){if(ed.assertIsValidLabeledBox(t,n),!ju(t.score)||!ju(t.classScore))throw new Error(n+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e}(ed);function Ya(r){return r.detection instanceof he}function Lo(r,e){var t={detection:e};return Object.assign({},r,t)}function nd(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:e}}function Xu(r){var e="";if(!r)try{r=ul("fs")}catch(n){e=n.toString()}var t=r?function(n){return new Promise(function(i,o){r.readFile(n,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function rd(){var r=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=Xu();return ge({Canvas:r||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:e||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:t,createImageElement:n,fetch:i},o)}function id(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function od(){return typeof global=="object"&&typeof ul=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var be;function kk(){if(!be)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return be}function ad(r){be=r}function sd(){id()&&ad(nd()),od()&&ad(rd())}function Ik(r){if(be||sd(),!be)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=r.Canvas,t=e===void 0?be.Canvas:e,n=r.Image,i=n===void 0?be.Image:n;be.Canvas=t,be.Image=i,be.createCanvasElement=r.createCanvasElement||function(){return new t},be.createImageElement=r.createImageElement||function(){return new i},be.ImageData=r.ImageData||be.ImageData,be.Video=r.Video||be.Video,be.fetch=r.fetch||be.fetch,be.readFile=r.readFile||be.readFile}var Rt={getEnv:kk,setEnv:ad,initialize:sd,createBrowserEnv:nd,createFileSystem:Xu,createNodejsEnv:rd,monkeyPatch:Ik,isBrowser:id,isNodejs:od};sd();function Bo(r){return!Rt.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function Pe(r){var e=Rt.getEnv(),t=e.Canvas,n=e.CanvasRenderingContext2D;if(r instanceof n)return r;var i=Bo(r);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var ti=function(r){return r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r}(ti||{}),ud=function(){function r(e){e===void 0&&(e={});var t=e.anchorPosition,n=e.backgroundColor,i=e.fontColor,o=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=t||ti.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=s||4}return r}();var cd=function(){function r(e,t,n){n===void 0&&(n={}),this.text=typeof e=="string"?[e]:e instanceof r?e.text:e,this.anchor=t,this.options=new ud(n)}return r.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(n){return e.measureText(n).width}).reduce(function(n,i){return n<i?i:n},0)+2*t},r.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},r.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,i=n===ti.BOTTOM_RIGHT||n===ti.TOP_RIGHT,o=n===ti.BOTTOM_LEFT||n===ti.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=i?this.anchor.x-a:this.anchor.x,c=o?this.anchor.y-s:this.anchor.y;if(t){var l=t.width,h=t.height,d=Math.max(Math.min(u,l-a),0),f=Math.max(Math.min(c,h-s),0);return{x:d,y:f}}return{x:u,y:c}},r.prototype.draw=function(e){var t=Bo(e),n=Pe(t),i=this.options,o=i.backgroundColor,a=i.fontColor,s=i.fontSize,u=i.fontStyle,c=i.padding;n.font=s+"px "+u;var l=this.measureWidth(n),h=this.measureHeight();n.fillStyle=o;var d=this.getUpperLeft(n,t);n.fillRect(d.x,d.y,l,h),n.fillStyle=a,this.text.forEach(function(f,p){var m=c+d.x,g=c+d.y+(p+1)*s;n.fillText(f,m,g)})},r}();var Mk=function(){function r(e){e===void 0&&(e={});var t=e.boxColor,n=e.lineWidth,i=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=i;var a={anchorPosition:ti.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new ud(Object.assign({},a,o))}return r}();var Rk=function(){function r(e,t){t===void 0&&(t={}),this.box=new Te(e),this.options=new Mk(t)}return r.prototype.draw=function(e){var t=Pe(e),n=this.options,i=n.boxColor,o=n.lineWidth,a=this.box,s=a.x,u=a.y,c=a.width,l=a.height;t.strokeStyle=i,t.lineWidth=o,t.strokeRect(s,u,c,l);var h=this.options.label;h&&new cd([h],{x:s-o/2,y:u},this.options.drawLabelOptions).draw(e)},r}();function Ku(r){var e=Rt.getEnv(),t=e.Image,n=e.Video;return r instanceof t&&r.complete||r instanceof n&&r.readyState>=3}function ox(r){return new Promise(function(e,t){if(r instanceof Rt.getEnv().Canvas||Ku(r))return e();function n(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",i),t(o))}r.addEventListener("load",n),r.addEventListener("error",i)})}function ax(r){return new Promise(function(e,t){if(!(r instanceof Blob))return t("bufferToImage - expected buf to be of type: Blob");var n=new FileReader;n.onload=function(){if(typeof n.result!="string")return t("bufferToImage - expected reader.result to be a string, in onload");var i=Rt.getEnv().createImageElement();i.onload=function(){return e(i)},i.onerror=t,i.src=n.result},n.onerror=t,n.readAsDataURL(r)})}function $a(r){var e=Rt.getEnv(),t=e.Image,n=e.Video;return r instanceof t?new Dn(r.naturalWidth,r.naturalHeight):r instanceof n?new Dn(r.videoWidth,r.videoHeight):new Dn(r.width,r.height)}function Fi(r){var e=r.width,t=r.height,n=Rt.getEnv().createCanvasElement,i=n();return i.width=e,i.height=t,i}function Wo(r,e){var t=Rt.getEnv().ImageData;if(!(r instanceof t)&&!Ku(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=e||$a(r),i=n.width,o=n.height,a=Fi({width:i,height:o});return r instanceof t?Pe(a).putImageData(r,0,0):Pe(a).drawImage(r,0,0,i,o),a}function sx(r,e){return $(this,void 0,void 0,function(){var t,n,i,o,a,s;return J(this,function(u){switch(u.label){case 0:return t=e||Rt.getEnv().createCanvasElement(),n=r.shape.slice(yn(r)?1:0),i=n[0],o=n[1],a=n[2],s=X(function(){return r.as3D(i,o,a).toInt()}),[4,Fo.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function ld(r){var e=Rt.getEnv(),t=e.Image,n=e.Canvas,i=e.Video;return r instanceof t||r instanceof n||r instanceof i}function ux(r,e,t){t===void 0&&(t=!1);var n=Rt.getEnv(),i=n.Image,o=n.Canvas;if(!(r instanceof i||r instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=$a(r),s=e/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Fi({width:e,height:e}),h=r instanceof o?r:Wo(r),d=Math.abs(u-c)/2,f=t&&u<c?d:0,p=t&&c<u?d:0;return Pe(l).drawImage(h,f,p,u,c),l}var Oi=function(){function r(e,t){var n=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(Zr(i)){n._imageTensors[o]=i,n._inputDimensions[o]=i.shape;return}if(yn(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");n._imageTensors[o]=i,n._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof Rt.getEnv().Canvas?i:Wo(i);n._canvases[o]=s,n._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var e=this;return _r(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},r.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},r.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},r.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},r.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),n=this.getInputHeight(e);return tx({width:t,height:n},this.inputSize)},r.prototype.toBatchTensor=function(e,t){var n=this;return t===void 0&&(t=!0),this._inputSize=e,X(function(){var i=_r(n.batchSize,0,1).map(function(a){var s=n.getInput(a);if(s instanceof zt){var u=yn(s)?s:s.expandDims();return u=rx(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=Ga.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof Rt.getEnv().Canvas)return Fo.fromPixels(ux(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=De(i.map(function(a){return a.toFloat()})).as4D(n.batchSize,e,e,3);return o})},r}();function Lt(r){return $(this,void 0,void 0,function(){var e,t,n;return J(this,function(i){switch(i.label){case 0:if(r instanceof Oi)return[2,r];if(e=Array.isArray(r)?r:[r],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(r)?" at input index "+o+":":""},n=e.map(Bo),n.forEach(function(o,a){if(!ld(o)&&!Zr(o)&&!yn(o))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(yn(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(o){return ld(o)&&ox(o)}))];case 1:return i.sent(),[2,new Oi(n,Array.isArray(r))]}})})}function Ja(r,e){return $(this,void 0,void 0,function(){var t,n,i,o,a,s,u;return J(this,function(c){switch(c.label){case 0:return t=Rt.getEnv().Canvas,n=r,r instanceof t?[3,5]:[4,Lt(r)];case 1:if(i=c.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,sx(o)];case 3:a=c.sent(),c.label=4;case 4:n=a,c.label=5;case 5:return s=Pe(n),u=e.map(function(l){return l instanceof he?l.forSize(n.width,n.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(n.width,n.height)}),[2,u.map(function(l){var h=l.x,d=l.y,f=l.width,p=l.height,m=Fi({width:f,height:p});return Pe(m).putImageData(s.getImageData(h,d,f,p),0,0),m})]}})})}function Qa(r,e){return $(this,void 0,void 0,function(){return J(this,function(t){if(!Zr(r)&&!yn(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(yn(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,X(function(){var n=r.shape.slice(yn(r)?1:0),i=n[0],o=n[1],a=n[2],s=e.map(function(c){return c instanceof he?c.forSize(o,i).box:c}).map(function(c){return c.clipAtImageBorders(o,i)}),u=s.map(function(c){var l=c.x,h=c.y,d=c.width,f=c.height;return zh(r.as3D(i,o,a),[h,l,0],[f,d,a])});return u})]})})}function Za(r,e){return $(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return t=Rt.getEnv().fetch,[4,t(r,e)];case 1:if(n=i.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function cx(r){return $(this,void 0,void 0,function(){var e,t;return J(this,function(n){switch(n.label){case 0:return[4,Za(r)];case 1:return e=n.sent(),[4,e.blob()];case 2:if(t=n.sent(),!t.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+t.type+", for url: "+e.url);return[2,ax(t)]}})})}function lx(r){return $(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,Za(r)];case 1:return[2,e.sent().json()]}})})}function Yu(r,e){var t=e+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var i=r.split("/").filter(function(s){return s}),o=r.endsWith(".json")?i[i.length-1]:t,a=n+(r.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=r.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function hx(r,e){return $(this,void 0,void 0,function(){var t,n,i,o;return J(this,function(a){switch(a.label){case 0:return t=Yu(r,e),n=t.manifestUri,i=t.modelBaseUri,[4,lx(n)];case 1:return o=a.sent(),[2,Vu.loadWeights(o,i)]}})})}var Ee=function(){function r(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),n=t.obj,i=t.objProp;return n[i]},r.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),i=n.obj,o=n.objProp;i[o].dispose(),i[o]=t},r.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Si})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Si)})},r.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,i=t.tensor;e.reassignParamFromPath(n,i.variable())})},r.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,i=t.tensor,o=Ce(i.dataSync());i.dispose(),e.reassignParamFromPath(n,o)})},r.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},r.prototype.load=function(e){return $(this,void 0,void 0,function(){return J(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(e){return $(this,void 0,void 0,function(){var t;return J(this,function(n){switch(n.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,hx(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(e){return $(this,void 0,void 0,function(){var t,n,i,o,a,s,u,c,l,h;return J(this,function(d){switch(d.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Rt.getEnv().readFile,n=Yu(e,this.getDefaultModelName()),i=n.manifestUri,o=n.modelBaseUri,a=function(f){return Promise.all(f.map(function(p){return t(p).then(function(m){return m.buffer})}))},s=Vu.weightsLoaderFactory(a),l=(c=JSON).parse,[4,t(i)];case 1:return u=l.apply(c,[d.sent().toString()]),[4,s(u,o)];case 2:return h=d.sent(),this.loadFromWeightMap(h),[2]}})})},r.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),n=t.obj,i=t.objProp;if(!n||!i||!(n[i]instanceof zt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:i}},r}();function Ke(r,e,t){return X(function(){var n=ja(r,e.depthwise_filter,e.pointwise_filter,t,"same");return n=lt(n,e.bias),n})}function $u(r,e,t){return t===void 0&&(t=!1),X(function(){var n=Ft(t?lt(Se(r,e.conv0.filters,[2,2],"same"),e.conv0.bias):Ke(r,e.conv0,[2,2])),i=Ke(n,e.conv1,[1,1]),o=Ft(lt(n,i)),a=Ke(o,e.conv2,[1,1]);return Ft(lt(n,lt(i,a)))})}function ts(r,e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!0),X(function(){var i=Ft(t?lt(Se(r,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):Ke(r,e.conv0,n?[2,2]:[1,1])),o=Ke(i,e.conv1,[1,1]),a=Ft(lt(i,o)),s=Ke(a,e.conv2,[1,1]),u=Ft(lt(i,lt(o,s))),c=Ke(u,e.conv3,[1,1]);return Ft(lt(i,lt(o,lt(s,c))))})}function ze(r,e,t,n){return t===void 0&&(t="same"),n===void 0&&(n=!1),X(function(){var i=lt(Se(r,e.filters,[1,1],t),e.bias);return n?Ft(i):i})}function ke(r,e){Object.keys(r).forEach(function(t){e.some(function(n){return n.originalPath===t})||r[t].dispose()})}function ei(r,e){return function(t,n,i,o){var a=xe(r(t*n*i*i),[i,i,t,n]),s=jt(r(n));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function zo(r,e){return function(t,n,i){var o=qn(r(t*n),[t,n]),a=jt(r(n));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var hd=function(){function r(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}return r}();function Vo(r,e){return function(t,n,i){var o=xe(r(9*t),[3,3,t,1]),a=xe(r(t*n),[1,1,t,n]),s=jt(r(n));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new hd(o,a,s)}}function Uo(r){return function(e){var t=r(e+"/depthwise_filter",4),n=r(e+"/pointwise_filter",4),i=r(e+"/bias",1);return new hd(t,n,i)}}function Ve(r,e){return function(t,n,i){var o=r[t];if(!Xa(o,n))throw new Error("expected weightMap["+t+"] to be a Tensor"+n+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function Ie(r){var e=r;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function n(){return e}return{extractWeights:t,getRemainingWeights:n}}function Ju(r,e){var t=ei(r,e),n=Vo(r,e);function i(a,s,u,c){c===void 0&&(c=!1);var l=c?t(a,s,3,u+"/conv0"):n(a,s,u+"/conv0"),h=n(s,s,u+"/conv1"),d=n(s,s,u+"/conv2");return{conv0:l,conv1:h,conv2:d}}function o(a,s,u,c){c===void 0&&(c=!1);var l=i(a,s,u,c),h=l.conv0,d=l.conv1,f=l.conv2,p=n(s,s,u+"/conv3");return{conv0:h,conv1:d,conv2:f,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function dx(r){var e=[],t=Ie(r),n=t.extractWeights,i=t.getRemainingWeights,o=Ju(n,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),c=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}function Qu(r){return function(e){var t=r(e+"/filters",4),n=r(e+"/bias",1);return{filters:t,bias:n}}}function Zu(r,e){var t=Ve(r,e),n=Qu(t),i=Uo(t);function o(s,u){u===void 0&&(u=!1);var c=u?n(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),h=i(s+"/conv2");return{conv0:c,conv1:l,conv2:h}}function a(s,u){u===void 0&&(u=!1);var c=u?n(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),h=i(s+"/conv2"),d=i(s+"/conv3");return{conv0:c,conv1:l,conv2:h,conv3:d}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function fx(r){var e=[],t=Zu(r,e).extractDenseBlock4Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return ke(r,e),{params:n,paramMappings:e}}var tc=function(r){tt(e,r);function e(){return r.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return X(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=$n(i,o).div(Z(255)),s=ts(a,n.dense0,!0);return s=ts(s,n.dense1),s=ts(s,n.dense2),s=ts(s,n.dense3),s=yr(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return fx(t)},e.prototype.extractParams=function(t){return dx(t)},e}(Ee);function en(r,e){return X(function(){return lt(Po(r,e.weights),e.bias)})}function px(r,e,t){var n=[],i=Ie(r),o=i.extractWeights,a=i.getRemainingWeights,s=zo(o,n),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:u}}}function mx(r){var e=[],t=Ve(r,e);function n(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:n("fc")};return ke(r,e),{params:i,paramMappings:e}}function ec(r){var e={},t={};return Object.keys(r).forEach(function(n){var i=n.startsWith("fc")?t:e;i[n]=r[n]}),{featureExtractorMap:e,classifierMap:t}}var nc=function(r){tt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._faceFeatureExtractor=n,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return X(function(){var o=t instanceof Oi?n.faceFeatureExtractor.forwardInput(t):t;return en(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,o=n.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return px(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var n=ec(t),i=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),mx(o)},e.prototype.extractParams=function(t){var n=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*n+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(Ee);var gx=["neutral","happy","sad","angry","fearful","disgusted","surprised"],rc=function(){function r(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);gx.forEach(function(n,i){t[n]=e[i]})}return r.prototype.asSortedArray=function(){var e=this;return gx.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,n){return n.probability-t.probability})},r}();var vx=function(r){tt(e,r);function e(t){return t===void 0&&(t=new tc),r.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var n=this;return X(function(){return Xe(n.runNet(t))})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return $(this,void 0,void 0,function(){var n,i,o,a,s=this;return J(this,function(u){switch(u.label){case 0:return[4,Lt(t)];case 1:return n=u.sent(),[4,this.forwardInput(n)];case 2:return i=u.sent(),[4,Promise.all(Nt(i).map(function(c){return $(s,void 0,void 0,function(){var l;return J(this,function(h){switch(h.label){case 0:return[4,c.data()];case 1:return l=h.sent(),c.dispose(),[2,l]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(c){return new rc(c)}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(nc);function dd(r,e){var t={expressions:e};return Object.assign({},r,t)}function ic(r){return Ya(r)&&r.landmarks instanceof Sr&&r.unshiftedLandmarks instanceof Sr&&r.alignedRect instanceof he}function jo(r,e){var t=r.detection.box,n=e.shiftBy(t.x,t.y),i=n.align(),o=r.detection.imageDims,a=new he(r.detection.score,i.rescale(o.reverse()),o),s={landmarks:n,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},r,s)}var Ak=function(){function r(e){e===void 0&&(e={});var t=e.drawLines,n=t===void 0?!0:t,i=e.drawPoints,o=i===void 0?!0:i,a=e.lineWidth,s=e.lineColor,u=e.pointSize,c=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"}return r}();var y4=function(){function r(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new Ak(t)}return r.prototype.draw=function(e){var t=Pe(e),n=this.options,i=n.drawLines,o=n.drawPoints,a=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;if(i&&this.faceLandmarks instanceof qu&&(t.strokeStyle=s,t.lineWidth=a,Qr(t,this.faceLandmarks.getJawOutline()),Qr(t,this.faceLandmarks.getLeftEyeBrow()),Qr(t,this.faceLandmarks.getRightEyeBrow()),Qr(t,this.faceLandmarks.getNose()),Qr(t,this.faceLandmarks.getLeftEye(),!0),Qr(t,this.faceLandmarks.getRightEye(),!0),Qr(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=c,t.fillStyle=c;var l=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(l)}},r}();function Tk(r,e){var t=ei(r,e),n=Vo(r,e);function i(a,s,u){var c=n(a,s,u+"/separable_conv0"),l=n(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:h}}function o(a,s){var u=n(a,a,s+"/separable_conv0"),c=n(a,a,s+"/separable_conv1"),l=n(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:n,extractReductionBlockParams:i,extractMainBlockParams:o}}function xx(r,e){var t=[],n=Ie(r),i=n.extractWeights,o=n.getRemainingWeights,a=Tk(i,t),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),d=c(32,64,"entry_flow/reduction_block_0"),f=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:d,reduction_block_1:f},m={};_r(e,0,1).forEach(function(w){m["main_block_"+w]=l(128,"middle_flow/main_block_"+w)});var g=c(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),x={reduction_block:g,separable_conv:v};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:m,exit_flow:x}}}function Pk(r,e){var t=Ve(r,e),n=Qu(t),i=Uo(t);function o(s){var u=i(s+"/separable_conv0"),c=i(s+"/separable_conv1"),l=n(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function a(s){var u=i(s+"/separable_conv0"),c=i(s+"/separable_conv1"),l=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:n,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function bx(r,e){var t=[],n=Pk(r,t),i=n.extractConvParams,o=n.extractSeparableConvParams,a=n.extractReductionBlockParams,s=n.extractMainBlockParams,u=i("entry_flow/conv_in"),c=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:c,reduction_block_1:l},d={};_r(e,0,1).forEach(function(g){d["main_block_"+g]=s("middle_flow/main_block_"+g)});var f=a("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),m={reduction_block:f,separable_conv:p};return ke(r,t),{params:{entry_flow:h,middle_flow:d,exit_flow:m},paramMappings:t}}function yx(r,e,t){return lt(Se(r,e.filters,t,"same"),e.bias)}function fd(r,e,t){t===void 0&&(t=!0);var n=t?Ft(r):r;return n=Ke(n,e.separable_conv0,[1,1]),n=Ke(Ft(n),e.separable_conv1,[1,1]),n=re(n,[3,3],[2,2],"same"),n=lt(n,yx(r,e.expansion_conv,[2,2])),n}function Fk(r,e){var t=Ke(Ft(r),e.separable_conv0,[1,1]);return t=Ke(Ft(t),e.separable_conv1,[1,1]),t=Ke(Ft(t),e.separable_conv2,[1,1]),t=lt(t,r),t}var wx=function(r){tt(e,r);function e(t){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return e.prototype.forwardInput=function(t){var n=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return X(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=$n(o,a).div(Z(256)),u=Ft(yx(s,i.entry_flow.conv_in,[2,2]));return u=fd(u,i.entry_flow.reduction_block_0,!1),u=fd(u,i.entry_flow.reduction_block_1),_r(n._numMainBlocks,0,1).forEach(function(c){u=Fk(u,i.middle_flow["main_block_"+c])}),u=fd(u,i.exit_flow.reduction_block),u=Ft(Ke(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return bx(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return xx(t,this._numMainBlocks)},e}(Ee);function _x(r){var e=[],t=Ie(r),n=t.extractWeights,i=t.getRemainingWeights,o=zo(n,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function Cx(r){var e=[],t=Ve(r,e);function n(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:n("fc/age"),gender:n("fc/gender")}};return ke(r,e),{params:i,paramMappings:e}}var es=function(r){return r.FEMALE="female",r.MALE="male",r}(es||{});var Sx=function(r){tt(e,r);function e(t){t===void 0&&(t=new wx(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return X(function(){var o=t instanceof Oi?n.faceFeatureExtractor.forwardInput(t):t,a=yr(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=en(a,i.fc.age).as1D(),u=en(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var n=this;return X(function(){var i=n.runNet(t),o=i.age,a=i.gender;return{age:o,gender:Xe(a)}})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return $(this,void 0,void 0,function(){var n,i,o,a,s,u,c=this;return J(this,function(l){switch(l.label){case 0:return[4,Lt(t)];case 1:return n=l.sent(),[4,this.forwardInput(n)];case 2:return i=l.sent(),o=Nt(i.age),a=Nt(i.gender),s=o.map(function(h,d){return{ageTensor:h,genderTensor:a[d]}}),[4,Promise.all(s.map(function(h){var d=h.ageTensor,f=h.genderTensor;return $(c,void 0,void 0,function(){var p,m,g,v,x;return J(this,function(w){switch(w.label){case 0:return[4,d.data()];case 1:return p=w.sent()[0],[4,f.data()];case 2:return m=w.sent()[0],g=m>.5,v=g?es.MALE:es.FEMALE,x=g?m:1-m,d.dispose(),f.dispose(),[2,{age:p,gender:v,genderProbability:x}]}})})}))];case 3:return u=l.sent(),i.age.dispose(),i.gender.dispose(),[2,n.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,o=n.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return _x(t)},e.prototype.extractParamsFromWeigthMap=function(t){var n=ec(t),i=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),Cx(o)},e.prototype.extractParams=function(t){var n=1539,i=t.slice(0,t.length-n),o=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(Ee);var oc=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.postProcess=function(t,n,i){var o=i.map(function(s){var u=s.width,c=s.height,l=n/Math.max(c,u);return{width:u*l,height:c*l}}),a=o.length;return X(function(){var s=function(d,f){return De([dn([68],d),dn([68],f)],1).as2D(1,136).as1D()},u=function(d,f){var p=o[d],m=p.width,g=p.height;return f(m,g)?Math.abs(m-g)/2:0},c=function(d){return u(d,function(f,p){return f<p})},l=function(d){return u(d,function(f,p){return p<f})},h=t.mul(dn([a,136],n)).sub(De(Array.from(Array(a),function(d,f){return s(c(f),l(f))}))).div(De(Array.from(Array(a),function(d,f){return s(o[f].width,o[f].height)})));return h})},e.prototype.forwardInput=function(t){var n=this;return X(function(){var i=n.runNet(t);return n.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return $(this,void 0,void 0,function(){var n,i,o,a=this;return J(this,function(s){switch(s.label){case 0:return[4,Lt(t)];case 1:return n=s.sent(),i=X(function(){return Nt(a.forwardInput(n))}),[4,Promise.all(i.map(function(u,c){return $(a,void 0,void 0,function(){var l,h,d,f,p;return J(this,function(m){switch(m.label){case 0:return d=(h=Array).from,[4,u.data()];case 1:return l=d.apply(h,[m.sent()]),f=l.filter(function(g,v){return Qh(v)}),p=l.filter(function(g,v){return!Qh(v)}),[2,new qu(Array(68).fill(0).map(function(g,v){return new bt(f[v],p[v])}),{height:n.getInputHeight(c),width:n.getInputWidth(c)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(nc);var ac=function(r){tt(e,r);function e(t){return t===void 0&&(t=new tc),r.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(oc);function Ex(r){var e=[],t=Zu(r,e).extractDenseBlock3Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return ke(r,e),{params:n,paramMappings:e}}function kx(r){var e=[],t=Ie(r),n=t.extractWeights,i=t.getRemainingWeights,o=Ju(n,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var Ix=function(r){tt(e,r);function e(){return r.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return X(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=$n(i,o).div(Z(255)),s=$u(a,n.dense0,!0);return s=$u(s,n.dense1),s=$u(s,n.dense2),s=yr(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ex(t)},e.prototype.extractParams=function(t){return kx(t)},e}(Ee);var Mx=function(r){tt(e,r);function e(t){return t===void 0&&(t=new Ix),r.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(oc);var WL=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(ac);function Rx(r,e){return lt(ee(r,e.weights),e.biases)}function pd(r,e,t,n,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=Se(r,a,t,i);return u=lt(u,s),u=Rx(u,e.scale),n?Ft(u):u}function Ax(r,e){return pd(r,e,[1,1],!0)}function md(r,e){return pd(r,e,[1,1],!1)}function sc(r,e){return pd(r,e,[2,2],!0,"valid")}function Ok(r,e){function t(s,u,c){var l=r(s),h=l.length/(u*c*c);if(Z0(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return X(function(){return bn(xe(l,[u,h,c,c]),[2,3,1,0])})}function n(s,u,c,l){var h=t(s,u,c),d=jt(r(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:h,bias:d}}function i(s,u){var c=jt(r(s)),l=jt(r(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function o(s,u,c,l){var h=n(s,u,c,l+"/conv"),d=i(u,l+"/scale");return{conv:h,scale:d}}function a(s,u,c,l,h){h===void 0&&(h=!1);var d=o((h?.5:1)*s,u,c,l+"/conv1"),f=o(s,u,c,l+"/conv2");return{conv1:d,conv2:f}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function Dx(r){var e=Ie(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],o=Ok(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),y=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),S=X(function(){return bn(qn(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var C={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:x,conv256_down:w,conv256_1:b,conv256_2:y,conv256_down_out:_,fc:S};return{params:C,paramMappings:i}}function Nk(r,e){var t=Ve(r,e);function n(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),c=n(a);return{conv:{filters:s,bias:u},scale:c}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Tx(r){var e=[],t=Nk(r,e),n=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=n("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),h=i("conv64_2"),d=i("conv64_3"),f=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),v=i("conv256_1"),x=i("conv256_2"),w=i("conv256_down_out"),b=r.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!Q0(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var y={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:x,conv256_down_out:w,fc:b};return ke(r,e),{params:y,paramMappings:e}}function Tn(r,e){var t=Ax(r,e.conv1);return t=md(t,e.conv2),t=lt(t,r),t=Ft(t),t}function ns(r,e){var t=sc(r,e.conv1);t=md(t,e.conv2);var n=yr(r,2,2,"valid"),i=Gt(n.shape),o=n.shape[3]!==t.shape[3],a=n.shape[1]!==t.shape[1]||n.shape[2]!==t.shape[2];if(a){var s=Ti(t.shape);s[1]=1;var u=Gt(s);t=Jt([t,u],1);var c=Ti(t.shape);c[2]=1;var l=Gt(c);t=Jt([t,l],2)}return n=o?Jt([n,i],3):n,t=lt(n,t),t=Ft(t),t}var gd=function(r){tt(e,r);function e(){return r.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return X(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=$n(i,o).div(Z(256)),s=sc(a,n.conv32_down);s=re(s,3,2,"valid"),s=Tn(s,n.conv32_1),s=Tn(s,n.conv32_2),s=Tn(s,n.conv32_3),s=ns(s,n.conv64_down),s=Tn(s,n.conv64_1),s=Tn(s,n.conv64_2),s=Tn(s,n.conv64_3),s=ns(s,n.conv128_down),s=Tn(s,n.conv128_1),s=Tn(s,n.conv128_2),s=ns(s,n.conv256_down),s=Tn(s,n.conv256_1),s=Tn(s,n.conv256_2),s=ns(s,n.conv256_down_out);var u=s.mean([1,2]),c=Po(u,n.fc);return c})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return $(this,void 0,void 0,function(){var n,i,o,a=this;return J(this,function(s){switch(s.label){case 0:return[4,Lt(t)];case 1:return n=s.sent(),i=X(function(){return Nt(a.forwardInput(n))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Tx(t)},e.prototype.extractParams=function(t){return Dx(t)},e}(Ee);function vd(r,e){var t={descriptor:e};return Object.assign({},r,t)}function xd(r,e){var t={age:e};return Object.assign({},r,t)}function bd(r,e,t){var n={gender:e,genderProbability:t};return Object.assign({},r,n)}var rs=function(){function r(e){var t=e===void 0?{}:e,n=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function Lk(r,e){function t(u,c){var l=xe(r(9*u),[3,3,u,1]),h=jt(r(u)),d=jt(r(u)),f=jt(r(u)),p=jt(r(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:h,batch_norm_offset:d,batch_norm_mean:f,batch_norm_variance:p}}function n(u,c,l,h,d){var f=xe(r(u*c*l*l),[l,l,u,c]),p=jt(r(c));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(d?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function i(u,c,l,h){var d=n(u,c,l,h,!0),f=d.filters,p=d.bias;return{filters:f,batch_norm_offset:p}}function o(u,c,l){var h=t(u,l+"/depthwise_conv"),d=i(u,c,1,l+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:d}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),c=o(32,64,"mobilenetv1/conv_1"),l=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),d=o(128,256,"mobilenetv1/conv_4"),f=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),m=o(512,512,"mobilenetv1/conv_7"),g=o(512,512,"mobilenetv1/conv_8"),v=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),w=o(512,512,"mobilenetv1/conv_11"),b=o(512,1024,"mobilenetv1/conv_12"),y=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,conv_8:g,conv_9:v,conv_10:x,conv_11:w,conv_12:b,conv_13:y}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),c=i(256,512,3,"prediction_layer/conv_1"),l=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),d=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),m=i(64,128,3,"prediction_layer/conv_7"),g=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),y=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),E=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),I=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),R={box_encoding_predictor:g,class_predictor:v},L={box_encoding_predictor:x,class_predictor:w},B={box_encoding_predictor:b,class_predictor:y},O={box_encoding_predictor:_,class_predictor:S},V={box_encoding_predictor:C,class_predictor:E},z={box_encoding_predictor:I,class_predictor:A};return{conv_0:u,conv_1:c,conv_2:l,conv_3:h,conv_4:d,conv_5:f,conv_6:p,conv_7:m,box_predictor_0:R,box_predictor_1:L,box_predictor_2:B,box_predictor_3:O,box_predictor_4:V,box_predictor_5:z}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function Px(r){var e=[],t=Ie(r),n=t.extractWeights,i=t.getRemainingWeights,o=Lk(n,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),c=s(),l=Tu(n(5118*4),[1,5118,4]),h={extra_dim:l};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:h},paramMappings:e}}function Bk(r,e){var t=Ve(r,e);function n(c,l,h){var d=t(c+"/Conv2d_"+l+"_pointwise/weights",4,h+"/filters"),f=t(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:d,batch_norm_offset:f}}function i(c){var l="mobilenetv1/conv_"+c,h="MobilenetV1/Conv2d_"+c+"_depthwise",d=l+"/depthwise_conv",f=l+"/pointwise_conv",p=t(h+"/depthwise_weights",4,d+"/filters"),m=t(h+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),g=t(h+"/BatchNorm/beta",1,d+"/batch_norm_offset"),v=t(h+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),x=t(h+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:x},pointwise_conv:n("MobilenetV1",c,f)}}function o(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(c,l){var h=t(c+"/weights",4,l+"/filters"),d=t(c+"/biases",1,l+"/bias");return{filters:h,bias:d}}function s(c){var l=a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:h}}function u(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function Fx(r){var e=[],t=Bk(r,e),n=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=r["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Zr(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:n(),prediction_layer:i(),output_layer:{extra_dim:o}};return ke(r,e),{params:a,paramMappings:e}}function wn(r,e,t){return X(function(){var n=Se(r,e.filters,t,"same");return n=lt(n,e.batch_norm_offset),Wa(n,0,6)})}var Wk=.0010000000474974513;function zk(r,e,t){return X(function(){var n=Ua(r,e.filters,t,"same");return n=Nh(n,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,Wk),Wa(n,0,6)})}function Vk(r){return[2,4,6,12].some(function(e){return e===r})?[2,2]:[1,1]}function Ox(r,e){return X(function(){var t=null,n=wn(r,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=Vk(s);n=zk(n,o.depthwise_conv,u),n=wn(n,o.pointwise_conv,[1,1]),s===11&&(t=n)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:t}})}function Nx(r,e,t,n,i){var o=r.shape[0],a=Math.min(t,o),s=e.map(function(l,h){return{score:l,boxIndex:h}}).filter(function(l){return l.score>i}).sort(function(l,h){return h.score-l.score}),u=function(l){return l<=n?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var h=l.score,d=c.length-1;d>=0;--d){var f=Uk(r,l.boxIndex,c[d]);if(f!==0&&(l.score*=u(f),l.score<=i))break}h===l.score&&c.push(l.boxIndex)}}),c}function Uk(r,e,t){var n=r.arraySync(),i=Math.min(n[e][0],n[e][2]),o=Math.min(n[e][1],n[e][3]),a=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),u=Math.min(n[t][0],n[t][2]),c=Math.min(n[t][1],n[t][3]),l=Math.max(n[t][0],n[t][2]),h=Math.max(n[t][1],n[t][3]),d=(a-i)*(s-o),f=(l-u)*(h-c);if(d<=0||f<=0)return 0;var p=Math.max(i,u),m=Math.max(o,c),g=Math.min(a,l),v=Math.min(s,h),x=Math.max(g-p,0)*Math.max(v-m,0);return x/(d+f-x)}function jk(r){var e=Nt(bn(r,[1,0])),t=[Vt(e[2],e[0]),Vt(e[3],e[1])],n=[lt(e[0],xn(t[0],Z(2))),lt(e[1],xn(t[1],Z(2)))];return{sizes:t,centers:n}}function Hk(r,e){var t=jk(r),n=t.sizes,i=t.centers,o=Nt(bn(e,[1,0])),a=xn(ee(Lu(xn(o[2],Z(5))),n[0]),Z(2)),s=lt(ee(xn(o[0],Z(10)),n[0]),i[0]),u=xn(ee(Lu(xn(o[3],Z(5))),n[1]),Z(2)),c=lt(ee(xn(o[1],Z(10)),n[1]),i[1]);return bn(De([Vt(s,a),Vt(c,u),lt(s,a),lt(c,u)]),[1,0])}function Lx(r,e,t){return X(function(){var n=r.shape[0],i=Hk(qe(Ci(t.extra_dim,[n,1,1]),[-1,4]),qe(r,[-1,4]));i=qe(i,[n,i.shape[0]/n,4]);var o=Oh(kn(e,[0,0,1],[-1,-1,-1])),a=kn(o,[0,0,0],[-1,-1,1]);a=qe(a,[n,a.shape[1]]);var s=Nt(i),u=Nt(a);return{boxes:s,scores:u}})}function Ni(r,e){return X(function(){var t=r.shape[0],n=qe(ze(r,e.box_encoding_predictor),[t,-1,1,4]),i=qe(ze(r,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:n,classPrediction:i}})}function Bx(r,e,t){return X(function(){var n=wn(r,t.conv_0,[1,1]),i=wn(n,t.conv_1,[2,2]),o=wn(i,t.conv_2,[1,1]),a=wn(o,t.conv_3,[2,2]),s=wn(a,t.conv_4,[1,1]),u=wn(s,t.conv_5,[2,2]),c=wn(u,t.conv_6,[1,1]),l=wn(c,t.conv_7,[2,2]),h=Ni(e,t.box_predictor_0),d=Ni(r,t.box_predictor_1),f=Ni(i,t.box_predictor_2),p=Ni(a,t.box_predictor_3),m=Ni(u,t.box_predictor_4),g=Ni(l,t.box_predictor_5),v=Jt([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),x=Jt([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:v,classPredictions:x}})}var ni=function(){function r(e){var t=e===void 0?{}:e,n=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}();var uc=function(r){tt(e,r);function e(){return r.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return X(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=Vt(ee(i,Z(.007843137718737125)),Z(1)),a=Ox(o,n.mobilenetv1),s=Bx(a.out,a.conv11,n.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return Lx(u,c,n.output_layer)})},e.prototype.forward=function(t){return $(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,Lt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,n){return n===void 0&&(n={}),$(this,void 0,void 0,function(){var i,o,a,s,u,c,l,h,d,f,p,m,g,v,x,w,b,y,_,S,C;return J(this,function(E){switch(E.label){case 0:return i=new ni(n),o=i.maxResults,a=i.minConfidence,[4,Lt(t)];case 1:for(s=E.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,h=c[0],d=l[0],f=1;f<c.length;f++)c[f].dispose(),l[f].dispose();return g=(m=Array).from,[4,d.data()];case 2:return p=g.apply(m,[E.sent()]),v=.5,x=Nx(h,p,o,v,a),w=s.getReshapedInputDimensions(0),b=s.inputSize,y=b/w.width,_=b/w.height,S=h.arraySync(),C=x.map(function(I){var A=[Math.max(0,S[I][0]),Math.min(1,S[I][2])].map(function(z){return z*_}),R=A[0],L=A[1],B=[Math.max(0,S[I][1]),Math.min(1,S[I][3])].map(function(z){return z*y}),O=B[0],V=B[1];return new he(p[I],new No(O,R,V-O,L-R),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),d.dispose(),[2,C]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Fx(t)},e.prototype.extractParams=function(t){return Px(t)},e}(Ee);var rW=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(uc);var Wx=.4,zx=[new bt(.738768,.874946),new bt(2.42204,2.65704),new bt(4.30971,7.04493),new bt(10.246,4.59428),new bt(12.6868,11.8741)],Vx=[new bt(1.603231,2.094468),new bt(6.041143,7.080126),new bt(2.882459,3.518061),new bt(4.266906,5.178857),new bt(9.041765,10.66308)],Ux=[117.001,114.697,97.404],jx="tiny_yolov2_model",Hx="tiny_yolov2_separable_conv_model";var cc=function(r){return typeof r=="number"};function Gx(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!cc(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(e){return e||{}}).every(function(e){return cc(e.x)&&cc(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(cc)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function Ho(r){return X(function(){var e=ee(r,Z(.10000000149011612));return lt(Ft(Vt(r,e)),e)})}function Er(r,e){return X(function(){var t=br(r,[[0,0],[1,1],[1,1],[0,0]]);return t=Se(t,e.conv.filters,[1,1],"valid"),t=Vt(t,e.bn.sub),t=ee(t,e.bn.truediv),t=lt(t,e.conv.bias),Ho(t)})}function kr(r,e){return X(function(){var t=br(r,[[0,0],[1,1],[1,1],[0,0]]);return t=ja(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=lt(t,e.bias),Ho(t)})}function Gk(r,e){var t=ei(r,e);function n(a,s){var u=jt(r(a)),c=jt(r(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function i(a,s,u){var c=t(a,s,3,u+"/conv"),l=n(s,u+"/bn");return{conv:c,bn:l}}var o=Vo(r,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function qx(r,e,t,n){var i=Ie(r),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=Gk(o,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,d;if(e.withSeparableConvs){var f=n[0],p=n[1],m=n[2],g=n[3],v=n[4],x=n[5],w=n[6],b=n[7],y=n[8],_=e.isFirstLayerConv2d?c(f,p,3,"conv0"):h(f,p,"conv0"),S=h(p,m,"conv1"),C=h(m,g,"conv2"),E=h(g,v,"conv3"),I=h(v,x,"conv4"),A=h(x,w,"conv5"),R=b?h(w,b,"conv6"):void 0,L=y?h(b,y,"conv7"):void 0,B=c(y||b||w,5*t,1,"conv8");d={conv0:_,conv1:S,conv2:C,conv3:E,conv4:I,conv5:A,conv6:R,conv7:L,conv8:B}}else{var f=n[0],p=n[1],m=n[2],g=n[3],v=n[4],x=n[5],w=n[6],b=n[7],y=n[8],_=l(f,p,"conv0"),S=l(p,m,"conv1"),C=l(m,g,"conv2"),E=l(g,v,"conv3"),I=l(v,x,"conv4"),A=l(x,w,"conv5"),R=l(w,b,"conv6"),L=l(b,y,"conv7"),B=c(y,5*t,1,"conv8");d={conv0:_,conv1:S,conv2:C,conv3:E,conv4:I,conv5:A,conv6:R,conv7:L,conv8:B}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function qk(r,e){var t=Ve(r,e);function n(s){var u=t(s+"/sub",1),c=t(s+"/truediv",1);return{sub:u,truediv:c}}function i(s){var u=t(s+"/filters",4),c=t(s+"/bias",1);return{filters:u,bias:c}}function o(s){var u=i(s+"/conv"),c=n(s+"/bn");return{conv:u,bn:c}}var a=Uo(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function Xx(r,e){var t=[],n=qk(r,t),i=n.extractConvParams,o=n.extractConvWithBatchNormParams,a=n.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return ke(r,t),{params:s,paramMappings:t}}var Li=function(){function r(e){var t=e===void 0?{}:e,n=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}();var lc=function(r){tt(e,r);function e(t){var n=r.call(this,"TinyYolov2")||this;return Gx(t),n._config=t,n}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,n){var i=Er(t,n.conv0);return i=re(i,[2,2],[2,2],"same"),i=Er(i,n.conv1),i=re(i,[2,2],[2,2],"same"),i=Er(i,n.conv2),i=re(i,[2,2],[2,2],"same"),i=Er(i,n.conv3),i=re(i,[2,2],[2,2],"same"),i=Er(i,n.conv4),i=re(i,[2,2],[2,2],"same"),i=Er(i,n.conv5),i=re(i,[2,2],[1,1],"same"),i=Er(i,n.conv6),i=Er(i,n.conv7),ze(i,n.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,n){var i=this.config.isFirstLayerConv2d?Ho(ze(t,n.conv0,"valid",!1)):kr(t,n.conv0);return i=re(i,[2,2],[2,2],"same"),i=kr(i,n.conv1),i=re(i,[2,2],[2,2],"same"),i=kr(i,n.conv2),i=re(i,[2,2],[2,2],"same"),i=kr(i,n.conv3),i=re(i,[2,2],[2,2],"same"),i=kr(i,n.conv4),i=re(i,[2,2],[2,2],"same"),i=kr(i,n.conv5),i=re(i,[2,2],[1,1],"same"),i=n.conv6?kr(i,n.conv6):i,i=n.conv7?kr(i,n.conv7):i,ze(i,n.conv8,"valid",!1)},e.prototype.forwardInput=function(t,n){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return X(function(){var a=t.toBatchTensor(n,!1).toFloat();return a=i.config.meanRgb?$n(a,i.config.meanRgb):a,a=a.div(Z(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(t,n){return $(this,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Lt(t)];case 1:return[4,i.apply(this,[o.sent(),n])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,n){return n===void 0&&(n={}),$(this,void 0,void 0,function(){var i,o,a,s,u,c,l,h,d,f,p,m,g,v,x=this;return J(this,function(w){switch(w.label){case 0:return i=new Li(n),o=i.inputSize,a=i.scoreThreshold,[4,Lt(t)];case 1:return s=w.sent(),[4,this.forwardInput(s,o)];case 2:return u=w.sent(),c=X(function(){return Nt(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return h=w.sent(),u.dispose(),c.dispose(),d=h.map(function(b){return b.box}),f=h.map(function(b){return b.score}),p=h.map(function(b){return b.classScore}),m=h.map(function(b){return x.config.classes[b.label]}),g=Cr(d.map(function(b){return b.rescale(o)}),f,this.config.iouThreshold,!0),v=g.map(function(b){return new Hu(f[b],p[b],m[b],d[b],l)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Xx(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=n?n.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return qx(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,n,i){return $(this,void 0,void 0,function(){var o,a,s,u,c,l,h,d,f,p,m,g,v,x,w,b,y,_,S,C,E,I,A,R,L,B,O,V,z,U=this;return J(this,function(H){switch(H.label){case 0:return o=n.width,a=n.height,s=Math.max(o,a),u=s/o,c=s/a,l=t.shape[1],h=this.config.anchors.length,d=X(function(){var K=t.reshape([l,l,h,U.boxEncodingSize]),et=K.slice([0,0,0,0],[l,l,h,4]),nt=K.slice([0,0,0,4],[l,l,h,1]),st=U.withClassScores?Xe(K.slice([0,0,0,5],[l,l,h,U.config.classes.length]),3):Z(0);return[et,nt,st]}),f=d[0],p=d[1],m=d[2],g=[],[4,p.array()];case 1:return v=H.sent(),[4,f.array()];case 2:x=H.sent(),w=0,H.label=3;case 3:if(!(w<l))return[3,12];b=0,H.label=4;case 4:if(!(b<l))return[3,11];y=0,H.label=5;case 5:return y<h?(_=Gu(v[w][b][y][0]),!i||_>i?(S=(b+Gu(x[w][b][y][0]))/l*u,C=(w+Gu(x[w][b][y][1]))/l*c,E=Math.exp(x[w][b][y][2])*this.config.anchors[y].x/l*u,I=Math.exp(x[w][b][y][3])*this.config.anchors[y].y/l*c,A=S-E/2,R=C-I/2,L={row:w,col:b,anchor:y},this.withClassScores?[4,this.extractPredictedClass(m,L)]:[3,7]):[3,9]):[3,10];case 6:return z=H.sent(),[3,8];case 7:z={classScore:1,label:0},H.label=8;case 8:B=z,O=B.classScore,V=B.label,g.push(ge({box:new Pi(A,R,A+E,R+I),score:_,classScore:_*O,label:V},L)),H.label=9;case 9:return y++,[3,5];case 10:return b++,[3,4];case 11:return w++,[3,3];case 12:return f.dispose(),p.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,n){return $(this,void 0,void 0,function(){var i,o,a,s;return J(this,function(u){switch(u.label){case 0:return i=n.row,o=n.col,a=n.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[i][o][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Ee);var yd=function(r){tt(e,r);function e(t){t===void 0&&(t=!0);var n=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:Wx,classes:["face"]},t?{anchors:Vx,meanRgb:Ux}:{anchors:zx,withClassScores:!0});return n=r.call(this,i)||this,n}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return $(this,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return[4,this.detect(t,n)];case 1:return i=o.sent(),[2,i.map(function(a){return new he(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?Hx:jx},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(lc);var Kx=function(r){tt(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(Li);var Jn=function(){function r(){}return r.prototype.then=function(e){return $(this,void 0,void 0,function(){var t;return J(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return $(this,void 0,void 0,function(){return J(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},r}();function Bi(r,e,t,n,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),$(this,void 0,void 0,function(){var o,a,s,u,c;return J(this,function(l){switch(l.label){case 0:return o=r.map(function(h){return ic(h)?i(h):h.detection}),s=n,s?[3,5]:e instanceof zt?[4,Qa(e,o)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Ja(e,o)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return a=s,[4,t(a)];case 6:return c=l.sent(),a.forEach(function(h){return h instanceof zt&&h.dispose()}),[2,c]}})})}function Go(r,e,t,n,i){return $(this,void 0,void 0,function(){var o=this;return J(this,function(a){return[2,Bi([r],e,function(s){return $(o,void 0,void 0,function(){return J(this,function(u){return[2,t(s[0])]})})},n,i)]})})}function Yx(r){return X(function(){return De(Nt(r,3).reverse(),3)})}var is=2,Wi=12;function Xk(r,e){var t=ei(r,e),n=zo(r,e);function i(c,l){var h=jt(r(c));return e.push({paramPath:l}),h}function o(c,l,h){h===void 0&&(h=!1);var d=t(c[0],c[1],3,l+"/conv1"),f=i(c[1],l+"/prelu1_alpha"),p=t(c[1],c[2],3,l+"/conv2"),m=i(c[2],l+"/prelu2_alpha"),g=t(c[2],c[3],h?2:3,l+"/conv3"),v=i(c[3],l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function a(){var c=o([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return ge(ge({},c),{conv4_1:l,conv4_2:h})}function s(){var c=o([3,28,48,64],"rnet",!0),l=n(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),d=n(128,2,"rnet/fc2_1"),f=n(128,4,"rnet/fc2_2");return ge(ge({},c),{fc1:l,prelu4_alpha:h,fc2_1:d,fc2_2:f})}function u(){var c=o([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),d=n(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),p=n(256,2,"onet/fc2_1"),m=n(256,4,"onet/fc2_2"),g=n(256,10,"onet/fc2_3");return ge(ge({},c),{conv4:l,prelu4_alpha:h,fc1:d,prelu5_alpha:f,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function $x(r){var e=Ie(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],o=Xk(t,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,c=a(),l=s(),h=u();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:i}}function Kk(r,e){var t=Ve(r,e);function n(l){var h=t(l+"/weights",4,l+"/filters"),d=t(l+"/bias",1);return{filters:h,bias:d}}function i(l){var h=t(l+"/weights",2),d=t(l+"/bias",1);return{weights:h,bias:d}}function o(l){return t(l,1)}function a(l){var h=n(l+"/conv1"),d=o(l+"/prelu1_alpha"),f=n(l+"/conv2"),p=o(l+"/prelu2_alpha"),m=n(l+"/conv3"),g=o(l+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:f,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function s(){var l=a("pnet"),h=n("pnet/conv4_1"),d=n("pnet/conv4_2");return ge(ge({},l),{conv4_1:h,conv4_2:d})}function u(){var l=a("rnet"),h=i("rnet/fc1"),d=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),p=i("rnet/fc2_2");return ge(ge({},l),{fc1:h,prelu4_alpha:d,fc2_1:f,fc2_2:p})}function c(){var l=a("onet"),h=n("onet/conv4"),d=o("onet/prelu4_alpha"),f=i("onet/fc1"),p=o("onet/prelu5_alpha"),m=i("onet/fc2_1"),g=i("onet/fc2_2"),v=i("onet/fc2_3");return ge(ge({},l),{conv4:h,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function Jx(r){var e=[],t=Kk(r,e),n=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=n(),s=i(),u=o();return ke(r,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function os(r,e){var t=e[0],n=e[1];return{height:Math.floor(t*r),width:Math.floor(n*r)}}function Qx(r,e,t){for(var n=t[0],i=t[1],o=Wi/r,a=[],s=Math.min(n,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var qo=function(r){tt(e,r);function e(t,n,i,o){return r.call(this,{left:t,top:n,right:i,bottom:o},!0)||this}return e}(Te);function hc(r){return X(function(){return ee(Vt(r,Z(127.5)),Z(.0078125))})}function Ir(r,e){return X(function(){return lt(Ft(r),ee(e,za(Ft(za(r)))))})}function Xo(r,e,t){return t===void 0&&(t=!1),X(function(){var n=ze(r,e.conv1,"valid");return n=Ir(n,e.prelu1_alpha),n=re(n,t?[2,2]:[3,3],[2,2],"same"),n=ze(n,e.conv2,"valid"),n=Ir(n,e.prelu2_alpha),n=t?n:re(n,[3,3],[2,2],"valid"),n=ze(n,e.conv3,"valid"),n=Ir(n,e.prelu3_alpha),n})}function Zx(r,e){return X(function(){var t=Xo(r,e,!0),n=ze(t,e.conv4_1,"valid"),i=Le(Ai(n,3),3),o=Xe(Vt(n,i),3),a=ze(t,e.conv4_2,"valid");return{prob:o,regions:a}})}function Yk(r,e){return X(function(){var t=os(e,r.shape.slice(1)),n=t.height,i=t.width,o=Ga.resizeBilinear(r,[n,i]),a=hc(o);return bn(a,[0,2,1,3])})}function $k(r,e,t,n){for(var i=[],o=r.arraySync(),a=0;a<r.shape[0];a++)for(var s=0;s<r.shape[1];s++)o[a][s]>=n&&i.push(new bt(s,a));var u=i.map(function(c){var l=new Pi(Math.round((c.y*is+1)/t),Math.round((c.x*is+1)/t),Math.round((c.y*is+Wi)/t),Math.round((c.x*is+Wi)/t)),h=o[c.y][c.x],d=e.arraySync(),f=new qo(d[c.y][c.x][0],d[c.y][c.x][1],d[c.y][c.x][2],d[c.y][c.x][3]);return{cell:l,score:h,region:f}});return u}function tb(r,e,t,n,i){i.stage1=[];var o=e.map(function(d){return X(function(){var f={scale:d},p=Yk(r,d),m=Date.now(),g=Zx(p,n),v=g.prob,x=g.regions;f.pnet=Date.now()-m;var w=Nt(Nt(v,3)[1])[0],b=Nt(x)[0];return{scoresTensor:w,regionsTensor:b,scale:d,statsForScale:f}})}),a=o.map(function(d){var f=d.scoresTensor,p=d.regionsTensor,m=d.scale,g=d.statsForScale,v=$k(f,p,m,t);if(f.dispose(),p.dispose(),!v.length)return i.stage1.push(g),[];var x=Date.now(),w=Cr(v.map(function(b){return b.cell}),v.map(function(b){return b.score}),.5);return g.nms=Date.now()-x,g.numBoxes=w.length,i.stage1.push(g),w.map(function(b){return v[b]})}),s=a.reduce(function(d,f){return d.concat(f)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),h=Cr(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);i.stage1_nms=Date.now()-l,c=h.map(function(d){return s[d].score}),u=h.map(function(d){return s[d]}).map(function(d){var f=d.cell,p=d.region;return new Pi(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:u,scores:c}}function dc(r,e,t){var n=t.width,i=t.height;return $(this,void 0,void 0,function(){var o,a,s,u=this;return J(this,function(c){switch(c.label){case 0:return o=Pe(r),[4,Promise.all(e.map(function(l){return $(u,void 0,void 0,function(){var h,d,f,p,m,g,v,x;return J(this,function(w){return h=l.padAtBorders(r.height,r.width),d=h.y,f=h.ey,p=h.x,m=h.ex,g=p-1,v=d-1,x=o.getImageData(g,v,m-g,f-v),[2,Rt.isNodejs()?Wo(x):createImageBitmap(x)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var h=Fi({width:n,height:i}),d=Pe(h);d.drawImage(l,0,0,n,i);for(var f=d.getImageData(0,0,n,i).data,p=[],m=0;m<f.length;m+=4)p.push(f[m+2]),p.push(f[m+1]),p.push(f[m]);s.push(p)}),[2,s.map(function(l){var h=X(function(){var d=bn(xe(l,[1,n,i,3]),[0,2,1,3]).toFloat();return hc(d)});return h})]}})})}function eb(r,e){return X(function(){var t=Xo(r,e),n=qe(t,[t.shape[0],e.fc1.weights.shape[0]]),i=en(n,e.fc1),o=Ir(i,e.prelu4_alpha),a=en(o,e.fc2_1),s=Le(Ai(a,1),1),u=Xe(Vt(a,s),1),c=en(o,e.fc2_2),l=Nt(u,1)[1];return{scores:l,regions:c}})}function nb(r,e,t,n,i){return $(this,void 0,void 0,function(){var o,a,s,u,c,l,h,d,f,p,m,g,v,x;return J(this,function(w){switch(w.label){case 0:return o=Date.now(),[4,dc(r,e,{width:24,height:24})];case 1:return a=w.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(b){var y=eb(b,n);return b.dispose(),y}),i.stage2_rnet=Date.now()-o,u=s.length>1?Jt(s.map(function(b){return b.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[w.sent()]),u.dispose(),d=c.map(function(b,y){return{score:b,idx:y}}).filter(function(b){return b.score>t}).map(function(b){var y=b.idx;return y}),f=d.map(function(b){return e[b]}),p=d.map(function(b){return c[b]}),m=[],g=[],f.length>0&&(o=Date.now(),v=Cr(f,p,.7),i.stage2_nms=Date.now()-o,x=v.map(function(b){var y=s[d[b]].regions.arraySync();return new qo(y[0][0],y[0][1],y[0][2],y[0][3])}),g=v.map(function(b){return p[b]}),m=v.map(function(b,y){return f[b].calibrate(x[y])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function rb(r,e){return X(function(){var t=Xo(r,e);t=re(t,[2,2],[2,2],"same"),t=ze(t,e.conv4,"valid"),t=Ir(t,e.prelu4_alpha);var n=qe(t,[t.shape[0],e.fc1.weights.shape[0]]),i=en(n,e.fc1),o=Ir(i,e.prelu5_alpha),a=en(o,e.fc2_1),s=Le(Ai(a,1),1),u=Xe(Vt(a,s),1),c=en(o,e.fc2_2),l=en(o,e.fc2_3),h=Nt(u,1)[1];return{scores:h,regions:c,points:l}})}function ib(r,e,t,n,i){return $(this,void 0,void 0,function(){var o,a,s,u,c,l,h,d,f,p,m,g,v,x,w;return J(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,dc(r,e,{width:48,height:48})];case 1:return a=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(y){var _=rb(y,n);return y.dispose(),_}),i.stage3_onet=Date.now()-o,u=s.length>1?Jt(s.map(function(y){return y.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),d=c.map(function(y,_){return{score:y,idx:_}}).filter(function(y){return y.score>t}).map(function(y){var _=y.idx;return _}),f=d.map(function(y){var _=s[y].regions.arraySync();return new qo(_[0][0],_[0][1],_[0][2],_[0][3])}),p=d.map(function(y,_){return e[y].calibrate(f[_])}),m=d.map(function(y){return c[y]}),g=[],v=[],x=[],p.length>0&&(o=Date.now(),w=Cr(p,m,.7,!1),i.stage3_nms=Date.now()-o,g=w.map(function(y){return p[y]}),v=w.map(function(y){return m[y]}),x=w.map(function(y,_){return Array(5).fill(0).map(function(S,C){var E=s[y].points.arraySync();return new bt(E[0][C]*(g[_].width+1)+g[_].left,E[0][C+5]*(g[_].height+1)+g[_].top)})})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose(),y.points.dispose()}),[2,{boxes:g,scores:v,points:x}]}})})}var wd=function(r){tt(e,r);function e(){return r.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return $(this,void 0,void 0,function(){return J(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return $(this,void 0,void 0,function(){return J(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,n){return n===void 0&&(n={}),$(this,void 0,void 0,function(){var i,o,a,s,u,c,l,h,d,f,p,m,g,v,x,w,b,y,_,S,C;return J(this,function(E){switch(E.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=X(function(){return Yx(Le(Fo.fromPixels(o)).toFloat())}),c=function(I){return u.dispose(),a.total=Date.now()-s,I},l=u.shape.slice(1),h=l[0],d=l[1],f=new rs(n),p=f.minFaceSize,m=f.scaleFactor,g=f.maxNumScales,v=f.scoreThresholds,x=f.scaleSteps,w=(x||Qx(p,m,[h,d])).filter(function(I){var A=os(I,[h,d]);return Math.min(A.width,A.height)>Wi}).slice(0,g),a.scales=w,a.pyramid=w.map(function(I){return os(I,[h,d])}),b=Date.now(),[4,tb(u,w,v[0],i.pnet,a)];case 1:return y=E.sent(),a.total_stage1=Date.now()-b,y.boxes.length?(a.stage2_numInputBoxes=y.boxes.length,b=Date.now(),[4,nb(o,y.boxes,v[1],i.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-b,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,ib(o,_.boxes,v[2],i.onet,a)]):[2,c({results:[],stats:a})];case 3:return S=E.sent(),a.total_stage3=Date.now()-b,C=S.boxes.map(function(I,A){return jo(Lo({},new he(S.scores[A],new No(I.left/d,I.top/h,I.width/d,I.height/h),{height:h,width:d})),new ix(S.points[A].map(function(R){return R.sub(new bt(I.left,I.top)).div(new bt(I.width,I.height))}),{width:I.width,height:I.height}))}),[2,c({results:C,stats:a})]}})})},e.prototype.forward=function(t,n){return n===void 0&&(n={}),$(this,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Lt(t)];case 1:return[4,i.apply(this,[o.sent(),n])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,n){return n===void 0&&(n={}),$(this,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Lt(t)];case 1:return[2,i.apply(this,[o.sent(),n])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Jx(t)},e.prototype.extractParams=function(t){return $x(t)},e}(Ee);var ob=.4,ab=[new bt(1.603231,2.094468),new bt(6.041143,7.080126),new bt(2.882459,3.518061),new bt(4.266906,5.178857),new bt(9.041765,10.66308)],sb=[117.001,114.697,97.404];var _d=function(r){tt(e,r);function e(){var t=this,n={withSeparableConvs:!0,iouThreshold:ob,classes:["face"],anchors:ab,meanRgb:sb,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,n)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return $(this,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return[4,this.detect(t,n)];case 1:return i=o.sent(),[2,i.map(function(a){return new he(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(lc);var ye={ssdMobilenetv1:new uc,tinyFaceDetector:new _d,tinyYolov2:new yd,mtcnn:new wd,faceLandmark68Net:new ac,faceLandmark68TinyNet:new Mx,faceRecognitionNet:new gd,faceExpressionNet:new vx,ageGenderNet:new Sx};var ub=function(r){tt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=i,o}return e}(Jn);var as=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i=this;return J(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,Bi(t,this.input,function(a){return $(i,void 0,void 0,function(){return J(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ye.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,t.map(function(a,s){return dd(a,n[s])})]}})})},e.prototype.withAgeAndGender=function(){return new us(this,this.input)},e}(ub);var ss=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,Go(t,this.input,function(o){return ye.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return n=i.sent(),[2,dd(t,n)]}})})},e.prototype.withAgeAndGender=function(){return new cs(this,this.input)},e}(ub);var Ko=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new $o(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Qo(this,this.input)},e}(as);var Yo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new Jo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Zo(this,this.input)},e}(ss);var cb=function(r){tt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=i,o}return e}(Jn);var us=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i=this;return J(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,Bi(t,this.input,function(a){return $(i,void 0,void 0,function(){return J(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ye.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,t.map(function(a,s){var u=n[s],c=u.age,l=u.gender,h=u.genderProbability;return xd(bd(a,l,h),c)})]}})})},e.prototype.withFaceExpressions=function(){return new as(this,this.input)},e}(cb);var cs=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i,o,a;return J(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,Go(t,this.input,function(u){return ye.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return n=s.sent(),i=n.age,o=n.gender,a=n.genderProbability,[2,xd(bd(t,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new ss(this,this.input)},e}(cb);var $o=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new Ko(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Qo(this,this.input)},e}(us);var Jo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new Yo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Zo(this,this.input)},e}(cs);var lb=function(r){tt(e,r);function e(t,n){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i}return e}(Jn);var Qo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Bi(t,this.input,function(o){return Promise.all(o.map(function(a){return ye.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=i.sent(),[2,n.map(function(o,a){return vd(t[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new Ko(this,this.input)},e.prototype.withAgeAndGender=function(){return new $o(this,this.input)},e}(lb);var Zo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,Go(t,this.input,function(o){return ye.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=i.sent(),[2,vd(t,n)]}})})},e.prototype.withFaceExpressions=function(){return new Yo(this,this.input)},e.prototype.withAgeAndGender=function(){return new Jo(this,this.input)},e}(lb);var hb=function(r){tt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ye.faceLandmark68TinyNet:ye.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Jn);var db=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i,o,a,s=this;return J(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),n=t.map(function(c){return c.detection}),this.input instanceof zt?[4,Qa(this.input,n)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,Ja(this.input,n)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),i.forEach(function(c){return c instanceof zt&&c.dispose()}),[2,t.map(function(c,l){return jo(c,a[l])})]}})})},e.prototype.withFaceExpressions=function(){return new Ko(this,this.input)},e.prototype.withAgeAndGender=function(){return new $o(this,this.input)},e.prototype.withFaceDescriptors=function(){return new Qo(this,this.input)},e}(hb);var fb=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i,o,a;return J(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(n=t.detection,this.input instanceof zt?[4,Qa(this.input,[n])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,Ja(this.input,[n])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof zt&&u.dispose()}),[2,jo(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new Yo(this,this.input)},e.prototype.withAgeAndGender=function(){return new Jo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Zo(this,this.input)},e}(hb);var pb=function(r){tt(e,r);function e(t,n){n===void 0&&(n=new ni);var i=r.call(this)||this;return i.input=t,i.options=n,i}return e}(Jn);var Cd=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n,i,o;return J(this,function(a){switch(a.label){case 0:return t=this,n=t.input,i=t.options,i instanceof rs?[4,ye.mtcnn.forward(n,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof Kx?function(s){return ye.tinyFaceDetector.locateFaces(s,i)}:i instanceof ni?function(s){return ye.ssdMobilenetv1.locateFaces(s,i)}:i instanceof Li?function(s){return ye.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(n)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(n){return $(t,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,n(i.map(function(a){return Lo({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new db(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new as(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new us(this.runAndExtendWithFaceDetections(),this.input)},e}(pb);var Jk=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return $(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,new Cd(this.input,this.options)];case 1:return t=i.sent(),n=t[0],t.forEach(function(o){o.score>n.score&&(n=o)}),[2,n]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(n){return $(t,void 0,void 0,function(){var i;return J(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,n(i?Lo({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new fb(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new ss(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new cs(this.runAndExtendWithFaceDetection(),this.input)},e}(pb);function Sd(r,e){return e===void 0&&(e=new ni),new Cd(r,e)}function mb(r,e){if(r.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),n=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-n[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}var XV=function(){function r(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=n.map(function(a){if(a instanceof Ka)return a;if(a instanceof Float32Array)return new Ka(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Ka(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(e,t){return t.map(function(n){return mb(n,e)}).reduce(function(n,i){return n+i},0)/(t.length||1)},r.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var i=n.descriptors,o=n.label;return new td(o,t.computeMeanDistance(e,i))}).reduce(function(n,i){return n.distance<i.distance?n:i})},r.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new td("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},r.fromJSON=function(e){var t=e.labeledDescriptors.map(function(n){return Ka.fromJSON(n)});return new r(t,e.distanceThreshold)},r}();var Zk=["fileInput"];function tI(r,e){r&1&&(T(0,"div",43)(1,"div",44),G(2,"Checking Human"),P()())}function eI(r,e){r&1&&(T(0,"div",45),Qi(),T(1,"svg",46),Y(2,"path",47)(3,"polyline",48),P(),G(4,"Verified humain photo"),P())}function nI(r,e){r&1&&(T(0,"div",49),G(1," Not verified as humain "),P())}var gb=(()=>{let e=class e{constructor(n){this.userService=n,this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1,this.user={},this.uploadedImageUrl="",this.modelUrl="https://justadudewhohacks.github.io/face-api.js/models/ssd_mobilenetv1_model-weights_manifest.json"}ngOnInit(){this.getUserProfile()}getUserProfile(){return je(this,null,function*(){let n=yield localStorage.getItem("user");if(n){let o=JSON.parse(n).email;this.userService.getUserByEmail(o).subscribe(a=>{this.user=a})}})}updateProfileImage(){return je(this,null,function*(){yield this.userService.uploadProfileImage(this.user.email,this.uploadedImageUrl).subscribe(()=>{this.user.image=this.uploadedImageUrl,this.uploadedImageUrl="",this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1},n=>{})})}onFileSelected(n){return je(this,null,function*(){let i=n.target.files[0];if(i){let o=new FormData;o.append("image",i),this.userService.uploadImage(o).subscribe(a=>je(this,null,function*(){this.uploadedImageUrl=a.url,this.displayStatusImage=!0,yield this.detectFaces(a.url)}),a=>{})}})}detectFaces(n){return je(this,null,function*(){yield ye.ssdMobilenetv1.loadFromUri(this.modelUrl);let i=yield cx(n),o=yield Sd(i);this.displayStatusImage=!1,o.length>0?(this.verifiedImageHumain=!0,this.NotVerifedHumain=!1):(this.NotVerifedHumain=!0,this.verifiedImageHumain=!1)})}};e.\u0275fac=function(i){return new(i||e)(vt(Vr))},e.\u0275cmp=Wt({type:e,selectors:[["app-profile"]],viewQuery:function(i,o){if(i&1&&cr(Zk,5),i&2){let a;lr(a=hr())&&(o.fileInput=a.first)}},decls:71,vars:16,consts:[[1,"h-100","gradient-custom-2"],[1,"container","py-5","h-100"],[1,"row","d-flex","justify-content-center","align-items-center","h-100"],[1,"col","col-lg-9","col-xl-7"],[1,"card"],[1,"rounded-top","text-white","d-flex","flex-row",2,"background-color","#000","height","200px"],[1,"ms-4","mt-5","d-flex","flex-column",2,"width","150px","height","150px"],["alt","Generic placeholder image",1,"img-fluid","img-thumbnail","mt-4","mb-2",2,"width","150px","height","150px","object-fit","cover","z-index","1",3,"src"],["type","button","data-mdb-button-init","","data-mdb-ripple-init","","data-mdb-ripple-color","dark","data-toggle","modal","data-target","#exampleModal",1,"btn","btn-outline-dark",2,"z-index","1"],[1,"ms-3",2,"margin-top","130px"],[1,"p-4","text-black",2,"background-color","#f8f9fa"],[1,"d-flex","justify-content-end","text-center","py-1"],[1,"mb-1","h5"],[1,"small","text-muted","mb-0"],[1,"px-3"],[1,"card-body","p-4","text-black"],[1,"mb-5"],[1,"lead","fw-normal","mb-1"],[1,"p-4",2,"margin-bottom","10px"],[1,"font-italic","mb-1"],[1,"font-italic","mb-0"],["id","exampleModal","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"flex","justify-center","h-screen","items-center","px-3"],[1,"rounded-lg","shadow-xl","bg-gray-50","md:w-1/2","w-[360px]"],[1,"m-4"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","cursor-pointer","flex-col","w-full","h-32","border-2","rounded-md","border-dashed","hover:bg-gray-100","hover:border-gray-300"],[1,"flex","flex-col","items-center","justify-center","pt-7"],["width","370","height","320",3,"src"],["type","file",1,"opacity-0",3,"change"],["fileInput",""],["class","progress",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["data-dismiss","modal","type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"alert","alert-success"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-check-circle"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["role","alert",1,"alert","alert-danger"]],template:function(i,o){i&1&&(T(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),Y(7,"img",7),T(8,"button",8),G(9," Upload image "),P()(),T(10,"div",9)(11,"h5"),G(12),P(),T(13,"p"),G(14),P()()(),T(15,"div",10)(16,"div",11)(17,"div")(18,"p",12),G(19,"N/A"),P(),T(20,"p",13),G(21,"Projects"),P()(),T(22,"div",14)(23,"p",12),G(24,"N/A"),P(),T(25,"p",13),G(26,"Tasks"),P()()()(),T(27,"div",15)(28,"div",16)(29,"p",17),G(30,"Personal Information"),P(),T(31,"div",18)(32,"p",19),G(33),P(),T(34,"p",19),G(35),P(),T(36,"p",20),G(37),P(),T(38,"p",19),G(39),P(),T(40,"p",19),G(41),P(),T(42,"p",19),G(43),P(),T(44,"p",19),G(45),P(),T(46,"div",21)(47,"div",22)(48,"div",23)(49,"div",24)(50,"button",25)(51,"span",26),G(52,"\xD7"),P()()(),T(53,"div",27)(54,"div",28)(55,"div",29)(56,"div",30)(57,"div",31)(58,"label",32)(59,"div",33),Y(60,"img",34),P(),T(61,"input",35,36),kt("change",function(s){return o.onFileSelected(s)}),P()(),$t(63,tI,3,0,"div",37)(64,eI,5,0,"div",38),P(),$t(65,nI,2,0,"div",39),P()()()(),T(66,"div",40)(67,"button",41),G(68,"Close"),P(),T(69,"button",42),kt("click",function(){return o.updateProfileImage()}),G(70,"Update image"),P()()()()()()()()()()()()()),i&2&&(Q(7),ct("src",o.user.image!==""?o.user.image:"../assets/images/profile.jpg",fl),Q(5),Rp("",o.user.firstname," ",o.user.lastname,""),Q(2),Ye(o.user.job),Q(19),de("Firstname: ",o.user.firstname,""),Q(2),de("Lastname: ",o.user.lastname,""),Q(2),de("Email: ",o.user.email,""),Q(2),de("Phone: ",o.user.number,""),Q(2),de("Address: ",o.user.address,""),Q(2),de("Age: ",o.user.number,""),Q(2),de("Degree: ",o.user.degree,""),Q(15),ct("src",o.uploadedImageUrl||"https://cdn.pixabay.com/photo/2017/02/07/02/16/cloud-2044823_960_720.png",fl),Q(3),ct("ngIf",o.displayStatusImage),Q(),ct("ngIf",o.verifiedImageHumain),Q(),ct("ngIf",o.NotVerifedHumain),Q(4),ct("disabled",!o.verifiedImageHumain))},dependencies:[Ne],styles:[".gradient-custom-2[_ngcontent-%COMP%]{background:#fbc2eb;background:-webkit-linear-gradient(to right,rgba(251,194,235,1),rgba(166,193,238,1));background:linear-gradient(to right,#fbc2eb,#a6c1ee)}"]});let r=e;return r})();function rI(r,e){if(r&1&&(T(0,"div",15),G(1),P()),r&2){let t=Tt();Q(),Ye(t.errorMessage)}}var vb=(()=>{let e=class e{constructor(n,i,o,a){this.authService=n,this.encryptionService=i,this.router=o,this.userService=a,this.authResponse={},this.status="",this.formRequest=new ro({code:new pi("",[fi.required])})}ngOnInit(){return je(this,null,function*(){let n=yield localStorage.getItem("code");if(n){let i=JSON.parse(n);this.method=i.method,this.email=i.email}yield this.sendCode()})}timer(){let i=lp(0,1e3).pipe(fn(o=>120-o),vp(o=>o>=0));this.countdown=i.pipe(fn(o=>{let a=Math.floor(o/60),s=o%60;return`${this.pad(a)}:${this.pad(s)}`}))}pad(n){return n<10?`0${n}`:`${n}`}sendVerificationCode(n){this.method=="sms"&&this.authService.sendVerificationCode(n).subscribe(i=>{},i=>{}),this.method=="mail"&&this.authService.sendVerificationCodeMail(n).subscribe(i=>{},i=>{})}sendCode(){return je(this,null,function*(){this.timer(),this.sendVerificationCode(this.email)})}resend(){this.sendCode()}verify(){this.formRequest.valid&&this.authService.verifyCode(this.formRequest.value.code.toString(),this.email).subscribe({next:n=>{this.authResponse=n,localStorage.setItem("token",n.access_token),this.userService.getUser(this.email).subscribe({next:i=>{let o={firstname:i.firstname,lastname:i.lastname,email:i.email},a=this.encryptionService.encrypt(JSON.stringify(i.authorities),"2f7");localStorage.setItem("authorities",a),localStorage.setItem("user",JSON.stringify(o)),this.router.navigate(["/home"])},error:i=>{}})},error:n=>{this.errorMessage="Invalid code"}})}isValidCode(){let n=this.formRequest.value.code;return n&&n.toString().length===6}};e.\u0275fac=function(i){return new(i||e)(vt(po),vt(zr),vt($e),vt(Vr))},e.\u0275cmp=Wt({type:e,selectors:[["app-sendcode"]],decls:26,vars:7,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-settings","auth-icon"],[3,"formGroup","ngSubmit"],[3,"click"],[1,"input-group","mb-3"],["type","number","placeholder","code","formControlName","code","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2",3,"disabled"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"]],template:function(i,o){i&1&&(T(0,"div",0)(1,"div",1)(2,"div",2),Y(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),P(),T(7,"div",5)(8,"div",6)(9,"div",7),Y(10,"i",8),P(),T(11,"form",9),kt("ngSubmit",function(){return o.verify()}),T(12,"h3",7),G(13,"We sent you a verification code"),P(),T(14,"h5",7),G(15),T(16,"a",10),kt("click",function(){return o.resend()}),G(17,"Resend?"),P()(),T(18,"p"),G(19),Tp(20,"async"),P(),T(21,"div",11),Y(22,"input",12),P(),T(23,"button",13),G(24,"Verify"),P(),$t(25,rI,2,1,"div",14),P()()()()()),i&2&&(Q(11),ct("formGroup",o.formRequest),Q(4),de("Please verifiy your ",o.method,"."),Q(4),de("Time left: ",Pp(20,5,o.countdown),""),Q(4),ct("disabled",!o.isValidCode()),Q(2),ct("ngIf",o.errorMessage))},dependencies:[Ne,jn,gn,qp,Je,Un,Hr,Ur,jr,Np]});let r=e;return r})();function ds(r){return r+.5|0}var ri=(r,e,t)=>Math.max(Math.min(r,t),e);function ls(r){return ri(ds(r*2.55),0,255)}function ii(r){return ri(ds(r*255),0,255)}function Mr(r){return ri(ds(r/2.55)/100,0,1)}function xb(r){return ri(ds(r*100),0,100)}var _n={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},kd=[..."0123456789ABCDEF"],iI=r=>kd[r&15],oI=r=>kd[(r&240)>>4]+kd[r&15],fc=r=>(r&240)>>4===(r&15),aI=r=>fc(r.r)&&fc(r.g)&&fc(r.b)&&fc(r.a);function sI(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&_n[r[1]]*17,g:255&_n[r[2]]*17,b:255&_n[r[3]]*17,a:e===5?_n[r[4]]*17:255}:(e===7||e===9)&&(t={r:_n[r[1]]<<4|_n[r[2]],g:_n[r[3]]<<4|_n[r[4]],b:_n[r[5]]<<4|_n[r[6]],a:e===9?_n[r[7]]<<4|_n[r[8]]:255})),t}var uI=(r,e)=>r<255?e(r):"";function cI(r){var e=aI(r)?iI:oI;return r?"#"+e(r.r)+e(r.g)+e(r.b)+uI(r.a,e):void 0}var lI=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function _b(r,e,t){let n=e*Math.min(t,1-t),i=(o,a=(o+r/30)%12)=>t-n*Math.max(Math.min(a-3,9-a,1),-1);return[i(0),i(8),i(4)]}function hI(r,e,t){let n=(i,o=(i+r/60)%6)=>t-t*e*Math.max(Math.min(o,4-o,1),0);return[n(5),n(3),n(1)]}function dI(r,e,t){let n=_b(r,1,.5),i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)n[i]*=1-e-t,n[i]+=e;return n}function fI(r,e,t,n,i){return r===i?(e-t)/n+(e<t?6:0):e===i?(t-r)/n+2:(r-e)/n+4}function Id(r){let t=r.r/255,n=r.g/255,i=r.b/255,o=Math.max(t,n,i),a=Math.min(t,n,i),s=(o+a)/2,u,c,l;return o!==a&&(l=o-a,c=s>.5?l/(2-o-a):l/(o+a),u=fI(t,n,i,l,o),u=u*60+.5),[u|0,c||0,s]}function Md(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(ii)}function Rd(r,e,t){return Md(_b,r,e,t)}function pI(r,e,t){return Md(dI,r,e,t)}function mI(r,e,t){return Md(hI,r,e,t)}function Cb(r){return(r%360+360)%360}function gI(r){let e=lI.exec(r),t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?ls(+e[5]):ii(+e[5]));let i=Cb(+e[2]),o=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?n=pI(i,o,a):e[1]==="hsv"?n=mI(i,o,a):n=Rd(i,o,a),{r:n[0],g:n[1],b:n[2],a:t}}function vI(r,e){var t=Id(r);t[0]=Cb(t[0]+e),t=Rd(t),r.r=t[0],r.g=t[1],r.b=t[2]}function xI(r){if(!r)return;let e=Id(r),t=e[0],n=xb(e[1]),i=xb(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${i}%, ${Mr(r.a)})`:`hsl(${t}, ${n}%, ${i}%)`}var bb={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},yb={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function bI(){let r={},e=Object.keys(yb),t=Object.keys(bb),n,i,o,a,s;for(n=0;n<e.length;n++){for(a=s=e[n],i=0;i<t.length;i++)o=t[i],s=s.replace(o,bb[o]);o=parseInt(yb[a],16),r[s]=[o>>16&255,o>>8&255,o&255]}return r}var pc;function yI(r){pc||(pc=bI(),pc.transparent=[0,0,0,0]);let e=pc[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}var wI=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function _I(r){let e=wI.exec(r),t=255,n,i,o;if(e){if(e[7]!==n){let a=+e[7];t=e[8]?ls(a):ri(a*255,0,255)}return n=+e[1],i=+e[3],o=+e[5],n=255&(e[2]?ls(n):ri(n,0,255)),i=255&(e[4]?ls(i):ri(i,0,255)),o=255&(e[6]?ls(o):ri(o,0,255)),{r:n,g:i,b:o,a:t}}}function CI(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${Mr(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}var Ed=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,ta=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function SI(r,e,t){let n=ta(Mr(r.r)),i=ta(Mr(r.g)),o=ta(Mr(r.b));return{r:ii(Ed(n+t*(ta(Mr(e.r))-n))),g:ii(Ed(i+t*(ta(Mr(e.g))-i))),b:ii(Ed(o+t*(ta(Mr(e.b))-o))),a:r.a+t*(e.a-r.a)}}function mc(r,e,t){if(r){let n=Id(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=Rd(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function Sb(r,e){return r&&Object.assign(e||{},r)}function wb(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=ii(r[3]))):(e=Sb(r,{r:0,g:0,b:0,a:1}),e.a=ii(e.a)),e}function EI(r){return r.charAt(0)==="r"?_I(r):gI(r)}var hs=class r{constructor(e){if(e instanceof r)return e;let t=typeof e,n;t==="object"?n=wb(e):t==="string"&&(n=sI(e)||yI(e)||EI(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=Sb(this._rgb);return e&&(e.a=Mr(e.a)),e}set rgb(e){this._rgb=wb(e)}rgbString(){return this._valid?CI(this._rgb):void 0}hexString(){return this._valid?cI(this._rgb):void 0}hslString(){return this._valid?xI(this._rgb):void 0}mix(e,t){if(e){let n=this.rgb,i=e.rgb,o,a=t===o?.5:t,s=2*a-1,u=n.a-i.a,c=((s*u===-1?s:(s+u)/(1+s*u))+1)/2;o=1-c,n.r=255&c*n.r+o*i.r+.5,n.g=255&c*n.g+o*i.g+.5,n.b=255&c*n.b+o*i.b+.5,n.a=a*n.a+(1-a)*i.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=SI(this._rgb,e._rgb,t)),this}clone(){return new r(this.rgb)}alpha(e){return this._rgb.a=ii(e),this}clearer(e){let t=this._rgb;return t.a*=1-e,this}greyscale(){let e=this._rgb,t=ds(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){let t=this._rgb;return t.a*=1+e,this}negate(){let e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return mc(this._rgb,2,e),this}darken(e){return mc(this._rgb,2,-e),this}saturate(e){return mc(this._rgb,1,e),this}desaturate(e){return mc(this._rgb,1,-e),this}rotate(e){return vI(this._rgb,e),this}};function tr(){}var Ob=(()=>{let r=0;return()=>r++})();function Mt(r){return r===null||typeof r>"u"}function Xt(r){if(Array.isArray&&Array.isArray(r))return!0;let e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function wt(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function ie(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function rn(r,e){return ie(r)?r:e}function gt(r,e){return typeof r>"u"?e:r}var Nb=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,Pd=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function Ht(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function Ot(r,e,t,n){let i,o,a;if(Xt(r))if(o=r.length,n)for(i=o-1;i>=0;i--)e.call(t,r[i],i);else for(i=0;i<o;i++)e.call(t,r[i],i);else if(wt(r))for(a=Object.keys(r),o=a.length,i=0;i<o;i++)e.call(t,r[a[i]],a[i])}function ms(r,e){let t,n,i,o;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(i=r[t],o=e[t],i.datasetIndex!==o.datasetIndex||i.index!==o.index)return!1;return!0}function bc(r){if(Xt(r))return r.map(bc);if(wt(r)){let e=Object.create(null),t=Object.keys(r),n=t.length,i=0;for(;i<n;++i)e[t[i]]=bc(r[t[i]]);return e}return r}function Lb(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function kI(r,e,t,n){if(!Lb(r))return;let i=e[r],o=t[r];wt(i)&&wt(o)?na(i,o,n):e[r]=bc(o)}function na(r,e,t){let n=Xt(e)?e:[e],i=n.length;if(!wt(r))return r;t=t||{};let o=t.merger||kI,a;for(let s=0;s<i;++s){if(a=n[s],!wt(a))continue;let u=Object.keys(a);for(let c=0,l=u.length;c<l;++c)o(u[c],r,a,t)}return r}function ia(r,e){return na(r,e,{merger:II})}function II(r,e,t){if(!Lb(r))return;let n=e[r],i=t[r];wt(n)&&wt(i)?ia(n,i):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=bc(i))}var Eb={"":r=>r,x:r=>r.x,y:r=>r.y};function MI(r){let e=r.split("."),t=[],n="";for(let i of e)n+=i,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function RI(r){let e=MI(r);return t=>{for(let n of e){if(n==="")break;t=t&&t[n]}return t}}function Dr(r,e){return(Eb[e]||(Eb[e]=RI(e)))(r)}function Cc(r){return r.charAt(0).toUpperCase()+r.slice(1)}var oa=r=>typeof r<"u",Rr=r=>typeof r=="function",Fd=(r,e)=>{if(r.size!==e.size)return!1;for(let t of r)if(!e.has(t))return!1;return!0};function Bb(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}var Kt=Math.PI,Yt=2*Kt,AI=Yt+Kt,yc=Number.POSITIVE_INFINITY,DI=Kt/180,ce=Kt/2,zi=Kt/4,kb=Kt*2/3,Ar=Math.log10,Pn=Math.sign;function aa(r,e,t){return Math.abs(r-e)<t}function Od(r){let e=Math.round(r);r=aa(r,e,r/1e3)?e:r;let t=Math.pow(10,Math.floor(Ar(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function Wb(r){let e=[],t=Math.sqrt(r),n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((i,o)=>i-o).pop(),e}function ji(r){return!isNaN(parseFloat(r))&&isFinite(r)}function zb(r,e){let t=Math.round(r);return t-e<=r&&t+e>=r}function Nd(r,e,t){let n,i,o;for(n=0,i=r.length;n<i;n++)o=r[n][t],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function Cn(r){return r*(Kt/180)}function Sc(r){return r*(180/Kt)}function Ld(r){if(!ie(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function Bd(r,e){let t=e.x-r.x,n=e.y-r.y,i=Math.sqrt(t*t+n*n),o=Math.atan2(n,t);return o<-.5*Kt&&(o+=Yt),{angle:o,distance:i}}function wc(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function TI(r,e){return(r-e+AI)%Yt-Kt}function nn(r){return(r%Yt+Yt)%Yt}function sa(r,e,t,n){let i=nn(r),o=nn(e),a=nn(t),s=nn(o-i),u=nn(a-i),c=nn(i-o),l=nn(i-a);return i===o||i===a||n&&o===a||s>u&&c<l}function we(r,e,t){return Math.max(e,Math.min(t,r))}function Vb(r){return we(r,-32768,32767)}function er(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function Ec(r,e,t){t=t||(a=>r[a]<e);let n=r.length-1,i=0,o;for(;n-i>1;)o=i+n>>1,t(o)?i=o:n=o;return{lo:i,hi:n}}var Qn=(r,e,t,n)=>Ec(r,t,n?i=>{let o=r[i][e];return o<t||o===t&&r[i+1][e]===t}:i=>r[i][e]<t),Ub=(r,e,t)=>Ec(r,t,n=>r[n][e]>=t);function jb(r,e,t){let n=0,i=r.length;for(;n<i&&r[n]<e;)n++;for(;i>n&&r[i-1]>t;)i--;return n>0||i<r.length?r.slice(n,i):r}var Hb=["push","pop","shift","splice","unshift"];function Gb(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Hb.forEach(t=>{let n="_onData"+Cc(t),i=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...o){let a=i.apply(this,o);return r._chartjs.listeners.forEach(s=>{typeof s[n]=="function"&&s[n](...o)}),a}})})}function Wd(r,e){let t=r._chartjs;if(!t)return;let n=t.listeners,i=n.indexOf(e);i!==-1&&n.splice(i,1),!(n.length>0)&&(Hb.forEach(o=>{delete r[o]}),delete r._chartjs)}function zd(r){let e=new Set(r);return e.size===r.length?r:Array.from(e)}var Vd=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function Ud(r,e){let t=[],n=!1;return function(...i){t=i,n||(n=!0,Vd.call(window,()=>{n=!1,r.apply(e,t)}))}}function qb(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}var kc=r=>r==="start"?"left":r==="end"?"right":"center",Fe=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,Xb=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function jd(r,e,t){let n=e.length,i=0,o=n;if(r._sorted){let{iScale:a,_parsed:s}=r,u=a.axis,{min:c,max:l,minDefined:h,maxDefined:d}=a.getUserBounds();h&&(i=we(Math.min(Qn(s,u,c).lo,t?n:Qn(e,u,a.getPixelForValue(c)).lo),0,n-1)),d?o=we(Math.max(Qn(s,a.axis,l,!0).hi+1,t?0:Qn(e,u,a.getPixelForValue(l),!0).hi+1),i,n)-i:o=n-i}return{start:i,count:o}}function Hd(r){let{xScale:e,yScale:t,_scaleRanges:n}=r,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=i,!0;let o=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,i),o}var gc=r=>r===0||r===1,Ib=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*Yt/t)),Mb=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*Yt/t)+1,ea={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*ce)+1,easeOutSine:r=>Math.sin(r*ce),easeInOutSine:r=>-.5*(Math.cos(Kt*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>gc(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>gc(r)?r:Ib(r,.075,.3),easeOutElastic:r=>gc(r)?r:Mb(r,.075,.3),easeInOutElastic(r){return gc(r)?r:r<.5?.5*Ib(r*2,.1125,.45):.5+.5*Mb(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-ea.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?ea.easeInBounce(r*2)*.5:ea.easeOutBounce(r*2-1)*.5+.5};function Gd(r){if(r&&typeof r=="object"){let e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function qd(r){return Gd(r)?r:new hs(r)}function Ad(r){return Gd(r)?r:new hs(r).saturate(.5).darken(.1).hexString()}var PI=["x","y","borderWidth","radius","tension"],FI=["color","borderColor","backgroundColor"];function OI(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:FI},numbers:{type:"number",properties:PI}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function NI(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var Rb=new Map;function LI(r,e){e=e||{};let t=r+JSON.stringify(e),n=Rb.get(t);return n||(n=new Intl.NumberFormat(r,e),Rb.set(t,n)),n}function ua(r,e,t){return LI(e,t).format(r)}var Kb={values(r){return Xt(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";let n=this.chart.options.locale,i,o=r;if(t.length>1){let c=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),o=BI(r,t)}let a=Ar(Math.abs(o)),s=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),u={notation:i,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(u,this.options.ticks.format),ua(r,n,u)},logarithmic(r,e,t){if(r===0)return"0";let n=t[e].significand||r/Math.pow(10,Math.floor(Ar(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?Kb.numeric.call(this,r,e,t):""}};function BI(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var gs={formatters:Kb};function WI(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:gs.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}var ai=Object.create(null),Ic=Object.create(null);function fs(r,e){if(!e)return r;let t=e.split(".");for(let n=0,i=t.length;n<i;++n){let o=t[n];r=r[o]||(r[o]=Object.create(null))}return r}function Dd(r,e,t){return typeof e=="string"?na(fs(r,e),t):na(fs(r,""),e)}var Td=class{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,i)=>Ad(i.backgroundColor),this.hoverBorderColor=(n,i)=>Ad(i.borderColor),this.hoverColor=(n,i)=>Ad(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return Dd(this,e,t)}get(e){return fs(this,e)}describe(e,t){return Dd(Ic,e,t)}override(e,t){return Dd(ai,e,t)}route(e,t,n,i){let o=fs(this,e),a=fs(this,n),s="_"+t;Object.defineProperties(o,{[s]:{value:o[t],writable:!0},[t]:{enumerable:!0,get(){let u=this[s],c=a[i];return wt(u)?Object.assign({},c,u):gt(u,c)},set(u){this[s]=u}}})}apply(e){e.forEach(t=>t(this))}},oe=new Td({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[OI,NI,WI]);function zI(r){return!r||Mt(r.size)||Mt(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function ps(r,e,t,n,i){let o=e[i];return o||(o=e[i]=r.measureText(i).width,t.push(i)),o>n&&(n=o),n}function Yb(r,e,t,n){n=n||{};let i=n.data=n.data||{},o=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(i=n.data={},o=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let a=0,s=t.length,u,c,l,h,d;for(u=0;u<s;u++)if(h=t[u],h!=null&&!Xt(h))a=ps(r,i,o,a,h);else if(Xt(h))for(c=0,l=h.length;c<l;c++)d=h[c],d!=null&&!Xt(d)&&(a=ps(r,i,o,a,d));r.restore();let f=o.length/2;if(f>t.length){for(u=0;u<f;u++)delete i[o[u]];o.splice(0,f)}return a}function si(r,e,t){let n=r.currentDevicePixelRatio,i=t!==0?Math.max(t/2,.5):0;return Math.round((e-i)*n)/n+i}function Xd(r,e){e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore()}function Mc(r,e,t,n){Kd(r,e,t,n,null)}function Kd(r,e,t,n,i){let o,a,s,u,c,l,h,d,f=e.pointStyle,p=e.rotation,m=e.radius,g=(p||0)*DI;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(g),r.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),r.restore();return}if(!(isNaN(m)||m<=0)){switch(r.beginPath(),f){default:i?r.ellipse(t,n,i/2,m,0,0,Yt):r.arc(t,n,m,0,Yt),r.closePath();break;case"triangle":l=i?i/2:m,r.moveTo(t+Math.sin(g)*l,n-Math.cos(g)*m),g+=kb,r.lineTo(t+Math.sin(g)*l,n-Math.cos(g)*m),g+=kb,r.lineTo(t+Math.sin(g)*l,n-Math.cos(g)*m),r.closePath();break;case"rectRounded":c=m*.516,u=m-c,a=Math.cos(g+zi)*u,h=Math.cos(g+zi)*(i?i/2-c:u),s=Math.sin(g+zi)*u,d=Math.sin(g+zi)*(i?i/2-c:u),r.arc(t-h,n-s,c,g-Kt,g-ce),r.arc(t+d,n-a,c,g-ce,g),r.arc(t+h,n+s,c,g,g+ce),r.arc(t-d,n+a,c,g+ce,g+Kt),r.closePath();break;case"rect":if(!p){u=Math.SQRT1_2*m,l=i?i/2:u,r.rect(t-l,n-u,2*l,2*u);break}g+=zi;case"rectRot":h=Math.cos(g)*(i?i/2:m),a=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(i?i/2:m),r.moveTo(t-h,n-s),r.lineTo(t+d,n-a),r.lineTo(t+h,n+s),r.lineTo(t-d,n+a),r.closePath();break;case"crossRot":g+=zi;case"cross":h=Math.cos(g)*(i?i/2:m),a=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(i?i/2:m),r.moveTo(t-h,n-s),r.lineTo(t+h,n+s),r.moveTo(t+d,n-a),r.lineTo(t-d,n+a);break;case"star":h=Math.cos(g)*(i?i/2:m),a=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(i?i/2:m),r.moveTo(t-h,n-s),r.lineTo(t+h,n+s),r.moveTo(t+d,n-a),r.lineTo(t-d,n+a),g+=zi,h=Math.cos(g)*(i?i/2:m),a=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(i?i/2:m),r.moveTo(t-h,n-s),r.lineTo(t+h,n+s),r.moveTo(t+d,n-a),r.lineTo(t-d,n+a);break;case"line":a=i?i/2:Math.cos(g)*m,s=Math.sin(g)*m,r.moveTo(t-a,n-s),r.lineTo(t+a,n+s);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(g)*(i?i/2:m),n+Math.sin(g)*m);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function Zn(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function vs(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function xs(r){r.restore()}function $b(r,e,t,n,i){if(!e)return r.lineTo(t.x,t.y);if(i==="middle"){let o=(e.x+t.x)/2;r.lineTo(o,e.y),r.lineTo(o,t.y)}else i==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function Jb(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function VI(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),Mt(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function UI(r,e,t,n,i){if(i.strikethrough||i.underline){let o=r.measureText(n),a=e-o.actualBoundingBoxLeft,s=e+o.actualBoundingBoxRight,u=t-o.actualBoundingBoxAscent,c=t+o.actualBoundingBoxDescent,l=i.strikethrough?(u+c)/2:c;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=i.decorationWidth||2,r.moveTo(a,l),r.lineTo(s,l),r.stroke()}}function jI(r,e){let t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function ui(r,e,t,n,i,o={}){let a=Xt(e)?e:[e],s=o.strokeWidth>0&&o.strokeColor!=="",u,c;for(r.save(),r.font=i.string,VI(r,o),u=0;u<a.length;++u)c=a[u],o.backdrop&&jI(r,o.backdrop),s&&(o.strokeColor&&(r.strokeStyle=o.strokeColor),Mt(o.strokeWidth)||(r.lineWidth=o.strokeWidth),r.strokeText(c,t,n,o.maxWidth)),r.fillText(c,t,n,o.maxWidth),UI(r,t,n,c,o),n+=Number(i.lineHeight);r.restore()}function ca(r,e){let{x:t,y:n,w:i,h:o,radius:a}=e;r.arc(t+a.topLeft,n+a.topLeft,a.topLeft,1.5*Kt,Kt,!0),r.lineTo(t,n+o-a.bottomLeft),r.arc(t+a.bottomLeft,n+o-a.bottomLeft,a.bottomLeft,Kt,ce,!0),r.lineTo(t+i-a.bottomRight,n+o),r.arc(t+i-a.bottomRight,n+o-a.bottomRight,a.bottomRight,ce,0,!0),r.lineTo(t+i,n+a.topRight),r.arc(t+i-a.topRight,n+a.topRight,a.topRight,0,-ce,!0),r.lineTo(t+a.topLeft,n)}var HI=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,GI=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function qI(r,e){let t=(""+r).match(HI);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}var XI=r=>+r||0;function Rc(r,e){let t={},n=wt(e),i=n?Object.keys(e):e,o=wt(r)?n?a=>gt(r[a],r[e[a]]):a=>r[a]:()=>r;for(let a of i)t[a]=XI(o(a));return t}function Yd(r){return Rc(r,{top:"y",right:"x",bottom:"y",left:"x"})}function ci(r){return Rc(r,["topLeft","topRight","bottomLeft","bottomRight"])}function Oe(r){let e=Yd(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function ve(r,e){r=r||{},e=e||oe.font;let t=gt(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=gt(r.style,e.style);n&&!(""+n).match(GI)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);let i={family:gt(r.family,e.family),lineHeight:qI(gt(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:gt(r.weight,e.weight),string:""};return i.string=zI(i),i}function la(r,e,t,n){let i=!0,o,a,s;for(o=0,a=r.length;o<a;++o)if(s=r[o],s!==void 0&&(e!==void 0&&typeof s=="function"&&(s=s(e),i=!1),t!==void 0&&Xt(s)&&(s=s[t%s.length],i=!1),s!==void 0))return n&&!i&&(n.cacheable=!1),s}function Qb(r,e,t){let{min:n,max:i}=r,o=Pd(e,(i-n)/2),a=(s,u)=>t&&s===0?0:s+u;return{min:a(n,-Math.abs(o)),max:a(i,o)}}function Tr(r,e){return Object.assign(Object.create(r),e)}function Ac(r,e=[""],t,n,i=()=>r[0]){let o=t||r;typeof n>"u"&&(n=ey("_fallback",r));let a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:o,_fallback:n,_getTarget:i,override:s=>Ac([s,...r],e,o,n)};return new Proxy(a,{deleteProperty(s,u){return delete s[u],delete s._keys,delete r[0][u],!0},get(s,u){return Zb(s,u,()=>eM(u,e,r,s))},getOwnPropertyDescriptor(s,u){return Reflect.getOwnPropertyDescriptor(s._scopes[0],u)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(s,u){return Db(s).includes(u)},ownKeys(s){return Db(s)},set(s,u,c){let l=s._storage||(s._storage=i());return s[u]=l[u]=c,delete s._keys,!0}})}function Ui(r,e,t,n){let i={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:$d(r,n),setContext:o=>Ui(r,o,t,n),override:o=>Ui(r.override(o),e,t,n)};return new Proxy(i,{deleteProperty(o,a){return delete o[a],delete r[a],!0},get(o,a,s){return Zb(o,a,()=>YI(o,a,s))},getOwnPropertyDescriptor(o,a){return o._descriptors.allKeys?Reflect.has(r,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,a)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(o,a){return Reflect.has(r,a)},ownKeys(){return Reflect.ownKeys(r)},set(o,a,s){return r[a]=s,delete o[a],!0}})}function $d(r,e={scriptable:!0,indexable:!0}){let{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:i=e.allKeys}=r;return{allKeys:i,scriptable:t,indexable:n,isScriptable:Rr(t)?t:()=>t,isIndexable:Rr(n)?n:()=>n}}var KI=(r,e)=>r?r+Cc(e):e,Jd=(r,e)=>wt(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function Zb(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];let n=t();return r[e]=n,n}function YI(r,e,t){let{_proxy:n,_context:i,_subProxy:o,_descriptors:a}=r,s=n[e];return Rr(s)&&a.isScriptable(e)&&(s=$I(e,s,r,t)),Xt(s)&&s.length&&(s=JI(e,s,r,a.isIndexable)),Jd(e,s)&&(s=Ui(s,i,o&&o[e],a)),s}function $I(r,e,t,n){let{_proxy:i,_context:o,_subProxy:a,_stack:s}=t;if(s.has(r))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+r);s.add(r);let u=e(o,a||n);return s.delete(r),Jd(r,u)&&(u=Qd(i._scopes,i,r,u)),u}function JI(r,e,t,n){let{_proxy:i,_context:o,_subProxy:a,_descriptors:s}=t;if(typeof o.index<"u"&&n(r))return e[o.index%e.length];if(wt(e[0])){let u=e,c=i._scopes.filter(l=>l!==u);e=[];for(let l of u){let h=Qd(c,i,r,l);e.push(Ui(h,o,a&&a[r],s))}}return e}function ty(r,e,t){return Rr(r)?r(e,t):r}var QI=(r,e)=>r===!0?e:typeof r=="string"?Dr(e,r):void 0;function ZI(r,e,t,n,i){for(let o of e){let a=QI(t,o);if(a){r.add(a);let s=ty(a._fallback,t,i);if(typeof s<"u"&&s!==t&&s!==n)return s}else if(a===!1&&typeof n<"u"&&t!==n)return null}return!1}function Qd(r,e,t,n){let i=e._rootScopes,o=ty(e._fallback,t,n),a=[...r,...i],s=new Set;s.add(n);let u=Ab(s,a,t,o||t,n);return u===null||typeof o<"u"&&o!==t&&(u=Ab(s,a,o,u,n),u===null)?!1:Ac(Array.from(s),[""],i,o,()=>tM(e,t,n))}function Ab(r,e,t,n,i){for(;t;)t=ZI(r,e,t,n,i);return t}function tM(r,e,t){let n=r._getTarget();e in n||(n[e]={});let i=n[e];return Xt(i)&&wt(t)?t:i||{}}function eM(r,e,t,n){let i;for(let o of e)if(i=ey(KI(o,r),t),typeof i<"u")return Jd(r,i)?Qd(t,n,r,i):i}function ey(r,e){for(let t of e){if(!t)continue;let n=t[r];if(typeof n<"u")return n}}function Db(r){let e=r._keys;return e||(e=r._keys=nM(r._scopes)),e}function nM(r){let e=new Set;for(let t of r)for(let n of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(n);return Array.from(e)}function Zd(r,e,t,n){let{iScale:i}=r,{key:o="r"}=this._parsing,a=new Array(n),s,u,c,l;for(s=0,u=n;s<u;++s)c=s+t,l=e[c],a[s]={r:i.parse(Dr(l,o),c)};return a}var rM=Number.EPSILON||1e-14,ra=(r,e)=>e<r.length&&!r[e].skip&&r[e],ny=r=>r==="x"?"y":"x";function iM(r,e,t,n){let i=r.skip?e:r,o=e,a=t.skip?e:t,s=wc(o,i),u=wc(a,o),c=s/(s+u),l=u/(s+u);c=isNaN(c)?0:c,l=isNaN(l)?0:l;let h=n*c,d=n*l;return{previous:{x:o.x-h*(a.x-i.x),y:o.y-h*(a.y-i.y)},next:{x:o.x+d*(a.x-i.x),y:o.y+d*(a.y-i.y)}}}function oM(r,e,t){let n=r.length,i,o,a,s,u,c=ra(r,0);for(let l=0;l<n-1;++l)if(u=c,c=ra(r,l+1),!(!u||!c)){if(aa(e[l],0,rM)){t[l]=t[l+1]=0;continue}i=t[l]/e[l],o=t[l+1]/e[l],s=Math.pow(i,2)+Math.pow(o,2),!(s<=9)&&(a=3/Math.sqrt(s),t[l]=i*a*e[l],t[l+1]=o*a*e[l])}}function aM(r,e,t="x"){let n=ny(t),i=r.length,o,a,s,u=ra(r,0);for(let c=0;c<i;++c){if(a=s,s=u,u=ra(r,c+1),!s)continue;let l=s[t],h=s[n];a&&(o=(l-a[t])/3,s[`cp1${t}`]=l-o,s[`cp1${n}`]=h-o*e[c]),u&&(o=(u[t]-l)/3,s[`cp2${t}`]=l+o,s[`cp2${n}`]=h+o*e[c])}}function sM(r,e="x"){let t=ny(e),n=r.length,i=Array(n).fill(0),o=Array(n),a,s,u,c=ra(r,0);for(a=0;a<n;++a)if(s=u,u=c,c=ra(r,a+1),!!u){if(c){let l=c[e]-u[e];i[a]=l!==0?(c[t]-u[t])/l:0}o[a]=s?c?Pn(i[a-1])!==Pn(i[a])?0:(i[a-1]+i[a])/2:i[a-1]:i[a]}oM(r,i,o),aM(r,o,e)}function vc(r,e,t){return Math.max(Math.min(r,t),e)}function uM(r,e){let t,n,i,o,a,s=Zn(r[0],e);for(t=0,n=r.length;t<n;++t)a=o,o=s,s=t<n-1&&Zn(r[t+1],e),o&&(i=r[t],a&&(i.cp1x=vc(i.cp1x,e.left,e.right),i.cp1y=vc(i.cp1y,e.top,e.bottom)),s&&(i.cp2x=vc(i.cp2x,e.left,e.right),i.cp2y=vc(i.cp2y,e.top,e.bottom)))}function ry(r,e,t,n,i){let o,a,s,u;if(e.spanGaps&&(r=r.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")sM(r,i);else{let c=n?r[r.length-1]:r[0];for(o=0,a=r.length;o<a;++o)s=r[o],u=iM(c,s,r[Math.min(o+1,a-(n?0:1))%a],e.tension),s.cp1x=u.previous.x,s.cp1y=u.previous.y,s.cp2x=u.next.x,s.cp2y=u.next.y,c=s}e.capBezierPoints&&uM(r,t)}function Dc(){return typeof window<"u"&&typeof document<"u"}function Tc(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function _c(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}var Pc=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function cM(r,e){return Pc(r).getPropertyValue(e)}var lM=["top","right","bottom","left"];function Vi(r,e,t){let n={};t=t?"-"+t:"";for(let i=0;i<4;i++){let o=lM[i];n[o]=parseFloat(r[e+"-"+o+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var hM=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function dM(r,e){let t=r.touches,n=t&&t.length?t[0]:r,{offsetX:i,offsetY:o}=n,a=!1,s,u;if(hM(i,o,r.target))s=i,u=o;else{let c=e.getBoundingClientRect();s=n.clientX-c.left,u=n.clientY-c.top,a=!0}return{x:s,y:u,box:a}}function li(r,e){if("native"in r)return r;let{canvas:t,currentDevicePixelRatio:n}=e,i=Pc(t),o=i.boxSizing==="border-box",a=Vi(i,"padding"),s=Vi(i,"border","width"),{x:u,y:c,box:l}=dM(r,t),h=a.left+(l&&s.left),d=a.top+(l&&s.top),{width:f,height:p}=e;return o&&(f-=a.width+s.width,p-=a.height+s.height),{x:Math.round((u-h)/f*t.width/n),y:Math.round((c-d)/p*t.height/n)}}function fM(r,e,t){let n,i;if(e===void 0||t===void 0){let o=Tc(r);if(!o)e=r.clientWidth,t=r.clientHeight;else{let a=o.getBoundingClientRect(),s=Pc(o),u=Vi(s,"border","width"),c=Vi(s,"padding");e=a.width-c.width-u.width,t=a.height-c.height-u.height,n=_c(s.maxWidth,o,"clientWidth"),i=_c(s.maxHeight,o,"clientHeight")}}return{width:e,height:t,maxWidth:n||yc,maxHeight:i||yc}}var xc=r=>Math.round(r*10)/10;function iy(r,e,t,n){let i=Pc(r),o=Vi(i,"margin"),a=_c(i.maxWidth,r,"clientWidth")||yc,s=_c(i.maxHeight,r,"clientHeight")||yc,u=fM(r,e,t),{width:c,height:l}=u;if(i.boxSizing==="content-box"){let d=Vi(i,"border","width"),f=Vi(i,"padding");c-=f.width+d.width,l-=f.height+d.height}return c=Math.max(0,c-o.width),l=Math.max(0,n?c/n:l-o.height),c=xc(Math.min(c,a,u.maxWidth)),l=xc(Math.min(l,s,u.maxHeight)),c&&!l&&(l=xc(c/2)),(e!==void 0||t!==void 0)&&n&&u.height&&l>u.height&&(l=u.height,c=xc(Math.floor(l*n))),{width:c,height:l}}function tf(r,e,t){let n=e||1,i=Math.floor(r.height*n),o=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);let a=r.canvas;return a.style&&(t||!a.style.height&&!a.style.width)&&(a.style.height=`${r.height}px`,a.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||a.height!==i||a.width!==o?(r.currentDevicePixelRatio=n,a.height=i,a.width=o,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}var oy=function(){let r=!1;try{let e={get passive(){return r=!0,!1}};Dc()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function ef(r,e){let t=cM(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function oi(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function ay(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function sy(r,e,t,n){let i={x:r.cp2x,y:r.cp2y},o={x:e.cp1x,y:e.cp1y},a=oi(r,i,t),s=oi(i,o,t),u=oi(o,e,t),c=oi(a,s,t),l=oi(s,u,t);return oi(c,l,t)}var pM=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},mM=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function Hi(r,e,t){return r?pM(e,t):mM()}function nf(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function rf(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function uy(r){return r==="angle"?{between:sa,compare:TI,normalize:nn}:{between:er,compare:(e,t)=>e-t,normalize:e=>e}}function Tb({start:r,end:e,count:t,loop:n,style:i}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:i}}function gM(r,e,t){let{property:n,start:i,end:o}=t,{between:a,normalize:s}=uy(n),u=e.length,{start:c,end:l,loop:h}=r,d,f;if(h){for(c+=u,l+=u,d=0,f=u;d<f&&a(s(e[c%u][n]),i,o);++d)c--,l--;c%=u,l%=u}return l<c&&(l+=u),{start:c,end:l,loop:h,style:r.style}}function of(r,e,t){if(!t)return[r];let{property:n,start:i,end:o}=t,a=e.length,{compare:s,between:u,normalize:c}=uy(n),{start:l,end:h,loop:d,style:f}=gM(r,e,t),p=[],m=!1,g=null,v,x,w,b=()=>u(i,w,v)&&s(i,w)!==0,y=()=>s(o,v)===0||u(o,w,v),_=()=>m||b(),S=()=>!m||y();for(let C=l,E=l;C<=h;++C)x=e[C%a],!x.skip&&(v=c(x[n]),v!==w&&(m=u(v,i,o),g===null&&_()&&(g=s(v,i)===0?C:E),g!==null&&S()&&(p.push(Tb({start:g,end:C,loop:d,count:a,style:f})),g=null),E=C,w=v));return g!==null&&p.push(Tb({start:g,end:h,loop:d,count:a,style:f})),p}function af(r,e){let t=[],n=r.segments;for(let i=0;i<n.length;i++){let o=of(n[i],r.points,e);o.length&&t.push(...o)}return t}function vM(r,e,t,n){let i=0,o=e-1;if(t&&!n)for(;i<e&&!r[i].skip;)i++;for(;i<e&&r[i].skip;)i++;for(i%=e,t&&(o+=i);o>i&&r[o%e].skip;)o--;return o%=e,{start:i,end:o}}function xM(r,e,t,n){let i=r.length,o=[],a=e,s=r[e],u;for(u=e+1;u<=t;++u){let c=r[u%i];c.skip||c.stop?s.skip||(n=!1,o.push({start:e%i,end:(u-1)%i,loop:n}),e=a=c.stop?u:null):(a=u,s.skip&&(e=u)),s=c}return a!==null&&o.push({start:e%i,end:a%i,loop:n}),o}function cy(r,e){let t=r.points,n=r.options.spanGaps,i=t.length;if(!i)return[];let o=!!r._loop,{start:a,end:s}=vM(t,i,o,n);if(n===!0)return Pb(r,[{start:a,end:s,loop:o}],t,e);let u=s<a?s+i:s,c=!!r._fullLoop&&a===0&&s===i-1;return Pb(r,xM(t,a,u,c),t,e)}function Pb(r,e,t,n){return!n||!n.setContext||!t?e:bM(r,e,t,n)}function bM(r,e,t,n){let i=r._chart.getContext(),o=Fb(r.options),{_datasetIndex:a,options:{spanGaps:s}}=r,u=t.length,c=[],l=o,h=e[0].start,d=h;function f(p,m,g,v){let x=s?-1:1;if(p!==m){for(p+=u;t[p%u].skip;)p-=x;for(;t[m%u].skip;)m+=x;p%u!==m%u&&(c.push({start:p%u,end:m%u,loop:g,style:v}),l=v,h=m%u)}}for(let p of e){h=s?h:p.start;let m=t[h%u],g;for(d=h+1;d<=p.end;d++){let v=t[d%u];g=Fb(n.setContext(Tr(i,{type:"segment",p0:m,p1:v,p0DataIndex:(d-1)%u,p1DataIndex:d%u,datasetIndex:a}))),yM(g,l)&&f(h,d-1,p.loop,l),m=v,l=g}h<d-1&&f(h,d-1,p.loop,l)}return c}function Fb(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function yM(r,e){if(!e)return!1;let t=[],n=function(i,o){return Gd(o)?(t.includes(o)||t.push(o),t.indexOf(o)):o};return JSON.stringify(r,n)!==JSON.stringify(e,n)}var gf=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,i){let o=t.listeners[i],a=t.duration;o.forEach(s=>s({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(n-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=Vd.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;let o=n.items,a=o.length-1,s=!1,u;for(;a>=0;--a)u=o[a],u._active?(u._total>n.duration&&(n.duration=u._total),u.tick(e),s=!0):(o[a]=o[o.length-1],o.pop());s&&(i.draw(),this._notify(i,n,e,"progress")),o.length||(n.running=!1,this._notify(i,n,e,"complete"),n.initial=!1),t+=o.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){let t=this._charts,n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){let t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,i)=>Math.max(n,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;let t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){let t=this._charts.get(e);if(!t||!t.items.length)return;let n=t.items,i=n.length-1;for(;i>=0;--i)n[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}},Pr=new gf,ly="transparent",wM={boolean(r,e,t){return t>.5?e:r},color(r,e,t){let n=qd(r||ly),i=n.valid&&qd(e||ly);return i&&i.valid?i.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}},vf=class{constructor(e,t,n,i){let o=t[n];i=la([e.to,i,o,e.from]);let a=la([e.from,o,i]);this._active=!0,this._fn=e.fn||wM[e.type||typeof a],this._easing=ea[e.easing]||ea.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=a,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);let i=this._target[this._prop],o=n-this._start,a=this._duration-o;this._start=n,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=la([e.to,t,i,e.from]),this._from=la([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){let t=e-this._start,n=this._duration,i=this._prop,o=this._from,a=this._loop,s=this._to,u;if(this._active=o!==s&&(a||t<n),!this._active){this._target[i]=s,this._notify(!0);return}if(t<0){this._target[i]=o;return}u=t/n%2,u=a&&u>1?2-u:u,u=this._easing(Math.min(1,Math.max(0,u))),this._target[i]=this._fn(o,s,u)}wait(){let e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){let t=e?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][t]()}},jc=class{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!wt(e))return;let t=Object.keys(oe.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{let o=e[i];if(!wt(o))return;let a={};for(let s of t)a[s]=o[s];(Xt(o.properties)&&o.properties||[i]).forEach(s=>{(s===i||!n.has(s))&&n.set(s,a)})})}_animateOptions(e,t){let n=t.options,i=CM(e,n);if(!i)return[];let o=this._createAnimations(i,n);return n.$shared&&_M(e.options.$animations,n).then(()=>{e.options=n},()=>{}),o}_createAnimations(e,t){let n=this._properties,i=[],o=e.$animations||(e.$animations={}),a=Object.keys(t),s=Date.now(),u;for(u=a.length-1;u>=0;--u){let c=a[u];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(e,t));continue}let l=t[c],h=o[c],d=n.get(c);if(h)if(d&&h.active()){h.update(d,l,s);continue}else h.cancel();if(!d||!d.duration){e[c]=l;continue}o[c]=h=new vf(d,e,c,l),i.push(h)}return i}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}let n=this._createAnimations(e,t);if(n.length)return Pr.add(this._chart,n),!0}};function _M(r,e){let t=[],n=Object.keys(e);for(let i=0;i<n.length;i++){let o=r[n[i]];o&&o.active()&&t.push(o.wait())}return Promise.all(t)}function CM(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function hy(r,e){let t=r&&r.options||{},n=t.reverse,i=t.min===void 0?e:0,o=t.max===void 0?e:0;return{start:n?o:i,end:n?i:o}}function SM(r,e,t){if(t===!1)return!1;let n=hy(r,t),i=hy(e,t);return{top:i.end,right:n.end,bottom:i.start,left:n.start}}function EM(r){let e,t,n,i;return wt(r)?(e=r.top,t=r.right,n=r.bottom,i=r.left):e=t=n=i=r,{top:e,right:t,bottom:n,left:i,disabled:r===!1}}function h1(r,e){let t=[],n=r._getSortedDatasetMetas(e),i,o;for(i=0,o=n.length;i<o;++i)t.push(n[i].index);return t}function dy(r,e,t,n={}){let i=r.keys,o=n.mode==="single",a,s,u,c;if(e!==null){for(a=0,s=i.length;a<s;++a){if(u=+i[a],u===t){if(n.all)continue;break}c=r.values[u],ie(c)&&(o||e===0||Pn(e)===Pn(c))&&(e+=c)}return e}}function kM(r){let e=Object.keys(r),t=new Array(e.length),n,i,o;for(n=0,i=e.length;n<i;++n)o=e[n],t[n]={x:o,y:r[o]};return t}function fy(r,e){let t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function IM(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function MM(r){let{min:e,max:t,minDefined:n,maxDefined:i}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}function RM(r,e,t){let n=r[e]||(r[e]={});return n[t]||(n[t]={})}function py(r,e,t,n){for(let i of e.getMatchingVisibleMetas(n).reverse()){let o=r[i.index];if(t&&o>0||!t&&o<0)return i.index}return null}function my(r,e){let{chart:t,_cachedMeta:n}=r,i=t._stacks||(t._stacks={}),{iScale:o,vScale:a,index:s}=n,u=o.axis,c=a.axis,l=IM(o,a,n),h=e.length,d;for(let f=0;f<h;++f){let p=e[f],{[u]:m,[c]:g}=p,v=p._stacks||(p._stacks={});d=v[c]=RM(i,l,m),d[s]=g,d._top=py(d,a,!0,n.type),d._bottom=py(d,a,!1,n.type);let x=d._visualValues||(d._visualValues={});x[s]=g}}function sf(r,e){let t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function AM(r,e){return Tr(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function DM(r,e,t){return Tr(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function bs(r,e){let t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(let i of e){let o=i._stacks;if(!o||o[n]===void 0||o[n][t]===void 0)return;delete o[n][t],o[n]._visualValues!==void 0&&o[n]._visualValues[t]!==void 0&&delete o[n]._visualValues[t]}}}var uf=r=>r==="reset"||r==="none",gy=(r,e)=>e?r:Object.assign({},r),TM=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:h1(t,!0),values:null},di=(()=>{class r{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=fy(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&bs(this._cachedMeta),this.index=t}linkScales(){let t=this.chart,n=this._cachedMeta,i=this.getDataset(),o=(d,f,p,m)=>d==="x"?f:d==="r"?m:p,a=n.xAxisID=gt(i.xAxisID,sf(t,"x")),s=n.yAxisID=gt(i.yAxisID,sf(t,"y")),u=n.rAxisID=gt(i.rAxisID,sf(t,"r")),c=n.indexAxis,l=n.iAxisID=o(c,a,s,u),h=n.vAxisID=o(c,s,a,u);n.xScale=this.getScaleForId(a),n.yScale=this.getScaleForId(s),n.rScale=this.getScaleForId(u),n.iScale=this.getScaleForId(l),n.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){let n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){let t=this._cachedMeta;this._data&&Wd(this._data,this),t._stacked&&bs(t)}_dataCheck(){let t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if(wt(n))this._data=kM(n);else if(i!==n){if(i){Wd(i,this);let o=this._cachedMeta;bs(o),o._parsed=[]}n&&Object.isExtensible(n)&&Gb(n,this),this._syncList=[],this._data=n}}addElements(){let t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){let n=this._cachedMeta,i=this.getDataset(),o=!1;this._dataCheck();let a=n._stacked;n._stacked=fy(n.vScale,n),n.stack!==i.stack&&(o=!0,bs(n),n.stack=i.stack),this._resyncElements(t),(o||a!==n._stacked)&&my(this,n._parsed)}configure(){let t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){let{_cachedMeta:i,_data:o}=this,{iScale:a,_stacked:s}=i,u=a.axis,c=t===0&&n===o.length?!0:i._sorted,l=t>0&&i._parsed[t-1],h,d,f;if(this._parsing===!1)i._parsed=o,i._sorted=!0,f=o;else{Xt(o[t])?f=this.parseArrayData(i,o,t,n):wt(o[t])?f=this.parseObjectData(i,o,t,n):f=this.parsePrimitiveData(i,o,t,n);let p=()=>d[u]===null||l&&d[u]<l[u];for(h=0;h<n;++h)i._parsed[h+t]=d=f[h],c&&(p()&&(c=!1),l=d);i._sorted=c}s&&my(this,f)}parsePrimitiveData(t,n,i,o){let{iScale:a,vScale:s}=t,u=a.axis,c=s.axis,l=a.getLabels(),h=a===s,d=new Array(o),f,p,m;for(f=0,p=o;f<p;++f)m=f+i,d[f]={[u]:h||a.parse(l[m],m),[c]:s.parse(n[m],m)};return d}parseArrayData(t,n,i,o){let{xScale:a,yScale:s}=t,u=new Array(o),c,l,h,d;for(c=0,l=o;c<l;++c)h=c+i,d=n[h],u[c]={x:a.parse(d[0],h),y:s.parse(d[1],h)};return u}parseObjectData(t,n,i,o){let{xScale:a,yScale:s}=t,{xAxisKey:u="x",yAxisKey:c="y"}=this._parsing,l=new Array(o),h,d,f,p;for(h=0,d=o;h<d;++h)f=h+i,p=n[f],l[h]={x:a.parse(Dr(p,u),f),y:s.parse(Dr(p,c),f)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){let o=this.chart,a=this._cachedMeta,s=n[t.axis],u={keys:h1(o,!0),values:n._stacks[t.axis]._visualValues};return dy(u,s,a.index,{mode:i})}updateRangeFromParsed(t,n,i,o){let a=i[n.axis],s=a===null?NaN:a,u=o&&i._stacks[n.axis];o&&u&&(o.values=u,s=dy(o,a,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,n){let i=this._cachedMeta,o=i._parsed,a=i._sorted&&t===i.iScale,s=o.length,u=this._getOtherScale(t),c=TM(n,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:d}=MM(u),f,p;function m(){p=o[f];let g=p[u.axis];return!ie(p[t.axis])||h>g||d<g}for(f=0;f<s&&!(!m()&&(this.updateRangeFromParsed(l,t,p,c),a));++f);if(a){for(f=s-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(l,t,p,c);break}}return l}getAllParsedValues(t){let n=this._cachedMeta._parsed,i=[],o,a,s;for(o=0,a=n.length;o<a;++o)s=n[o][t.axis],ie(s)&&i.push(s);return i}getMaxOverflow(){return!1}getLabelAndValue(t){let n=this._cachedMeta,i=n.iScale,o=n.vScale,a=this.getParsed(t);return{label:i?""+i.getLabelForValue(a[i.axis]):"",value:o?""+o.getLabelForValue(a[o.axis]):""}}_update(t){let n=this._cachedMeta;this.update(t||"default"),n._clip=EM(gt(this.options.clip,SM(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){let t=this._ctx,n=this.chart,i=this._cachedMeta,o=i.data||[],a=n.chartArea,s=[],u=this._drawStart||0,c=this._drawCount||o.length-u,l=this.options.drawActiveElementsOnTop,h;for(i.dataset&&i.dataset.draw(t,a,u,c),h=u;h<u+c;++h){let d=o[h];d.hidden||(d.active&&l?s.push(d):d.draw(t,a))}for(h=0;h<s.length;++h)s[h].draw(t,a)}getStyle(t,n){let i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){let o=this.getDataset(),a;if(t>=0&&t<this._cachedMeta.data.length){let s=this._cachedMeta.data[t];a=s.$context||(s.$context=DM(this.getContext(),t,s)),a.parsed=this.getParsed(t),a.raw=o.data[t],a.index=a.dataIndex=t}else a=this.$context||(this.$context=AM(this.chart.getContext(),this.index)),a.dataset=o,a.index=a.datasetIndex=this.index;return a.active=!!n,a.mode=i,a}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){let o=n==="active",a=this._cachedDataOpts,s=t+"-"+n,u=a[s],c=this.enableOptionSharing&&oa(i);if(u)return gy(u,c);let l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),d=o?[`${t}Hover`,"hover",t,""]:[t,""],f=l.getOptionScopes(this.getDataset(),h),p=Object.keys(oe.elements[t]),m=()=>this.getContext(i,o,n),g=l.resolveNamedOptions(f,p,m,d);return g.$shared&&(g.$shared=c,a[s]=Object.freeze(gy(g,c))),g}_resolveAnimations(t,n,i){let o=this.chart,a=this._cachedDataOpts,s=`animation-${n}`,u=a[s];if(u)return u;let c;if(o.options.animation!==!1){let h=this.chart.config,d=h.datasetAnimationScopeKeys(this._type,n),f=h.getOptionScopes(this.getDataset(),d);c=h.createResolver(f,this.getContext(t,i,n))}let l=new jc(o,c&&c.animations);return c&&c._cacheable&&(a[s]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||uf(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){let i=this.resolveDataElementOptions(t,n),o=this._sharedOptions,a=this.getSharedOptions(i),s=this.includeOptions(n,a)||a!==o;return this.updateSharedOptions(a,n,i),{sharedOptions:a,includeOptions:s}}updateElement(t,n,i,o){uf(o)?Object.assign(t,i):this._resolveAnimations(n,o).update(t,i)}updateSharedOptions(t,n,i){t&&!uf(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,o){t.active=o;let a=this.getStyle(n,o);this._resolveAnimations(n,i,o).update(t,{options:!o&&this.getSharedOptions(a)||a})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){let t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){let t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){let n=this._data,i=this._cachedMeta.data;for(let[u,c,l]of this._syncList)this[u](c,l);this._syncList=[];let o=i.length,a=n.length,s=Math.min(a,o);s&&this.parse(0,s),a>o?this._insertElements(o,a-o,t):a<o&&this._removeElements(a,o-a)}_insertElements(t,n,i=!0){let o=this._cachedMeta,a=o.data,s=t+n,u,c=l=>{for(l.length+=n,u=l.length-1;u>=s;u--)l[u]=l[u-n]};for(c(a),u=t;u<s;++u)a[u]=new this.dataElementType;this._parsing&&c(o._parsed),this.parse(t,n),i&&this.updateElements(a,t,n,"reset")}updateElements(t,n,i,o){}_removeElements(t,n){let i=this._cachedMeta;if(this._parsing){let o=i._parsed.splice(t,n);i._stacked&&bs(i,o)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{let[n,i,o]=t;this[n](i,o)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){let t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);let i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return r})();function PM(r,e){if(!r._cache.$bar){let t=r.getMatchingVisibleMetas(e),n=[];for(let i=0,o=t.length;i<o;i++)n=n.concat(t[i].controller.getAllParsedValues(r));r._cache.$bar=zd(n.sort((i,o)=>i-o))}return r._cache.$bar}function FM(r){let e=r.iScale,t=PM(e,r.type),n=e._length,i,o,a,s,u=()=>{a===32767||a===-32768||(oa(s)&&(n=Math.min(n,Math.abs(a-s)||n)),s=a)};for(i=0,o=t.length;i<o;++i)a=e.getPixelForValue(t[i]),u();for(s=void 0,i=0,o=e.ticks.length;i<o;++i)a=e.getPixelForTick(i),u();return n}function OM(r,e,t,n){let i=t.barThickness,o,a;return Mt(i)?(o=e.min*t.categoryPercentage,a=t.barPercentage):(o=i*n,a=1),{chunk:o/n,ratio:a,start:e.pixels[r]-o/2}}function NM(r,e,t,n){let i=e.pixels,o=i[r],a=r>0?i[r-1]:null,s=r<i.length-1?i[r+1]:null,u=t.categoryPercentage;a===null&&(a=o-(s===null?e.end-e.start:s-o)),s===null&&(s=o+o-a);let c=o-(o-Math.min(a,s))/2*u;return{chunk:Math.abs(s-a)/2*u/n,ratio:t.barPercentage,start:c}}function LM(r,e,t,n){let i=t.parse(r[0],n),o=t.parse(r[1],n),a=Math.min(i,o),s=Math.max(i,o),u=a,c=s;Math.abs(a)>Math.abs(s)&&(u=s,c=a),e[t.axis]=c,e._custom={barStart:u,barEnd:c,start:i,end:o,min:a,max:s}}function d1(r,e,t,n){return Xt(r)?LM(r,e,t,n):e[t.axis]=t.parse(r,n),e}function vy(r,e,t,n){let i=r.iScale,o=r.vScale,a=i.getLabels(),s=i===o,u=[],c,l,h,d;for(c=t,l=t+n;c<l;++c)d=e[c],h={},h[i.axis]=s||i.parse(a[c],c),u.push(d1(d,h,o,c));return u}function cf(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function BM(r,e,t){return r!==0?Pn(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function WM(r){let e,t,n,i,o;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(i="end",o="start"):(i="start",o="end"),{start:t,end:n,reverse:e,top:i,bottom:o}}function zM(r,e,t,n){let i=e.borderSkipped,o={};if(!i){r.borderSkipped=o;return}if(i===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:a,end:s,reverse:u,top:c,bottom:l}=WM(r);i==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?i=c:(t._bottom||0)===n?i=l:(o[xy(l,a,s,u)]=!0,i=c)),o[xy(i,a,s,u)]=!0,r.borderSkipped=o}function xy(r,e,t,n){return n?(r=VM(r,e,t),r=by(r,t,e)):r=by(r,e,t),r}function VM(r,e,t){return r===e?t:r===t?e:r}function by(r,e,t){return r==="start"?e:r==="end"?t:r}function UM(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}var jM=(()=>{class r extends di{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,n,i,o){return vy(t,n,i,o)}parseArrayData(t,n,i,o){return vy(t,n,i,o)}parseObjectData(t,n,i,o){let{iScale:a,vScale:s}=t,{xAxisKey:u="x",yAxisKey:c="y"}=this._parsing,l=a.axis==="x"?u:c,h=s.axis==="x"?u:c,d=[],f,p,m,g;for(f=i,p=i+o;f<p;++f)g=n[f],m={},m[a.axis]=a.parse(Dr(g,l),f),d.push(d1(Dr(g,h),m,s,f));return d}updateRangeFromParsed(t,n,i,o){super.updateRangeFromParsed(t,n,i,o);let a=i._custom;a&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,a.min),t.max=Math.max(t.max,a.max))}getMaxOverflow(){return 0}getLabelAndValue(t){let n=this._cachedMeta,{iScale:i,vScale:o}=n,a=this.getParsed(t),s=a._custom,u=cf(s)?"["+s.start+", "+s.end+"]":""+o.getLabelForValue(a[o.axis]);return{label:""+i.getLabelForValue(a[i.axis]),value:u}}initialize(){this.enableOptionSharing=!0,super.initialize();let t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){let n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,o){let a=o==="reset",{index:s,_cachedMeta:{vScale:u}}=this,c=u.getBasePixel(),l=u.isHorizontal(),h=this._getRuler(),{sharedOptions:d,includeOptions:f}=this._getSharedOptions(n,o);for(let p=n;p<n+i;p++){let m=this.getParsed(p),g=a||Mt(m[u.axis])?{base:c,head:c}:this._calculateBarValuePixels(p),v=this._calculateBarIndexPixels(p,h),x=(m._stacks||{})[u.axis],w={horizontal:l,base:g.base,enableBorderRadius:!x||cf(m._custom)||s===x._top||s===x._bottom,x:l?g.head:v.center,y:l?v.center:g.head,height:l?v.size:Math.abs(g.size),width:l?Math.abs(g.size):v.size};f&&(w.options=d||this.resolveDataElementOptions(p,t[p].active?"active":o));let b=w.options||t[p].options;zM(w,b,x,s),UM(w,b,h.ratio),this.updateElement(t[p],p,w,o)}}_getStacks(t,n){let{iScale:i}=this._cachedMeta,o=i.getMatchingVisibleMetas(this._type).filter(c=>c.controller.options.grouped),a=i.options.stacked,s=[],u=c=>{let l=c.controller.getParsed(n),h=l&&l[c.vScale.axis];if(Mt(h)||isNaN(h))return!0};for(let c of o)if(!(n!==void 0&&u(c))&&((a===!1||s.indexOf(c.stack)===-1||a===void 0&&c.stack===void 0)&&s.push(c.stack),c.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,n,i){let o=this._getStacks(t,i),a=n!==void 0?o.indexOf(n):-1;return a===-1?o.length-1:a}_getRuler(){let t=this.options,n=this._cachedMeta,i=n.iScale,o=[],a,s;for(a=0,s=n.data.length;a<s;++a)o.push(i.getPixelForValue(this.getParsed(a)[i.axis],a));let u=t.barThickness;return{min:u||FM(n),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:u?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){let{_cachedMeta:{vScale:n,_stacked:i,index:o},options:{base:a,minBarLength:s}}=this,u=a||0,c=this.getParsed(t),l=c._custom,h=cf(l),d=c[n.axis],f=0,p=i?this.applyStack(n,c,i):d,m,g;p!==d&&(f=p-d,p=d),h&&(d=l.barStart,p=l.barEnd-l.barStart,d!==0&&Pn(d)!==Pn(l.barEnd)&&(f=0),f+=d);let v=!Mt(a)&&!h?a:f,x=n.getPixelForValue(v);if(this.chart.getDataVisibility(t)?m=n.getPixelForValue(f+p):m=x,g=m-x,Math.abs(g)<s){g=BM(g,n,u)*s,d===u&&(x-=g/2);let w=n.getPixelForDecimal(0),b=n.getPixelForDecimal(1),y=Math.min(w,b),_=Math.max(w,b);x=Math.max(Math.min(x,_),y),m=x+g,i&&!h&&(c._stacks[n.axis]._visualValues[o]=n.getValueForPixel(m)-n.getValueForPixel(x))}if(x===n.getPixelForValue(u)){let w=Pn(g)*n.getLineWidthForValue(u)/2;x+=w,g-=w}return{size:g,base:x,head:m,center:m+g/2}}_calculateBarIndexPixels(t,n){let i=n.scale,o=this.options,a=o.skipNull,s=gt(o.maxBarThickness,1/0),u,c;if(n.grouped){let l=a?this._getStackCount(t):n.stackCount,h=o.barThickness==="flex"?NM(t,n,o,l):OM(t,n,o,l),d=this._getStackIndex(this.index,this._cachedMeta.stack,a?t:void 0);u=h.start+h.chunk*d+h.chunk/2,c=Math.min(s,h.chunk*h.ratio)}else u=i.getPixelForValue(this.getParsed(t)[i.axis],t),c=Math.min(s,n.min*n.ratio);return{base:u-c/2,head:u+c/2,center:u,size:c}}draw(){let t=this._cachedMeta,n=t.vScale,i=t.data,o=i.length,a=0;for(;a<o;++a)this.getParsed(a)[n.axis]!==null&&i[a].draw(this._ctx)}}return r})(),HM=(()=>{class r extends di{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,o){let a=super.parsePrimitiveData(t,n,i,o);for(let s=0;s<a.length;s++)a[s]._custom=this.resolveDataElementOptions(s+i).radius;return a}parseArrayData(t,n,i,o){let a=super.parseArrayData(t,n,i,o);for(let s=0;s<a.length;s++){let u=n[i+s];a[s]._custom=gt(u[2],this.resolveDataElementOptions(s+i).radius)}return a}parseObjectData(t,n,i,o){let a=super.parseObjectData(t,n,i,o);for(let s=0;s<a.length;s++){let u=n[i+s];a[s]._custom=gt(u&&u.r&&+u.r,this.resolveDataElementOptions(s+i).radius)}return a}getMaxOverflow(){let t=this._cachedMeta.data,n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:a}=n,s=this.getParsed(t),u=o.getLabelForValue(s.x),c=a.getLabelForValue(s.y),l=s._custom;return{label:i[t]||"",value:"("+u+", "+c+(l?", "+l:"")+")"}}update(t){let n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,o){let a=o==="reset",{iScale:s,vScale:u}=this._cachedMeta,{sharedOptions:c,includeOptions:l}=this._getSharedOptions(n,o),h=s.axis,d=u.axis;for(let f=n;f<n+i;f++){let p=t[f],m=!a&&this.getParsed(f),g={},v=g[h]=a?s.getPixelForDecimal(.5):s.getPixelForValue(m[h]),x=g[d]=a?u.getBasePixel():u.getPixelForValue(m[d]);g.skip=isNaN(v)||isNaN(x),l&&(g.options=c||this.resolveDataElementOptions(f,p.active?"active":o),a&&(g.options.radius=0)),this.updateElement(p,f,g,o)}}resolveDataElementOptions(t,n){let i=this.getParsed(t),o=super.resolveDataElementOptions(t,n);o.$shared&&(o=Object.assign({},o,{$shared:!1}));let a=o.radius;return n!=="active"&&(o.radius=0),o.radius+=gt(i&&i._custom,a),o}}return r})();function GM(r,e,t){let n=1,i=1,o=0,a=0;if(e<Yt){let s=r,u=s+e,c=Math.cos(s),l=Math.sin(s),h=Math.cos(u),d=Math.sin(u),f=(w,b,y)=>sa(w,s,u,!0)?1:Math.max(b,b*t,y,y*t),p=(w,b,y)=>sa(w,s,u,!0)?-1:Math.min(b,b*t,y,y*t),m=f(0,c,h),g=f(ce,l,d),v=p(Kt,c,h),x=p(Kt+ce,l,d);n=(m-v)/2,i=(g-x)/2,o=-(m+v)/2,a=-(g+x)/2}return{ratioX:n,ratioY:i,offsetX:o,offsetY:a}}var Lf=(()=>{class r extends di{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){let n=t.data;if(n.labels.length&&n.datasets.length){let{labels:{pointStyle:i,color:o}}=t.legend.options;return n.labels.map((a,s)=>{let c=t.getDatasetMeta(0).controller.getStyle(s);return{text:a,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:o,lineWidth:c.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}};constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){let i=this.getDataset().data,o=this._cachedMeta;if(this._parsing===!1)o._parsed=i;else{let a=c=>+i[c];if(wt(i[t])){let{key:c="value"}=this._parsing;a=l=>+Dr(i[l],c)}let s,u;for(s=t,u=t+n;s<u;++s)o._parsed[s]=a(s)}}_getRotation(){return Cn(this.options.rotation-90)}_getCircumference(){return Cn(this.options.circumference)}_getRotationExtents(){let t=Yt,n=-Yt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){let o=this.chart.getDatasetMeta(i).controller,a=o._getRotation(),s=o._getCircumference();t=Math.min(t,a),n=Math.max(n,a+s)}return{rotation:t,circumference:n-t}}update(t){let n=this.chart,{chartArea:i}=n,o=this._cachedMeta,a=o.data,s=this.getMaxBorderWidth()+this.getMaxOffset(a)+this.options.spacing,u=Math.max((Math.min(i.width,i.height)-s)/2,0),c=Math.min(Nb(this.options.cutout,u),1),l=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:f,ratioY:p,offsetX:m,offsetY:g}=GM(d,h,c),v=(i.width-s)/f,x=(i.height-s)/p,w=Math.max(Math.min(v,x)/2,0),b=Pd(this.options.radius,w),y=Math.max(b*c,0),_=(b-y)/this._getVisibleDatasetWeightTotal();this.offsetX=m*b,this.offsetY=g*b,o.total=this.calculateTotal(),this.outerRadius=b-_*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-_*l,0),this.updateElements(a,0,a.length,t)}_circumference(t,n){let i=this.options,o=this._cachedMeta,a=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||o._parsed[t]===null||o.data[t].hidden?0:this.calculateCircumference(o._parsed[t]*a/Yt)}updateElements(t,n,i,o){let a=o==="reset",s=this.chart,u=s.chartArea,l=s.options.animation,h=(u.left+u.right)/2,d=(u.top+u.bottom)/2,f=a&&l.animateScale,p=f?0:this.innerRadius,m=f?0:this.outerRadius,{sharedOptions:g,includeOptions:v}=this._getSharedOptions(n,o),x=this._getRotation(),w;for(w=0;w<n;++w)x+=this._circumference(w,a);for(w=n;w<n+i;++w){let b=this._circumference(w,a),y=t[w],_={x:h+this.offsetX,y:d+this.offsetY,startAngle:x,endAngle:x+b,circumference:b,outerRadius:m,innerRadius:p};v&&(_.options=g||this.resolveDataElementOptions(w,y.active?"active":o)),x+=b,this.updateElement(y,w,_,o)}}calculateTotal(){let t=this._cachedMeta,n=t.data,i=0,o;for(o=0;o<n.length;o++){let a=t._parsed[o];a!==null&&!isNaN(a)&&this.chart.getDataVisibility(o)&&!n[o].hidden&&(i+=Math.abs(a))}return i}calculateCircumference(t){let n=this._cachedMeta.total;return n>0&&!isNaN(t)?Yt*(Math.abs(t)/n):0}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart,o=i.data.labels||[],a=ua(n._parsed[t],i.options.locale);return{label:o[t]||"",value:a}}getMaxBorderWidth(t){let n=0,i=this.chart,o,a,s,u,c;if(!t){for(o=0,a=i.data.datasets.length;o<a;++o)if(i.isDatasetVisible(o)){s=i.getDatasetMeta(o),t=s.data,u=s.controller;break}}if(!t)return 0;for(o=0,a=t.length;o<a;++o)c=u.resolveDataElementOptions(o),c.borderAlign!=="inner"&&(n=Math.max(n,c.borderWidth||0,c.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,o=t.length;i<o;++i){let a=this.resolveDataElementOptions(i);n=Math.max(n,a.offset||0,a.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(gt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return r})(),qM=(()=>{class r extends di{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){let n=this._cachedMeta,{dataset:i,data:o=[],_dataset:a}=n,s=this.chart._animationsDisabled,{start:u,count:c}=jd(n,o,s);this._drawStart=u,this._drawCount=c,Hd(n)&&(u=0,c=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!a._decimated,i.points=o;let l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!s,options:l},t),this.updateElements(o,u,c,t)}updateElements(t,n,i,o){let a=o==="reset",{iScale:s,vScale:u,_stacked:c,_dataset:l}=this._cachedMeta,{sharedOptions:h,includeOptions:d}=this._getSharedOptions(n,o),f=s.axis,p=u.axis,{spanGaps:m,segment:g}=this.options,v=ji(m)?m:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||a||o==="none",w=n+i,b=t.length,y=n>0&&this.getParsed(n-1);for(let _=0;_<b;++_){let S=t[_],C=x?S:{};if(_<n||_>=w){C.skip=!0;continue}let E=this.getParsed(_),I=Mt(E[p]),A=C[f]=s.getPixelForValue(E[f],_),R=C[p]=a||I?u.getBasePixel():u.getPixelForValue(c?this.applyStack(u,E,c):E[p],_);C.skip=isNaN(A)||isNaN(R)||I,C.stop=_>0&&Math.abs(E[f]-y[f])>v,g&&(C.parsed=E,C.raw=l.data[_]),d&&(C.options=h||this.resolveDataElementOptions(_,S.active?"active":o)),x||this.updateElement(S,_,C,o),y=E}}getMaxOverflow(){let t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,o=t.data||[];if(!o.length)return i;let a=o[0].size(this.resolveDataElementOptions(0)),s=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,a,s)/2}draw(){let t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}return r})(),f1=(()=>{class r extends di{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){let n=t.data;if(n.labels.length&&n.datasets.length){let{labels:{pointStyle:i,color:o}}=t.legend.options;return n.labels.map((a,s)=>{let c=t.getDatasetMeta(0).controller.getStyle(s);return{text:a,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:o,lineWidth:c.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart,o=i.data.labels||[],a=ua(n._parsed[t].r,i.options.locale);return{label:o[t]||"",value:a}}parseObjectData(t,n,i,o){return Zd.bind(this)(t,n,i,o)}update(t){let n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){let t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,o)=>{let a=this.getParsed(o).r;!isNaN(a)&&this.chart.getDataVisibility(o)&&(a<n.min&&(n.min=a),a>n.max&&(n.max=a))}),n}_updateRadius(){let t=this.chart,n=t.chartArea,i=t.options,o=Math.min(n.right-n.left,n.bottom-n.top),a=Math.max(o/2,0),s=Math.max(i.cutoutPercentage?a/100*i.cutoutPercentage:1,0),u=(a-s)/t.getVisibleDatasetCount();this.outerRadius=a-u*this.index,this.innerRadius=this.outerRadius-u}updateElements(t,n,i,o){let a=o==="reset",s=this.chart,c=s.options.animation,l=this._cachedMeta.rScale,h=l.xCenter,d=l.yCenter,f=l.getIndexAngle(0)-.5*Kt,p=f,m,g=360/this.countVisibleElements();for(m=0;m<n;++m)p+=this._computeAngle(m,o,g);for(m=n;m<n+i;m++){let v=t[m],x=p,w=p+this._computeAngle(m,o,g),b=s.getDataVisibility(m)?l.getDistanceFromCenterForValue(this.getParsed(m).r):0;p=w,a&&(c.animateScale&&(b=0),c.animateRotate&&(x=w=f));let y={x:h,y:d,innerRadius:0,outerRadius:b,startAngle:x,endAngle:w,options:this.resolveDataElementOptions(m,v.active?"active":o)};this.updateElement(v,m,y,o)}}countVisibleElements(){let t=this._cachedMeta,n=0;return t.data.forEach((i,o)=>{!isNaN(this.getParsed(o).r)&&this.chart.getDataVisibility(o)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?Cn(this.resolveDataElementOptions(t,n).angle||i):0}}return r})(),XM=(()=>{class r extends Lf{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return r})(),KM=(()=>{class r extends di{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){let n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,o){return Zd.bind(this)(t,n,i,o)}update(t){let n=this._cachedMeta,i=n.dataset,o=n.data||[],a=n.iScale.getLabels();if(i.points=o,t!=="resize"){let s=this.resolveDatasetElementOptions(t);this.options.showLine||(s.borderWidth=0);let u={_loop:!0,_fullLoop:a.length===o.length,options:s};this.updateElement(i,void 0,u,t)}this.updateElements(o,0,o.length,t)}updateElements(t,n,i,o){let a=this._cachedMeta.rScale,s=o==="reset";for(let u=n;u<n+i;u++){let c=t[u],l=this.resolveDataElementOptions(u,c.active?"active":o),h=a.getPointPositionForValue(u,this.getParsed(u).r),d=s?a.xCenter:h.x,f=s?a.yCenter:h.y,p={x:d,y:f,angle:h.angle,skip:isNaN(d)||isNaN(f),options:l};this.updateElement(c,u,p,o)}}}return r})(),YM=(()=>{class r extends di{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){let n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:a}=n,s=this.getParsed(t),u=o.getLabelForValue(s.x),c=a.getLabelForValue(s.y);return{label:i[t]||"",value:"("+u+", "+c+")"}}update(t){let n=this._cachedMeta,{data:i=[]}=n,o=this.chart._animationsDisabled,{start:a,count:s}=jd(n,i,o);if(this._drawStart=a,this._drawCount=s,Hd(n)&&(a=0,s=i.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:u,_dataset:c}=n;u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!c._decimated,u.points=i;let l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(u,void 0,{animated:!o,options:l},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,a,s,t)}addElements(){let{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,o){let a=o==="reset",{iScale:s,vScale:u,_stacked:c,_dataset:l}=this._cachedMeta,h=this.resolveDataElementOptions(n,o),d=this.getSharedOptions(h),f=this.includeOptions(o,d),p=s.axis,m=u.axis,{spanGaps:g,segment:v}=this.options,x=ji(g)?g:Number.POSITIVE_INFINITY,w=this.chart._animationsDisabled||a||o==="none",b=n>0&&this.getParsed(n-1);for(let y=n;y<n+i;++y){let _=t[y],S=this.getParsed(y),C=w?_:{},E=Mt(S[m]),I=C[p]=s.getPixelForValue(S[p],y),A=C[m]=a||E?u.getBasePixel():u.getPixelForValue(c?this.applyStack(u,S,c):S[m],y);C.skip=isNaN(I)||isNaN(A)||E,C.stop=y>0&&Math.abs(S[p]-b[p])>x,v&&(C.parsed=S,C.raw=l.data[y]),f&&(C.options=d||this.resolveDataElementOptions(y,_.active?"active":o)),w||this.updateElement(_,y,C,o),b=S}this.updateSharedOptions(d,o,h)}getMaxOverflow(){let t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let u=0;for(let c=n.length-1;c>=0;--c)u=Math.max(u,n[c].size(this.resolveDataElementOptions(c))/2);return u>0&&u}let i=t.dataset,o=i.options&&i.options.borderWidth||0;if(!n.length)return o;let a=n[0].size(this.resolveDataElementOptions(0)),s=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(o,a,s)/2}}return r})(),$M=Object.freeze({__proto__:null,BarController:jM,BubbleController:HM,DoughnutController:Lf,LineController:qM,PieController:XM,PolarAreaController:f1,RadarController:KM,ScatterController:YM});function Gi(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var xf=class r{static override(e){Object.assign(r.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return Gi()}parse(){return Gi()}format(){return Gi()}add(){return Gi()}diff(){return Gi()}startOf(){return Gi()}endOf(){return Gi()}},JM={_date:xf};function QM(r,e,t,n){let{controller:i,data:o,_sorted:a}=r,s=i._cachedMeta.iScale;if(s&&e===s.axis&&e!=="r"&&a&&o.length){let u=s._reversePixels?Ub:Qn;if(n){if(i._sharedOptions){let c=o[0],l=typeof c.getRange=="function"&&c.getRange(e);if(l){let h=u(o,e,t-l),d=u(o,e,t+l);return{lo:h.lo,hi:d.hi}}}}else return u(o,e,t)}return{lo:0,hi:o.length-1}}function Rs(r,e,t,n,i){let o=r.getSortedVisibleDatasetMetas(),a=t[e];for(let s=0,u=o.length;s<u;++s){let{index:c,data:l}=o[s],{lo:h,hi:d}=QM(o[s],e,a,i);for(let f=h;f<=d;++f){let p=l[f];p.skip||n(p,c,f)}}}function ZM(r){let e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,i){let o=e?Math.abs(n.x-i.x):0,a=t?Math.abs(n.y-i.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(a,2))}}function lf(r,e,t,n,i){let o=[];return!i&&!r.isPointInArea(e)||Rs(r,t,e,function(s,u,c){!i&&!Zn(s,r.chartArea,0)||s.inRange(e.x,e.y,n)&&o.push({element:s,datasetIndex:u,index:c})},!0),o}function tR(r,e,t,n){let i=[];function o(a,s,u){let{startAngle:c,endAngle:l}=a.getProps(["startAngle","endAngle"],n),{angle:h}=Bd(a,{x:e.x,y:e.y});sa(h,c,l)&&i.push({element:a,datasetIndex:s,index:u})}return Rs(r,t,e,o),i}function eR(r,e,t,n,i,o){let a=[],s=ZM(t),u=Number.POSITIVE_INFINITY;function c(l,h,d){let f=l.inRange(e.x,e.y,i);if(n&&!f)return;let p=l.getCenterPoint(i);if(!(!!o||r.isPointInArea(p))&&!f)return;let g=s(e,p);g<u?(a=[{element:l,datasetIndex:h,index:d}],u=g):g===u&&a.push({element:l,datasetIndex:h,index:d})}return Rs(r,t,e,c),a}function hf(r,e,t,n,i,o){return!o&&!r.isPointInArea(e)?[]:t==="r"&&!n?tR(r,e,t,i):eR(r,e,t,n,i,o)}function yy(r,e,t,n,i){let o=[],a=t==="x"?"inXRange":"inYRange",s=!1;return Rs(r,t,e,(u,c,l)=>{u[a](e[t],i)&&(o.push({element:u,datasetIndex:c,index:l}),s=s||u.inRange(e.x,e.y,i))}),n&&!s?[]:o}var nR={evaluateInteractionItems:Rs,modes:{index(r,e,t,n){let i=li(e,r),o=t.axis||"x",a=t.includeInvisible||!1,s=t.intersect?lf(r,i,o,n,a):hf(r,i,o,!1,n,a),u=[];return s.length?(r.getSortedVisibleDatasetMetas().forEach(c=>{let l=s[0].index,h=c.data[l];h&&!h.skip&&u.push({element:h,datasetIndex:c.index,index:l})}),u):[]},dataset(r,e,t,n){let i=li(e,r),o=t.axis||"xy",a=t.includeInvisible||!1,s=t.intersect?lf(r,i,o,n,a):hf(r,i,o,!1,n,a);if(s.length>0){let u=s[0].datasetIndex,c=r.getDatasetMeta(u).data;s=[];for(let l=0;l<c.length;++l)s.push({element:c[l],datasetIndex:u,index:l})}return s},point(r,e,t,n){let i=li(e,r),o=t.axis||"xy",a=t.includeInvisible||!1;return lf(r,i,o,n,a)},nearest(r,e,t,n){let i=li(e,r),o=t.axis||"xy",a=t.includeInvisible||!1;return hf(r,i,o,t.intersect,n,a)},x(r,e,t,n){let i=li(e,r);return yy(r,i,"x",t.intersect,n)},y(r,e,t,n){let i=li(e,r);return yy(r,i,"y",t.intersect,n)}}},p1=["left","top","right","bottom"];function ys(r,e){return r.filter(t=>t.pos===e)}function wy(r,e){return r.filter(t=>p1.indexOf(t.pos)===-1&&t.box.axis===e)}function ws(r,e){return r.sort((t,n)=>{let i=e?n:t,o=e?t:n;return i.weight===o.weight?i.index-o.index:i.weight-o.weight})}function rR(r){let e=[],t,n,i,o,a,s;for(t=0,n=(r||[]).length;t<n;++t)i=r[t],{position:o,options:{stack:a,stackWeight:s=1}}=i,e.push({index:t,box:i,pos:o,horizontal:i.isHorizontal(),weight:i.weight,stack:a&&o+a,stackWeight:s});return e}function iR(r){let e={};for(let t of r){let{stack:n,pos:i,stackWeight:o}=t;if(!n||!p1.includes(i))continue;let a=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=o}return e}function oR(r,e){let t=iR(r),{vBoxMaxWidth:n,hBoxMaxHeight:i}=e,o,a,s;for(o=0,a=r.length;o<a;++o){s=r[o];let{fullSize:u}=s.box,c=t[s.stack],l=c&&s.stackWeight/c.weight;s.horizontal?(s.width=l?l*n:u&&e.availableWidth,s.height=i):(s.width=n,s.height=l?l*i:u&&e.availableHeight)}return t}function aR(r){let e=rR(r),t=ws(e.filter(c=>c.box.fullSize),!0),n=ws(ys(e,"left"),!0),i=ws(ys(e,"right")),o=ws(ys(e,"top"),!0),a=ws(ys(e,"bottom")),s=wy(e,"x"),u=wy(e,"y");return{fullSize:t,leftAndTop:n.concat(o),rightAndBottom:i.concat(u).concat(a).concat(s),chartArea:ys(e,"chartArea"),vertical:n.concat(i).concat(u),horizontal:o.concat(a).concat(s)}}function _y(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function m1(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function sR(r,e,t,n){let{pos:i,box:o}=t,a=r.maxPadding;if(!wt(i)){t.size&&(r[i]-=t.size);let h=n[t.stack]||{size:0,count:1};h.size=Math.max(h.size,t.horizontal?o.height:o.width),t.size=h.size/h.count,r[i]+=t.size}o.getPadding&&m1(a,o.getPadding());let s=Math.max(0,e.outerWidth-_y(a,r,"left","right")),u=Math.max(0,e.outerHeight-_y(a,r,"top","bottom")),c=s!==r.w,l=u!==r.h;return r.w=s,r.h=u,t.horizontal?{same:c,other:l}:{same:l,other:c}}function uR(r){let e=r.maxPadding;function t(n){let i=Math.max(e[n]-r[n],0);return r[n]+=i,i}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function cR(r,e){let t=e.maxPadding;function n(i){let o={left:0,top:0,right:0,bottom:0};return i.forEach(a=>{o[a]=Math.max(e[a],t[a])}),o}return n(r?["left","right"]:["top","bottom"])}function Ss(r,e,t,n){let i=[],o,a,s,u,c,l;for(o=0,a=r.length,c=0;o<a;++o){s=r[o],u=s.box,u.update(s.width||e.w,s.height||e.h,cR(s.horizontal,e));let{same:h,other:d}=sR(e,t,s,n);c|=h&&i.length,l=l||d,u.fullSize||i.push(s)}return c&&Ss(i,e,t,n)||l}function Fc(r,e,t,n,i){r.top=t,r.left=e,r.right=e+n,r.bottom=t+i,r.width=n,r.height=i}function Cy(r,e,t,n){let i=t.padding,{x:o,y:a}=e;for(let s of r){let u=s.box,c=n[s.stack]||{count:1,placed:0,weight:1},l=s.stackWeight/c.weight||1;if(s.horizontal){let h=e.w*l,d=c.size||u.height;oa(c.start)&&(a=c.start),u.fullSize?Fc(u,i.left,a,t.outerWidth-i.right-i.left,d):Fc(u,e.left+c.placed,a,h,d),c.start=a,c.placed+=h,a=u.bottom}else{let h=e.h*l,d=c.size||u.width;oa(c.start)&&(o=c.start),u.fullSize?Fc(u,o,i.top,d,t.outerHeight-i.bottom-i.top):Fc(u,o,e.top+c.placed,d,h),c.start=o,c.placed+=h,o=u.right}}e.x=o,e.y=a}var Ue={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){let t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;let i=Oe(r.options.layout.padding),o=Math.max(e-i.width,0),a=Math.max(t-i.height,0),s=aR(r.boxes),u=s.vertical,c=s.horizontal;Ot(r.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});let l=u.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:o,availableHeight:a,vBoxMaxWidth:o/2/l,hBoxMaxHeight:a/2}),d=Object.assign({},i);m1(d,Oe(n));let f=Object.assign({maxPadding:d,w:o,h:a,x:i.left,y:i.top},i),p=oR(u.concat(c),h);Ss(s.fullSize,f,h,p),Ss(u,f,h,p),Ss(c,f,h,p)&&Ss(u,f,h,p),uR(f),Cy(s.leftAndTop,f,h,p),f.x+=f.w,f.y+=f.h,Cy(s.rightAndBottom,f,h,p),r.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Ot(s.chartArea,m=>{let g=m.box;Object.assign(g,r.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}},Hc=class{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,i){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):n)}}isAttached(e){return!0}updateConfig(e){}},bf=class extends Hc{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}},Vc="$chartjs",lR={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Sy=r=>r===null||r==="";function hR(r,e){let t=r.style,n=r.getAttribute("height"),i=r.getAttribute("width");if(r[Vc]={initial:{height:n,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",Sy(i)){let o=ef(r,"width");o!==void 0&&(r.width=o)}if(Sy(n))if(r.style.height==="")r.height=r.width/(e||2);else{let o=ef(r,"height");o!==void 0&&(r.height=o)}return r}var g1=oy?{passive:!0}:!1;function dR(r,e,t){r&&r.addEventListener(e,t,g1)}function fR(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,g1)}function pR(r,e){let t=lR[r.type]||r.type,{x:n,y:i}=li(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:i!==void 0?i:null}}function Gc(r,e){for(let t of r)if(t===e||t.contains(e))return!0}function mR(r,e,t){let n=r.canvas,i=new MutationObserver(o=>{let a=!1;for(let s of o)a=a||Gc(s.addedNodes,n),a=a&&!Gc(s.removedNodes,n);a&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}function gR(r,e,t){let n=r.canvas,i=new MutationObserver(o=>{let a=!1;for(let s of o)a=a||Gc(s.removedNodes,n),a=a&&!Gc(s.addedNodes,n);a&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}var ks=new Map,Ey=0;function v1(){let r=window.devicePixelRatio;r!==Ey&&(Ey=r,ks.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function vR(r,e){ks.size||window.addEventListener("resize",v1),ks.set(r,e)}function xR(r){ks.delete(r),ks.size||window.removeEventListener("resize",v1)}function bR(r,e,t){let n=r.canvas,i=n&&Tc(n);if(!i)return;let o=Ud((s,u)=>{let c=i.clientWidth;t(s,u),c<i.clientWidth&&t()},window),a=new ResizeObserver(s=>{let u=s[0],c=u.contentRect.width,l=u.contentRect.height;c===0&&l===0||o(c,l)});return a.observe(i),vR(r,o),a}function df(r,e,t){t&&t.disconnect(),e==="resize"&&xR(r)}function yR(r,e,t){let n=r.canvas,i=Ud(o=>{r.ctx!==null&&t(pR(o,r))},r);return dR(n,e,i),i}var yf=class extends Hc{acquireContext(e,t){let n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(hR(e,t),n):null}releaseContext(e){let t=e.canvas;if(!t[Vc])return!1;let n=t[Vc].initial;["height","width"].forEach(o=>{let a=n[o];Mt(a)?t.removeAttribute(o):t.setAttribute(o,a)});let i=n.style||{};return Object.keys(i).forEach(o=>{t.style[o]=i[o]}),t.width=t.width,delete t[Vc],!0}addEventListener(e,t,n){this.removeEventListener(e,t);let i=e.$proxies||(e.$proxies={}),a={attach:mR,detach:gR,resize:bR}[t]||yR;i[t]=a(e,t,n)}removeEventListener(e,t){let n=e.$proxies||(e.$proxies={}),i=n[t];if(!i)return;({attach:df,detach:df,resize:df}[t]||fR)(e,t,i),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,i){return iy(e,t,n,i)}isAttached(e){let t=Tc(e);return!!(t&&t.isConnected)}};function wR(r){return!Dc()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?bf:yf}var Fn=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){let{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return ji(this.x)&&ji(this.y)}getProps(e,t){let n=this.$animations;if(!t||!n)return this;let i={};return e.forEach(o=>{i[o]=n[o]&&n[o].active()?n[o]._to:this[o]}),i}};function _R(r,e){let t=r.options.ticks,n=CR(r),i=Math.min(t.maxTicksLimit||n,n),o=t.major.enabled?ER(e):[],a=o.length,s=o[0],u=o[a-1],c=[];if(a>i)return kR(e,c,o,a/i),c;let l=SR(o,e,i);if(a>0){let h,d,f=a>1?Math.round((u-s)/(a-1)):null;for(Oc(e,c,l,Mt(f)?0:s-f,s),h=0,d=a-1;h<d;h++)Oc(e,c,l,o[h],o[h+1]);return Oc(e,c,l,u,Mt(f)?e.length:u+f),c}return Oc(e,c,l),c}function CR(r){let e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),i=r._maxLength/t;return Math.floor(Math.min(n,i))}function SR(r,e,t){let n=IR(r),i=e.length/t;if(!n)return Math.max(i,1);let o=Wb(n);for(let a=0,s=o.length-1;a<s;a++){let u=o[a];if(u>i)return u}return Math.max(i,1)}function ER(r){let e=[],t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function kR(r,e,t,n){let i=0,o=t[0],a;for(n=Math.ceil(n),a=0;a<r.length;a++)a===o&&(e.push(r[a]),i++,o=t[i*n])}function Oc(r,e,t,n,i){let o=gt(n,0),a=Math.min(gt(i,r.length),r.length),s=0,u,c,l;for(t=Math.ceil(t),i&&(u=i-n,t=u/Math.floor(u/t)),l=o;l<0;)s++,l=Math.round(o+s*t);for(c=Math.max(o,0);c<a;c++)c===l&&(e.push(r[c]),s++,l=Math.round(o+s*t))}function IR(r){let e=r.length,t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}var MR=r=>r==="left"?"right":r==="right"?"left":r,ky=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,Iy=(r,e)=>Math.min(e||r,r);function My(r,e){let t=[],n=r.length/e,i=r.length,o=0;for(;o<i;o+=n)t.push(r[Math.floor(o)]);return t}function RR(r,e,t){let n=r.ticks.length,i=Math.min(e,n-1),o=r._startPixel,a=r._endPixel,s=1e-6,u=r.getPixelForTick(i),c;if(!(t&&(n===1?c=Math.max(u-o,a-u):e===0?c=(r.getPixelForTick(1)-u)/2:c=(u-r.getPixelForTick(i-1))/2,u+=i<e?c:-c,u<o-s||u>a+s)))return u}function AR(r,e){Ot(r,t=>{let n=t.gc,i=n.length/2,o;if(i>e){for(o=0;o<i;++o)delete t.data[n[o]];n.splice(0,i)}})}function _s(r){return r.drawTicks?r.tickLength:0}function Ry(r,e){if(!r.display)return 0;let t=ve(r.font,e),n=Oe(r.padding);return(Xt(r.text)?r.text.length:1)*t.lineHeight+n.height}function DR(r,e){return Tr(r,{scale:e,type:"scale"})}function TR(r,e,t){return Tr(r,{tick:t,index:e,type:"tick"})}function PR(r,e,t){let n=kc(r);return(t&&e!=="right"||!t&&e==="right")&&(n=MR(n)),n}function FR(r,e,t,n){let{top:i,left:o,bottom:a,right:s,chart:u}=r,{chartArea:c,scales:l}=u,h=0,d,f,p,m=a-i,g=s-o;if(r.isHorizontal()){if(f=Fe(n,o,s),wt(t)){let v=Object.keys(t)[0],x=t[v];p=l[v].getPixelForValue(x)+m-e}else t==="center"?p=(c.bottom+c.top)/2+m-e:p=ky(r,t,e);d=s-o}else{if(wt(t)){let v=Object.keys(t)[0],x=t[v];f=l[v].getPixelForValue(x)-g+e}else t==="center"?f=(c.left+c.right)/2-g+e:f=ky(r,t,e);p=Fe(n,a,i),h=t==="left"?-ce:ce}return{titleX:f,titleY:p,maxWidth:d,rotation:h}}var Xi=class r extends Fn{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:i}=this;return e=rn(e,Number.POSITIVE_INFINITY),t=rn(t,Number.NEGATIVE_INFINITY),n=rn(n,Number.POSITIVE_INFINITY),i=rn(i,Number.NEGATIVE_INFINITY),{min:rn(e,n),max:rn(t,i),minDefined:ie(e),maxDefined:ie(t)}}getMinMax(e){let{min:t,max:n,minDefined:i,maxDefined:o}=this.getUserBounds(),a;if(i&&o)return{min:t,max:n};let s=this.getMatchingVisibleMetas();for(let u=0,c=s.length;u<c;++u)a=s[u].controller.getMinMax(this,e),i||(t=Math.min(t,a.min)),o||(n=Math.max(n,a.max));return t=o&&t>n?n:t,n=i&&t>n?t:n,{min:rn(t,rn(n,t)),max:rn(n,rn(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ht(this.options.beforeUpdate,[this])}update(e,t,n){let{beginAtZero:i,grace:o,ticks:a}=this.options,s=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Qb(this,o,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let u=s<this.ticks.length;this._convertTicksToLabels(u?My(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=_R(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),u&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ht(this.options.afterUpdate,[this])}beforeSetDimensions(){Ht(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ht(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Ht(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ht(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){let t=this.options.ticks,n,i,o;for(n=0,i=e.length;n<i;n++)o=e[n],o.label=Ht(t.callback,[o.value,n,e],this)}afterTickToLabelConversion(){Ht(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ht(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let e=this.options,t=e.ticks,n=Iy(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,o=t.maxRotation,a=i,s,u,c;if(!this._isVisible()||!t.display||i>=o||n<=1||!this.isHorizontal()){this.labelRotation=i;return}let l=this._getLabelSizes(),h=l.widest.width,d=l.highest.height,f=we(this.chart.width-h,0,this.maxWidth);s=e.offset?this.maxWidth/n:f/(n-1),h+6>s&&(s=f/(n-(e.offset?.5:1)),u=this.maxHeight-_s(e.grid)-t.padding-Ry(e.title,this.chart.options.font),c=Math.sqrt(h*h+d*d),a=Sc(Math.min(Math.asin(we((l.highest.height+6)/s,-1,1)),Math.asin(we(u/c,-1,1))-Math.asin(we(d/c,-1,1)))),a=Math.max(i,Math.min(o,a))),this.labelRotation=a}afterCalculateLabelRotation(){Ht(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ht(this.options.beforeFit,[this])}fit(){let e={width:0,height:0},{chart:t,options:{ticks:n,title:i,grid:o}}=this,a=this._isVisible(),s=this.isHorizontal();if(a){let u=Ry(i,t.options.font);if(s?(e.width=this.maxWidth,e.height=_s(o)+u):(e.height=this.maxHeight,e.width=_s(o)+u),n.display&&this.ticks.length){let{first:c,last:l,widest:h,highest:d}=this._getLabelSizes(),f=n.padding*2,p=Cn(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(s){let v=n.mirror?0:g*h.width+m*d.height;e.height=Math.min(this.maxHeight,e.height+v+f)}else{let v=n.mirror?0:m*h.width+g*d.height;e.width=Math.min(this.maxWidth,e.width+v+f)}this._calculatePadding(c,l,g,m)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,i){let{ticks:{align:o,padding:a},position:s}=this.options,u=this.labelRotation!==0,c=s!=="top"&&this.axis==="x";if(this.isHorizontal()){let l=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1),d=0,f=0;u?c?(d=i*e.width,f=n*t.height):(d=n*e.height,f=i*t.width):o==="start"?f=t.width:o==="end"?d=e.width:o!=="inner"&&(d=e.width/2,f=t.width/2),this.paddingLeft=Math.max((d-l+a)*this.width/(this.width-l),0),this.paddingRight=Math.max((f-h+a)*this.width/(this.width-h),0)}else{let l=t.height/2,h=e.height/2;o==="start"?(l=0,h=e.height):o==="end"&&(l=t.height,h=0),this.paddingTop=l+a,this.paddingBottom=h+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ht(this.options.afterFit,[this])}isHorizontal(){let{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)Mt(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){let t=this.options.ticks.sampleSize,n=this.ticks;t<n.length&&(n=My(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){let{ctx:i,_longestTextCache:o}=this,a=[],s=[],u=Math.floor(t/Iy(t,n)),c=0,l=0,h,d,f,p,m,g,v,x,w,b,y;for(h=0;h<t;h+=u){if(p=e[h].label,m=this._resolveTickFontOptions(h),i.font=g=m.string,v=o[g]=o[g]||{data:{},gc:[]},x=m.lineHeight,w=b=0,!Mt(p)&&!Xt(p))w=ps(i,v.data,v.gc,w,p),b=x;else if(Xt(p))for(d=0,f=p.length;d<f;++d)y=p[d],!Mt(y)&&!Xt(y)&&(w=ps(i,v.data,v.gc,w,y),b+=x);a.push(w),s.push(b),c=Math.max(w,c),l=Math.max(b,l)}AR(o,t);let _=a.indexOf(c),S=s.indexOf(l),C=E=>({width:a[E]||0,height:s[E]||0});return{first:C(0),last:C(t-1),widest:C(_),highest:C(S),widths:a,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){let t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);let t=this._startPixel+e*this._length;return Vb(this._alignToPixels?si(this.chart,t,0):t)}getDecimalForPixel(e){let t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){let t=this.ticks||[];if(e>=0&&e<t.length){let n=t[e];return n.$context||(n.$context=TR(this.getContext(),e,n))}return this.$context||(this.$context=DR(this.chart.getContext(),this))}_tickSize(){let e=this.options.ticks,t=Cn(this.labelRotation),n=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),o=this._getLabelSizes(),a=e.autoSkipPadding||0,s=o?o.widest.width+a:0,u=o?o.highest.height+a:0;return this.isHorizontal()?u*n>s*i?s/n:u/i:u*i<s*n?u/n:s/i}_isVisible(){let e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){let t=this.axis,n=this.chart,i=this.options,{grid:o,position:a,border:s}=i,u=o.offset,c=this.isHorizontal(),h=this.ticks.length+(u?1:0),d=_s(o),f=[],p=s.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,v=function(V){return si(n,V,m)},x,w,b,y,_,S,C,E,I,A,R,L;if(a==="top")x=v(this.bottom),S=this.bottom-d,E=x-g,A=v(e.top)+g,L=e.bottom;else if(a==="bottom")x=v(this.top),A=e.top,L=v(e.bottom)-g,S=x+g,E=this.top+d;else if(a==="left")x=v(this.right),_=this.right-d,C=x-g,I=v(e.left)+g,R=e.right;else if(a==="right")x=v(this.left),I=e.left,R=v(e.right)-g,_=x+g,C=this.left+d;else if(t==="x"){if(a==="center")x=v((e.top+e.bottom)/2+.5);else if(wt(a)){let V=Object.keys(a)[0],z=a[V];x=v(this.chart.scales[V].getPixelForValue(z))}A=e.top,L=e.bottom,S=x+g,E=S+d}else if(t==="y"){if(a==="center")x=v((e.left+e.right)/2);else if(wt(a)){let V=Object.keys(a)[0],z=a[V];x=v(this.chart.scales[V].getPixelForValue(z))}_=x-g,C=_-d,I=e.left,R=e.right}let B=gt(i.ticks.maxTicksLimit,h),O=Math.max(1,Math.ceil(h/B));for(w=0;w<h;w+=O){let V=this.getContext(w),z=o.setContext(V),U=s.setContext(V),H=z.lineWidth,K=z.color,et=U.dash||[],nt=U.dashOffset,st=z.tickWidth,ht=z.tickColor,ft=z.tickBorderDash||[],pt=z.tickBorderDashOffset;b=RR(this,w,u),b!==void 0&&(y=si(n,b,H),c?_=C=I=R=y:S=E=A=L=y,f.push({tx1:_,ty1:S,tx2:C,ty2:E,x1:I,y1:A,x2:R,y2:L,width:H,color:K,borderDash:et,borderDashOffset:nt,tickWidth:st,tickColor:ht,tickBorderDash:ft,tickBorderDashOffset:pt}))}return this._ticksLength=h,this._borderValue=x,f}_computeLabelItems(e){let t=this.axis,n=this.options,{position:i,ticks:o}=n,a=this.isHorizontal(),s=this.ticks,{align:u,crossAlign:c,padding:l,mirror:h}=o,d=_s(n.grid),f=d+l,p=h?-l:f,m=-Cn(this.labelRotation),g=[],v,x,w,b,y,_,S,C,E,I,A,R,L="middle";if(i==="top")_=this.bottom-p,S=this._getXAxisLabelAlignment();else if(i==="bottom")_=this.top+p,S=this._getXAxisLabelAlignment();else if(i==="left"){let O=this._getYAxisLabelAlignment(d);S=O.textAlign,y=O.x}else if(i==="right"){let O=this._getYAxisLabelAlignment(d);S=O.textAlign,y=O.x}else if(t==="x"){if(i==="center")_=(e.top+e.bottom)/2+f;else if(wt(i)){let O=Object.keys(i)[0],V=i[O];_=this.chart.scales[O].getPixelForValue(V)+f}S=this._getXAxisLabelAlignment()}else if(t==="y"){if(i==="center")y=(e.left+e.right)/2-f;else if(wt(i)){let O=Object.keys(i)[0],V=i[O];y=this.chart.scales[O].getPixelForValue(V)}S=this._getYAxisLabelAlignment(d).textAlign}t==="y"&&(u==="start"?L="top":u==="end"&&(L="bottom"));let B=this._getLabelSizes();for(v=0,x=s.length;v<x;++v){w=s[v],b=w.label;let O=o.setContext(this.getContext(v));C=this.getPixelForTick(v)+o.labelOffset,E=this._resolveTickFontOptions(v),I=E.lineHeight,A=Xt(b)?b.length:1;let V=A/2,z=O.color,U=O.textStrokeColor,H=O.textStrokeWidth,K=S;a?(y=C,S==="inner"&&(v===x-1?K=this.options.reverse?"left":"right":v===0?K=this.options.reverse?"right":"left":K="center"),i==="top"?c==="near"||m!==0?R=-A*I+I/2:c==="center"?R=-B.highest.height/2-V*I+I:R=-B.highest.height+I/2:c==="near"||m!==0?R=I/2:c==="center"?R=B.highest.height/2-V*I:R=B.highest.height-A*I,h&&(R*=-1),m!==0&&!O.showLabelBackdrop&&(y+=I/2*Math.sin(m))):(_=C,R=(1-A)*I/2);let et;if(O.showLabelBackdrop){let nt=Oe(O.backdropPadding),st=B.heights[v],ht=B.widths[v],ft=R-nt.top,pt=0-nt.left;switch(L){case"middle":ft-=st/2;break;case"bottom":ft-=st;break}switch(S){case"center":pt-=ht/2;break;case"right":pt-=ht;break;case"inner":v===x-1?pt-=ht:v>0&&(pt-=ht/2);break}et={left:pt,top:ft,width:ht+nt.width,height:st+nt.height,color:O.backdropColor}}g.push({label:b,font:E,textOffset:R,options:{rotation:m,color:z,strokeColor:U,strokeWidth:H,textAlign:K,textBaseline:L,translation:[y,_],backdrop:et}})}return g}_getXAxisLabelAlignment(){let{position:e,ticks:t}=this.options;if(-Cn(this.labelRotation))return e==="top"?"left":"right";let i="center";return t.align==="start"?i="left":t.align==="end"?i="right":t.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){let{position:t,ticks:{crossAlign:n,mirror:i,padding:o}}=this.options,a=this._getLabelSizes(),s=e+o,u=a.widest.width,c,l;return t==="left"?i?(l=this.right+o,n==="near"?c="left":n==="center"?(c="center",l+=u/2):(c="right",l+=u)):(l=this.right-s,n==="near"?c="right":n==="center"?(c="center",l-=u/2):(c="left",l=this.left)):t==="right"?i?(l=this.left+o,n==="near"?c="right":n==="center"?(c="center",l-=u/2):(c="left",l-=u)):(l=this.left+s,n==="near"?c="left":n==="center"?(c="center",l+=u/2):(c="right",l=this.right)):c="right",{textAlign:c,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;let e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){let{ctx:e,options:{backgroundColor:t},left:n,top:i,width:o,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,i,o,a),e.restore())}getLineWidthForValue(e){let t=this.options.grid;if(!this._isVisible()||!t.display)return 0;let i=this.ticks.findIndex(o=>o.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){let t=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e)),o,a,s=(u,c,l)=>{!l.width||!l.color||(n.save(),n.lineWidth=l.width,n.strokeStyle=l.color,n.setLineDash(l.borderDash||[]),n.lineDashOffset=l.borderDashOffset,n.beginPath(),n.moveTo(u.x,u.y),n.lineTo(c.x,c.y),n.stroke(),n.restore())};if(t.display)for(o=0,a=i.length;o<a;++o){let u=i[o];t.drawOnChartArea&&s({x:u.x1,y:u.y1},{x:u.x2,y:u.y2},u),t.drawTicks&&s({x:u.tx1,y:u.ty1},{x:u.tx2,y:u.ty2},{color:u.tickColor,width:u.tickWidth,borderDash:u.tickBorderDash,borderDashOffset:u.tickBorderDashOffset})}}drawBorder(){let{chart:e,ctx:t,options:{border:n,grid:i}}=this,o=n.setContext(this.getContext()),a=n.display?o.width:0;if(!a)return;let s=i.setContext(this.getContext(0)).lineWidth,u=this._borderValue,c,l,h,d;this.isHorizontal()?(c=si(e,this.left,a)-a/2,l=si(e,this.right,s)+s/2,h=d=u):(h=si(e,this.top,a)-a/2,d=si(e,this.bottom,s)+s/2,c=l=u),t.save(),t.lineWidth=o.width,t.strokeStyle=o.color,t.beginPath(),t.moveTo(c,h),t.lineTo(l,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;let n=this.ctx,i=this._computeLabelArea();i&&vs(n,i);let o=this.getLabelItems(e);for(let a of o){let s=a.options,u=a.font,c=a.label,l=a.textOffset;ui(n,c,0,l,u,s)}i&&xs(n)}drawTitle(){let{ctx:e,options:{position:t,title:n,reverse:i}}=this;if(!n.display)return;let o=ve(n.font),a=Oe(n.padding),s=n.align,u=o.lineHeight/2;t==="bottom"||t==="center"||wt(t)?(u+=a.bottom,Xt(n.text)&&(u+=o.lineHeight*(n.text.length-1))):u+=a.top;let{titleX:c,titleY:l,maxWidth:h,rotation:d}=FR(this,u,t,s);ui(e,n.text,0,0,o,{color:n.color,maxWidth:h,rotation:d,textAlign:PR(s,t,i),textBaseline:"middle",translation:[c,l]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){let e=this.options,t=e.ticks&&e.ticks.z||0,n=gt(e.grid&&e.grid.z,-1),i=gt(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==r.prototype.draw?[{z:t,draw:o=>{this.draw(o)}}]:[{z:n,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(e){let t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[],o,a;for(o=0,a=t.length;o<a;++o){let s=t[o];s[n]===this.id&&(!e||s.type===e)&&i.push(s)}return i}_resolveTickFontOptions(e){let t=this.options.ticks.setContext(this.getContext(e));return ve(t.font)}_maxDigits(){let e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}},da=class{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){let t=Object.getPrototypeOf(e),n;LR(t)&&(n=this.register(t));let i=this.items,o=e.id,a=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in i||(i[o]=e,OR(e,a,n),this.override&&oe.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){let t=this.items,n=e.id,i=this.scope;n in t&&delete t[n],i&&n in oe[i]&&(delete oe[i][n],this.override&&delete ai[n])}};function OR(r,e,t){let n=na(Object.create(null),[t?oe.get(t):{},oe.get(e),r.defaults]);oe.set(e,n),r.defaultRoutes&&NR(e,r.defaultRoutes),r.descriptors&&oe.describe(e,r.descriptors)}function NR(r,e){Object.keys(e).forEach(t=>{let n=t.split("."),i=n.pop(),o=[r].concat(n).join("."),a=e[t].split("."),s=a.pop(),u=a.join(".");oe.route(o,i,u,s)})}function LR(r){return"id"in r&&"defaults"in r}var wf=class{constructor(){this.controllers=new da(di,"datasets",!0),this.elements=new da(Fn,"elements"),this.plugins=new da(Object,"plugins"),this.scales=new da(Xi,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(i=>{let o=n||this._getRegistryForType(i);n||o.isForType(i)||o===this.plugins&&i.id?this._exec(e,o,i):Ot(i,a=>{let s=n||this._getRegistryForType(a);this._exec(e,s,a)})})}_exec(e,t,n){let i=Cc(e);Ht(n["before"+i],[],n),t[e](n),Ht(n["after"+i],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){let n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){let i=t.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return i}},rr=new wf,_f=class{constructor(){this._init=[]}notify(e,t,n,i){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));let o=i?this._descriptors(e).filter(i):this._descriptors(e),a=this._notify(o,e,t,n);return t==="afterDestroy"&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,t,n,i){i=i||{};for(let o of e){let a=o.plugin,s=a[n],u=[t,i,o.options];if(Ht(s,u,a)===!1&&i.cancelable)return!1}return!0}invalidate(){Mt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;let t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){let n=e&&e.config,i=gt(n.options&&n.options.plugins,{}),o=BR(n);return i===!1&&!t?[]:zR(e,o,i,t)}_notifyStateChanges(e){let t=this._oldCache||[],n=this._cache,i=(o,a)=>o.filter(s=>!a.some(u=>s.plugin.id===u.plugin.id));this._notify(i(t,n),e,"stop"),this._notify(i(n,t),e,"start")}};function BR(r){let e={},t=[],n=Object.keys(rr.plugins.items);for(let o=0;o<n.length;o++)t.push(rr.getPlugin(n[o]));let i=r.plugins||[];for(let o=0;o<i.length;o++){let a=i[o];t.indexOf(a)===-1&&(t.push(a),e[a.id]=!0)}return{plugins:t,localIds:e}}function WR(r,e){return!e&&r===!1?null:r===!0?{}:r}function zR(r,{plugins:e,localIds:t},n,i){let o=[],a=r.getContext();for(let s of e){let u=s.id,c=WR(n[u],i);c!==null&&o.push({plugin:s,options:VR(r.config,{plugin:s,local:t[u]},c,a)})}return o}function VR(r,{plugin:e,local:t},n,i){let o=r.pluginScopeKeys(e),a=r.getOptionScopes(n,o);return t&&e.defaults&&a.push(e.defaults),r.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Cf(r,e){let t=oe.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function UR(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function jR(r,e){return r===e?"_index_":"_value_"}function Ay(r){if(r==="x"||r==="y"||r==="r")return r}function HR(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function Sf(r,...e){if(Ay(r))return r;for(let t of e){let n=t.axis||HR(t.position)||r.length>1&&Ay(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function Dy(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function GR(r,e){if(e.data&&e.data.datasets){let t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return Dy(r,"x",t[0])||Dy(r,"y",t[0])}return{}}function qR(r,e){let t=ai[r.type]||{scales:{}},n=e.scales||{},i=Cf(r.type,e),o=Object.create(null);return Object.keys(n).forEach(a=>{let s=n[a];if(!wt(s))return console.error(`Invalid scale configuration for scale: ${a}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);let u=Sf(a,s,GR(a,r),oe.scales[s.type]),c=jR(u,i),l=t.scales||{};o[a]=ia(Object.create(null),[{axis:u},s,l[u],l[c]])}),r.data.datasets.forEach(a=>{let s=a.type||r.type,u=a.indexAxis||Cf(s,e),l=(ai[s]||{}).scales||{};Object.keys(l).forEach(h=>{let d=UR(h,u),f=a[d+"AxisID"]||d;o[f]=o[f]||Object.create(null),ia(o[f],[{axis:d},n[f],l[h]])})}),Object.keys(o).forEach(a=>{let s=o[a];ia(s,[oe.scales[s.type],oe.scale])}),o}function x1(r){let e=r.options||(r.options={});e.plugins=gt(e.plugins,{}),e.scales=qR(r,e)}function b1(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function XR(r){return r=r||{},r.data=b1(r.data),x1(r),r}var Ty=new Map,y1=new Set;function Nc(r,e){let t=Ty.get(r);return t||(t=e(),Ty.set(r,t),y1.add(t)),t}var Cs=(r,e,t)=>{let n=Dr(e,t);n!==void 0&&r.add(n)},Ef=class{constructor(e){this._config=XR(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=b1(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){let e=this._config;this.clearCache(),x1(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Nc(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Nc(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Nc(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){let t=e.id,n=this.type;return Nc(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){let n=this._scopeCache,i=n.get(e);return(!i||t)&&(i=new Map,n.set(e,i)),i}getOptionScopes(e,t,n){let{options:i,type:o}=this,a=this._cachedScopes(e,n),s=a.get(t);if(s)return s;let u=new Set;t.forEach(l=>{e&&(u.add(e),l.forEach(h=>Cs(u,e,h))),l.forEach(h=>Cs(u,i,h)),l.forEach(h=>Cs(u,ai[o]||{},h)),l.forEach(h=>Cs(u,oe,h)),l.forEach(h=>Cs(u,Ic,h))});let c=Array.from(u);return c.length===0&&c.push(Object.create(null)),y1.has(t)&&a.set(t,c),c}chartOptionScopes(){let{options:e,type:t}=this;return[e,ai[t]||{},oe.datasets[t]||{},{type:t},oe,Ic]}resolveNamedOptions(e,t,n,i=[""]){let o={$shared:!0},{resolver:a,subPrefixes:s}=Py(this._resolverCache,e,i),u=a;if(YR(a,t)){o.$shared=!1,n=Rr(n)?n():n;let c=this.createResolver(e,n,s);u=Ui(a,n,c)}for(let c of t)o[c]=u[c];return o}createResolver(e,t,n=[""],i){let{resolver:o}=Py(this._resolverCache,e,n);return wt(t)?Ui(o,t,void 0,i):o}};function Py(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));let i=t.join(),o=n.get(i);return o||(o={resolver:Ac(e,t),subPrefixes:t.filter(s=>!s.toLowerCase().includes("hover"))},n.set(i,o)),o}var KR=r=>wt(r)&&Object.getOwnPropertyNames(r).some(e=>Rr(r[e]));function YR(r,e){let{isScriptable:t,isIndexable:n}=$d(r);for(let i of e){let o=t(i),a=n(i),s=(a||o)&&r[i];if(o&&(Rr(s)||KR(s))||a&&Xt(s))return!0}return!1}var $R="4.4.2",JR=["top","bottom","left","right","chartArea"];function Fy(r,e){return r==="top"||r==="bottom"||JR.indexOf(r)===-1&&e==="x"}function Oy(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function Ny(r){let e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Ht(t&&t.onComplete,[r],e)}function QR(r){let e=r.chart,t=e.options.animation;Ht(t&&t.onProgress,[r],e)}function w1(r){return Dc()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}var Uc={},Ly=r=>{let e=w1(r);return Object.values(Uc).filter(t=>t.canvas===e).pop()};function ZR(r,e,t){let n=Object.keys(r);for(let i of n){let o=+i;if(o>=e){let a=r[i];delete r[i],(t>0||o>e)&&(r[o+t]=a)}}}function tA(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}function Lc(r,e,t){return r.options.clip?r[t]:e[t]}function eA(r,e){let{xScale:t,yScale:n}=r;return t&&n?{left:Lc(t,e,"left"),right:Lc(t,e,"right"),top:Lc(n,e,"top"),bottom:Lc(n,e,"bottom")}:e}var Yc=(()=>{class r{static defaults=oe;static instances=Uc;static overrides=ai;static registry=rr;static version=$R;static getChart=Ly;static register(...t){rr.add(...t),By()}static unregister(...t){rr.remove(...t),By()}constructor(t,n){let i=this.config=new Ef(n),o=w1(t),a=Ly(o);if(a)throw new Error("Canvas is already in use. Chart with ID '"+a.id+"' must be destroyed before the canvas with ID '"+a.canvas.id+"' can be reused.");let s=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||wR(o)),this.platform.updateConfig(i);let u=this.platform.acquireContext(o,s.aspectRatio),c=u&&u.canvas,l=c&&c.height,h=c&&c.width;if(this.id=Ob(),this.ctx=u,this.canvas=c,this.width=h,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new _f,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qb(d=>this.update(d),s.resizeDelay||0),this._dataChanges=[],Uc[this.id]=this,!u||!c){console.error("Failed to create chart: can't acquire context from the given item");return}Pr.listen(this,"complete",Ny),Pr.listen(this,"progress",QR),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:o,_aspectRatio:a}=this;return Mt(t)?n&&a?a:o?i/o:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return rr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():tf(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Xd(this.canvas,this.ctx),this}stop(){return Pr.stop(this),this}resize(t,n){Pr.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){let i=this.options,o=this.canvas,a=i.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(o,t,n,a),u=i.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,tf(this,u,!0)&&(this.notifyPlugins("resize",{size:s}),Ht(i.onResize,[this,s],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){let n=this.options.scales||{};Ot(n,(i,o)=>{i.id=o})}buildOrUpdateScales(){let t=this.options,n=t.scales,i=this.scales,o=Object.keys(i).reduce((s,u)=>(s[u]=!1,s),{}),a=[];n&&(a=a.concat(Object.keys(n).map(s=>{let u=n[s],c=Sf(s,u),l=c==="r",h=c==="x";return{options:u,dposition:l?"chartArea":h?"bottom":"left",dtype:l?"radialLinear":h?"category":"linear"}}))),Ot(a,s=>{let u=s.options,c=u.id,l=Sf(c,u),h=gt(u.type,s.dtype);(u.position===void 0||Fy(u.position,l)!==Fy(s.dposition))&&(u.position=s.dposition),o[c]=!0;let d=null;if(c in i&&i[c].type===h)d=i[c];else{let f=rr.getScale(h);d=new f({id:c,type:h,ctx:this.ctx,chart:this}),i[d.id]=d}d.init(u,t)}),Ot(o,(s,u)=>{s||delete i[u]}),Ot(i,s=>{Ue.configure(this,s,s.options),Ue.addBox(this,s)})}_updateMetasets(){let t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((o,a)=>o.index-a.index),i>n){for(let o=n;o<i;++o)this._destroyDatasetMeta(o);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(Oy("order","index"))}_removeUnreferencedMetasets(){let{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,o)=>{n.filter(a=>a===i._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){let t=[],n=this.data.datasets,i,o;for(this._removeUnreferencedMetasets(),i=0,o=n.length;i<o;i++){let a=n[i],s=this.getDatasetMeta(i),u=a.type||this.config.type;if(s.type&&s.type!==u&&(this._destroyDatasetMeta(i),s=this.getDatasetMeta(i)),s.type=u,s.indexAxis=a.indexAxis||Cf(u,this.options),s.order=a.order||0,s.index=i,s.label=""+a.label,s.visible=this.isDatasetVisible(i),s.controller)s.controller.updateIndex(i),s.controller.linkScales();else{let c=rr.getController(u),{datasetElementType:l,dataElementType:h}=oe.datasets[u];Object.assign(c,{dataElementType:rr.getElement(h),datasetElementType:l&&rr.getElement(l)}),s.controller=new c(this,i),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){Ot(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){let n=this.config;n.update();let i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;let a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let l=0,h=this.data.datasets.length;l<h;l++){let{controller:d}=this.getDatasetMeta(l),f=!o&&a.indexOf(d)===-1;d.buildOrUpdateElements(f),s=Math.max(+d.getMaxOverflow(),s)}s=this._minPadding=i.layout.autoPadding?s:0,this._updateLayout(s),o||Ot(a,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Oy("z","_idx"));let{_active:u,_lastEvent:c}=this;c?this._eventHandler(c,!0):u.length&&this._updateHoverStyles(u,u,!0),this.render()}_updateScales(){Ot(this.scales,t=>{Ue.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!Fd(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(let{method:i,start:o,count:a}of n){let s=i==="_removeElements"?-a:a;ZR(t,o,s)}}_getUniformDataChanges(){let t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];let n=this.data.datasets.length,i=a=>new Set(t.filter(s=>s[0]===a).map((s,u)=>u+","+s.splice(1).join(","))),o=i(0);for(let a=1;a<n;a++)if(!Fd(o,i(a)))return;return Array.from(o).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ue.update(this,this.width,this.height,t);let n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],Ot(this.boxes,o=>{i&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,a)=>{o._idx=a}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Rr(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){let i=this.getDatasetMeta(t),o={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(i.controller._update(n),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Pr.has(this)?this.attached&&!Pr.running(this)&&Pr.start(this):(this.draw(),Ny({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){let{width:i,height:o}=this._resizeBeforeDraw;this._resize(i,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){let n=this._sortedMetasets,i=[],o,a;for(o=0,a=n.length;o<a;++o){let s=n[o];(!t||s.visible)&&i.push(s)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){let n=this.ctx,i=t._clip,o=!i.disabled,a=eA(t,this.chartArea),s={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(o&&vs(n,{left:i.left===!1?0:a.left-i.left,right:i.right===!1?this.width:a.right+i.right,top:i.top===!1?0:a.top-i.top,bottom:i.bottom===!1?this.height:a.bottom+i.bottom}),t.controller.draw(),o&&xs(n),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return Zn(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,o){let a=nR.modes[n];return typeof a=="function"?a(this,t,i,o):[]}getDatasetMeta(t){let n=this.data.datasets[t],i=this._metasets,o=i.filter(a=>a&&a._dataset===n).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=Tr(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){let n=this.data.datasets[t];if(!n)return!1;let i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){let i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){let o=i?"show":"hide",a=this.getDatasetMeta(t),s=a.controller._resolveAnimations(void 0,o);oa(n)?(a.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),s.update(a,{visible:i}),this.update(u=>u.datasetIndex===t?o:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){let n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),Pr.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Xd(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete Uc[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let t=this._listeners,n=this.platform,i=(a,s)=>{n.addEventListener(this,a,s),t[a]=s},o=(a,s,u)=>{a.offsetX=s,a.offsetY=u,this._eventHandler(a)};Ot(this.options.events,a=>i(a,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let t=this._responsiveListeners,n=this.platform,i=(c,l)=>{n.addEventListener(this,c,l),t[c]=l},o=(c,l)=>{t[c]&&(n.removeEventListener(this,c,l),delete t[c])},a=(c,l)=>{this.canvas&&this.resize(c,l)},s,u=()=>{o("attach",u),this.attached=!0,this.resize(),i("resize",a),i("detach",s)};s=()=>{this.attached=!1,o("resize",a),this._stop(),this._resize(0,0),i("attach",u)},n.isAttached(this.canvas)?u():s()}unbindEvents(){Ot(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},Ot(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){let o=i?"set":"remove",a,s,u,c;for(n==="dataset"&&(a=this.getDatasetMeta(t[0].datasetIndex),a.controller["_"+o+"DatasetHoverStyle"]()),u=0,c=t.length;u<c;++u){s=t[u];let l=s&&this.getDatasetMeta(s.datasetIndex).controller;l&&l[o+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){let n=this._active||[],i=t.map(({datasetIndex:a,index:s})=>{let u=this.getDatasetMeta(a);if(!u)throw new Error("No dataset found at index "+a);return{datasetIndex:a,element:u.data[s],index:s}});!ms(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){let o=this.options.hover,a=(c,l)=>c.filter(h=>!l.some(d=>h.datasetIndex===d.datasetIndex&&h.index===d.index)),s=a(n,t),u=i?t:a(t,n);s.length&&this.updateHoverStyle(s,o.mode,!1),u.length&&o.mode&&this.updateHoverStyle(u,o.mode,!0)}_eventHandler(t,n){let i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},o=s=>(s.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,o)===!1)return;let a=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(a||i.changed)&&this.render(),this}_handleEvent(t,n,i){let{_active:o=[],options:a}=this,s=n,u=this._getActiveElements(t,o,i,s),c=Bb(t),l=tA(t,this._lastEvent,i,c);i&&(this._lastEvent=null,Ht(a.onHover,[t,u,this],this),c&&Ht(a.onClick,[t,u,this],this));let h=!ms(u,o);return(h||n)&&(this._active=u,this._updateHoverStyles(u,o,n)),this._lastEvent=l,h}_getActiveElements(t,n,i,o){if(t.type==="mouseout")return[];if(!i)return n;let a=this.options.hover;return this.getElementsAtEventForMode(t,a.mode,a,o)}}return r})();function By(){return Ot(Yc.instances,r=>r._plugins.invalidate())}function nA(r,e,t){let{startAngle:n,pixelMargin:i,x:o,y:a,outerRadius:s,innerRadius:u}=e,c=i/s;r.beginPath(),r.arc(o,a,s,n-c,t+c),u>i?(c=i/u,r.arc(o,a,u,t+c,n-c,!0)):r.arc(o,a,i,t+ce,n-ce),r.closePath(),r.clip()}function rA(r){return Rc(r,["outerStart","outerEnd","innerStart","innerEnd"])}function iA(r,e,t,n){let i=rA(r.options.borderRadius),o=(t-e)/2,a=Math.min(o,n*e/2),s=u=>{let c=(t-Math.min(o,u))*n/2;return we(u,0,Math.min(o,c))};return{outerStart:s(i.outerStart),outerEnd:s(i.outerEnd),innerStart:we(i.innerStart,0,a),innerEnd:we(i.innerEnd,0,a)}}function ha(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function qc(r,e,t,n,i,o){let{x:a,y:s,startAngle:u,pixelMargin:c,innerRadius:l}=e,h=Math.max(e.outerRadius+n+t-c,0),d=l>0?l+n+t+c:0,f=0,p=i-u;if(n){let O=l>0?l-n:0,V=h>0?h-n:0,z=(O+V)/2,U=z!==0?p*z/(z+n):p;f=(p-U)/2}let m=Math.max(.001,p*h-t/Kt)/h,g=(p-m)/2,v=u+g+f,x=i-g-f,{outerStart:w,outerEnd:b,innerStart:y,innerEnd:_}=iA(e,d,h,x-v),S=h-w,C=h-b,E=v+w/S,I=x-b/C,A=d+y,R=d+_,L=v+y/A,B=x-_/R;if(r.beginPath(),o){let O=(E+I)/2;if(r.arc(a,s,h,E,O),r.arc(a,s,h,O,I),b>0){let H=ha(C,I,a,s);r.arc(H.x,H.y,b,I,x+ce)}let V=ha(R,x,a,s);if(r.lineTo(V.x,V.y),_>0){let H=ha(R,B,a,s);r.arc(H.x,H.y,_,x+ce,B+Math.PI)}let z=(x-_/d+(v+y/d))/2;if(r.arc(a,s,d,x-_/d,z,!0),r.arc(a,s,d,z,v+y/d,!0),y>0){let H=ha(A,L,a,s);r.arc(H.x,H.y,y,L+Math.PI,v-ce)}let U=ha(S,v,a,s);if(r.lineTo(U.x,U.y),w>0){let H=ha(S,E,a,s);r.arc(H.x,H.y,w,v-ce,E)}}else{r.moveTo(a,s);let O=Math.cos(E)*h+a,V=Math.sin(E)*h+s;r.lineTo(O,V);let z=Math.cos(I)*h+a,U=Math.sin(I)*h+s;r.lineTo(z,U)}r.closePath()}function oA(r,e,t,n,i){let{fullCircles:o,startAngle:a,circumference:s}=e,u=e.endAngle;if(o){qc(r,e,t,n,u,i);for(let c=0;c<o;++c)r.fill();isNaN(s)||(u=a+(s%Yt||Yt))}return qc(r,e,t,n,u,i),r.fill(),u}function aA(r,e,t,n,i){let{fullCircles:o,startAngle:a,circumference:s,options:u}=e,{borderWidth:c,borderJoinStyle:l,borderDash:h,borderDashOffset:d}=u,f=u.borderAlign==="inner";if(!c)return;r.setLineDash(h||[]),r.lineDashOffset=d,f?(r.lineWidth=c*2,r.lineJoin=l||"round"):(r.lineWidth=c,r.lineJoin=l||"bevel");let p=e.endAngle;if(o){qc(r,e,t,n,p,i);for(let m=0;m<o;++m)r.stroke();isNaN(s)||(p=a+(s%Yt||Yt))}f&&nA(r,e,p),o||(qc(r,e,t,n,p,i),r.stroke())}var kf=class extends Fn{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){let i=this.getProps(["x","y"],n),{angle:o,distance:a}=Bd(i,{x:e,y:t}),{startAngle:s,endAngle:u,innerRadius:c,outerRadius:l,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),d=(this.options.spacing+this.options.borderWidth)/2,p=gt(h,u-s)>=Yt||sa(o,s,u),m=er(a,c+d,l+d);return p&&m}getCenterPoint(e){let{x:t,y:n,startAngle:i,endAngle:o,innerRadius:a,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:u,spacing:c}=this.options,l=(i+o)/2,h=(a+s+c+u)/2;return{x:t+Math.cos(l)*h,y:n+Math.sin(l)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){let{options:t,circumference:n}=this,i=(t.offset||0)/4,o=(t.spacing||0)/2,a=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=n>Yt?Math.floor(n/Yt):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();let s=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(s)*i,Math.sin(s)*i);let u=1-Math.sin(Math.min(Kt,n||0)),c=i*u;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,oA(e,this,c,o,a),aA(e,this,c,o,a),e.restore()}};function _1(r,e,t=e){r.lineCap=gt(t.borderCapStyle,e.borderCapStyle),r.setLineDash(gt(t.borderDash,e.borderDash)),r.lineDashOffset=gt(t.borderDashOffset,e.borderDashOffset),r.lineJoin=gt(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=gt(t.borderWidth,e.borderWidth),r.strokeStyle=gt(t.borderColor,e.borderColor)}function sA(r,e,t){r.lineTo(t.x,t.y)}function uA(r){return r.stepped?$b:r.tension||r.cubicInterpolationMode==="monotone"?Jb:sA}function C1(r,e,t={}){let n=r.length,{start:i=0,end:o=n-1}=t,{start:a,end:s}=e,u=Math.max(i,a),c=Math.min(o,s),l=i<a&&o<a||i>s&&o>s;return{count:n,start:u,loop:e.loop,ilen:c<u&&!l?n+c-u:c-u}}function cA(r,e,t,n){let{points:i,options:o}=e,{count:a,start:s,loop:u,ilen:c}=C1(i,t,n),l=uA(o),{move:h=!0,reverse:d}=n||{},f,p,m;for(f=0;f<=c;++f)p=i[(s+(d?c-f:f))%a],!p.skip&&(h?(r.moveTo(p.x,p.y),h=!1):l(r,m,p,d,o.stepped),m=p);return u&&(p=i[(s+(d?c:0))%a],l(r,m,p,d,o.stepped)),!!u}function lA(r,e,t,n){let i=e.points,{count:o,start:a,ilen:s}=C1(i,t,n),{move:u=!0,reverse:c}=n||{},l=0,h=0,d,f,p,m,g,v,x=b=>(a+(c?s-b:b))%o,w=()=>{m!==g&&(r.lineTo(l,g),r.lineTo(l,m),r.lineTo(l,v))};for(u&&(f=i[x(0)],r.moveTo(f.x,f.y)),d=0;d<=s;++d){if(f=i[x(d)],f.skip)continue;let b=f.x,y=f.y,_=b|0;_===p?(y<m?m=y:y>g&&(g=y),l=(h*l+b)/++h):(w(),r.lineTo(b,y),p=_,h=0,m=g=y),v=y}w()}function If(r){let e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?lA:cA}function hA(r){return r.stepped?ay:r.tension||r.cubicInterpolationMode==="monotone"?sy:oi}function dA(r,e,t,n){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,n)&&i.closePath()),_1(r,e.options),r.stroke(i)}function fA(r,e,t,n){let{segments:i,options:o}=e,a=If(e);for(let s of i)_1(r,o,s.style),r.beginPath(),a(r,e,s,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}var pA=typeof Path2D=="function";function mA(r,e,t,n){pA&&!e.options.segment?dA(r,e,t,n):fA(r,e,t,n)}var $c=(()=>{class r extends Fn{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){let i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){let o=i.spanGaps?this._loop:this._fullLoop;ry(this._points,i,t,o,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=cy(this,this.options.segment))}first(){let t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){let t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){let i=this.options,o=t[n],a=this.points,s=af(this,{property:n,start:o,end:o});if(!s.length)return;let u=[],c=hA(i),l,h;for(l=0,h=s.length;l<h;++l){let{start:d,end:f}=s[l],p=a[d],m=a[f];if(p===m){u.push(p);continue}let g=Math.abs((o-p[n])/(m[n]-p[n])),v=c(p,m,g,i.stepped);v[n]=t[n],u.push(v)}return u.length===1?u[0]:u}pathSegment(t,n,i){return If(this)(t,this,n,i)}path(t,n,i){let o=this.segments,a=If(this),s=this._loop;n=n||0,i=i||this.points.length-n;for(let u of o)s&=a(t,this,u,{start:n,end:n+i-1});return!!s}draw(t,n,i,o){let a=this.options||{};(this.points||[]).length&&a.borderWidth&&(t.save(),mA(t,this,i,o),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return r})();function Wy(r,e,t,n){let i=r.options,{[t]:o}=r.getProps([t],n);return Math.abs(e-o)<i.radius+i.hitRadius}var gA=(()=>{class r extends Fn{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,i){let o=this.options,{x:a,y:s}=this.getProps(["x","y"],i);return Math.pow(t-a,2)+Math.pow(n-s,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(t,n){return Wy(this,t,"x",n)}inYRange(t,n){return Wy(this,t,"y",n)}getCenterPoint(t){let{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);let i=n&&t.borderWidth||0;return(n+i)*2}draw(t,n){let i=this.options;this.skip||i.radius<.1||!Zn(this,n,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Mc(t,i,this.x,this.y))}getRange(){let t=this.options||{};return t.radius+t.hitRadius}}return r})();function S1(r,e){let{x:t,y:n,base:i,width:o,height:a}=r.getProps(["x","y","base","width","height"],e),s,u,c,l,h;return r.horizontal?(h=a/2,s=Math.min(t,i),u=Math.max(t,i),c=n-h,l=n+h):(h=o/2,s=t-h,u=t+h,c=Math.min(n,i),l=Math.max(n,i)),{left:s,top:c,right:u,bottom:l}}function hi(r,e,t,n){return r?0:we(e,t,n)}function vA(r,e,t){let n=r.options.borderWidth,i=r.borderSkipped,o=Yd(n);return{t:hi(i.top,o.top,0,t),r:hi(i.right,o.right,0,e),b:hi(i.bottom,o.bottom,0,t),l:hi(i.left,o.left,0,e)}}function xA(r,e,t){let{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),i=r.options.borderRadius,o=ci(i),a=Math.min(e,t),s=r.borderSkipped,u=n||wt(i);return{topLeft:hi(!u||s.top||s.left,o.topLeft,0,a),topRight:hi(!u||s.top||s.right,o.topRight,0,a),bottomLeft:hi(!u||s.bottom||s.left,o.bottomLeft,0,a),bottomRight:hi(!u||s.bottom||s.right,o.bottomRight,0,a)}}function bA(r){let e=S1(r),t=e.right-e.left,n=e.bottom-e.top,i=vA(r,t/2,n/2),o=xA(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:o},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:n-i.t-i.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,o.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(i.b,i.r))}}}}function ff(r,e,t,n){let i=e===null,o=t===null,s=r&&!(i&&o)&&S1(r,n);return s&&(i||er(e,s.left,s.right))&&(o||er(t,s.top,s.bottom))}function yA(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function wA(r,e){r.rect(e.x,e.y,e.w,e.h)}function pf(r,e,t={}){let n=r.x!==t.x?-e:0,i=r.y!==t.y?-e:0,o=(r.x+r.w!==t.x+t.w?e:0)-n,a=(r.y+r.h!==t.y+t.h?e:0)-i;return{x:r.x+n,y:r.y+i,w:r.w+o,h:r.h+a,radius:r.radius}}var Mf=class extends Fn{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){let{inflateAmount:t,options:{borderColor:n,backgroundColor:i}}=this,{inner:o,outer:a}=bA(this),s=yA(a.radius)?ca:wA;e.save(),(a.w!==o.w||a.h!==o.h)&&(e.beginPath(),s(e,pf(a,t,o)),e.clip(),s(e,pf(o,-t,a)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),s(e,pf(o,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,n){return ff(this,e,t,n)}inXRange(e,t){return ff(this,e,null,t)}inYRange(e,t){return ff(this,null,e,t)}getCenterPoint(e){let{x:t,y:n,base:i,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(t+i)/2:t,y:o?n:(n+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}},_A=Object.freeze({__proto__:null,ArcElement:kf,BarElement:Mf,LineElement:$c,PointElement:gA}),Rf=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],zy=Rf.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function E1(r){return Rf[r%Rf.length]}function k1(r){return zy[r%zy.length]}function CA(r,e){return r.borderColor=E1(e),r.backgroundColor=k1(e),++e}function SA(r,e){return r.backgroundColor=r.data.map(()=>E1(e++)),e}function EA(r,e){return r.backgroundColor=r.data.map(()=>k1(e++)),e}function kA(r){let e=0;return(t,n)=>{let i=r.getDatasetMeta(n).controller;i instanceof Lf?e=SA(t,e):i instanceof f1?e=EA(t,e):i&&(e=CA(t,e))}}function Vy(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function IA(r){return r&&(r.borderColor||r.backgroundColor)}var MA={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;let{data:{datasets:n},options:i}=r.config,{elements:o}=i;if(!t.forceOverride&&(Vy(n)||IA(i)||o&&Vy(o)))return;let a=kA(r);n.forEach(a)}};function RA(r,e,t,n,i){let o=i.samples||n;if(o>=t)return r.slice(e,e+t);let a=[],s=(t-2)/(o-2),u=0,c=e+t-1,l=e,h,d,f,p,m;for(a[u++]=r[l],h=0;h<o-2;h++){let g=0,v=0,x,w=Math.floor((h+1)*s)+1+e,b=Math.min(Math.floor((h+2)*s)+1,t)+e,y=b-w;for(x=w;x<b;x++)g+=r[x].x,v+=r[x].y;g/=y,v/=y;let _=Math.floor(h*s)+1+e,S=Math.min(Math.floor((h+1)*s)+1,t)+e,{x:C,y:E}=r[l];for(f=p=-1,x=_;x<S;x++)p=.5*Math.abs((C-g)*(r[x].y-E)-(C-r[x].x)*(v-E)),p>f&&(f=p,d=r[x],m=x);a[u++]=d,l=m}return a[u++]=r[c],a}function AA(r,e,t,n){let i=0,o=0,a,s,u,c,l,h,d,f,p,m,g=[],v=e+t-1,x=r[e].x,b=r[v].x-x;for(a=e;a<e+t;++a){s=r[a],u=(s.x-x)/b*n,c=s.y;let y=u|0;if(y===l)c<p?(p=c,h=a):c>m&&(m=c,d=a),i=(o*i+s.x)/++o;else{let _=a-1;if(!Mt(h)&&!Mt(d)){let S=Math.min(h,d),C=Math.max(h,d);S!==f&&S!==_&&g.push(ur(sr({},r[S]),{x:i})),C!==f&&C!==_&&g.push(ur(sr({},r[C]),{x:i}))}a>0&&_!==f&&g.push(r[_]),g.push(s),l=y,o=0,p=m=c,h=d=f=a}}return g}function I1(r){if(r._decimated){let e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function Uy(r){r.data.datasets.forEach(e=>{I1(e)})}function DA(r,e){let t=e.length,n=0,i,{iScale:o}=r,{min:a,max:s,minDefined:u,maxDefined:c}=o.getUserBounds();return u&&(n=we(Qn(e,o.axis,a).lo,0,t-1)),c?i=we(Qn(e,o.axis,s).hi+1,n,t)-n:i=t-n,{start:n,count:i}}var TA={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){Uy(r);return}let n=r.width;r.data.datasets.forEach((i,o)=>{let{_data:a,indexAxis:s}=i,u=r.getDatasetMeta(o),c=a||i.data;if(la([s,r.options.indexAxis])==="y"||!u.controller.supportsDecimation)return;let l=r.scales[u.xAxisID];if(l.type!=="linear"&&l.type!=="time"||r.options.parsing)return;let{start:h,count:d}=DA(u,c),f=t.threshold||4*n;if(d<=f){I1(i);return}Mt(a)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(t.algorithm){case"lttb":p=RA(c,h,d,n,t);break;case"min-max":p=AA(c,h,d,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}i._decimated=p})},destroy(r){Uy(r)}};function PA(r,e,t){let n=r.segments,i=r.points,o=e.points,a=[];for(let s of n){let{start:u,end:c}=s;c=Bf(u,c,i);let l=Af(t,i[u],i[c],s.loop);if(!e.segments){a.push({source:s,target:l,start:i[u],end:i[c]});continue}let h=af(e,l);for(let d of h){let f=Af(t,o[d.start],o[d.end],d.loop),p=of(s,i,f);for(let m of p)a.push({source:m,target:d,start:{[t]:jy(l,f,"start",Math.max)},end:{[t]:jy(l,f,"end",Math.min)}})}}return a}function Af(r,e,t,n){if(n)return;let i=e[r],o=t[r];return r==="angle"&&(i=nn(i),o=nn(o)),{property:r,start:i,end:o}}function FA(r,e){let{x:t=null,y:n=null}=r||{},i=e.points,o=[];return e.segments.forEach(({start:a,end:s})=>{s=Bf(a,s,i);let u=i[a],c=i[s];n!==null?(o.push({x:u.x,y:n}),o.push({x:c.x,y:n})):t!==null&&(o.push({x:t,y:u.y}),o.push({x:t,y:c.y}))}),o}function Bf(r,e,t){for(;e>r;e--){let n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function jy(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function M1(r,e){let t=[],n=!1;return Xt(r)?(n=!0,t=r):t=FA(r,e),t.length?new $c({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function Hy(r){return r&&r.fill!==!1}function OA(r,e,t){let i=r[e].fill,o=[e],a;if(!t)return i;for(;i!==!1&&o.indexOf(i)===-1;){if(!ie(i))return i;if(a=r[i],!a)return!1;if(a.visible)return i;o.push(i),i=a.fill}return!1}function NA(r,e,t){let n=zA(r);if(wt(n))return isNaN(n.value)?!1:n;let i=parseFloat(n);return ie(i)&&Math.floor(i)===i?LA(n[0],e,i,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function LA(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function BA(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:wt(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function WA(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:wt(r)?n=r.value:n=e.getBaseValue(),n}function zA(r){let e=r.options,t=e.fill,n=gt(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function VA(r){let{scale:e,index:t,line:n}=r,i=[],o=n.segments,a=n.points,s=UA(e,t);s.push(M1({x:null,y:e.bottom},n));for(let u=0;u<o.length;u++){let c=o[u];for(let l=c.start;l<=c.end;l++)jA(i,a[l],s)}return new $c({points:i,options:{}})}function UA(r,e){let t=[],n=r.getMatchingVisibleMetas("line");for(let i=0;i<n.length;i++){let o=n[i];if(o.index===e)break;o.hidden||t.unshift(o.dataset)}return t}function jA(r,e,t){let n=[];for(let i=0;i<t.length;i++){let o=t[i],{first:a,last:s,point:u}=HA(o,e,"x");if(!(!u||a&&s)){if(a)n.unshift(u);else if(r.push(u),!s)break}}r.push(...n)}function HA(r,e,t){let n=r.interpolate(e,t);if(!n)return{};let i=n[t],o=r.segments,a=r.points,s=!1,u=!1;for(let c=0;c<o.length;c++){let l=o[c],h=a[l.start][t],d=a[l.end][t];if(er(i,h,d)){s=i===h,u=i===d;break}}return{first:s,last:u,point:n}}var Xc=class{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){let{x:i,y:o,radius:a}=this;return t=t||{start:0,end:Yt},e.arc(i,o,a,t.end,t.start,!0),!n.bounds}interpolate(e){let{x:t,y:n,radius:i}=this,o=e.angle;return{x:t+Math.cos(o)*i,y:n+Math.sin(o)*i,angle:o}}};function GA(r){let{chart:e,fill:t,line:n}=r;if(ie(t))return qA(e,t);if(t==="stack")return VA(r);if(t==="shape")return!0;let i=XA(r);return i instanceof Xc?i:M1(i,n)}function qA(r,e){let t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function XA(r){return(r.scale||{}).getPointPositionForValue?YA(r):KA(r)}function KA(r){let{scale:e={},fill:t}=r,n=BA(t,e);if(ie(n)){let i=e.isHorizontal();return{x:i?n:null,y:i?null:n}}return null}function YA(r){let{scale:e,fill:t}=r,n=e.options,i=e.getLabels().length,o=n.reverse?e.max:e.min,a=WA(t,e,o),s=[];if(n.grid.circular){let u=e.getPointPositionForValue(0,o);return new Xc({x:u.x,y:u.y,radius:e.getDistanceFromCenterForValue(a)})}for(let u=0;u<i;++u)s.push(e.getPointPositionForValue(u,a));return s}function mf(r,e,t){let n=GA(e),{line:i,scale:o,axis:a}=e,s=i.options,u=s.fill,c=s.backgroundColor,{above:l=c,below:h=c}=u||{};n&&i.points.length&&(vs(r,t),$A(r,{line:i,target:n,above:l,below:h,area:t,scale:o,axis:a}),xs(r))}function $A(r,e){let{line:t,target:n,above:i,below:o,area:a,scale:s}=e,u=t._loop?"angle":e.axis;r.save(),u==="x"&&o!==i&&(Gy(r,n,a.top),qy(r,{line:t,target:n,color:i,scale:s,property:u}),r.restore(),r.save(),Gy(r,n,a.bottom)),qy(r,{line:t,target:n,color:o,scale:s,property:u}),r.restore()}function Gy(r,e,t){let{segments:n,points:i}=e,o=!0,a=!1;r.beginPath();for(let s of n){let{start:u,end:c}=s,l=i[u],h=i[Bf(u,c,i)];o?(r.moveTo(l.x,l.y),o=!1):(r.lineTo(l.x,t),r.lineTo(l.x,l.y)),a=!!e.pathSegment(r,s,{move:a}),a?r.closePath():r.lineTo(h.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function qy(r,e){let{line:t,target:n,property:i,color:o,scale:a}=e,s=PA(t,n,i);for(let{source:u,target:c,start:l,end:h}of s){let{style:{backgroundColor:d=o}={}}=u,f=n!==!0;r.save(),r.fillStyle=d,JA(r,a,f&&Af(i,l,h)),r.beginPath();let p=!!t.pathSegment(r,u),m;if(f){p?r.closePath():Xy(r,n,h,i);let g=!!n.pathSegment(r,c,{move:p,reverse:!0});m=p&&g,m||Xy(r,n,l,i)}r.closePath(),r.fill(m?"evenodd":"nonzero"),r.restore()}}function JA(r,e,t){let{top:n,bottom:i}=e.chart.chartArea,{property:o,start:a,end:s}=t||{};o==="x"&&(r.beginPath(),r.rect(a,n,s-a,i-n),r.clip())}function Xy(r,e,t,n){let i=e.interpolate(t,n);i&&r.lineTo(i.x,i.y)}var QA={id:"filler",afterDatasetsUpdate(r,e,t){let n=(r.data.datasets||[]).length,i=[],o,a,s,u;for(a=0;a<n;++a)o=r.getDatasetMeta(a),s=o.dataset,u=null,s&&s.options&&s instanceof $c&&(u={visible:r.isDatasetVisible(a),index:a,fill:NA(s,a,n),chart:r,axis:o.controller.options.indexAxis,scale:o.vScale,line:s}),o.$filler=u,i.push(u);for(a=0;a<n;++a)u=i[a],!(!u||u.fill===!1)&&(u.fill=OA(i,a,t.propagate))},beforeDraw(r,e,t){let n=t.drawTime==="beforeDraw",i=r.getSortedVisibleDatasetMetas(),o=r.chartArea;for(let a=i.length-1;a>=0;--a){let s=i[a].$filler;s&&(s.line.updateControlPoints(o,s.axis),n&&s.fill&&mf(r.ctx,s,o))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;let n=r.getSortedVisibleDatasetMetas();for(let i=n.length-1;i>=0;--i){let o=n[i].$filler;Hy(o)&&mf(r.ctx,o,r.chartArea)}},beforeDatasetDraw(r,e,t){let n=e.meta.$filler;!Hy(n)||t.drawTime!=="beforeDatasetDraw"||mf(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},Ky=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},ZA=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index,Kc=class extends Fn{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let e=this.options.labels||{},t=Ht(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,i)=>e.sort(n,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){let{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}let n=e.labels,i=ve(n.font),o=i.size,a=this._computeTitleHeight(),{boxWidth:s,itemHeight:u}=Ky(n,o),c,l;t.font=i.string,this.isHorizontal()?(c=this.maxWidth,l=this._fitRows(a,o,s,u)+10):(l=this.maxHeight,c=this._fitCols(a,i,s,u)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(l,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,i){let{ctx:o,maxWidth:a,options:{labels:{padding:s}}}=this,u=this.legendHitBoxes=[],c=this.lineWidths=[0],l=i+s,h=e;o.textAlign="left",o.textBaseline="middle";let d=-1,f=-l;return this.legendItems.forEach((p,m)=>{let g=n+t/2+o.measureText(p.text).width;(m===0||c[c.length-1]+g+2*s>a)&&(h+=l,c[c.length-(m>0?0:1)]=0,f+=l,d++),u[m]={left:0,top:f,row:d,width:g,height:i},c[c.length-1]+=g+s}),h}_fitCols(e,t,n,i){let{ctx:o,maxHeight:a,options:{labels:{padding:s}}}=this,u=this.legendHitBoxes=[],c=this.columnSizes=[],l=a-e,h=s,d=0,f=0,p=0,m=0;return this.legendItems.forEach((g,v)=>{let{itemWidth:x,itemHeight:w}=tD(n,t,o,g,i);v>0&&f+w+2*s>l&&(h+=d+s,c.push({width:d,height:f}),p+=d+s,m++,d=f=0),u[v]={left:p,top:f,col:m,width:x,height:w},d=Math.max(d,x),f+=w+s}),h+=d,c.push({width:d,height:f}),h}adjustHitBoxes(){if(!this.options.display)return;let e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:i},rtl:o}}=this,a=Hi(o,this.left,this.width);if(this.isHorizontal()){let s=0,u=Fe(n,this.left+i,this.right-this.lineWidths[s]);for(let c of t)s!==c.row&&(s=c.row,u=Fe(n,this.left+i,this.right-this.lineWidths[s])),c.top+=this.top+e+i,c.left=a.leftForLtr(a.x(u),c.width),u+=c.width+i}else{let s=0,u=Fe(n,this.top+e+i,this.bottom-this.columnSizes[s].height);for(let c of t)c.col!==s&&(s=c.col,u=Fe(n,this.top+e+i,this.bottom-this.columnSizes[s].height)),c.top=u,c.left+=this.left+i,c.left=a.leftForLtr(a.x(c.left),c.width),u+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let e=this.ctx;vs(e,this),this._draw(),xs(e)}}_draw(){let{options:e,columnSizes:t,lineWidths:n,ctx:i}=this,{align:o,labels:a}=e,s=oe.color,u=Hi(e.rtl,this.left,this.width),c=ve(a.font),{padding:l}=a,h=c.size,d=h/2,f;this.drawTitle(),i.textAlign=u.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;let{boxWidth:p,boxHeight:m,itemHeight:g}=Ky(a,h),v=function(_,S,C){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;i.save();let E=gt(C.lineWidth,1);if(i.fillStyle=gt(C.fillStyle,s),i.lineCap=gt(C.lineCap,"butt"),i.lineDashOffset=gt(C.lineDashOffset,0),i.lineJoin=gt(C.lineJoin,"miter"),i.lineWidth=E,i.strokeStyle=gt(C.strokeStyle,s),i.setLineDash(gt(C.lineDash,[])),a.usePointStyle){let I={radius:m*Math.SQRT2/2,pointStyle:C.pointStyle,rotation:C.rotation,borderWidth:E},A=u.xPlus(_,p/2),R=S+d;Kd(i,I,A,R,a.pointStyleWidth&&p)}else{let I=S+Math.max((h-m)/2,0),A=u.leftForLtr(_,p),R=ci(C.borderRadius);i.beginPath(),Object.values(R).some(L=>L!==0)?ca(i,{x:A,y:I,w:p,h:m,radius:R}):i.rect(A,I,p,m),i.fill(),E!==0&&i.stroke()}i.restore()},x=function(_,S,C){ui(i,C.text,_,S+g/2,c,{strikethrough:C.hidden,textAlign:u.textAlign(C.textAlign)})},w=this.isHorizontal(),b=this._computeTitleHeight();w?f={x:Fe(o,this.left+l,this.right-n[0]),y:this.top+l+b,line:0}:f={x:this.left+l,y:Fe(o,this.top+b+l,this.bottom-t[0].height),line:0},nf(this.ctx,e.textDirection);let y=g+l;this.legendItems.forEach((_,S)=>{i.strokeStyle=_.fontColor,i.fillStyle=_.fontColor;let C=i.measureText(_.text).width,E=u.textAlign(_.textAlign||(_.textAlign=a.textAlign)),I=p+d+C,A=f.x,R=f.y;u.setWidth(this.width),w?S>0&&A+I+l>this.right&&(R=f.y+=y,f.line++,A=f.x=Fe(o,this.left+l,this.right-n[f.line])):S>0&&R+y>this.bottom&&(A=f.x=A+t[f.line].width+l,f.line++,R=f.y=Fe(o,this.top+b+l,this.bottom-t[f.line].height));let L=u.x(A);if(v(L,R,_),A=Xb(E,A+p+d,w?A+I:this.right,e.rtl),x(u.x(A),R,_),w)f.x+=I+l;else if(typeof _.text!="string"){let B=c.lineHeight;f.y+=R1(_,B)+l}else f.y+=y}),rf(this.ctx,e.textDirection)}drawTitle(){let e=this.options,t=e.title,n=ve(t.font),i=Oe(t.padding);if(!t.display)return;let o=Hi(e.rtl,this.left,this.width),a=this.ctx,s=t.position,u=n.size/2,c=i.top+u,l,h=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),l=this.top+c,h=Fe(e.align,h,this.right-d);else{let p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);l=c+Fe(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}let f=Fe(s,h,h+d);a.textAlign=o.textAlign(kc(s)),a.textBaseline="middle",a.strokeStyle=t.color,a.fillStyle=t.color,a.font=n.string,ui(a,t.text,f,l,n)}_computeTitleHeight(){let e=this.options.title,t=ve(e.font),n=Oe(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,i,o;if(er(e,this.left,this.right)&&er(t,this.top,this.bottom)){for(o=this.legendHitBoxes,n=0;n<o.length;++n)if(i=o[n],er(e,i.left,i.left+i.width)&&er(t,i.top,i.top+i.height))return this.legendItems[n]}return null}handleEvent(e){let t=this.options;if(!rD(e.type,t))return;let n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){let i=this._hoveredItem,o=ZA(i,n);i&&!o&&Ht(t.onLeave,[e,i,this],this),this._hoveredItem=n,n&&!o&&Ht(t.onHover,[e,n,this],this)}else n&&Ht(t.onClick,[e,n,this],this)}};function tD(r,e,t,n,i){let o=eD(n,r,e,t),a=nD(i,n,e.lineHeight);return{itemWidth:o,itemHeight:a}}function eD(r,e,t,n){let i=r.text;return i&&typeof i!="string"&&(i=i.reduce((o,a)=>o.length>a.length?o:a)),e+t.size/2+n.measureText(i).width}function nD(r,e,t){let n=r;return typeof e.text!="string"&&(n=R1(e,t)),n}function R1(r,e){let t=r.text?r.text.length:0;return e*t}function rD(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var iD={id:"legend",_element:Kc,start(r,e,t){let n=r.legend=new Kc({ctx:r.ctx,options:t,chart:r});Ue.configure(r,n,t),Ue.addBox(r,n)},stop(r){Ue.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){let n=r.legend;Ue.configure(r,n,t),n.options=t},afterUpdate(r){let e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){let n=e.datasetIndex,i=t.chart;i.isDatasetVisible(n)?(i.hide(n),e.hidden=!0):(i.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){let e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:i,color:o,useBorderRadius:a,borderRadius:s}}=r.legend.options;return r._getSortedDatasetMetas().map(u=>{let c=u.controller.getStyle(t?0:void 0),l=Oe(c.borderWidth);return{text:e[u.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!u.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(l.width+l.height)/4,strokeStyle:c.borderColor,pointStyle:n||c.pointStyle,rotation:c.rotation,textAlign:i||c.textAlign,borderRadius:a&&(s||c.borderRadius),datasetIndex:u.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}},Is=class extends Fn{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){let n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;let i=Xt(n.text)?n.text.length:1;this._padding=Oe(n.padding);let o=i*ve(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){let e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){let{top:t,left:n,bottom:i,right:o,options:a}=this,s=a.align,u=0,c,l,h;return this.isHorizontal()?(l=Fe(s,n,o),h=t+e,c=o-n):(a.position==="left"?(l=n+e,h=Fe(s,i,t),u=Kt*-.5):(l=o-e,h=Fe(s,t,i),u=Kt*.5),c=i-t),{titleX:l,titleY:h,maxWidth:c,rotation:u}}draw(){let e=this.ctx,t=this.options;if(!t.display)return;let n=ve(t.font),o=n.lineHeight/2+this._padding.top,{titleX:a,titleY:s,maxWidth:u,rotation:c}=this._drawArgs(o);ui(e,t.text,0,0,n,{color:t.color,maxWidth:u,rotation:c,textAlign:kc(t.align),textBaseline:"middle",translation:[a,s]})}};function oD(r,e){let t=new Is({ctx:r.ctx,options:e,chart:r});Ue.configure(r,t,e),Ue.addBox(r,t),r.titleBlock=t}var aD={id:"title",_element:Is,start(r,e,t){oD(r,t)},stop(r){let e=r.titleBlock;Ue.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){let n=r.titleBlock;Ue.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Bc=new WeakMap,sD={id:"subtitle",start(r,e,t){let n=new Is({ctx:r.ctx,options:t,chart:r});Ue.configure(r,n,t),Ue.addBox(r,n),Bc.set(r,n)},stop(r){Ue.removeBox(r,Bc.get(r)),Bc.delete(r)},beforeUpdate(r,e,t){let n=Bc.get(r);Ue.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Es={average(r){if(!r.length)return!1;let e,t,n=new Set,i=0,o=0;for(e=0,t=r.length;e<t;++e){let s=r[e].element;if(s&&s.hasValue()){let u=s.tooltipPosition();n.add(u.x),i+=u.y,++o}}return{x:[...n].reduce((s,u)=>s+u)/n.size,y:i/o}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,i=Number.POSITIVE_INFINITY,o,a,s;for(o=0,a=r.length;o<a;++o){let u=r[o].element;if(u&&u.hasValue()){let c=u.getCenterPoint(),l=wc(e,c);l<i&&(i=l,s=u)}}if(s){let u=s.tooltipPosition();t=u.x,n=u.y}return{x:t,y:n}}};function nr(r,e){return e&&(Xt(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function Fr(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function uD(r,e){let{element:t,datasetIndex:n,index:i}=e,o=r.getDatasetMeta(n).controller,{label:a,value:s}=o.getLabelAndValue(i);return{chart:r,label:a,parsed:o.getParsed(i),raw:r.data.datasets[n].data[i],formattedValue:s,dataset:o.getDataset(),dataIndex:i,datasetIndex:n,element:t}}function Yy(r,e){let t=r.chart.ctx,{body:n,footer:i,title:o}=r,{boxWidth:a,boxHeight:s}=e,u=ve(e.bodyFont),c=ve(e.titleFont),l=ve(e.footerFont),h=o.length,d=i.length,f=n.length,p=Oe(e.padding),m=p.height,g=0,v=n.reduce((b,y)=>b+y.before.length+y.lines.length+y.after.length,0);if(v+=r.beforeBody.length+r.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),v){let b=e.displayColors?Math.max(s,u.lineHeight):u.lineHeight;m+=f*b+(v-f)*u.lineHeight+(v-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*l.lineHeight+(d-1)*e.footerSpacing);let x=0,w=function(b){g=Math.max(g,t.measureText(b).width+x)};return t.save(),t.font=c.string,Ot(r.title,w),t.font=u.string,Ot(r.beforeBody.concat(r.afterBody),w),x=e.displayColors?a+2+e.boxPadding:0,Ot(n,b=>{Ot(b.before,w),Ot(b.lines,w),Ot(b.after,w)}),x=0,t.font=l.string,Ot(r.footer,w),t.restore(),g+=p.width,{width:g,height:m}}function cD(r,e){let{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function lD(r,e,t,n){let{x:i,width:o}=n,a=t.caretSize+t.caretPadding;if(r==="left"&&i+o+a>e.width||r==="right"&&i-o-a<0)return!0}function hD(r,e,t,n){let{x:i,width:o}=t,{width:a,chartArea:{left:s,right:u}}=r,c="center";return n==="center"?c=i<=(s+u)/2?"left":"right":i<=o/2?c="left":i>=a-o/2&&(c="right"),lD(c,r,e,t)&&(c="center"),c}function $y(r,e,t){let n=t.yAlign||e.yAlign||cD(r,t);return{xAlign:t.xAlign||e.xAlign||hD(r,e,t,n),yAlign:n}}function dD(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function fD(r,e,t){let{y:n,height:i}=r;return e==="top"?n+=t:e==="bottom"?n-=i+t:n-=i/2,n}function Jy(r,e,t,n){let{caretSize:i,caretPadding:o,cornerRadius:a}=r,{xAlign:s,yAlign:u}=t,c=i+o,{topLeft:l,topRight:h,bottomLeft:d,bottomRight:f}=ci(a),p=dD(e,s),m=fD(e,u,c);return u==="center"?s==="left"?p+=c:s==="right"&&(p-=c):s==="left"?p-=Math.max(l,d)+i:s==="right"&&(p+=Math.max(h,f)+i),{x:we(p,0,n.width-e.width),y:we(m,0,n.height-e.height)}}function Wc(r,e,t){let n=Oe(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function Qy(r){return nr([],Fr(r))}function pD(r,e,t){return Tr(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function Zy(r,e){let t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}var A1={beforeTitle:tr,title(r){if(r.length>0){let e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:tr,beforeBody:tr,beforeLabel:tr,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");let t=r.formattedValue;return Mt(t)||(e+=t),e},labelColor(r){let t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){let t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:tr,afterBody:tr,beforeFooter:tr,footer:tr,afterFooter:tr};function on(r,e,t,n){let i=r[e].call(t,n);return typeof i>"u"?A1[e].call(t,n):i}var t1=(()=>{class r extends Fn{static positioners=Es;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let t=this._cachedAnimations;if(t)return t;let n=this.chart,i=this.options.setContext(this.getContext()),o=i.enabled&&n.options.animation&&i.animations,a=new jc(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(a)),a}getContext(){return this.$context||(this.$context=pD(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){let{callbacks:i}=n,o=on(i,"beforeTitle",this,t),a=on(i,"title",this,t),s=on(i,"afterTitle",this,t),u=[];return u=nr(u,Fr(o)),u=nr(u,Fr(a)),u=nr(u,Fr(s)),u}getBeforeBody(t,n){return Qy(on(n.callbacks,"beforeBody",this,t))}getBody(t,n){let{callbacks:i}=n,o=[];return Ot(t,a=>{let s={before:[],lines:[],after:[]},u=Zy(i,a);nr(s.before,Fr(on(u,"beforeLabel",this,a))),nr(s.lines,on(u,"label",this,a)),nr(s.after,Fr(on(u,"afterLabel",this,a))),o.push(s)}),o}getAfterBody(t,n){return Qy(on(n.callbacks,"afterBody",this,t))}getFooter(t,n){let{callbacks:i}=n,o=on(i,"beforeFooter",this,t),a=on(i,"footer",this,t),s=on(i,"afterFooter",this,t),u=[];return u=nr(u,Fr(o)),u=nr(u,Fr(a)),u=nr(u,Fr(s)),u}_createItems(t){let n=this._active,i=this.chart.data,o=[],a=[],s=[],u=[],c,l;for(c=0,l=n.length;c<l;++c)u.push(uD(this.chart,n[c]));return t.filter&&(u=u.filter((h,d,f)=>t.filter(h,d,f,i))),t.itemSort&&(u=u.sort((h,d)=>t.itemSort(h,d,i))),Ot(u,h=>{let d=Zy(t.callbacks,h);o.push(on(d,"labelColor",this,h)),a.push(on(d,"labelPointStyle",this,h)),s.push(on(d,"labelTextColor",this,h))}),this.labelColors=o,this.labelPointStyles=a,this.labelTextColors=s,this.dataPoints=u,u}update(t,n){let i=this.options.setContext(this.getContext()),o=this._active,a,s=[];if(!o.length)this.opacity!==0&&(a={opacity:0});else{let u=Es[i.position].call(this,o,this._eventPosition);s=this._createItems(i),this.title=this.getTitle(s,i),this.beforeBody=this.getBeforeBody(s,i),this.body=this.getBody(s,i),this.afterBody=this.getAfterBody(s,i),this.footer=this.getFooter(s,i);let c=this._size=Yy(this,i),l=Object.assign({},u,c),h=$y(this.chart,i,l),d=Jy(i,l,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,a={opacity:1,x:d.x,y:d.y,width:c.width,height:c.height,caretX:u.x,caretY:u.y}}this._tooltipItems=s,this.$context=void 0,a&&this._resolveAnimations().update(this,a),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,o){let a=this.getCaretPosition(t,i,o);n.lineTo(a.x1,a.y1),n.lineTo(a.x2,a.y2),n.lineTo(a.x3,a.y3)}getCaretPosition(t,n,i){let{xAlign:o,yAlign:a}=this,{caretSize:s,cornerRadius:u}=i,{topLeft:c,topRight:l,bottomLeft:h,bottomRight:d}=ci(u),{x:f,y:p}=t,{width:m,height:g}=n,v,x,w,b,y,_;return a==="center"?(y=p+g/2,o==="left"?(v=f,x=v-s,b=y+s,_=y-s):(v=f+m,x=v+s,b=y-s,_=y+s),w=v):(o==="left"?x=f+Math.max(c,h)+s:o==="right"?x=f+m-Math.max(l,d)-s:x=this.caretX,a==="top"?(b=p,y=b-s,v=x-s,w=x+s):(b=p+g,y=b+s,v=x+s,w=x-s),_=b),{x1:v,x2:x,x3:w,y1:b,y2:y,y3:_}}drawTitle(t,n,i){let o=this.title,a=o.length,s,u,c;if(a){let l=Hi(i.rtl,this.x,this.width);for(t.x=Wc(this,i.titleAlign,i),n.textAlign=l.textAlign(i.titleAlign),n.textBaseline="middle",s=ve(i.titleFont),u=i.titleSpacing,n.fillStyle=i.titleColor,n.font=s.string,c=0;c<a;++c)n.fillText(o[c],l.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+u,c+1===a&&(t.y+=i.titleMarginBottom-u)}}_drawColorBox(t,n,i,o,a){let s=this.labelColors[i],u=this.labelPointStyles[i],{boxHeight:c,boxWidth:l}=a,h=ve(a.bodyFont),d=Wc(this,"left",a),f=o.x(d),p=c<h.lineHeight?(h.lineHeight-c)/2:0,m=n.y+p;if(a.usePointStyle){let g={radius:Math.min(l,c)/2,pointStyle:u.pointStyle,rotation:u.rotation,borderWidth:1},v=o.leftForLtr(f,l)+l/2,x=m+c/2;t.strokeStyle=a.multiKeyBackground,t.fillStyle=a.multiKeyBackground,Mc(t,g,v,x),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,Mc(t,g,v,x)}else{t.lineWidth=wt(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;let g=o.leftForLtr(f,l),v=o.leftForLtr(o.xPlus(f,1),l-2),x=ci(s.borderRadius);Object.values(x).some(w=>w!==0)?(t.beginPath(),t.fillStyle=a.multiKeyBackground,ca(t,{x:g,y:m,w:l,h:c,radius:x}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),ca(t,{x:v,y:m+1,w:l-2,h:c-2,radius:x}),t.fill()):(t.fillStyle=a.multiKeyBackground,t.fillRect(g,m,l,c),t.strokeRect(g,m,l,c),t.fillStyle=s.backgroundColor,t.fillRect(v,m+1,l-2,c-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){let{body:o}=this,{bodySpacing:a,bodyAlign:s,displayColors:u,boxHeight:c,boxWidth:l,boxPadding:h}=i,d=ve(i.bodyFont),f=d.lineHeight,p=0,m=Hi(i.rtl,this.x,this.width),g=function(E){n.fillText(E,m.x(t.x+p),t.y+f/2),t.y+=f+a},v=m.textAlign(s),x,w,b,y,_,S,C;for(n.textAlign=s,n.textBaseline="middle",n.font=d.string,t.x=Wc(this,v,i),n.fillStyle=i.bodyColor,Ot(this.beforeBody,g),p=u&&v!=="right"?s==="center"?l/2+h:l+2+h:0,y=0,S=o.length;y<S;++y){for(x=o[y],w=this.labelTextColors[y],n.fillStyle=w,Ot(x.before,g),b=x.lines,u&&b.length&&(this._drawColorBox(n,t,y,m,i),f=Math.max(d.lineHeight,c)),_=0,C=b.length;_<C;++_)g(b[_]),f=d.lineHeight;Ot(x.after,g)}p=0,f=d.lineHeight,Ot(this.afterBody,g),t.y-=a}drawFooter(t,n,i){let o=this.footer,a=o.length,s,u;if(a){let c=Hi(i.rtl,this.x,this.width);for(t.x=Wc(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=c.textAlign(i.footerAlign),n.textBaseline="middle",s=ve(i.footerFont),n.fillStyle=i.footerColor,n.font=s.string,u=0;u<a;++u)n.fillText(o[u],c.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+i.footerSpacing}}drawBackground(t,n,i,o){let{xAlign:a,yAlign:s}=this,{x:u,y:c}=t,{width:l,height:h}=i,{topLeft:d,topRight:f,bottomLeft:p,bottomRight:m}=ci(o.cornerRadius);n.fillStyle=o.backgroundColor,n.strokeStyle=o.borderColor,n.lineWidth=o.borderWidth,n.beginPath(),n.moveTo(u+d,c),s==="top"&&this.drawCaret(t,n,i,o),n.lineTo(u+l-f,c),n.quadraticCurveTo(u+l,c,u+l,c+f),s==="center"&&a==="right"&&this.drawCaret(t,n,i,o),n.lineTo(u+l,c+h-m),n.quadraticCurveTo(u+l,c+h,u+l-m,c+h),s==="bottom"&&this.drawCaret(t,n,i,o),n.lineTo(u+p,c+h),n.quadraticCurveTo(u,c+h,u,c+h-p),s==="center"&&a==="left"&&this.drawCaret(t,n,i,o),n.lineTo(u,c+d),n.quadraticCurveTo(u,c,u+d,c),n.closePath(),n.fill(),o.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){let n=this.chart,i=this.$animations,o=i&&i.x,a=i&&i.y;if(o||a){let s=Es[t.position].call(this,this._active,this._eventPosition);if(!s)return;let u=this._size=Yy(this,t),c=Object.assign({},s,this._size),l=$y(n,t,c),h=Jy(t,c,l,n);(o._to!==h.x||a._to!==h.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=u.width,this.height=u.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){let n=this.options.setContext(this.getContext()),i=this.opacity;if(!i)return;this._updateAnimationTarget(n);let o={width:this.width,height:this.height},a={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;let s=Oe(n.padding),u=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&u&&(t.save(),t.globalAlpha=i,this.drawBackground(a,t,o,n),nf(t,n.textDirection),a.y+=s.top,this.drawTitle(a,t,n),this.drawBody(a,t,n),this.drawFooter(a,t,n),rf(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){let i=this._active,o=t.map(({datasetIndex:u,index:c})=>{let l=this.chart.getDatasetMeta(u);if(!l)throw new Error("Cannot find a dataset at index "+u);return{datasetIndex:u,element:l.data[c],index:c}}),a=!ms(i,o),s=this._positionChanged(o,n);(a||s)&&(this._active=o,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let o=this.options,a=this._active||[],s=this._getActiveElements(t,a,n,i),u=this._positionChanged(s,t),c=n||!ms(s,a)||u;return c&&(this._active=s,(o.enabled||o.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),c}_getActiveElements(t,n,i,o){let a=this.options;if(t.type==="mouseout")return[];if(!o)return n.filter(u=>this.chart.data.datasets[u.datasetIndex]&&this.chart.getDatasetMeta(u.datasetIndex).controller.getParsed(u.index)!==void 0);let s=this.chart.getElementsAtEventForMode(t,a.mode,a,i);return a.reverse&&s.reverse(),s}_positionChanged(t,n){let{caretX:i,caretY:o,options:a}=this,s=Es[a.position].call(this,t,n);return s!==!1&&(i!==s.x||o!==s.y)}}return r})(),mD={id:"tooltip",_element:t1,positioners:Es,afterInit(r,e,t){t&&(r.tooltip=new t1({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){let e=r.tooltip;if(e&&e._willRender()){let t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",ur(sr({},t),{cancelable:!0}))===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){let t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:A1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},gD=Object.freeze({__proto__:null,Colors:MA,Decimation:TA,Filler:QA,Legend:iD,SubTitle:sD,Title:aD,Tooltip:mD}),vD=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function xD(r,e,t,n){let i=r.indexOf(e);if(i===-1)return vD(r,e,t,n);let o=r.lastIndexOf(e);return i!==o?t:i}var bD=(r,e)=>r===null?null:we(Math.round(r),0,e);function e1(r){let e=this.getLabels();return r>=0&&r<e.length?e[r]:r}var yD=(()=>{class r extends Xi{static id="category";static defaults={ticks:{callback:e1}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){let n=this._addedLabels;if(n.length){let i=this.getLabels();for(let{index:o,label:a}of n)i[o]===a&&i.splice(o,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(Mt(t))return null;let i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:xD(i,t,gt(n,t),this._addedLabels),bD(n,i.length-1)}determineDataLimits(){let{minDefined:t,maxDefined:n}=this.getUserBounds(),{min:i,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){let t=this.min,n=this.max,i=this.options.offset,o=[],a=this.getLabels();a=t===0&&n===a.length-1?a:a.slice(t,n+1),this._valueRange=Math.max(a.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let s=t;s<=n;s++)o.push({value:s});return o}getLabelForValue(t){return e1.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){let n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}return r})();function wD(r,e){let t=[],{bounds:i,step:o,min:a,max:s,precision:u,count:c,maxTicks:l,maxDigits:h,includeBounds:d}=r,f=o||1,p=l-1,{min:m,max:g}=e,v=!Mt(a),x=!Mt(s),w=!Mt(c),b=(g-m)/(h+1),y=Od((g-m)/p/f)*f,_,S,C,E;if(y<1e-14&&!v&&!x)return[{value:m},{value:g}];E=Math.ceil(g/y)-Math.floor(m/y),E>p&&(y=Od(E*y/p/f)*f),Mt(u)||(_=Math.pow(10,u),y=Math.ceil(y*_)/_),i==="ticks"?(S=Math.floor(m/y)*y,C=Math.ceil(g/y)*y):(S=m,C=g),v&&x&&o&&zb((s-a)/o,y/1e3)?(E=Math.round(Math.min((s-a)/y,l)),y=(s-a)/E,S=a,C=s):w?(S=v?a:S,C=x?s:C,E=c-1,y=(C-S)/E):(E=(C-S)/y,aa(E,Math.round(E),y/1e3)?E=Math.round(E):E=Math.ceil(E));let I=Math.max(Ld(y),Ld(S));_=Math.pow(10,Mt(u)?I:u),S=Math.round(S*_)/_,C=Math.round(C*_)/_;let A=0;for(v&&(d&&S!==a?(t.push({value:a}),S<a&&A++,aa(Math.round((S+A*y)*_)/_,a,n1(a,b,r))&&A++):S<a&&A++);A<E;++A){let R=Math.round((S+A*y)*_)/_;if(x&&R>s)break;t.push({value:R})}return x&&d&&C!==s?t.length&&aa(t[t.length-1].value,s,n1(s,b,r))?t[t.length-1].value=s:t.push({value:s}):(!x||C===s)&&t.push({value:C}),t}function n1(r,e,{horizontal:t,minRotation:n}){let i=Cn(n),o=(t?Math.sin(i):Math.cos(i))||.001,a=.75*e*(""+r).length;return Math.min(e/o,a)}var fa=class extends Xi{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Mt(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){let{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds(),{min:i,max:o}=this,a=u=>i=t?i:u,s=u=>o=n?o:u;if(e){let u=Pn(i),c=Pn(o);u<0&&c<0?s(0):u>0&&c>0&&a(0)}if(i===o){let u=o===0?1:Math.abs(o*.05);s(o+u),e||a(i-u)}this.min=i,this.max=o}getTickLimit(){let e=this.options.ticks,{maxTicksLimit:t,stepSize:n}=e,i;return n?(i=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let e=this.options,t=e.ticks,n=this.getTickLimit();n=Math.max(2,n);let i={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},o=this._range||this,a=wD(i,o);return e.bounds==="ticks"&&Nd(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){let e=this.ticks,t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){let i=(n-t)/Math.max(e.length-1,1)/2;t-=i,n+=i}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return ua(e,this.chart.options.locale,this.options.ticks.format)}},Df=class extends fa{static id="linear";static defaults={ticks:{callback:gs.formatters.numeric}};determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=ie(e)?e:0,this.max=ie(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){let e=this.isHorizontal(),t=e?this.width:this.height,n=Cn(this.options.ticks.minRotation),i=(e?Math.sin(n):Math.cos(n))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,o.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}},Ms=r=>Math.floor(Ar(r)),qi=(r,e)=>Math.pow(10,Ms(r)+e);function r1(r){return r/Math.pow(10,Ms(r))===1}function i1(r,e,t){let n=Math.pow(10,t),i=Math.floor(r/n);return Math.ceil(e/n)-i}function _D(r,e){let t=e-r,n=Ms(t);for(;i1(r,e,n)>10;)n++;for(;i1(r,e,n)<10;)n--;return Math.min(n,Ms(r))}function CD(r,{min:e,max:t}){e=rn(r.min,e);let n=[],i=Ms(e),o=_D(e,t),a=o<0?Math.pow(10,Math.abs(o)):1,s=Math.pow(10,o),u=i>o?Math.pow(10,i):0,c=Math.round((e-u)*a)/a,l=Math.floor((e-u)/s/10)*s*10,h=Math.floor((c-l)/Math.pow(10,o)),d=rn(r.min,Math.round((u+l+h*Math.pow(10,o))*a)/a);for(;d<t;)n.push({value:d,major:r1(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(o++,h=2,a=o>=0?1:a),d=Math.round((u+l+h*Math.pow(10,o))*a)/a;let f=rn(r.max,d);return n.push({value:f,major:r1(f),significand:h}),n}var Tf=class extends Xi{static id="logarithmic";static defaults={ticks:{callback:gs.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){let n=fa.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return ie(n)&&n>0?n:null}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=ie(e)?Math.max(0,e):null,this.max=ie(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ie(this._userMin)&&(this.min=e===qi(this.min,0)?qi(this.min,-1):qi(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:e,maxDefined:t}=this.getUserBounds(),n=this.min,i=this.max,o=s=>n=e?n:s,a=s=>i=t?i:s;n===i&&(n<=0?(o(1),a(10)):(o(qi(n,-1)),a(qi(i,1)))),n<=0&&o(qi(i,-1)),i<=0&&a(qi(n,1)),this.min=n,this.max=i}buildTicks(){let e=this.options,t={min:this._userMin,max:this._userMax},n=CD(t,this);return e.bounds==="ticks"&&Nd(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":ua(e,this.chart.options.locale,this.options.ticks.format)}configure(){let e=this.min;super.configure(),this._startValue=Ar(e),this._valueRange=Ar(this.max)-Ar(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Ar(e)-this._startValue)/this._valueRange)}getValueForPixel(e){let t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}};function Pf(r){let e=r.ticks;if(e.display&&r.display){let t=Oe(e.backdropPadding);return gt(e.font&&e.font.size,oe.font.size)+t.height}return 0}function SD(r,e,t){return t=Xt(t)?t:[t],{w:Yb(r,e.string,t),h:t.length*e.lineHeight}}function o1(r,e,t,n,i){return r===n||r===i?{start:e-t/2,end:e+t/2}:r<n||r>i?{start:e-t,end:e}:{start:e,end:e+t}}function ED(r){let e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],i=[],o=r._pointLabels.length,a=r.options.pointLabels,s=a.centerPointLabels?Kt/o:0;for(let u=0;u<o;u++){let c=a.setContext(r.getPointLabelContext(u));i[u]=c.padding;let l=r.getPointPosition(u,r.drawingArea+i[u],s),h=ve(c.font),d=SD(r.ctx,h,r._pointLabels[u]);n[u]=d;let f=nn(r.getIndexAngle(u)+s),p=Math.round(Sc(f)),m=o1(p,l.x,d.w,0,180),g=o1(p,l.y,d.h,90,270);kD(t,e,f,m,g)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=RD(r,n,i)}function kD(r,e,t,n,i){let o=Math.abs(Math.sin(t)),a=Math.abs(Math.cos(t)),s=0,u=0;n.start<e.l?(s=(e.l-n.start)/o,r.l=Math.min(r.l,e.l-s)):n.end>e.r&&(s=(n.end-e.r)/o,r.r=Math.max(r.r,e.r+s)),i.start<e.t?(u=(e.t-i.start)/a,r.t=Math.min(r.t,e.t-u)):i.end>e.b&&(u=(i.end-e.b)/a,r.b=Math.max(r.b,e.b+u))}function ID(r,e,t){let n=r.drawingArea,{extra:i,additionalAngle:o,padding:a,size:s}=t,u=r.getPointPosition(e,n+i+a,o),c=Math.round(Sc(nn(u.angle+ce))),l=TD(u.y,s.h,c),h=AD(c),d=DD(u.x,s.w,h);return{visible:!0,x:u.x,y:l,textAlign:h,left:d,top:l,right:d+s.w,bottom:l+s.h}}function MD(r,e){if(!e)return!0;let{left:t,top:n,right:i,bottom:o}=r;return!(Zn({x:t,y:n},e)||Zn({x:t,y:o},e)||Zn({x:i,y:n},e)||Zn({x:i,y:o},e))}function RD(r,e,t){let n=[],i=r._pointLabels.length,o=r.options,{centerPointLabels:a,display:s}=o.pointLabels,u={extra:Pf(o)/2,additionalAngle:a?Kt/i:0},c;for(let l=0;l<i;l++){u.padding=t[l],u.size=e[l];let h=ID(r,l,u);n.push(h),s==="auto"&&(h.visible=MD(h,c),h.visible&&(c=h))}return n}function AD(r){return r===0||r===180?"center":r<180?"left":"right"}function DD(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function TD(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function PD(r,e,t){let{left:n,top:i,right:o,bottom:a}=t,{backdropColor:s}=e;if(!Mt(s)){let u=ci(e.borderRadius),c=Oe(e.backdropPadding);r.fillStyle=s;let l=n-c.left,h=i-c.top,d=o-n+c.width,f=a-i+c.height;Object.values(u).some(p=>p!==0)?(r.beginPath(),ca(r,{x:l,y:h,w:d,h:f,radius:u}),r.fill()):r.fillRect(l,h,d,f)}}function FD(r,e){let{ctx:t,options:{pointLabels:n}}=r;for(let i=e-1;i>=0;i--){let o=r._pointLabelItems[i];if(!o.visible)continue;let a=n.setContext(r.getPointLabelContext(i));PD(t,a,o);let s=ve(a.font),{x:u,y:c,textAlign:l}=o;ui(t,r._pointLabels[i],u,c+s.lineHeight/2,s,{color:a.color,textAlign:l,textBaseline:"middle"})}}function D1(r,e,t,n){let{ctx:i}=r;if(t)i.arc(r.xCenter,r.yCenter,e,0,Yt);else{let o=r.getPointPosition(0,e);i.moveTo(o.x,o.y);for(let a=1;a<n;a++)o=r.getPointPosition(a,e),i.lineTo(o.x,o.y)}}function OD(r,e,t,n,i){let o=r.ctx,a=e.circular,{color:s,lineWidth:u}=e;!a&&!n||!s||!u||t<0||(o.save(),o.strokeStyle=s,o.lineWidth=u,o.setLineDash(i.dash),o.lineDashOffset=i.dashOffset,o.beginPath(),D1(r,t,a,n),o.closePath(),o.stroke(),o.restore())}function ND(r,e,t){return Tr(r,{label:t,index:e,type:"pointLabel"})}var Ff=class extends fa{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:gs.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let e=this._padding=Oe(Pf(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!1);this.min=ie(e)&&!isNaN(e)?e:0,this.max=ie(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Pf(this.options))}generateTickLabels(e){fa.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{let i=Ht(this.options.pointLabels.callback,[t,n],this);return i||i===0?i:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){let e=this.options;e.display&&e.pointLabels.display?ED(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,i))}getIndexAngle(e){let t=Yt/(this._pointLabels.length||1),n=this.options.startAngle||0;return nn(e*t+Cn(n))}getDistanceFromCenterForValue(e){if(Mt(e))return NaN;let t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Mt(e))return NaN;let t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){let t=this._pointLabels||[];if(e>=0&&e<t.length){let n=t[e];return ND(this.getContext(),e,n)}}getPointPosition(e,t,n=0){let i=this.getIndexAngle(e)-ce+n;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){let{left:t,top:n,right:i,bottom:o}=this._pointLabelItems[e];return{left:t,top:n,right:i,bottom:o}}drawBackground(){let{backgroundColor:e,grid:{circular:t}}=this.options;if(e){let n=this.ctx;n.save(),n.beginPath(),D1(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){let e=this.ctx,t=this.options,{angleLines:n,grid:i,border:o}=t,a=this._pointLabels.length,s,u,c;if(t.pointLabels.display&&FD(this,a),i.display&&this.ticks.forEach((l,h)=>{if(h!==0||h===0&&this.min<0){u=this.getDistanceFromCenterForValue(l.value);let d=this.getContext(h),f=i.setContext(d),p=o.setContext(d);OD(this,f,u,a,p)}}),n.display){for(e.save(),s=a-1;s>=0;s--){let l=n.setContext(this.getPointLabelContext(s)),{color:h,lineWidth:d}=l;!d||!h||(e.lineWidth=d,e.strokeStyle=h,e.setLineDash(l.borderDash),e.lineDashOffset=l.borderDashOffset,u=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),c=this.getPointPosition(s,u),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){let e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;let i=this.getIndexAngle(0),o,a;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((s,u)=>{if(u===0&&this.min>=0&&!t.reverse)return;let c=n.setContext(this.getContext(u)),l=ve(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[u].value),c.showLabelBackdrop){e.font=l.string,a=e.measureText(s.label).width,e.fillStyle=c.backdropColor;let h=Oe(c.backdropPadding);e.fillRect(-a/2-h.left,-o-l.size/2-h.top,a+h.width,l.size+h.height)}ui(e,s.label,0,-o,l,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}},Jc={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},an=Object.keys(Jc);function a1(r,e){return r-e}function s1(r,e){if(Mt(e))return null;let t=r._adapter,{parser:n,round:i,isoWeekday:o}=r._parseOpts,a=e;return typeof n=="function"&&(a=n(a)),ie(a)||(a=typeof n=="string"?t.parse(a,n):t.parse(a)),a===null?null:(i&&(a=i==="week"&&(ji(o)||o===!0)?t.startOf(a,"isoWeek",o):t.startOf(a,i)),+a)}function u1(r,e,t,n){let i=an.length;for(let o=an.indexOf(r);o<i-1;++o){let a=Jc[an[o]],s=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((t-e)/(s*a.size))<=n)return an[o]}return an[i-1]}function LD(r,e,t,n,i){for(let o=an.length-1;o>=an.indexOf(t);o--){let a=an[o];if(Jc[a].common&&r._adapter.diff(i,n,a)>=e-1)return a}return an[t?an.indexOf(t):0]}function BD(r){for(let e=an.indexOf(r)+1,t=an.length;e<t;++e)if(Jc[an[e]].common)return an[e]}function c1(r,e,t){if(!t)r[e]=!0;else if(t.length){let{lo:n,hi:i}=Ec(t,e),o=t[n]>=e?t[n]:t[i];r[o]=!0}}function WD(r,e,t,n){let i=r._adapter,o=+i.startOf(e[0].value,n),a=e[e.length-1].value,s,u;for(s=o;s<=a;s=+i.add(s,1,n))u=t[s],u>=0&&(e[u].major=!0);return e}function l1(r,e,t){let n=[],i={},o=e.length,a,s;for(a=0;a<o;++a)s=e[a],i[s]=a,n.push({value:s,major:!1});return o===0||!t?n:WD(r,n,i,t)}var Of=(()=>{class r extends Xi{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){let i=t.time||(t.time={}),o=this._adapter=new JM._date(t.adapters.date);o.init(n),ia(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:s1(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let t=this.options,n=this._adapter,i=t.time.unit||"day",{min:o,max:a,minDefined:s,maxDefined:u}=this.getUserBounds();function c(l){!s&&!isNaN(l.min)&&(o=Math.min(o,l.min)),!u&&!isNaN(l.max)&&(a=Math.max(a,l.max))}(!s||!u)&&(c(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&c(this.getMinMax(!1))),o=ie(o)&&!isNaN(o)?o:+n.startOf(Date.now(),i),a=ie(a)&&!isNaN(a)?a:+n.endOf(Date.now(),i)+1,this.min=Math.min(o,a-1),this.max=Math.max(o+1,a)}_getLabelBounds(){let t=this.getLabelTimestamps(),n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){let t=this.options,n=t.time,i=t.ticks,o=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);let a=this.min,s=this.max,u=jb(o,a,s);return this._unit=n.unit||(i.autoSkip?u1(n.minUnit,this.min,this.max,this._getLabelCapacity(a)):LD(this,u.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:BD(this._unit),this.initOffsets(o),t.reverse&&u.reverse(),l1(this,u,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,o,a;this.options.offset&&t.length&&(o=this.getDecimalForValue(t[0]),t.length===1?n=1-o:n=(this.getDecimalForValue(t[1])-o)/2,a=this.getDecimalForValue(t[t.length-1]),t.length===1?i=a:i=(a-this.getDecimalForValue(t[t.length-2]))/2);let s=t.length<3?.5:.25;n=we(n,0,s),i=we(i,0,s),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){let t=this._adapter,n=this.min,i=this.max,o=this.options,a=o.time,s=a.unit||u1(a.minUnit,n,i,this._getLabelCapacity(n)),u=gt(o.ticks.stepSize,1),c=s==="week"?a.isoWeekday:!1,l=ji(c)||c===!0,h={},d=n,f,p;if(l&&(d=+t.startOf(d,"isoWeek",c)),d=+t.startOf(d,l?"day":s),t.diff(i,n,s)>1e5*u)throw new Error(n+" and "+i+" are too far apart with stepSize of "+u+" "+s);let m=o.ticks.source==="data"&&this.getDataTimestamps();for(f=d,p=0;f<i;f=+t.add(f,u,s),p++)c1(h,f,m);return(f===i||o.bounds==="ticks"||p===1)&&c1(h,f,m),Object.keys(h).sort(a1).map(g=>+g)}getLabelForValue(t){let n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){let o=this.options.time.displayFormats,a=this._unit,s=n||o[a];return this._adapter.format(t,s)}_tickFormatFunction(t,n,i,o){let a=this.options,s=a.ticks.callback;if(s)return Ht(s,[t,n,i],this);let u=a.time.displayFormats,c=this._unit,l=this._majorUnit,h=c&&u[c],d=l&&u[l],f=i[n],p=l&&d&&f&&f.major;return this._adapter.format(t,o||(p?d:h))}generateTickLabels(t){let n,i,o;for(n=0,i=t.length;n<i;++n)o=t[n],o.label=this._tickFormatFunction(o.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){let n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){let n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){let n=this.options.ticks,i=this.ctx.measureText(t).width,o=Cn(this.isHorizontal()?n.maxRotation:n.minRotation),a=Math.cos(o),s=Math.sin(o),u=this._resolveTickFontOptions(0).size;return{w:i*a+u*s,h:i*s+u*a}}_getLabelCapacity(t){let n=this.options.time,i=n.displayFormats,o=i[n.unit]||i.millisecond,a=this._tickFormatFunction(t,0,l1(this,[t],this._majorUnit),o),s=this._getLabelSize(a),u=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return u>0?u:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;let o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(n=0,i=o.length;n<i;++n)t=t.concat(o[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){let t=this._cache.labels||[],n,i;if(t.length)return t;let o=this.getLabels();for(n=0,i=o.length;n<i;++n)t.push(s1(this,o[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return zd(t.sort(a1))}}return r})();function zc(r,e,t){let n=0,i=r.length-1,o,a,s,u;t?(e>=r[n].pos&&e<=r[i].pos&&({lo:n,hi:i}=Qn(r,"pos",e)),{pos:o,time:s}=r[n],{pos:a,time:u}=r[i]):(e>=r[n].time&&e<=r[i].time&&({lo:n,hi:i}=Qn(r,"time",e)),{time:o,pos:s}=r[n],{time:a,pos:u}=r[i]);let c=a-o;return c?s+(u-s)*(e-o)/c:s}var Nf=class extends Of{static id="timeseries";static defaults=Of.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=zc(t,this.min),this._tableRange=zc(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){let{min:t,max:n}=this,i=[],o=[],a,s,u,c,l;for(a=0,s=e.length;a<s;++a)c=e[a],c>=t&&c<=n&&i.push(c);if(i.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(a=0,s=i.length;a<s;++a)l=i[a+1],u=i[a-1],c=i[a],Math.round((l+u)/2)!==c&&o.push({time:c,pos:a/(s-1)});return o}_generate(){let e=this.min,t=this.max,n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((i,o)=>i-o)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;let t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(zc(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){let t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return zc(this._table,n*this._tableRange+this._minPos,!0)}},zD=Object.freeze({__proto__:null,CategoryScale:yD,LinearScale:Df,LogarithmicScale:Tf,RadialLinearScale:Ff,TimeScale:Of,TimeSeriesScale:Nf}),T1=[$M,_A,gD,zD];Yc.register(...T1);var As=Yc;var VD=["barChart"],UD=["lineChart"],jD=["radarChart"],HD=["pieChart"],P1=(()=>{let e=class e{constructor(n,i,o,a){this.projectService=n,this.payrollService=i,this.taskService=o,this.userService=a,this.title="ng-chart",this.chart=[],this.netSalariesByMonth=[],this.tasksNumber=0,this.employeesNumber=0}ngAfterViewInit(){this.projectService.getAllProjects().subscribe(n=>{this.projects=n,this.todo=this.projects.filter(i=>i.projectStatus==="ON_HOLD"),this.done=this.projects.filter(i=>i.projectStatus==="RUNNING"),this.finished=this.projects.filter(i=>i.projectStatus==="FINISHED"),this.numProjectsTodo=this.todo.length,this.numProjectsDone=this.done.length,this.numProjectsFinished=this.finished.length,this.creatPiechart(this.todo.length,this.done.length,this.finished.length)}),this.taskService.getAll().subscribe(n=>{this.tasksNumber=n.length}),this.userService.findAllUsers().subscribe(n=>{this.employeesNumber=n.length}),this.calculateNetSalariesForAllMonths(),new As(this.barChartRef.nativeElement,{type:"bar",data:{labels:["Red","Blue","Yellow","Green","Purple","Orange"],datasets:[{label:"# of Votes",data:[12,19,3,5,2,3],backgroundColor:["red","blue","yellow","green","purple","orange"]}]}}),new As(this.radarChartRef.nativeElement,{type:"radar",data:{labels:["Eating","Drinking","Sleeping","Designing","Coding","Cycling","Running"],datasets:[{label:"My Data",data:[65,59,90,81,56,55,40],fill:!0,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)",pointBackgroundColor:"rgb(255, 99, 132)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)"}]}})}creatPiechart(n,i,o){new As(this.pieChartRef.nativeElement,{type:"pie",data:{labels:["Todo","Done","Finished"],datasets:[{label:"# of Votes",data:[Number(n),Number(i),Number(o)],backgroundColor:["orange","red","green"]}]}})}calculateNetSalariesForAllMonths(){let n=Array.from({length:12},(o,a)=>a+1),i=[];n.forEach(o=>{i.push(this.payrollService.getPayrollsByMonth("2024-"+o.toString()))}),cp(i).pipe(fn(o=>{this.netSalariesByMonth=o.map(a=>a.reduce((s,u)=>s+u.netSalary,0)),this.createLinechart()})).subscribe()}createLinechart(){new As(this.lineChartRef.nativeElement,{type:"line",data:{labels:["January","February","March","April","May","June","July","August","September","October","November","December"],datasets:[{label:"Net Salaries",data:this.netSalariesByMonth,fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}})}};e.\u0275fac=function(i){return new(i||e)(vt(Kp),vt(Gs),vt(Yp),vt(qs))},e.\u0275cmp=Wt({type:e,selectors:[["app-dashboard"]],viewQuery:function(i,o){if(i&1&&(cr(VD,5),cr(UD,5),cr(jD,5),cr(HD,5)),i&2){let a;lr(a=hr())&&(o.barChartRef=a.first),lr(a=hr())&&(o.lineChartRef=a.first),lr(a=hr())&&(o.radarChartRef=a.first),lr(a=hr())&&(o.pieChartRef=a.first)}},decls:71,vars:2,consts:[["rel","stylesheet","type","text/css","href","https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"],["rel","stylesheet","type","text/css","href","/node_modules/primeng/resources/themes/nova-light/theme.css"],["rel","stylesheet","type","text/css","href","/node_modules/primeng/resources/primeng.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap.min.css"],["href","https://fonts.googleapis.com/css?family=Montserrat&display=swap","rel","stylesheet"],[1,"pcoded-main-container"],[1,"pcoded-wrapper"],[1,"pcoded-content"],[1,"row"],[1,"col-xl-3","col-sm-6","col-12"],[1,"card"],[1,"card-content"],[1,"card-body"],[1,"media","d-flex"],[1,"align-self-center"],[1,"icon-graph","success","font-large-2","float-left"],[1,"media-body","text-right"],[1,"media-body","text-left"],[1,"danger"],[1,"icon-rocket","danger","font-large-2","float-right"],[1,"warning"],[1,"icon-pie-chart","warning","font-large-2","float-right"],[1,"icon-pencil","primary","font-large-2","float-left"],[1,"col"],["pieChart",""],["lineChart",""]],template:function(i,o){i&1&&(Y(0,"link",0)(1,"link",1)(2,"link",2)(3,"link",3)(4,"link",4)(5,"link",5)(6,"link",6)(7,"link",7),T(8,"div",8)(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16)(17,"div",17),Y(18,"i",18),P(),T(19,"div",19)(20,"h3"),G(21,"Total Tasks"),P(),T(22,"span"),G(23),P()()()()()()(),T(24,"div",12)(25,"div",13)(26,"div",14)(27,"div",15)(28,"div",16)(29,"div",20)(30,"h3",21),G(31,"Employees Number"),P(),T(32,"span"),G(33),P()(),T(34,"div",17),Y(35,"i",22),P()()()()()(),T(36,"div",12)(37,"div",13)(38,"div",14)(39,"div",15)(40,"div",16)(41,"div",20)(42,"h3",23),G(43,"Total Quarter Shift"),P(),T(44,"span"),G(45,"0"),P()(),T(46,"div",17),Y(47,"i",24),P()()()()()(),T(48,"div",12)(49,"div",13)(50,"div",14)(51,"div",15)(52,"div",16)(53,"div",17),Y(54,"i",25),P(),T(55,"div",19)(56,"h3"),G(57,"Total Absent"),P(),T(58,"span"),G(59,"0"),P()()()()()()()()(),T(60,"div",11)(61,"div",26),Y(62,"canvas",null,27),P(),T(64,"div",26),Y(65,"canvas",null,28),P()(),T(67,"div",11)(68,"div",26),Y(69,"canvas"),P(),Y(70,"div",26),P()()()),i&2&&(Q(23),Ye(o.tasksNumber),Q(10),Ye(o.employeesNumber))}});let r=e;return r})();var F1=(()=>{let e=class e{constructor(n){this._http=n,this.URL="http://20.49.205.136:3000/cvassistant/"}getThread(){return this._http.get(this.URL)}sendMessage(n,i){return this._http.post(this.URL+`sendMessage/${i}`,n)}};e.\u0275fac=function(i){return new(i||e)(Dt(zn))},e.\u0275prov=se({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function qD(r,e){if(r&1&&(T(0,"div",38),Y(1,"div",39),T(2,"div",40),G(3),P()()),r&2){let t=Tt().$implicit;Q(3),de(" ",t," ")}}function XD(r,e){if(r&1&&(T(0,"div",41)(1,"div",39),Y(2,"img",42),P(),T(3,"div",40),G(4),P()()),r&2){let t=Tt().$implicit;Q(4),de(" ",t," ")}}function KD(r,e){if(r&1&&(kp(0),$t(1,qD,4,1,"div",36)(2,XD,5,1,"ng-template",null,37,Fp),Ip()),r&2){let t=e.index,n=Mp(3);Q(),ct("ngIf",t%2===0)("ngIfElse",n)}}var O1=(()=>{let e=class e{constructor(n,i,o){this.fb=n,this.resumeAssistantService=i,this.router=o,this.thread="",this.messages=[],this.myForm=this.fb.group({msg:""})}ngOnInit(){return je(this,null,function*(){this.resumeAssistantService.getThread().subscribe({next:n=>{this.thread=n.thread},error:n=>{}})})}sendMessage(){let n={message:this.myForm.value.msg};this.messages.push(this.myForm.value.msg),this.myForm=this.fb.group({msg:""}),this.resumeAssistantService.sendMessage(n,this.thread).subscribe({next:i=>{this.messages.push(i.msg)},error:i=>{}})}};e.\u0275fac=function(i){return new(i||e)(vt(Xp),vt(F1),vt($e))},e.\u0275cmp=Wt({type:e,selectors:[["app-welcome"]],decls:57,vars:3,consts:[[1,"message"],["id","chatWidget",1,"chat-widget"],["id","chat-widget-toggle","type","checkbox",1,"chat-widget-toggle"],["title","close chat","for","chat-widget-toggle",1,"chat-widget-button","chat-close-button"],["xmlns","http://www.w3.org/2000/svg","width","64","version","1.1","height","64","viewBox","0 0 64 64","enable-background","new 0 0 64 64"],["fill","#1D1D1B","d","M28.941,31.786L0.613,60.114c-0.787,0.787-0.787,2.062,0,2.849c0.393,0.394,0.909,0.59,1.424,0.59   c0.516,0,1.031-0.196,1.424-0.59l28.541-28.541l28.541,28.541c0.394,0.394,0.909,0.59,1.424,0.59c0.515,0,1.031-0.196,1.424-0.59   c0.787-0.787,0.787-2.062,0-2.849L35.064,31.786L63.41,3.438c0.787-0.787,0.787-2.062,0-2.849c-0.787-0.786-2.062-0.786-2.848,0   L32.003,29.15L3.441,0.59c-0.787-0.786-2.061-0.786-2.848,0c-0.787,0.787-0.787,2.062,0,2.849L28.941,31.786z"],[1,"chat-box"],[1,"chat-avatar-box"],["src","https://cdn.pixabay.com/photo/2017/08/30/17/27/business-woman-2697954_960_720.jpg",1,"chat-avatar"],[1,"chat-message-box"],[1,"chat-header"],[1,"chat-title"],[1,"chat-title-primary"],[1,"chat-title-sub"],[1,"chat-messages"],[1,"chat-messages-content"],[4,"ngFor","ngForOf"],[1,"chat-form-box"],["id","chat-form","name","chat-form",1,"chat-form",3,"formGroup","ngSubmit"],["type","text","placeholder","Type your message....","formControlName","msg",1,"chat-form-input"],["title","send message","type","submit",1,"chat-form-button",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","535.5px","height","535.5px","viewBox","0 0 535.5 535.5",2,"enable-background","new 0 0 535.5 535.5"],["points","0,497.25 535.5,267.75 0,38.25 0,216.75 382.5,267.75 0,318.75"],["title","open chat","for","chat-widget-toggle",1,"chat-widget-button","chat-open-button"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 2H3a2 2 0 00-2 2v12a2 2 0 002 2h4l2 3 3-3h5a2 2 0 002-2V4a2 2 0 00-2-2z"],[2,"background-color","#f8f9fa","padding","10px 20px","text-align","center"],[2,"color","#0d6efd"],[2,"list-style","none","padding","0","display","flex","justify-content","center","gap","20px"],["href","#",2,"text-decoration","none","color","#0d6efd","font-weight","bold"],["routerLink","login",2,"text-decoration","none","color","#0d6efd","font-weight","bold"],[2,"padding","20px"],[2,"color","#666"],["src","assets/images/hero_1.jpg","alt","Image 1",2,"width","100%","height","auto","margin-bottom","10px"],["src","assets/images/hero_2.jpg","alt"," Image 2",2,"width","100%","height","auto","margin-bottom","10px"],[2,"background-color","#343a40","color","white","text-align","center","padding","10px"],["class","chat-message -right",4,"ngIf","ngIfElse"],["oddMessage",""],[1,"chat-message","-right"],[1,"chat-message-avatar"],[1,"chat-message-text"],[1,"chat-message","-left"],["src","https://cdn.pixabay.com/photo/2017/08/30/17/27/business-woman-2697954_960_720.jpg","alt","",1,"chat-avatar","-small"]],template:function(i,o){i&1&&(Y(0,"div",0),T(1,"div",1),Y(2,"input",2),T(3,"label",3),Qi(),T(4,"svg",4)(5,"g"),Y(6,"path",5),P()()(),Os(),T(7,"div",6)(8,"div",7),Y(9,"img",8),P(),T(10,"div",9)(11,"div",10)(12,"h1",11)(13,"span",12),G(14,"ResumeBot"),P(),T(15,"span",13),G(16,"Assistant"),P()()(),T(17,"div",14)(18,"div",15),$t(19,KD,4,2,"ng-container",16),P()(),T(20,"div",17)(21,"form",18),kt("ngSubmit",function(){return o.sendMessage()}),Y(22,"input",19),T(23,"button",20),Qi(),T(24,"svg",21),Y(25,"polygon",22),P()()()()()(),Os(),T(26,"label",23),Qi(),T(27,"svg",24),Y(28,"path",25),P()()(),Os(),T(29,"header",26)(30,"h1",27),G(31,"HR Website"),P(),T(32,"nav")(33,"ul",28)(34,"li")(35,"a",29),G(36,"Home"),P()(),T(37,"li")(38,"a",29),G(39,"About"),P()(),T(40,"li")(41,"a",29),G(42,"Services"),P()(),T(43,"li")(44,"a",30),G(45,"Sign in"),P()()()()(),T(46,"main",31)(47,"section")(48,"h2",32),G(49,"Welcome to Our HR Website"),P(),T(50,"p",32),G(51,"This is the homepage of our HR website. Lorem ipsum dolor sit amet, consectetur adipiscing elit."),P(),Y(52,"img",33)(53,"img",34),P()(),T(54,"footer",35)(55,"p"),G(56,"\xA9 2024 HR Website. All rights reserved."),P()()),i&2&&(Q(19),ct("ngForOf",o.messages),Q(2),ct("formGroup",o.myForm),Q(2),ct("disabled",o.myForm.value.msg.length===0))},dependencies:[no,Ne,Vn,jn,gn,Je,Un,Ur,jr],styles:['[_ngcontent-%COMP%]:root{--chat-zIndex: 1000;--chat-min-height: 220px;--chat-max-height: 440px;--chat-color-white: #fff;--chat-color-black: #222;--chat-color-primary: #06b7f1;--chat-default-shadow: 0 0 10px 5px rgba(112, 111, 102, .23)}body[_ngcontent-%COMP%]{margin:0}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(150%) scale(1.02)}75%{transform:translate(-20%) scale(.9)}to{transform:translate(0) scale(1)}}@keyframes _ngcontent-%COMP%_bounceIn{0%{opacity:0;transform:scale(.5)}75%{opacity:.8;transform:scale(1.05)}to{opacity:1;transform:scale(1)}}.chat-widget[_ngcontent-%COMP%]{position:fixed;top:-1000px;left:-1000px;box-sizing:border-box}.chat-widget[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{box-sizing:border-box;font-family:Montserrat,sans-serif;font-weight:400;font-size:14px;line-height:1.6}.chat-widget-toggle[_ngcontent-%COMP%]{position:absolute;z-index:-1;bottom:10px;right:15px}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-open-button[_ngcontent-%COMP%]{opacity:0;transform:translate(200px);transition:all .4s ease}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-box[_ngcontent-%COMP%]{opacity:1;transform:translate(0);transition:all .6s ease,opacity .2s ease-out}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-close-button[_ngcontent-%COMP%]{opacity:1;transform:scale(1);transition:all .4s ease .6s}.chat-box[_ngcontent-%COMP%]{position:fixed;z-index:var(--chat-zIndex);right:15px;bottom:15px;display:flex;flex-flow:column;width:320px;height:calc(100% - 95px);max-height:var(--chat-max-height);min-height:var(--chat-min-height);border-radius:15px;background:var(--chat-color-white);box-shadow:var(--chat-default-shadow);opacity:0;transform:translate(100%);transition:all .35s ease}.chat-avatar-box[_ngcontent-%COMP%]{position:absolute;z-index:100;top:-45px;left:50%;background:transparent;width:80px;height:80px;border-radius:50%;transform:translate(-50%)}.chat-avatar-box[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:-10;top:0;width:80px;height:40px;background:transparent;box-shadow:0 0 10px 5px #706f663b;border-top-left-radius:50px;border-top-right-radius:50px}.chat-avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;object-fit:cover;object-position:center center;border:2px solid var(--chat-color-white)}.chat-avatar.-small[_ngcontent-%COMP%]{width:30px;height:30px}.chat-header[_ngcontent-%COMP%]{position:relative;z-index:100;padding-top:35px;box-shadow:0 1px 3px #0003}.chat-title[_ngcontent-%COMP%]{margin:0 0 10px;font-weight:100;text-align:center}.chat-title[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:block}.chat-title-primary[_ngcontent-%COMP%]{color:#5b5959;font-size:18px;margin-bottom:-3px}.chat-title-sub[_ngcontent-%COMP%]{color:#959595}.chat-message-box[_ngcontent-%COMP%]{display:flex;flex-flow:column;width:100%;height:100%;overflow:hidden}.chat-messages[_ngcontent-%COMP%]{flex:1 1 auto;max-height:500px;width:100%;overflow:hidden;overflow-y:auto;background-image:linear-gradient(to bottom right,#1b7b99 20%,#b5ff5f)}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#bbb}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#4c4c4c;border-radius:100px}.chat-messages-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;padding:10px}.chat-message[_ngcontent-%COMP%]{display:flex;width:80%;min-height:30px;margin-bottom:10px;box-shadow:0 1px 5px #adadab33;border-radius:10px;background:#fff}.chat-message[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:3px;font-size:14px;color:#555}.chat-message.-left[_ngcontent-%COMP%]{align-self:flex-start;border-top-left-radius:0}.chat-message.-left.-animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounceIn .6s ease-in backwards}.chat-message-avatar[_ngcontent-%COMP%]{flex:0 1 auto}.chat-message-text[_ngcontent-%COMP%]{flex:1;font-family:Roboto Slab,sans-serif}.chat-message.-right[_ngcontent-%COMP%]{align-self:flex-end;border-top-left-radius:0}.chat-message.-right.-animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn 1s ease 1 backwards}.chat-widget-button[_ngcontent-%COMP%]{position:fixed;z-index:var(--chat-zIndex);display:flex;align-items:center;justify-content:center;border-radius:50%;box-shadow:var(--chat-default-shadow);cursor:pointer}.chat-open-button[_ngcontent-%COMP%]{right:15px;bottom:15px;align-self:flex-end;width:65px;height:65px;background:var(--chat-color-primary);opacity:1;transform:translate(0);transition:all .3s ease .15s}.chat-open-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:25px;height:25px;fill:#fff}.chat-close-button[_ngcontent-%COMP%]{right:350px;bottom:20px;width:35px;height:35px;background:var(--chat-color-white);opacity:0;transform:scale(.5)}.chat-close-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:10px;height:10px;fill:var(--chat-color-black)}.chat-form-box[_ngcontent-%COMP%]{position:relative;z-index:100;padding:10px 0;flex:0 0 45px;box-shadow:0 -1px 3px #0000001a}.chat-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:95%;height:40px;padding:5px;overflow:hidden;margin:0 auto;border:1px solid #e1e1e1;border-radius:100px}.chat-form-input[_ngcontent-%COMP%]{width:100%;height:100%;border:none;padding-left:10px;color:#767070;font-family:inherit;font-size:14px}.chat-form-input[_ngcontent-%COMP%]::placeholder{color:#959595}.chat-form-input[_ngcontent-%COMP%]::-webkit-placeholder{color:#959595}.chat-form-input[_ngcontent-%COMP%]:focus{outline:none}.chat-form-button[_ngcontent-%COMP%]{display:flex;border:none;background:transparent;cursor:pointer}.chat-form-button[_ngcontent-%COMP%]:active, .chat-form-button[_ngcontent-%COMP%]:focus{outline:none}.chat-form-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;fill:#06b7f1}']});let r=e;return r})();var YD=[{path:"",component:O1},{path:"login",component:_m},{path:"sendcode",component:vb},{path:"resetpassword",component:Sm},{path:"newpassword",component:Em},{path:"emailsended",component:km},{path:"notfound",component:Cl},{path:"home",component:Pm,canActivate:[Im],children:[{path:"dashboard",component:P1},{path:"profile",component:gb},{path:"users",loadChildren:()=>import("./chunk-DAHYBVR5.js").then(r=>r.UserModule)},{path:"missions",loadChildren:()=>import("./chunk-2A6YDJB4.js").then(r=>r.MissionModule)},{path:"roles",loadChildren:()=>import("./chunk-RVA7442K.js").then(r=>r.RoleModule)},{path:"config",loadChildren:()=>import("./chunk-56LKV3LQ.js").then(r=>r.ConfigManagementModule)},{path:"holiday",loadChildren:()=>import("./chunk-IEMLGLIA.js").then(r=>r.HolidayManagementModule)},{path:"department",loadChildren:()=>import("./chunk-JA3S2WDT.js").then(r=>r.DepartmentManagementModule)},{path:"attendance",loadChildren:()=>import("./chunk-LVCVAOEY.js").then(r=>r.AttendanceManagementModule)},{path:"tasks",loadChildren:()=>import("./chunk-2JTVOENI.js").then(r=>r.TaskManagementModule)},{path:"projects",loadChildren:()=>import("./chunk-JVBMU7V5.js").then(r=>r.ProjectManagementModule)},{path:"payroll",loadChildren:()=>import("./chunk-BFHSSSV7.js").then(r=>r.PayrollManagementModule)},{path:"allowance",loadChildren:()=>import("./chunk-VXFE4G56.js").then(r=>r.AllowanceRoutingModule)},{path:"deduction",loadChildren:()=>import("./chunk-5CFOXQNH.js").then(r=>r.DeductionRoutingModule)}]},{path:"**",component:Cl}],N1=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e}),e.\u0275inj=mn({imports:[gl.forRoot(YD),gl]});let r=e;return r})();var L1=(()=>{let e=class e{ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Wt({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,o){i&1&&Y(0,"router-outlet")},dependencies:[Hs]});let r=e;return r})();var $D="@",JD=(()=>{let e=class e{constructor(n,i,o,a,s){this.doc=n,this.delegate=i,this.zone=o,this.animationType=a,this.moduleImpl=s,this._rendererFactoryPromise=null,this.scheduler=Zi(Ls,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-ZKE3AL5S.js")).catch(i=>{throw new yp(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:o})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let a=new o(this.delegate,this._engine,this.zone);return this.delegate=a,a})}createRenderer(n,i){let o=this.delegate.createRenderer(n,i);if(o.\u0275type===0)return o;typeof o.throwOnSyntheticProps=="boolean"&&(o.throwOnSyntheticProps=!1);let a=new Wf(o);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let u=s.createRenderer(n,i);a.use(u)}).catch(s=>{a.use(o)}),a}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(i){Sp()},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),Wf=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,n,i){this.delegate.insertBefore(e,t,n,i)}removeChild(e,t,n){this.delegate.removeChild(e,t,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,i){this.delegate.setAttribute(e,t,n,i)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,i){this.delegate.setStyle(e,t,n,i)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){this.shouldReplay(t)&&this.replay.push(i=>i.setProperty(e,t,n)),this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.shouldReplay(t)&&this.replay.push(i=>i.listen(e,t,n)),this.delegate.listen(e,t,n)}shouldReplay(e){return this.replay!==null&&e.startsWith($D)}};function B1(r="animations"){return pl("NgAsyncAnimations"),Ns([{provide:Bs,useFactory:(e,t,n)=>new JD(e,t,n,r),deps:[Ws,Us,to]},{provide:ga,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var W1=(()=>{let e=class e{constructor(n){this.platformId=n}intercept(n,i){if(Lp(this.platformId)){let o=localStorage.getItem("token");if(o){let a=n.clone({setHeaders:{Authorization:`Bearer ${o}`}});return i.handle(a).pipe(Ps(s=>sp(s)))}}return i.handle(n)}};e.\u0275fac=function(i){return new(i||e)(Dt(wp))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();var z1=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e}),e.\u0275inj=mn({imports:[Vs,gm,oo,ao,ho,co,lo,so,fo,uo]});let r=e;return r})();var QD=(()=>{let e=class e extends Ys{constructor(n,i,o){super(n,i,o,Zi(Ls,{optional:!0}))}ngOnDestroy(){this.flush()}};e.\u0275fac=function(i){return new(i||e)(Dt(Ws),Dt(va),Dt(Ks))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();function ZD(){return new bm}function tT(r,e,t){return new wm(r,e,t)}var U1=[{provide:Ks,useFactory:ZD},{provide:Ys,useClass:QD},{provide:Bs,useFactory:tT,deps:[Us,Ys,to]}],V1=[{provide:va,useFactory:()=>new ym},{provide:ga,useValue:"BrowserAnimations"},...U1],eT=[{provide:va,useClass:xm},{provide:ga,useValue:"NoopAnimations"},...U1],j1=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?eT:V1}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e}),e.\u0275inj=mn({providers:V1,imports:[js]});let r=e;return r})();var Ts="PERFORM_ACTION",nT="REFRESH",Y1="RESET",$1="ROLLBACK",J1="COMMIT",Q1="SWEEP",Z1="TOGGLE_ACTION",rT="SET_ACTIONS_ACTIVE",tw="JUMP_TO_STATE",ew="JUMP_TO_ACTION",Qf="IMPORT_STATE",nw="LOCK_CHANGES",rw="PAUSE_RECORDING",pa=class{constructor(e,t){if(this.action=e,this.timestamp=t,this.type=Ts,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},zf=class{constructor(){this.type=nT}},Vf=class{constructor(e){this.timestamp=e,this.type=Y1}},Uf=class{constructor(e){this.timestamp=e,this.type=$1}},jf=class{constructor(e){this.timestamp=e,this.type=J1}},Hf=class{constructor(){this.type=Q1}},Gf=class{constructor(e){this.id=e,this.type=Z1}};var qf=class{constructor(e){this.index=e,this.type=tw}},Xf=class{constructor(e){this.actionId=e,this.type=ew}},Kf=class{constructor(e){this.nextLiftedState=e,this.type=Qf}},Yf=class{constructor(e){this.status=e,this.type=nw}},$f=class{constructor(e){this.status=e,this.type=rw}};var el=new ma("@ngrx/store-devtools Options"),H1=new ma("@ngrx/store-devtools Initial Config");function iw(){return null}var iT="NgRx Store DevTools";function oT(r){let e={maxAge:!1,monitor:iw,actionSanitizer:void 0,stateSanitizer:void 0,name:iT,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},t=typeof r=="function"?r():r,n=t.logOnly?{pause:!0,export:!0,test:!0}:!1,i=t.features||n||e.features;i.import===!0&&(i.import="custom");let o=Object.assign({},e,{features:i},t);if(o.maxAge&&o.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${o.maxAge}`);return o}function G1(r,e){return r.filter(t=>e.indexOf(t)<0)}function ow(r){let{computedStates:e,currentStateIndex:t}=r;if(t>=e.length){let{state:i}=e[e.length-1];return i}let{state:n}=e[t];return n}function Ds(r){return new pa(r,+Date.now())}function aT(r,e){return Object.keys(e).reduce((t,n)=>{let i=Number(n);return t[i]=aw(r,e[i],i),t},{})}function aw(r,e,t){return ur(sr({},e),{action:r(e.action,t)})}function sT(r,e){return e.map((t,n)=>({state:sw(r,t.state,n),error:t.error}))}function sw(r,e,t){return r(e,t)}function uw(r){return r.predicate||r.actionsSafelist||r.actionsBlocklist}function uT(r,e,t,n){let i=[],o={},a=[];return r.stagedActionIds.forEach((s,u)=>{let c=r.actionsById[s];c&&(u&&Zf(r.computedStates[u],c,e,t,n)||(o[s]=c,i.push(s),a.push(r.computedStates[u])))}),ur(sr({},r),{stagedActionIds:i,actionsById:o,computedStates:a})}function Zf(r,e,t,n,i){let o=t&&!t(r,e.action),a=n&&!e.action.type.match(n.map(u=>q1(u)).join("|")),s=i&&e.action.type.match(i.map(u=>q1(u)).join("|"));return o||a||s}function q1(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cw(r){return{ngZone:r?Zi(to):null,connectInZone:r}}var nl=(()=>{let e=class e extends Xs{};e.\u0275fac=(()=>{let n;return function(o){return(n||(n=_p(e)))(o||e)}})(),e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),Qc={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},Jf=new ma("@ngrx/store-devtools Redux Devtools Extension"),lw=(()=>{let e=class e{constructor(n,i,o){this.config=i,this.dispatcher=o,this.zoneConfig=cw(this.config.connectInZone),this.devtoolsExtension=n,this.createActionStreams()}notify(n,i){if(this.devtoolsExtension)if(n.type===Ts){if(i.isLocked||i.isPaused)return;let o=ow(i);if(uw(this.config)&&Zf(o,n,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let a=this.config.stateSanitizer?sw(this.config.stateSanitizer,o,i.currentStateIndex):o,s=this.config.actionSanitizer?aw(this.config.actionSanitizer,n,i.nextActionId):n;this.sendToReduxDevtools(()=>this.extensionConnection.send(s,a))}else{let o=ur(sr({},i),{stagedActionIds:i.stagedActionIds,actionsById:this.config.actionSanitizer?aT(this.config.actionSanitizer,i.actionsById):i.actionsById,computedStates:this.config.stateSanitizer?sT(this.config.stateSanitizer,i.computedStates):i.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,o,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new cl(n=>{let i=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=i,i.init(),i.subscribe(o=>n.next(o)),i.unsubscribe}):op}createActionStreams(){let n=this.createChangesObservable().pipe(mp()),i=n.pipe(Ji(l=>l.type===Qc.START)),o=n.pipe(Ji(l=>l.type===Qc.STOP)),a=n.pipe(Ji(l=>l.type===Qc.DISPATCH),fn(l=>this.unwrapAction(l.payload)),hp(l=>l.type===Qf?this.dispatcher.pipe(Ji(h=>h.type===bl),up(1e3),dp(1e3),fn(()=>l),Ps(()=>ll(l)),fp(1)):ll(l))),u=n.pipe(Ji(l=>l.type===Qc.ACTION),fn(l=>this.unwrapAction(l.payload))).pipe(Fs(o)),c=a.pipe(Fs(o));this.start$=i.pipe(Fs(o)),this.actions$=this.start$.pipe(dl(()=>u)),this.liftedActions$=this.start$.pipe(dl(()=>c))}unwrapAction(n){return typeof n=="string"?(0,eval)(`(${n})`):n}getExtensionConfig(n){let i={name:n.name,features:n.features,serialize:n.serialize,autoPause:n.autoPause??!1,trace:n.trace??!1,traceLimit:n.traceLimit??75};return n.maxAge!==!1&&(i.maxAge=n.maxAge),i}sendToReduxDevtools(n){try{n()}catch(i){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",i)}}};e.\u0275fac=function(i){return new(i||e)(Dt(Jf),Dt(el),Dt(nl))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})(),tl={type:xl},cT="@ngrx/store-devtools/recompute",lT={type:cT};function hw(r,e,t,n,i){if(n)return{state:t,error:"Interrupted by an error up the chain"};let o=t,a;try{o=r(t,e)}catch(s){a=s.toString(),i.handleError(s)}return{state:o,error:a}}function Zc(r,e,t,n,i,o,a,s,u){if(e>=r.length&&r.length===o.length)return r;let c=r.slice(0,e),l=o.length-(u?1:0);for(let h=e;h<l;h++){let d=o[h],f=i[d].action,p=c[h-1],m=p?p.state:n,g=p?p.error:void 0,x=a.indexOf(d)>-1?p:hw(t,f,m,g,s);c.push(x)}return u&&c.push(r[r.length-1]),c}function hT(r,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:Ds(tl)},stagedActionIds:[0],skippedActionIds:[],committedState:r,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function dT(r,e,t,n,i={}){return o=>(a,s)=>{let{monitorState:u,actionsById:c,nextActionId:l,stagedActionIds:h,skippedActionIds:d,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}=a||e;a||(c=Object.create(c));function x(y){let _=y,S=h.slice(1,_+1);for(let C=0;C<S.length;C++)if(m[C+1].error){_=C,S=h.slice(1,_+1);break}else delete c[S[C]];d=d.filter(C=>S.indexOf(C)===-1),h=[0,...h.slice(_+1)],f=m[_].state,m=m.slice(_),p=p>_?p-_:0}function w(){c={0:Ds(tl)},l=1,h=[0],d=[],f=m[p].state,p=0,m=[]}let b=0;switch(s.type){case nw:{g=s.status,b=1/0;break}case rw:{v=s.status,v?(h=[...h,l],c[l]=new pa({type:"@ngrx/devtools/pause"},+Date.now()),l++,b=h.length-1,m=m.concat(m[m.length-1]),p===h.length-2&&p++,b=1/0):w();break}case Y1:{c={0:Ds(tl)},l=1,h=[0],d=[],f=r,p=0,m=[];break}case J1:{w();break}case $1:{c={0:Ds(tl)},l=1,h=[0],d=[],p=0,m=[];break}case Z1:{let{id:y}=s;d.indexOf(y)===-1?d=[y,...d]:d=d.filter(S=>S!==y),b=h.indexOf(y);break}case rT:{let{start:y,end:_,active:S}=s,C=[];for(let E=y;E<_;E++)C.push(E);S?d=G1(d,C):d=[...d,...C],b=h.indexOf(y);break}case tw:{p=s.index,b=1/0;break}case ew:{let y=h.indexOf(s.actionId);y!==-1&&(p=y),b=1/0;break}case Q1:{h=G1(h,d),d=[],p=Math.min(p,h.length-1);break}case Ts:{if(g)return a||e;if(v||a&&Zf(a.computedStates[p],s,i.predicate,i.actionsSafelist,i.actionsBlocklist)){let _=m[m.length-1];m=[...m.slice(0,-1),hw(o,s.action,_.state,_.error,t)],b=1/0;break}i.maxAge&&h.length===i.maxAge&&x(1),p===h.length-1&&p++;let y=l++;c[y]=s,h=[...h,y],b=h.length-1;break}case Qf:{({monitorState:u,actionsById:c,nextActionId:l,stagedActionIds:h,skippedActionIds:d,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}=s.nextLiftedState);break}case xl:{b=0,i.maxAge&&h.length>i.maxAge&&(m=Zc(m,b,o,f,c,h,d,t,v),x(h.length-i.maxAge),b=1/0);break}case bl:{if(m.filter(_=>_.error).length>0)b=0,i.maxAge&&h.length>i.maxAge&&(m=Zc(m,b,o,f,c,h,d,t,v),x(h.length-i.maxAge),b=1/0);else{if(!v&&!g){p===h.length-1&&p++;let _=l++;c[_]=new pa(s,+Date.now()),h=[...h,_],b=h.length-1,m=Zc(m,b,o,f,c,h,d,t,v)}m=m.map(_=>ur(sr({},_),{state:o(_.state,lT)})),p=h.length-1,i.maxAge&&h.length>i.maxAge&&x(h.length-i.maxAge),b=1/0}break}default:{b=1/0;break}}return m=Zc(m,b,o,f,c,h,d,t,v),u=n(u,s),{monitorState:u,actionsById:c,nextActionId:l,stagedActionIds:h,skippedActionIds:d,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}}}var X1=(()=>{let e=class e{constructor(n,i,o,a,s,u,c,l){let h=hT(c,l.monitor),d=dT(c,h,u,l.monitor,l),f=hl(hl(i.asObservable().pipe(gp(1)),a.actions$).pipe(fn(Ds)),n,a.liftedActions$).pipe(ap(ip)),p=o.pipe(fn(d)),m=cw(l.connectInZone),g=new rp(1);this.liftedStateSubscription=f.pipe(bp(p),K1(m),pp(({state:w},[b,y])=>{let _=y(w,b);return b.type!==Ts&&uw(l)&&(_=uT(_,l.predicate,l.actionsSafelist,l.actionsBlocklist)),a.notify(b,_),{state:_,action:b}},{state:h,action:null})).subscribe(({state:w,action:b})=>{if(g.next(w),b.type===Ts){let y=b.action;s.next(y)}}),this.extensionStartSubscription=a.start$.pipe(K1(m)).subscribe(()=>{this.refresh()});let v=g.asObservable(),x=v.pipe(fn(ow));Object.defineProperty(x,"state",{value:am(x,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=n,this.liftedState=v,this.state=x}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(n){this.dispatcher.next(n)}next(n){this.dispatcher.next(n)}error(n){}complete(){}performAction(n){this.dispatch(new pa(n,+Date.now()))}refresh(){this.dispatch(new zf)}reset(){this.dispatch(new Vf(+Date.now()))}rollback(){this.dispatch(new Uf(+Date.now()))}commit(){this.dispatch(new jf(+Date.now()))}sweep(){this.dispatch(new Hf)}toggleAction(n){this.dispatch(new Gf(n))}jumpToAction(n){this.dispatch(new Xf(n))}jumpToState(n){this.dispatch(new qf(n))}importState(n){this.dispatch(new Kf(n))}lockChanges(n){this.dispatch(new Yf(n))}pauseRecording(n){this.dispatch(new $f(n))}};e.\u0275fac=function(i){return new(i||e)(Dt(nl),Dt(Xs),Dt(um),Dt(lw),Dt(lm),Dt(Cp),Dt(sm),Dt(el))},e.\u0275prov=se({token:e,factory:e.\u0275fac});let r=e;return r})();function K1({ngZone:r,connectInZone:e}){return t=>e?new cl(n=>t.subscribe({next:i=>r.run(()=>n.next(i)),error:i=>r.run(()=>n.error(i)),complete:()=>r.run(()=>n.complete())})):t}var fT=new ma("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function pT(r,e){return!!r||e.monitor!==iw}function mT(){let r="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[r]<"u"?window[r]:null}function gT(r={}){return Ns([lw,nl,X1,{provide:H1,useValue:r},{provide:fT,deps:[Jf,el],useFactory:pT},{provide:Jf,useFactory:mT},{provide:el,deps:[H1],useFactory:oT},{provide:hm,deps:[X1],useFactory:vT},{provide:cm,useExisting:nl}])}function vT(r){return r.state}var dw=(()=>{let e=class e{static instrument(n={}){return{ngModule:e,providers:[gT(n)]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e}),e.\u0275inj=mn({});let r=e;return r})();var fw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e}),e.\u0275inj=mn({imports:[Vs,vm,oo,ao,ho,co,lo,so,fo,uo]});let r=e;return r})();var pw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=pn({type:e,bootstrap:[L1]}),e.\u0275inj=mn({providers:[Up(),B1(),{provide:Wp,useClass:W1,multi:!0},zs],imports:[js,N1,zp,ao,oo,Qp,vl,mm,Jp,nm,pm,rm,$p,vl,Zp,im,om,z1,tm,fw,em,j1,dm.forRoot({}),dw.instrument({maxAge:25,autoPause:!0}),fm.forRoot([]),ho,co,lo,so,fo,uo]});let r=e;return r})();Vp().bootstrapModule(pw).catch(r=>console.error(r));
