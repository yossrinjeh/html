import{a as Kg,b as mv,c as gv}from"./chunk-S2DDGO7S.js";import{a as Wc,b as vv}from"./chunk-QG5PWWPY.js";import{a as bv}from"./chunk-GBPSRNHA.js";import{a as yv}from"./chunk-HK6T2J3Y.js";import{f as xv,g as Xo,h as Kc,m as _v,n as Xc,p as wv,u as Cv}from"./chunk-UHDMYTHG.js";import{a as cv}from"./chunk-NDD2C7QW.js";import{a as uv}from"./chunk-UL6QYF4H.js";import"./chunk-OWPVGQ3L.js";import{c as Gc,e as Yc}from"./chunk-ACCWHLXM.js";import{a as Bd}from"./chunk-RGPOKRM4.js";import"./chunk-X4RXAOJJ.js";import{a as lv}from"./chunk-65SCHLTR.js";import{a as dv}from"./chunk-FNHM2JRO.js";import{a as $g,b as hv,c as fv}from"./chunk-ASEHSDUU.js";import{A as qc,a as Rd,b as Td,c as Ta,d as av,e as Fd,f as ov,g as Pd,h as sv,m as Hc,n as Uc}from"./chunk-SP2BME5M.js";import{A as jc,E as nv,G as ur,H as qo,I as rv,_ as iv,a as Qg,c as zc,h as Jg,t as Zg,y as tv,z as ev}from"./chunk-VVWXXBDM.js";import{c as Od,d as Yo,f as ui,g as Nd,h as Ld,i as Ko}from"./chunk-AESYL7IM.js";import"./chunk-AIZNQ6PA.js";import{a as Xg,b as pv}from"./chunk-R3ETKCYB.js";import{a as ai}from"./chunk-OFLKKGB4.js";import{a as y2,b as ii}from"./chunk-L3OHN5FL.js";import"./chunk-VKBCP5J6.js";import{a as Ug,b as Rn,c as Pi,e as dn,f as sr,g as Aa,h as Gg,i as Oi,j as Ia,k as cr,l as qg,m as oi,n as si,r as ci,t as Yg,u as Ma,v as Ra}from"./chunk-O6ZXFWJR.js";import{a as Bg,b as Id,c as or,d as Vg,e as Wg,f as Lc,g as zg,h as Bc,j as jg,k as Hg,l as Vc,m as ln,n as ri,o as Md}from"./chunk-VM527ZQ7.js";import{$ as sg,$b as _n,$c as Go,Ab as Ed,Ac as Rg,B as gd,Ba as It,Bc as Tg,Ca as pe,Cb as ir,Dc as Fg,Ea as pt,F as tg,Gb as xg,H as eg,Ha as pg,Ia as zo,J as Ar,K as nr,Ka as mg,Kb as Lt,La as nt,Lb as zn,M as wa,Ma as xe,Mb as it,N as vd,Nb as ar,O as ng,Oa as _d,Ob as ni,Pa as gg,Pb as kd,Q as Ca,Qa as vg,R as rg,Ra as Ea,Rb as Uo,Rc as Pg,Sb as Tc,T as ig,Tb as Fc,U as ag,Ub as Pc,V as og,Va as bg,Vb as I,Vc as Og,Wa as jo,Wb as T,Xa as Ho,Xb as $,Y as bd,Ya as yg,Yb as _g,Zb as wg,_a as Dc,a as Te,aa as cg,b as cn,ba as _c,bc as Cg,c as md,ca as ug,cc as mt,dc as Sg,e as Xm,ea as lg,ec as ft,fa as wc,fc as Dd,g as en,ga as yd,gc as Ad,gd as Oc,h as xa,ha as Cc,hd as ka,ia as dg,ic as Eg,id as un,j as ei,ja as hg,jb as wd,jc as Pe,ka as Sc,kc as ke,la as Ec,lc as De,ld as Ng,m as Wn,ma as re,mb as q,mc as kg,md as Nc,n as _a,nb as rt,nc as H,o as $m,ob as Ac,oc as oe,od as Da,p as yc,pc as me,qa as kc,qb as Ic,qc as Dg,qd as Lg,r as Qm,ra as Et,rc as An,s as xc,sa as fe,sb as Mc,sc as In,ta as fg,tc as Mn,u as Fi,ua as ie,uc as Ag,v as Jm,va as ae,vb as Cd,vc as Mr,wa as Ir,wb as Rc,wc as Ig,xa as Sa,xb as Sd,xc as Mg,y as Zm,ya as xd,z as Fe,zb as rr}from"./chunk-DOLGZFZY.js";var Lv=Xm((Oa,Nv)=>{"use strict";Nv.exports=Oa=window.fetch;Oa.default=window.fetch.bind(window);Oa.Headers=window.Headers;Oa.Request=window.Request;Oa.Response=window.Response});var Bv=Xm(()=>{"use strict"});var Fa=(()=>{let e=class e{constructor(n){this._http=n,this.URL="http://localhost:3000/auth/local/signin",this.LOGOUT_URL="http://localhost:3000/auth/logout",this.CODE_URL="http://localhost:3000/auth/sendsmscode/",this.CODE_URL_MAIL="http://localhost:3000/auth/sendmailcode/",this.VERIFY_URL="http://localhost:3000/auth/verifyCode/"}verifyCode(n,i){return this._http.post(this.VERIFY_URL+`${i}/${n}`,null)}sendVerificationCodeMail(n){return this._http.post(this.CODE_URL_MAIL+n,null)}sendVerificationCode(n){return this._http.post(this.CODE_URL+n,null)}login(n){return this._http.post(this.URL,n)}_is_logged(){return!!localStorage.getItem("token")}logout(){return this._http.post(this.LOGOUT_URL,{})}};e.\u0275fac=function(i){return new(i||e)(nt(or))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function x2(r,e){if(r&1&&(I(0,"div",18),H(1),T()),r&2){let t=ft();q(),oe(t.errorMessage)}}var _2=()=>["/resetpassword"],Sv=(()=>{let e=class e{constructor(n,i,a,o){this.encryptionService=n,this.authService=i,this.router=a,this.userService=o,this.authRequest={},this.authResponse={}}authenticate(){this.authService.login(this.authRequest).subscribe({next:n=>{if(this.authResponse=n,n.access_token=="sms"){let i={email:this.authRequest.email,method:n.access_token};localStorage.setItem("code",JSON.stringify(i)),this.router.navigate(["/sendcode"])}else if(n.access_token=="mail"){let i={email:this.authRequest.email,method:n.access_token};localStorage.setItem("code",JSON.stringify(i)),this.router.navigate(["/sendcode"])}else localStorage.setItem("token",n.access_token),this.userService.getUser(this.authRequest.email).subscribe({next:i=>{let a={firstname:i.firstname,lastname:i.lastname,email:i.email},o=this.encryptionService.encrypt(JSON.stringify(i.authorities),"2f7");localStorage.setItem("authorities",o),localStorage.setItem("user",JSON.stringify(a)),this.router.navigate(["/home/dashboard"])},error:i=>{}})},error:n=>{this.errorMessage="Invalid email or password"}})}};e.\u0275fac=function(i){return new(i||e)(rt(ii),rt(Fa),rt(ln),rt(ai))},e.\u0275cmp=Et({type:e,selectors:[["app-login"]],decls:25,vars:5,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-unlock","auth-icon"],[3,"ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","required","","name","email",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","mb-4"],["type","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","shadow-2","mb-4"],["class","alert alert-danger",4,"ngIf"],[1,"mb-2","text-muted"],[3,"routerLink"],[1,"alert","alert-danger"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2),$(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),T(),I(7,"div",5)(8,"div",6)(9,"div",7),$(10,"i",8),T(),I(11,"form",9),mt("ngSubmit",function(){return a.authenticate()}),I(12,"h3",7),H(13,"Login"),T(),I(14,"div",10)(15,"input",11),Mn("ngModelChange",function(s){return In(a.authRequest.email,s)||(a.authRequest.email=s),s}),T()(),I(16,"div",12)(17,"input",13),Mn("ngModelChange",function(s){return In(a.authRequest.password,s)||(a.authRequest.password=s),s}),T()(),I(18,"button",14),H(19,"Login"),T(),Lt(20,x2,2,1,"div",15),T(),I(21,"p",16),H(22,"Forgot password? "),I(23,"a",17),H(24,"Reset"),T()()()()()()),i&2&&(q(15),An("ngModel",a.authRequest.email),q(2),An("ngModel",a.authRequest.password),q(3),it("ngIf",a.errorMessage),q(3),it("routerLink",Ig(4,_2)))},dependencies:[un,ri,cr,Rn,dn,sr,ci,Ia,Gg]});let r=e;return r})();var Qc=(()=>{let e=class e{constructor(n){this.http=n,this.baseUrl="http://localhost:3000/passwordreset"}request(n){let i=new Id().set("email",n);return this.http.post(`${this.baseUrl}/request`,null,{params:i})}reset(n,i){let a=new Id().set("token",n).set("password",i);return this.http.post(`${this.baseUrl}/reset`,null,{params:a})}};e.\u0275fac=function(i){return new(i||e)(nt(or))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var kv=(()=>{let e=class e{constructor(n,i){this.router=n,this.resetpasswordService=i,this.status="",this.formRequest=new Aa({email:new Oi("",[Pi.required])})}sendmail(){this.formRequest.valid&&this.resetpasswordService.request(this.formRequest.value.email).subscribe({next:n=>{this.router.navigate(["/emailsended"])}}),this.router.navigate(["/emailsended"])}};e.\u0275fac=function(i){return new(i||e)(rt(ln),rt(Qc))},e.\u0275cmp=Et({type:e,selectors:[["app-resetpassword"]],decls:18,vars:1,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","formControlName","email","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2),$(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),T(),I(7,"div",5)(8,"div",6)(9,"div",7),$(10,"i",8),T(),I(11,"form",9),mt("ngSubmit",function(){return a.sendmail()}),I(12,"h3",7),H(13,"Reset Password"),T(),I(14,"div",10),$(15,"input",11),T(),I(16,"button",12),H(17,"Reset Password"),T()()()()()()),i&2&&(q(11),it("formGroup",a.formRequest))},dependencies:[cr,Rn,dn,sr,ci,oi,si]});let r=e;return r})();function w2(r,e){if(r&1&&(I(0,"div",15),H(1),T()),r&2){let t=ft();q(),me(" ",t.status," ")}}var Dv=(()=>{let e=class e{constructor(n,i,a){this.router=n,this.route=i,this.resetpasswordService=a,this.formRequest=new Aa({password:new Oi("",[Pi.required]),confirmPassword:new Oi("",[Pi.required])})}ngOnInit(){this.token=this.route.snapshot.queryParamMap.get("token")}resetpassword(){this.formRequest.valid&&this.token&&this.formRequest.value.password===this.formRequest.value.confirmPassword?this.resetpasswordService.reset(this.token,this.formRequest.value.password).subscribe({next:n=>{this.router.navigate(["/login"])}}):this.status="Verify passwords!"}};e.\u0275fac=function(i){return new(i||e)(rt(ln),rt(Hg),rt(Qc))},e.\u0275cmp=Et({type:e,selectors:[["app-newpassword"]],decls:21,vars:3,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","password","placeholder","New password","formControlName","password","name","password","required","",1,"form-control"],["type","password","placeholder","Confirm password","formControlName","confirmPassword","required","",1,"form-control"],["class","alert alert-danger","role","alert",4,"ngIf","ngIfIs"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"],["role","alert",1,"alert","alert-danger"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2),$(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),T(),I(7,"div",5)(8,"div",6)(9,"div",7),$(10,"i",8),T(),I(11,"form",9),mt("ngSubmit",function(){return a.resetpassword()}),I(12,"h3",7),H(13,"Reset Password"),T(),I(14,"div",10),$(15,"input",11),T(),I(16,"div",10),$(17,"input",12),T(),Lt(18,w2,2,1,"div",13),I(19,"button",14),H(20,"Reset Password"),T()()()()()()),i&2&&(q(11),it("formGroup",a.formRequest),q(7),it("ngIf",a.status)("ngIfIs",a.undefind))},dependencies:[un,cr,Rn,dn,sr,ci,oi,si]});let r=e;return r})();var Av=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Et({type:e,selectors:[["app-emailsended"]],decls:18,vars:0,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[1,"input-group","mb-3"],["routerLink","/login",1,"btn","btn-primary","shadow-2","mb-4",2,"color","white"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2),$(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),T(),I(7,"div",5)(8,"div",6)(9,"div",7),$(10,"i",8),T(),I(11,"h3",7),H(12,"Email is sent"),T(),$(13,"div",9),I(14,"p",7),H(15,"Please check your email!"),T(),I(16,"a",10),H(17,"Login"),T()()()()())},dependencies:[ri]});let r=e;return r})();var jd=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Et({type:e,selectors:[["app-not-found"]],decls:18,vars:0,consts:[[1,"maintenance-block"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-8"],[1,"card","error-card"],[1,"card-body"],[1,"error-image-block"],["src","../assets/images/404.png","alt","img",1,"img-fluid"],[1,"text-center"],[1,"mt-3"],[1,"mt-2","mb-4","text-muted"],["type","button","href","/home",1,"btn","btn-primary","mb-3"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),$(7,"img",7),T(),I(8,"div",8)(9,"h1",9)(10,"b"),H(11,"Oops! Page not found!"),T()(),I(12,"p",10),H(13," The page you are looking was moved, removed,"),$(14,"br"),H(15," renamed, or might never exist! "),T(),I(16,"a",11),H(17,"Go to home"),T()()()()()()()())}});let r=e;return r})();var Iv=(()=>{let e=class e{constructor(n,i){this.encryptionService=n,this.router=i}canActivate(n,i){return localStorage.getItem("token")?!0:(localStorage.clear(),this.router.navigate(["/login"]),!1)}};e.\u0275fac=function(i){return new(i||e)(nt(ii),nt(ln))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function C2(r,e){r&1&&(I(0,"li",11)(1,"a",22)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Projects"),T()()())}function S2(r,e){r&1&&(I(0,"li",11)(1,"a",23)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Tasks"),T()()())}function E2(r,e){r&1&&(I(0,"li",11)(1,"a",24)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Payroll"),T()()())}function k2(r,e){r&1&&(I(0,"li",11)(1,"a",25)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Payslip"),T()()())}function D2(r,e){r&1&&(I(0,"li",11)(1,"a",26)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Configuration"),T()()())}function A2(r,e){r&1&&(I(0,"li",11)(1,"a",27)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Allowances"),T()()())}function I2(r,e){r&1&&(I(0,"li",11)(1,"a",28)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Deductions"),T()()())}function M2(r,e){r&1&&(I(0,"li",11)(1,"a",29)(2,"span",13),$(3,"i",14),T(),I(4,"span",15),H(5,"Holiday"),T()()())}function R2(r,e){if(r&1){let t=_n();I(0,"li",30),mt("click",function(){ie(t);let i=ft();return ae(i.toggleDropdownEmployee())}),T()}}function T2(r,e){r&1&&(I(0,"li",34)(1,"a",35)(2,"span"),H(3," \xA0 \xA0Employees"),T()()())}function F2(r,e){r&1&&(I(0,"li",34)(1,"a",36)(2,"span"),H(3," \xA0 \xA0Add Employees"),T()()())}function P2(r,e){if(r&1){let t=_n();I(0,"li",30),mt("click",function(){ie(t);let i=ft();return ae(i.toggleDropdownEmployee())}),I(1,"a",31)(2,"span",13),$(3,"i",14),T(),H(4," Employee Management "),T(),I(5,"ul",32),Lt(6,T2,4,0,"li",33)(7,F2,4,0,"li",33),T()()}if(r&2){let t=ft();q(5),ar("display",t.EmployeeManagment?"block":"none"),q(),it("ngIf",t.displayEmployeeList),q(),it("ngIf",t.displayEmployeeAdd)}}function O2(r,e){r&1&&(I(0,"li",34)(1,"a",37)(2,"span"),H(3," \xA0 \xA0Roles"),T()()())}function N2(r,e){r&1&&(I(0,"li",34)(1,"a",38)(2,"span"),H(3," \xA0 \xA0Add Roles"),T()()())}function L2(r,e){if(r&1){let t=_n();I(0,"li",30),mt("click",function(){ie(t);let i=ft();return ae(i.toggleDropdownRole())}),I(1,"a",31)(2,"span",13),$(3,"i",14),T(),H(4," Role Management "),T(),I(5,"ul",32),Lt(6,O2,4,0,"li",33)(7,N2,4,0,"li",33),T()()}if(r&2){let t=ft();q(5),ar("display",t.roleManagment?"block":"none"),q(),it("ngIf",t.displayRoleList),q(),it("ngIf",t.displayRoleAdd)}}function B2(r,e){if(r&1){let t=_n();I(0,"li",30),mt("click",function(){ie(t);let i=ft();return ae(i.toggleDropdownAttendance())}),T()}}function V2(r,e){r&1&&(I(0,"li",34)(1,"a",39)(2,"span"),H(3," \xA0 \xA0Attendance Sheet"),T()()())}function W2(r,e){r&1&&(I(0,"li",34)(1,"a",40)(2,"span"),H(3," \xA0 \xA0Create Attendance"),T()()())}function z2(r,e){if(r&1){let t=_n();I(0,"li",30),mt("click",function(){ie(t);let i=ft();return ae(i.toggleDropdownAttendance())}),I(1,"a",31)(2,"span",13),$(3,"i",14),T(),H(4," Attendances Management "),T(),I(5,"ul",32),Lt(6,V2,4,0,"li",33)(7,W2,4,0,"li",33),T()()}if(r&2){let t=ft();q(5),ar("display",t.AttendanceManagment?"block":"none"),q(),it("ngIf",t.displayAttendanceUpdate),q(),it("ngIf",t.displayAttendanceCreate)}}var Mv=(()=>{let e=class e{toggleDropdownRole(){this.roleManagment=!this.roleManagment}toggleDropdownEmployee(){this.EmployeeManagment=!this.EmployeeManagment}toggleDropdownAttendance(){this.AttendanceManagment=!this.AttendanceManagment}constructor(n){this.encryptionService=n,this.visibiliyRoleManagment=!1,this.roleManagment=!1,this.displayRoleList=!1,this.displayRoleAdd=!1,this.visibiliyEmployeeManagment=!1,this.EmployeeManagment=!1,this.displayEmployeeList=!1,this.displayEmployeeAdd=!1,this.visibiliyAttendanceManagment=!1,this.AttendanceManagment=!1,this.displayAttendanceList=!1,this.displayAttendanceAdd=!1,this.displayAttendanceUpdate=!1,this.displayAttendanceCreate=!1,this.visibiliyProjectManagment=!1,this.ProjectManagment=!1,this.displayProjectList=!1,this.visibiliyHolidayManagment=!1,this.visibiliyTaskManagment=!1,this.visibiliyConfigManagment=!1,this.visibiliyPayrollManagment=!1}ngOnInit(){let n=localStorage.getItem("authorities"),i=this.encryptionService.decrypt(n,"2f7");i.includes("PAYROLL")&&(this.visibiliyPayrollManagment=!0),i.includes("CONFIG")&&(this.visibiliyConfigManagment=!0),i.includes("PROJECT")&&(this.visibiliyProjectManagment=!0),i.includes("TASK")&&(this.visibiliyTaskManagment=!0),i.includes("HOLIDAY")&&(this.visibiliyHolidayManagment=!0),i.includes("ATTENDANCE")&&(this.visibiliyAttendanceManagment=!0),i.includes("READ::ATTENDANCE")&&(this.displayAttendanceList=!0),i.includes("ADD::ATTENDANCE")&&(this.displayAttendanceAdd=!0),i.includes("EDIT::ATTENDANCE")&&(this.displayAttendanceUpdate=!0),i.includes("CREATE::ATTENDANCE")&&(this.displayAttendanceCreate=!0),i.includes("ROLE")&&(this.visibiliyRoleManagment=!0),i.includes("READ::ROLE")&&(this.displayRoleList=!0),i.includes("ADD::ROLE")&&(this.displayRoleAdd=!0),i.includes("USER")&&(this.visibiliyEmployeeManagment=!0),i.includes("READ::USER")&&(this.displayEmployeeList=!0),i.includes("ADD::USER")&&(this.displayEmployeeAdd=!0)}getPrivileges(){}};e.\u0275fac=function(i){return new(i||e)(rt(ii))},e.\u0275cmp=Et({type:e,selectors:[["app-sidebar"]],decls:44,vars:13,consts:[[1,"pcoded-navbar"],[1,"navbar-wrapper"],[1,"navbar-brand","header-logo"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-collapse","href","javascript:",1,"mobile-menu"],[1,"slimScrollDiv",2,"position","relative","overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"navbar-content","scroll-div",2,"overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"nav","pcoded-inner-navbar"],["data-username","Table bootstrap datatable footable",1,"nav-item"],["routerLink","dashboard",1,"nav-link"],[1,"pcoded-micon"],[1,"feather","icon-server"],[1,"pcoded-mtext"],[1,"nav-item","pcoded-menu-caption"],["data-username","Table bootstrap datatable footable","class","nav-item",4,"ngIf"],["routerLink","department",1,"nav-link"],["class","nav-item pcoded-hasmenu",3,"click",4,"ngIf"],[1,"slimScrollBar",2,"background","rgba(0, 0, 0, 0.5)","width","5px","position","absolute","top","34px","opacity","0.4","display","none","border-radius","7px","z-index","99","right","1px","height","634.318px"],[1,"slimScrollRail",2,"width","5px","height","100%","position","absolute","top","0px","display","none","border-radius","7px","background","rgb(51, 51, 51)","opacity","0.2","z-index","90","right","1px"],["routerLink","projects",1,"nav-link"],["routerLink","tasks",1,"nav-link"],["routerLink","payroll",1,"nav-link"],["routerLink","payroll/payslip",1,"nav-link"],["routerLink","config",1,"nav-link"],["routerLink","allowance",1,"nav-link"],["routerLink","deduction",1,"nav-link"],["routerLink","holiday",1,"nav-link"],[1,"nav-item","pcoded-hasmenu",3,"click"],[1,"nav-item","dropdown-toggle"],[1,"nav-dropdown",2,"width","250px"],["class","nav-item",4,"ngIf"],[1,"nav-item"],["routerLink","users/",1,"nav-link"],["routerLink","users/add",1,"nav-link"],["routerLink","roles/",1,"nav-link"],["routerLink","roles/add",1,"nav-link"],["routerLink","attendance/updateAttendance",1,"nav-link"],["routerLink","attendance/createAttendance",1,"nav-link"]],template:function(i,a){i&1&&(I(0,"nav",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"div",4),$(5,"i",5),T(),I(6,"span",6),H(7,"HRMS"),T()(),I(8,"a",7),$(9,"span"),T()(),I(10,"div",8)(11,"div",9)(12,"ul",10)(13,"li",11)(14,"a",12)(15,"span",13),$(16,"i",14),T(),I(17,"span",15),H(18,"Dashboard"),T()()(),I(19,"li",16)(20,"label"),H(21,"Navigation"),T()(),Lt(22,C2,6,0,"li",17)(23,S2,6,0,"li",17)(24,E2,6,0,"li",17)(25,k2,6,0,"li",17)(26,D2,6,0,"li",17)(27,A2,6,0,"li",17)(28,I2,6,0,"li",17)(29,M2,6,0,"li",17),I(30,"li",11)(31,"a",18)(32,"span",13),$(33,"i",14),T(),I(34,"span",15),H(35,"Department"),T()()(),Lt(36,R2,1,0,"li",19)(37,P2,8,4,"li",19)(38,L2,8,4,"li",19)(39,B2,1,0,"li",19)(40,z2,8,4,"li",19),T()(),$(41,"div",20)(42,"div",21),T()()(),$(43,"router-outlet")),i&2&&(q(22),it("ngIf",a.visibiliyProjectManagment),q(),it("ngIf",a.visibiliyTaskManagment),q(),it("ngIf",a.visibiliyPayrollManagment),q(),it("ngIf",a.visibiliyPayrollManagment),q(),it("ngIf",a.visibiliyConfigManagment),q(),it("ngIf",a.visibiliyConfigManagment),q(),it("ngIf",a.visibiliyConfigManagment),q(),it("ngIf",a.visibiliyHolidayManagment),q(7),it("ngIf",a.visibiliyEmployeeManagment),q(),it("ngIf",a.visibiliyEmployeeManagment),q(),it("ngIf",a.visibiliyRoleManagment),q(),it("ngIf",a.visibiliyAttendanceManagment),q(),it("ngIf",a.visibiliyAttendanceManagment))},dependencies:[un,Vc,ri]});let r=e;return r})();var Rv=(()=>{let e=class e{constructor(n){this.http=n,this.URL="http://localhost:3000/notifications",this.httpOptions={headers:new Bg({"Content-Type":"application/json"})}}createNotification(n){return this.http.post(this.URL,n,this.httpOptions)}readNotification(n){return this.http.patch(`${this.URL}/${n}/read`,null,this.httpOptions)}unreadNotification(n){return this.http.patch(`${this.URL}/${n}/unread`,null,this.httpOptions)}cancelNotification(n){return this.http.patch(`${this.URL}/${n}/cancel`,null,this.httpOptions)}getNotificationsByRecipientId(n){return this.http.get(`${this.URL}/from/recipient/${n}`,this.httpOptions)}getReadNotifications(){return this.http.get(`${this.URL}/read`,this.httpOptions)}readAllNotifications(){return this.http.patch(`${this.URL}/read-all`,null,this.httpOptions)}cancelAllNotifications(){return this.http.patch(`${this.URL}/cancel-all`,null,this.httpOptions)}};e.\u0275fac=function(i){return new(i||e)(nt(or))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function G2(r,e){if(r&1){let t=_n();I(0,"li",56)(1,"div",57)(2,"img",58),mt("click",function(){ie(t);let i=ft(),a=i.$implicit,o=i.index,s=ft();return ae(s.changeStatus(a.id,o))}),T(),I(3,"div",59),mt("click",function(){ie(t);let i=ft(),a=i.$implicit,o=i.index,s=ft();return ae(s.changeStatus(a.id,o))}),I(4,"p")(5,"strong"),H(6),T(),I(7,"span",60),$(8,"i",61),H(9),T()(),I(10,"p"),H(11),T()(),I(12,"div",62)(13,"a",63),mt("click",function(){ie(t);let i=ft().$implicit,a=ft();return ae(a.deleteNotification(i.id))}),$(14,"i",64),T()()()()}if(r&2){let t=ft(),n=t.index,i=t.$implicit,a=ft();ar("background-color",a.readStatus[n]?"white":"greenyellow"),q(6),oe(i.category),q(3),oe(a.getTimeDifference(i.createdAt)),q(2),oe(i.content)}}function q2(r,e){if(r&1&&(I(0,"div"),Lt(1,G2,15,5,"li",55),T()),r&2){let t=e.$implicit;q(),it("ngIf",!t.canceledAt)}}var Y2=r=>({show:r}),Tv=(()=>{let e=class e{getSettings(){this.userService.getSettings(this.email).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}toggleSMS(){this.smsEnabled&&(this.emailEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})),this.smsEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}toggleEmail(){this.emailEnabled&&(this.smsEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})),this.emailEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(n=>{this.smsEnabled=n.smsEnabled,this.emailEnabled=n.emailEnabled},n=>{})}constructor(n,i,a,o,s,c){this.router=n,this.notificationsService=i,this.payrollService=a,this.datePipe=o,this.authService=s,this.userService=c,this.user="",this.data=[],this.readStatus=[],this.isDropdownOpen=!1}ngOnInit(){return en(this,null,function*(){let n=yield localStorage.getItem("user");if(n){let i=JSON.parse(n);this.user=i.firstname+" "+i.lastname,this.payrollService.getUserIdByEmail(i.email).subscribe(a=>{this.id=a.id}),this.email=i.email}this.getSettings(),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(i=>{this.data=i.reverse(),this.readStatus=i.map(a=>a.readAt!=null)}),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(i=>{})})}stopPropagation(n){n.stopPropagation()}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.ngOnInit()}logout(){this.authService.logout().subscribe(()=>{localStorage.clear(),this.router.navigate(["login"])},n=>{}),localStorage.clear(),this.router.navigate(["login"])}changeStatus(n,i){this.readStatus[i]?this.notificationsService.unreadNotification(n).subscribe(a=>{}):this.notificationsService.readNotification(n).subscribe(a=>{}),this.readStatus[i]=!this.readStatus[i]}deleteNotification(n){this.notificationsService.cancelNotification(n).subscribe(i=>{i&&this.ngOnInit()})}clearAll(){this.notificationsService.cancelAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}getTimeDifference(n){let i=new Date;if(n){let a=new Date(n),o=i.getTime()-a.getTime(),s=Math.floor(o/(1e3*60)),c=this.datePipe.transform(new Date(0,0,0,0,s),s<=59?"mm":"HH"),u=c.startsWith("0")?c.substring(1):c;return s<=59?u+" minutes ago":u+" hours ago"}else return null}markAllAsRead(){this.notificationsService.readAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}deleteAll(){this.notificationsService.cancelAllNotifications().subscribe(n=>{n&&this.ngOnInit()})}approveNotification(){}disapproveNotification(){}};e.\u0275fac=function(i){return new(i||e)(rt(ln),rt(Rv),rt(Wc),rt(Nc),rt(Fa),rt(ai))},e.\u0275cmp=Et({type:e,selectors:[["app-navbar"]],decls:87,vars:7,consts:[[1,"navbar","pcoded-header","navbar-expand-lg","navbar-light"],[1,"m-header"],["id","mobile-collapse1","href","javascript:",1,"mobile-menu"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-header","href","javascript:",1,"mobile-menu"],[1,"feather","icon-more-horizontal"],[1,"collapse","navbar-collapse"],[1,"navbar-nav","mr-auto"],["href","javascript:","onclick","javascript:toggleFullScreen()",1,"full-screen"],[1,"feather","icon-maximize"],[1,"nav-item","dropdown"],["href","javascript:","data-toggle","dropdown",1,"dropdown-toggle"],[1,"dropdown-menu"],["href","javascript:",1,"dropdown-item"],[1,"nav-item"],[1,"main-search"],[1,"input-group"],["type","text","id","m-search","placeholder","Search . . .",1,"form-control"],["href","javascript:",1,"input-group-append","search-close"],[1,"feather","icon-x","input-group-text"],[1,"input-group-append","search-btn","btn","btn-primary"],[1,"feather","icon-search","input-group-text"],[1,"navbar-nav","ml-auto"],[1,"dropdown"],["href","javascript:void(0);",1,"dropdown-toggle",3,"click"],[1,"icon","feather","icon-bell"],[1,"dropdown-menu","dropdown-menu-right","notification",3,"ngClass"],[1,"noti-head"],[1,"d-inline-block","m-b-0"],[1,"float-right"],["href","javascript:void(0);",1,"m-r-10",3,"click"],["href","javascript:void(0);",3,"click"],[1,"noti-body"],[4,"ngFor","ngForOf"],[1,"dropdown","drp-user"],[1,"icon","feather","icon-settings"],[1,"dropdown-menu","dropdown-menu-right","profile-notification"],[1,"pro-head"],["src","assets/images/user/avatar-1.jpg","alt","User-Profile-Image",1,"img-radius"],["title","Logout",1,"dud-logout",3,"click"],[1,"feather","icon-log-out"],[1,"pro-body"],["routerLink","profile",1,"dropdown-item"],[1,"feather","icon-user"],["href","",1,"dropdown-item"],[1,"feather","icon-mail"],[1,"dropdown-item"],[1,"feather","icon-settings"],["type","checkbox","id","smsToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],["type","checkbox","id","emailToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],[1,"dropdown-item",3,"click"],[1,"feather","icon-lock"],["class","notification",3,"background-color",4,"ngIf"],[1,"notification"],[1,"media"],["src","assets/images/user/avatar-1.jpg","alt","Generic placeholder image",1,"img-radius",3,"click"],[1,"media-body",3,"click"],[1,"n-time","text-muted"],[1,"icon","feather","icon-clock","m-r-10"],[1,"trash-icon"],["href","javascript:void(0);",1,"delete-btn",3,"click"],[1,"feather","icon-trash"]],template:function(i,a){i&1&&(I(0,"header",0)(1,"div",1)(2,"a",2),$(3,"span"),T(),I(4,"a",3)(5,"div",4),$(6,"i",5),T(),I(7,"span",6),H(8,"Foyer"),T()()(),I(9,"a",7),$(10,"i",8),T(),I(11,"div",9)(12,"ul",10)(13,"li")(14,"a",11),$(15,"i",12),T()(),I(16,"li",13)(17,"a",14),H(18,"Dropdown"),T(),I(19,"ul",15)(20,"li")(21,"a",16),H(22,"Action"),T()(),I(23,"li")(24,"a",16),H(25,"Another action"),T()(),I(26,"li")(27,"a",16),H(28,"Something else here"),T()()()(),I(29,"li",17)(30,"div",18)(31,"div",19),$(32,"input",20),I(33,"a",21),$(34,"i",22),T(),I(35,"span",23),$(36,"i",24),T()()()()(),I(37,"ul",25)(38,"li")(39,"div",26)(40,"a",27),mt("click",function(){return a.toggleDropdown()}),$(41,"i",28),T(),I(42,"div",29)(43,"div",30)(44,"h6",31),H(45,"Notifications"),T(),I(46,"div",32)(47,"a",33),mt("click",function(){return a.markAllAsRead()}),H(48,"mark as read"),T(),I(49,"a",34),mt("click",function(){return a.deleteAll()}),H(50,"clear all"),T()()(),I(51,"ul",35),Lt(52,q2,2,1,"div",36),T()()()(),I(53,"li")(54,"div",37)(55,"a",14),$(56,"i",38),T(),I(57,"div",39)(58,"div",40),$(59,"img",41),I(60,"span"),H(61),T(),I(62,"a",42),mt("click",function(){return a.logout()}),$(63,"i",43),T()(),I(64,"ul",44)(65,"li")(66,"a",45),$(67,"i",46),H(68," Profile"),T()(),I(69,"li")(70,"a",47),$(71,"i",48),H(72," My Messages"),T()(),I(73,"li")(74,"a",49),$(75,"i",50),H(76," 2FA with SMS\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),I(77,"input",51),Mn("ngModelChange",function(s){return In(a.smsEnabled,s)||(a.smsEnabled=s),s}),mt("change",function(){return a.toggleSMS()}),T()()(),I(78,"li")(79,"a",49),$(80,"i",50),H(81," 2FA with Email\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),I(82,"input",52),Mn("ngModelChange",function(s){return In(a.emailEnabled,s)||(a.emailEnabled=s),s}),mt("change",function(){return a.toggleEmail()}),T()()(),I(83,"li")(84,"a",53),mt("click",function(){return a.logout()}),$(85,"i",54),H(86," Logout"),T()()()()()()()()()),i&2&&(q(42),it("ngClass",Mg(5,Y2,a.isDropdownOpen)),q(10),it("ngForOf",a.data),q(9),oe(a.user),q(16),An("ngModel",a.smsEnabled),q(5),An("ngModel",a.emailEnabled))},dependencies:[Oc,ka,un,ri,Ug,dn,Ia],styles:[".notification[_ngcontent-%COMP%]{position:relative;padding:15px}.media[_ngcontent-%COMP%]{display:flex;align-items:center}.media-body[_ngcontent-%COMP%]{flex:1}.trash-icon[_ngcontent-%COMP%]{margin-left:auto}.delete-btn[_ngcontent-%COMP%]{color:red}"]});let r=e;return r})();var Fv=(()=>{let e=class e{constructor(n){this.http=n,this._refreshNeeded$=new Wn}get refreshNeeded(){return this._refreshNeeded$.asObservable()}sendMessage(n){return this.http.post("http://127.0.0.1:5000/predict",{message:n}).pipe(hg(()=>{this._refreshNeeded$.next()}))}};e.\u0275fac=function(i){return new(i||e)(nt(or))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var $2=["chatBox"];function Q2(r,e){if(r&1&&(I(0,"div",16)(1,"div",17)(2,"p",18),H(3),T()(),I(4,"div",19)(5,"p",18),H(6),T()()()),r&2){let t=e.$implicit,n=e.index,i=ft();q(3),oe(t),q(3),oe(i.responseMessages[n])}}var Pv=(()=>{let e=class e{constructor(n,i){this.chatService=n,this.cdr=i,this.isOpen=!1,this.newMessage="",this.messages=[],this.inputMessages$=new _a([]),this.isResponding=!1,this.inputMessages=[],this.responseMessages=[]}toggleChat(){let n=document.getElementById("chat1");n?n.classList.toggle("chat-hidden"):console.error("Chat section not found.")}sendMessage(){return en(this,null,function*(){this.inputMessages.push(this.newMessage);try{let n=yield this.chatService.sendMessage(this.newMessage).toPromise();console.log(n.answer),this.responseMessages.push(n.answer),this.newMessage="",this.cdr.detectChanges()}catch(n){console.error("Error:",n)}})}};e.\u0275fac=function(i){return new(i||e)(rt(Fv),rt(rr))},e.\u0275cmp=Et({type:e,selectors:[["app-recruitement-assistant"]],viewQuery:function(i,a){if(i&1&&Pe($2,5),i&2){let o;ke(o=De())&&(a.chatBox=o.first)}},decls:18,vars:2,consts:[[2,"background-color","#eee"],["id","chatContainer",1,"container","py-2"],[1,"row","d-flex","justify-content-center"],[1,"col-md-8","col-lg-6","col-xl-4"],["id","chat1",1,"card",2,"border-radius","15px"],[1,"card-header","d-flex","justify-content-between","align-items-center","p-3","bg-info","text-white","border-bottom-0",2,"border-top-left-radius","15px","border-top-right-radius","15px"],[1,"fas","fa-angle-left"],[1,"mb-0","fw-bold"],[1,"fas","fa-times"],[1,"card-body"],["class","message",4,"ngFor","ngForOf"],[1,"input-group","mb-3"],["type","text","placeholder","Type your message here...",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"click"],["id","toggleChatBtn",3,"click"],[1,"fas","fa-comments"],[1,"message"],[1,"input-message"],[1,"message-text"],[1,"response-message"]],template:function(i,a){i&1&&(I(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),$(6,"i",6),I(7,"p",7),H(8,"Live chat"),T(),$(9,"i",8),T(),I(10,"div",9),Lt(11,Q2,7,2,"div",10),I(12,"div",11)(13,"input",12),Mn("ngModelChange",function(s){return In(a.newMessage,s)||(a.newMessage=s),s}),T(),I(14,"button",13),mt("click",function(){return a.sendMessage()}),H(15," Send "),T()()()()()()()(),I(16,"button",14),mt("click",function(){return a.toggleChat()}),$(17,"i",15),T()),i&2&&(q(11),it("ngForOf",a.inputMessages),q(2),An("ngModel",a.newMessage))},dependencies:[ka,Rn,dn,Ia],styles:["#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{pointer-events:none;border:1px solid;border-color:#eee;box-sizing:border-box;background:transparent}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-leading[_ngcontent-%COMP%]{left:0;top:0;height:100%;border-right:none;border-radius:.65rem 0 0 .65rem}.user-message[_ngcontent-%COMP%], .system-message[_ngcontent-%COMP%]{text-align:left}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-middle[_ngcontent-%COMP%]{flex:0 0 auto;max-width:calc(100% - 1rem);height:100%;border-right:none;border-left:none}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-trailing[_ngcontent-%COMP%]{flex-grow:1;height:100%;border-left:none;border-radius:0 .65rem .65rem 0}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-leading[_ngcontent-%COMP%]{border-top:.125rem solid #39c0ed;border-bottom:.125rem solid #39c0ed;border-left:.125rem solid #39c0ed}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-leading[_ngcontent-%COMP%], #chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control.active[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-leading[_ngcontent-%COMP%]{border-right:none;transition:all .2s linear}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-middle[_ngcontent-%COMP%]{border-bottom:.125rem solid;border-color:#39c0ed}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-middle[_ngcontent-%COMP%], #chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control.active[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-middle[_ngcontent-%COMP%]{border-top:none;border-right:none;border-left:none;transition:all .2s linear}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-trailing[_ngcontent-%COMP%]{border-top:.125rem solid #39c0ed;border-bottom:.125rem solid #39c0ed;border-right:.125rem solid #39c0ed}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-notch[_ngcontent-%COMP%]   .form-notch-trailing[_ngcontent-%COMP%], #chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control.active[_ngcontent-%COMP%] ~ .form-notch[_ngcontent-%COMP%]   .form-notch-trailing[_ngcontent-%COMP%]{border-left:none;transition:all .2s linear}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus ~ .form-label[_ngcontent-%COMP%]{color:#39c0ed}#chat1[_ngcontent-%COMP%]   .form-outline[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] ~ .form-label[_ngcontent-%COMP%]{color:#bfbfbf}#chatContainer[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:-350px}#toggleChatBtn[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;background-color:#007bff;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:24px;cursor:pointer;box-shadow:0 2px 5px #0000004d}.chat-hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0});let r=e;return r})();var Ov=(()=>{let e=class e{constructor(){}ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Et({type:e,selectors:[["app-home"]],decls:3,vars:0,template:function(i,a){i&1&&$(0,"app-navbar")(1,"app-sidebar")(2,"app-recruitement-assistant")},dependencies:[Mv,Tv,Pv]});let r=e;return r})();var w0=function(r,e){return(w0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function Gn(r,e){function t(){this.constructor=r}w0(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function st(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(u){try{c(n.next(u))}catch(l){a(l)}}function s(u){try{c(n.throw(u))}catch(l){a(l)}}function c(u){u.done?i(u.value):new t(function(l){l(u.value)}).then(o,s)}c((n=n.apply(r,e||[])).next())})}function ct(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(u){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,n=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){o=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(l[0]===6&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=e.call(r,o)}catch(d){l=[6,d],n=0}finally{t=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([c,u])}}}var Z2=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,i=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(a){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];return tS(n,o[0],o[1]),o.join("=")}),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(a){var o=a.split(":"),s=o[0],c=o[1];e.urlFlags[s]=function(u,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+u+".")}(s,c)})}},r}();function tS(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function U(){return C0}var C0=null,pu=new Map,lh=new Map;function S0(r,e){var t=k0(r,e);return pu.get(t)}function eS(r){return lh.get(r)}function Vv(r){for(var e=pu.entries(),t=[];;){var n=e.next(),i=n.done,a=n.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===r&&t.push(s)}return t}function E0(r){var e=r.kernelName,t=r.backendName,n=k0(e,t);if(pu.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");pu.set(n,r)}function nS(r){var e=r.kernelName;lh.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),lh.set(e,r)}function k0(r,e){return e+"_"+r}function Wv(r){for(var e=r.length,t=0,n=0;e>0;)n=Math.random()*e|0,t=r[--e],r[e]=r[n],r[n]=t}function mu(r,e,t){return Math.max(r,Math.min(e,t))}function Rh(r){return r%2==0?r:r+1}function D0(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function A(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Nt(r,e,t){t===void 0&&(t=""),A(_e(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function Xi(r){A(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Nr(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||He(r)&&!t)for(var n=0;n<r.length;++n)Nr(r[n],e,t);else e.push(r);return e}function ut(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function _e(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ce(r){return r%1==0}function A0(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function gu(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Hi(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function dh(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,i){var a=0,o=function(){if(r())n();else{a++;var s=e(a);t!=null&&a>=t?i():setTimeout(o,s)}};o()})}function I0(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var a=r.slice();return a[n]=e/t,a}function Ce(r,e){var t=e.length;return A((r=r==null?e.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),A(r.every(function(n){return ce(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function li(r,e){for(var t=[],n=[],i=e!=null&&Array.isArray(e)&&e.length===0,a=e==null||i?null:Ce(e,r).sort(),o=0,s=0;s<r.length;++s){if(a!=null){if(a[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(a[o]==null||a[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),a[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Ya(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function as(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function M0(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function R0(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function T0(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function He(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function Th(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function F0(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function di(r){return typeof r=="string"||r instanceof String}function P0(r){return typeof r=="boolean"}function O0(r){return typeof r=="number"}function Xa(r){return Array.isArray(r)?Xa(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":O0(r)?"float32":di(r)?"string":P0(r)?"bool":"float32"}function vu(r){return!!(r&&r.constructor&&r.call&&r.apply)}function bu(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function Hn(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function Fh(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Nr(r)),t&&M0(r,e),function(a,o){return a instanceof Float32Array&&o==="float32"||a instanceof Int32Array&&o==="int32"||a instanceof Uint8Array&&o==="bool"}(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function hh(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,i){return n*i});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return function n(i,a,o){var s=new Array;if(a.length===1)for(var c=a[0],u=0;u<c;u++)s[u]=o[i+u];else{c=a[0];var l=a.slice(1),d=l.reduce(function(h,f){return h*f});for(u=0;u<c;u++)s[u]=n(i+u*d,l,o)}return s}(0,r,e)}function Ph(r,e){for(var t=$a(r,e),n=0;n<t.length;n++)t[n]=1;return t}function $a(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function jn(){return U().platform.now()}function Oh(r){r.forEach(function(e){A(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function N0(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",U().platform.encode(r,e)}function os(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",U().platform.decode(r,e)}function fh(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],i=0;i<r.length-1;++i)n+=t[i]*r[i];return n}function L0(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),i=0;i<n.length-1;++i)n[i]=Math.floor(r/t[i]),r-=n[i]*t[i];return n[n.length-1]=r,n}var d3=Object.freeze({shuffle:Wv,clamp:mu,nearestLargerEven:Rh,sum:D0,randUniform:function(r,e){var t=Math.random();return e*t+(1-t)*r},distSquared:function(r,e){for(var t=0,n=0;n<r.length;n++){var i=Number(r[n])-Number(e[n]);t+=i*i}return t},assert:A,assertShapesMatch:Nt,assertNonNull:Xi,flatten:Nr,sizeFromShape:ut,isScalarShape:function(r){return r.length===0},arraysEqual:_e,isInt:ce,tanh:A0,sizeToSquarishShape:gu,createShuffledIndices:function(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return Wv(e),e},rightPad:Hi,repeatedTry:dh,inferFromImplicitShape:I0,parseAxisParam:Ce,squeezeShape:li,getTypedArrayFromDType:Ya,getArrayFromDType:as,checkConversionForErrors:M0,isValidDtype:R0,hasEncodingLoss:T0,isTypedArray:He,bytesPerElement:Th,bytesFromStringArray:F0,isString:di,isBoolean:P0,isNumber:O0,inferDtype:Xa,isFunction:vu,nearestDivisor:bu,computeStrides:Hn,toTypedArray:Fh,toNestedArray:hh,makeOnesTypedArray:Ph,makeZerosTypedArray:$a,now:jn,assertNonNegativeIntegerDimensions:Oh,fetch:function(r,e){return U().platform.fetch(r,e)},encodeString:N0,decodeString:os,locToIndex:fh,indexToLoc:L0}),rS=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new iS)}return r.prototype.profileKernel=function(e,t,n){var i,a=this,o=this.backendTimer.time(function(){i=n()});return i.forEach(function(s){s.data().then(function(c){(function(u,l,d){if(l!=="float32")return!1;for(var h=0;h<u.length;h++){var f=u[h];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+d+"'"),!0}})(c,s.dtype,e),o.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),a.logger.logKernelProfile(e,s,c,u.kernelMs,t,l)})})}),i},r}(),iS=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,a,o){var s=typeof i=="number"?Hi(i+"ms",9):i.error,c=Hi(e,25),u=t.rank,l=t.size,d=Hi(t.shape.toString(),14),h="";for(var f in a){var p=a[f].shape||t.shape,m=p.length;h+=f+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+c+"	%c"+s+"	%c"+u+"D "+d+"	%c"+l+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),zv=20,$o=3,Hd=7;function aS(r,e,t,n){var i=Hn(e),a=function(u,l,d,h){var f=ut(l),p=h[h.length-1],m=new Array(p).fill(0),g=l.length,v=d==="complex64"?Jo(u):u;if(g>1)for(var b=0;b<f/p;b++)for(var _=b*p,y=0;y<p;y++)m[y]=Math.max(m[y],Qo(v[_+y],0,d).length);return m}(r,e,t,i),o=e.length,s=function u(l,d,h,f,p,m){m===void 0&&(m=!0);var g=h==="complex64"?2:1,v=d[0],b=d.length;if(b===0)return h==="complex64"?[Qo(Jo(l)[0],0,h)]:h==="bool"?[B0(l[0])]:[l[0].toString()];if(b===1){if(v>zv){var _=$o*g,y=Array.from(l.slice(0,_)),x=Array.from(l.slice((v-$o)*g,v*g));return h==="complex64"&&(y=Jo(y),x=Jo(x)),["["+y.map(function(O,z){return Qo(O,p[z],h)}).join(", ")+", ..., "+x.map(function(O,z){return Qo(O,p[v-$o+z],h)}).join(", ")+"]"]}return["["+(h==="complex64"?Jo(l):Array.from(l)).map(function(O,z){return Qo(O,p[z],h)}).join(", ")+"]"]}var w=d.slice(1),S=f.slice(1),C=f[0]*g,E=[];if(v>zv){for(var D=0;D<$o;D++){var R=(M=D*C)+C;E.push.apply(E,u(l.slice(M,R),w,h,S,p,!1))}for(E.push("..."),D=v-$o;D<v;D++)R=(M=D*C)+C,E.push.apply(E,u(l.slice(M,R),w,h,S,p,D===v-1))}else for(D=0;D<v;D++){var M;R=(M=D*C)+C,E.push.apply(E,u(l.slice(M,R),w,h,S,p,D===v-1))}var L=b===2?",":"";for(E[0]="["+E[0]+L,D=1;D<E.length-1;D++)E[D]=" "+E[D]+L;var B=`,
`;for(D=2;D<b;D++)B+=`
`;return E[E.length-1]=" "+E[E.length-1]+"]"+(m?"":B),E}(r,e,t,i,a),c=["Tensor"];return n&&(c.push("  dtype: "+t),c.push("  rank: "+o),c.push("  shape: ["+e+"]"),c.push("  values:")),c.push(s.map(function(u){return"    "+u}).join(`
`)),c.join(`
`)}function Qo(r,e,t){return Hi(Array.isArray(r)?parseFloat(r[0].toFixed(Hd))+" + "+parseFloat(r[1].toFixed(Hd))+"j":di(r)?"'"+r+"'":t==="bool"?B0(r):parseFloat(r.toFixed(Hd)).toString(),e)}function B0(r){return r===0?"false":"true"}function Jo(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var ss=function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=ut(e),n!=null){var a=n.length;A(a===this.size,function(){return"Length of values '"+a+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||as(t,this.size),this.strides=Hn(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),A(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var a=this.locToIndex(n);this.values[a]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,a=e;i<a.length;i++){var o=a[i];if(o<0||o>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var c=e[e.length-1],u=0;u<e.length-1;++u)c+=this.strides[u]*e[u];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return lr().makeTensor(this.values,this.shape,this.dtype)},r}(),lr=null,V=null,V0=null,Ut=function(){function r(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ut(e),this.strides=Hn(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,a){return this.throwIfDisposed(),this.reshape([e,t,n,i,a])},r.prototype.asType=function(e){return this.throwIfDisposed(),V.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return st(this,void 0,void 0,function(){var e;return ct(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,V.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return V.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return st(this,void 0,void 0,function(){var e;return ct(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,hh(this.shape,e)]}})})},r.prototype.arraySync=function(){return hh(this.shape,this.dataSync())},r.prototype.data=function(){return st(this,void 0,void 0,function(){var e,t;return ct(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=lr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(i){return os(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var e=lr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return os(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return st(this,void 0,void 0,function(){var e;return ct(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,lr().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(lr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),V.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),V.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),V.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),V.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),V.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),V.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),V.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),aS(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),V.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),V.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),V.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),V.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),V.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),V.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),V.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),V.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),V.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),V.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),V.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,i,a){return n===void 0&&(n=.001),V0("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,a,i,n)},r.prototype.batchNorm=function(e,t,n,i,a){return a===void 0&&(a=.001),this.throwIfDisposed(),V.batchNorm(this,e,t,n,i,a)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),V.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),V.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),V.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),V.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),V.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),V.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),V.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),V.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),V.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),V.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),V.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),V.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),V.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),V.div(this,e)},r.prototype.divNoNan=function(e){return this.throwIfDisposed(),V.divNoNan(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),V.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),V.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),V.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),V.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),V.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),V.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),V.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),V.modStrict(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),V.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),V.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),V.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),V.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),V.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),V.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),V.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),V.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),V.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),V.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),V.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),V.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),V.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),V.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),V.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),V.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),V.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),V.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),V.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),V.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),V.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),V.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),V.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),V.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),V.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),V.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),V.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),V.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),V.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),V.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),V.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),V.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),V.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),V.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),V.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),V.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),V.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),V.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),V.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),V.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),V.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),V.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),V.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),V.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),V.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),V.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),V.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),V.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),V.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),V.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),V.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),V.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),V.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),V.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),V.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),V.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),V.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),V.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),V.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),V.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),V.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),V.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),V.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),V.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),V.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),V.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,a,o){return i===void 0&&(i="NWC"),a===void 0&&(a=1),this.throwIfDisposed(),V.conv1d(this,e,t,n,i,a,o)},r.prototype.conv2d=function(e,t,n,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),V.conv2d(this,e,t,n,i,a,o)},r.prototype.conv2dTranspose=function(e,t,n,i,a){return this.throwIfDisposed(),V.conv2dTranspose(this,e,t,n,i,a)},r.prototype.depthwiseConv2D=function(e,t,n,i,a,o){return i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]),this.throwIfDisposed(),V.depthwiseConv2d(this,e,t,n,i,a,o)},r.prototype.separableConv2d=function(e,t,n,i,a,o){return a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),V.separableConv2d(this,e,t,n,i,a,o)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),V.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),V.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),V.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,a){return this.throwIfDisposed(),V.pool(this,e,t,n,i,a)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),lr().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),V.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),V.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),V.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),V.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,a,o,s,c){return i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),s===void 0&&(s=0),c===void 0&&(c=0),this.throwIfDisposed(),V.stridedSlice(this,e,t,n,i,a,o,s,c)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),V.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),V.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),V.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),V.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),V.spectral.irfft(this)},r}();Object.defineProperty(Ut,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var jv,ph,mh,gh,vh,Gi=function(r){function e(t,n,i,a){var o=r.call(this,t.shape,t.dtype,t.dataId,a)||this;return o.trainable=n,o.name=i,o}return Gn(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!_e(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");lr().disposeTensor(this),this.dataId=t.dataId,lr().incRef(this,null)},e.prototype.dispose=function(){lr().disposeVariable(this),this.isDisposedInternal=!0},e}(Ut);Object.defineProperty(Gi,Symbol.hasInstance,{value:function(r){return r instanceof Ut&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(jv||(jv={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(ph||(ph={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(mh||(mh={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(gh||(gh={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(vh||(vh={}));var oS={float32:gh,int32:ph,bool:mh,complex64:vh};function Oe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return oS[r][e]}function Ud(r){return Oe(r,"int32")}function te(r,e){if(r.dtype===e.dtype)return[r,e];var t=Oe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function W0(r,e){A(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function Nh(r){var e=[];return function t(n,i,a){if(n!=null){if(n instanceof Ut)return void i.push(n);if(o=n,!(!Array.isArray(o)&&typeof o!="object")){var o,s=n;for(var c in s){var u=s[c];a.has(u)||(a.add(u),t(u,i,a))}}}}(r,e,new Set),e}var Gd,h3=Object.freeze({makeTypesMatch:te,assertTypesMatch:W0,isTensorInList:function(r,e){return e.some(function(t){return t.id===r.id})},getTensorsInContainer:Nh}),Hv=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),sS=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Hv}return r.prototype.ready=function(){return st(this,void 0,void 0,function(){var e,t,n;return ct(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return st(this,void 0,void 0,function(){var t,n,i;return ct(this,function(a){switch(a.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=a.sent(),[3,3];case 2:i=n,a.label=3;case 3:if(!i)return[2,!1];a.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new rS(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this;Vv(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this;Vv(e).forEach(function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var a=++this.pendingBackendInitId,o=i.then(function(s){return!(a<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(a<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),a=i.success,o=i.asyncInit;if(o||a)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),i=n.backend,a=this.readSync(t);i.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,i=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun(function(){return i.startScope(a)},function(){return i.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(a){throw t(),a}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},r.prototype.runKernel=function(e,t,n,i,a){return this.runKernelFunc(null,t,null,e,n,i,a)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var i=this.backend.numDataIds(),a=0;n.forEach(function(c){a+=c.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-a-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,i,a,o,s){var c,u=this;o===void 0&&(o=[]),s===void 0&&(s=[]);var l=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var h,f=function(b){d&&(l=b.map(function(_){return u.keep(u.clone(_))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=S0(i,this.backendName);return h=v!=null?function(){var b=u.backend.numDataIds();g=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var _=Array.isArray(g)?g:[g];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,b,_);var y=_.map(function(w){var S=w.dataId,C=w.shape,E=w.dtype;return u.makeTensorFromDataId(S,C,E)}),x=y.filter(function(w,S){return s[S]});return f((o||[]).slice().concat(x)),y}:function(){var b=u.backend.numDataIds();g=u.tidy(function(){return e(u.backend,f)});var _=Array.isArray(g)?g:[g];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,b,_),_},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){c=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(i,t,function(){return h()}):h()}),d&&this.addTapeNode(i,t,c,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(b){return t[b].shape}),outputShapes:c.map(function(b){return b.shape})}),Array.isArray(g)?c:c[0]},r.prototype.makeTensor=function(e,t,n,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var a=e;n==="string"&&di(e[0])&&(a=e.map(function(l){return N0(l)}));var o=i.write(a,t,n),s=new Ut(t,n,o,this.nextTensorId());if(this.incRef(s,i),n==="string"){var c=this.state.tensorInfo.get(o),u=F0(a);this.state.numBytes+=u-c.bytes,c.bytes=u}return s},r.prototype.makeTensorFromDataId=function(e,t,n,i){var a=new Ut(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,i),a},r.prototype.makeVariable=function(e,t,n,i){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var a=new Gi(e,t,n,this.nextTensorId());if(this.state.registeredVariables[a.name]!=null)throw new Error("Variable with name "+a.name+" was already registered");return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*Th(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Gi||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return st(this,void 0,void 0,function(){var t,n;return ct(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(a){return a.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},c=eS(e);c!=null&&(i=c.gradFunc),i!=null&&(s.gradient=function(u){return u=u.map(function(l,d){if(l==null){var h=n[d],f=$a(h.size,h.dtype);return o.makeTensor(f,h.shape,h.dtype)}return l}),i(u.length>1?u:u[0],a)}),this.state.activeTape.push(s)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=Nh(e),i=new Set(n.map(function(c){return c.id})),a=0;a<this.state.activeScope.track.length;a++){var o=this.state.activeScope.track[a];o.kept||i.has(o.id)||o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(c){c.kept||c.scopeId!==s.id||t.track(c)})},r.prototype.gradients=function(e,t,n,i){var a=this;if(i===void 0&&(i=!1),A(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return a.startTape()},function(){return a.endTape()},function(){return a.tidy("forward",e)});A(o instanceof Ut,function(){return"The result y returned by f() must be a tensor."});var s=function(c,u,l){for(var d={},h={},f=0;f<u.length;f++)d[u[f].id]=!0;for(f=0;f<c.length;f++){var p=(w=c[f]).inputs;for(var m in p){for(var g=p[m],v=!1,b=0;b<u.length;b++)if(d[g.id]){w.outputs.forEach(function(D){return d[D.id]=!0}),v=!0,h[w.id]=!0;break}if(v)break}}var _={};_[l.id]=!0;var y={};for(f=c.length-1;f>=0;f--)for(p=(w=c[f]).inputs,b=0;b<w.outputs.length;b++)if(_[w.outputs[b].id]){for(var m in p)_[p[m].id]=!0,y[w.id]=!0;break}var x=[];for(f=0;f<c.length;f++){var w;if(h[(w=c[f]).id]&&y[w.id]){var S={};for(var m in w.inputs){var C=w.inputs[m];d[C.id]&&(S[m]=C)}var E=Object.assign({},w);E.inputs=S,E.outputs=w.outputs,x.push(E)}}return x}(this.state.activeTape,t,o);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,u,l={};l[o.id]=n??(c=o.shape,u=Ph(ut(c),"float32"),P.makeTensor(u,c,"float32")),function(h,f,p){for(var m=function(v){var b=f[v],_=[];if(b.outputs.forEach(function(S){var C=h[S.id];C!=null?_.push(C):_.push(null)}),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var y=b.gradient(_),x=function(S){if(!(S in y))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(y)+".");var C=p(function(){return y[S]()});if(C.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+C.dtype+"'");var E=b.inputs[S];if(!_e(C.shape,E.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+S+"' has shape '"+C.shape+"', which does not match the shape of the input '"+E.shape+"'");if(h[E.id]==null)h[E.id]=C;else{var D=h[E.id];h[E.id]=D.add(C),D.dispose()}};for(var w in b.inputs)x(w)},g=f.length-1;g>=0;g--)m(g)}(l,s,function(h){return a.tidy(h)});var d=t.map(function(h){return l[h.id]});return a.state.gradientDepth===0&&(a.state.activeTape.forEach(function(h){for(var f=0,p=h.saved;f<p.length;f++)p[f].dispose()}),a.state.activeTape=null),{value:o,grads:d}})},r.prototype.customGrad=function(e){var t=this;return A(vu(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];A(i.every(function(s){return s instanceof Ut}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return i.forEach(function(s,c){o[c]=s}),t.runKernelFunc(function(s,c){return A((n=e.apply(void 0,i.concat([c]))).value instanceof Ut,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),A(vu(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},o,function(s,c){var u=n.gradFunc(s,c),l=Array.isArray(u)?u:[u];A(l.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),A(l.every(function(h){return h instanceof Ut}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(h,f){d[f]=function(){return h}}),d})}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.time=function(e){return st(this,void 0,void 0,function(){var t,n;return ct(this,function(i){switch(i.label){case 0:return t=jn(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=jn()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Hv,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),P=function(){var r=function(){if(Gd==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Gd=t}return Gd}();if(r._tfengine==null){var e=new Z2(r);r._tfengine=new sS(e)}return function(t){C0=t}(r._tfengine.ENV),lr=function(){return r._tfengine},r._tfengine}();function z0(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Tr=U();Tr.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Tr.registerFlag("IS_BROWSER",function(){return z0()}),Tr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Tr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Tr.registerFlag("PROD",function(){return!1}),Tr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Tr.getBool("DEBUG")}),Tr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Tr.registerFlag("IS_TEST",function(){return!1});var cs,Cn,wn,Vi={},qd={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function j0(r,e){Vi[r]=e}function pr(r){r in Vi||(Vi[r]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Vi[t]},!1),t===1?n.getContext("webgl",qd)||n.getContext("experimental-webgl",qd):n.getContext("webgl2",qd)}(r));var e=Vi[r];return e.isContextLost()?(delete Vi[r],pr(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Vi[r])}function Mu(r,e){return[e,r]}function rs(r){var e=ut(r);return gu(Math.ceil(e/4))}function ms(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function Lh(r,e){var t,n,i,a,o,s,c,u,l,d=r;return U().getNumber("WEBGL_VERSION")===2?(t=d.R32F,n=d.R16F,i=d.RGBA16F,a=d.RGBA32F,o=d.RED,s=4,c=1,u=d.HALF_FLOAT,l=d.FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,a=d.RGBA,o=r.RGBA,s=4,c=4,u=e!=null?e.HALF_FLOAT_OES:null,l=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:l}}function ot(r,e,t){var n=t();return e&&function(i){var a=i.getError();if(a!==i.NO_ERROR)throw new Error("WebGL Error: "+U0(i,a))}(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(cs||(cs={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(Cn||(Cn={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(wn||(wn={}));var cS=596e-10,uS=65504;function H0(r){return!!(U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||cS<Math.abs(r)&&Math.abs(r)<uS)}function U0(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function ts(r,e,t){return Lr(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function G0(r,e,t){var n=Lr(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ot(r,e,function(){return r.shaderSource(n,t)}),ot(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function q0(r,e,t){var n=Lr(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ot(r,e,function(){return r.shaderSource(n,t)}),ot(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw function(i,a){var o=lS.exec(a);if(o==null)return console.log("Couldn't parse line number in error: "+a),void console.log(i);for(var s=+o[1],c=i.split(`
`),u=c.length.toString().length+2,l=c.map(function(g,v){return Hi((v+1).toString(),u)+g}),d=0,h=0;h<l.length;h++)d=Math.max(l[h].length,d);var f=l.slice(0,s-1),p=l.slice(s-1,s),m=l.slice(s);console.log(f.join(`
`)),console.log(a.split(`
`)[0]),console.log("%c "+Hi(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var su,cu,lS=/ERROR: [0-9]+:([0-9]+):/g;function Y0(r,e){return Lr(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function K0(r,e,t){if(ot(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function uu(r,e,t){if(ot(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function X0(r,e,t){var n=Lr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ot(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),ot(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function $0(r,e,t){var n=Lr(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ot(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),ot(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function Q0(r,e){return Lr(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function J0(r,e){var t=U().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function Z0(r,e){return Lr(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function bh(r,e,t,n,i,a,o,s){var c=r.getAttribLocation(t,n);return c!==-1&&(ot(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),ot(r,e,function(){return r.vertexAttribPointer(c,a,r.FLOAT,!1,o,s)}),ot(r,e,function(){return r.enableVertexAttribArray(c)}),!0)}function tb(r,e,t,n){ab(r,n),ot(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function eb(r,e,t,n){return Lr(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function nb(r,e,t){return r.getUniformLocation(e,t)}function rb(r,e,t,n,i,a){ot(r,e,function(){return tb(r,e,n,a)}),ot(r,e,function(){return r.uniform1i(i,a)})}function lu(r,e,t,n){ot(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),ot(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function yh(r,e,t){ot(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),ot(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function es(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ib(r,e))}function ib(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Lr(r,e,t,n){var i=ot(r,e,function(){return t()});if(i==null)throw new Error(n);return i}function ab(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function us(r,e){return e===void 0&&(e=2),ut(r.slice(0,r.length-e))}function ls(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function du(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[us(r)].concat(ls(r))),e}function ob(r,e){var t;e===void 0&&(e=!1);var n=U().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(u,l){return l>=r.length-2?Rh(r[l]):r[l]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=li(r);r=i.newShape}var a=ut(r);if(r.length<=1&&a<=n)return[1,a];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var o=us(r),s=2,c=2;return r.length&&(s=(t=ls(r))[0],c=t[1]),gu(a=o*(s/2)*(c/2)).map(function(u){return 2*u})}return gu(a)}function Jc(r){return r%2==0}function ns(r,e){if(_e(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||Jc(t)&&Jc(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&Jc(r[0])&&Jc(e[0])}function sb(r){if(su==null){var e=pr(r);su=e.getParameter(e.MAX_TEXTURE_SIZE)}return su}function cb(r){if(cu==null){var e=pr(r);cu=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,cu)}function ub(r){if(r===0)return 0;var e=pr(r);return Sn(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Sn(e,"EXT_disjoint_timer_query")?1:0}function Sn(r,e){return r.getExtension(e)!=null}function xh(r){try{if(pr(r)!=null)return!0}catch{return!1}return!1}function lb(r){if(r===0)return!1;var e=pr(r);if(r===1){if(!Sn(e,"OES_texture_float"))return!1}else if(!Sn(e,"EXT_color_buffer_float"))return!1;return _h(e)}function db(r){if(r===0)return!1;var e=pr(r);if(r!==1){if(Sn(e,"EXT_color_buffer_float"))return _h(e);if(Sn(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(n,i){var a=Lh(n,i),o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,a.internalFormatHalfFloat,1,1,0,a.textureFormatFloat,a.textureTypeHalfFloat,null);var s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);var c=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(o),n.deleteFramebuffer(s),c}(e,t)}return!1}return!!Sn(e,"OES_texture_float")&&!!Sn(e,"WEBGL_color_buffer_float")&&_h(e)}function _h(r){var e=Lh(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),i}function hb(r){return r===2&&pr(r).fenceSync!=null}var dS=Object.freeze({callAndCheck:ot,canBeRepresented:H0,getWebGLErrorMessage:U0,getExtensionOrThrow:ts,createVertexShader:G0,createFragmentShader:q0,createProgram:Y0,linkProgram:K0,validateProgram:uu,createStaticVertexBuffer:X0,createStaticIndexBuffer:$0,getNumChannels:function(){return U().getNumber("WEBGL_VERSION")===2?1:4},createTexture:Q0,validateTextureSize:J0,createFramebuffer:Z0,bindVertexBufferToProgramAttribute:bh,bindTextureUnit:tb,unbindTextureUnit:function(r,e,t){ab(r,t),ot(r,e,function(){return r.activeTexture(r.TEXTURE0+t)}),ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:eb,getProgramUniformLocation:nb,bindTextureToProgramUniformSampler:rb,bindCanvasToFramebuffer:function(r,e){ot(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),ot(r,e,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),ot(r,e,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:lu,unbindColorTextureFromFramebuffer:yh,validateFramebuffer:es,getFramebufferErrorMessage:ib,getBatchDim:us,getRowsCols:ls,getShapeAs3D:du,getTextureShapeFromLogicalShape:ob,isReshapeFree:ns,getWebGLMaxTextureSize:sb,resetMaxTextureSize:function(){su=null},resetMaxTexturesInShader:function(){cu=null},getMaxTexturesInShader:cb,getWebGLDisjointQueryTimerVersion:ub,hasExtension:Sn,isWebGLVersionEnabled:xh,isCapableOfRenderingToFloatTexture:lb,isDownloadFloatTextureEnabled:db,isWebGLFenceEnabled:hb}),vt=U();function fb(r){U().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function K(r,e){return P.tidy(r,e)}function pn(r){Nh(r).forEach(function(e){return e.dispose()})}function hS(r){return P.keep(r)}function yu(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];U().getBool("IS_TEST")||console.warn.apply(console,r)}function fr(r,e){var t=r;if(He(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||He(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&U().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(a,o,s){if(s=s||[],!Array.isArray(a)&&!He(a))return void A(o.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});A(o.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),A(a.length===o[0],function(){return"Element arr["+s.join("][")+"] should have "+o[0]+" elements, but has "+a.length+" elements"});for(var c=o.slice(1),u=0;u<a.length;++u)i(a[u],c,s.concat(u))}(r,n,[]),n}function Uv(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function k(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Ut)return Uv(n,r.dtype,e,t),r;var i=Xa(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),Uv(n,i,e,t),r==null||!He(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var a=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=fr(r,i);He(r)||Array.isArray(r)||(r=[r]);var s=i!=="string"?Fh(r,i,U().getBool("DEBUG")):Nr(r,[],!0);return P.makeTensor(s,o,i)}function xu(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,a){return k(i,e+"["+a+"]",t)},n)}function Bh(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function pb(r,e,t){for(var n=r.length+e.length,i=[],a=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?i.push(r[a++]):i.push(e[o++]);return i}function je(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map(function(a){return r[a]})]}function nn(r,e){return pb(r,e.map(function(t){return 1}),e)}function hn(r,e,t){A(Bh(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function qn(r,e){if(Bh(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(i){return t.push(i)}),t}function Ru(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Yn(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function mb(r,e){var t=r[0].length;r.forEach(function(i,a){A(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+a+"] must be the same as the rank of the rest ("+t+")"})}),A(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(i,a){for(var o=0;o<t;o++)A(o===e||i[o]===n[o],function(){return"Error in concat"+t+"D: Shape of tensors["+a+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+a+"."})})}function qi(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function F(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];P.startScope(t);try{var s=n.apply(void 0,a);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),P.endScope(s),s}catch(c){throw P.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}vt.registerFlag("HAS_WEBGL",function(){return vt.getNumber("WEBGL_VERSION")>0}),vt.registerFlag("WEBGL_VERSION",function(){return xh(2)?2:xh(1)?1:0}),vt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return vt.get("WEBGL_VERSION")===2}),vt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),vt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),vt.registerFlag("WEBGL_PACK",function(){return vt.getBool("HAS_WEBGL")}),vt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_CLIP",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),vt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_PACK_REDUCE",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_CONV_IM2COL",function(){return vt.getBool("WEBGL_PACK")}),vt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return sb(vt.getNumber("WEBGL_VERSION"))}),vt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return cb(vt.getNumber("WEBGL_VERSION"))}),vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=vt.getNumber("WEBGL_VERSION");return r===0?0:ub(r)}),vt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return vt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),vt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return lb(vt.getNumber("WEBGL_VERSION"))}),vt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!vt.getBool("WEBGL_FORCE_F16_TEXTURES")&&vt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),vt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return db(vt.getNumber("WEBGL_VERSION"))}),vt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return hb(vt.getNumber("WEBGL_VERSION"))}),vt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return vt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),V0=fb;var ze=F({complex_:function(r,e){var t=k(r,"real","complex"),n=k(e,"imag","complex");return Nt(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),P.runKernelFunc(function(i){return i.complex(t,n)},{$real:t,$imag:n})}}),Tn=F({real_:function(r){var e=k(r,"input","real");return P.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),dr=F({imag_:function(r){var e=k(r,"input","imag");return P.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Ne(r,e,t){return pi(r,e,fr(r,t),t)}function pi(r,e,t,n){if(n==null&&(n=Xa(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!He(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Oh(e);var i=ut(e),a=ut(t);A(i===a,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+a});for(var o=0;o<t.length;++o){var s=t[o],c=o!==t.length-1||s!==ut(e.slice(o));A(t[o]===e[o]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return He(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?Fh(r,n,U().getBool("DEBUG")):Nr(r,[],!0),P.makeTensor(r,e,n)}function Z(r,e){if((He(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&He(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return pi(r,[],[],e)}function qt(r,e){Xi(r);var t=fr(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pi(r,null,t,e)}function hr(r,e,t){if(Xi(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=fr(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pi(r,e,n,t)}function Tu(r,e,t){if(Xi(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=fr(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return pi(r,e,n,t)}function Ae(r,e,t){if(Xi(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=fr(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return pi(r,e,n,t)}function fS(r,e,t){if(Xi(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=fr(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return pi(r,e,n,t)}function pS(r,e,t){if(Xi(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=fr(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return pi(r,e=e||n,n,t)}function mS(r,e,t,n){return e===void 0&&(e=!0),P.makeVariable(r,e,t,n)}function Qa(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Qa(r,"float32"),n=Kt(r,"float32");return ze(t,n)}var i=Ph(ut(r),e);return P.makeTensor(i,r,e)}function Kt(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Kt(r,"float32"),n=Kt(r,"float32");return ze(t,n)}var i=$a(ut(r),e);return P.makeTensor(i,r,e)}function kn(r,e,t){return P.runKernelFunc(function(n){return n.fill(r,e,t)},{})}function gS(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return P.runKernelFunc(function(n){return n.linspace(r,e,t)},{})}function _u(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Kt([0],n);var i=$a(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+t;return qt(i,n)}var gb=F({onesLike_:function(r){var e=k(r,"x","onesLike");if(e.dtype==="complex64"){var t=gb(Tn(e)),n=Tt(dr(e));return ze(t,n)}return P.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,a){return{$x:function(){return Tt(i)}}})}}),Tt=F({zerosLike_:function(r){var e=k(r,"x","zerosLike");return P.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return Tt(t)}}})}}),Zt=F({concat_:function(r,e){e===void 0&&(e=0),A(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=xu(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=Ce(e,t[0].shape)[0];var n=qi(t.map(function(s){return s.shape}),e);if(ut(n)===0)return Ne([],n);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});mb(i,e);var a=t,o={axis:e};return P.runKernelFunc(function(s){return s.concat(t,e)},a,function(s){var c=i.map(function(u){return u[e]});return Vh(s,c,e).map(function(u){return function(){return u}})},"Concat",o)}}),vS=F({concat1d_:function(r){return Zt(r,0)}}),bS=F({concat2d_:function(r,e){return Zt(r,e)}}),yS=F({concat3d_:function(r,e){return Zt(r,e)}}),xS=F({concat4d_:function(r,e){return Zt(r,e)}}),Vh=F({split_:function(r,e,t){t===void 0&&(t=0);var n,i=k(r,"x","split");return t=Ce(t,i.shape)[0],typeof e=="number"?(A(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(i.shape[t]/e)):(A(i.shape[t]===e.reduce(function(a,o){return a+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),P.runKernelFunc(function(a){return a.split(i,n,t)},{$x:i},function(a){return{$x:function(){return Zt(a,t)}}})}});function $i(r,e){return r(e={exports:{}},e.exports),e.exports}var _S=$i(function(r){(function(e,t,n){function i(s){var c,u=this,l=(c=4022871197,function(d){d=d.toString();for(var h=0;h<d.length;h++){var f=.02519603282416938*(c+=d.charCodeAt(h));f-=c=f>>>0,c=(f*=c)>>>0,c+=4294967296*(f-=c)}return 23283064365386963e-26*(c>>>0)});u.next=function(){var d=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=0|d)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(s),u.s0<0&&(u.s0+=1),u.s1-=l(s),u.s1<0&&(u.s1+=1),u.s2-=l(s),u.s2<0&&(u.s2+=1),l=null}function a(s,c){return c.c=s.c,c.s0=s.s0,c.s1=s.s1,c.s2=s.s2,c}function o(s,c){var u=new i(s),l=c&&c.state,d=u.next;return d.int32=function(){return 4294967296*u.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&(typeof l=="object"&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(0,r,!1)}),wS=$i(function(r){(function(e,t,n){function i(s){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var d=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^d^d>>>8},s===(0|s)?c.x=s:u+=s;for(var l=0;l<u.length+64;l++)c.x^=0|u.charCodeAt(l),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(0,r,!1)}),CS=$i(function(r){(function(e,t,n){function i(s){var c=this,u="";c.next=function(){var d=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^d^d<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(0|s)?c.x=s:u+=s;for(var l=0;l<u.length+64;l++)c.x^=0|u.charCodeAt(l),l==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(0,r,!1)}),SS=$i(function(r){(function(e,t,n){function i(s){var c=this;c.next=function(){var u,l,d=c.x,h=c.i;return u=d[h],l=(u^=u>>>7)^u<<24,l^=(u=d[h+1&7])^u>>>10,l^=(u=d[h+3&7])^u>>>3,l^=(u=d[h+4&7])^u<<7,u=d[h+7&7],l^=(u^=u<<13)^u<<9,d[h]=l,c.i=h+1&7,l},function(u,l){var d,h=[];if(l===(0|l))h[0]=l;else for(l=""+l,d=0;d<l.length;++d)h[7&d]=h[7&d]<<15^l.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],u.x=h,u.i=0,d=256;d>0;--d)u.next()}(c,s)}function a(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,l&&(l.x&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(0,r,!1)}),ES=$i(function(r){(function(e,t,n){function i(s){var c=this;c.next=function(){var u,l,d=c.w,h=c.X,f=c.i;return c.w=d=d+1640531527|0,l=h[f+34&127],u=h[f=f+1&127],l^=l<<13,u^=u<<17,l^=l>>>15,u^=u>>>12,l=h[f]=l^u,c.i=f,l+(d^d>>>16)|0},function(u,l){var d,h,f,p,m,g=[],v=128;for(l===(0|l)?(h=l,l=null):(l+="\0",h=0,v=Math.max(v,l.length)),f=0,p=-32;p<v;++p)l&&(h^=l.charCodeAt((p+32)%l.length)),p===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(m=m+1640531527|0,f=(d=g[127&p]^=h+m)==0?f+1:0);for(f>=128&&(g[127&(l&&l.length||0)]=-1),f=127,p=512;p>0;--p)h=g[f+34&127],d=g[f=f+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,g[f]=h^d;u.w=m,u.X=g,u.i=f}(c,s)}function a(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,l&&(l.X&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(0,r,!1)}),kS=$i(function(r){(function(e,t,n){function i(s){var c=this,u="";c.next=function(){var d=c.b,h=c.c,f=c.d,p=c.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,c.b=d=d<<20^d>>>12^h,c.c=h=h-f|0,c.d=f<<16^h>>>16^p,c.a=p-d|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=0|s):u+=s;for(var l=0;l<u.length+20;l++)c.b^=0|u.charCodeAt(l),c.next()}function a(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&a(l,u),d.state=function(){return a(u,{})}),d}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(0,r,!1)}),Wi=$i(function(r){(function(e,t){var n,i=this,a=256,o=6,s="random",c=t.pow(a,o),u=t.pow(2,52),l=2*u,d=a-1;function h(v,b,_){var y=[],x=m(function C(E,D){var R,M=[],L=typeof E;if(D&&L=="object")for(R in E)try{M.push(C(E[R],D-1))}catch{}return M.length?M:L=="string"?E:E+"\0"}((b=b==1?{entropy:!0}:b||{}).entropy?[v,g(e)]:v??function(){try{var C;return n&&(C=n.randomBytes)?C=C(a):(C=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(C)),g(C)}catch{var E=i.navigator,D=E&&E.plugins;return[+new Date,i,D,i.screen,g(e)]}}(),3),y),w=new f(y),S=function(){for(var C=w.g(o),E=c,D=0;C<u;)C=(C+D)*a,E*=a,D=w.g(1);for(;C>=l;)C/=2,E/=2,D>>>=1;return(C+D)/E};return S.int32=function(){return 0|w.g(4)},S.quick=function(){return w.g(4)/4294967296},S.double=S,m(g(w.S),e),(b.pass||_||function(C,E,D,R){return R&&(R.S&&p(R,w),C.state=function(){return p(w,{})}),D?(t[s]=C,E):C})(S,x,"global"in b?b.global:this==t,b.state)}function f(v){var b,_=v.length,y=this,x=0,w=y.i=y.j=0,S=y.S=[];for(_||(v=[_++]);x<a;)S[x]=x++;for(x=0;x<a;x++)S[x]=S[w=d&w+v[x%_]+(b=S[x])],S[w]=b;(y.g=function(C){for(var E,D=0,R=y.i,M=y.j,L=y.S;C--;)E=L[R=d&R+1],D=D*a+L[d&(L[R]=L[M=d&M+E])+(L[M]=E)];return y.i=R,y.j=M,D})(a)}function p(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function m(v,b){for(var _,y=v+"",x=0;x<y.length;)b[d&x]=d&(_^=19*b[d&x])+y.charCodeAt(x++);return g(b)}function g(v){return String.fromCharCode.apply(0,v)}if(t["seed"+s]=h,m(t.random(),e),r.exports){r.exports=h;try{n=y2()}catch{}}})([],Math)});Wi.alea=_S,Wi.xor128=wS,Wi.xorwow=CS,Wi.xorshift7=SS,Wi.xor4096=ES,Wi.tychei=kS;var Fu=Wi.alea,Wh=function(){function r(e,t,n,i,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=a||Math.random();this.random=Fu(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var a=void 0,o=void 0,s=void 0;do s=(a=2*this.random()-1)*a+(o=2*this.random()-1)*o;while(s>=1||s===0);var c=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*a*c,n=this.mean+this.stdDev*o*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),DS=function(){function r(e,t,n,i){this.alpha=e,this.beta=1/t,this.dtype=n;var a=i||Math.random();this.randu=Fu(a.toString()),this.randn=new Wh(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,i,a,o;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=1-.331*(e=i*i)*e,n=.5*e+this.d*(1-o+Math.log(o)),(a=this.randu())<t||Math.log(a)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),AS=function(){function r(e,t,n,i){var a=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return a.dtype==null||a.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Fu(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function xt(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Oh(r),new ss(r,e,t)}function IS(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var vb=F({batchToSpaceND_:function(r,e,t){var n=k(r,"x","batchToSpaceND"),i=e.reduce(function(a,o){return a*o});return A(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),A(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),A(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),P.runKernelFunc(function(a){return a.batchToSpaceND(n,e,t)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(e,t)}}})}}),MS=F({broadcastTo_:function(r,e){var t=k(r,"broadcastTo","x"),n=t.shape;if(e.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var a=Array.from(e),o=e.length-1;o>=0;o--)if(t.shape[o]===e[o])a[o]=1;else if(t.shape[o]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var s=a.map(function(c,u){return c>1?u:-1}).filter(function(c){return c>=0});return s.length===0?t.clone():P.runKernelFunc(function(c){return c.tile(t,a)},{input:t},function(c){return{input:function(){return c.sum(s,!0)}}})}}),RS=F({cast_:function(r,e){var t=k(r,"x","cast");if(!R0(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return P.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",n)}}),TS=F({clone_:function(r){var e=k(r,"x","clone",null);return P.runKernelFunc(function(){return P.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),FS=F({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=k(r,"x","cumsum"),a=qn([e|=0],i.rank),o=i;a!=null&&(o=i.transpose(a));var s=Yn(1,i.rank)[0],c=P.runKernelFunc(function(u){return u.cumsum(o,s,t,n)},{permutedX:o},function(u){return{permutedX:function(){return u.cumsum(e,t,!n)}}});return a!=null&&(c=c.transpose(a)),c}}),PS=F({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=k(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],a=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];return A(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),A(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+e+` for depthToSpace with input shape
          `+n.shape}),A(o%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape}),P.runKernelFunc(function(s){return s.depthToSpace(n,e,t)},{$x:n})}}),Xe=F({expandDims_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","expandDims",null);A(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&(A(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),an(t,n)}}),bb=F({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=xt([r,e],n),a=r<=e?r:e,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(r,e);if(t==null)return s;if(t.length===1)return Ui(Xe(s,0),[t[0],1,1]);if(t.length===2)return Ui(Xe(Xe(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ui(Xe(Xe(Xe(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),OS=F({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=k(r,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?i.as2D(1,-1):i,c=P.runKernelFunc(function(u){return u.multinomial(s,n,e,t)},{logits2D:s});return o===1?c.as1D():c}}),wh=F({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=k(r,"indices","oneHot","int32"),a=i.shape.concat([e]);return i=i.flatten(),P.runKernelFunc(function(o){return o.oneHot(i,e,t,n)},{$indices:i},function(o){return{$indices:function(){return Kt(i.shape,"float32")}}}).reshape(a)}}),Br=F({pad_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return P.runKernelFunc(function(a){return a.pad(n,e,t)},{x:n},function(a){var o=e.map(function(s){return s[0]});return{x:function(){return a.slice(o,n.shape)}}},"PadV2",i)}}),NS=F({pad1d_:function(r,e,t){return t===void 0&&(t=0),A(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Br(r,[e],t)}}),LS=F({pad2d_:function(r,e,t){return t===void 0&&(t=0),A(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Br(r,e,t)}}),BS=F({pad3d_:function(r,e,t){return t===void 0&&(t=0),A(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Br(r,e,t)}}),VS=F({pad4d_:function(r,e,t){return t===void 0&&(t=0),A(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Br(r,e,t)}}),WS=F({rand_:function(r,e,t){var n=ut(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var a=0;a<n;a++)i[a]=e();return P.makeTensor(i,r,t)}}),zS=F({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new Wh(e,t,n,!1,i),o=xt(r,n),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),jS=F({randomGamma_:function(r,e,t,n,i){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var a=new DS(e,t,n,i),o=xt(r,n),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),yb=F({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var a=xt(r,n),o=new AS(e,t,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),an=F({reshape_:function(r,e){var t=k(r,"x","reshape",null);e=I0(e,t.size),A(t.size===ut(e),function(){return"new shape and old shape must have the same number of elements."});var n={shape:e};return P.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",n)}}),xb=F({spaceToBatchND_:function(r,e,t){var n=k(r,"x","spaceToBatchND");return A(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),A(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),A(n.shape.reduce(function(i,a,o){return o>0&&o<=e.length?i&&(a+t[o-1][0]+t[o-1][1])%e[o-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),P.runKernelFunc(function(i){return i.spaceToBatchND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),_b=F({squeeze_:function(r,e){var t=k(r,"x","squeeze");return an(t,li(t.shape,e).newShape)}}),Ue=F({stack_:function(r,e){e===void 0&&(e=0);var t=xu(r,"tensors","stack");if(A(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,a=t[0].dtype;A(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Nt(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){A(a===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=t.map(function(s){return s.expandDims(e)});return Zt(o,e)}}),Ui=F({tile_:function(r,e){var t=k(r,"x","tile",null);A(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var n=[t],i={reps:e};return P.runKernelFunc(function(a,o){var s=a.tile(t,e);return o([t]),s},{x:t},function(a,o){var s=o[0];return{x:function(){var c=Tt(s);if(s.rank===1)for(var u=0;u<e[0];++u)c=c.add(a.slice([u*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(u=0;u<e[0];++u)for(var l=0;l<e[1];++l)c=c.add(a.slice([u*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(u=0;u<e[0];++u)for(l=0;l<e[1];++l)for(var d=0;d<e[2];++d)c=c.add(a.slice([u*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(u=0;u<e[0];++u)for(l=0;l<e[1];++l)for(d=0;d<e[2];++d)for(var h=0;h<e[3];++h)c=c.add(a.slice([u*s.shape[0],l*s.shape[1],d*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return c}}},"Tile",i,n)}}),HS=F({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var a=new Wh(e,t,n,!0,i),o=xt(r,n),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),zt=F({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=k(r,"x","unstack");A(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var n={axis:e};return P.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return Ue(i,e)}}},"Unpack",n)}}),US=function(r,e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s,c,u,l,d;return ct(this,function(h){switch(h.label){case 0:return t=k(r,"x","setdiff1d"),n=k(e,"y","setdiff1d"),A(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),A(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),A(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return i=h.sent(),[4,n.data()];case 2:for(a=h.sent(),o=new Set(a),s=0,l=0;l<i.length;l++)o.has(i[l])||s++;for(c=new ss([s],t.dtype),u=new ss([s],"int32"),l=0,d=0;l<i.length;l++)o.has(i[l])||(c.values[d]=i[l],u.values[d]=l,d++);return[2,[c.toTensor(),u.toTensor()]]}})})};function wu(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var a=e.length,o=0;o<a;++o)i=i.concat([r[o+1]/e[o],e[o]]);i=i.concat(r.slice(a+1))}return i}function Cu(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var a=[],o=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?o.push(i):a.push(i);n.push.apply(n,a),n.push(0),n.push.apply(n,o)}return n}function Su(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var a=1;a<r.length;++a)a<=e.length?n?i.push(e[a-1]*r[a]):i.push(r[a]/e[a-1]):i.push(r[a]);return i}function wb(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function Cb(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}function zh(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,a=0;a<t.length-1;++a)i*=t[a];var o=r.shape,s=t.slice();s.pop();var c=1;for(a=n;a<r.rank;++a)c*=o[a],s.push(o[a]);var u=Hn(r.shape).map(function(l){return l/c}).concat([1]).slice(0,n);return[s,i,c,u]}var f3=Object.freeze({prepareAndValidate:zh}),jh=30;function hu(r){return r<=jh?r:bu(r,Math.floor(Math.sqrt(r)))}function Sb(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+i+".";if(t.rank<i)throw new Error(a+" update.rank < "+i+". ");if(r.length<n+(t.rank-i))throw new Error(a+" Output shape length < "+(n+(t.rank-i)));if(t.rank!==i+r.length-n)throw new Error(a+" update.rank != "+(i+r.length-n));for(var o=0;o<i;++o)if(t.shape[o]!==e.shape[o])throw new Error(a+" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<t.rank-i;++o)if(t.shape[o+i]!==r[o+n])throw new Error(a+" updates.shape["+(o+i)+"] ("+t.shape[o+i]+") != shape["+(o+i)+"] ("+r[o+i]+")")}function Eb(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}Sb(t,e,r)}function ds(r,e,t){for(var n=e.shape.length,i=n>1?e.shape[n-1]:1,a=t.length,o=1,s=i;s<a;++s)o*=t[s];var c=i<1?1:i;return{sliceRank:i,numUpdates:ut(e.shape)/c,sliceSize:o,strides:Hn(t.slice(0,i)).concat([1]),outputSize:ut(t)}}var p3=Object.freeze({validateUpdateShape:Sb,validateInput:Eb,calculateShapes:ds});function kb(r,e,t){A(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."}),A(r.rank===t.length,function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."});for(var n=function(a){A(e[a]+t[a]<=r.shape[a],function(){return"Error in slice"+r.rank+"D: begin["+a+"] + size["+a+"] ("+(e[a]+t[a])+") would overflow input.shape["+a+"] ("+r.shape[a]+")"})},i=0;i<r.rank;++i)n(i)}function Ch(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function Pu(r,e,t){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((e[i]-r[i])/t[i]);return n}function Db(r,e,t,n,i){var a=e[i],o=t[i]||1;(r&1<<i||a==null)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[i];return a<0&&(a+=s),a=mu(0,a,s-1)}function Ab(r,e,t,n,i){var a=e[i],o=t[i]||1;(r&1<<i||a==null)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[i];return a<0&&(a+=s),a=o>0?mu(0,a,s):mu(-1,a,s-1)}function Hh(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function Uh(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}var m3=Object.freeze({assertParamsValid:kb,maskToAxes:Ch,computeOutShape:Pu,startForAxis:Db,stopForAxis:Ab,isSliceContinous:Hh,computeFlatOffset:Uh});function GS(r,e){A(vu(r),function(){return"The f passed in variableGrads(f) must be a function"}),A(e==null||Array.isArray(e)&&e.every(function(l){return l instanceof Gi}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],P.registeredVariables)e.push(P.registeredVariables[n]);var i=t?e.filter(function(l){return!l.trainable}):null,a=e.length;A((e=e.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var o=P.gradients(r,e,null,!0),s=o.value,c=o.grads;A(c.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),A(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var u={};return e.forEach(function(l,d){c[d]!=null&&(u[l.name]=c[d])}),i?.forEach(function(l){return u[l.name]=null}),{value:s,grads:u}}function Ou(r){return P.customGrad(r)}var on=F({softmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return P.runKernelFunc(function(n,i){var a=n.softmax(t,e);return i([a]),a},{logits:t},function(n,i){var a=i[0],o=n.mul(a);return{logits:function(){return o.sub(o.sum([e],!0).mul(a))}}},"Softmax",{dim:e},[],[!0])}}),qS=F({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=k(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Ou(function(n,i){var a=n.max(e,!0),o=n.sub(a),s=o.toFloat().sub(o.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(c,u){var l=u[0].exp();return c.sub(c.sum(e,!0).mul(l))}}})(t)}}),Ib=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Mb=function(){function r(){}return r.prototype.time=function(e){return N("time")},r.prototype.read=function(e){return N("read")},r.prototype.readSync=function(e){return N("readSync")},r.prototype.numDataIds=function(){return N("numDataIds")},r.prototype.disposeData=function(e){return N("disposeData")},r.prototype.write=function(e,t,n){return N("write")},r.prototype.move=function(e,t,n,i){return N("move")},r.prototype.memory=function(){return N("memory")},r.prototype.floatPrecision=function(){return N("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,i){return N("batchMatMul")},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,N("fusedBatchMatMul")},r.prototype.slice=function(e,t,n){return N("slice")},r.prototype.stridedSlice=function(e,t,n,i){return N("stridedSlice")},r.prototype.unstack=function(e,t){return N("unstack")},r.prototype.reverse=function(e,t){return N("reverse")},r.prototype.concat=function(e,t){return N("concat")},r.prototype.neg=function(e){return N("neg")},r.prototype.add=function(e,t){return N("add")},r.prototype.addN=function(e){return N("addN")},r.prototype.subtract=function(e,t){return N("subtract")},r.prototype.multiply=function(e,t){return N("multiply")},r.prototype.realDivide=function(e,t){return N("realDivide")},r.prototype.floorDiv=function(e,t){return N("floorDiv")},r.prototype.sum=function(e,t){return N("sum")},r.prototype.prod=function(e,t){return N("prod")},r.prototype.unsortedSegmentSum=function(e,t,n){return N("unsortedSegmentSum")},r.prototype.argMin=function(e,t){return N("argMin")},r.prototype.argMax=function(e,t){return N("argMax")},r.prototype.equal=function(e,t){return N("equal")},r.prototype.notEqual=function(e,t){return N("notEqual")},r.prototype.less=function(e,t){return N("less")},r.prototype.lessEqual=function(e,t){return N("lessEqual")},r.prototype.greater=function(e,t){return N("greater")},r.prototype.greaterEqual=function(e,t){return N("greaterEqual")},r.prototype.logicalNot=function(e){return N("logicalNot")},r.prototype.logicalAnd=function(e,t){return N("logicalAnd")},r.prototype.logicalOr=function(e,t){return N("logicalOr")},r.prototype.where=function(e){return N("where")},r.prototype.select=function(e,t,n){return N("select")},r.prototype.topk=function(e,t,n){return N("topk")},r.prototype.min=function(e,t){return N("min")},r.prototype.minimum=function(e,t){return N("minimum")},r.prototype.mod=function(e,t){return N("mod")},r.prototype.max=function(e,t){return N("max")},r.prototype.maximum=function(e,t){return N("maximum")},r.prototype.all=function(e,t){return N("all")},r.prototype.any=function(e,t){return N("any")},r.prototype.squaredDifference=function(e,t){return N("squaredDifference")},r.prototype.ceil=function(e){return N("ceil")},r.prototype.floor=function(e){return N("floor")},r.prototype.round=function(e){return N("round")},r.prototype.sign=function(e){return N("sign")},r.prototype.isNaN=function(e){return N("isNaN")},r.prototype.isInf=function(e){return N("isInf")},r.prototype.isFinite=function(e){return N("isFinite")},r.prototype.pow=function(e,t){return N("pow")},r.prototype.exp=function(e){return N("exp")},r.prototype.expm1=function(e){return N("expm1")},r.prototype.softmax=function(e,t){return N("softmax")},r.prototype.log=function(e){return N("log")},r.prototype.log1p=function(e){return N("log1p")},r.prototype.sqrt=function(e){return N("sqrt")},r.prototype.rsqrt=function(e){return N("rsqrt")},r.prototype.square=function(e){return N("square")},r.prototype.reciprocal=function(e){return N("reciprocal")},r.prototype.relu=function(e){return N("relu")},r.prototype.relu6=function(e){return N("relu6")},r.prototype.prelu=function(e,t){return N("prelu")},r.prototype.elu=function(e){return N("elu")},r.prototype.eluDer=function(e,t){return N("eluDer")},r.prototype.selu=function(e){return N("selu")},r.prototype.int=function(e){return N("int")},r.prototype.clip=function(e,t,n){return N("clip")},r.prototype.abs=function(e){return N("abs")},r.prototype.complexAbs=function(e){return N("complexAbs")},r.prototype.sigmoid=function(e){return N("sigmoid")},r.prototype.softplus=function(e){return N("softplus")},r.prototype.sin=function(e){return N("sin")},r.prototype.cos=function(e){return N("cos")},r.prototype.tan=function(e){return N("tan")},r.prototype.asin=function(e){return N("asin")},r.prototype.acos=function(e){return N("acos")},r.prototype.atan=function(e){return N("atan")},r.prototype.atan2=function(e,t){return N("atan2")},r.prototype.sinh=function(e){return N("sinh")},r.prototype.cosh=function(e){return N("cosh")},r.prototype.tanh=function(e){return N("tanh")},r.prototype.asinh=function(e){return N("asinh")},r.prototype.acosh=function(e){return N("acosh")},r.prototype.atanh=function(e){return N("atanh")},r.prototype.erf=function(e){return N("erf")},r.prototype.step=function(e,t){return N("step")},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,N("fusedConv2d")},r.prototype.conv2d=function(e,t,n){return N("conv2d")},r.prototype.conv2dDerInput=function(e,t,n){return N("conv2dDerInput")},r.prototype.conv2dDerFilter=function(e,t,n){return N("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,N("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(e,t,n){return N("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return N("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return N("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(e,t,n){return N("conv3d")},r.prototype.conv3dDerInput=function(e,t,n){return N("conv3dDerInput")},r.prototype.conv3dDerFilter=function(e,t,n){return N("conv3dDerFilter")},r.prototype.maxPool=function(e,t){return N("maxPool")},r.prototype.maxPoolBackprop=function(e,t,n,i){return N("maxPoolBackprop")},r.prototype.avgPool=function(e,t){return N("avgPool")},r.prototype.avgPoolBackprop=function(e,t,n){return N("avgPoolBackprop")},r.prototype.avgPool3d=function(e,t){return N("avgPool3d")},r.prototype.avgPool3dBackprop=function(e,t,n){return N("avgPool3dBackprop")},r.prototype.maxPool3d=function(e,t){return N("maxPool3d")},r.prototype.maxPool3dBackprop=function(e,t,n,i){return N("maxPool3dBackprop")},r.prototype.reshape=function(e,t){return N("reshape")},r.prototype.cast=function(e,t){return N("cast")},r.prototype.tile=function(e,t){return N("tile")},r.prototype.pad=function(e,t,n){return N("pad")},r.prototype.transpose=function(e,t){return N("transpose")},r.prototype.gather=function(e,t,n){return N("gather")},r.prototype.gatherND=function(e,t){return N("gatherND")},r.prototype.scatterND=function(e,t,n){return N("scatterND")},r.prototype.batchToSpaceND=function(e,t,n){return N("batchToSpaceND")},r.prototype.spaceToBatchND=function(e,t,n){return N("spaceToBatchND")},r.prototype.resizeBilinear=function(e,t,n,i){return N("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(e,t,n){return N("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(e,t,n,i){return N("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return N("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(e,t,n,i,a,o){return N("batchNormalization")},r.prototype.localResponseNormalization4D=function(e,t,n,i,a){return N("localResponseNormalization4D")},r.prototype.LRNGrad=function(e,t,n,i,a,o,s){return N("LRNGrad")},r.prototype.multinomial=function(e,t,n,i){return N("multinomial")},r.prototype.oneHot=function(e,t,n,i){return N("oneHot")},r.prototype.cumsum=function(e,t,n,i){return N("cumsum")},r.prototype.nonMaxSuppression=function(e,t,n,i,a){return N("nonMaxSuppression")},r.prototype.fft=function(e){return N("fft")},r.prototype.ifft=function(e){return N("ifft")},r.prototype.complex=function(e,t){return N("complex")},r.prototype.real=function(e){return N("real")},r.prototype.imag=function(e){return N("imag")},r.prototype.cropAndResize=function(e,t,n,i,a,o){return N("cropAndResize")},r.prototype.depthToSpace=function(e,t,n){return N("depthToSpace")},r.prototype.split=function(e,t,n){return N("split")},r.prototype.sparseToDense=function(e,t,n,i){return N("sparseToDense")},r.prototype.diag=function(e){return N("diag")},r.prototype.fill=function(e,t,n){return N("fill")},r.prototype.onesLike=function(e){return N("onesLike")},r.prototype.zerosLike=function(e){return N("zerosLike")},r.prototype.linspace=function(e,t,n){return N("linspace")},r.prototype.dispose=function(){return N("dispose")},r}();function N(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Or(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var a=t-1-i,o=r[a]||1;(e[e.length-1-i]||1)>1&&o===1&&n.unshift(a)}return n}function we(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],a=e.length-n-1,o=e[a];(i==null||i===1&&o>1)&&t.unshift(a)}return t}function St(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var a=r[r.length-i-1];a==null&&(a=1);var o=e[e.length-i-1];if(o==null&&(o=1),a===1)t.unshift(o);else if(o===1)t.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(a)}}return t}function Ka(r,e,t,n,i,a,o){o===void 0&&(o="channelsLast");var s,c=Eu(e),u=c[0],l=c[1];if(o==="channelsLast")s=[u,l,r[3],r[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);s=[u,l,r[1],r[1]]}return mi(r,s,t,n,i,a,!1,o)}function hs(r,e,t,n,i,a,o){o===void 0&&(o="NDHWC");var s,c,u=Sh(e),l=u[0],d=u[1],h=u[2];if(o==="NDHWC")c="channelsLast",s=[l,d,h,r[4],r[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);c="channelsFirst",s=[l,d,h,r[1],r[1]]}return fs(r,s,t,n,i,!1,c,a)}function mi(r,e,t,n,i,a,o,s){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=[-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],h=c[3];if(s==="channelsLast")u=r[0],l=r[1],d=r[2],h=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=r[0],h=r[1],l=r[2],d=r[3]}var f,p=e[0],m=e[1],g=e[3],v=Eu(t),b=v[0],_=v[1],y=Eu(n),x=y[0],w=y[1],S=Ha(p,x),C=Ha(m,w),E=function(B,O,z,W,j,G,X,et){var at,lt,gt;if(typeof B=="number"){at={top:B,bottom:B,left:B,right:B,type:B===0?"VALID":"NUMBER"};var bt=function(At,Ht,Ot,he,ee){he==null&&(he=Gh(At,Ht,Ot));var ne=At[0],Zn=At[1],tr=is((ne-Ht+2*he)/Ot+1,ee);A(ce(tr),function(){return"The output # of rows ("+tr+") must be an integer. Change the stride and/or zero pad parameters"});var xn=is((Zn-Ht+2*he)/Ot+1,ee);return A(ce(xn),function(){return"The output # of columns ("+xn+") must be an integer. Change the stride and/or zero pad parameters"}),[tr,xn]}([O,z],G,W,B,et);lt=bt[0],gt=bt[1]}else if(B==="same"){lt=Math.ceil(O/W),gt=Math.ceil(z/j);var yt=Math.max(0,(lt-1)*W+G-O),Mt=Math.max(0,(gt-1)*j+X-z),Dt=Math.floor(yt/2),Rt=yt-Dt,be=Math.floor(Mt/2);at={top:Dt,bottom:Rt,left:be,right:Mt-be,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);at={top:0,bottom:0,left:0,right:0,type:"VALID"},lt=Math.ceil((O-G+1)/W),gt=Math.ceil((z-X+1)/j)}return{padInfo:at,outHeight:lt,outWidth:gt}}(i,l,d,b,_,S,C,a),D=E.padInfo,R=E.outHeight,M=E.outWidth,L=o?g*h:g;return s==="channelsFirst"?f=[u,L,R,M]:s==="channelsLast"&&(f=[u,R,M,L]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:d,inChannels:h,outHeight:R,outWidth:M,outChannels:L,padInfo:D,strideHeight:b,strideWidth:_,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:x,dilationWidth:w,inShape:r,outShape:f,filterShape:e}}function fs(r,e,t,n,i,a,o,s){a===void 0&&(a=!1),o===void 0&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],h=c[3],f=c[4];if(o==="channelsLast")u=r[0],l=r[1],d=r[2],h=r[3],f=r[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);u=r[0],f=r[1],l=r[2],d=r[3],h=r[4]}var p,m=e[0],g=e[1],v=e[2],b=e[4],_=Sh(t),y=_[0],x=_[1],w=_[2],S=Sh(n),C=S[0],E=S[1],D=S[2],R=Ha(m,C),M=Ha(g,E),L=Ha(v,D),B=function(X,et,at,lt,gt,bt,yt,Mt,Dt,Rt,be){var At,Ht,Ot,he;if(typeof X=="number"){At={top:X,bottom:X,left:X,right:X,front:X,back:X,type:X===0?"VALID":"NUMBER"};var ee=function(ba,Dr,ld,ya,er,dd){er==null&&(er=Gh(ba,Dr,ya));var g2=ba[0],v2=ba[1],b2=ba[2],hd=is((g2-Dr+2*er)/ya+1,dd);A(ce(hd),function(){return"The output # of depths ("+hd+") must be an integer. Change the stride and/or zero pad parameters"});var fd=is((v2-Dr+2*er)/ya+1,dd);A(ce(fd),function(){return"The output # of rows ("+fd+") must be an integer. Change the stride and/or zero pad parameters"});var pd=is((b2-Dr+2*er)/ya+1,dd);return A(ce(pd),function(){return"The output # of columns ("+pd+") must be an integer. Change the stride and/or zero pad parameters"}),[hd,fd,pd,ld]}([et,at,lt,1],Mt,1,gt,X,be);Ht=ee[0],Ot=ee[1],he=ee[2]}else if(X==="same"){Ht=Math.ceil(et/gt),Ot=Math.ceil(at/bt),he=Math.ceil(lt/yt);var ne=(Ht-1)*gt+Mt-et,Zn=(Ot-1)*bt+Dt-at,tr=(he-1)*yt+Rt-lt,xn=Math.floor(ne/2),va=ne-xn,Er=Math.floor(Zn/2),ti=Zn-Er,kr=Math.floor(tr/2);At={top:Er,bottom:ti,left:kr,right:tr-kr,front:xn,back:va,type:"SAME"}}else{if(X!=="valid")throw Error("Unknown padding parameter: "+X);At={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ht=Math.ceil((et-Mt+1)/gt),Ot=Math.ceil((at-Dt+1)/bt),he=Math.ceil((lt-Rt+1)/yt)}return{padInfo:At,outDepth:Ht,outHeight:Ot,outWidth:he}}(i,l,d,h,y,x,w,R,M,L,s),O=B.padInfo,z=B.outDepth,W=B.outHeight,j=B.outWidth,G=a?b*f:b;return o==="channelsFirst"?p=[u,G,z,W,j]:o==="channelsLast"&&(p=[u,z,W,j,G]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:d,inWidth:h,inChannels:f,outDepth:z,outHeight:W,outWidth:j,outChannels:G,padInfo:O,strideDepth:y,strideHeight:x,strideWidth:w,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:R,effectiveFilterHeight:M,effectiveFilterWidth:L,dilationDepth:C,dilationHeight:E,dilationWidth:D,inShape:r,outShape:p,filterShape:e}}function Gh(r,e,t,n){n===void 0&&(n=1);var i=Ha(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function Eu(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Sh(r){return typeof r=="number"?[r,r,r]:r}function Ha(r,e){return e<=1?r:r+(r-1)*(e-1)}function is(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Yi(r){var e=Eu(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function rn(r,e){return Yi(r)||Yi(e)}function Nu(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function qh(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Kt(r.shape),i=r.toFloat(),a=t.complex(i,n);return n.dispose(),i.dispose(),a}if(!T0(r.dtype,e))return P.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var o=t.real(r);return a=o.cast(e),o.dispose(),a}if(e==="int32")return t.int(r);if(e==="bool"){var s=Z(0,r.dtype);return a=t.notEqual(r,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function ku(r,e){return P.makeTensorFromDataId(r.dataId,e,r.dtype)}function Yh(r,e,t){var n=(e-r)/(t-1),i=$a(t,"float32");i[0]=r;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return qt(i,"float32")}var g3=Object.freeze({castTensor:qh,reshapeTensor:ku,linspaceImpl:Yh,upcastType:Oe,axesAreInnerMostDims:Bh,combineLocations:pb,computeOutAndReduceShapes:je,expandShapeToKeepDim:nn,assertAxesAreInnerMostDims:hn,getAxesPermutation:qn,getUndoAxesPermutation:Ru,getInnerMostAxes:Yn,getBroadcastDims:Or,getReductionAxes:we,assertAndGetBroadcastShape:St,assertParamsConsistent:mb,computeOutShape:qi,computePool2DInfo:Ka,computePool3DInfo:hs,computeConv2DInfo:mi,computeConv3DInfo:fs,computeDefaultPad:Gh,tupleValuesAreOne:Yi,eitherStridesOrDilationsAreOne:rn,convertConv2DDataFormat:Nu,PARALLELIZE_THRESHOLD:jh,computeOptimalWindowSize:hu});function Eh(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function Gv(r,e){return{real:r[2*e],imag:r[2*e+1]}}function YS(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function KS(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function XS(r,e,t){var n=function(a,o,s){return function(c,u,l){for(var d=0,h=c.length,f=0,p=!1;d<h;){var m=l(u,c[f=d+(h-d>>>1)]);m>0?d=f+1:(h=f,p=!m)}return p?d:-d-1}(a,o,s||$S)}(r,e,t),i=n<0?-(n+1):n;r.splice(i,0,e)}function $S(r,e){return r>e?1:r<e?-1:0}function Kh(r,e,t,n,i){return Rb(r,e,t,n,i,0).selectedIndices}function Xh(r,e,t,n,i,a){var o=Rb(r,e,t,n,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Rb(r,e,t,n,i,a,o,s){o===void 0&&(o=!1),s===void 0&&(s=!1);for(var c=Array.from(e).map(function(y,x){return{score:y,boxIndex:x,suppressBeginIndex:0}}).filter(function(y){return y.score>i}).sort(qv),u=a>0?-.5/a:0,l=[],d=[];l.length<t&&c.length>0;){var h=c.pop(),f=h.score,p=h.boxIndex,m=h.suppressBeginIndex;if(f<i)break;for(var g=!1,v=l.length-1;v>=m;--v){var b=QS(r,p,l[v]);if(b>=n){g=!0;break}if(h.score=h.score*JS(n,u,b),h.score<=i)break}h.suppressBeginIndex=l.length,g||(h.score===f?(l.push(p),d.push(h.score)):h.score>i&&XS(c,h,qv))}var _=l.length;return s&&(l.fill(0,_),d.fill(0,_)),{selectedIndices:qt(l,"int32"),selectedScores:qt(d,"float32"),numValidOutputs:Z(_,"int32")}}function QS(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),a=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),c=Math.max(n[1],n[3]),u=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-a)*(c-o),p=(d-u)*(h-l);if(f<=0||p<=0)return 0;var m=Math.max(a,u),g=Math.max(o,l),v=Math.min(s,d),b=Math.min(c,h),_=Math.max(v-m,0)*Math.max(b-g,0);return _/(f+p-_)}function JS(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function qv(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function Tb(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map(function(a){i[t]=a;var o=r.slice(n,i);return n[t]+=a,o})}function Fb(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=xt(t,r.dtype);for(n=0;n<i.values.length;++n){for(var a=i.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=a[s]%r.shape[s];var c=r.locToIndex(o);i.values[n]=r.values[c]}return i.toTensor()}function Pb(r,e,t,n,i){for(var a=e[e.length-1],o=[r.length/a,a],s=o[0],c=o[1],u=Ya(t,s*n),l=Ya("int32",s*n),d=0;d<s;d++){for(var h=d*c,f=r.subarray(h,h+c),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(y,x){return x.value-y.value});var g=d*n,v=u.subarray(g,g+n),b=l.subarray(g,g+n);for(m=0;m<n;m++)v[m]=p[m].value,b[m]=p[m].index}var _=e.slice();return _[_.length-1]=n,[Ne(u,_,t),Ne(l,_,"int32")]}function $h(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=xt(r,"int32"),a=xt([t.length,r.length],"int32");for(n=0;n<t.length;n++){var o=i.indexToLoc(t[n]),s=n*r.length;a.values.set(o,s)}return a.toTensor()}var ZS=function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},tE=function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map(function(i,a){return"T"+a});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},eE=function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,a=r.inSize,o=Math.ceil(a/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=e==="max"?">":"<",c=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Ob(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function fn(r,e){return e===1?[r]:Ob(r,e)}function $e(){var r,e,t,n,i,a,o,s,c,u;return U().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",a="outputColor",o="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",a="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function zi(r,e,t){t===void 0&&(t="index");var n=Hn(e);return n.map(function(i,a){return"int "+r[a]+" = "+t+" / "+i+"; "+(a===n.length-1?"int "+r[a+1]+" = "+t+" - "+r[a]+" * "+i:"index -= "+r[a]+" * "+i)+";"}).join("")}function Qh(r){var e=Hn(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var Nb=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function nE(r,e,t,n){var i=[];r.forEach(function(f){var p=ut(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var a,o,s=i.join(`
`),c=r.map(function(f){return function(p,m,g){g===void 0&&(g=!1);var v="";v+=g?Lb(p):Va(p);var b=p.shapeInfo.logicalShape,_=m.logicalShape;return b.length<=_.length&&(v+=g?function(y,x){var w,S=y.name,C=S.charAt(0).toUpperCase()+S.slice(1),E="get"+C+"AtOutCoords",D=y.shapeInfo.logicalShape.length,R=x.logicalShape.length,M=Or(y.shapeInfo.logicalShape,x.logicalShape),L=Xt(R),B=R-D,O=["x","y","z","w","u","v"];w=D===0?"":R<2&&M.length>=1?"coords = 0;":M.map(function(at){return"coords."+O[at+B]+" = 0;"}).join(`
`);var z="";z=R<2&&D>0?"coords":y.shapeInfo.logicalShape.map(function(at,lt){return"coords."+O[lt+B]}).join(", ");var W="return outputValue;",j=ut(y.shapeInfo.logicalShape)===1,G=ut(x.logicalShape)===1;if(D!==1||j||G){if(j&&!G)W=R===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(M.length){var X=D-2,et=D-1;M.indexOf(X)>-1&&M.indexOf(et)>-1?W="return vec4(outputValue.x);":M.indexOf(X)>-1?W="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":M.indexOf(et)>-1&&(W="return vec4(outputValue.xx, outputValue.zz);")}}else W=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+E+`() {
      `+L+` coords = getOutputCoords();
      `+w+`
      vec4 outputValue = get`+C+"("+z+`);
      `+W+`
    }
  `}(p,m):function(y,x){var w=y.name,S=w.charAt(0).toUpperCase()+w.slice(1),C="get"+S+"AtOutCoords",E=x.texShape,D=y.shapeInfo.texShape,R=y.shapeInfo.logicalShape.length,M=x.logicalShape.length;if(!y.shapeInfo.isUniform&&R===M&&y.shapeInfo.flatOffset==null&&_e(D,E))return`
      float `+C+`() {
        return sampleTexture(`+w+`, resultUV);
      }
    `;var L,B=Xt(M),O=Or(y.shapeInfo.logicalShape,x.logicalShape),z=M-R,W=["x","y","z","w","u","v"];L=R===0?"":M<2&&O.length>=1?"coords = 0;":O.map(function(G){return"coords."+W[G+z]+" = 0;"}).join(`
`);var j="";return j=M<2&&R>0?"coords":y.shapeInfo.logicalShape.map(function(G,X){return"coords."+W[X+z]}).join(", "),`
    float `+C+`() {
      `+B+` coords = getOutputCoords();
      `+L+`
      return get`+S+"("+j+`);
    }
  `}(p,m)),v}(f,e,n)}).join(`
`),u=e.texShape,l=$e(),d=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(l),h=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+rE+`
    `+iE+`
    `+aE+`
  `}(l);return e.isPacked?(a=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(y,x){var w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];return w[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return 2 * (resTexRC.x * `+w[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(y,x){var w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(_e(y,x))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `;var S=Math.ceil(y[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=f,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],b=Math.ceil(m[2]/2),_=b*Math.ceil(m[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(y,x){for(var w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],S=Math.ceil(y[y.length-1]/2),C=S*Math.ceil(y[y.length-2]/2),E=C,D="",R="b, r, c",M=2;M<y.length-1;M++)E*=y[y.length-M-1],D=`
      int b`+M+" = index / "+E+`;
      index -= b`+M+" * "+E+`;
    `+D,R="b"+M+", "+R;return`
    ivec`+y.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+C+`;
      index -= b * `+C+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+y.length+"("+R+`);
    }
  `}(f,p)}var m,g,v,b,_}(e.logicalShape,u),o=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(l)):(a=function(f,p){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,b){return _e(v,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(f,p);case 3:return m=p,g=zi(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,b){var _=zi(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `}(f,p);case 5:return function(v,b){var _=zi(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,p);case 6:return function(v,b){var _=zi(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var m,g}(e.logicalShape,u),o=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),n&&(h+=oE),[h,d,o,s,a,c,t].join(`
`)}function Va(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var a=t.shapeInfo.texShape,o=a[0],s=a[1];if(o===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var c=t.shapeInfo.texShape,u=c[0],l=c[1],d=Li(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+u+", "+l+", "+d+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 1:return function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Na(t)+`
      }
    `;var a=t.shapeInfo.texShape,o=a[0],s=a[1];if(s===1&&o===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var c=Li(n);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+o+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:o===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+s+", index + "+c+`);
      return sampleTexture(`+n+`, uv);
    }
  `}(r);case 2:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(o!=null&&_e(n,o)){var s=o[0],c=o[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var u=li(n),l=u.newShape,d=u.keptDims,h=l;if(h.length<n.length){var f=Wa(t,h);return`
      `+Va(f)+`
      float `+a+`(int row, int col) {
        return `+a+"("+za(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+Na(t)+`
      }
    `;var p=o[0],m=o[1],g=Li(i);return m===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+m+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(r);case 3:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[1]*n[2],s=n[2],c=li(n),u=c.newShape,l=c.keptDims,d=u;if(d.length<n.length){var h=Wa(t,d);return`
        `+Va(h)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+za(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+s+`, 1)));
        `+Na(t)+`
      }
    `;var f=t.shapeInfo.texShape,p=f[0],m=f[1],g=t.shapeInfo.flatOffset;if(m===o&&g==null)return`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(m===s&&g==null)return`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var v=Li(i);return`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+s+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+m+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(r);case 4:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[3],s=n[2]*o,c=n[1]*s,u=li(n),l=u.newShape,d=u.keptDims;if(l.length<n.length){var h=Wa(t,l);return`
      `+Va(h)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+za(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+s+", "+o+`, 1)));
        `+Na(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],g=p[1];if(g===c&&f==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===o&&f==null)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var v=Li(i);return`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+s+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+g+", index + "+v+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 5:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[4],s=n[3]*o,c=n[2]*s,u=n[1]*c,l=li(n),d=l.newShape,h=l.keptDims;if(d.length<n.length){var f=Wa(t,d);return`
      `+Va(f)+`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        return `+a+"("+za(["row","col","depth","depth2","depth3"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+c+", "+s+", "+o+`)) +
          depth3;
        `+Na(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],v=m[1];if(v===u&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+s+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===o&&p==null)return`
      float `+a+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var b=Li(i);return`
    float `+a+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+c+" + depth * "+s+` +
          depth2 * `+o+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+g+", "+v+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);case 6:return function(t){var n=t.shapeInfo.logicalShape,i=t.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),o=li(n),s=o.newShape,c=o.keptDims;if(s.length<n.length){var u=Wa(t,s);return`
      `+Va(u)+`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+a+"("+za(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var l=n[5],d=n[4]*l,h=n[3]*d,f=n[2]*h,p=n[1]*f;if(t.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+f+", "+h+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Na(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,v=g[0],b=g[1];if(b===p&&m==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+h+", "+d+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(b===l&&m==null)return`
      float `+a+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=Li(i);return`
    float `+a+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+f+" + depth * "+h+` +
          depth2 * `+d+" + depth3 * "+l+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+v+", "+b+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Lb(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=$e(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var a=i.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),s=i.shapeInfo.texShape,c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=$e();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+u.texture2D+"("+a+`, uv);
    }
  `}(r);case 2:return function(i){var a=i.shapeInfo.logicalShape,o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),c=i.shapeInfo.texShape,u=c[0],l=c[1],d=$e();if(c!=null&&_e(a,c))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+u+`.0);

        return `+d.texture2D+"("+o+`, uv);
      }
    `;var h=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],f=Math.ceil(a[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+h[0]+", "+h[1]+`, row, col);
      return `+d.texture2D+"("+o+`, uv);
    }
  `}(r);case 3:return function(i){var a=i.shapeInfo.logicalShape,o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),c=i.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(a[0]===1){var l=a.slice(1),d=Wa(i,l);return`
        `+Lb(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+za(["b","row","col"],[1,2])+`);
        }
      `}var h=u[0],f=u[1],p=Math.ceil(a[2]/2),m=p*Math.ceil(a[1]/2),g=$e();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+f+", "+m+", "+p+`, b, row, col);
      return `+g.texture2D+"("+o+`, uv);
    }
  `}(r);default:return function(i){for(var a=i.shapeInfo.logicalShape,o=a.length,s=i.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=l[0],h=l[1],f=Math.ceil(a[o-1]/2),p=f*Math.ceil(a[o-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+f+" + (col / 2)",v=2;v<o-1;v++)m="int b"+v+", "+m,p*=a[o-v-1],g="b"+v+" * "+p+" + "+g;var b=$e();return`
    vec4 `+c+"("+m+`) {
      int index = `+g+`;
      int texR = index / `+h+`;
      int texC = index - texR * `+h+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+h+", "+d+`);
      return `+b.texture2D+"("+s+`, uv);
    }
  `}(r)}}var rE=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iE=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,aE=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,oE=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Li(r){return"offset"+r}function Na(r){var e=r.name,t=ut(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Xt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function Wa(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function za(r,e){return e.map(function(t){return r[t]}).join(", ")}var sE=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],a=Math.ceil(i/e);this.outputShape=r.slice(0,-1),a>1&&this.outputShape.push(a),n||this.variableNames.push("bestIndicesA");var o,s,c=this.outputShape,u=c.length,l=Xt(u),d=fn("coords",u);if(a===1){var h=Xt(s=u+1);o=`
        `+h+" sourceLocR = "+h+"("+d.join()+`, 0);
        ++`+d[u-1]+`;
        `+h+" sourceLocG = "+h+"("+d.join()+`, 0);
        ++`+d[u-2]+`;
        `+h+" sourceLocA = "+h+"("+d.join()+`, 0);
        --`+d[u-1]+`;
        `+h+" sourceLocB = "+h+"("+d.join()+`, 0);
        --`+d[u-2]+";"}else s=u,o=`
        `+l+` sourceLocR = coords;
        ++`+d[u-1]+`;
        `+l+` sourceLocG = coords;
        ++`+d[u-2]+`;
        `+l+` sourceLocA = coords;
        --`+d[u-1]+`;
        `+l+` sourceLocB = coords;
        --`+d[u-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(C){return"int "+C}),g=fn("sourceLocR",s-1).concat("inIdx.r"),v=fn("sourceLocG",s-1).concat("inIdx.g"),b=fn("sourceLocB",s-1).concat("inIdx.b"),_=fn("sourceLocA",s-1).concat("inIdx.a"),y=t==="max"?"greaterThan":"lessThan",x=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",w=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",S=n?"":`
      float getBestIndicesAChannel(`+m.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+m.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+d[u-1]+" < "+(c[u-1]-1)+`;
        bool hasNextRow = `+d[u-2]+" < "+(c[u-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+w+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+x+`
          vec4 candidate = `+w+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+y+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},cE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,o=r.dilationWidth,s=r.effectiveFilterHeight,c=r.effectiveFilterWidth,u=s-1-r.padInfo.top,l=c-1-r.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+l+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},uE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=l-1-r.padInfo.front,p=d-1-r.padInfo.top,m=h-1-r.padInfo.left,g=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+u+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},lE=function(r,e,t,n,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],St(r,e),St(r,t);var o="0.0";n!=null&&(St(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";i!=null&&(St(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+a+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},dE=function(r,e,t,n,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],St(r,e),St(r,t);var o="vec4(0.0)";n!=null&&(St(r,n),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(St(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+a+`));

        setOutput((x - mean) * inv + offset);
      }
    `},hE="return areal * breal - aimag * bimag;",fE="return areal * bimag + aimag * breal;",Yv=function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=St(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Yd="return a + b;",Kd="return a - b;",Kv="return a * b;",Bb="return (a < 0.) ? b * a : a;",ge=function(r,e,t){this.variableNames=["A","B"],this.outputShape=St(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Vb=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Fr=function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=St(e,t);var i=this.outputShape.length,a="";if(n)if(i===0||ut(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          `+Xt(i)+` coords = getOutputCoords();
        `,i===1)a+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=fn("coords",i);a+=`
            bool nextRowOutOfBounds =
              (`+o[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+o[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+a+`

        setOutput(result);
      }
    `},pE=function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),mE=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,a){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(a,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r}(),gE=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},vE=function(r){this.outputShape=[],this.outputShape=qi(r,1),this.variableNames=r.map(function(s,c){return"T"+c});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var a=e.length,o=e[e.length-1];n.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},bE=function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=qi(r,e);var t=this.outputShape,n=t.length,i=Xt(n),a=fn("coords",n),o=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(g,v){return"T"+v});var s=new Array(r.length-1);s[0]=r[0][e];for(var c=1;c<s.length;c++)s[c]=s[c-1]+r[c][e];var u=o[e],l=o.slice(-2),d=o.join(),h="if ("+u+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+l.join()+`));
        }`;for(c=1;c<s.length;c++){var f=s[c-1];h+=`
        if (`+u+" < "+s[c]+"  && "+u+" >= "+s[c-1]+`) {
          return getChannel(
            getT`+c+"("+Zc(o,u,f)+`),
            vec2(`+Zc(l,u,f)+`));
        }`}var p=s.length,m=s[s.length-1];h+=`
        return getChannel(
          getT`+p+"("+Zc(o,u,m)+`),
          vec2(`+Zc(l,u,m)+"));",this.userCode=`
      float getValue(`+o.map(function(g){return"int "+g})+`) {
        `+h+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+a+`), 0., 0., 0.);

        `+a[n-1]+" = "+a[n-1]+` + 1;
        if (`+a[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+a+`);
        }

        `+a[n-2]+" = "+a[n-2]+` + 1;
        if (`+a[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+a+`);
        }

        `+a[n-1]+" = "+a[n-1]+` - 1;
        if (`+a[n-2]+" < "+t[n-2]+` &&
            `+a[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+a+`);
        }
        setOutput(result);
      }
    `};function Zc(r,e,t){var n=r.indexOf(e);return r.map(function(i,a){return a===n?i+" - "+t:i}).join()}var yE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+a+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},xE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=r.dataFormat==="channelsLast",o=e-1-r.padInfo.top,s=t-1-r.padInfo.left,c=a?1:2,u=a?2:3,l=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+u+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+a+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},_E=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,a=r.padInfo.top,o=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+a+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+o+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},wE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,s=e-1-r.padInfo.front,c=t-1-r.padInfo.top,u=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+c+", "+u+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+a+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},CE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,a=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+a+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},SE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,a=e-1-r.padInfo.top,o=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Xv=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,a=r.padInfo.left,o=r.strideHeight,s=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,l=r.filterHeight,d=r.filterWidth,h=4*Math.floor(r.inChannels/4),f=r.inChannels%4,p=r.dataFormat==="channelsLast",m=p?1:2,g=p?2:3,v=p?3:1,b="",_="";t&&(b=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+o+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+m+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+h+`) *
                    getW(wR, wC, `+h+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+h+`, xR, xC) *
                    getW(wR, wC, `+h+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1),
                  getX(batch, xR, xC, `+h+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC),
                  getX(batch, `+h+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+y+`
        `+_+`
        setOutput(result);
      }
    `},EE=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,l=r.filterDepth,d=r.filterHeight,h=r.filterWidth,f=4*Math.floor(r.inChannels/4),p=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`; wC++) {
              int xC = xCCorner + wC * `+u+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},$v=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,a=r.inWidth,o=r.padInfo.top,s=r.padInfo.left,c=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,d=r.dilationWidth,h=r.filterHeight,f=r.filterWidth,p=r.outChannels/r.inChannels,m="",g="";t&&(m=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,g="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+a+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+g+`
        setOutput(result);
      }
    `},Qv=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,a=r.inWidth,o=r.padInfo.top,s=r.padInfo.left,c=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,d=r.dilationWidth,h=r.filterHeight,f=r.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<h;g++)for(var v=0;v<f;v++)m+=`
          vec4 xTexelR`+g+"C"+2*v+` = vec4(0.);
          vec4 wR`+g+"C"+v+` = vec4(0.);
          vec4 xR`+g+"C"+v+" = vec4(0.);";for(g=0;g<h;g++)for(var b=0;b<p;b++){if(m+=`
          xR = xRCorner + `+g*l+`;
          xC = xCCorner + `+(v=2*b)*d+`;
        `,u===1){if(v<f&&(m+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    xTexelR`+g+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+a+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+a+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+`.xy);
                } else {
                  xR`+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+a+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xR`+g+"C"+v+" = xTexelR"+g+"C"+v+`;
              `,v+1<f)){var _=s%2==0?Rh(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+=`
                  xCOffset = xC + `+s%2+" + "+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(m+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+a+`) {
                      xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+v+` = vec4(0.);
                    }
                  `),m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.xy);
                `):m+=`
                  xCOffset = xC + `+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+a+`) {
                    xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+`;
                `}}else v<f&&(m+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(m+=`
                xCOffset = xC + 1 - `+u+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+a+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
              `,v+1<f&&(m+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+u+`;
                  if(xCOffset >= 0 && xCOffset < `+a+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+`.xy, final.xy);
                `)):(m+=`
                if(xC >= 0 && xC < `+a+`) {
                  xTexelR`+g+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+u+`;
                if(xCOffset >= 0 && xCOffset < `+a+`) {
                  xTexelR`+g+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(v+2)+` = vec4(0.);
                }

                xR`+g+"C"+v+` = vec4(
                  xTexelR`+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+`.xy);
              `,v+1<f&&(m+=`
                  xR`+g+"C"+(v+1)+` = vec4(
                    xTexelR`+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+`.zw);
                `)),m+="}");v<f&&(m+=`
            vec4 wTexelR`+g+"C"+v+" = getW("+g+", "+v+`, d1, q);
            wR`+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+`.xz);
          `,v+1<f&&(m+=`
              vec4 wTexelR`+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+`, d1, q);
              wR`+g+"C"+(v+1)+` =
                vec4(wTexelR`+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<h;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var y="",x="";t&&(y=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,x="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+m+`

        vec4 result = dotProd;
        `+w+`
        `+x+`
        setOutput(result);
      }
    `},kE=function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=r[0],o=r[1],s=r[2],c=r[3],u=e[0],l=t[0],d=t[1];this.outputShape=[u,l,d,c];var h=n==="bilinear"?1:0,f=[o-1+".0",s-1+".0"],p=f[0],m=f[1],g=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],b=g[1],_=g[2],y=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],x=y[0],w=y[1],S=y[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+x+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+a+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+w+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+h+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},DE=function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],a=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xt(n)+` coords = getOutputCoords();
        int end = `+Jv(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+a+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+Jv(n,"coords")+` = idx;
          val += getX(`+function(o,s){if(o===1)return""+s;if(o===2)return s+".x, "+s+".y";if(o===3)return s+".x, "+s+".y, "+s+".z";if(o===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function Jv(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var AE=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=cs.DENSE;var e=rs(r),t=$e();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+zi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},IE=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=cs.DENSE;var e=rs(r),t=$e();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+zi(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},ME=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),RE=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},TE=function(r){this.variableNames=["A"],this.outTexUsage=Cn.DOWNLOAD;var e=$e();this.outputShape=r,this.userCode=`
      `+Nb+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},FE=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Cn.DOWNLOAD;var e=$e();this.outputShape=r,this.userCode=`
      `+Nb+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},PE=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=$e(),i=e[0],a=e[1];this.outputShape=r;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+Qh(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+a+`;
        int c = imod(flatIndex, `+a+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},OE=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=$e(),i=e[0],a=e[1];this.outputShape=r;var o="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var l=2*c+u;o+=`
          localCoords = coords;
          if(localCoords[2] + `+u+" < "+r[2]+`) {
            localCoords[2] += `+u+`;
            if(localCoords[1] + `+c+" < "+r[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+a+`;
              c = imod(flatIndex, `+a+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+a+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Qh(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+n.output+" = "+s+`;
      }
    `},NE="return real * expR - imag * expI;",LE="return real * expI + imag * expR;",Zv=function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+a+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},BE=function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r}(),VE=function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=Xt(this.rank),a=function(o,s){var c=o.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<o.length;d++)d===s?l.push("int(getIndices("+u[d]+"))"):l.push(""+u[d]);return l.join()}(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},WE=function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=Xt(e.length),i=Xt(t.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+a+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function Wb(r,e){var t=$e();return G0(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function zb(r,e){return X0(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function jb(r,e){return $0(r,e,new Uint16Array([0,1,2,2,1,3]))}function gs(r,e,t,n,i,a,o){J0(t,n);var s=Q0(r,e),c=r.TEXTURE_2D;return ot(r,e,function(){return r.bindTexture(c,s)}),ot(r,e,function(){return r.texParameteri(c,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),ot(r,e,function(){return r.texParameteri(c,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),ot(r,e,function(){return r.texParameteri(c,r.TEXTURE_MIN_FILTER,r.NEAREST)}),ot(r,e,function(){return r.texParameteri(c,r.TEXTURE_MAG_FILTER,r.NEAREST)}),ot(r,e,function(){return r.texImage2D(c,0,i,t,n,0,a,o,null)}),ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function Hb(r,e,t,n,i){var a=Mu(t,n);return gs(r,e,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function Ub(r,e,t,n,i){var a=Mu(t,n);return gs(r,e,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Gb(r,e,t,n,i){var a=Mu(t,n);return gs(r,e,a[0],a[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function qb(r,e,t,n,i){var a=ms(t,n);return gs(r,e,a[0],a[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function Yb(r,e,t,n,i){var a=ms(t,n);return gs(r,e,a[0],a[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function Kb(r,e,t,n){return ot(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),bh(r,e,t,"clipSpacePos",n,3,20,0)&&bh(r,e,t,"uv",n,2,20,12)}function Xb(r,e,t,n,i,a,o){var s,c,u;ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),a instanceof Uint8Array?(s=new Uint8Array(n*i*4),c=r.UNSIGNED_BYTE,u=r.RGBA):(s=new Float32Array(n*i*4),c=r.FLOAT,u=o.internalFormatPackedFloat),s.set(a),ot(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,u,n,i,0,r.RGBA,c,s)}),ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function $b(r,e,t,n){ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?ot(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):ot(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),ot(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Qb(r,e,t,n,i){var a=r.createBuffer();ot(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var o=16*t*n;return ot(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,o,r.STREAM_READ)}),ot(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),ot(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function Jb(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function Zb(r,e,t,n,i){var a=Mu(t,n),o=a[0],s=a[1],c=new Uint8Array(t*n*4);return ot(r,e,function(){return r.readPixels(0,0,o,s,i.downloadTextureFormat,r.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function ty(r,e,t,n,i,a,o,s){var c=r,u=new Float32Array(function(l,d){var h=ms(l,d);return h[0]*h[1]*4}(a,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function ey(r,e,t,n){var i=new Float32Array(t*n*4);return ot(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)}),i}var zE=Object.freeze({createVertexShader:Wb,createVertexBuffer:zb,createIndexBuffer:jb,createFloat32MatrixTexture:Hb,createFloat16MatrixTexture:Ub,createUnsignedBytesMatrixTexture:Gb,createPackedMatrixTexture:qb,createFloat16PackedMatrixTexture:Yb,bindVertexProgramAttributeStreams:Kb,uploadDenseMatrixToTexture:Xb,uploadPixelDataToTexture:$b,createBufferFromOutputTexture:Qb,downloadFloat32MatrixFromBuffer:Jb,downloadByteEncodedFloatMatrixFromOutputTexture:Zb,downloadPackedMatrixFromBuffer:ty,downloadMatrixFromPackedOutputTexture:ey}),ny=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=U().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,j0(t,e)):this.gl=pr(t);var n="WEBGL_color_buffer_float";if(U().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=ts(this.gl,this.debug,"OES_texture_float"),Sn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ts(this.gl,this.debug,"OES_texture_half_float");else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Sn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ts(this.gl,this.debug,"EXT_color_buffer_half_float");else if(U().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Sn(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Sn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=zb(this.gl,this.debug),this.indexBuffer=jb(this.gl,this.debug),this.framebuffer=Z0(this.gl,this.debug),this.textureConfig=Lh(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return U().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ot(t,this.debug,function(){return t.finish()}),ot(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),ot(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),ot(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),ot(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),ot(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Hb(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Ub(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Gb(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),$b(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),Xb(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Yb(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),qb(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(yh(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ot(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return Zb(i.gl,i.debug,t,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,a,o){return ty(this.gl,e,0,0,0,a,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Jb(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=Qb(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(U().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var s=a.clientWaitSync(o,0,0);return s===a.ALREADY_SIGNALED||s===a.CONDITION_SATISFIED},t=o}else U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return ey(i.gl,i.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=q0(t,this.debug,e),i=Wb(t,this.debug),a=Y0(t,this.debug);return ot(t,this.debug,function(){return t.attachShader(a,i)}),ot(t,this.debug,function(){return t.attachShader(a,n)}),K0(t,this.debug,a),this.debug&&uu(t,this.debug,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=Kb(t,this.debug,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&ot(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&uu(this.gl,this.debug,this.program),ot(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?eb(this.gl,this.debug,e,t):nb(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),ot(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),rb(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=ms(t,n),a=i[0],o=i[1];this.setOutputMatrixTextureDriver(e,a,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&uu(this.gl,this.debug,this.program),es(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ot(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ot(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ts(this.gl,this.debug,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),a=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,a),a},r.prototype.endQuery=function(){if(U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return st(this,void 0,void 0,function(){var t=this;return ct(this,function(n){switch(n.label){case 0:return[4,dh(function(){return t.disposed||t.isQueryAvailable(e,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint}return a=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),a&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=function(n){for(var i=0;i<n.length&&n[i]();++i);return i-1}(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||dh(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),lu(this.gl,this.debug,e,this.framebuffer),this.debug&&es(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(lu(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&es(this.gl)):yh(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;lu(i,this.debug,e,this.framebuffer),this.debug&&es(i),this.outputTexture=e,ot(i,this.debug,function(){return i.viewport(0,0,t,n)}),ot(i,this.debug,function(){return i.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var a=this;this.throwIfDisposed(),ot(this.gl,this.debug,function(){return a.gl.scissor(e,t,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function t0(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var i=t.logicalShape,a=e[n],o=a.shape;if(!_e(i,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+o+" must match");if(!t.isUniform||!a.isUniform){var s=t.texShape,c=a.isUniform?null:a.texData.texShape;if(!_e(s,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+c+" must match")}})}var jE=function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,i=t.inChannels,a=t.strideWidth,o=t.strideHeight,s=t.padInfo,c=t.outWidth,u=t.dilationWidth,l=t.dilationHeight,d=t.dataFormat,h=s.left,f=s.top,p=i*n,m=$e(),g=d==="channelsLast",v=g?0:1,b=g?1:2,_="",y=0;y<=1;y++)for(var x=0;x<=1;x++)_+=`
          blockIndex = rc.y + `+x+`;
          pos = rc.x + `+y+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+o+" - "+f+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+a+". - "+h+`.);
              d1 = offsetX + `+u+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*y+x)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*y+x)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+_+`

        `+m.output+` = result;
      }
    `},HE=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var a,o=e,s=r[3]-1;this.outputShape=r;var c="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+a+`;
        setOutput(val);
      }
    `},UE=function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},GE=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=e,s=r[3]-1;this.outputShape=r;var c="float("+t+") + float("+n+") * sum";a=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+a+`;
        setOutput(result);
      }
    `},qE=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,a=r.effectiveFilterWidth,o=i-1-r.padInfo.top,s=a-1-r.padInfo.left,c=i*a-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+a+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+a+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},YE=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,a=r.dilationHeight,o=r.dilationWidth,s=r.effectiveFilterDepth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,l=s-1-r.padInfo.front,d=c-1-r.padInfo.top,h=u-1-r.padInfo.left,f=s*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+d+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+a+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+u+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+u+` +
                  wR * `+u+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Xd=function(r,e,t,n,i,a,o){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),a===void 0&&(a=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?r[1]:r[2],c=Math.ceil(s/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=n?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";a&&(f=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+a+`
        }`:`vec4 activation(vec4 x) {
          `+a+`
        }`,p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+h[0]+`);
          result += (`+d[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+m+`

        `+p+`

        setOutput(result);
      }
    `},KE=function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r}(),XE=function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},$E=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=fn("rc",e),n=Xt(e),i=function(s,c,u){if(s===1)return"rc > "+c[0];for(var l="",d=s-2;d<s;d++)l+=u[d]+" >= "+c[d],d<s-1&&(l+="||");return l}(e,r,t),a=function(s,c,u,l){if(s===1)return"";var d=l.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+u+`;
  `}(e,r[r.length-1],r[r.length-2],t),o=function(s,c){var u=s.length,l=function(d,h){for(var f=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(p===0?"r":"rp1")+", "+(m===0?"c":"cp1"),v=2;v<d;v++)g=h[h.length-1-v]+","+g;f.push(g)}return f}(u,c);return u===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+a+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},QE=function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(c,u){return c[0]+r[u]+c[1]});var n=r.length,i=Xt(n),a=e.map(function(c){return c[0]}).join(","),o=e.map(function(c,u){return c[0]+r[u]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+a+`);
      `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+a+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},JE=function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(g,v){return g[0]+r[v]+g[1]});for(var n=r.length,i=Xt(n),a=e.map(function(g){return g[0]}).join(","),o=e.map(function(g,v){return g[0]+r[v]}).join(","),s=fn("rc",n),c=fn("source",n),u=s[n-1]+" < "+this.outputShape[n-1],l=n===1?"source":"vec2("+c.slice(-2).join()+")",d=[i+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+u+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+u+") {"],h=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=n===1?2:4;p<m;p++)f+=`
        `+d[p]+`
        if (`+h+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+c.join()+"), "+l+`);
        }
      `;f+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+a+`);
      const `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},$d=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,a=r.strideWidth,o=r.dilationHeight,s=r.dilationWidth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,l=r.padInfo.top,d=r.padInfo.left;this.outputShape=r.outShape;var h=e==="avg",f="0.0";if(h||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+a+`);
        const ivec2 pads = ivec2(`+l+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+u+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+u+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var m=4*Math.floor(n/4),g=n%4,v=`
      if (`+h+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+l+", "+d+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+m+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},Qd=function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideDepth,a=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.front,p=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var g=e==="avg",v="0.0";if(g||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+a+", "+o+`);
        const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+h+`;
                  wC += `+u+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+h+` +
                      wR * `+h+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var _=4*Math.floor(n/4),y=n%4,x=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+a+", "+o+`);
      const ivec3 pads = ivec3(`+f+", "+p+", "+m+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+_+`; wC += 4) {
              int xC = xCCorner + wC * `+u+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+u+`, ch)
              );

              `+x+`
            }

            int xC = xCCorner + `+_+`;
            if (`+(y===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(y===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(y===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                initializationValue
              );

              `+x+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},ZE=function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=Math.ceil(i/t);this.outputShape=[n,a];var o="0.0",s="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",s="min"):e==="max"&&(o="-1.0 / 1e-20",s="max");var c=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");var u=4*Math.floor(t/4),l=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,h="vec4";e==="all"?(o="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):e==="any"&&(o="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(l===1)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===2)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===3)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+c+`);
      }
    `},tk=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+zi(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Qh(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},ek=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],o=r.shape,s=o[1],c=o[2],u=[t&&s>1?i-1:i,t&&c>1?a-1:a],l=[t&&s>1?s-1:s,t&&c>1?c-1:c],d=u[0]/l[0],h=u[1]/l[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(a-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},nk=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],o=r[2],s=r[3];this.outputShape=[i,e,t,s];var c=[n&&e>1?a-1:a,n&&t>1?o-1:o],u=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},rk=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],a=r[1],o=r[2],s=r[3];this.outputShape=[i,e,t,s];var c=[n&&e>1?a-1:a,n&&t>1?o-1:o],u=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`,
          `+c[1]/u[1]+`);
      const vec3 inputShapeRC = vec3(`+a+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},ik=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],a=n[2],o=r.shape,s=o[1],c=o[2],u=[t&&s>1?i-1:i,t&&c>1?a-1:a],l=[t&&s>1?s-1:s,t&&c>1?c-1:c],d=u[0]/l[0],h=u[1]/l[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+m+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+u[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+u[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},ak=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],a=r[1],o=r[2],s=r[3];this.outputShape=[i,e,t,s];var c=[n&&e>1?a-1:a,n&&t>1?o-1:o],u=[n&&e>1?e-1:e,n&&t>1?t-1:t],l=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+a+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},ok=function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(a,o){return function(s){return e.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(o)}).join(","),i=Xt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},sk=function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=fn("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],a=n[t-2]+" + 1 < "+this.outputShape[t-2],o=Xt(t);function s(c){var u=r.map(function(l,d){return function(h,f){return e.indexOf(h)!==-1&&r[h]!==1?r[h]+" - "+f[h]+" - 1":""+f[h]}(d,c)});return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(c){return s(c)}(n.slice())+`;
          if(`+i+`){
            result.g = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",s(c)}(n.slice())+`;
          }
          if(`+a+`) {
            result.b = `+function(c){return c[t-2]="("+c[t-2]+" + 1)",s(c)}(n.slice())+`;
            if(`+i+`) {
              result.a = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",s(c)}(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},e0=function(r,e,t,n,i,a,o){o===void 0&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Xt(i.length),c=Xt(a.length),u="";t===1?u="i":t===2&&(u="i, j");var l="getIndices("+u+")",d="";n===1?d="i":n===2&&(d="i, coords[1]");var h="getUpdates("+d+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+h+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},ck=function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,a=r.numSegments,o=a*Math.ceil(i/t);this.outputShape=[n,o];var s=4*Math.floor(t/4),c=t%4,u=`
        sumValue += dot(values, segFilter);
    `,l="";i%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+a+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+a+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+u+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+u+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+u+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+u+`
        }
        setOutput(sumValue);
      }
    `},uk=function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],c=0;c<e.length;c++)s.push(""+a[c]),c<r&&o.push(""+a[c]);n=o.join(),i=s.join()}var u=Xt(t);this.userCode=`
      void main() {
        `+u+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},lk=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Xt(this.rank),i="uniform int start["+this.rank+"];",a=function(o){if(o===1)return"sourceLoc";if(o<=6)return Jd.slice(0,o).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(o,s){return"sourceLoc."+Jd[s]+" = start["+s+"] + coords."+Jd[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+a+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),Jd=["x","y","z","w","u","v"],dk=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Xt(this.rank),n=fn("coords",this.rank),i=fn("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",o="getChannel(getSource("+i.join()+"), "+a+")",s=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+o+`;
        --`+i[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(l,d){return"start["+d+"]"}).join()+");":e.map(function(l,d){return i[d]+" = "+n[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+u+`
        vec4 result = vec4(0.);
        `+s+`
        `+c+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r}(),hk=function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,i=Xt(t.length),a=Xt(t.length),o="";if(n===1)o="coords * strides + begin";else{var s=0;o=t.map(function(c,u){return s++,t.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(s-1)+"] * strides["+u+"] + begin["+u+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},fk=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,a=n0(t,n),o=r0(e,a,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[o].shift();return this.usedTextures[o].push(s),s}return this.numUsedTextures++,this.log(),a===wn.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===wn.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===wn.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===wn.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===wn.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var a=r0(t,n0(n,i),i);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[a],s=o.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function n0(r,e){if(r===Cn.UPLOAD)return wn.PACKED_2X2_FLOAT32;if(r===Cn.RENDER||r==null)return function(t){return U().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?wn.PACKED_2X2_FLOAT32:wn.UNPACKED_FLOAT32:t?wn.PACKED_2X2_FLOAT16:wn.UNPACKED_FLOAT16}(e);if(r===Cn.DOWNLOAD||r===Cn.PIXELS)return wn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function r0(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var pk=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=Xt(this.rank),a=function(o){var s=o.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+o[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],l=0;l<o.length;l++)u.push("imod("+c[l]+", "+o[l]+")");return u.join()}(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+a+`));
      }
    `},mk=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=Xt(this.rank),a=function(o){var s=o.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(s),l=0;l<o.length;l++)u[o[l]]=c[l];return u.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+a+`));
    }
    `},gk=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Xt(this.rank),a=Ob("rc",this.rank),o=new Array(this.rank);for(n=0;n<e.length;n++)o[e[n]]=a[n];var s="vec2("+o.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+t[this.rank-1],u="getChannel(getA("+o.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+u+`;
      if(`+c+`) {
        result[1] = `+u+`;
      }
      --`+a[this.rank-1]+`;
      if(++`+a[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+u+`;
        if(`+c+`) {
          result[3] = `+u+`;
        }
      }
      setOutput(result);
    }
    `},Jh=1.7580993408473768,Zh=1.0507009873554805,wt=function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Kn="if (isnan(x)) return x;",vk="return x;",i0="return abs(x);",ry=Kn+`
  return (x < 0.0) ? 0.0 : x;
`,iy=Kn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ay="return (x >= 0.0) ? x : (exp(x) - 1.0);",bk=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Jh+`;
  float scale = `+Zh+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,a0="return -x;",o0="return ceil(x);",s0="return floor(x);",c0="return exp(x);",u0="return exp(x) - 1.0;",yk=Kn+`
  return sin(x);
`,xk=Kn+`
  return cos(x);
`,_k=Kn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,wk=Kn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Ck=Kn+`
  return atan(x);
`,Sk=Kn+"return log(x + sqrt(x * x + 1.0));",Ek=Kn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,kk=Kn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,tu="return x;",Dk="return x;",oy=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,sy=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cy=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Zo=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},Ak=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=fn("rc",e),n=Xt(e),i=function(s,c){if(s===1)return"rc";for(var u="",l=0;l<s;l++)u+=c[l],l<s-1&&(u+=",");return u}(e,t),a=t.slice(-2),o=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},eu={};function nu(r,e){if(e===void 0&&(e=!1),r==="linear")return e?Dk:vk;if(r==="relu")return e?oy:ry;if(r==="elu")return e?cy:ay;if(r==="relu6")return e?sy:iy;if(r==="prelu")return e?Vb:Bb;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var Ik=600,uy=function(r){function e(t){var n,i=r.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!U().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var a=pr(U().getNumber("WEBGL_VERSION"));i.binaryCache=((n=U().getNumber("WEBGL_VERSION"))in eu||(eu[n]={}),eu[n]),i.gpgpu=new ny(a),i.canvas=a.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new fk(i.gpgpu),i.numMBBeforeWarning=U().global.screen==null?1024:U().global.screen.height*U().global.screen.width*window.devicePixelRatio*Ik/1024/1024,i.texData=new Ib(i,P),i}return Gn(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,n,i){if(U().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var a={};return this.texData.set(a,{shape:n,dtype:i,values:t,usage:Cn.UPLOAD}),a},e.prototype.move=function(t,n,i,a){if(U().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:a,values:n,usage:Cn.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),i=n.values,a=n.dtype,o=n.complexTensors,s=n.slice,c=n.shape,u=n.isPacked;if(s!=null){var l=void 0;l=u?new Zo(c,tu):new wt(c,tu);var d=this.runWebGLProgram(l,[{dataId:t,shape:c,dtype:a}],a),h=this.readSync(d.dataId);return this.disposeData(d.dataId),h}if(i!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return i;var f,p,m=this.activeTimers!=null;return m&&(f=jn()),a==="complex64"?p=Eh(o.real.dataSync(),o.imag.dataSync()):p=this.getValuesFromTexture(t),m&&(this.downloadWaitMs+=jn()-f),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return st(this,void 0,void 0,function(){var n,i,a,o,s,c,u,l,d,h,f,p,m,g,v,b,_,y,x,w,S,C;return ct(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(D){return n.push(D)})];if(i=this.texData.get(t),a=i.values,o=i.shape,s=i.slice,c=i.dtype,u=i.complexTensors,l=i.isPacked,s!=null)return d=void 0,d=l?new Zo(o,tu):new wt(o,tu),h=this.runWebGLProgram(d,[{dataId:t,shape:o,dtype:c}],c),f=this.read(h.dataId),this.disposeData(h.dataId),[2,f];if(a!=null)return[2,this.convertAndCacheOnCPU(t)];if(!U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&U().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,c!=="complex64"&&U().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,[g.texture].concat(rs(o)))),this.pendingRead.set(t,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return b=E.sent(),_=b[0],y=b[1],v=Eh(_,y),[3,5];case 4:p==null?v=this.getValuesFromTexture(t):(x=ut(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),E.label=5;case 5:return m!=null&&this.disposeData(m.dataId),w=this.convertAndCacheOnCPU(t,v),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach(function(D){return D(w)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,w]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var i=t[n];if(!H0(i))throw U().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,i=this.texData.get(t),a=i.shape,o=i.dtype,s=i.isPacked,c=ut(a);if(U().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),l=this.texData.get(u.dataId),d=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[l.texture].concat(rs(a))).subarray(0,c);return this.disposeData(u.dataId),d}var h=U().getBool("WEBGL_PACK")&&s===!0,f=h?du(a):a,p=h?new FE(f):new TE(f),m=this.runWebGLProgram(p,[{shape:f,dtype:o,dataId:t}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,c);return this.disposeData(m.dataId),v},e.prototype.time=function(t){return st(this,void 0,void 0,function(){var n,i,a,o,s,c,u;return ct(this,function(l){switch(l.label){case 0:return n=this.activeTimers,i=[],a=!1,this.programTimersStack==null?(this.programTimersStack=i,a=!0):this.activeTimers.push(i),this.activeTimers=i,t(),o=Nr(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=Nr(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=n,a&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return u=l.sent(),c.kernelMs=D0(u),c.getExtraProfileInfo=function(){return u.map(function(d,h){return{name:s[h],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:jn(),endMs:null}},e.prototype.endTimer=function(t){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=jn(),t)},e.prototype.getQueryTime=function(t){return st(this,void 0,void 0,function(){var n;return ct(this,function(i){return U().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),i=n.texture,a=n.dtype,o=n.texShape,s=n.usage,c=n.isPacked,u=n.slice,l=u&&u.origDataId||t,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),i!=null&&(this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(i,o,s,c)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return U().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=P.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every(function(a){return i.texData.get(a.dataId).texture==null&&a.size<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:P.keep(t.clone()),imag:P.keep(n.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,i);if(ut(i)===0)return Ne([],i,t.dtype);var a=this.texData.get(t.dataId).isPacked,o=Hh(t.shape,n,i);if(a||!o){var s=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dk(i):new lk(i),c=s.getCustomSetupFunc(n);return this.compileAndRun(s,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,i)},e.prototype.shallowSlice=function(t,n,i){var a=this.texData.get(t.dataId),o=this.makeOutput(i,t.dtype),s=this.texData.get(o.dataId);Object.assign(s,a),s.shape=i,s.dtype=t.dtype;var c=Uh(n,t.strides);a.slice&&(c+=a.slice.flatOffset),s.slice={flatOffset:c,origDataId:a.slice&&a.slice.origDataId||t.dataId};var u=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,u+1),o},e.prototype.stridedSlice=function(t,n,i,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,i,a);var o=Pu(n,i,a);if(o.some(function(c){return c===0}))return Ne([],o);var s=new hk(n,a,o);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,n){var i=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sk(t.shape,n):new ok(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var i=t.map(function(f){return Tn(f)}),a=t.map(function(f){return dr(f)});return ze(this.concat(i,n),this.concat(a,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>U().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),s=this.concat(t.slice(0,o),n),c=this.concat(t.slice(o),n);return this.concat([s,c],n)}if(U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new bE(t.map(function(f){return f.shape}),n);return this.compileAndRun(u,t)}var l=qi(t.map(function(f){return f.shape}),n),d=t.map(function(f){return f.as2D(-1,ut(f.shape.slice(n)))}),h=new vE(d.map(function(f){return f.shape}));return this.compileAndRun(h,d).reshape(l)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,a0,t.dtype);var n=new wt(t.shape,a0);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,i,a){var o=i?t.shape[2]:t.shape[1],s=a?n.shape[1]:n.shape[2],c=i?t.shape[1]:t.shape[2],u=t.shape[0];if((o===1||s===1)&&c>1e3){i&&(t=t.transpose([0,2,1])),a&&(n=n.transpose([0,2,1]));var l=s===1?t:t.as3D(u,c,1),d=s===1?2:1,h=s===1?n.as3D(u,1,c):n;return this.multiply(l,h).sum(d,!0)}var f=Oe(t.dtype,n.dtype),p=new Xd(t.shape,[u,o,s],i,a);return this.compileAndRun(p,[t,n],f)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,o=t.transposeB,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=a?n.shape[2]:n.shape[1],d=o?i.shape[1]:i.shape[2],h=n.shape[0],f=Oe(n.dtype,i.dtype),p=s!=null,m=u!=null,g=c?nu(c,!0):null,v=new Xd(n.shape,[h,l,d],a,o,p,g,m),b=[n,i];return s&&b.push(s),u&&b.push(u),this.compileAndRun(v,b,f)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),a=this.texData.get(n.dataId),o=new Yv(hE,t.shape,n.shape),s=new Yv(fE,t.shape,n.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,a.complexTensors.real),this.makeComplexComponentTensorInfo(n,a.complexTensors.imag)],u=this.compileAndRun(o,c),l=this.compileAndRun(s,c),d=this.complex(u,l);return u.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Kv,t.dtype);var h=new ge(Kv,t.shape,n.shape);return this.compileAndRun(h,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,i,a,o,s){var c=[t,n,i],u=null;s!=null&&(u=s.shape,c.push(s));var l=null;if(o!=null&&(l=o.shape,c.push(o)),U().getBool("WEBGL_PACK_NORMALIZATION")){var d=new dE(t.shape,n.shape,i.shape,u,l,a);return this.compileAndRun(d,c)}var h=new lE(t.shape,n.shape,i.shape,u,l,a);return this.compileAndRun(h,c)},e.prototype.localResponseNormalization4D=function(t,n,i,a,o){var s=U().getBool("WEBGL_PACK_NORMALIZATION")?new GE(t.shape,n,i,a,o):new HE(t.shape,n,i,a,o);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,n,i,a,o,s,c){var u=new UE(n.shape,a,o,s,c);return this.compileAndRun(u,[n,i,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(o){return os(o)});return Fb(xt(t.shape,t.dtype,i),n)}var a=new pk(t.shape,n);return this.compileAndRun(a,[t])},e.prototype.pad=function(t,n,i){var a=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JE(t.shape,n,i):new QE(t.shape,n,i);return this.compileAndRun(a,[t])},e.prototype.transpose=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,n);var i=U().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gk(t.shape,n):new mk(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,n,i){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,i);var a=new VE(t.shape,n.size,i);return this.compileAndRun(a,[t,n])},e.prototype.batchToSpaceND=function(t,n,i){A(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(d,h){return d*h}),o=wu(t.shape,n,a),s=Cu(o.length,n.length),c=Su(t.shape,n,a),u=wb(i,n.length),l=Cb(c,i,n.length);return t.reshape(o).transpose(s).reshape(c).slice(u,l)},e.prototype.spaceToBatchND=function(t,n,i){A(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var a=n.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,i);for(var s=1+n.length;s<t.shape.length;++s)o.push([0,0]);var c=t.pad(o),u=wu(c.shape,n,a,!1),l=Cu(u.length,n.length,!1),d=Su(c.shape,n,a,!1);return c.reshape(u).transpose(l).reshape(d)},e.prototype.reduce=function(t,n,i){var a=t.shape[0],o=t.shape[1],s=hu(o),c=new ZE({windowSize:s,inSize:o,batchSize:a},n),u=this.compileAndRun(c,[t],i);return u.shape[1]===1?u:this.reduce(u,n,i)},e.prototype.argReduce=function(t,n,i){i===void 0&&(i=null);var a=t.shape[0],o=t.shape[1];i!=null&&(a=i.shape[0],o=i.shape[1]);var s=hu(o),c=new eE({windowSize:s,inSize:o,batchSize:a},n,i==null),u=[t];i!=null&&u.push(i);var l=this.compileAndRun(c,u,"int32");return l.shape[1]===1?l:this.argReduce(t,n,l)},e.prototype.argReducePacked=function(t,n,i){i===void 0&&(i=null);var a=i!=null?i.shape:t.shape,o=hu(a[a.length-1]),s=new sE(a,o,n,i==null),c=i==null?[t]:[t,i],u=this.compileAndRun(s,c,"int32");return u.rank===t.rank?this.argReducePacked(t,n,u):u},e.prototype.sum=function(t,n){hn("sum",n,t.rank);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o),c=Ud(t.dtype);return this.reduce(s,"sum",c).reshape(a)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o),c=Ud(t.dtype);return this.reduce(s,"prod",c).reshape(a)},e.prototype.unsortedSegmentSum=function(t,n,i){var a=0,o=qn([a],t.rank),s=t;o!=null&&(s=t.transpose(o),a=Yn(1,t.rank)[0]);var c=function(f,p,m){for(var g=[],v=f.length,b=0;b<v;b++)b!==p?g.push(f[b]):g.push(m);return g}(s.shape,a,i),u=ut([s.shape[a]]),l=s.as2D(-1,u),d=Ud(t.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",n,d,i).reshape(c);return o!=null&&(h=h.transpose(Ru(o))),h},e.prototype.segOpCompute=function(t,n,i,a,o){var s=t.shape[0],c=t.shape[1],u=function(h,f){var p,m=!1;for(h<=jh?(p=h,m=!0):p=bu(h,Math.floor(Math.sqrt(h)));!m;)p>f||p===h?m=!0:p=bu(h,p+1);return p}(c,o),l=new ck({windowSize:u,inSize:c,batchSize:s,numSegments:o},n),d=this.compileAndRun(l,[t,i],a);return d.shape[1]===o?d:(i=_u(0,o).tile([c/u]),this.segOpCompute(d,n,i,a,o))},e.prototype.argMinMaxReduce=function(t,n,i){var a=[n];if(hn("arg"+i.charAt(0).toUpperCase()+i.slice(1),a,t.rank),!U().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=je(t.shape,a),s=o[0],c=ut(o[1]),u=t.as2D(-1,c);return this.argReduce(u,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,i,a){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var o=new DE(t.shape,i,a);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var i=new ge("return float(a == b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new ge("return float(a != b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new ge("return float(a < b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new ge("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new ge("return float(a > b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new ge("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new wt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new ge("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new ge("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.select=function(t,n,i){var a=new uk(t.rank,n.shape,n.rank);return this.compileAndRun(a,[t,n,i],Oe(n.dtype,i.dtype))},e.prototype.where=function(t){yu("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return $h(t.shape,n)},e.prototype.topk=function(t,n,i){return Pb(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){hn("min",n,t.rank);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(a)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.mod=function(t,n){var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ge(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);hn("max",n,t.rank);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o);return this.reduce(s,"max",s.dtype).reshape(a)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.all=function(t,n){hn("all",n,t.rank);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o);return this.reduce(s,"all",s.dtype).reshape(a)},e.prototype.any=function(t,n){hn("any",n,t.rank);var i=je(t.shape,n),a=i[0],o=ut(i[1]),s=t.as2D(-1,o);return this.reduce(s,"any",s.dtype).reshape(a)},e.prototype.realDivide=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new ge(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"float32")},e.prototype.floorDiv=function(t,n){if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new ge(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,Yd);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var i=Oe(t.dtype,n.dtype);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Yd,i);var a=new ge(Yd,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.packedUnaryOp=function(t,n,i){var a=new Zo(t.shape,n);return this.compileAndRun(a,[t],i)},e.prototype.packedBinaryOp=function(t,n,i,a,o){o===void 0&&(o=!1);var s=new Fr(i,t.shape,n.shape,o);return this.compileAndRun(s,[t,n],a)},e.prototype.complexSeparableBinaryOp=function(t,n,i){var a=this,o=this.texData.get(t.dataId),s=this.texData.get(n.dataId),c=[[o.complexTensors.real,s.complexTensors.real],[o.complexTensors.imag,s.complexTensors.imag]].map(function(h){var f=h[0],p=h[1],m=a.makeComplexComponentTensorInfo(t,f),g=a.makeComplexComponentTensorInfo(n,p),v=new ge(i,t.shape,n.shape);return a.compileAndRun(v,[m,g],Oe(f.dtype,p.dtype))}),u=c[0],l=c[1],d=this.complex(u,l);return u.dispose(),l.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>U().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),i=this.addN(t.slice(0,n)),a=this.addN(t.slice(n));return this.addN([i,a])}var o=t.map(function(u){return u.dtype}).reduce(function(u,l){return Oe(u,l)}),s=t.map(function(u){return u.shape}),c=U().getBool("WEBGL_PACK")?new tE(t[0].shape,s):new ZS(t[0].shape,s);return this.compileAndRun(c,t,o)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,Kd);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var i=Oe(t.dtype,n.dtype);if(U().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,Kd,t.dtype);var a=new ge(Kd,t.shape,n.shape);return this.compileAndRun(a,[t,n],i)},e.prototype.pow=function(t,n){var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ge(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),a=Oe(t.dtype,n.dtype);return this.compileAndRun(i,[t,n],a)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,o0,t.dtype);var n=new wt(t.shape,o0);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,s0,t.dtype);var n=new wt(t.shape,s0);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new wt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new wt(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new wt(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new wt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new wt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,c0,t.dtype);var n=new wt(t.shape,c0);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,u0,t.dtype);var n=new wt(t.shape,u0);return this.compileAndRun(n,[t])},e.prototype.softmax=function(t,n){var i=Ce([n],t.shape),a=this.max(t,i),o=nn(a.shape,i),s=this.subtract(t,a.reshape(o)),c=this.exp(s),u=this.sum(c,i).reshape(o);return this.realDivide(c,u)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new wt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new wt(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new wt(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new wt(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new wt(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=U().getBool("WEBGL_PACK")?new Zo(t.shape,oy):new wt(t.shape,ry),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=U().getBool("WEBGL_PACK")?new Zo(t.shape,sy):new wt(t.shape,iy),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(Vb,t.shape,n.shape):new ge(Bb,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.elu=function(t){if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,cy,t.dtype);var n=new wt(t.shape,ay);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new ge("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.selu=function(t){var n=new wt(t.shape,bk);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new wt(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,i){var a,o=(a=U().getBool("WEBGL_PACK_CLIP")?new mE(t.shape):new pE(t.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(a,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(U().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,i0,t.dtype);var n=new wt(t.shape,i0);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),i=new gE(t.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(i,a)},e.prototype.sigmoid=function(t){var n=new wt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new wt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new wt(t.shape,yk);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new wt(t.shape,xk);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new wt(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new wt(t.shape,_k);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new wt(t.shape,wk);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new wt(t.shape,Ck);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var i=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new ge(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.sinh=function(t){var n=new wt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new wt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new wt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new wt(t.shape,Sk);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new wt(t.shape,Ek);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new wt(t.shape,kk);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new wt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var i=new wt(t.shape,function(a){return a===void 0&&(a=0),Kn+`
    return x > 0.0 ? 1.0 : float(`+a+`);
  `}(n));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,n,i,a,o,s){var c=t.shape,u=this.texData.get(t.dataId),l=i.inChannels,d=c[0]*c[1]*c[2],h=i.outChannels,f=i.dataFormat==="channelsLast",p=(d===1||h===1)&&l>1e3,m=c[2]%2!=0&&!!u.isPacked;if(p||!U().getBool("WEBGL_LAZILY_UNPACK")||!U().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var g=f?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],v=this.reshape(t,[1,g,i.inChannels]),b=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:s}),i.outShape)}var _=f?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),y={dataId:t.dataId,shape:[1,_,i.inChannels],dtype:t.dtype},x=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,A(ns(u.shape,y.shape),function(){return"packed reshape "+u.shape+" to "+y.shape+" isn't free"});var w=this.reshape(n,[1,i.inChannels,i.outChannels]),S=this.fusedBatchMatMul({a:y,b:w,transposeA:!1,transposeB:!1,bias:a,activation:o,preluActivationWeights:s}),C=this.texData.get(S.dataId);return A(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=x,C.shape=i.outShape,P.makeTensorFromDataId(S.dataId,i.outShape,S.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,i,a,o,s){var c=i.filterWidth,u=i.filterHeight,l=i.inChannels,d=i.outWidth,h=i.outHeight,f=i.dataFormat==="channelsLast",p=c*u*l,m=h*d,g=[p,m],v=t.squeeze([0]),b=n.reshape([1,p,-1]),_=new jE(g,v.shape,i),y=this.compileAndRun(_,[v]).reshape([1,g[0],g[1]]),x=a!=null,w=s!=null,S=o?nu(o,!0):null,C=new Xd(y.shape,[1,m,i.outChannels],!0,!1,x,S,w),E=[y,b];a&&E.push(a),w&&E.push(s);var D=this.compileAndRun(C,E);return f?D.reshape([1,h,d,i.outChannels]):D.reshape([1,i.outChannels,h,d])},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,s=t.activation,c=t.preluActivationWeights;if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,a,o,s,c);if(U().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,a,o,s,c);var u=o!=null,l=c!=null,d=s?nu(s,!1):null,h=new Xv(a,u,d,l),f=[n,i];return o&&f.push(o),c&&f.push(c),this.compileAndRun(h,f)},e.prototype.conv2d=function(t,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,i);if(U().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,i);var a=new Xv(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerInput=function(t,n,i){var a=new xE(i);return this.compileAndRun(a,[t,n])},e.prototype.conv2dDerFilter=function(t,n,i){var a=new yE(i);return this.compileAndRun(a,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,i=t.input,a=t.filter,o=t.convInfo,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=U().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,d=c?nu(c,l):null,h=[i,a],f=s!=null,p=u!=null;return f&&h.push(s),p&&h.push(u),l?(n=new Qv(o,f,d,p),this.compileAndRun(n,h)):(n=new $v(o,f,d,p),this.compileAndRun(n,h))},e.prototype.depthwiseConv2D=function(t,n,i){var a;return U().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(a=new Qv(i),this.compileAndRun(a,[t,n])):(a=new $v(i),this.compileAndRun(a,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,i){var a=new SE(i);return this.compileAndRun(a,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){var a=new CE(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3d=function(t,n,i){var a=new EE(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerInput=function(t,n,i){var a=new wE(i);return this.compileAndRun(a,[t,n])},e.prototype.conv3dDerFilter=function(t,n,i){var a=new _E(i);return this.compileAndRun(a,[t,n])},e.prototype.maxPool=function(t,n){var i=new $d(n,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,n){var i=new $d(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,i,a){var o=new $d(a,"max",!0),s=this.compileAndRun(o,[n]),c=new qE(a),u=this.compileAndRun(c,[t,s],n.dtype);return s.dispose(),u},e.prototype.avgPoolBackprop=function(t,n,i){var a=new cE(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.cast=function(t,n){return qh(t,n,this)},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),o=0,s=0;s<t.rank;s++)s!==n&&(a[o++]=t.shape[s]);var c=new Array(t.rank).fill(0),u=t.shape.slice();u[n]=1;var l=new Array(i);for(s=0;s<l.length;s++)c[n]=s,l[s]=this.slice(t,c,u).reshape(a);return l},e.prototype.avgPool3d=function(t,n){var i=new Qd(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,i){var a=new uE(i);return this.compileAndRun(a,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var i=new Qd(n,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,i,a){var o=new Qd(a,"max",!0),s=this.compileAndRun(o,[n]),c=new YE(a),u=this.compileAndRun(c,[t,s],n.dtype);return s.dispose(),u},e.prototype.reshape=function(t,n){var i=this.texData.get(t.dataId);if(i.isPacked&&!ns(t.shape,n)&&(i.texture===null||!ns(i.shape,n))){var a=this.packedReshape(t,n);return P.makeTensorFromDataId(a.dataId,a.shape,a.dtype)}return ku(t,n)},e.prototype.resizeBilinear=function(t,n,i,a){var o=U().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new rk(t.shape,n,i,a):new nk(t.shape,n,i,a);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,n,i){var a=new ek(t,n,i);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighbor=function(t,n,i,a){var o=new ak(t.shape,n,i,a);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){var a=new ik(t,n,i);return this.compileAndRun(a,[t])},e.prototype.multinomial=function(t,n,i,a){var o=n?t:on(t),s=o.shape[0],c=o.shape[1],u=new KE(s,c,i),l=u.getCustomSetupFunc(a);return this.compileAndRun(u,[o],"int32",l)},e.prototype.oneHot=function(t,n,i,a){var o=new XE(t.size,n,i,a);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var n=new RE(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,i,a,o){return yu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Kh(t.dataSync(),n.dataSync(),i,a,o)},e.prototype.cropAndResize=function(t,n,i,a,o,s){var c=new kE(t.shape,n.shape,a,o,s);return this.compileAndRun(c,[t,n,i],"float32")},e.prototype.depthToSpace=function(t,n,i){A(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});var a=t.shape[0],o=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],c=i==="NHWC"?t.shape[3]:t.shape[1],u=o*n,l=s*n,d=c/(n*n),h=new ME(i==="NHWC"?[a,u,l,d]:[a,d,u,l],n,i);return this.compileAndRun(h,[t])},e.prototype.split=function(t,n,i){return Tb(t,n,i)},e.prototype.scatterND=function(t,n,i){var a=ds(0,t,i),o=a.sliceRank,s=a.numUpdates,c=a.sliceSize,u=a.strides,l=a.outputSize,d=[l/c,c],h=t.reshape([s,o]),f=n.reshape([s,c]);if(l===0)return ku(Ne([]),i);var p=Z(0),m=new e0(s,o,h.rank,f.rank,u,d);return this.compileAndRun(m,[f,h,p]).reshape(i)},e.prototype.sparseToDense=function(t,n,i,a){var o=ds(0,t,i),s=o.sliceRank,c=o.numUpdates,u=o.strides,l=o.outputSize,d=new e0(c,s,t.rank,n.rank,u,[l,1],!1);return this.compileAndRun(d,[n,t,a]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var i=this.texData.get(t.dataId),a=new Zv(NE,t.shape,n),o=new Zv(LE,t.shape,n),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(a,s),u=this.compileAndRun(o,s),l=this.complex(c,u).as2D(t.shape[0],t.shape[1]);return c.dispose(),u.dispose(),l},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],o=zh(t,n),s=o[0],c=o[1],u=o[2],l=o[3],d=n.reshape([c,a]),h=t.reshape([t.size/u,u]),f=new WE(a,l,[c,u]);return this.compileAndRun(f,[h,d]).reshape(s)},e.prototype.fill=function(t,n,i){if((i=i||Xa(n))==="string"){var a=as(i,ut(t));return a.fill(n),P.makeTensor(a,t,i,this)}var o=new BE(t,n),s=o.getCustomSetupFunc(n);return this.compileAndRun(o,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,i){return Yh(t,n,i)},e.prototype.makeTensorInfo=function(t,n){var i=this.write(null,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var i=this.makeTensorInfo(t,n).dataId;return P.makeTensorFromDataId(i,t,n,this)},e.prototype.unpackTensor=function(t){var n=new Ak(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new $E(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var i=[us(t.shape)].concat(ls(t.shape)),a={dtype:t.dtype,shape:i,dataId:t.dataId},o=[us(n)].concat(ls(n)),s=new tk(o,i),c=this.runWebGLProgram(s,[a],t.dtype,null,!0);return{dataId:c.dataId,shape:n,dtype:c.dtype}},e.prototype.decode=function(t){var n,i=this.texData.get(t),a=i.isPacked,o=i.shape,s=i.dtype,c=du(o);return n=a?new IE(c):new AE(c),{dtype:s,shape:o,dataId:this.runWebGLProgram(n,[{shape:c,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,i,a,o){var s=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,i),u=this.texData.get(c.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===cs.DENSE){var l=rs(t.outputShape);u.texShape=l.map(function(_){return 2*_})}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),ut(c.shape)===0)return u.values=Ya(c.dtype,0),c;var d=[],h=n.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var y=s.texData.get(_.dataId);if(y.texture==null){if(!t.packedInputs&&ut(_.shape)<=U().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:y.values};t.packedInputs&&(y.isPacked=!0,y.shape=_.shape)}else if(!!y.isPacked!=!!t.packedInputs)_=y.isPacked?s.unpackTensor(_):s.packTensor(_),d.push(_),y=s.texData.get(_.dataId);else if(y.isPacked&&!ns(y.shape,_.shape)){var x=_,w=_.shape;_.shape=y.shape,_=s.packedReshape(_,w),d.push(_),y=s.texData.get(_.dataId),x.shape=w}return s.uploadToGPU(_.dataId),{shape:_.shape,texData:y,isUniform:!1}});this.uploadToGPU(c.dataId);var f,p={shape:c.shape,texData:u,isUniform:!1},m=function(_,y,x){var w="";y.concat(x).forEach(function(E){var D=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,R=E.isUniform?"uniform":E.texData.texShape;w+=E.shape+"_"+R+"_"+D});var S=_.userCode,C=_.constructor.name;return C+="_"+w+"_"+S}(t,h,p),g=this.getAndSaveBinary(m,function(){return function(_,y,x,w){var S=y.userCode,C=x.map(function(j,G){var X={logicalShape:j.shape,texShape:j.isUniform?null:j.texData.texShape,isUniform:j.isUniform,isPacked:!j.isUniform&&j.texData.isPacked,flatOffset:null};return j.texData!=null&&j.texData.slice!=null&&j.texData.slice.flatOffset>0&&(X.flatOffset=j.texData.slice.flatOffset),{name:y.variableNames[G],shapeInfo:X}}),E=C.map(function(j){return j.shapeInfo}),D={logicalShape:w.shape,texShape:w.texData.texShape,isUniform:!1,isPacked:w.texData.isPacked,flatOffset:null},R=nE(C,D,S,y.packedInputs),M=_.createProgram(R),L=null,B=_.getUniformLocation(M,"NAN",!1);U().getNumber("WEBGL_VERSION")===1&&(L=_.getUniformLocation(M,"INFINITY",!1));for(var O={},z=0;z<y.variableNames.length;z++){var W=y.variableNames[z];O[W]=_.getUniformLocation(M,W,!1),O["offset"+W]=_.getUniformLocation(M,"offset"+W,!1)}return{program:y,source:R,webGLProgram:M,uniformLocations:O,inShapeInfos:E,outShapeInfo:D,infLoc:L,nanLoc:B}}(s.gpgpu,t,h,p)}),v=this.activeTimers!=null;if(v&&(f=this.startTimer()),function(_,y,x,w,S){t0(y.inShapeInfos,x),t0([y.outShapeInfo],[w]);var C=w.texData.texture,E=w.texData.texShape;w.texData.isPacked?_.setOutputPackedMatrixTexture(C,E[0],E[1]):_.setOutputMatrixTexture(C,E[0],E[1]),_.setProgram(y.webGLProgram),U().getNumber("WEBGL_VERSION")===1&&y.infLoc!==null&&_.gl.uniform1f(y.infLoc,1/0),y.nanLoc!==null&&_.gl.uniform1f(y.nanLoc,NaN),x.forEach(function(D,R){var M=y.program.variableNames[R],L=y.uniformLocations[M],B=y.uniformLocations["offset"+M];if(L!=null)if(D.isUniform)if(ut(D.shape)<2)_.gl.uniform1f(L,D.uniformValues[0]);else{var O=D.uniformValues;O instanceof Float32Array||(O=new Float32Array(O)),_.gl.uniform1fv(L,O)}else D.texData.slice!=null&&B!=null&&_.gl.uniform1i(B,D.texData.slice.flatOffset),_.setInputMatrixTexture(D.texData.texture,L,R)}),S?.(_,y.webGLProgram),_.executeProgram()}(this.gpgpu,g,h,p,a),d.forEach(function(_){return s.disposeData(_.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!U().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&o===!1){var b=this.unpackTensor(c);return this.disposeData(c.dataId),b}return c},e.prototype.compileAndRun=function(t,n,i,a,o){o===void 0&&(o=!1),i=i||n[0].dtype;var s=this.runWebGLProgram(t,n,i,a,o);return P.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(U().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(n){t.gpgpu.deleteProgram(t.binaryCache[n].webGLProgram),delete t.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=K(function(){if(!U().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=U().getBool("DEBUG");U().set("DEBUG",!1);var i=t.abs(Z(1e-8)).dataSync()[0];if(U().set("DEBUG",n),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,i=this.texData.get(t),a=i.shape,o=i.dtype,s=i.values,c=i.texture,u=i.usage,l=i.isPacked;if(c==null){var d,h=this.activeTimers!=null;h&&(d=jn());var f=i.texShape;if(f==null&&(f=ob(a,l),i.texShape=f),s!=null){var p=du(a),m=void 0,g=f[1],v=f[0],b=s instanceof Uint8Array;l?(g=(n=ms(f[0],f[1]))[0],v=n[1],m=new OE(p,[v,g],b)):m=new PE(p,[v,g],b);var _=this.makeTensorInfo([v,g],o);this.texData.get(_.dataId).usage=b?Cn.PIXELS:Cn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_.dataId),g,v,s);var y=this.runWebGLProgram(m,[_],o,null,!0),x=this.texData.get(y.dataId);i.texture=x.texture,i.texShape=x.texShape,i.isPacked=x.isPacked,i.usage=x.usage,this.disposeData(_.dataId),this.texData.delete(y.dataId),i.values=null,h&&(this.uploadWaitMs+=jn()-d)}else{var w=this.acquireTexture(f,u,o,l);i.texture=w}}},e.prototype.convertAndCacheOnCPU=function(t,n){var i=this.texData.get(t),a=i.dtype;return this.releaseGPUData(t),n!=null&&(i.values=function(o,s){if(s==="float32"||s==="complex64")return o;if(s==="int32"||s==="bool"){for(var c=s==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<c.length;++u)c[u]=Math.round(o[u]);return c}throw new Error("Unknown dtype "+s)}(n,a)),i.values},e.prototype.acquireTexture=function(t,n,i,a){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,a)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*Th(n)},e}(Mb);z0()&&P.registerBackend("webgl",function(){return new uy},2);var Mk=F({square_:function(r){var e=k(r,"x","square"),t=[e];return P.runKernelFunc(function(n,i){return i([e]),n.square(e)},{x:e},null,"Square",{},t,[])}}),ps="SquaredDifference",ly=F({squaredDifference_:function(r,e){var t,n=k(r,"a","squaredDifference"),i=k(e,"b","squaredDifference");t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape);var a={a:n,b:i},o=[n,i];return P.runKernelFunc(function(s,c){var u=s.squaredDifference(n,i);return c([n,i]),u},a,function(s,c){var u=c[0],l=c[1],d=Z(2);return{a:function(){return s.mul(u.sub(l).mul(d))},b:function(){return s.mul(l.sub(u).mul(d))}}},ps,{},o,[])}}),Rk=F({abs_:function(r){var e=k(r,"x","abs");return e.dtype==="complex64"?P.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):P.runKernelFunc(function(t,n){var i=t.abs(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),Tk=F({acos_:function(r){var e=k(r,"x","acos");return P.runKernelFunc(function(t,n){var i=t.acos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),Fk=F({acosh_:function(r){var e=k(r,"x","acosh");return P.runKernelFunc(function(t,n){var i=t.acosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Pk=F({asin_:function(r){var e=k(r,"x","asin");return P.runKernelFunc(function(t,n){var i=t.asin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).sub(i.toFloat().square()).sqrt())}}})}}),Ok=F({asinh_:function(r){var e=k(r,"x","asinh");return P.runKernelFunc(function(t,n){var i=t.asinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Z(1).add(i.toFloat().square()).sqrt())}}})}}),Nk=F({atan_:function(r){var e=k(r,"x","atan");return P.runKernelFunc(function(t,n){var i=t.atan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),Lk=F({atanh_:function(r){var e=k(r,"x","atanh");return P.runKernelFunc(function(t,n){var i=t.atanh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(Z(1).sub(i.toFloat().square()))}}})}}),Bk=F({ceil_:function(r){var e=k(r,"x","ceil");return P.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),vs=F({clipByValue_:function(r,e,t){var n=k(r,"x","clipByValue");A(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[n],a={min:e,max:t};return P.runKernelFunc(function(o,s){var c=o.clip(n,e,t);return s([n]),c},{x:n},function(o,s){var c=s[0];return{x:function(){return o.where(c.greaterEqual(e).logicalAnd(c.lessEqual(t)),Tt(o))}}},"ClipByValue",a,i)}}),Vk=F({cos_:function(r){var e=k(r,"x","cos"),t=[e];return P.runKernelFunc(function(n,i){var a=n.cos(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return a.toFloat().sin().neg().mul(n)}}},"Cos",{},t)}}),Wk=F({cosh_:function(r){var e=k(r,"x","cosh");return P.runKernelFunc(function(t,n){var i=t.cosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),zk=F({erf_:function(r){var e=k(r,"x","erf");return A(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),P.runKernelFunc(function(t,n){var i=t.erf(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Lu=F({exp_:function(r){var e=k(r,"x","exp");return P.runKernelFunc(function(t,n){var i=t.exp(e);return n([i]),i},{x:e},function(t,n){return{x:function(){return t.mulStrict(n[0])}}},"Exp",{},[],[!0])}}),jk=F({expm1_:function(r){var e=k(r,"x","expm1");return P.runKernelFunc(function(t,n){var i=t.expm1(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}})}}),Hk=F({floor_:function(r){var e=k(r,"x","floor");return P.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),Uk=F({log_:function(r){var e=k(r,"x","log"),t=[e];return P.runKernelFunc(function(n,i){var a=n.log(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return n.div(a.toFloat())}}},"Log",{},t)}}),Gk=F({log1p_:function(r){var e=k(r,"x","log1p");return P.runKernelFunc(function(t,n){var i=t.log1p(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}})}}),qk=F({logSigmoid_:function(r){var e=k(r,"x","logSigmoid");return P.runKernelFunc(function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),bs=F({neg_:function(r){var e=k(r,"x","neg"),t=[e];return P.runKernelFunc(function(n){return n.neg(e)},{x:e},function(n){return{x:function(){return n.neg()}}},"Neg",{},t)}}),Yk=F({reciprocal_:function(r){var e=k(r,"x","reciprocal");return P.runKernelFunc(function(t,n){var i=t.reciprocal(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}})}}),Kk=F({round_:function(r){var e=k(r,"x","round");return P.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),dy=F({rsqrt_:function(r){var e=k(r,"x","rsqrt"),t=[e];return P.runKernelFunc(function(n,i){var a=n.rsqrt(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return n.div(a.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),tf=F({sigmoid_:function(r){var e=k(r,"x","sigmoid");return P.runKernelFunc(function(t,n){var i=t.sigmoid(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mul(i.mul(Z(1).sub(i)))}}},"Sigmoid")}}),Xk=F({sign_:function(r){var e=k(r,"x","sign");return P.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),$k=F({isNaN_:function(r){var e=k(r,"x","isNaN");return P.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),Qk=F({isInf_:function(r){var e=k(r,"x","isInf");return P.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),Jk=F({isFinite_:function(r){var e=k(r,"x","isFinite");return P.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Tt(t)}}})}}),Zk=F({sin_:function(r){var e=k(r,"x","sin"),t=[e];return P.runKernelFunc(function(n,i){var a=n.sin(e);return i([e]),a},{x:e},function(n,i){var a=i[0];return{x:function(){return a.toFloat().cos().mul(n)}}},"Sin",{},t)}}),tD=F({sinh_:function(r){var e=k(r,"x","sinh");return P.runKernelFunc(function(t,n){var i=t.sinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),eD=F({softplus_:function(r){var e=k(r,"x","softplus");return P.runKernelFunc(function(t,n){var i=t.softplus(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),nD=F({sqrt_:function(r){var e=k(r,"x","sqrt");return P.runKernelFunc(function(t,n){var i=t.sqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),rD=F({step_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","step");return P.runKernelFunc(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return Tt(n)}}})}}),iD=F({tan_:function(r){var e=k(r,"x","tan");return P.runKernelFunc(function(t,n){var i=t.tan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}})}}),aD=F({tanh_:function(r){var e=k(r,"x","tanh");return P.runKernelFunc(function(t,n){var i=t.tanh(e);return n([i]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return Z(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function hy(r,e,t,n,i,a){var o,s,c=k(r,"x","batchNorm"),u=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(o=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),A(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),A(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."}),A(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),o!=null&&A(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),s!=null&&A(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),ys(c,u,l,s,o,a)}function fy(r,e,t,n,i,a){var o,s,c=k(r,"x","batchNorm"),u=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(o=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),A(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),A(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."}),A(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),o!=null&&A(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),s!=null&&A(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),ys(c,u,l,s,o,a)}function py(r,e,t,n,i,a){var o,s,c=k(r,"x","batchNorm"),u=k(e,"mean","batchNorm"),l=k(t,"variance","batchNorm");return i!=null&&(o=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),A(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),A(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."}),A(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),o!=null&&A(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),s!=null&&A(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),ys(c,u,l,s,o,a)}function ys(r,e,t,n,i,a){a==null&&(a=.001);var o,s,c,u=k(r,"x","batchNorm"),l=k(e,"mean","batchNorm"),d=k(t,"variance","batchNorm");i!=null&&(o=k(i,"scale","batchNorm")),n!=null&&(s=k(n,"offset","batchNorm")),A(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),A(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),A(o==null||l.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var h=[u,l,d,o];return P.runKernelFunc(function(f,p){var m=f.batchNormalization(c,ru(l),ru(d),a,ru(o),ru(s));return p([u,l,d,o]),m},{x:u,mean:l,variance:d,scale:o,offset:s},function(f,p){var m=p,g=m[0],v=m[1],b=m[2],_=m[3],y=_??Z(1),x=we(v.shape,c.shape),w=[];if(v.rank===1){for(var S=0;S<c.shape.length-1;++S)w.push(c.shape[S]);w.push(1)}var C=g.sub(v),E=f.mul(y),D=dy(b.add(Z(a))),R=D.mul(D).mul(D).mul(Z(-.5));return{x:function(){return v.rank===1?f.mul(Ui(D.as4D(1,1,1,v.shape[0]),w)).mul(y).reshape(g.shape):f.mul(D).mul(y).reshape(g.shape)},mean:function(){var M=D.mul(Z(-1)).mul(E);return v.rank===1&&(M=M.sum(x)),M.reshape(v.shape)},variance:function(){var M=R.mul(C).mul(E);return v.rank===1&&(M=M.sum(x)),M.reshape(v.shape)},scale:function(){var M=C.mul(D),L=f.mul(M);return v.rank===1&&(L=L.sum(x)),L.reshape(v.shape)},offset:function(){var M=f;return v.rank===1&&(M=M.sum(x)),M.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:a},h).reshape(u.shape)}function ru(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Bu(){fb("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var oD=F({batchNormalization2d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Bu(),hy(r,e,t,a,i,n)}}),sD=F({batchNormalization3d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Bu(),fy(r,e,t,a,i,n)}}),cD=F({batchNormalization4d_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Bu(),py(r,e,t,a,i,n)}}),uD=F({batchNormalization_:function(r,e,t,n,i,a){return n===void 0&&(n=.001),Bu(),ys(r,e,t,a,i,n)}}),ef=F({batchNorm_:ys}),lD=F({batchNorm2d_:hy}),dD=F({batchNorm3d_:fy}),hD=F({batchNorm4d_:py}),Vu=F({logicalAnd_:function(r,e){var t=k(r,"a","logicalAnd","bool"),n=k(e,"b","logicalAnd","bool");return St(t.shape,n.shape),P.runKernelFunc(function(i){return i.logicalAnd(t,n)},{a:t,b:n},null,"LogicalAnd")}}),fD=F({logicalNot_:function(r){var e=k(r,"x","logicalNot","bool");return P.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),my=F({logicalOr_:function(r,e){var t=k(r,"a","logicalOr","bool"),n=k(e,"b","logicalOr","bool");return St(t.shape,n.shape),P.runKernelFunc(function(i){return i.logicalOr(t,n)},{$a:t,$b:n})}}),pD=F({logicalXor_:function(r,e){var t=k(r,"a","logicalXor","bool"),n=k(e,"b","logicalXor","bool");return St(t.shape,n.shape),my(r,e).logicalAnd(Vu(r,e).logicalNot())}}),Ki=F({where_:function(r,e,t){var n=k(e,"a","where"),i=k(t,"b","where"),a=k(r,"condition","where","bool");return Nt(n.shape,i.shape,"Error in where: "),a.rank===1?A(a.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Nt(a.shape,i.shape,"Error in where: "),P.runKernelFunc(function(o,s){var c=o.select(a,n,i);return s([a]),c},{$condition:a,$a:n,$b:i},function(o,s){var c=s[0];return{$condition:function(){return Tt(c).toFloat()},$a:function(){return o.mul(c.cast(o.dtype))},$b:function(){return o.mul(c.logicalNot().cast(o.dtype))}}})}}),gy=function(r){return st(this,void 0,void 0,function(){var e,t,n;return ct(this,function(i){switch(i.label){case 0:return[4,(e=k(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=$h(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},ht=F({add_:function(r,e){var t,n=k(r,"a","add"),i=k(e,"b","add");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o){return o.add(n,i)},{a:n,b:i},function(o){return{a:function(){var s=o,c=we(n.shape,a);return c.length>0&&(s=s.sum(c)),s.reshape(n.shape)},b:function(){var s=o,c=we(i.shape,a);return c.length>0&&(s=s.sum(c)),s.reshape(i.shape)}}},"Add")}}),mD=F({addN_:function(r){A(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),A(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(i,a){return k(i,"tensors"+a,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!_e(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return P.runKernelFunc(function(i){return i.addN(e)},n,function(i){var a={};return e.forEach(function(o,s){a[s]=function(){return i.clone()}}),a},"AddN")}}),gD=F({addStrict_:function(r,e){var t=k(r,"a","addStrict"),n=k(e,"b","addStrict");return Nt(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),vD=F({atan2_:function(r,e){var t,n=k(r,"a","atan2"),i=k(e,"b","atan2");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o,s){var c=o.atan2(n,i);return s([n,i]),c},{$a:n,$b:i},function(o,s){var c=s[0],u=s[1];return{$a:function(){var l=ht(c.square(),u.square()),d=o.mul(u.div(l)),h=we(c.shape,a);return h.length>0&&(d=d.sum(h)),d.reshape(c.shape)},$b:function(){var l=ht(c.square(),u.square()),d=bs(o.mul(c.div(l))),h=we(u.shape,a);return h.length>0&&(d=d.sum(h)),d.reshape(u.shape)}}})}}),Fn=F({div_:function(r,e){var t,n=k(r,"a","div"),i=k(e,"b","div");if(t=te(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return vy(n,i);var a=St(n.shape,i.shape);return P.runKernelFunc(function(o,s){var c=o.realDivide(n,i);return s([n,i]),c},{a:n,b:i},function(o,s){var c=s[0],u=s[1];return{a:function(){var l=o.div(u.toFloat()),d=we(c.shape,a);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=o.mul(c.toFloat()),d=we(u.shape,a);d.length>0&&(l=l.sum(d).reshape(u.shape));var h=u.square();return l.div(h.toFloat()).neg()}}},"Div")}}),bD=F({divNoNan_:function(r,e){var t,n=k(r,"a","div"),i=k(e,"b","div");n=(t=te(n,i))[0],i=t[1];var a=Fn(n,i),o=Tt(a),s=i.equal(o);return Ki(s,o,a)}}),yD=F({divStrict_:function(r,e){var t=k(r,"a","div"),n=k(e,"b","div");return Nt(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),vy=F({floorDiv_:function(r,e){var t,n=k(r,"a","floorDiv"),i=k(e,"b","floorDiv");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o,s){var c=o.floorDiv(n,i);return s([n,i]),c},{a:n,b:i},function(o,s){var c=s[0],u=s[1];return{a:function(){var l=o.div(u.toFloat()),d=we(c.shape,a);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=o.mul(c.toFloat()),d=we(u.shape,a);d.length>0&&(l=l.sum(d).reshape(u.shape));var h=u.square();return l.div(h.toFloat()).neg()}}},"FloorDiv")}}),nf=F({maximum_:function(r,e){var t,n=k(r,"a","maximum"),i=k(e,"b","maximum");return t=te(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),St(n.shape,i.shape),P.runKernelFunc(function(a,o){var s=a.maximum(n,i);return o([n,i]),s},{a:n,b:i},function(a,o){var s=o[0],c=o[1];return{a:function(){return a.mul(s.greaterEqual(c).toFloat())},b:function(){return a.mul(s.less(c).toFloat())}}},"Maximum")}}),xD=F({maximumStrict_:function(r,e){var t=k(r,"a","maximumStrict"),n=k(e,"b","maximumStrict");return Nt(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),by=F({minimum_:function(r,e){var t,n=k(r,"a","minimum"),i=k(e,"b","minimum");return t=te(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),St(n.shape,i.shape),P.runKernelFunc(function(a,o){var s=a.minimum(n,i);return o([n,i]),s},{a:n,b:i},function(a,o){var s=o[0],c=o[1];return{a:function(){return a.mul(s.lessEqual(c).toFloat())},b:function(){return a.mul(s.greater(c).toFloat())}}},"Minimum")}}),_D=F({minimumStrict_:function(r,e){var t=k(r,"a","minimumStrict"),n=k(e,"b","minimumStrict");return Nt(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),wD=F({mod_:function(r,e){var t,n=k(r,"a","mod"),i=k(e,"b","mod");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o,s){var c=o.mod(n,i);return s([n,i]),c},{$a:n,$b:i},function(o,s){var c=s[0],u=s[1];return{$a:function(){var l=we(c.shape,a);return l.length>0?o.sum(l).reshape(c.shape):o},$b:function(){var l=o.mul(c.div(u).floor().neg()),d=we(u.shape,a);return d.length>0?l.sum(d).reshape(u.shape):l}}})}}),CD=F({modStrict_:function(r,e){var t=k(r,"a","modStrict"),n=k(e,"b","modStrict");return Nt(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),se=F({mul_:function(r,e){var t,n=k(r,"a","mul"),i=k(e,"b","mul");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o,s){var c=o.multiply(n,i);return s([n,i]),c},{a:n,b:i},function(o,s){var c=s[0],u=s[1];return{a:function(){var l=o.mul(u.toFloat()),d=we(c.shape,a);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=o.mul(c.toFloat()),d=we(u.shape,a);return d.length>0?l.sum(d).reshape(u.shape):l}}},"Mul")}}),SD=F({mulStrict_:function(r,e){var t=k(r,"a","mul"),n=k(e,"b","mul");return Nt(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),Du=F({pow_:function(r,e){var t,n=k(r,"base","pow"),i=k(e,"exp","pow");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape),o=[n,i];return P.runKernelFunc(function(s,c){var u=s.pow(n,i);return c([n,i,u]),u},{a:n,b:i},function(s,c){var u=c[0],l=c[1],d=c[2];return{a:function(){var h=l.toFloat(),f=s.mul(h.mul(u.pow(h.sub(Z(1))))),p=we(u.shape,a);return p.length>0&&(f=f.sum(p)),f.reshape(u.shape)},b:function(){var h=u.greater(0),f=u.log().where(h,Tt(u)),p=s.mul(d.mul(f)),m=we(l.shape,a);return m.length>0&&(p=p.sum(m)),p.reshape(l.shape)}}},"Pow",{},o,[!0])}}),ED=F({powStrict_:function(r,e){return Nt(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),kD=F({squaredDifferenceStrict_:function(r,e){var t=k(r,"a","squaredDifferenceStrict"),n=k(e,"b","squaredDifferenceStrict");return Nt(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),Gt=F({sub_:function(r,e){var t,n=k(r,"a","sub"),i=k(e,"b","sub");t=te(n,i),n=t[0],i=t[1];var a=St(n.shape,i.shape);return P.runKernelFunc(function(o){return o.subtract(n,i)},{a:n,b:i},function(o){return{a:function(){var s=o,c=we(n.shape,a);return c.length>0&&(s=s.sum(c)),s.reshape(n.shape)},b:function(){var s=o,c=we(i.shape,a);return c.length>0&&(s=s.sum(c)),s.neg().reshape(i.shape)}}},"Sub")}}),DD=F({subStrict_:function(r,e){var t=k(r,"a","subStrict"),n=k(e,"b","subStrict");return Nt(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),yy=F({equal_:function(r,e){var t,n=k(r,"a","equal"),i=k(e,"b","equal");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a){return a.equal(n,i)},{$a:n,$b:i})}}),AD=F({equalStrict_:function(r,e){var t=k(r,"a","equalStrict"),n=k(e,"b","equalStrict");return Nt(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),ID=F({greater_:function(r,e){var t,n=k(r,"a","greater"),i=k(e,"b","greater");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a){return a.greater(n,i)},{a:n,b:i},null,"Greater")}}),xy=F({greaterEqual_:function(r,e){var t,n=k(r,"a","greaterEqual"),i=k(e,"b","greaterEqual");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a,o){var s=a.greaterEqual(n,i);return o([n,i]),s},{a:n,b:i},function(a,o){var s=o[0],c=o[1];return{a:function(){return Tt(s)},b:function(){return Tt(c)}}},"GreaterEqual")}}),MD=F({greaterEqualStrict_:function(r,e){var t=k(r,"a","greaterEqualStrict"),n=k(e,"b","greaterEqualStrict");return Nt(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),RD=F({greaterStrict_:function(r,e){var t=k(r,"a","greaterStrict"),n=k(e,"b","greaterStrict");return Nt(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),TD=F({less_:function(r,e){var t,n=k(r,"a","less"),i=k(e,"b","less");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a){return a.less(n,i)},{a:n,b:i},null,"Less")}}),FD=F({lessEqual_:function(r,e){var t,n=k(r,"a","lessEqual"),i=k(e,"b","lessEqual");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a,o){var s=a.lessEqual(n,i);return o([n,i]),s},{a:n,b:i},null,"LessEqual")}}),PD=F({lessEqualStrict_:function(r,e){var t=k(r,"a","lessEqualStrict"),n=k(e,"b","lessEqualStrict");return Nt(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),OD=F({lessStrict_:function(r,e){var t=k(r,"a","lessStrict"),n=k(e,"b","lessStrict");return Nt(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),ND=F({notEqual_:function(r,e){var t,n=k(r,"a","notEqual"),i=k(e,"b","notEqual");return t=te(n,i),n=t[0],i=t[1],St(n.shape,i.shape),P.runKernelFunc(function(a){return a.notEqual(n,i)},{a:n,b:i},null,"NotEqual")}}),LD=F({notEqualStrict_:function(r,e){var t=k(r,"a","notEqualStrict"),n=k(e,"b","notEqualStrict");return Nt(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function l0(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function d0(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var rf=F({gather_:function(r,e,t){t===void 0&&(t=0);var n=k(r,"x","gather"),i=k(e,"indices","gather","int32");t=Ce(t,n.shape)[0];var a=function(o,s,c){for(var u=o.shape[c],l=[],d=1,h=1,f=0;f<c;f++)l.push(o.shape[f]),d*=o.shape[f];for(f=0;f<s.rank;f++)l.push(s.shape[f]);for(f=c+1;f<o.rank;f++)l.push(o.shape[f]),h*=o.shape[f];return{batchSize:d,sliceSize:h,dimSize:u,outputShape:l}}(n,i,t);return P.runKernelFunc(function(o,s){var c=o.gather(n,i.flatten(),t);return s([i]),c},{x:n,indices:i},function(o,s){var c=s[0];return{x:function(){var u=n.shape,l=c.size,d=u.slice(0,t),h=d.length,f=u.slice(t,u.length).slice(1),p=f.length,m=l0(0,h),g=l0(h+1,h+1+p),v=d0([d,[l],f]),b=o.reshape(v),_=c.reshape([l]),y=d0([[h],m,g]),x=b.transpose(y),w=_y(x,_,n.shape[t]),S=Ru(y);return w=w.transpose(S)},indices:function(){return c}}},"Gather",{axis:t}).reshape(a.outputShape)}}),_y=F({unsortedSegmentSum_:function(r,e,t){var n=k(r,"x","unsortedSegmentSum"),i=k(e,"segmentIds","unsortedSegmentSum","int32");return A(ce(t),function(){return"numSegments must be of dtype int"}),P.runKernelFunc(function(a,o){var s=a.unsortedSegmentSum(n,i,t);return o([i]),s},{$x:n},function(a,o){var s=o[0];return{$x:function(){return function(c,u){for(var l=nf(u,Tt(u)),d=rf(c,l),h=xy(u,Z(0,"int32")),f=d.rank-h.rank,p=0;p<f;++p)h=Xe(h,p+1);h=Vu(h,Qa(d.shape,"bool"));var m=Tt(d);return Ki(h,d,m)}(a,s)}}})}}),BD=function(r,e,t){return st(this,void 0,void 0,function(){var n,i,a,o,s,c,u,l,d,h,f,p,m;return ct(this,function(g){switch(g.label){case 0:for(n=k(r,"tensor","boolMask"),i=k(e,"mask","boolMask","bool"),a=t??0,o=i.rank,s=n.shape,A(o>0,function(){return"mask cannot be scalar"}),Nt(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=a;u<a+o;u++)c*=s[u];return l=s.slice(0,a).concat([c],s.slice(a+o)),d=n.reshape(l),h=i.reshape([-1]),[4,gy(h)];case 1:return f=g.sent(),p=f.squeeze([1]),m=rf(d,p,a),r!==n&&n.dispose(),e!==i&&i.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,m]}})})};function wy(r,e,t,n,i,a,o){a===void 0&&(a="NHWC"),A(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var s=r,c=e,u=!1;e.rank===3&&(u=!0,c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,r[0],r[1],r[2]]),A(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),A(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),A(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var l=a==="NHWC"?s[3]:s[1],d=a==="NHWC"?c.shape[3]:c.shape[1];A(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),A(d===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&A(ce(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=Nu(a),f=mi(s,t.shape,n,1,i,o,!1,h),p=P.runKernelFunc(function(m,g){var v=m.conv2dDerInput(c,t,f);return g([t,c]),v},{dy4D:c,filter:t},function(m,g){var v=g[0],b=g[1];return{dy4D:function(){return Le(m,v,n,i,a,1,o)},filter:function(){return af(m,b,v.shape,n,i,a,o)}}});return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Zd(r){var e=function(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function Cy(r,e,t,n,i){A(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var a=r,o=e,s=!1;e.rank===4&&(s=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,r[0],r[1],r[2],r[3]]);var c=a[4],u=o.shape[4];A(a.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),A(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),A(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),A(c===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."}),A(u===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."});var l=fs(a,t.shape,n,1,i),d=P.runKernelFunc(function(h){return h.conv3dDerInput(o,t,l)},{dy5D:o});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var VD=F({conv1d_:function(r,e,t,n,i,a,o){i===void 0&&(i="NWC"),a===void 0&&(a=1);var s=k(r,"x","conv1d"),c=k(e,"filter","conv1d"),u=s,l=!1;s.rank===2&&(l=!0,u=s.as3D(1,s.shape[0],s.shape[1])),A(u.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),A(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),o!=null&&A(ce(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."}),A(u.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),A(rn(t,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+a+"'"}),A(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),h=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),f=Le(h,d,[1,t],n,"NHWC",[1,a],o);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),Le=F({conv2d_:function(r,e,t,n,i,a,o){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var s=k(r,"x","conv2d"),c=k(e,"filter","conv2d"),u=s,l=!1;s.rank===3&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(u.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."}),A(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),o!=null&&A(ce(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var d=i==="NHWC"?u.shape[3]:u.shape[1];A(d===c.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+c.shape[2]+"."}),A(rn(t,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"});var h=Nu(i),f=mi(u.shape,c.shape,t,a,n,o,!1,h),p=[c,u],m=P.runKernelFunc(function(g,v){var b=g.conv2d(u,c,f);return v([c,u]),b},{x:u,filter:c},function(g,v){var b=v,_=b[0],y=b[1];return A(Yi(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return Sy(y.shape,g,_,t,n,i)},filter:function(){return af(y,g,_.shape,t,n,i)}}},"Conv2D",f,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),WD=F({conv3d_:function(r,e,t,n,i,a){i===void 0&&(i="NDHWC"),a===void 0&&(a=[1,1,1]);var o=k(r,"x","conv3d"),s=k(e,"filter","conv3d"),c=o,u=!1;o.rank===4&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),A(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),A(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),A(c.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),A(function(h,f){return Zd(h)||Zd(f)}(t,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),A(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=fs(c.shape,s.shape,t,a,n),d=P.runKernelFunc(function(h,f){var p=h.conv3d(c,s,l);return f([c,s]),p},{x:c,$filter:s},function(h,f){A(Zd(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var p=f[0],m=f[1];return{x:function(){return Cy(p.shape,h,m,t,n)},$filter:function(){return function(g,v,b,_,y){var x=g;g.rank===4&&(x=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var w=v;w.rank===4&&(w=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),A(x.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),A(w.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+w.shape+"."}),A(b.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),A(x.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+b[3]+"."}),A(w.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+w.shape[4]+") must match output depth for filter ("+b[4]+")."});var S=fs(x.shape,b,_,1,y);return P.runKernelFunc(function(C){return C.conv3dDerFilter(x,w,S)},{x5D:x,dy5D:w})}(p,h,m.shape,t,n)}}});return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),af=F({conv2dDerFilter_:function(r,e,t,n,i,a,o){a===void 0&&(a="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var c=e;c.rank===3&&(c=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),A(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),A(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),A(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var u=a==="NHWC"?s.shape[3]:s.shape[1],l=a==="NHWC"?c.shape[3]:c.shape[1];A(u===t[2],function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+t[2]+"."}),A(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."}),o!=null&&A(ce(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var d=Nu(a),h=mi(s.shape,t,n,1,i,o,!1,d);return P.runKernelFunc(function(f){return f.conv2dDerFilter(s,c,h)},{x4D:s,dy4D:c})}}),Sy=F({conv2dDerInput_:wy}),xs=F({depthwiseConv2d_:function(r,e,t,n,i,a,o){i===void 0&&(i="NHWC"),a===void 0&&(a=[1,1]);var s=k(r,"x","depthwiseConv2d"),c=k(e,"filter","depthwiseConv2d"),u=s,l=!1;s.rank===3&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(u.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."}),A(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),A(u.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),a==null&&(a=[1,1]),A(rn(t,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),o!=null&&A(ce(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+n+"."});var d=mi(u.shape,c.shape,t,a,n,o,!0),h=[u,c],f=P.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(u,c,d);return m([u,c]),g},{x:u,filter:c},function(p,m){A(Yi(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var g=m[0],v=m[1];return{x:function(){return Ey(g.shape,p,v,d)},filter:function(){return ky(g,p,v.shape,d)}}},"DepthwiseConv2dNative",d,h);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Ey=F({depthwiseConv2dDerInput_:function(r,e,t,n){var i=e,a=!1;e.rank===3&&(a=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=P.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,t,n)},{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),ky=F({depthwiseConv2dDerFilter_:function(r,e,t,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e;return a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),P.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(i,a,n)},{x4D:i,dy4D:a})}}),_s=F({separableConv2d_:function(r,e,t,n,i,a,o){a===void 0&&(a=[1,1]),o===void 0&&(o="NHWC");var s=k(r,"x","separableConv2d"),c=k(e,"depthwiseFilter","separableConv2d"),u=k(t,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(s.rank===3&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),A(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),A(u.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),A(u.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),A(u.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var h=c.shape[2],f=c.shape[3];A(u.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+u.shape[2]+"."});var p=xs(l,c,n,i,o,a),m=Le(p,u,1,"valid",o);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),zD=F({conv2dTranspose_:function(r,e,t,n,i,a){return wy(t,k(r,"x","conv2dTranspose"),k(e,"filter","conv2dTranspose"),n,i,"NHWC",a)}}),jD=F({conv3dTranspose_:function(r,e,t,n,i){return Cy(t,k(r,"x","conv3dTranspose"),k(e,"filter","conv3dTranspose"),n,i)}}),Ja=F({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var a=k(r,"a","matMul"),o=k(e,"b","matMul");i=te(a,o),a=i[0],o=i[1];var s=t?a.shape[a.rank-2]:a.shape[a.rank-1],c=n?o.shape[o.rank-1]:o.shape[o.rank-2],u=t?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),h=o.shape.slice(0,-2),f=ut(d),p=ut(h);A(a.rank>=2&&o.rank>=2&&a.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."}),A(_e(d,h),function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."}),A(s===c,function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var m=a.shape.slice(0,-2).concat([u,l]),g=t?a.as3D(f,s,u):a.as3D(f,u,s),v=n?o.as3D(p,l,c):o.as3D(p,c,l),b={transposeA:t,transposeB:n};return P.runKernelFunc(function(_,y){var x=_.batchMatMul(g,v,t,n);return y([g,v]),x},{a:g,b:v},function(_,y){var x=y,w=x[0],S=x[1];return t||n?!t&&n?{a:function(){return _.matMul(S,!1,!1)},b:function(){return _.matMul(w,!0,!1)}}:t&&!n?{a:function(){return S.matMul(_,!1,!0)},b:function(){return w.matMul(_,!1,!1)}}:{a:function(){return S.matMul(_,!0,!0)},b:function(){return _.matMul(w,!0,!0)}}:{a:function(){return _.matMul(S,!1,!0)},b:function(){return w.matMul(_,!0,!1)}}},"BatchMatMul",b).reshape(m)}}),HD=F({dot_:function(r,e){var t=k(r,"t1","dot"),n=k(e,"t2","dot");A(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var i=t.rank===1?t.size:t.shape[1],a=n.rank===1?n.size:n.shape[0];return A(i===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),UD=F({outerProduct_:function(r,e){var t=k(r,"v1","outerProduct"),n=k(e,"v2","outerProduct");return A(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),ws=F({reverse_:function(r,e){var t=k(r,"x","reverse");if(t.rank===0)return t.clone();var n=Ce(e,t.shape);return P.runKernelFunc(function(i){return i.reverse(t,n)},{$x:t},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(t)}}),GD=F({reverse1d_:function(r){var e=k(r,"x","reverse");return A(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),ws(e,0)}}),qD=F({reverse2d_:function(r,e){var t=k(r,"x","reverse");return A(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),ws(t,e)}}),YD=F({reverse3d_:function(r,e){var t=k(r,"x","reverse");return A(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),ws(t,e)}}),KD=F({reverse4d_:function(r,e){var t=k(r,"x","reverse");return A(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),ws(t,e)}});function Dy(r,e,t,n,i,a){var o=k(r,"x","maxPool"),s=o,c=!1;o.rank===3&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),n==null&&(n=[1,1]),A(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),A(rn(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),a!=null&&A(ce(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var u=Ka(s.shape,e,t,n,i,a);if(u.filterWidth===1&&u.filterHeight===1&&_e(u.inShape,u.outShape))return o.clone();var l=[s],d=P.runKernelFunc(function(h,f){var p=h.maxPool(s,u);return f([s,p]),p},{x:s},function(h,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,b,_,y,x,w,S){var C=k(g,"dy","maxPoolBackprop"),E=k(v,"input","maxPoolBackprop"),D=k(b,"output","maxPoolBackprop");A(E.rank===C.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+C.rank+")"}),x==null&&(x=[1,1]),A(rn(y,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+x+"'"}),A(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),A(E.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."}),S!=null&&A(ce(w),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+w+"."});var R=Ka(E.shape,_,y,x,w,S);return P.runKernelFunc(function(M){return M.maxPoolBackprop(C,E,D,R)},{$dy:C,$input:E})}(h,p,m,e,t,n,i)}}},"MaxPool",u,l);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Ay(r,e,t,n,i,a){var o=k(r,"x","avgPool","float32");n==null&&(n=[1,1]),A(rn(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var s=o,c=!1;o.rank===3&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),a!=null&&A(ce(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var u=Ka(s.shape,e,t,n,i,a);if(u.filterWidth===1&&u.filterHeight===1&&_e(u.inShape,u.outShape))return o.clone();var l=P.runKernelFunc(function(d){return d.avgPool(s,u)},{x:s},function(d){return{x:function(){return function(h,f,p,m,g,v){var b=k(h,"dy","avgPoolBackprop"),_=k(f,"input","avgPoolBackprop");A(_.rank===b.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+b.rank+")"}),g==null&&(g=[1,1]),A(rn(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var y=_,x=b,w=!1;_.rank===3&&(w=!0,y=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),A(x.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),A(y.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+y.rank+"."});var S=Ka(y.shape,p,m,g,v),C=P.runKernelFunc(function(E){return E.avgPoolBackprop(x,y,S)},{dy4D:x,input4D:y});return w?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(d,s,e,t,n,i)}}},"AvgPool",u);return l=l.cast(o.dtype),c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var ue=F({maxPool_:function(r,e,t,n,i){return Dy(r,e,t,1,n,i)}}),Vr=F({avgPool_:function(r,e,t,n,i){return Ay(r,e,t,1,n,i)}}),XD=F({pool_:function(r,e,t,n,i,a){i==null&&(i=[1,1]),a==null&&(a=1),n===0&&(n="valid");var o=k(r,"x","maxPool"),s=o,c=!1;o.rank===3&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(rn(a,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"});var u,l=Ka(s.shape,e,a,i,n),d=[l.dilationHeight,l.dilationWidth];u=n==="same"?function(y,x){var w=y.map(function(E,D){return E+(E-1)*(x[D]-1)}).map(function(E){return E-1}),S=w.map(function(E){return Math.floor(E/2)}),C=w.map(function(E,D){return E-S[D]});return w.map(function(E,D){return[S[D],C[D]]})}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var h=d[0]===1&&d[1]===1,f=function(y,x,w){var S=w.map(function(B){return B[0]}),C=w.map(function(B){return B[1]}),E=y.concat(S,C),D=x.map(function(B,O){return(B-E[O]%B)%B}),R=C.map(function(B,O){return B+D[O]}),M=x.map(function(B,O){return[S[O],R[O]]}),L=x.map(function(B,O){return[0,D[O]]});return[M,L]}([l.inHeight,l.inWidth],d,u),p=f[0],m=f[1],g=h?n:"valid",v=h?s:xb(s,d,p),b=(t==="avg"?function(){return Ay(v,e,a,1,g)}:function(){return Dy(v,e,a,1,g)})(),_=h?b:vb(b,d,m);return c?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),$D=F({maxPool3d_:function(r,e,t,n,i,a,o){a===void 0&&(a="NDHWC");var s=k(r,"x","maxPool3d"),c=s,u=!1;s.rank===4&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),o==null&&(o=[1,1,1]),A(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),A(a==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),A(rn(t,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&A(ce(n),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var l=hs(c.shape,e,t,o,n,i,a),d=P.runKernelFunc(function(h,f){var p=h.maxPool3d(c,l);return f([c,p]),p},{x:c},function(h,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,b,_,y,x,w,S){var C=k(g,"dy","maxPool3dBackprop"),E=k(v,"input","maxPool3dBackprop"),D=k(b,"output","maxPool3dBackprop"),R=C,M=E,L=D,B=!1;E.rank===4&&(B=!0,R=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),M=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),L=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),A(R.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+R.rank+"."}),A(M.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),A(L.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+L.rank+"."}),x==null&&(x=[1,1,1]),A(rn(y,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+x+"'"}),S!=null&&A(ce(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+w+"."});var O=hs(M.shape,_,y,x,w,S),z=P.runKernelFunc(function(W){return W.maxPool3dBackprop(R,M,L,O)},{dy5D:R,input5D:M});return B?z.as4D(z.shape[1],z.shape[2],z.shape[3],z.shape[4]):z}(h,p,m,e,t,o,n,i)}}});return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),QD=F({avgPool3d_:function(r,e,t,n,i,a,o){a===void 0&&(a="NDHWC");var s=k(r,"x","avgPool3d","float32"),c=s,u=!1;s.rank===4&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),o==null&&(o=[1,1,1]),A(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),A(a==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),A(rn(t,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&A(ce(n),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."});var l=hs(c.shape,e,t,o,n,i,a),d=P.runKernelFunc(function(h){return h.avgPool3d(c,l)},{x:c},function(h){return{x:function(){return function(f,p,m,g,v,b,_){var y=k(f,"dy","avgPool3dBackprop"),x=k(p,"input","avgPool3dBackprop"),w=y,S=x,C=!1;x.rank===4&&(C=!0,w=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),S=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),A(w.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+w.rank+"."}),A(S.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."}),v==null&&(v=[1,1,1]),A(rn(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),_!=null&&A(ce(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+b+"."});var E=hs(S.shape,m,g,v,b,_),D=P.runKernelFunc(function(R){return R.avgPool3dBackprop(w,S,E)},{dy5D:w,input5D:S});return C?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D}(h,c,e,t,o,n,i)}}});return d=d.cast(c.dtype),u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Un=F({slice_:function(r,e,t){var n,i,a=k(r,"x","slice");if(a.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach(function(c){A(c!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(a.rank).fill(-1):typeof t=="number"?[t].concat(new Array(a.rank-1).fill(-1)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(-1)):t).map(function(c,u){return c>=0?c:(A(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+u+"."}),a.shape[u]-n[u])}),kb(a,n,i);var o=a.shape,s={begin:n,size:i};return P.runKernelFunc(function(c){return c.slice(a,n,i)},{x:a},function(c){for(var u=[],l=0;l<c.rank;l++)u.push([n[l],o[l]-n[l]-i[l]]);return{x:function(){return c.pad(u)}}},"Slice",s)}}),JD=F({slice1d_:function(r,e,t){var n=k(r,"x","slice1d");return A(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Un(n,[e],[t])}}),ZD=F({slice2d_:function(r,e,t){var n=k(r,"x","slice2d");return A(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Un(n,e,t)}}),of=F({slice3d_:function(r,e,t){var n=k(r,"x","slice3d");return A(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Un(n,e,t)}}),tA=F({slice4d_:function(r,e,t){var n=k(r,"x","slice4d");return A(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Un(n,e,t)}});function Iy(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(nn(e.shape,n))),r.rank<t.rank&&(r=r.reshape(nn(r.shape,n))),{x:function(){var a=r.mul(t.equal(e).cast(r.dtype));return i==null?a:a.transpose(i)}}}var eA=F({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","all","bool"),i=Ce(e,n.shape),a=i,o=qn(a,n.rank);o!=null&&(n=n.transpose(o),a=Yn(a.length,n.rank));var s=P.runKernelFunc(function(u){return u.all(n,a)},{$x:n});if(t){var c=nn(s.shape,i);return s.reshape(c)}return s}}),nA=F({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","any","bool"),i=Ce(e,n.shape),a=i,o=qn(a,n.rank);o!=null&&(n=n.transpose(o),a=Yn(a.length,n.rank));var s=P.runKernelFunc(function(u){return u.any(n,a)},{$x:n});if(t){var c=nn(s.shape,i);return s.reshape(c)}return s}}),rA=F({argMax_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMax");e==null&&(e=0);var n=Ce(e,t.shape),i=qn(n,t.rank);i!=null&&(t=t.transpose(i),n=Yn(n.length,t.rank));var a={axis:n[0]},o=[t];return P.runKernelFunc(function(s,c){var u=s.argMax(t,n[0]);return c([t]),u},{x:t},function(s,c){var u=c[0];return{x:function(){return Tt(u)}}},"ArgMax",a,o)}}),iA=F({argMin_:function(r,e){e===void 0&&(e=0);var t=k(r,"x","argMin");e==null&&(e=0);var n=Ce(e,t.shape),i=qn(n,t.rank);return i!=null&&(t=t.transpose(i),n=Yn(n.length,t.rank)),P.runKernelFunc(function(a,o){var s=a.argMin(t,n[0]);return o([t]),s},{$x:t},function(a,o){var s=o[0];return{$x:function(){return Tt(s)}}})}}),aA=F({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","logSumExp"),i=Ce(e,n.shape),a=n.max(i,!0),o=n.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(t){var c=nn(s.shape,i);return s.reshape(c)}return s}}),Qi=F({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","max"),i=n,a=Ce(e,n.shape),o=a,s=qn(o,n.rank);s!=null&&(n=n.transpose(s),o=Yn(o.length,n.rank));var c=[n],u=P.runKernelFunc(function(d,h){var f=d.max(n,o);return h([i,f]),f},{x:n},function(d,h){return Iy(d,h[1],h[0],a,s)},"Max",{axes:o},c,[!0]);if(t){var l=nn(u.shape,a);u=u.reshape(l)}return u}}),oA=F({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","mean"),i=Ce(e,n.shape),a=ut(je(n.shape,i)[1]);return Ou(function(o){var s=Z(a);return{value:(s.dtype===o.dtype?o:o.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(c){var u=o.shape.slice();return i.forEach(function(l){u[l]=1}),c.reshape(u).mul(Qa(o.shape,"float32")).div(a)}}})(n)}}),sA=F({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","min"),i=n,a=Ce(e,n.shape),o=a,s=qn(o,n.rank);s!=null&&(n=n.transpose(s),o=Yn(o.length,n.rank));var c=[n],u=P.runKernelFunc(function(d,h){var f=d.min(n,o);return h([i,f]),f},{x:n},function(d,h){return Iy(d,h[1],h[0],a,s)},"Min",{axes:o},c,[!0]);if(t){var l=nn(u.shape,a);u=u.reshape(l)}return u}}),cA=F({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Ce(e,(r=k(r,"x","moments")).shape),i=r.mean(n,t),a=i.shape;t||(a=nn(i.shape,n));var o=r.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(n,t)}}}),My=F({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=Ce(e,n.shape);return Ou(function(a){var o=qn(i,a.rank),s=i,c=a;o!=null&&(c=a.transpose(o),s=Yn(s.length,a.rank));var u=function(f){var p=a.shape.slice();return i.forEach(function(m){p[m]=1}),f.reshape(p).mul(Qa(a.shape,"float32"))},l={axes:s},d=P.runKernelFunc(function(f){return f.sum(c,s)},{x:c},function(f){return{x:function(){return u(f)}}},"Sum",l);if(t){var h=nn(d.shape,i);d=d.reshape(h)}return{value:d,gradFunc:u}})(n)}}),uA=F({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=k(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=Ce(e,n.shape),a=qn(i,n.rank),o=i,s=n;a!=null&&(s=n.transpose(a),o=Yn(o.length,n.rank));var c=P.runKernelFunc(function(l){return l.prod(s,o)},{permutedX:s});if(t){var u=nn(c.shape,i);c=c.reshape(u)}return c}}),Ry=F({elu_:function(r){var e=k(r,"x","elu");return P.runKernelFunc(function(t,n){var i=t.elu(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return P.runKernelFunc(function(a){return a.eluDer(t,i)},{dy:t,y:i})}}})}}),lA=F({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=k(r,"x","leakyRelu");return nf(Z(e).mul(t),t)}}),Ty=F({prelu_:function(r,e){var t=k(r,"x","prelu"),n=k(e,"alpha","prelu");return P.runKernelFunc(function(i,a){var o=i.prelu(t,n);return a([t,n]),o},{x:t,alpha:n},function(i,a){var o=a[0],s=a[1],c=o.greater(0);return{x:function(){return Ki(c,i,i.mul(s))},alpha:function(){var u=Ki(c,Tt(i),i.mul(o)),l=we(s.shape,i.shape);return l.length>0&&(u=u.sum(l)),u.reshape(s.shape)}}},"Prelu")}}),Vt=F({relu_:function(r){var e=k(r,"x","relu");return e.dtype==="bool"?e.toInt():P.runKernelFunc(function(t,n){var i=t.relu(e);return n([e]),i},{x:e},function(t,n){var i=n[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),Fy=F({relu6_:function(r){var e=k(r,"x","relu6");return e.dtype==="bool"?e.toInt():P.runKernelFunc(function(t,n){var i=t.relu6(e);return n([e]),i},{x:e},function(t,n){var i=n[0],a=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(a.toFloat())}}},"Relu6")}}),dA=F({selu_:function(r){var e=k(r,"x","selu");return P.runKernelFunc(function(t,n){var i=t.selu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){var a=i.greater(Z(0)),o=Z(Jh),s=Z(Zh),c=t.mul(s),u=t.mul(o).mul(i.toFloat().exp());return Ki(a,c,u)}}})}}),Pn=F({transpose_:function(r,e){var t=k(r,"x","transpose");if(e==null&&(e=t.shape.map(function(i,a){return a}).reverse()),A(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){A(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var n={perm:e};return P.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var a=Ru(e);return{x:function(){return i.transpose(a)}}},"Transpose",n)}}),hA=F({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var a=k(r,"x","localResponseNormalization");A(a.rank===4||a.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+a.rank+"."}),A(ce(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var o=a,s=!1;a.rank===3&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=P.runKernelFunc(function(u,l){var d=u.localResponseNormalization4D(o,e,t,n,i);return l([o,d]),d},{x4D:o},function(u,l){var d=l[0],h=l[1];return{x4D:function(){return P.runKernelFunc(function(f){return f.LRNGrad(u,d,h,e,t,n,i)},{})}}});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Py=F({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=function s(c,u,l){if(l===void 0&&(l=null),c.rank===0)return c.abs();if(c.rank!==1&&l===null)return s(c.reshape([-1]),u,l);if(c.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(u===1)return c.abs().sum(l);if(u===1/0)return c.abs().max(l);if(u===-1/0)return c.abs().min(l);if(u==="euclidean"||u===2)return c.abs().pow(Z(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(l)&&l.length===2){if(u===1)return c.abs().sum(l[0]).max(l[1]-1);if(u===1/0)return c.abs().sum(l[1]).max(l[0]);if(u===-1/0)return c.abs().sum(l[1]).min(l[0]);if(u==="fro"||u==="euclidean")return c.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+l)}(r=k(r,"x","norm"),e,t),a=i.shape;if(n){var o=Ce(t,r.shape);a=nn(i.shape,o)}return i.reshape(a)}}),fA=F({basicLSTMCell_:function(r,e,t,n,i,a){var o=k(r,"forgetBias","basicLSTMCell"),s=k(e,"lstmKernel","basicLSTMCell"),c=k(t,"lstmBias","basicLSTMCell"),u=k(n,"data","basicLSTMCell"),l=k(i,"c","basicLSTMCell"),d=k(a,"h","basicLSTMCell"),h=u.concat(d,1).matMul(s).add(c),f=h.shape[0],p=h.shape[1]/4,m=[f,p],g=h.slice([0,0],m),v=h.slice([0,p],m),b=h.slice([0,2*p],m),_=h.slice([0,3*p],m),y=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(b).sigmoid())),x=y.tanh().mulStrict(_.sigmoid());return[y,x]}}),pA=F({multiRNNCell_:function(r,e,t,n){for(var i=k(e,"data","multiRNNCell"),a=xu(t,"c","multiRNNCell"),o=xu(n,"h","multiRNNCell"),s=i,c=[],u=0;u<r.length;u++){var l=r[u](s,a[u],o[u]);c.push(l[0]),c.push(l[1]),s=l[1]}var d=[],h=[];for(u=0;u<c.length;u+=2)d.push(c[u]),h.push(c[u+1]);return[d,h]}}),mA=F({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var a=k(r,"v","movingAverage"),o=k(e,"x","movingAverage"),s=k(t,"decay","movingAverage");W0(a,o),A(_e(a.shape,o.shape),function(){return"Shape mismatch in v and x"});var c=Z(1),u=c.sub(s),l=o.sub(a).mul(u);if(i){A(n!=null,function(){return"When using zeroDebias: true, step is required."});var d=k(n,"step","movingAverage");l=l.div(c.sub(Du(s,d)))}return a.add(l)}}),gA=F({stridedSlice_:function(r,e,t,n,i,a,o,s,c){if(i===void 0&&(i=0),a===void 0&&(a=0),o===void 0&&(o=0),s===void 0&&(s=0),c===void 0&&(c=0),n==null&&(n=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var u=k(r,"x","stridedSlice"),l=Ch(s),d=u.shape.slice();l.forEach(function(g){e[g]=0,t[g]=1,d.splice(g,0,1)}),u=u.reshape(d);for(var h=0;h<u.rank;h++)e[h]=Db(i,e,n,u.shape,h),t[h]=Ab(a,t,n,u.shape,h),n[h]=n[h]||1;var f=Ch(c);f.forEach(function(g){t[g]=e[g]+1,n[g]=1});var p=Pu(e,t,n),m=p.filter(function(g,v){return f.indexOf(v)===-1});return n.every(function(g){return g===1})?Un(u,e,p).reshape(m):P.runKernelFunc(function(g){return g.stridedSlice(u,e,t,n)},{$x:u}).reshape(m)}}),vA=F({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=k(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var a=P.runKernelFunc(function(o){return o.topk(n,e,t)},{$x:n});return{values:a[0],indices:a[1]}}}),bA=F({scatterND_:function(r,e,t){var n=k(r,"indices","scatterND","int32"),i=k(e,"updates","scatterND");return Eb(i,n,t),P.runKernelFunc(function(a){return a.scatterND(n,i,t)},{indices:n,updates:i},null,"ScatterNd",{shape:t})}}),sf=F({fft_:function(r){A(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return P.runKernelFunc(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),Au=F({ifft_:function(r){A(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return P.runKernelFunc(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),cf=F({rfft_:function(r,e){A(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var a=r.shape.map(function(v){return 0}),o=r.shape.map(function(v){return v});o[r.shape.length-1]=e,t=r.slice(a,o),n=e}else if(e!=null&&e>n){var s=r.shape.map(function(v){return v});s[r.shape.length-1]=e-n,t=r.concat(Kt(s),r.shape.length-1),n=e}else t=r;var c=t.zerosLike(),u=ze(t,c).as2D(i,n),l=sf(u),d=Math.floor(n/2)+1,h=Tn(l),f=dr(l),p=h.split([d,n-d],h.shape.length-1),m=f.split([d,n-d],f.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=d,ze(p[0],m[0]).reshape(g)}}),Oy=F({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=Au(n);return Tn(i)}var a=[t,2*(e-1)],o=Tn(r).as2D(t,e),s=dr(r).as2D(t,e),c=o.slice([0,1],[t,e-2]).reverse(1),u=s.slice([0,1],[t,e-2]).reverse(1).mul(Z(-1)),l=o.concat(c,1),d=s.concat(u,1);return n=ze(l,d).as2D(a[0],a[1]),i=Au(n),Tn(i)}}),yA=Object.freeze({fft:sf,ifft:Au,rfft:cf,irfft:Oy}),xA=F({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=k(r,"sparseIndices","sparseToDense","int32"),a=k(e,"sparseValues","sparseToDense"),o=k(n,"defaultValue","sparseToDense",a.dtype);return function(s,c,u,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,h=s.rank>1?s.shape[1]:1;if(u.length!==h)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+h+".");var f=c.size;if(c.rank!==0&&(c.rank!==1||f!==d))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+d+"]");if(c.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,t,o),P.runKernelFunc(function(s){return s.sparseToDense(i,a,t,o)},{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),_A=F({gatherND_:function(r,e){var t=k(e,"indices","gatherND","int32"),n=k(r,"x","gatherND");return P.runKernelFunc(function(i){return i.gatherND(n,t)},{x:n,indices:t},null,"GatherNd")}}),wA=F({diag_:function(r){var e=k(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return P.runKernelFunc(function(n){return n.diag(e)},{$x:e}).reshape(t)}}),CA=F({dropout_:function(r,e,t,n){var i=k(r,"x","dropout");if(A(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),A(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Ut?i.clone():i;var a=function(c,u){if(u==null)return c.shape.slice();if(_e(c.shape,u))return u;if(c.shape.length===u.length){for(var l=[],d=0;d<c.shape.length;d++)u[d]==null&&c.shape[d]!=null?l.push(c.shape[d]):l.push(u[d]);return l}return u}(i,t),o=1-e,s=yb(a,0,1,"float32",n).add(o).floor().div(o);return i.mul(s)}});function Ny(r,e,t){for(var n=1-r%2,i=new Float32Array(r),a=0;a<r;++a){var o=2*Math.PI*a/(r+n-1);i[a]=e-t*Math.cos(o)}return qt(i,"float32")}var uf=F({hannWindow_:function(r){return Ny(r,.5,.5)}}),Ly=F({hammingWindow_:function(r){return Ny(r,.54,.46)}}),lf=F({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var a=0,o=[];a+e<=r.size;)o.push(Un(r,a,e)),a+=t;if(n)for(;a<r.size;){var s=a+e-r.size,c=Zt([Un(r,a,e-s),kn([s],i)]);o.push(c),a+=t}return o.length===0?hr([],[0,e]):Zt(o).as2D(o.length,e)}}),By=F({stft_:function(r,e,t,n,i){var a;i===void 0&&(i=uf),n==null&&(a=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=lf(r,e,t),s=se(o,i(e)),c=[],u=0;u<o.shape[0];u++)c.push(cf(s.slice([u,0],[1,e]),n));return Zt(c)}}),SA=Object.freeze({hannWindow:uf,hammingWindow:Ly,frame:lf,stft:By}),Qe,EA=function(r,e,t){return t===void 0&&(t=1),st(this,void 0,void 0,function(){var n,i,a,o,s,c,u,l,d,h,f,p,m,g;return ct(this,function(v){switch(v.label){case 0:return n=k(r,"predictions","inTopK"),i=k(e,"targets","inTopK"),A(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank}),A(n.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank}),Nt(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=n.shape[n.shape.length-1],A(t>0&&t<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+t}),[4,n.data()];case 1:return o=v.sent(),[4,i.data()];case 2:for(s=v.sent(),c=[o.length/a,a],l=c[1],d=Ya("bool",u=c[0]),h=0;h<u;h++){for(f=h*l,p=o.subarray(f,f+l),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(b,_){return _.value-b.value}),d[h]=0,g=0;g<t;g++)if(m[g].index===s[h]){d[h]=1;break}}return r!==n&&n.dispose(),e!==i&&i.dispose(),[2,Ne(d,i.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Qe||(Qe={}));var kA=F({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=Qe.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","absoluteDifference"),a=k(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=k(t,"weights","absoluteDifference")),Nt(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return Wr(s,o,n)}}),Wr=F({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=Qe.SUM_BY_NONZERO_WEIGHTS);var n=k(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=k(e,"weights","computeWeightedLoss"));var a=i==null?n:n.mul(i);if(t===Qe.NONE)return a;if(t===Qe.SUM)return a.sum();if(t===Qe.MEAN){if(i==null)return a.mean();var o=n.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(Z(o)):s}if(t===Qe.SUM_BY_NONZERO_WEIGHTS){if(i==null)return a.sum().div(Z(n.size));var c=i.mul(Qa(n.shape)).notEqual(Z(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+t)}}),DA=F({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=Qe.SUM_BY_NONZERO_WEIGHTS);var a=k(r,"labels","cosineDistance"),o=k(e,"predictions","cosineDistance"),s=null;n!=null&&(s=k(n,"weights","cosineDistance")),Nt(a.shape,o.shape,"Error in cosineDistance: ");var c=Z(1).sub(a.mul(o).sum(t,!0));return Wr(c,s,i)}}),AA=F({hingeLoss_:function(r,e,t,n){n===void 0&&(n=Qe.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","hingeLoss"),a=k(e,"predictions","hingeLoss"),o=null;t!=null&&(o=k(t,"weights","hingeLoss")),Nt(i.shape,a.shape,"Error in hingeLoss: ");var s=Z(1);i=Z(2).mul(i).sub(s);var c=s.sub(i.mul(a)).relu();return Wr(c,o,n)}}),IA=F({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=Qe.SUM_BY_NONZERO_WEIGHTS);var a=k(r,"labels","huberLoss"),o=k(e,"predictions","huberLoss"),s=null;t!=null&&(s=k(t,"weights","huberLoss")),Nt(a.shape,o.shape,"Error in huberLoss: ");var c=Z(n),u=o.sub(a).abs(),l=by(u,c),d=u.sub(l),h=Z(.5).mul(l.square()).add(c.mul(d));return Wr(h,s,i)}}),MA=F({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=Qe.SUM_BY_NONZERO_WEIGHTS);var a=k(r,"labels","logLoss"),o=k(e,"predictions","logLoss"),s=null;t!=null&&(s=k(t,"weights","logLoss")),Nt(a.shape,o.shape,"Error in logLoss: ");var c=Z(1),u=Z(n),l=a.mul(o.add(u).log()).neg().sub(c.sub(a).mul(c.sub(o).add(u).log()));return Wr(l,s,i)}}),RA=F({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=Qe.SUM_BY_NONZERO_WEIGHTS);var i=k(r,"labels","meanSquaredError"),a=k(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=k(t,"weights","meanSquaredError")),Nt(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return Wr(s,o,n)}}),TA=F({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=Qe.SUM_BY_NONZERO_WEIGHTS);var a=k(r,"multiClassLabels","sigmoidCrossEntropy"),o=k(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","sigmoidCrossEntropy")),Nt(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var c=Z(n),u=Z(1),l=Z(.5);a=a.mul(u.sub(c)).add(l.mul(c))}var d=function(h,f){var p=k(h,"labels","sigmoidCrossEntropyWithLogits"),m=k(f,"logits","sigmoidCrossEntropyWithLogits");Nt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),b=m.abs().neg().exp().log1p();return g.sub(v).add(b)}(a,o);return Wr(d,s,i)}}),FA=F({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=Qe.SUM_BY_NONZERO_WEIGHTS);var a=k(r,"onehotLabels","softmaxCrossEntropy"),o=k(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=k(t,"weights","softmaxCrossEntropy")),Nt(a.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var c=Z(n),u=Z(1),l=Z(a.shape[1]);a=a.mul(u.sub(c)).add(c.div(l))}var d=function(h,f,p){if(p===void 0&&(p=-1),p===-1&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return Ou(function(m,g,v){var b=g.logSumExp([p],!0),_=g.toFloat().sub(b);return v([m,_]),{value:_.mul(m).neg().sum([p]),gradFunc:function(y,x){var w=x[0],S=x[1],C=nn(y.shape,[p]);return[y.reshape(C).mul(w.toFloat().sub(S.exp())),y.reshape(C).mul(S.exp().sub(w.toFloat()))]}}})(h,f)}(a,o);return Wr(d,s,i)}}),PA=Object.freeze({get Reduction(){return Qe},absoluteDifference:kA,computeWeightedLoss:Wr,cosineDistance:DA,hingeLoss:AA,huberLoss:IA,logLoss:MA,meanSquaredError:RA,sigmoidCrossEntropy:TA,softmaxCrossEntropy:FA});function h0(r,e){return e===void 0&&(e=!1),P.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=bb(t),a=r.clone(),o=hr([[1]],[1,1]),s=o.clone(),c=t>=n?n:t,u=function(d){var h,f=a,p=s,m=i;h=P.tidy(function(){var g=a.slice([d,d],[t-d,1]),v=g.norm(),b=a.slice([d,d],[1,1]),_=hr([[-1]]).where(b.greater(0),hr([[1]])),y=b.sub(_.mul(v)),x=g.div(y);s=x.shape[0]===1?o.clone():o.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var w=_.matMul(y).div(v).neg(),S=a.slice([d,0],[t-d,n]),C=w.mul(s);if(d===0)a=S.sub(C.matMul(s.transpose().matMul(S)));else{var E=S.sub(C.matMul(s.transpose().matMul(S)));a=a.slice([0,0],[d,n]).concat(E,0)}var D=i.slice([0,d],[t,i.shape[1]-d]);if(d===0)i=D.sub(D.matMul(s).matMul(C.transpose()));else{var R=D.sub(D.matMul(s).matMul(C.transpose()));i=i.slice([0,0],[t,d]).concat(R,1)}return[s,a,i]}),s=h[0],a=h[1],i=h[2],pn([f,p,m])},l=0;l<c;++l)u(l);return!e&&t>n&&(i=i.slice([0,0],[t,n]),a=a.slice([0,0],[n,n])),[i,a]})}var OA=F({bandPart_:function(r,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var n=k(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var i=n.shape,a=n.shape.slice(-2),o=a[0],s=a[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=o),t<0&&(t=s);var c=_u(0,o,1,"int32").reshape([-1,1]),u=_u(0,s,1,"int32"),l=Gt(c,u),d=Vu(l.lessEqual(Z(+e,"int32")),l.greaterEqual(Z(-t,"int32"))),h=Kt([o,s],n.dtype);return Ue(zt(n.reshape([-1,o,s])).map(function(f){return Ki(d,f,h)})).reshape(i)}}),NA=F({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,A(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(c){A(r[c].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[c].shape[0]+" vs. "+t+")"})},i=1;i<r.length;++i)n(i)}else e=!0,r=Vh(r,r.shape[0],0).map(function(c){return _b(c,[0])});A(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var a=[],o=r,s=function(c){a.push(P.tidy(function(){var u=o[c];if(c>0)for(var l=0;l<c;++l){var d=My(a[l].mulStrict(u)).mul(a[l]);u=u.sub(d)}return u.div(Py(u,"euclidean"))}))};for(i=0;i<r.length;++i)s(i);return e?Ue(a,0):a}}),LA=F({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return h0(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(o,s){return o*s}),n=zt(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],a=[];return n.forEach(function(o){var s=h0(o,e),c=s[0],u=s[1];i.push(c),a.push(u)}),[Ue(i,0).reshape(r.shape),Ue(a,0).reshape(r.shape)]}}),BA=Object.freeze({bandPart:OA,gramSchmidt:NA,qr:LA});function Wu(r,e,t,n,i,a){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY),a==null&&(a=0);var o=r.shape[0];return t=Math.min(t,o),A(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),A(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),A(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),A(e.rank===1,function(){return"scores must be a 1D tensor"}),A(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),A(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i,softNmsSigma:a}}var VA=F({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeBilinear");A(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),A(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e[0],s=e[1],c=P.runKernelFunc(function(u,l){return l([i]),u.resizeBilinear(i,o,s,t)},{x:i},function(u,l){return{x:function(){return P.runKernelFunc(function(d){return d.resizeBilinearBackprop(u,l[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:o,newWidth:s});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),WA=F({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=k(r,"images","resizeNearestNeighbor");A(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),A(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),A(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,a=!1;n.rank===3&&(a=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e[0],s=e[1],c=P.runKernelFunc(function(u,l){return l([i]),u.resizeNearestNeighbor(i,o,s,t)},{batchImages:i},function(u,l){return{batchImages:function(){return P.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(u,l[0],t)},{})}}});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),zA=F({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var a=k(r,"boxes","nonMaxSuppression"),o=k(e,"scores","nonMaxSuppression"),s=Wu(a,o,t,n,i);t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold;var c={maxOutputSize:t,iouThreshold:n,scoreThreshold:i};return P.runKernelFunc(function(u){return u.nonMaxSuppression(a,o,t,n,i)},{boxes:a,scores:o},null,"NonMaxSuppressionV3",c)}}),jA=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),st(this,void 0,void 0,function(){var a,o,s,c,u,l,d;return ct(this,function(h){switch(h.label){case 0:return a=k(r,"boxes","nonMaxSuppressionAsync"),o=k(e,"scores","nonMaxSuppressionAsync"),s=Wu(a,o,t,n,i),t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return c=h.sent(),u=c[0],l=c[1],d=Kh(u,l,t,n,i),a!==r&&a.dispose(),o!==e&&o.dispose(),[2,d]}})})},HA=F({nonMaxSuppressionWithScore_:function(r,e,t,n,i,a){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0);var o=k(r,"boxes","nonMaxSuppression"),s=k(e,"scores","nonMaxSuppression"),c=Wu(o,s,t,n,i,a),u={maxOutputSize:t=c.maxOutputSize,iouThreshold:n=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:a=c.softNmsSigma},l=P.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},u);return{selectedIndices:l[0],selectedScores:l[1]}}}),UA=function(r,e,t,n,i,a){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),a===void 0&&(a=0),st(this,void 0,void 0,function(){var o,s,c,u,l,d,h;return ct(this,function(f){switch(f.label){case 0:return o=k(r,"boxes","nonMaxSuppressionAsync"),s=k(e,"scores","nonMaxSuppressionAsync"),c=Wu(o,s,t,n,i,a),t=c.maxOutputSize,n=c.iouThreshold,i=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return u=f.sent(),l=u[0],d=u[1],h=Xh(l,d,t,n,i,a),o!==r&&o.dispose(),s!==e&&s.dispose(),[2,h]}})})},GA=F({cropAndResize_:function(r,e,t,n,i,a){var o=k(r,"image","cropAndResize"),s=k(e,"boxes","cropAndResize","float32"),c=k(t,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var u=s.shape[0];return A(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),A(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+s.shape+"."}),A(c.rank===1&&c.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+s.shape+"."}),A(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),A(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),A(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),P.runKernelFunc(function(l,d){return l.cropAndResize(o,s,c,n,i,a)},{images:o,boxes:s,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:n})}}),Cs=Object.freeze({resizeBilinear:VA,resizeNearestNeighbor:WA,nonMaxSuppression:zA,nonMaxSuppressionAsync:jA,nonMaxSuppressionWithScore:HA,nonMaxSuppressionWithScoreAsync:UA,cropAndResize:GA}),df=function(r,e){return!(r>0)||e==="linear"},hf=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},ff=function(r,e){var t=e,n=we(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},pf=function(r,e,t){if(e==="linear")return r;if(e==="relu")return Vt(r);if(e==="elu")return Ry(r);if(e==="relu6")return Fy(r);if(e==="prelu")return Ty(r,t);throw new Error("Unknown fused activation "+e+".")},qA=F({fusedMatMul_:function(r){var e,t=r.a,n=r.b,i=r.transposeA,a=i!==void 0&&i,o=r.transposeB,s=o!==void 0&&o,c=r.bias,u=r.activation,l=u===void 0?"linear":u,d=r.preluActivationWeights;if(df(P.state.gradientDepth,l)===!1){var h=Ja(t,n,a,s);return c!=null&&(h=ht(h,c)),pf(h,l,d)}var f=k(t,"a","fused matMul"),p=k(n,"b","fused matMul");e=te(f,p),f=e[0],p=e[1];var m=a?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=a?f.shape[f.rank-1]:f.shape[f.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],_=f.shape.slice(0,-2),y=p.shape.slice(0,-2),x=ut(_),w=ut(y);A(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),A(_e(_,y),function(){return"Error in fused matMul: outer dimensions ("+_+") and ("+y+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),A(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var S,C,E=f.shape.slice(0,-2).concat([v,b]),D=a?f.as3D(x,m,v):f.as3D(x,v,m),R=s?p.as3D(w,b,g):p.as3D(w,g,b);c!=null&&St(E,(S=te(S=k(c,"bias","fused matMul"),f)[0]).shape),d!=null&&(C=k(d,"prelu weights","fused matMul"));var M={a:D,b:R};c!=null&&(M.bias=S),d!=null&&(M.preluActivationWeights=C);var L=[D,R];return P.runKernelFunc(function(B,O){var z=B.fusedBatchMatMul({a:D,b:R,transposeA:a,transposeB:s,bias:S,activation:l,preluActivationWeights:C});return O([D,R,z]),z},M,function(B,O){var z=O[0],W=O[1],j=O[2],G=hf(B,j,l),X={};return c!=null&&(X={bias:function(){return ff(S,G)}}),Object.assign(a||s?!a&&s?{a:function(){return G.matMul(W,!1,!1)},b:function(){return G.matMul(z,!0,!1)}}:a&&!s?{a:function(){return W.matMul(G,!1,!0)},b:function(){return z.matMul(G,!1,!1)}}:{a:function(){return W.matMul(G,!0,!0)},b:function(){return G.matMul(z,!0,!0)}}:{a:function(){return G.matMul(W,!1,!0)},b:function(){return z.matMul(G,!0,!1)}},X)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},L,[!0]).reshape(E)}}),YA=F({fusedConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,o=a===void 0?"NHWC":a,s=r.dilations,c=s===void 0?[1,1]:s,u=r.dimRoundingMode,l=r.bias,d=r.activation,h=d===void 0?"linear":d,f=r.preluActivationWeights;if(h=h||"linear",df(P.state.gradientDepth,h)===!1){var p=Le(e,t,n,i,o,c,u);return l!=null&&(p=ht(p,l)),pf(p,h,f)}var m=k(e,"x","conv2d"),g=k(t,"filter","conv2d"),v=m,b=!1;m.rank===3&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),A(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),u!=null&&A(ce(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."}),A(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),A(rn(n,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+c+"'"}),A(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var _,y,x=mi(v.shape,g.shape,n,c,i,u);l!=null&&(_=te(_=k(l,"bias","fused conv2d"),m)[0],St(x.outShape,_.shape)),f!=null&&(y=k(f,"prelu weights","fused conv2d"));var w={x:v,filter:g};l!=null&&(w.bias=_),f!=null&&(w.preluActivationWeights=y);var S=[g,v],C=P.runKernelFunc(function(E,D){var R=E.fusedConv2d({input:v,filter:g,convInfo:x,bias:_,activation:h,preluActivationWeights:y});return D([g,v,R]),R},w,function(E,D){var R=D,M=R[0],L=R[1],B=R[2],O=hf(E,B,h);A(Yi(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var z={};return l!=null&&(z={bias:function(){return ff(_,O)}}),Object.assign({x:function(){return Sy(L.shape,O,M,n,i)},filter:function(){return af(L,O,M.shape,n,i)}},z)},"FusedConv2D",{convInfo:x,activation:h},S,[!0]);return b?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),KA=F({fusedDepthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,a=r.dataFormat,o=a===void 0?"NHWC":a,s=r.dilations,c=s===void 0?[1,1]:s,u=r.dimRoundingMode,l=r.bias,d=r.activation,h=d===void 0?"linear":d,f=r.preluActivationWeights;if(df(P.state.gradientDepth,h)===!1){var p=xs(e,t,n,i,o,c,u);return l!=null&&(p=ht(p,l)),pf(p,h,f)}var m=k(e,"x","depthwiseConv2d"),g=k(t,"filter","depthwiseConv2d"),v=m,b=!1;m.rank===3&&(b=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),A(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),A(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),c==null&&(c=[1,1]),A(rn(n,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+c+"'"}),u!=null&&A(ce(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+i+"."});var _,y,x=mi(v.shape,g.shape,n,c,i,u,!0);l!=null&&(_=te(_=k(l,"bias","fused conv2d"),m)[0],St(x.outShape,_.shape)),f!=null&&(y=k(f,"prelu weights","fused depthwiseConv2d"));var w={x:v,filter:g};l!=null&&(w.bias=_),f!=null&&(w.preluActivationWeights=y);var S=[g,v],C=P.runKernelFunc(function(E,D){var R=E.fusedDepthwiseConv2D({input:v,filter:g,convInfo:x,bias:_,activation:h,preluActivationWeights:y});return D([g,v,R]),R},w,function(E,D){A(Yi(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var R=D[0],M=D[1],L=D[2],B=hf(E,L,h),O={};return l!=null&&(O={bias:function(){return ff(_,B)}}),Object.assign({x:function(){return Ey(M.shape,B,R,x)},filter:function(){return ky(M,B,R.shape,x)}},O)},"FusedDepthwiseConv2D",{convInfo:x,activation:h},S,[!0]);return b?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),XA=Object.freeze({matMul:qA,conv2d:YA,depthwiseConv2d:KA}),$A=Object.freeze({image:Cs,linalg:BA,losses:PA,spectral:yA,fused:XA,signal:SA,square:Mk,squaredDifference:ly,conv1d:VD,conv2d:Le,conv3d:WD,depthwiseConv2d:xs,separableConv2d:_s,conv2dTranspose:zD,conv3dTranspose:jD,op:F,batchNormalization2d:oD,batchNormalization3d:sD,batchNormalization4d:cD,batchNormalization:uD,batchNorm:ef,batchNorm2d:lD,batchNorm3d:dD,batchNorm4d:hD,booleanMaskAsync:BD,complex:ze,real:Tn,imag:dr,concat:Zt,concat1d:vS,concat2d:bS,concat3d:yS,concat4d:xS,split:Vh,matMul:Ja,dot:HD,outerProduct:UD,reverse:ws,reverse1d:GD,reverse2d:qD,reverse3d:YD,reverse4d:KD,maxPool:ue,avgPool:Vr,pool:XD,maxPool3d:$D,avgPool3d:QD,slice:Un,slice1d:JD,slice2d:ZD,slice3d:of,slice4d:tA,abs:Rk,acos:Tk,acosh:Fk,asin:Pk,asinh:Ok,atan:Nk,atanh:Lk,ceil:Bk,clipByValue:vs,cos:Vk,cosh:Wk,erf:zk,exp:Lu,expm1:jk,floor:Hk,log:Uk,log1p:Gk,logSigmoid:qk,neg:bs,reciprocal:Yk,round:Kk,rsqrt:dy,sigmoid:tf,sign:Xk,isNaN:$k,isInf:Qk,isFinite:Jk,sin:Zk,sinh:tD,softplus:eD,sqrt:nD,step:rD,tan:iD,tanh:aD,all:eA,any:nA,argMax:rA,argMin:iA,logSumExp:aA,max:Qi,mean:oA,min:sA,moments:cA,sum:My,prod:uA,equal:yy,equalStrict:AD,greater:ID,greaterEqual:xy,greaterEqualStrict:MD,greaterStrict:RD,less:TD,lessEqual:FD,lessEqualStrict:PD,lessStrict:OD,notEqual:ND,notEqualStrict:LD,add:ht,addN:mD,addStrict:gD,atan2:vD,div:Fn,divNoNan:bD,divStrict:yD,floorDiv:vy,maximum:nf,maximumStrict:xD,minimum:by,minimumStrict:_D,mod:wD,modStrict:CD,mul:se,mulStrict:SD,pow:Du,powStrict:ED,squaredDifferenceStrict:kD,sub:Gt,subStrict:DD,elu:Ry,leakyRelu:lA,prelu:Ty,relu:Vt,relu6:Fy,selu:dA,logicalAnd:Vu,logicalNot:fD,logicalOr:my,logicalXor:pD,where:Ki,whereAsync:gy,buffer:xt,print:IS,batchToSpaceND:vb,broadcastTo:MS,cast:RS,clone:TS,cumsum:FS,depthToSpace:PS,expandDims:Xe,eye:bb,multinomial:OS,oneHot:wh,pad:Br,pad1d:NS,pad2d:LS,pad3d:BS,pad4d:VS,rand:WS,randomNormal:zS,randomGamma:jS,randomUniform:yb,reshape:an,spaceToBatchND:xb,squeeze:_b,stack:Ue,tile:Ui,truncatedNormal:HS,unstack:zt,setdiff1dAsync:US,fill:kn,linspace:gS,ones:Qa,range:_u,scalar:Z,tensor:Ne,tensor1d:qt,tensor2d:hr,tensor3d:Tu,tensor4d:Ae,tensor5d:fS,tensor6d:pS,variable:mS,zeros:Kt,onesLike:gb,zerosLike:Tt,transpose:Pn,softmax:on,logSoftmax:qS,localResponseNormalization:hA,norm:Py,gather:rf,unsortedSegmentSum:_y,basicLSTMCell:fA,multiRNNCell:pA,movingAverage:mA,stridedSlice:gA,topk:vA,scatterND:bA,fft:sf,ifft:Au,rfft:cf,irfft:Oy,sparseToDense:xA,gatherND:_A,diag:wA,dropout:CA,hannWindow:uf,hammingWindow:Ly,frame:lf,stft:By,inTopKAsync:EA});function Y(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&A(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function th(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var QA=function(r){function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Ib(t,P),t}return Gn(e,r),e.prototype.write=function(t,n,i){this.firstUse&&(this.firstUse=!1,U().get("IS_NODE")&&yu(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var a={};return this.data.set(a,{values:t,dtype:i}),a},e.prototype.move=function(t,n,i,a){this.data.set(t,{values:n,dtype:a})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),i=n.dtype,a=n.complexTensors;return i==="complex64"?Eh(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),i=n;if(t.dtype==="string")try{i=n.map(function(a){return os(a)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return xt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,n,i){var a=this.write(t,n,i);return P.makeTensorFromDataId(a,n,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return st(this,void 0,void 0,function(){var n;return ct(this,function(i){return n=jn(),t(),[2,{kernelMs:jn()-n}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:P.keep(t.clone()),imag:P.keep(n.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(Y(t,"slice"),Hh(t.shape,n,i)){var a=Uh(n,t.strides),o=ut(i);return Ne(this.readSync(t.dataId).subarray(a,a+o),i,t.dtype)}for(var s=xt(i,t.dtype),c=this.bufferSync(t),u=0;u<s.size;++u){var l=s.indexToLoc(u).map(function(d,h){return d+n[h]});s.values[u]=c.get.apply(c,l)}return s.toTensor()},e.prototype.stridedSlice=function(t,n,i,a){Y(t,"stridedSlice");var o=Pu(n,i,a);if(o.some(function(f){return f===0}))return Ne([],o);for(var s=xt(o,t.dtype),c=this.bufferSync(t),u=0;u<s.size;u++){for(var l=s.indexToLoc(u),d=new Array(l.length),h=0;h<d.length;h++)d[h]=l[h]*a[h]+n[h];s.set.apply(s,[c.get.apply(c,d)].concat(l))}return s.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),i=xt([t.size,t.size],t.dtype),a=i.values,o=0;o<n.length;o++)a[o*t.size+o]=n[o];return i.toTensor()},e.prototype.unstack=function(t,n){for(var i=t.shape[n],a=new Array(t.rank-1),o=0,s=0;s<t.rank;s++)s!==n&&(a[o++]=t.shape[s]);var c=new Array(t.rank).fill(0),u=t.shape.slice();u[n]=1;var l=new Array(i);for(s=0;s<l.length;s++)c[n]=s,l[s]=this.slice(t,c,u).reshape(a);return l},e.prototype.reverse=function(t,n){Y(t,"reverse");for(var i=xt(t.shape,t.dtype),a=this.bufferSync(t),o=function(c){var u=i.indexToLoc(c),l=u.slice();n.forEach(function(d){return l[d]=t.shape[d]-1-l[d]}),i.set.apply(i,[a.get.apply(a,l)].concat(u))},s=0;s<i.size;s++)o(s);return i.toTensor()},e.prototype.concat=function(t,n){var i=this;if(t[0].dtype==="complex64"){var a=t.map(function(f){return Tn(f)}),o=t.map(function(f){return dr(f)});return ze(this.concat(a,n),this.concat(o,n))}var s=t.map(function(f){var p=ut(f.shape.slice(n));return f.as2D(-1,p)}),c=qi(s.map(function(f){return f.shape}),1),u=xt(c,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(f){u.set(i.readSync(f.dataId),l),l+=f.size})}else{var d=0;s.forEach(function(f){for(var p=i.readSync(f.dataId),m=0,g=0;g<f.shape[0];++g)for(var v=g*c[1]+d,b=0;b<f.shape[1];++b)u[v+b]=p[m++];d+=f.shape[1]})}var h=qi(t.map(function(f){return f.shape}),n);return Ne(u,h,t[0].dtype)},e.prototype.neg=function(t){return Y(t,"neg"),this.multiply(Z(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,s){return{real:i+o,imag:a+s}}):this.broadcastedBinaryOp(t,n,Oe(t.dtype,n.dtype),function(i,a){return i+a})},e.prototype.addN=function(t){var n=this;Y(t,"addN");for(var i=t.map(function(l){return n.readSync(l.dataId)}),a=xt(t[0].shape,t[0].dtype),o=a.values,s=0;s<t.length;s++)for(var c=i[s],u=0;u<o.length;u++)o[u]+=c[u];return a.toTensor()},e.prototype.softmax=function(t,n){var i=Ce([n],t.shape),a=this.max(t,i),o=nn(a.shape,i),s=this.subtract(t,a.reshape(o)),c=this.exp(s),u=this.sum(c,i).reshape(o);return this.realDivide(c,u)},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,s){return{real:i-o,imag:a-s}}):this.broadcastedBinaryOp(t,n,Oe(t.dtype,n.dtype),function(i,a){return i-a})},e.prototype.pow=function(t,n){return Y([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.pow(i,a)})},e.prototype.batchMatMul=function(t,n,i,a){Y([t,n],"matMul");for(var o=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],c=a?n.shape[1]:n.shape[2],u=t.shape[0],l=this.readSync(t.dataId),d=this.readSync(n.dataId),h=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=h[0],p=h[1],m=h[2],g=a?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],v=g[0],b=g[1],_=g[2],y=s*c,x=xt([u,s,c],t.dtype),w=x.values,S=this.blockSize,C=0;C<u;C++)for(var E=0;E<s;E+=S)for(var D=0;D<c;D+=S)for(var R=0;R<o;R+=S)for(var M=Math.min(E+S,s),L=Math.min(D+S,c),B=Math.min(R+S,o),O=E;O<M;O++)for(var z=D;z<L;z++){for(var W=0,j=R;j<B;j++)W+=l[C*f+O*p+j*m]*d[j*v+z*b+C*_];w[C*y+(O*c+z)]+=W}return x.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,a=t.transposeA,o=t.transposeB,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=this.batchMatMul(n,i,a,o);return s&&(l=this.add(l,s)),c&&(l=th(this,l,c,u)),l},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),function(i,a,o,s){return{real:i*o-a*s,imag:i*s+a*o}}):this.broadcastedBinaryOp(t,n,Oe(t.dtype,n.dtype),function(i,a){return i*a})},e.prototype.realDivide=function(t,n){return Y([t,n],"realDivide"),this.broadcastedBinaryOp(t,n,"float32",function(i,a){return i/a})},e.prototype.floorDiv=function(t,n){return Y([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",function(i,a){return Math.floor(i/a)})},e.prototype.sum=function(t,n){Y(t,"sum"),hn("sum",n,t.rank);for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,Oe(t.dtype,"int32")),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=0,p=0;p<c;++p)f+=l[h+p];u[d]=f}return s},e.prototype.prod=function(t,n){Y(t,"sum");for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,Oe(t.dtype,"int32")),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=1,p=0;p<c;++p)f*=l[h+p];u[d]=f}return s},e.prototype.unsortedSegmentSum=function(t,n,i){Y(t,"unsortedSegmentSum");for(var a=[],o=t.rank-n.rank,s=0;s<o;++s)n=n.expandDims(s+1);for(s=0;s<i;++s){var c=Z(s,"int32"),u=yy(c,n).asType("float32").mul(t).sum(0);a.push(u)}return Ue(a)},e.prototype.argMin=function(t,n){Y(t,"argMin");var i=[n];hn("argMin",i,t.rank);for(var a=je(t.shape,i),o=a[0],s=a[1],c=Kt(o,"int32"),u=ut(s),l=this.readSync(c.dataId),d=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,p=d[f],m=0,g=0;g<u;++g){var v=d[f+g];v<p&&(p=v,m=g)}l[h]=m}return c},e.prototype.argMax=function(t,n){Y(t,"argMax");var i=[n];hn("argMax",i,t.rank);for(var a=je(t.shape,i),o=a[0],s=a[1],c=Kt(o,"int32"),u=ut(s),l=this.readSync(c.dataId),d=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,p=d[f],m=0,g=0;g<u;++g){var v=d[f+g];v>p&&(p=v,m=g)}l[h]=m}return c},e.prototype.cumsum=function(t,n,i,a){if(Y(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var o=Oe(t.dtype,"int32"),s=Kt(t.shape,o),c=this.readSync(s.dataId),u=this.readSync(t.dataId),l=t.shape[t.rank-1],d=a?function(g,v){return g+l-v-1}:function(g,v){return g+v},h=0;h<u.length;h+=l)for(var f=0;f<l;f++){var p=d(h,f);if(f===0)c[p]=i?0:u[p];else{var m=d(h,f-1);c[p]=i?u[m]+c[m]:u[p]+c[m]}}return s},e.prototype.equal=function(t,n){return Y([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i===a?1:0})},e.prototype.notEqual=function(t,n){return Y([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i!==a?1:0})},e.prototype.less=function(t,n){return Y([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<a?1:0})},e.prototype.lessEqual=function(t,n){return Y([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i<=a?1:0})},e.prototype.greater=function(t,n){return Y([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>a?1:0})},e.prototype.greaterEqual=function(t,n){return Y([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i>=a?1:0})},e.prototype.logicalNot=function(t){Y(t,"logicalNot");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n[a]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return Y([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i&&a})},e.prototype.logicalOr=function(t,n){return Y([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",function(i,a){return i||a})},e.prototype.select=function(t,n,i){Y([t,n,i],"select");for(var a=this.readSync(t.dataId),o=this.readSync(n.dataId),s=this.readSync(i.dataId),c=Kt(n.shape,Oe(n.dtype,i.dtype)),u=this.readSync(c.dataId),l=0,d=t.rank===0||t.rank>1||n.rank===1?1:ut(n.shape.slice(1)),h=0;h<a.length;h++)for(var f=0;f<d;f++)a[h]===1?u[l++]=o[h]:u[l++]=s[h];return c},e.prototype.where=function(t){Y([t],"where");var n=this.readSync(t.dataId);return $h(t.shape,n)},e.prototype.topk=function(t,n,i){return Y(t,"topk"),Pb(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Y(t,"min"),hn("min",n,t.rank);for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,t.dtype),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=l[h],p=0;p<c;++p){var m=l[h+p];m<f&&(f=m)}u[d]=f}return s},e.prototype.minimum=function(t,n){return Y([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.min(i,a)})},e.prototype.mod=function(t,n){return Y([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var o=i%a;return i<0&&a<0||i>=0&&a>=0?o:(o+a)%a})},e.prototype.max=function(t,n){Y(t,"max"),hn("max",n,t.rank);for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,t.dtype),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=l[h],p=0;p<c;++p){var m=l[h+p];m>f&&(f=m)}u[d]=f}return s},e.prototype.maximum=function(t,n){return Y([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.max(i,a)})},e.prototype.all=function(t,n){Y(t,"all"),hn("all",n,t.rank);for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,t.dtype),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=l[h],p=0;p<c;++p){var m=l[h+p];f=f&&m}u[d]=f}return s},e.prototype.any=function(t,n){Y(t,"any"),hn("any",n,t.rank);for(var i=je(t.shape,n),a=i[0],o=i[1],s=Kt(a,t.dtype),c=ut(o),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var h=d*c,f=l[h],p=0;p<c;++p){var m=l[h+p];f=f||m}u[d]=f}return s},e.prototype.squaredDifference=function(t,n){return Y([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){var o=i-a;return o*o})},e.prototype.ceil=function(t){Y(t,"ceil");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.ceil(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Y(t,"floor");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.floor(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Y(t,"x");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)n[a]<0?i[a]=-1:n[a]>0?i[a]=1:i[a]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Y(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isNaN(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Y(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Math.abs(n[a])===1/0&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Y(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),a=0;a<n.length;++a)Number.isFinite(n[a])&&(i[a]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Y(t,"round");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=Math.floor(n[a]);n[a]-o<.5?i[a]=Math.floor(n[a]):n[a]-o>.5?i[a]=Math.ceil(n[a]):i[a]=o%2==0?o:o+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Y(t,"exp");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.exp(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Y(t,"expm1");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=Math.expm1(n[a]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Y(t,"log");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.log(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Y(t,"log1p");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.log1p(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Y(t,"sqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Y(t,"rsqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a){var o=n[a];i[a]=1/Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Y(t,"reciprocal");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),a=0;a<n.length;++a)i[a]=1/n[a];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Y(t,"relu");for(var n=Kt(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.max(0,a[o]);return n},e.prototype.relu6=function(t){Y(t,"relu");for(var n=Kt(t.shape,t.dtype),i=this.readSync(n.dataId),a=this.readSync(t.dataId),o=0;o<a.length;++o)i[o]=Math.min(Math.max(0,a[o]),6);return n},e.prototype.prelu=function(t,n){return Y([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return i<0?a*i:i})},e.prototype.elu=function(t){Y(t,"elu");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=i[a];n[a]=o>=0?o:Math.exp(o)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){Y([t,n],"eluDer");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),o=this.readSync(t.dataId),s=0;s<a.length;++s){var c=a[s];i[s]=c>=1?o[s]:o[s]*(c+1)}return this.makeOutput(i,n.shape,"float32")},e.prototype.selu=function(t){Y(t,"selu");for(var n=Jh,i=Zh,a=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var c=o[s];a[s]=c>=0?i*c:n*(Math.exp(c)-1)}return this.makeOutput(a,t.shape,"float32")},e.prototype.clip=function(t,n,i){Y(t,"clip");for(var a=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var c=o[s];a[s]=c>i?i:c<n?n:c}return this.makeOutput(a,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.abs(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<t.size;++a){var o=i[2*a],s=i[2*a+1];n[a]=Math.hypot(o,s)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){Y(t,"int");for(var n=new Int32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=i[a];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){Y(t,"sigmoid");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=1/(1+Math.exp(-i[a]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){Y(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var s=a[o]>-n,c=a[o]<n,u=Math.exp(a[o]),l=void 0;l=c?u:s?a[o]:Math.log(1+u),i[o]=l}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Y(t,"sin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){Y(t,"cos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){Y(t,"tan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.tan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){Y(t,"asin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asin(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){Y(t,"acos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acos(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){Y(t,"atan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atan(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return Y([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,function(i,a){return Math.atan2(i,a)})},e.prototype.sinh=function(t){Y(t,"sinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.sinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){Y(t,"cosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.cosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){Y(t,"tanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=A0(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){Y(t,"asinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.asinh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){Y(t,"acosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.acosh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){Y(t,"atanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a)n[a]=Math.atanh(i[a]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){Y(t,"erf");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var o=Math.sign(i[a]),s=Math.abs(i[a]),c=1/(1+.3275911*s);n[a]=o*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-s*s))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),Y(t,"step");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),o=0;o<a.length;++o){var s=a[o];isNaN(s)?i[o]=NaN:i[o]=s>0?1:n}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,s=t.activation,c=t.preluActivationWeights,u=this.conv2d(n,i,a);return o&&(u=this.add(u,o)),s&&(u=th(this,u,s,c)),u},e.prototype.conv2d=function(t,n,i){Y([t,n],"conv2d");for(var a=i.filterHeight,o=i.filterWidth,s=i.dilationHeight,c=i.dilationWidth,u=i.padInfo.left,l=i.padInfo.top,d=i.dataFormat==="channelsLast",h=xt(i.outShape,t.dtype),f=t.strides[0],p=d?t.strides[1]:t.strides[2],m=d?t.strides[2]:1,g=d?1:t.strides[1],v=h.strides[0],b=d?h.strides[1]:h.strides[2],_=d?h.strides[2]:1,y=d?1:h.strides[1],x=this.readSync(t.dataId),w=this.readSync(n.dataId),S=h.values,C=0;C<i.batchSize;++C)for(var E=C*f,D=C*v,R=0;R<i.outHeight;++R)for(var M=D+R*b,L=R*i.strideHeight-l,B=0;B<a;B++){var O=L+B*s;if(!(O<0||O>=i.inHeight))for(var z=B*n.strides[0],W=E+O*p,j=0;j<i.outWidth;++j)for(var G=M+j*_,X=j*i.strideWidth-u,et=0;et<o;et++){var at=X+et*c;if(!(at<0||at>=i.inWidth))for(var lt=W+at*m,gt=z+et*n.strides[1],bt=0;bt<i.inChannels;++bt){for(var yt=x[lt+bt*g],Mt=0;Mt<i.outChannels;++Mt)S[G+Mt*y]+=yt*w[gt+Mt];gt+=i.outChannels}}}return h.toTensor()},e.prototype.conv3d=function(t,n,i){for(var a=i.filterDepth,o=i.filterHeight,s=i.filterWidth,c=i.dilationDepth,u=i.dilationHeight,l=i.dilationWidth,d=i.padInfo.front,h=i.padInfo.left,f=i.padInfo.top,p=xt(i.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=p.values,b=0;b<i.batchSize;++b)for(var _=b*t.strides[0],y=b*p.strides[0],x=0;x<i.outDepth;++x)for(var w=y+x*p.strides[1],S=x*i.strideDepth-d,C=0;C<a;C++){var E=S+C*c;if(!(E<0||E>=i.inDepth))for(var D=C*n.strides[0],R=_+E*t.strides[1],M=0;M<i.outHeight;++M)for(var L=w+M*p.strides[2],B=M*i.strideHeight-f,O=0;O<o;O++){var z=B+O*u;if(!(z<0||z>=i.inHeight))for(var W=D+O*n.strides[1],j=R+z*t.strides[2],G=0;G<i.outWidth;++G)for(var X=L+G*i.outChannels,et=G*i.strideWidth-h,at=0;at<s;at++){var lt=et+at*l;if(!(lt<0||lt>=i.inWidth))for(var gt=W+at*n.strides[2],bt=j+lt*i.inChannels,yt=gt,Mt=0;Mt<i.inChannels;++Mt){for(var Dt=m[bt+Mt],Rt=0;Rt<i.outChannels;++Rt)v[X+Rt]+=Dt*g[yt+Rt];yt+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,n,i){Y([t,n],"conv2dDerInput");for(var a=xt(i.inShape,"float32"),o=a.values,s=this.readSync(t.dataId),c=this.readSync(n.dataId),u=n.strides,l=u[0],d=u[1],h=u[2],f=i.batchSize,p=i.filterHeight,m=i.filterWidth,g=i.inChannels,v=i.inHeight,b=i.inWidth,_=i.outChannels,y=i.outHeight,x=i.outWidth,w=i.strideHeight,S=i.strideWidth,C=i.dataFormat,E=p-1-i.padInfo.top,D=m-1-i.padInfo.left,R=C==="channelsLast",M=a.strides[0],L=R?a.strides[1]:a.strides[2],B=R?a.strides[2]:1,O=R?1:a.strides[1],z=t.strides[0],W=R?t.strides[1]:t.strides[2],j=R?t.strides[2]:1,G=R?1:t.strides[1],X=0;X<f;++X)for(var et=0;et<g;++et)for(var at=0;at<v;++at)for(var lt=at-E,gt=Math.max(0,Math.ceil(lt/w)),bt=Math.min(y,(p+lt)/w),yt=0;yt<b;++yt){for(var Mt=yt-D,Dt=Math.max(0,Math.ceil(Mt/S)),Rt=Math.min(x,(m+Mt)/S),be=0,At=gt;At<bt;++At)for(var Ht=At*w-lt,Ot=Dt;Ot<Rt;++Ot)for(var he=z*X+W*At+j*Ot,ee=l*(p-1-Ht)+d*(m-1-(Ot*S-Mt))+h*et,ne=0;ne<_;++ne)be+=s[he+G*ne]*c[ee+ne];o[M*X+L*at+B*yt+O*et]=be}return a.toTensor()},e.prototype.conv3dDerInput=function(t,n,i){for(var a=xt(i.inShape,"float32"),o=a.values,s=a.strides,c=s[0],u=s[1],l=s[2],d=s[3],h=this.readSync(t.dataId),f=t.strides,p=f[0],m=f[1],g=f[2],v=f[3],b=this.readSync(n.dataId),_=n.strides,y=_[0],x=_[1],w=_[2],S=_[3],C=i.batchSize,E=i.filterDepth,D=i.filterHeight,R=i.filterWidth,M=i.inChannels,L=i.inDepth,B=i.inHeight,O=i.inWidth,z=i.outChannels,W=i.outDepth,j=i.outHeight,G=i.outWidth,X=i.strideDepth,et=i.strideHeight,at=i.strideWidth,lt=E-1-i.padInfo.front,gt=D-1-i.padInfo.top,bt=R-1-i.padInfo.left,yt=0;yt<C;++yt)for(var Mt=0;Mt<M;++Mt)for(var Dt=0;Dt<L;++Dt)for(var Rt=Dt-lt,be=Math.max(0,Math.ceil(Rt/X)),At=Math.min(W,(E+Rt)/X),Ht=0;Ht<B;++Ht)for(var Ot=Ht-gt,he=Math.max(0,Math.ceil(Ot/et)),ee=Math.min(j,(D+Ot)/et),ne=0;ne<O;++ne){for(var Zn=ne-bt,tr=Math.max(0,Math.ceil(Zn/at)),xn=Math.min(G,(R+Zn)/at),va=0,Er=be;Er<At;++Er)for(var ti=Er*X-Rt,kr=he;kr<ee;++kr)for(var ba=kr*et-Ot,Dr=tr;Dr<xn;++Dr)for(var ld=p*yt+m*Er+g*kr+v*Dr,ya=y*(E-1-ti)+x*(D-1-ba)+w*(R-1-(Dr*at-Zn))+S*Mt,er=0;er<z;++er)va+=h[ld+er]*b[ya+er];o[c*yt+u*Dt+l*Ht+d*ne+Mt]=va}return a.toTensor()},e.prototype.conv2dDerFilter=function(t,n,i){Y([t,n],"conv2dDerFilter");for(var a=i.strideHeight,o=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=i.dataFormat==="channelsLast",l=xt(i.filterShape,"float32"),d=i.padInfo.left,h=i.padInfo.top,f=this.bufferSync(t),p=this.bufferSync(n),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((h-m)/a)),v=Math.min(i.outHeight,(i.inHeight+h-m)/a),b=0;b<c;++b)for(var _=Math.max(0,Math.ceil((d-b)/o)),y=Math.min(i.outWidth,(i.inWidth+d-b)/o),x=0;x<i.inChannels;++x)for(var w=0;w<i.outChannels;++w){for(var S=0,C=0;C<i.batchSize;++C)for(var E=g;E<v;++E)for(var D=m+E*a-h,R=_;R<y;++R){var M=b+R*o-d;S+=u?f.get(C,D,M,x)*p.get(C,E,R,w):f.get(C,x,D,M)*p.get(C,w,E,R)}l.set(S,m,b,x,w)}return l.toTensor()},e.prototype.conv3dDerFilter=function(t,n,i){for(var a=i.strideDepth,o=i.strideHeight,s=i.strideWidth,c=i.filterDepth,u=i.filterHeight,l=i.filterWidth,d=xt(i.filterShape,"float32"),h=d.values,f=d.strides,p=f[0],m=f[1],g=f[2],v=f[3],b=this.readSync(n.dataId),_=n.strides,y=_[0],x=_[1],w=_[2],S=_[3],C=this.readSync(t.dataId),E=t.strides,D=E[0],R=E[1],M=E[2],L=E[3],B=i.padInfo.front,O=i.padInfo.left,z=i.padInfo.top,W=0;W<c;++W)for(var j=Math.max(0,Math.ceil((B-W)/a)),G=Math.min(i.outDepth,(i.inDepth+B-W)/a),X=W*p,et=0;et<u;++et)for(var at=Math.max(0,Math.ceil((z-et)/o)),lt=Math.min(i.outHeight,(i.inHeight+z-et)/o),gt=et*m+X,bt=0;bt<l;++bt)for(var yt=Math.max(0,Math.ceil((O-bt)/s)),Mt=Math.min(i.outWidth,(i.inWidth+O-bt)/s),Dt=bt*g+gt,Rt=0;Rt<i.inChannels;++Rt)for(var be=Rt*v+Dt,At=0;At<i.outChannels;++At){for(var Ht=0,Ot=0;Ot<i.batchSize;++Ot)for(var he=Ot*D,ee=Ot*y,ne=j;ne<G;++ne)for(var Zn=(W+ne*a-B)*R+he,tr=ne*x+ee,xn=at;xn<lt;++xn)for(var va=(et+xn*o-z)*M+Zn,Er=xn*w+tr,ti=yt;ti<Mt;++ti){var kr=ti*S+Er;Ht+=C[(bt+ti*s-O)*L+va+Rt]*b[kr+At]}h[be+At]=Ht}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,i=t.filter,a=t.convInfo,o=t.bias,s=t.activation,c=t.preluActivationWeights,u=this.depthwiseConv2D(n,i,a);return o&&(u=this.add(u,o)),s&&(u=th(this,u,s,c)),u},e.prototype.depthwiseConv2D=function(t,n,i){Y([t,n],"depthwiseConv2D");for(var a=i.filterHeight,o=i.filterWidth,s=i.dilationHeight,c=i.dilationWidth,u=i.padInfo.left,l=i.padInfo.top,d=i.outChannels/i.inChannels,h=xt(i.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(n.dataId),m=h.values,g=0;g<i.batchSize;++g)for(var v=g*t.strides[0],b=g*h.strides[0],_=0;_<i.outHeight;++_)for(var y=b+_*h.strides[1],x=_*i.strideHeight-u,w=0;w<a;++w){var S=x+w*s;if(!(S<0||S>=i.inHeight))for(var C=w*n.strides[0],E=v+S*t.strides[1],D=0;D<i.outWidth;++D)for(var R=y+D*h.strides[2],M=D*i.strideWidth-l,L=0;L<o;++L){var B=M+L*c;if(!(B<0||B>=i.inWidth))for(var O=C+L*n.strides[1],z=E+B*i.inChannels,W=R,j=O,G=0;G<i.inChannels;++G){for(var X=f[z+G],et=0;et<d;++et)m[W+et]+=X*p[j+et];W+=d,j+=d}}}return h.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,i){Y([t,n],"depthwiseConv2DDerInput");for(var a=xt(i.inShape,"float32"),o=a.values,s=a.strides,c=s[0],u=s[1],l=s[2],d=this.readSync(t.dataId),h=t.strides,f=h[0],p=h[1],m=h[2],g=this.readSync(n.dataId),v=n.strides,b=v[0],_=v[1],y=v[2],x=i.batchSize,w=i.filterHeight,S=i.filterWidth,C=i.inChannels,E=i.inHeight,D=i.inWidth,R=i.outChannels,M=i.outHeight,L=i.outWidth,B=i.strideHeight,O=i.strideWidth,z=w-1-i.padInfo.top,W=S-1-i.padInfo.left,j=R/C,G=0;G<x;++G)for(var X=0;X<C;++X)for(var et=0;et<E;++et)for(var at=et-z,lt=Math.max(0,Math.ceil(at/B)),gt=Math.min(M,(w+at)/B),bt=0;bt<D;++bt){for(var yt=bt-W,Mt=Math.max(0,Math.ceil(yt/O)),Dt=Math.min(L,(S+yt)/O),Rt=0,be=lt;be<gt;++be)for(var At=be*B-at,Ht=Mt;Ht<Dt;++Ht)for(var Ot=f*G+p*be+m*Ht,he=b*(w-1-At)+_*(S-1-(Ht*O-yt))+y*X,ee=0;ee<j;++ee)Rt+=d[Ot+(X*j+ee)]*g[he+ee];o[c*G+u*et+l*bt+X]=Rt}return a.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){Y([t,n],"depthwiseConv2DDerFilter");for(var a=i.strideHeight,o=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=xt(i.filterShape,"float32"),l=i.padInfo.left,d=i.padInfo.top,h=i.outChannels/i.inChannels,f=this.bufferSync(t),p=this.bufferSync(n),m=0;m<s;++m)for(var g=Math.max(0,Math.ceil((d-m)/a)),v=Math.min(i.outHeight,(i.inHeight+d-m)/a),b=0;b<c;++b)for(var _=Math.max(0,Math.ceil((l-b)/o)),y=Math.min(i.outWidth,(i.inWidth+l-b)/o),x=0;x<i.outChannels;++x){for(var w=Math.trunc(x/h),S=x%h,C=0,E=0;E<i.batchSize;++E)for(var D=g;D<v;++D)for(var R=m+D*a-d,M=_;M<y;++M){var L=b+M*o-l;C+=f.get(E,R,L,w)*p.get(E,D,M,x)}u.set(C,m,b,w,S)}return u.toTensor()},e.prototype.tile=function(t,n){return Y(t,"tile"),Fb(this.bufferSync(t),n)},e.prototype.pad=function(t,n,i){Y(t,"pad");var a=n.map(function(h,f){return h[0]+t.shape[f]+h[1]}),o=n.map(function(h){return h[0]}),s=this.bufferSync(t),c=xt(a,t.dtype);i!==0&&c.values.fill(i);for(var u=0;u<t.size;u++){var l=s.indexToLoc(u),d=l.map(function(h,f){return h+o[f]});c.set.apply(c,[s.get.apply(s,l)].concat(d))}return c.toTensor()},e.prototype.transpose=function(t,n){Y(t,"transpose");for(var i=new Array(t.rank),a=0;a<i.length;a++)i[a]=t.shape[n[a]];var o=this.readSync(t.dataId),s=xt(i,t.dtype),c=this.bufferSync(t);for(a=0;a<t.size;++a){for(var u=c.indexToLoc(a),l=new Array(u.length),d=0;d<l.length;d++)l[d]=u[n[d]];var h=s.locToIndex(l);s.values[h]=o[a]}return s.toTensor()},e.prototype.gather=function(t,n,i){Y([t,n],"gather");var a=t.shape.slice(),o=this.readSync(n.dataId);a[i]=o.length;for(var s=xt(a,t.dtype),c=this.bufferSync(t),u=0;u<s.size;++u){var l=s.indexToLoc(u),d=l.slice();d[i]=o[l[i]];var h=c.locToIndex(d);s.values[u]=c.values[h]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,n,i){Y([t],"batchToSpaceND");var a=n.reduce(function(d,h){return d*h}),o=wu(t.shape,n,a),s=Cu(o.length,n.length),c=Su(t.shape,n,a),u=wb(i,n.length),l=Cb(c,i,n.length);return t.reshape(o).transpose(s).reshape(c).slice(u,l)},e.prototype.spaceToBatchND=function(t,n,i){Y([t],"spaceToBatchND");var a=n.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,i);for(var s=1+n.length;s<t.shape.length;++s)o.push([0,0]);var c=t.pad(o),u=wu(c.shape,n,a,!1),l=Cu(u.length,n.length,!1),d=Su(c.shape,n,a,!1);return c.reshape(u).transpose(l).reshape(d)},e.prototype.pool=function(t,n,i){Y(t,"pool");for(var a=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=n.padInfo.top,h=n.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),m=xt(n.outShape,t.dtype),g=m.values,v=n.outShape[1]*n.outShape[2]*n.outShape[3],b=n.outShape[2]*n.outShape[3],_=n.outShape[3],y=0;y<n.batchSize;++y)for(var x=y*v,w=y*t.strides[0],S=0;S<n.inChannels;++S)for(var C=0;C<n.outHeight;++C)for(var E=C*a-d,D=Math.max(0,E),R=Math.min(n.inHeight,u+E),M=x+C*b,L=0;L<n.outWidth;++L){for(var B=L*o-h,O=Math.max(0,B),z=Math.min(n.inWidth,l+B),W=f,j=0,G=0,X=D;X<R;X+=s){for(var et=w+X*t.strides[1],at=O;at<z;at+=c){var lt=p[et+at*t.strides[2]+S];i==="max"&&lt>W?W=lt:i==="avg"&&(j+=lt,G++)}if(isNaN(W))break}g[M+L*_+S]=i==="avg"?j/G:W}return m.toTensor()},e.prototype.maxPool=function(t,n){return this.pool(t,n,"max")},e.prototype.maxPoolPositions=function(t,n){for(var i=xt(n.outShape,"int32"),a=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=n.padInfo.top,h=n.padInfo.left,f=this.bufferSync(t),p=0;p<n.batchSize;++p)for(var m=0;m<n.inChannels;++m)for(var g=0;g<n.outHeight;++g){for(var v=g*a-d,b=v;b<0;)b+=s;for(var _=Math.min(n.inHeight,u+v),y=0;y<n.outWidth;++y){for(var x=y*o-h,w=x;w<0;)w+=c;for(var S=Math.min(n.inWidth,l+x),C=Number.NEGATIVE_INFINITY,E=-1,D=b;D<_;D+=s)for(var R=D-v,M=w;M<S;M+=c){var L=M-x,B=f.get(p,D,M,m);B>C&&(C=B,E=R*l+L)}i.set(E,p,g,y,m)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,n,i,a){Y([n,i],"maxPoolBackprop");for(var o=this.maxPoolPositions(n,a),s=a.strideHeight,c=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,d=a.effectiveFilterHeight,h=a.effectiveFilterWidth,f=h-1-a.padInfo.left,p=d-1-a.padInfo.top,m=xt(n.shape,"float32"),g=this.bufferSync(o),v=this.bufferSync(t),b=0;b<a.batchSize;++b)for(var _=0;_<a.inChannels;++_)for(var y=0;y<a.inHeight;++y)for(var x=0;x<a.inWidth;++x){for(var w=y-p,S=x-f,C=0,E=0;E<d;E+=u){var D=(w+E)/s;if(!(D<0||D>=a.outHeight||Math.floor(D)!==D))for(var R=0;R<h;R+=l){var M=(S+R)/c;if(!(M<0||M>=a.outWidth||Math.floor(M)!==M)){var L=d*h-1-g.get(b,D,M,_)===E*h+R?1:0;L!==0&&(C+=v.get(b,D,M,_)*L)}}}m.set(C,b,y,x,_)}return m.toTensor()},e.prototype.avgPoolBackprop=function(t,n,i){Y([t,n],"avgPoolBackprop");for(var a=i.strideHeight,o=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,p=d-1-i.padInfo.top,m=xt(n.shape,"float32"),g=1/(s*c),v=this.bufferSync(t),b=0;b<i.batchSize;++b)for(var _=0;_<i.inChannels;++_)for(var y=0;y<i.inHeight;++y)for(var x=0;x<i.inWidth;++x){for(var w=y-p,S=x-f,C=0,E=0;E<d;E+=u){var D=(w+E)/a;if(!(D<0||D>=i.outHeight||Math.floor(D)!==D))for(var R=0;R<h;R+=l){var M=(S+R)/o;M<0||M>=i.outWidth||Math.floor(M)!==M||(C+=v.get(b,D,M,_))}}m.set(C*g,b,y,x,_)}return m.toTensor()},e.prototype.pool3d=function(t,n,i){Y(t,"pool3d");for(var a=n.strideDepth,o=n.strideHeight,s=n.strideWidth,c=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,g=n.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),_=xt(n.outShape,t.dtype),y=_.values,x=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],w=n.outShape[2]*n.outShape[3]*n.outShape[4],S=n.outShape[3]*n.outShape[4],C=n.outShape[4],E=0;E<n.batchSize;++E)for(var D=E*x,R=E*t.strides[0],M=0;M<n.inChannels;++M)for(var L=0;L<n.outDepth;++L){for(var B=L*a-p,O=B;O<0;)O+=c;for(var z=Math.min(n.inDepth,d+B),W=D+L*w,j=0;j<n.outHeight;++j){for(var G=j*o-m,X=G;X<0;)X+=u;for(var et=Math.min(n.inHeight,h+G),at=W+j*S,lt=0;lt<n.outWidth;++lt){for(var gt=lt*s-g,bt=gt;bt<0;)bt+=l;for(var yt=Math.min(n.inWidth,f+gt),Mt=at+lt*C,Dt=v,Rt=0,be=0,At=O;At<z;At+=c){for(var Ht=R+At*t.strides[1],Ot=X;Ot<et;Ot+=u){for(var he=Ht+Ot*t.strides[2],ee=bt;ee<yt;ee+=l){var ne=b[he+ee*t.strides[3]+M];if(i==="max"&&ne>Dt?Dt=ne:i==="avg"&&(Rt+=ne,be++),isNaN(Dt))break}if(isNaN(Dt))break}if(isNaN(Dt))break}y[Mt+M]=i==="avg"?Rt/be:Dt}}}return _.toTensor()},e.prototype.avgPool3d=function(t,n){return Y(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,i){Y([t,n],"avgPool3dBackprop");for(var a=i.strideDepth,o=i.strideHeight,s=i.strideWidth,c=i.filterDepth,u=i.filterHeight,l=i.filterWidth,d=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=p-1-i.padInfo.front,b=g-1-i.padInfo.left,_=m-1-i.padInfo.top,y=xt(n.shape,"float32"),x=1/(c*u*l),w=this.bufferSync(t),S=0;S<i.batchSize;++S)for(var C=0;C<i.inChannels;++C)for(var E=0;E<i.inDepth;++E)for(var D=0;D<i.inHeight;++D)for(var R=0;R<i.inWidth;++R){for(var M=E-v,L=D-_,B=R-b,O=0,z=0;z<p;z+=d){var W=(M+z)/a;if(!(W<0||W>=i.outDepth||Math.floor(W)!==W))for(var j=0;j<m;j+=h){var G=(L+j)/o;if(!(G<0||G>=i.outHeight||Math.floor(G)!==G))for(var X=0;X<g;X+=f){var et=(B+X)/s;et<0||et>=i.outWidth||Math.floor(et)!==et||(O+=w.get(S,W,G,et,C))}}}y.set(O*x,S,E,D,R,C)}return y.toTensor()},e.prototype.maxPool3d=function(t,n){return Y(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var i=xt(n.outShape,"int32"),a=n.strideDepth,o=n.strideHeight,s=n.strideWidth,c=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,m=n.padInfo.top,g=n.padInfo.left,v=this.bufferSync(t),b=0;b<n.batchSize;++b)for(var _=0;_<n.inChannels;++_)for(var y=0;y<n.outDepth;++y){for(var x=y*a-p,w=x;w<0;)w+=c;for(var S=Math.min(n.inDepth,d+x),C=0;C<n.outHeight;++C){for(var E=C*o-m,D=E;D<0;)D+=u;for(var R=Math.min(n.inHeight,h+E),M=0;M<n.outWidth;++M){for(var L=M*s-g,B=L;B<0;)B+=l;for(var O=Math.min(n.inWidth,f+L),z=Number.NEGATIVE_INFINITY,W=-1,j=w;j<S;j+=c)for(var G=j-x,X=D;X<R;X+=u)for(var et=X-E,at=B;at<O;at+=l){var lt=at-L,gt=v.get(b,j,X,at,_);gt>=z&&(z=gt,W=G*h*f+et*h+lt)}i.set(W,b,y,C,M,_)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,i,a){Y([n,i],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(n,a),s=a.strideDepth,c=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,d=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterDepth,p=a.effectiveFilterHeight,m=a.effectiveFilterWidth,g=f-1-a.padInfo.front,v=m-1-a.padInfo.left,b=p-1-a.padInfo.top,_=xt(n.shape,"float32"),y=this.bufferSync(o),x=this.bufferSync(t),w=0;w<a.batchSize;++w)for(var S=0;S<a.inChannels;++S)for(var C=0;C<a.inDepth;++C)for(var E=0;E<a.inHeight;++E)for(var D=0;D<a.inWidth;++D){for(var R=C-g,M=E-b,L=D-v,B=0,O=0;O<f;O+=l){var z=(R+O)/s;if(!(z<0||z>=a.outDepth||Math.floor(z)!==z))for(var W=0;W<p;W+=d){var j=(M+W)/c;if(!(j<0||j>=a.outHeight||Math.floor(j)!==j))for(var G=0;G<m;G+=h){var X=(L+G)/u;if(!(X<0||X>=a.outWidth||Math.floor(X)!==X)){var et=f*p*m-1-y.get(w,z,j,X,S)===O*p*m+W*m+G?1:0;et!==0&&(B+=x.get(w,z,j,X,S)*et)}}}}_.set(B,w,C,E,D,S)}return _.toTensor()},e.prototype.cast=function(t,n){return qh(t,n,this)},e.prototype.reshape=function(t,n){return ku(t,n)},e.prototype.avgPool=function(t,n){return Y(t,"avgPool"),this.pool(t,n,"avg").toFloat()},e.prototype.resizeBilinear=function(t,n,i,a){Y(t,"resizeBilinear");for(var o=t.shape,s=o[0],c=o[1],u=o[2],l=o[3],d=this.readSync(t.dataId),h=new Float32Array(ut([s,n,i,l])),f=[a&&n>1?c-1:c,a&&i>1?u-1:u],p=[a&&n>1?n-1:n,a&&i>1?i-1:i],m=0,g=f[0]/p[0],v=f[1]/p[1],b=0;b<s;b++)for(var _=0;_<n;_++)for(var y=g*_,x=Math.floor(y),w=y-x,S=Math.min(c-1,Math.ceil(y)),C=b*t.strides[0]+x*t.strides[1],E=b*t.strides[0]+S*t.strides[1],D=0;D<i;D++)for(var R=v*D,M=Math.floor(R),L=R-M,B=Math.min(u-1,Math.ceil(R)),O=C+M*t.strides[2],z=E+M*t.strides[2],W=C+B*t.strides[2],j=E+B*t.strides[2],G=0;G<l;G++){var X=d[O+G],et=d[z+G],at=X+(d[W+G]-X)*L,lt=at+(et+(d[j+G]-et)*L-at)*w;h[m++]=lt}return Ne(h,[s,n,i,l])},e.prototype.resizeBilinearBackprop=function(t,n,i){Y([t,n],"resizeBilinearBackprop");for(var a=n.shape,o=a[0],s=a[1],c=a[2],u=a[3],l=t.shape,d=l[1],h=l[2],f=new Float32Array(o*s*c*u),p=[i&&d>1?s-1:s,i&&h>1?c-1:c],m=[i&&d>1?d-1:d,i&&h>1?h-1:h],g=p[0]/m[0],v=p[1]/m[1],b=this.readSync(t.dataId),_=0,y=0;y<o;y++)for(var x=y*n.strides[0],w=0;w<d;w++)for(var S=w*g,C=Math.floor(S),E=Math.min(Math.ceil(S),s-1),D=x+C*n.strides[1],R=x+E*n.strides[1],M=S-C,L=1-M,B=0;B<h;B++)for(var O=B*v,z=Math.floor(O),W=Math.min(Math.ceil(O),c-1),j=O-z,G=1-j,X=D+z*n.strides[2],et=D+W*n.strides[2],at=R+z*n.strides[2],lt=R+W*n.strides[2],gt=L*G,bt=L*j,yt=M*G,Mt=M*j,Dt=0;Dt<u;Dt++){var Rt=b[_++];f[X+Dt]+=Rt*gt,f[et+Dt]+=Rt*bt,f[at+Dt]+=Rt*yt,f[lt+Dt]+=Rt*Mt}return Ae(f,[o,c,s,u],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,i,a){Y(t,"resizeNearestNeighbor");for(var o=t.shape,s=o[0],c=o[1],u=o[2],l=o[3],d=this.readSync(t.dataId),h=new Float32Array(s*n*i*l),f=[a&&n>1?c-1:c,a&&i>1?u-1:u],p=[a&&n>1?n-1:n,a&&i>1?i-1:i],m=f[0]/p[0],g=f[1]/p[1],v=0,b=0;b<s;b++)for(var _=b*t.strides[0],y=0;y<n;y++)for(var x=m*y,w=_+Math.min(c-1,a?Math.round(x):Math.floor(x))*t.strides[1],S=0;S<i;S++)for(var C=g*S,E=w+Math.min(u-1,a?Math.round(C):Math.floor(C))*t.strides[2],D=0;D<l;D++){var R=d[E+D];h[v++]=R}return Ne(h,[s,n,i,l],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){Y([t,n],"resizeNearestNeighborBackprop");for(var a=n.shape,o=a[0],s=a[1],c=a[2],u=a[3],l=t.shape,d=l[1],h=l[2],f=new Float32Array(o*s*c*u),p=this.readSync(t.dataId),m=[i&&d>1?s-1:s,i&&h>1?c-1:c],g=[i&&d>1?d-1:d,i&&h>1?h-1:h],v=m[0]/g[0],b=m[1]/g[1],_=1/v,y=1/b,x=2*Math.ceil(_)+2,w=2*Math.ceil(y)+2,S=0;S<o;S++)for(var C=S*n.strides[0],E=0;E<s;E++)for(var D=C+E*n.strides[1],R=Math.floor(E*_),M=Math.floor(R-x/2),L=0;L<c;L++)for(var B=D+L*n.strides[2],O=Math.floor(L*y),z=Math.floor(O-w/2),W=0;W<u;W++){for(var j=0,G=0;G<x;G++){var X=G+M;if(!(X<0||X>=d)){var et=C+X*t.strides[1],at=X*v;if(E===Math.min(s-1,i?Math.round(at):Math.floor(at)))for(var lt=0;lt<w;lt++){var gt=lt+z;if(!(gt<0||gt>=h)){var bt=et+gt*t.strides[2],yt=gt*b;L===Math.min(c-1,i?Math.round(yt):Math.floor(yt))&&(j+=p[bt+W])}}}}f[B+W]=j}return Ae(f,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,i,a,o,s){Y([t,n,i,o,s],"batchNorm");for(var c=this.readSync(t.dataId),u=this.readSync(n.dataId),l=this.readSync(i.dataId),d=o?this.readSync(o.dataId):new Float32Array([1]),h=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(c.length),p=h.length,m=d.length,g=l.length,v=u.length,b=0,_=0,y=0,x=0,w=0;w<c.length;++w)f[w]=h[b++]+(c[w]-u[_++])*d[y++]/Math.sqrt(l[x++]+a),b>=p&&(b=0),_>=v&&(_=0),y>=m&&(y=0),x>=g&&(x=0);return Ae(f,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,i,a,o){Y(t,"localResponseNormalization4D");var s=t.shape[3],c=s-1,u=this.readSync(t.dataId),l=t.size,d=new Float32Array(l);function h(g){for(var v=g%s,b=g-v+Math.max(0,v-n),_=g-v+Math.min(v+n,c),y=0;b<=_;b++){var x=u[b];y+=x*x}return y}for(var f=0;f<l;f++){var p=h(f),m=u[f]*Math.pow(i+a*p,-o);d[f]=m}return Ae(d,t.shape)},e.prototype.LRNGrad=function(t,n,i,a,o,s,c){Y(t,"LRNGrad");for(var u=t.shape[3],l=this.readSync(t.dataId),d=this.readSync(n.dataId),h=this.readSync(i.dataId),f=new Float32Array(t.size),p=t.size,m=0;m<p;m++){for(var g=m%u,v=m-g+Math.max(0,g-a),b=m-g+Math.min(u,g+a+1),_=0,y=v;y<b;y++)_+=Math.pow(d[y],2);for(_=s*_+o,y=v;y<b;y++){var x=-2*s*c*d[y]*h[m]/_;m===y&&(x+=Math.pow(_,-c)),x*=l[m],f[y]+=x}}return Ae(f,t.shape)},e.prototype.multinomial=function(t,n,i,a){Y(t,"multinomial");for(var o=n?t:on(t),s=o.shape[0],c=o.shape[1],u=Kt([s,i],"int32"),l=this.readSync(u.dataId),d=this.readSync(o.dataId),h=0;h<s;++h){var f=h*c,p=new Float32Array(c-1);p[0]=d[f];for(var m=1;m<p.length;++m)p[m]=p[m-1]+d[f+m];for(var g=Fu(a.toString()),v=h*i,b=0;b<i;++b){var _=g();l[v+b]=p.length;for(var y=0;y<p.length;y++)if(_<p[y]){l[v+b]=y;break}}}return u},e.prototype.oneHot=function(t,n,i,a){Y(t,"oneHot");var o=new Float32Array(t.size*n);o.fill(a);for(var s=this.readSync(t.dataId),c=0;c<t.size;++c)s[c]>=0&&s[c]<n&&(o[c*n+s[c]]=i);return hr(o,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,i,a,o){return Y(t,"nonMaxSuppression"),Kh(this.readSync(t.dataId),this.readSync(n.dataId),i,a,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var i=t.shape[0],a=t.shape[1],o=xt(t.shape,"float32"),s=xt(t.shape,"float32"),c=Tn(t).as2D(i,a),u=dr(t).as2D(i,a),l=0;l<i;l++)for(var d=c.slice([l,0],[1,a]),h=u.slice([l,0],[1,a]),f=ze(d,h),p=this.readSync(this.fftImpl(f,n).dataId),m=0;m<a;m++){var g=Gv(p,m);o.values[l*a+m]=g.real,s.values[l*a+m]=g.imag}return ze(o.toTensor(),s.toTensor()).as2D(i,a)},e.prototype.fftImpl=function(t,n){var i=t.as1D(),a=i.size;if(this.isExponentOf2(a)){var o=this.fftRadix2(i,a,n).as2D(t.shape[0],t.shape[1]);return n&&(o=ze(Tn(o).div(Z(a)),dr(o).div(Z(a)))),o}var s=this.readSync(t.dataId),c=function(u){for(var l=new Float32Array(u.length/2),d=new Float32Array(u.length/2),h=0;h<u.length;h+=2)l[h/2]=u[h],d[h/2]=u[h+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,a,n));return ze(c.real,c.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,i){if(n===1)return t;var a=this.readSync(t.dataId),o=n/2,s=function(v){for(var b=Math.ceil(v.length/4),_=new Float32Array(b),y=new Float32Array(b),x=0;x<v.length;x+=4)_[Math.floor(x/4)]=v[x],y[Math.floor(x/4)]=v[x+1];return{real:_,imag:y}}(a),c=ze(s.real,s.imag).as1D(),u=function(v){for(var b=Math.floor(v.length/4),_=new Float32Array(b),y=new Float32Array(b),x=2;x<v.length;x+=4)_[Math.floor(x/4)]=v[x],y[Math.floor(x/4)]=v[x+1];return{real:_,imag:y}}(a),l=ze(u.real,u.imag).as1D();c=this.fftRadix2(c,o,i),l=this.fftRadix2(l,o,i);var d=function(v,b){for(var _=new Float32Array(v/2),y=new Float32Array(v/2),x=0;x<Math.ceil(v/2);x++){var w=(b?2:-2)*Math.PI*(x/v);_[x]=Math.cos(w),y[x]=Math.sin(w)}return{real:_,imag:y}}(n,i),h=ze(d.real,d.imag).mul(l),f=c.add(h),p=c.sub(h),m=Tn(f).concat(Tn(p)),g=dr(f).concat(dr(p));return ze(m,g).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,i){for(var a=new Float32Array(2*n),o=0;o<n;o++){for(var s=0,c=0,u=0;u<n;u++){var l=KS(o*u,n,i),d=Gv(t,u);s+=d.real*l.real-d.imag*l.imag,c+=d.real*l.imag+d.imag*l.real}i&&(s/=n,c/=n),YS(a,s,c,o)}return a},e.prototype.depthToSpace=function(t,n,i){A(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),A(n>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+n});for(var a=t.shape[0],o=t.shape[1],s=t.shape[2],c=t.shape[3],u=o*n,l=s*n,d=c/(n*n),h=this.readSync(t.dataId),f=new Float32Array(a*u*l*d),p=0,m=0;m<a;++m)for(var g=0;g<u;++g)for(var v=Math.floor(g/n),b=g%n,_=0;_<l;++_)for(var y=Math.floor(_/n),x=(b*n+_%n)*d,w=0;w<d;++w){var S=w+x+c*(y+s*(v+o*m));f[p++]=h[S]}return Ae(f,[a,u,l,d])},e.prototype.broadcastedBinaryOp=function(t,n,i,a){var o=St(t.shape,n.shape),s=xt(o,i),c=this.readSync(t.dataId),u=this.readSync(n.dataId),l=Or(t.shape,o),d=Or(n.shape,o),h=s.values;if(l.length+d.length===0)for(var f=0;f<h.length;++f)h[f]=a(c[f%c.length],u[f%u.length]);else{var p=this.bufferSync(t),m=this.bufferSync(n),g=function(v){var b=s.indexToLoc(v),_=b.slice(-t.rank);l.forEach(function(S){return _[S]=0});var y=p.locToIndex(_),x=b.slice(-n.rank);d.forEach(function(S){return x[S]=0});var w=m.locToIndex(x);h[v]=a(c[y],u[w])};for(f=0;f<h.length;++f)g(f)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,i){var a=St(t.shape,n.shape),o=xt(a,"float32"),s=xt(a,"float32"),c=this.readSync(t.dataId),u=this.readSync(n.dataId),l=Or(t.shape,a),d=Or(n.shape,a),h=o.values,f=s.values;if(l.length+d.length===0)for(var p=0;p<h.length;p++){var m=p%c.length,g=p%u.length,v=i(c[2*m],c[2*m+1],u[2*g],u[2*g+1]);h[p]=v.real,f[p]=v.imag}else{var b=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=this.bufferSync(this.data.get(n.dataId).complexTensors.real),y=function(x){var w=o.indexToLoc(x),S=w.slice(-t.rank);l.forEach(function(M){return S[M]=0});var C=b.locToIndex(S),E=w.slice(-n.rank);d.forEach(function(M){return E[M]=0});var D=_.locToIndex(E),R=i(c[2*C],c[2*C+1],u[2*D],u[2*D+1]);h[x]=R.real,f[x]=R.imag};for(p=0;p<h.length;p++)y(p)}return this.complex(o.toTensor(),s.toTensor())},e.prototype.split=function(t,n,i){return Tb(t,n,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,i,a,o,s){for(var c=t.shape,u=c[0],l=c[1],d=c[2],h=c[3],f=n.shape[0],p=a[0],m=a[1],g=xt([f,p,m,h],"float32"),v=this.readSync(n.dataId),b=this.readSync(i.dataId),_=this.readSync(t.dataId),y=t.strides,x=g.strides,w=0;w<f;w++){var S=4*w,C=v[S],E=v[S+1],D=v[S+2],R=v[S+3],M=b[w];if(!(M>=u))for(var L=p>1?(D-C)*(l-1)/(p-1):0,B=m>1?(R-E)*(d-1)/(m-1):0,O=0;O<p;O++){var z=p>1?C*(l-1)+O*L:.5*(C+D)*(l-1);if(z<0||z>l-1)for(var W=0;W<m;W++)for(var j=0;j<h;j++){var G=j+W*x[2]+O*x[1]+w*x[0];g.values[G]=s}else if(o==="bilinear"){var X=Math.floor(z),et=Math.ceil(z),at=z-X;for(W=0;W<m;W++)if((At=m>1?E*(d-1)+W*B:.5*(E+R)*(d-1))<0||At>d-1)for(j=0;j<h;j++)G=j+W*x[2]+O*x[1]+w*x[0],g.values[G]=s;else{var lt=Math.floor(At),gt=Math.ceil(At),bt=At-lt;for(j=0;j<h;j++){var yt=_[G=j+lt*y[2]+X*y[1]+M*y[0]],Mt=_[G=j+gt*y[2]+X*y[1]+M*y[0]],Dt=_[G=j+lt*y[2]+et*y[1]+M*y[0]],Rt=yt+(Mt-yt)*bt,be=Dt+(_[G=j+gt*y[2]+et*y[1]+M*y[0]]-Dt)*bt;G=j+W*x[2]+O*x[1]+w*x[0],g.values[G]=Rt+(be-Rt)*at}}}else for(W=0;W<m;++W){var At;if((At=m>1?E*(d-1)+W*B:.5*(E+R)*(d-1))<0||At>d-1)for(j=0;j<h;j++)G=j+W*x[2]+O*x[1]+w*x[0],g.values[G]=s;else{var Ht=Math.round(At),Ot=Math.round(z);for(j=0;j<h;j++){var he=j+Ht*y[2]+Ot*y[1]+M*y[0],ee=j+W*x[2]+O*x[1]+w*x[0];g.values[ee]=_[he]}}}}}return g.toTensor()},e.prototype.sparseToDense=function(t,n,i,a){var o=ds(0,t,i),s=o.sliceRank,c=o.numUpdates,u=o.sliceSize,l=o.strides,d=o.outputSize;return this.scatter(t,n,i,d,u,c,s,l,a,!1)},e.prototype.gatherND=function(t,n){var i=n.shape,a=i[i.length-1],o=zh(t,n),s=o[0],c=o[1],u=o[2],l=o[3];if(c===0)return Ne([],s,t.dtype);for(var d=new ss([c,u],t.dtype),h=this.readSync(n.dataId),f=this.readSync(t.dataId),p=0;p<c;p++){for(var m=[],g=0,v=0;v<a;v++){var b=h[p*a+v];g+=b*l[v],m.push(b)}if(g<0||g>=t.size/u)throw new Error("Invalid indices: "+m+" does not index into "+t.shape);for(var _=0;_<u;_++)d.values[p*u+_]=f[g*u+_]}return d.toTensor().reshape(s)},e.prototype.scatterND=function(t,n,i){var a=ds(0,t,i),o=a.sliceRank,s=a.numUpdates,c=a.sliceSize,u=a.strides,l=a.outputSize,d=Z(0);return this.scatter(t,n,i,l,c,s,o,u,d,!0)},e.prototype.fill=function(t,n,i){var a=as(i=i||Xa(n),ut(t));return a.fill(n),P.makeTensor(a,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=as(t.dtype,ut(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,i){return Yh(t,n,i)},e.prototype.scatter=function(t,n,i,a,o,s,c,u,l,d){var h=[a/o,o],f=this.readSync(t.dataId),p=this.readSync(n.dataId);if(a===0)return Ne([],i,n.dtype);var m=new ss(h,n.dtype);m.values.fill(this.readSync(l.dataId)[0]);for(var g=0;g<s;g++){for(var v=[],b=0,_=0;_<c;_++){var y=f[g*c+_];v.push(y),b+=y*u[_]}if(b<0||b>=a/o)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var x=0;x<o;x++)d?m.values[b*o+x]+=p[g*o+x]:m.values[b*o+x]=n.rank===0?p[0]:p[g*o+x]}return m.toTensor().reshape(i)},e}(Mb);P.registerBackend("cpu",function(){return new QA},1);for(iu=0,eh=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e,a=i.boxes,o=i.scores,s=n,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,h=t;Y(a,"NonMaxSuppressionWithScore");var f=Xh(h.data.get(a.dataId).values,h.data.get(o.dataId).values,c,u,l,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t;Y(n,"square");for(var a=i.data.get(n.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var c=a[s];o[s]=c*c}return{dataId:i.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:ps,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,a=n.b,o=t;Y([i,a],ps);var s=o.data.get(i.dataId).values,c=o.data.get(a.dataId).values,u=function(h,f,p,m,g,v){var b=St(h,f),_=b.length,y=Hn(b),x=Ya(g,ut(b)),w=h.length,S=f.length,C=Hn(h),E=Hn(f),D=Or(h,b),R=Or(f,b);if(D.length+R.length===0)for(var M=0;M<x.length;++M)x[M]=v(p[M%p.length],m[M%m.length]);else{var L=function(B){var O=L0(B,_,y),z=O.slice(-w);D.forEach(function(X){return z[X]=0});var W=fh(z,w,C),j=O.slice(-S);R.forEach(function(X){return j[X]=0});var G=fh(j,S,E);x[B]=v(p[W],m[G])};for(M=0;M<x.length;++M)L(M)}return[x,b]}(i.shape,a.shape,s,c,i.dtype,function(h,f){var p=h-f;return p*p}),l=u[0],d=u[1];return{dataId:o.write(l,d,i.dtype),shape:d,dtype:i.dtype}}}];iu<eh.length;iu++)E0(eh[iu]);var iu,eh,La,JA=function(r){this.variableNames=["A"];var e=$e(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},ZA=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=$e(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(au=0,nh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e.pixels,a=n.numChannels,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,c=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=c[0],l=c[1],d=[l,u],h=[l,u,a];(s||o)&&(La==null&&(La=document.createElement("canvas").getContext("2d")),La.canvas.width=u,La.canvas.height=l,La.drawImage(i,0,0,u,l),i=La.canvas);var f=t.makeTensorInfo(d,"int32");t.texData.get(f.dataId).usage=Cn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),i);var p=U().getBool("WEBGL_PACK")?new ZA(h):new JA(h),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs;yu("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,a=i.boxes,o=i.scores,s=n,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,h=t,f=Xh(h.readSync(a.dataId),h.readSync(o.dataId),c,u,l,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t,a=new wt(n.shape,"return x * x;");return i.runWebGLProgram(a,[n],n.dtype)}},{kernelName:ps,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,a=n.b,o=t,s=U().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fr("return (a - b) * (a - b);",i.shape,a.shape):new ge("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}}];au<nh.length;au++)E0(nh[au]);var au,nh;for(ou=0,rh=[{kernelName:"Square",gradFunc:function(r,e){var t=e[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:ps,gradFunc:function(r,e){var t=e[0],n=e[1],i=Z(2);return{a:function(){return se(r,se(i,Gt(t,n)))},b:function(){return se(r,se(i,Gt(n,t)))}}}}];ou<rh.length;ou++)nS(rh[ou]);var ou,rh,tI=function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r}();U().get("IS_BROWSER")&&U().setPlatform("browser",new tI);var ih,eI=function(){return Lv()},nI=function(){function r(){this.util=Bv(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return U().global.fetch!=null?U().global.fetch(e,t):(ih==null&&(ih=eI()),ih(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();U().get("IS_NODE")&&U().setPlatform("node",new nI);var kh={float32:4,int32:4,uint16:2,uint8:1,bool:1},Iu=4;function Vy(r,e){for(var t={},n=0,i=function(s){var c=s.name,u=s.dtype,l=s.shape,d=ut(l),h=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=kh[f.dtype],m=r.slice(n,n+d*p),g=f.dtype==="uint8"?new Uint8Array(m):new Uint16Array(m);if(u==="float32")h=Float32Array.from(g,function(w){return w*f.scale+f.min});else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+u);h=Int32Array.from(g,function(w){return Math.round(w*f.scale+f.min)})}n+=d*p}else if(u==="string"){var v=ut(s.shape);h=[];for(var b=0;b<v;b++){var _=new Uint32Array(r.slice(n,n+Iu))[0];n+=Iu;var y=new Uint8Array(r.slice(n,n+_));h.push(y),n+=_}}else{var x=kh[u];if(m=r.slice(n,n+d*x),u==="float32")h=new Float32Array(m);else if(u==="int32")h=new Int32Array(m);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+u);h=new Uint8Array(m)}n+=d*x}t[c]=Ne(h,l,u)},a=0,o=e;a<o.length;a++)i(o[a]);return t}function rI(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(a){if(e+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(e),i=0;return t.forEach(function(a){n.set(new Uint8Array(a.buffer),i),i+=a.byteLength}),n.buffer}var Dh=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function f0(r){return Dh?Buffer.byteLength(r):new Blob([r]).size}function mf(r){var e=0;r.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(i){t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function p0(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function Ss(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:f0(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:f0(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var En=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(a){var o=a(e,n);o!==null&&i.push(o)}),i},r}(),Ua="://",fi=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){A(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Ua)&&(e=e.slice(0,e.indexOf(Ua))),A(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();A(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function fu(r){if(r.indexOf(Ua)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+fi.getSchemes().join(","));return{scheme:r.split(Ua)[0],path:r.split(Ua)[1]}}function m0(r,e,t){return t===void 0&&(t=!1),st(this,void 0,void 0,function(){var n,i,a,o,s,c,u,l,d;return ct(this,function(h){switch(h.label){case 0:return A(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),A((n=En.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),A(n.length<2,function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."}),i=n[0],A((a=En.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),A(a.length<2,function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."}),o=a[0],s=fu(r).scheme,c=fu(r).path,u=s===fu(r).scheme,[4,i.load()];case 1:return l=h.sent(),t&&u?[4,fi.getManager(s).removeModel(c)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return d=h.sent(),!t||u?[3,6]:[4,fi.getManager(s).removeModel(c)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var ji="models_store",hi="model_info_store";function Wy(){if(!U().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Ah(r){var e=r.result;e.createObjectStore(ji,{keyPath:"modelPath"}),e.createObjectStore(hi,{keyPath:"modelPath"})}var Ga=function(){function r(e){if(this.indexedDB=Wy(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return st(this,void 0,void 0,function(){return ct(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return st(this,void 0,void 0,function(){return ct(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(i,a){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Ah(o)},o.onsuccess=function(){var s=o.result;if(t==null){var c=s.transaction(ji,"readonly"),u=c.objectStore(ji).get(n.modelPath);u.onsuccess=function(){if(u.result==null)return s.close(),a(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(u.result.modelArtifacts)},u.onerror=function(m){return s.close(),a(u.error)},c.oncomplete=function(){return s.close()}}else{var l,d=Ss(t),h=s.transaction(hi,"readwrite"),f=h.objectStore(hi),p=f.put({modelPath:n.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var m=(l=s.transaction(ji,"readwrite")).objectStore(ji).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:d});m.onsuccess=function(){return i({modelArtifactsInfo:d})},m.onerror=function(g){var v=(f=h.objectStore(hi)).delete(n.modelPath);v.onsuccess=function(){return s.close(),a(m.error)},v.onerror=function(b){return s.close(),a(m.error)}}},p.onerror=function(m){return s.close(),a(p.error)},h.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return a(o.error)}})},r.URL_SCHEME="indexeddb://",r}(),g0=function(r){return U().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ga.URL_SCHEME)?(e=r.slice(Ga.URL_SCHEME.length),new Ga(e)):null;var e};En.registerSaveRouter(g0),En.registerLoadRouter(g0);var iI=function(){function r(){this.indexedDB=Wy()}return r.prototype.listModels=function(){return st(this,void 0,void 0,function(){var e=this;return ct(this,function(t){return[2,new Promise(function(n,i){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Ah(a)},a.onsuccess=function(){var o=a.result,s=o.transaction(hi,"readonly"),c=s.objectStore(hi).getAll();c.onsuccess=function(){for(var u={},l=0,d=c.result;l<d.length;l++){var h=d[l];u[h.modelPath]=h.modelArtifactsInfo}n(u)},c.onerror=function(u){return o.close(),i(c.error)},s.oncomplete=function(){return o.close()}},a.onerror=function(o){return i(a.error)}})]})})},r.prototype.removeModel=function(e){return st(this,void 0,void 0,function(){var t=this;return ct(this,function(n){var i;return e=(i=e).startsWith(Ga.URL_SCHEME)?i.slice(Ga.URL_SCHEME.length):i,[2,new Promise(function(a,o){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Ah(s)},s.onsuccess=function(){var c,u=s.result,l=u.transaction(hi,"readwrite"),d=l.objectStore(hi),h=d.get(e);h.onsuccess=function(){if(h.result==null)return u.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=d.delete(e),p=function(){var m=(c=u.transaction(ji,"readwrite")).objectStore(ji).delete(e);m.onsuccess=function(){return a(h.result.modelArtifactsInfo)},m.onerror=function(g){return o(h.error)}};f.onsuccess=p,f.onerror=function(m){return p(),u.close(),o(h.error)}},h.onerror=function(f){return u.close(),o(h.error)},l.oncomplete=function(){c==null?u.close():c.oncomplete=function(){return u.close()}}},s.onerror=function(c){return o(s.error)}})]})})},r}();if(U().getBool("IS_BROWSER"))try{fi.registerManager(Ga.URL_SCHEME,new iI)}catch{}var Pr="/",ja="tensorflowjs_models",zy="info",aI="model_topology",oI="weight_specs",sI="weight_data",cI="model_metadata";function jy(r){return{info:[ja,r,zy].join(Pr),topology:[ja,r,aI].join(Pr),weightSpecs:[ja,r,oI].join(Pr),weightData:[ja,r,sI].join(Pr),modelMetadata:[ja,r,cI].join(Pr)}}function uI(r){var e=r.split(Pr);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(Pr)}var qa=function(){function r(e){if(!U().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=jy(this.modelPath)}return r.prototype.save=function(e){return st(this,void 0,void 0,function(){var t,n,i;return ct(this,function(a){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=Ss(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(o){if(Dh)return Buffer.from(o).toString("base64");for(var s=new Uint8Array(o),c="",u=0,l=s.length;u<l;u++)c+=String.fromCharCode(s[u]);return btoa(c)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return st(this,void 0,void 0,function(){var e,t,n,i,a,o,s;return ct(this,function(c){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(a=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(a),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(u){if(Dh){var l=Buffer.from(u,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(u),h=new Uint8Array(d.length),f=0;f<d.length;++f)h.set([d.charCodeAt(f)],f);return h.buffer}(s),[2,t]})})},r.URL_SCHEME="localstorage://",r}(),v0=function(r){return U().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(qa.URL_SCHEME)?(e=r.slice(qa.URL_SCHEME.length),new qa(e)):null;var e};En.registerSaveRouter(v0),En.registerLoadRouter(v0);var lI=function(){function r(){A(U().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),A(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return st(this,void 0,void 0,function(){var e,t,n,i,a,o;return ct(this,function(s){for(e={},t=ja+Pr,n=Pr+zy,i=0;i<this.LS.length;++i)(a=this.LS.key(i)).startsWith(t)&&a.endsWith(n)&&(o=uI(a),e[o]=JSON.parse(this.LS.getItem(a)));return[2,e]})})},r.prototype.removeModel=function(e){return st(this,void 0,void 0,function(){var t,n;return ct(this,function(i){var a;if(e=(a=e).startsWith(qa.URL_SCHEME)?a.slice(qa.URL_SCHEME.length):a,t=jy(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r}();if(U().getBool("IS_BROWSER"))try{fi.registerManager(qa.URL_SCHEME,new lI)}catch{}var dI="model",hI=".json",fI=".weights.bin";function b0(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var ah=function(){function r(e){if(!U().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=dI),this.modelTopologyFileName=e+hI,this.weightDataFileName=e+fI}return r.prototype.save=function(e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s;return ct(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=a,[4,b0(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,b0(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Ss(e)}]}})})},r.URL_SCHEME="downloads://",r}(),pI=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return st(this,void 0,void 0,function(){var e,t,n=this;return ct(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(a,o){var s=new FileReader;s.onload=function(c){var u=JSON.parse(c.target.result),l=u.modelTopology;if(l!=null){t.length===0&&a({modelTopology:l});var d=u.weightsManifest;if(d!=null){var h;try{h=n.checkManifestAndWeightFiles(d,t)}catch(g){return void o(g)}var f=[],p=[],m=[];d.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),f.push.apply(f,g.weights)}),d.forEach(function(g){g.paths.forEach(function(v){var b=new FileReader;b.onload=function(_){var y=_.target.result,x=p.indexOf(v);m[x]=y,m.indexOf(null)===-1&&a({modelTopology:l,weightSpecs:f,weightData:mf(m),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},b.onerror=function(_){return o("Failed to weights data from file of path '"+v+"'.")},b.readAsArrayBuffer(h[v])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(c){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],i=t.map(function(c){return p0(c.name)}),a={},o=0,s=e;o<s.length;o++)s[o].paths.forEach(function(c){var u=p0(c);if(n.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(n.push(u),i.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");a[c]=t[i.indexOf(u)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return a},r}();function y0(r,e,t,n){(function(a){A(a!=null&&Array.isArray(a)&&a.length>0,function(){return"promises must be a none empty array"})})(r),function(a,o){A(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),A(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),A(o>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+o})}(t=t??0,n=n??1);var i=0;return Promise.all(r.map(function(a){return a.then(function(o){var s=t+ ++i/r.length*(n-t);return e(s),o}),a}))}function Hy(r,e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s,c,u,l;return ct(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?U().platform.fetch:e.fetchFunc,n=r.map(function(h){return t(h,e.requestInit,{isBinary:!0})}),i=0,a=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return o=d.sent(),[3,4];case 2:return[4,y0(n,e.onProgress,i,a)];case 3:o=d.sent(),d.label=4;case 4:return s=o.map(function(h){return h.arrayBuffer()}),c=.5,u=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,y0(s,e.onProgress,c,u)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function x0(r){var e=this;return function(t,n,i){return n===void 0&&(n=""),st(e,void 0,void 0,function(){var a,o,s,c,u,l,d,h,f,p;return ct(this,function(m){switch(m.label){case 0:if(a=t.map(function(){return!1}),o={},s=i!=null?i.map(function(){return!1}):[],c=[],t.forEach(function(g,v){var b=0;g.weights.forEach(function(_){var y="quantization"in _?_.quantization.dtype:_.dtype,x=kh[y]*ut(_.shape),w=function(){a[v]=!0,o[v]==null&&(o[v]=[]),o[v].push({manifestEntry:_,groupOffset:b,sizeBytes:x})};i!=null?i.forEach(function(S,C){S===_.name&&(w(),s[C]=!0)}):w(),c.push(_.name),b+=x})}),!s.every(function(g){return g}))throw u=i.filter(function(g,v){return!s[v]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return l=a.reduce(function(g,v,b){return v&&g.push(b),g},[]),d=[],l.forEach(function(g){t[g].paths.forEach(function(v){var b=n+(n.endsWith("/")?"":"/")+v;d.push(b)})}),[4,r(d)];case 1:return h=m.sent(),f={},p=0,l.forEach(function(g){for(var v=t[g].paths.length,b=0,_=0;_<v;_++)b+=h[p+_].byteLength;for(var y=new ArrayBuffer(b),x=new Uint8Array(y),w=0,S=0;S<v;S++){var C=new Uint8Array(h[p+S]);x.set(C,w),w+=C.byteLength}o[g].forEach(function(E){var D=Vy(y.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var R in D)f[R]=D[R]}),p+=v}),[2,f]}})})}}En.registerSaveRouter(function(r){return U().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ah.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new ah(e)}(r.slice(ah.URL_SCHEME.length)):null});var Uy=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(A(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=U().platform.fetch,A(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&A(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return st(this,void 0,void 0,function(){var t,n,i,a;return ct(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:Ss(e),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}})})},r.prototype.load=function(){return st(this,void 0,void 0,function(){var e,t,n,i,a,o,s,c,u,l,d,h;return ct(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,a=t.weightsManifest,o=t.generatedBy,s=t.convertedBy,c=t.format,u=t.userDefinedMetadata,i==null&&a==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return a==null?[3,7]:[4,this.loadWeights(a)];case 6:h=f.sent(),l=h[0],d=h[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:l,weightData:d,userDefinedMetadata:u,generatedBy:o,convertedBy:s,format:c}]}})})},r.prototype.loadWeights=function(e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s,c,u,l,d,h;return ct(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(p){var m=p.lastIndexOf("/"),g=p.lastIndexOf("?"),v=p.substring(0,m),b=g>m?p.substring(g):"";return[v+"/",b]}(t),i=n[0],a=n[1],o=this.weightPathPrefix||i,s=[],c=0,u=e;c<u.length;c++)l=u[c],s.push.apply(s,l.weights);return d=[],e.forEach(function(p){p.paths.forEach(function(m){d.push(o+m+a)})}),[4,Hy(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=f.sent(),[2,[s,mf(h)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function Ih(r){return r.match(Uy.URL_SCHEME_REGEX)!=null}var _0=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(t){return Ih(t)}):Ih(r))?Mh(r,{onProgress:e}):null};function Mh(r,e){return new Uy(r,e)}En.registerSaveRouter(_0),En.registerLoadRouter(_0);var oh=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return st(this,void 0,void 0,function(){return ct(this,function(e){return[2,this.modelArtifacts]})})},r}(),mI=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return st(this,void 0,void 0,function(){return ct(this,function(t){return[2,this.saveHandler(e)]})})},r}(),zu=Object.freeze({browserFiles:function(r){return new pI(r)},browserHTTPRequest:function(r,e){return Mh(r,e)},concatenateArrayBuffers:mf,decodeWeights:Vy,encodeWeights:function(r,e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s=this;return ct(this,function(c){switch(c.label){case 0:for(t=[],n=[],i=Array.isArray(r)?r.map(function(u){return u.name}):Object.keys(r),a=function(u){var l=i[u],d=Array.isArray(r)?r[u].tensor:r[l];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var h={name:l,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var f=new Promise(function(p){return st(s,void 0,void 0,function(){var m,g,v,b,_,y,x;return ct(this,function(w){switch(w.label){case 0:return[4,d.bytes()];case 1:for(m=w.sent(),g=m.reduce(function(S,C){return S+C.length},0)+Iu*m.length,v=new Uint8Array(g),b=0,_=0;_<m.length;_++)y=m[_],x=new Uint8Array(new Uint32Array([y.length]).buffer),v.set(x,b),b+=Iu,v.set(y,b),b+=y.length;return p(v),[2]}})})});n.push(f)}else n.push(d.data());e!=null&&(h.group=e),t.push(h)},o=0;o<i.length;++o)a(o);return[4,Promise.all(n)];case 1:return[2,{data:rI(c.sent()),specs:t}]}})})},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new oh(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new oh({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new oh({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return En.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:Ss,getSaveHandlers:function(r){return En.getSaveHandlers(r)},http:Mh,isHTTPScheme:Ih,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),st(this,void 0,void 0,function(){return ct(this,function(i){return[2,x0(function(a){return Hy(a,{requestInit:n})})(r,e,t)]})})},registerLoadRouter:function(r){return En.registerLoadRouter(r)},registerSaveRouter:function(r){return En.registerSaveRouter(r)},weightsLoaderFactory:x0,withSaveHandler:function(r){return new mI(r)},copyModel:function(r,e){return st(this,void 0,void 0,function(){return ct(this,function(t){return[2,m0(r,e,!1)]})})},listModels:function(){return st(this,void 0,void 0,function(){var r,e,t,n,i,a,o;return ct(this,function(s){switch(s.label){case 0:r=fi.getSchemes(),e={},t=0,n=r,s.label=1;case 1:return t<n.length?(i=n[t],[4,fi.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())e[i+Ua+o]=a[o];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(r,e){return st(this,void 0,void 0,function(){return ct(this,function(t){return[2,m0(r,e,!0)]})})},removeModel:function(r){return st(this,void 0,void 0,function(){var e;return ct(this,function(t){return e=fu(r),[2,fi.getManager(e.scheme).removeModel(e.path)]})})}}),Ba,gI=F({confusionMatrix_:function(r,e,t){var n=k(r,"labels","confusionMatrix"),i=k(e,"predictions","confusionMatrix");A(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),A(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),A(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),A(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),A(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var a=wh(n.asType("int32"),t),o=wh(i.asType("int32"),t);return a.transpose().matMul(o).asType("int32")}}),v3=Object.freeze({confusionMatrix:gI}),vI=F({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,i=!1,a=!1,o=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)a=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);o=!0}if(i&&i&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(S0("FromPixels",P.backendName)!=null)return P.runKernel("FromPixels",{pixels:r},{numChannels:e});var s,c,u=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],l=u[0],d=u[1];if(o?s=r.getContext("2d").getImageData(0,0,l,d).data:n||t?s=r.data:(a||i)&&(Ba==null&&(Ba=document.createElement("canvas").getContext("2d")),Ba.canvas.width=l,Ba.canvas.height=d,Ba.drawImage(r,0,0,l,d),s=Ba.getImageData(0,0,l,d).data),e===4)c=new Int32Array(s);else{var h=l*d;c=new Int32Array(h*e);for(var f=0;f<h;f++)for(var p=0;p<e;++p)c[f*e+p]=s[4*f+p]}return Tu(c,[d,l,e],"int32")}}),Za=Object.freeze({toPixels:function(r,e){return st(this,void 0,void 0,function(){var t,n,i,a,o,s,c,u,l,d,h,f,p,m,g,v,b,_,y,x,w,S,C;return ct(this,function(E){switch(E.label){case 0:if(t=k(r,"img","toPixels"),r instanceof Ut||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],a=n[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return s=E.sent(),c=t.min(),u=t.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(l=E.sent(),d=l[0],h=l[1],f=d[0],p=h[0],c.dispose(),u.dispose(),t.dtype==="float32"){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(a*i*4),v=0;v<i*a;++v)b=void 0,_=void 0,y=void 0,x=void 0,o===1?(b=s[v]*m,_=s[v]*m,y=s[v]*m,x=255):o===3?(b=s[3*v]*m,_=s[3*v+1]*m,y=s[3*v+2]*m,x=255):o===4&&(b=s[4*v]*m,_=s[4*v+1]*m,y=s[4*v+2]*m,x=s[4*v+3]*m),g[(w=4*v)+0]=Math.round(b),g[w+1]=Math.round(_),g[w+2]=Math.round(y),g[w+3]=Math.round(x);return e!=null&&(e.width=a,e.height=i,S=e.getContext("2d"),C=new ImageData(g,a,i),S.putImageData(C,0,0)),t!==r&&t.dispose(),[2,g]}})})},fromPixels:vI}),Gy=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),qy=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function gi(r){A(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),A(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),A(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),qy.register(r)}var b3=Object.freeze({Serializable:Gy,SerializationMap:qy,registerClass:gi}),bI=.001,Yy=.1;function sh(){return P.backend.floatPrecision()===32?bI:Yy}function ch(r,e,t){var n=!0;if((He(r)||He(e))&&(n=!1),He(r)&&He(e)&&(n=!0),n){var i=r.constructor.name,a=e.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(r)&&Array.isArray(e)){var o=fr(r),s=fr(e);if(!_e(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var c=He(r)?r:Nr(r),u=He(e)?e:Nr(e);if(c.length!==u.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+u.length+`.
Actual:   `+c+`.
Expected: `+u+".");for(var l=0;l<u.length;++l){var d=c[l],h=u[l];if(!t(d,h))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+h+`.
Actual:   `+c+`.
Expected: `+u+".")}}function uh(r,e,t){return!isFinite(r)&&!isFinite(e)||!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}var y3=Object.freeze({TEST_EPSILON_FLOAT16:Yy,expectArraysClose:function(r,e,t){return t==null&&(t=sh()),ch(r,e,function(n,i){return uh(n,i,t)})},testEpsilon:sh,expectPromiseToFail:function(r,e){r().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return di(r)||di(r[0])||di(e)||di(e[0])?ch(r,t,function(n,i){return n==i}):ch(r,e,function(n,i){return uh(n,i,0)})},expectNumbersClose:function(r,e,t){if(t==null&&(t=sh()),!uh(r,e,t))throw new Error("Numbers differ: actual === "+r+", expected === "+e)},expectValuesInRange:function(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:"+r[n]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(r,e){expect(new Float32Array(r)).toEqual(new Float32Array(e))}});var x3=Object.freeze({gpgpu_util:zE,webgl_util:dS,forceHalfFloat:function(){U().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:uy,setWebGLContext:j0,GPGPUContext:ny}),Ji=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Gn(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var a=this.computeGradients(t,i),o=a.value,s=a.grads;if(i!=null){var c=i.map(function(u){return{name:u.name,tensor:s[u.name]}});this.applyGradients(c)}else this.applyGradients(s);return pn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return GS(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&pn(this.iterations_)},e.prototype.saveIterations=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Z(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return st(this,void 0,void 0,function(){var n;return ct(this,function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(Gy);Object.defineProperty(Ji,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var Ky=function(r){function e(t,n,i){i===void 0&&(i=null);var a=r.call(this)||this;return a.learningRate=t,a.rho=n,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],i==null&&(a.epsilon=P.backend.epsilon()),a}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=P.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accum_grad",variable:K(function(){return Tt(o).variable(!1)})}),n.accumulatedUpdates[a]==null&&(n.accumulatedUpdates[a]={originalName:i+"/accum_var",variable:K(function(){return Tt(o).variable(!1)})});var s=Array.isArray(t)?t[a].tensor:t[i];if(s!=null){var c=n.accumulatedGrads[a].variable,u=n.accumulatedUpdates[a].variable;K(function(){var l=c.mul(n.rho).add(s.square().mul(1-n.rho)),d=u.add(n.epsilon).sqrt().div(c.add(n.epsilon).sqrt()).mul(s),h=u.mul(n.rho).add(d.square().mul(1-n.rho));c.assign(l),u.assign(h);var f=d.mul(-n.learningRate).add(o);o.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(pn(this.accumulatedGrads.map(function(t){return t.variable})),pn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){var t;return ct(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){var n;return ct(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e}(Ji);gi(Ky);var Xy=function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=P.registeredVariables[i];n.accumulatedGrads[a]==null&&(n.accumulatedGrads[a]={originalName:i+"/accumulator",variable:K(function(){return kn(o.shape,n.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[a].tensor:t[i];if(s!=null){var c=n.accumulatedGrads[a].variable;K(function(){var u=c.add(s.square());c.assign(u);var l=s.div(u.add(P.backend.epsilon()).sqrt()).mul(-n.learningRate).add(o);o.assign(l)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&pn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e}(Ji);gi(Xy);var $y=function(r){function e(t,n,i,a){a===void 0&&(a=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=i,o.epsilon=a,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],K(function(){o.accBeta1=Z(n).variable(),o.accBeta2=Z(i).variable()}),a==null&&(o.epsilon=P.backend.epsilon()),o}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);K(function(){var a=Gt(1,n.accBeta1),o=Gt(1,n.accBeta2);i.forEach(function(s,c){var u=P.registeredVariables[s];n.accumulatedFirstMoment[c]==null&&(n.accumulatedFirstMoment[c]={originalName:s+"/m",variable:K(function(){return Tt(u).variable(!1)})}),n.accumulatedSecondMoment[c]==null&&(n.accumulatedSecondMoment[c]={originalName:s+"/v",variable:K(function(){return Tt(u).variable(!1)})});var l=Array.isArray(t)?t[c].tensor:t[s];if(l!=null){var d=n.accumulatedFirstMoment[c].variable,h=n.accumulatedSecondMoment[c].variable,f=d.mul(n.beta1).add(l.mul(1-n.beta1)),p=h.mul(n.beta2).add(l.square().mul(1-n.beta2)),m=f.div(a),g=p.div(o);d.assign(f),h.assign(p);var v=m.div(g.sqrt().add(n.epsilon)).mul(-n.learningRate).add(u);u.assign(v)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&pn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&pn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){var t;return ct(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){var n,i=this;return ct(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),K(function(){i.accBeta1.assign(Du(i.beta1,i.iterations_+1)),i.accBeta2.assign(Du(i.beta2,i.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e}(Ji);gi($y);var Qy=function(r){function e(t,n,i,a,o){a===void 0&&(a=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=i,s.epsilon=a,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],K(function(){s.iteration=Z(0).variable(),s.accBeta1=Z(n).variable()}),a==null&&(s.epsilon=P.backend.epsilon()),s}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(a){return a.name}):Object.keys(t);K(function(){var a=Gt(1,n.accBeta1),o=Fn(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(s,c){var u=P.registeredVariables[s];n.accumulatedFirstMoment[c]==null&&(n.accumulatedFirstMoment[c]={originalName:s+"/m",variable:Tt(u).variable(!1)}),n.accumulatedWeightedInfNorm[c]==null&&(n.accumulatedWeightedInfNorm[c]={originalName:s+"/v",variable:Tt(u).variable(!1)});var l=Array.isArray(t)?t[c].tensor:t[s];if(l!=null){var d=n.accumulatedFirstMoment[c].variable,h=n.accumulatedWeightedInfNorm[c].variable,f=d.mul(n.beta1).add(l.mul(1-n.beta1)),p=h.mul(n.beta2),m=l.abs(),g=p.maximum(m);d.assign(f),h.assign(g);var v=o.div(a).mul(f.div(g.add(n.epsilon))).add(u);u.assign(v)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&pn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&pn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e}(Ji);gi(Qy);var gf=function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=Array.isArray(t)?t[a].tensor:t[i];if(o!=null){var s=P.registeredVariables[i];K(function(){var c=n.c.mul(o).add(s);s.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=hS(Z(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e}(Ji);gi(gf);var Jy=function(r){function e(t,n,i){i===void 0&&(i=!1);var a=r.call(this,t)||this;return a.learningRate=t,a.momentum=n,a.useNesterov=i,a.accumulations=[],a.m=Z(a.momentum),a}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=P.registeredVariables[i];n.accumulations[a]==null&&(n.accumulations[a]={originalName:i+"/momentum",variable:K(function(){return Tt(o).variable(!1)})});var s=n.accumulations[a].variable,c=Array.isArray(t)?t[a].tensor:t[i];c!=null&&K(function(){var u,l=n.m.mul(s).add(c);u=n.useNesterov?n.c.mul(c.add(l.mul(n.m))).add(o):n.c.mul(l).add(o),s.assign(l),o.assign(u)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&pn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){return ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){return ct(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e}(gf);gi(Jy);var Zy=function(r){function e(t,n,i,a,o){n===void 0&&(n=.9),i===void 0&&(i=0),a===void 0&&(a=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=i,s.epsilon=a,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,a==null&&(s.epsilon=P.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Gn(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,a){var o=P.registeredVariables[i];n.accumulatedMeanSquares[a]==null&&(n.accumulatedMeanSquares[a]={originalName:i+"/rms",variable:K(function(){return Tt(o).variable(!1)})}),n.accumulatedMoments[a]==null&&(n.accumulatedMoments[a]={originalName:i+"/momentum",variable:K(function(){return Tt(o).variable(!1)})}),n.accumulatedMeanGrads[a]==null&&n.centered&&(n.accumulatedMeanGrads[a]={originalName:i+"/mg",variable:K(function(){return Tt(o).variable(!1)})});var s=Array.isArray(t)?t[a].tensor:t[i];if(s!=null){var c=n.accumulatedMeanSquares[a].variable,u=n.accumulatedMoments[a].variable;K(function(){var l=c.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var d=n.accumulatedMeanGrads[a].variable,h=d.mul(n.decay).add(s.mul(1-n.decay)),f=u.mul(n.momentum).add(s.mul(n.learningRate).div(l.sub(h.square().add(n.epsilon)).sqrt()));c.assign(l),d.assign(h),u.assign(f);var p=o.sub(f);o.assign(p)}else{var m=c.mul(n.decay).add(s.square().mul(1-n.decay));f=u.mul(n.momentum).add(s.mul(n.learningRate).div(m.add(n.epsilon).sqrt())),c.assign(m),u.assign(f),p=o.sub(f),o.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&pn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&pn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&pn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return st(this,void 0,void 0,function(){var t;return ct(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return st(this,void 0,void 0,function(){var n;return ct(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e}(Ji);gi(Zy);var Bi=function(){function r(){}return r.sgd=function(e){return new gf(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new Jy(e,t,n)},r.rmsprop=function(e,t,n,i,a){return t===void 0&&(t=.9),n===void 0&&(n=0),i===void 0&&(i=null),a===void 0&&(a=!1),new Zy(e,t,n,i,a)},r.adam=function(e,t,n,i){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),new $y(e,t,n,i)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new Ky(e,t,n)},r.adamax=function(e,t,n,i,a){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),i===void 0&&(i=null),a===void 0&&(a=0),new Qy(e,t,n,i,a)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new Xy(e,t)},r}(),_3={sgd:Bi.sgd,momentum:Bi.momentum,adadelta:Bi.adadelta,adagrad:Bi.adagrad,rmsprop:Bi.rmsprop,adamax:Bi.adamax,adam:Bi.adam};Ut.prototype.squaredDifference=function(r){return ly(this,r)},V=$A;function vi(r,e,t){if(t===void 0&&(t=!1),r.beginPath(),e.slice(1).forEach(function(a,o){var s=a.x,c=a.y,u=e[o];r.moveTo(u.x,u.y),r.lineTo(s,c)}),t){var n=e[e.length-1],i=e[0];if(!n||!i)return;r.moveTo(n.x,n.y),r.lineTo(i.x,i.y)}r.stroke()}var vf=function(r,e){return vf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},vf(r,e)};function tt(r,e){vf(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Se=function(){return Se=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Se.apply(this,arguments)};function Q(r,e,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function s(l){try{u(n.next(l))}catch(d){o(d)}}function c(l){try{u(n.throw(l))}catch(d){o(d)}}function u(l){l.done?a(l.value):i(l.value).then(s,c)}u((n=n.apply(r,e||[])).next())})}function J(r,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){t.label=u[1];break}if(u[0]===6&&t.label<a[1]){t.label=a[1],a=u;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(u);break}a[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Zi(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),i=0,e=0;e<t;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n}var Xn=function(){function r(e,t){if(!mr(e)||!mr(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function Es(r,e){return r instanceof Ut&&r.shape.length===e}function tx(r){return Es(r,2)}function bi(r){return Es(r,3)}function On(r){return Es(r,4)}function ex(r){return r%1!==0}function bf(r){return r%2===0}function ju(r,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(r*t)/t}function yf(r){return r&&r.width&&r.height}function nx(r,e){var t=r.width,n=r.height,i=e/Math.max(n,t);return new Xn(Math.round(t*i),Math.round(n*i))}function to(r){return r.reduce(function(e,t){return e.add(t)},new Ct(0,0)).div(new Ct(r.length,r.length))}function zr(r,e,t){return Array(r).fill(0).map(function(n,i){return e+i*t})}function mr(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function Hu(r){return mr(r)&&0<=r&&r<=1}var Ct=function(){function r(e,t){this._x=e,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.sub=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.mul=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.div=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}();var Ge=function(){function r(e,t){t===void 0&&(t=!0);var n=e||{},i=[n.left,n.top,n.right,n.bottom].every(mr),a=[n.x,n.y,n.width,n.height].every(mr);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var o=a?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=o[0],c=o[1],u=o[2],l=o[3];r.assertIsValidBox({x:s,y:c,width:u,height:l},"Box.constructor",t),this._x=s,this._y=c,this._width=u,this._height=l}return r.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(mr)},r.assertIsValidBox=function(e,t,n){if(n===void 0&&(n=!1),!r.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new Ct(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new Ct(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new Ct(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new Ct(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),t=e[0],n=e[1],i=e[2],a=e[3];return new r({x:t,y:n,width:i,height:a})},r.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),t=e[0],n=e[1],i=e[2],a=e[3];return new r({x:t,y:n,width:i,height:a})},r.prototype.toSquare=function(){var e=this,t=e.x,n=e.y,i=e.width,a=e.height,o=Math.abs(i-a);return i<a&&(t-=o/2,i+=o),a<i&&(n-=o/2,a+=o),new r({x:t,y:n,width:i,height:a})},r.prototype.rescale=function(e){var t=yf(e)?e.width:e,n=yf(e)?e.height:e;return new r({x:this.x*t,y:this.y*n,width:this.width*t,height:this.height*n})},r.prototype.pad=function(e,t){var n=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=n[0],a=n[1],o=n[2],s=n[3];return new r({x:i,y:a,width:o,height:s})},r.prototype.clipAtImageBorders=function(e,t){var n=this,i=n.x,a=n.y,o=n.right,s=n.bottom,c=Math.max(i,0),u=Math.max(a,0),l=o-c,d=s-u,h=Math.min(l,e-c),f=Math.min(d,t-u);return new r({x:c,y:u,width:h,height:f}).floor()},r.prototype.shift=function(e,t){var n=this,i=n.width,a=n.height,o=this.x+e,s=this.y+t;return new r({x:o,y:s,width:i,height:a})},r.prototype.padAtBorders=function(e,t){var n=this.width+1,i=this.height+1,a=1,o=1,s=n,c=i,u=this.left,l=this.top,d=this.right,h=this.bottom;return d>t&&(s=-d+t+n,d=t),h>e&&(c=-h+e+i,h=e),u<1&&(c=2-u,u=1),l<1&&(c=2-l,l=1),{dy:o,edy:c,dx:a,edx:s,y:l,ey:h,x:u,ex:d,w:n,h:i}},r.prototype.calibrate=function(e){return new r({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},r}();var ta=function(r){tt(e,r);function e(t,n,i,a,o){return o===void 0&&(o=!1),r.call(this,{left:t,top:n,right:i,bottom:a},o)||this}return e}(Ge);var Uu=function(){function r(e,t,n,i,a){this._imageDims=new Xn(a.width,a.height),this._score=e,this._classScore=t,this._className=n,this._box=new Ge(i).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Ge(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},r}();var ye=function(r){tt(e,r);function e(t,n,i){return r.call(this,t,t,"",n,i)||this}return e.prototype.forSize=function(t,n){var i=r.prototype.forSize.call(this,t,n),a=i.score,o=i.relativeBox,s=i.imageDims;return new e(a,o,s)},e}(Uu);function rx(r,e,t){t===void 0&&(t=!0);var n=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),i=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top)),a=n*i;return t?a/(r.area+e.area-a):a/Math.min(r.area,e.area)}function ix(r){var e=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),n=e.reduce(function(s,c){return c<s?c:s},1/0),i=t.reduce(function(s,c){return c<s?c:s},1/0),a=e.reduce(function(s,c){return s<c?c:s},0),o=t.reduce(function(s,c){return s<c?c:s},0);return new ta(n,i,a,o)}function jr(r,e,t,n){n===void 0&&(n=!0);for(var i=e.map(function(s,c){return{score:s,boxIndex:c}}).sort(function(s,c){return s.score-c.score}).map(function(s){return s.boxIndex}),a=[],o=function(){var s=i.pop();a.push(s);for(var c=i,u=[],l=0;l<c.length;l++){var d=c[l],h=r[s],f=r[d];u.push(rx(h,f,n))}i=i.filter(function(p,m){return u[m]<=t})};i.length>0;)o();return a}function gr(r,e){return K(function(){var t=e[0],n=e[1],i=e[2],a=kn(Zi(r.shape.slice(0,3),[1]),t),o=kn(Zi(r.shape.slice(0,3),[1]),n),s=kn(Zi(r.shape.slice(0,3),[1]),i),c=Zt([a,o,s],3);return Gt(r,c)})}function ax(r,e){return e===void 0&&(e=!1),K(function(){var t=r.shape.slice(1),n=t[0],i=t[1];if(n===i)return r;var a=Math.abs(n-i),o=Math.round(a*(e?.5:1)),s=n>i?2:1,c=function(f){var p=r.shape.slice();return p[s]=f,kn(p,0)},u=c(o),l=a-u.shape[s],d=e&&l?c(l):null,h=[d,r,u].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return Zt(h,s)})}function Gu(r){return 1/(1+Math.exp(-r))}var eo=function(r){tt(e,r);function e(t,n,i,a,o){return o===void 0&&(o=!1),r.call(this,{x:t,y:n,width:i,height:a},o)||this}return e}(Ge);var xI=.5,_I=.43,wI=.45,Hr=function(){function r(e,t,n){n===void 0&&(n=new Ct(0,0));var i=t.width,a=t.height;this._imgDims=new Xn(i,a),this._shift=n,this._positions=e.map(function(o){return o.mul(new Ct(i,a)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new Ct(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ct(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},r.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ct(e,t))},r.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},r.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var n=e instanceof ye?e.box.floor():new Ge(e);return this.shiftBy(n.x,n.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),a=i.useDlibAlignment,o=i.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(o)},r.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],i=e[2],a=function(d){return i.sub(d).magnitude()},o=(a(t)+a(n))/2,s=Math.floor(o/wI),c=to(e),u=Math.floor(Math.max(0,c.x-xI*s)),l=Math.floor(Math.max(0,c.y-_I*s));return new eo(u,l,Math.min(s,this.imageWidth+u),Math.min(s,this.imageHeight+l))},r.prototype.alignMinBbox=function(e){var t=ix(this.positions);return t.pad(t.width*e,t.height*e)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}();var ox=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],to([t[3],t[4]])]},e}(Hr);var qu=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(to)},e}(Hr);var xf=function(){function r(e,t){this._label=e,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+ju(this.distance)+")":"")},r}();var _f=function(r){tt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._label=n,i}return e.assertIsValidLabeledBox=function(t,n){if(Ge.assertIsValidBox(t,n),!mr(t.label))throw new Error(n+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(Ge);var ks=function(){function r(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},r.fromJSON=function(e){var t=e.descriptors.map(function(n){return new Float32Array(n)});return new r(e.label,t)},r}();var T4=function(r){tt(e,r);function e(t,n,i,a){var o=r.call(this,t,n)||this;return o._score=i,o._classScore=a,o}return e.assertIsValidPredictedBox=function(t,n){if(_f.assertIsValidLabeledBox(t,n),!Hu(t.score)||!Hu(t.classScore))throw new Error(n+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e}(_f);function Ds(r){return r.detection instanceof ye}function no(r,e){var t={detection:e};return Object.assign({},r,t)}function wf(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:e}}function Yu(r){var e="";if(!r)try{r=md("fs")}catch(n){e=n.toString()}var t=r?function(n){return new Promise(function(i,a){r.readFile(n,function(o,s){return o?a(o):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function Cf(){var r=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},a=Yu();return Se({Canvas:r||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:e||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:t,createImageElement:n,fetch:i},a)}function Sf(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Ef(){return typeof global=="object"&&typeof md=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var Ie;function CI(){if(!Ie)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Ie}function kf(r){Ie=r}function Df(){Sf()&&kf(wf()),Ef()&&kf(Cf())}function SI(r){if(Ie||Df(),!Ie)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=r.Canvas,t=e===void 0?Ie.Canvas:e,n=r.Image,i=n===void 0?Ie.Image:n;Ie.Canvas=t,Ie.Image=i,Ie.createCanvasElement=r.createCanvasElement||function(){return new t},Ie.createImageElement=r.createImageElement||function(){return new i},Ie.ImageData=r.ImageData||Ie.ImageData,Ie.Video=r.Video||Ie.Video,Ie.fetch=r.fetch||Ie.fetch,Ie.readFile=r.readFile||Ie.readFile}var Pt={getEnv:CI,setEnv:kf,initialize:Df,createBrowserEnv:wf,createFileSystem:Yu,createNodejsEnv:Cf,monkeyPatch:SI,isBrowser:Sf,isNodejs:Ef};Df();function ro(r){return!Pt.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function qe(r){var e=Pt.getEnv(),t=e.Canvas,n=e.CanvasRenderingContext2D;if(r instanceof n)return r;var i=ro(r);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=i.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var yi=function(r){return r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r}(yi||{}),Af=function(){function r(e){e===void 0&&(e={});var t=e.anchorPosition,n=e.backgroundColor,i=e.fontColor,a=e.fontSize,o=e.fontStyle,s=e.padding;this.anchorPosition=t||yi.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=o||"Georgia",this.padding=s||4}return r}();var If=function(){function r(e,t,n){n===void 0&&(n={}),this.text=typeof e=="string"?[e]:e instanceof r?e.text:e,this.anchor=t,this.options=new Af(n)}return r.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(n){return e.measureText(n).width}).reduce(function(n,i){return n<i?i:n},0)+2*t},r.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},r.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,i=n===yi.BOTTOM_RIGHT||n===yi.TOP_RIGHT,a=n===yi.BOTTOM_LEFT||n===yi.BOTTOM_RIGHT,o=this.measureWidth(e),s=this.measureHeight(),c=i?this.anchor.x-o:this.anchor.x,u=a?this.anchor.y-s:this.anchor.y;if(t){var l=t.width,d=t.height,h=Math.max(Math.min(c,l-o),0),f=Math.max(Math.min(u,d-s),0);return{x:h,y:f}}return{x:c,y:u}},r.prototype.draw=function(e){var t=ro(e),n=qe(t),i=this.options,a=i.backgroundColor,o=i.fontColor,s=i.fontSize,c=i.fontStyle,u=i.padding;n.font=s+"px "+c;var l=this.measureWidth(n),d=this.measureHeight();n.fillStyle=a;var h=this.getUpperLeft(n,t);n.fillRect(h.x,h.y,l,d),n.fillStyle=o,this.text.forEach(function(f,p){var m=u+h.x,g=u+h.y+(p+1)*s;n.fillText(f,m,g)})},r}();var EI=function(){function r(e){e===void 0&&(e={});var t=e.boxColor,n=e.lineWidth,i=e.label,a=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=i;var o={anchorPosition:yi.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Af(Object.assign({},o,a))}return r}();var kI=function(){function r(e,t){t===void 0&&(t={}),this.box=new Ge(e),this.options=new EI(t)}return r.prototype.draw=function(e){var t=qe(e),n=this.options,i=n.boxColor,a=n.lineWidth,o=this.box,s=o.x,c=o.y,u=o.width,l=o.height;t.strokeStyle=i,t.lineWidth=a,t.strokeRect(s,c,u,l);var d=this.options.label;d&&new If([d],{x:s-a/2,y:c},this.options.drawLabelOptions).draw(e)},r}();function Ku(r){var e=Pt.getEnv(),t=e.Image,n=e.Video;return r instanceof t&&r.complete||r instanceof n&&r.readyState>=3}function sx(r){return new Promise(function(e,t){if(r instanceof Pt.getEnv().Canvas||Ku(r))return e();function n(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",i),e(a))}function i(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",n),a.currentTarget.removeEventListener("error",i),t(a))}r.addEventListener("load",n),r.addEventListener("error",i)})}function cx(r){return new Promise(function(e,t){if(!(r instanceof Blob))return t("bufferToImage - expected buf to be of type: Blob");var n=new FileReader;n.onload=function(){if(typeof n.result!="string")return t("bufferToImage - expected reader.result to be a string, in onload");var i=Pt.getEnv().createImageElement();i.onload=function(){return e(i)},i.onerror=t,i.src=n.result},n.onerror=t,n.readAsDataURL(r)})}function As(r){var e=Pt.getEnv(),t=e.Image,n=e.Video;return r instanceof t?new Xn(r.naturalWidth,r.naturalHeight):r instanceof n?new Xn(r.videoWidth,r.videoHeight):new Xn(r.width,r.height)}function ea(r){var e=r.width,t=r.height,n=Pt.getEnv().createCanvasElement,i=n();return i.width=e,i.height=t,i}function io(r,e){var t=Pt.getEnv().ImageData;if(!(r instanceof t)&&!Ku(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=e||As(r),i=n.width,a=n.height,o=ea({width:i,height:a});return r instanceof t?qe(o).putImageData(r,0,0):qe(o).drawImage(r,0,0,i,a),o}function ux(r,e){return Q(this,void 0,void 0,function(){var t,n,i,a,o,s;return J(this,function(c){switch(c.label){case 0:return t=e||Pt.getEnv().createCanvasElement(),n=r.shape.slice(On(r)?1:0),i=n[0],a=n[1],o=n[2],s=K(function(){return r.as3D(i,a,o).toInt()}),[4,Za.toPixels(s,t)];case 1:return c.sent(),s.dispose(),[2,t]}})})}function Mf(r){var e=Pt.getEnv(),t=e.Image,n=e.Canvas,i=e.Video;return r instanceof t||r instanceof n||r instanceof i}function lx(r,e,t){t===void 0&&(t=!1);var n=Pt.getEnv(),i=n.Image,a=n.Canvas;if(!(r instanceof i||r instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=As(r),s=e/Math.max(o.height,o.width),c=s*o.width,u=s*o.height,l=ea({width:e,height:e}),d=r instanceof a?r:io(r),h=Math.abs(c-u)/2,f=t&&c<u?h:0,p=t&&u<c?h:0;return qe(l).drawImage(d,f,p,c,u),l}var na=function(){function r(e,t){var n=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,a){if(bi(i)){n._imageTensors[a]=i,n._inputDimensions[a]=i.shape;return}if(On(i)){var o=i.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");n._imageTensors[a]=i,n._inputDimensions[a]=i.shape.slice(1);return}var s=i instanceof Pt.getEnv().Canvas?i:io(i);n._canvases[a]=s,n._inputDimensions[a]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var e=this;return zr(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},r.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},r.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},r.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},r.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),n=this.getInputHeight(e);return nx({width:t,height:n},this.inputSize)},r.prototype.toBatchTensor=function(e,t){var n=this;return t===void 0&&(t=!0),this._inputSize=e,K(function(){var i=zr(n.batchSize,0,1).map(function(o){var s=n.getInput(o);if(s instanceof Ut){var c=On(s)?s:s.expandDims();return c=ax(c,t),(c.shape[1]!==e||c.shape[2]!==e)&&(c=Cs.resizeBilinear(c,[e,e])),c.as3D(e,e,3)}if(s instanceof Pt.getEnv().Canvas)return Za.fromPixels(lx(s,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),a=Ue(i.map(function(o){return o.toFloat()})).as4D(n.batchSize,e,e,3);return a})},r}();function jt(r){return Q(this,void 0,void 0,function(){var e,t,n;return J(this,function(i){switch(i.label){case 0:if(r instanceof na)return[2,r];if(e=Array.isArray(r)?r:[r],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(a){return Array.isArray(r)?" at input index "+a+":":""},n=e.map(ro),n.forEach(function(a,o){if(!Mf(a)&&!bi(a)&&!On(a))throw typeof e[o]=="string"?new Error("toNetInput -"+t(o)+" string passed, but could not resolve HTMLElement for element id "+e[o]):new Error("toNetInput -"+t(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(On(a)){var s=a.shape[0];if(s!==1)throw new Error("toNetInput -"+t(o)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(a){return Mf(a)&&sx(a)}))];case 1:return i.sent(),[2,new na(n,Array.isArray(r))]}})})}function Is(r,e){return Q(this,void 0,void 0,function(){var t,n,i,a,o,s,c;return J(this,function(u){switch(u.label){case 0:return t=Pt.getEnv().Canvas,n=r,r instanceof t?[3,5]:[4,jt(r)];case 1:if(i=u.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return a=i.getInput(0),a instanceof t?(o=a,[3,4]):[3,2];case 2:return[4,ux(a)];case 3:o=u.sent(),u.label=4;case 4:n=o,u.label=5;case 5:return s=qe(n),c=e.map(function(l){return l instanceof ye?l.forSize(n.width,n.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(n.width,n.height)}),[2,c.map(function(l){var d=l.x,h=l.y,f=l.width,p=l.height,m=ea({width:f,height:p});return qe(m).putImageData(s.getImageData(d,h,f,p),0,0),m})]}})})}function Ms(r,e){return Q(this,void 0,void 0,function(){return J(this,function(t){if(!bi(r)&&!On(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(On(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,K(function(){var n=r.shape.slice(On(r)?1:0),i=n[0],a=n[1],o=n[2],s=e.map(function(u){return u instanceof ye?u.forSize(a,i).box:u}).map(function(u){return u.clipAtImageBorders(a,i)}),c=s.map(function(u){var l=u.x,d=u.y,h=u.width,f=u.height;return of(r.as3D(i,a,o),[d,l,0],[f,h,o])});return c})]})})}function Rs(r,e){return Q(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return t=Pt.getEnv().fetch,[4,t(r,e)];case 1:if(n=i.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function dx(r){return Q(this,void 0,void 0,function(){var e,t;return J(this,function(n){switch(n.label){case 0:return[4,Rs(r)];case 1:return e=n.sent(),[4,e.blob()];case 2:if(t=n.sent(),!t.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+t.type+", for url: "+e.url);return[2,cx(t)]}})})}function hx(r){return Q(this,void 0,void 0,function(){return J(this,function(e){switch(e.label){case 0:return[4,Rs(r)];case 1:return[2,e.sent().json()]}})})}function Xu(r,e){var t=e+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var i=r.split("/").filter(function(s){return s}),a=r.endsWith(".json")?i[i.length-1]:t,o=n+(r.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return o=r.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+a:o+"/"+a}}function fx(r,e){return Q(this,void 0,void 0,function(){var t,n,i,a;return J(this,function(o){switch(o.label){case 0:return t=Xu(r,e),n=t.manifestUri,i=t.modelBaseUri,[4,hx(n)];case 1:return a=o.sent(),[2,zu.loadWeights(a,i)]}})})}var Be=function(){function r(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),n=t.obj,i=t.objProp;return n[i]},r.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),i=n.obj,a=n.objProp;i[a].dispose(),i[a]=t},r.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Gi})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Gi)})},r.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,i=t.tensor;e.reassignParamFromPath(n,i.variable())})},r.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,i=t.tensor,a=Ne(i.dataSync());i.dispose(),e.reassignParamFromPath(n,a)})},r.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},r.prototype.load=function(e){return Q(this,void 0,void 0,function(){return J(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(e){return Q(this,void 0,void 0,function(){var t;return J(this,function(n){switch(n.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,fx(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(e){return Q(this,void 0,void 0,function(){var t,n,i,a,o,s,c,u,l,d;return J(this,function(h){switch(h.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Pt.getEnv().readFile,n=Xu(e,this.getDefaultModelName()),i=n.manifestUri,a=n.modelBaseUri,o=function(f){return Promise.all(f.map(function(p){return t(p).then(function(m){return m.buffer})}))},s=zu.weightsLoaderFactory(o),l=(u=JSON).parse,[4,t(i)];case 1:return c=l.apply(u,[h.sent().toString()]),[4,s(c,a)];case 2:return d=h.sent(),this.loadFromWeightMap(d),[2]}})})},r.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(a,o){if(!a.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+e);return{obj:a.nextObj,objProp:o,nextObj:a.nextObj[o]}},{nextObj:this.params}),n=t.obj,i=t.objProp;if(!n||!i||!(n[i]instanceof Ut))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:i}},r}();function sn(r,e,t){return K(function(){var n=_s(r,e.depthwise_filter,e.pointwise_filter,t,"same");return n=ht(n,e.bias),n})}function $u(r,e,t){return t===void 0&&(t=!1),K(function(){var n=Vt(t?ht(Le(r,e.conv0.filters,[2,2],"same"),e.conv0.bias):sn(r,e.conv0,[2,2])),i=sn(n,e.conv1,[1,1]),a=Vt(ht(n,i)),o=sn(a,e.conv2,[1,1]);return Vt(ht(n,ht(i,o)))})}function Ts(r,e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!0),K(function(){var i=Vt(t?ht(Le(r,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):sn(r,e.conv0,n?[2,2]:[1,1])),a=sn(i,e.conv1,[1,1]),o=Vt(ht(i,a)),s=sn(o,e.conv2,[1,1]),c=Vt(ht(i,ht(a,s))),u=sn(c,e.conv3,[1,1]);return Vt(ht(i,ht(a,ht(s,u))))})}function Je(r,e,t,n){return t===void 0&&(t="same"),n===void 0&&(n=!1),K(function(){var i=ht(Le(r,e.filters,[1,1],t),e.bias);return n?Vt(i):i})}function Ve(r,e){Object.keys(r).forEach(function(t){e.some(function(n){return n.originalPath===t})||r[t].dispose()})}function xi(r,e){return function(t,n,i,a){var o=Ae(r(t*n*i*i),[i,i,t,n]),s=qt(r(n));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}}function ao(r,e){return function(t,n,i){var a=hr(r(t*n),[t,n]),o=qt(r(n));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:o}}}var Rf=function(){function r(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}return r}();function oo(r,e){return function(t,n,i){var a=Ae(r(9*t),[3,3,t,1]),o=Ae(r(t*n),[1,1,t,n]),s=qt(r(n));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new Rf(a,o,s)}}function so(r){return function(e){var t=r(e+"/depthwise_filter",4),n=r(e+"/pointwise_filter",4),i=r(e+"/bias",1);return new Rf(t,n,i)}}function Ze(r,e){return function(t,n,i){var a=r[t];if(!Es(a,n))throw new Error("expected weightMap["+t+"] to be a Tensor"+n+"D, instead have "+a);return e.push({originalPath:t,paramPath:i||t}),a}}function We(r){var e=r;function t(i){var a=e.slice(0,i);return e=e.slice(i),a}function n(){return e}return{extractWeights:t,getRemainingWeights:n}}function Qu(r,e){var t=xi(r,e),n=oo(r,e);function i(o,s,c,u){u===void 0&&(u=!1);var l=u?t(o,s,3,c+"/conv0"):n(o,s,c+"/conv0"),d=n(s,s,c+"/conv1"),h=n(s,s,c+"/conv2");return{conv0:l,conv1:d,conv2:h}}function a(o,s,c,u){u===void 0&&(u=!1);var l=i(o,s,c,u),d=l.conv0,h=l.conv1,f=l.conv2,p=n(s,s,c+"/conv3");return{conv0:d,conv1:h,conv2:f,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function px(r){var e=[],t=We(r),n=t.extractWeights,i=t.getRemainingWeights,a=Qu(n,e).extractDenseBlock4Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),c=a(64,128,"dense2"),u=a(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:s,dense2:c,dense3:u}}}function Ju(r){return function(e){var t=r(e+"/filters",4),n=r(e+"/bias",1);return{filters:t,bias:n}}}function Zu(r,e){var t=Ze(r,e),n=Ju(t),i=so(t);function a(s,c){c===void 0&&(c=!1);var u=c?n(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),d=i(s+"/conv2");return{conv0:u,conv1:l,conv2:d}}function o(s,c){c===void 0&&(c=!1);var u=c?n(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),d=i(s+"/conv2"),h=i(s+"/conv3");return{conv0:u,conv1:l,conv2:d,conv3:h}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function mx(r){var e=[],t=Zu(r,e).extractDenseBlock4Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Ve(r,e),{params:n,paramMappings:e}}var tl=function(r){tt(e,r);function e(){return r.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return K(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=gr(i,a).div(Z(255)),s=Ts(o,n.dense0,!0);return s=Ts(s,n.dense1),s=Ts(s,n.dense2),s=Ts(s,n.dense3),s=Vr(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return mx(t)},e.prototype.extractParams=function(t){return px(t)},e}(Be);function mn(r,e){return K(function(){return ht(Ja(r,e.weights),e.bias)})}function gx(r,e,t){var n=[],i=We(r),a=i.extractWeights,o=i.getRemainingWeights,s=ao(a,n),c=s(e,t,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:c}}}function vx(r){var e=[],t=Ze(r,e);function n(a){var o=t(a+"/weights",2),s=t(a+"/bias",1);return{weights:o,bias:s}}var i={fc:n("fc")};return Ve(r,e),{params:i,paramMappings:e}}function el(r){var e={},t={};return Object.keys(r).forEach(function(n){var i=n.startsWith("fc")?t:e;i[n]=r[n]}),{featureExtractorMap:e,classifierMap:t}}var nl=function(r){tt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._faceFeatureExtractor=n,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return K(function(){var a=t instanceof na?n.faceFeatureExtractor.forwardInput(t):t;return mn(a.as2D(a.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,a=n.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return gx(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var n=el(t),i=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),vx(a)},e.prototype.extractParams=function(t){var n=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),a=i*n+i,o=t.slice(0,t.length-a),s=t.slice(t.length-a);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(s)},e}(Be);var bx=["neutral","happy","sad","angry","fearful","disgusted","surprised"],rl=function(){function r(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);bx.forEach(function(n,i){t[n]=e[i]})}return r.prototype.asSortedArray=function(){var e=this;return bx.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,n){return n.probability-t.probability})},r}();var yx=function(r){tt(e,r);function e(t){return t===void 0&&(t=new tl),r.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var n=this;return K(function(){return on(n.runNet(t))})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return Q(this,void 0,void 0,function(){var n,i,a,o,s=this;return J(this,function(c){switch(c.label){case 0:return[4,jt(t)];case 1:return n=c.sent(),[4,this.forwardInput(n)];case 2:return i=c.sent(),[4,Promise.all(zt(i).map(function(u){return Q(s,void 0,void 0,function(){var l;return J(this,function(d){switch(d.label){case 0:return[4,u.data()];case 1:return l=d.sent(),u.dispose(),[2,l]}})})}))];case 3:return a=c.sent(),i.dispose(),o=a.map(function(u){return new rl(u)}),[2,n.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(nl);function Tf(r,e){var t={expressions:e};return Object.assign({},r,t)}function il(r){return Ds(r)&&r.landmarks instanceof Hr&&r.unshiftedLandmarks instanceof Hr&&r.alignedRect instanceof ye}function co(r,e){var t=r.detection.box,n=e.shiftBy(t.x,t.y),i=n.align(),a=r.detection.imageDims,o=new ye(r.detection.score,i.rescale(a.reverse()),a),s={landmarks:n,unshiftedLandmarks:e,alignedRect:o};return Object.assign({},r,s)}var DI=function(){function r(e){e===void 0&&(e={});var t=e.drawLines,n=t===void 0?!0:t,i=e.drawPoints,a=i===void 0?!0:i,o=e.lineWidth,s=e.lineColor,c=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=a,this.lineWidth=o||1,this.pointSize=c||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"}return r}();var $W=function(){function r(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new DI(t)}return r.prototype.draw=function(e){var t=qe(e),n=this.options,i=n.drawLines,a=n.drawPoints,o=n.lineWidth,s=n.lineColor,c=n.pointSize,u=n.pointColor;if(i&&this.faceLandmarks instanceof qu&&(t.strokeStyle=s,t.lineWidth=o,vi(t,this.faceLandmarks.getJawOutline()),vi(t,this.faceLandmarks.getLeftEyeBrow()),vi(t,this.faceLandmarks.getRightEyeBrow()),vi(t,this.faceLandmarks.getNose()),vi(t,this.faceLandmarks.getLeftEye(),!0),vi(t,this.faceLandmarks.getRightEye(),!0),vi(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;var l=function(d){t.beginPath(),t.arc(d.x,d.y,c,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(l)}},r}();function II(r,e){var t=xi(r,e),n=oo(r,e);function i(o,s,c){var u=n(o,s,c+"/separable_conv0"),l=n(s,s,c+"/separable_conv1"),d=t(o,s,1,c+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:d}}function a(o,s){var c=n(o,o,s+"/separable_conv0"),u=n(o,o,s+"/separable_conv1"),l=n(o,o,s+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:n,extractReductionBlockParams:i,extractMainBlockParams:a}}function xx(r,e){var t=[],n=We(r),i=n.extractWeights,a=n.getRemainingWeights,o=II(i,t),s=o.extractConvParams,c=o.extractSeparableConvParams,u=o.extractReductionBlockParams,l=o.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),h=u(32,64,"entry_flow/reduction_block_0"),f=u(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:h,reduction_block_1:f},m={};zr(e,0,1).forEach(function(_){m["main_block_"+_]=l(128,"middle_flow/main_block_"+_)});var g=u(128,256,"exit_flow/reduction_block"),v=c(256,512,"exit_flow/separable_conv"),b={reduction_block:g,separable_conv:v};if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:m,exit_flow:b}}}function MI(r,e){var t=Ze(r,e),n=Ju(t),i=so(t);function a(s){var c=i(s+"/separable_conv0"),u=i(s+"/separable_conv1"),l=n(s+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:l}}function o(s){var c=i(s+"/separable_conv0"),u=i(s+"/separable_conv1"),l=i(s+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:l}}return{extractConvParams:n,extractSeparableConvParams:i,extractReductionBlockParams:a,extractMainBlockParams:o}}function _x(r,e){var t=[],n=MI(r,t),i=n.extractConvParams,a=n.extractSeparableConvParams,o=n.extractReductionBlockParams,s=n.extractMainBlockParams,c=i("entry_flow/conv_in"),u=o("entry_flow/reduction_block_0"),l=o("entry_flow/reduction_block_1"),d={conv_in:c,reduction_block_0:u,reduction_block_1:l},h={};zr(e,0,1).forEach(function(g){h["main_block_"+g]=s("middle_flow/main_block_"+g)});var f=o("exit_flow/reduction_block"),p=a("exit_flow/separable_conv"),m={reduction_block:f,separable_conv:p};return Ve(r,t),{params:{entry_flow:d,middle_flow:h,exit_flow:m},paramMappings:t}}function wx(r,e,t){return ht(Le(r,e.filters,t,"same"),e.bias)}function Ff(r,e,t){t===void 0&&(t=!0);var n=t?Vt(r):r;return n=sn(n,e.separable_conv0,[1,1]),n=sn(Vt(n),e.separable_conv1,[1,1]),n=ue(n,[3,3],[2,2],"same"),n=ht(n,wx(r,e.expansion_conv,[2,2])),n}function RI(r,e){var t=sn(Vt(r),e.separable_conv0,[1,1]);return t=sn(Vt(t),e.separable_conv1,[1,1]),t=sn(Vt(t),e.separable_conv2,[1,1]),t=ht(t,r),t}var Cx=function(r){tt(e,r);function e(t){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return e.prototype.forwardInput=function(t){var n=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return K(function(){var a=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=gr(a,o).div(Z(256)),c=Vt(wx(s,i.entry_flow.conv_in,[2,2]));return c=Ff(c,i.entry_flow.reduction_block_0,!1),c=Ff(c,i.entry_flow.reduction_block_1),zr(n._numMainBlocks,0,1).forEach(function(u){c=RI(c,i.middle_flow["main_block_"+u])}),c=Ff(c,i.exit_flow.reduction_block),c=Vt(sn(c,i.exit_flow.separable_conv,[1,1])),c})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return _x(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return xx(t,this._numMainBlocks)},e}(Be);function Sx(r){var e=[],t=We(r),n=t.extractWeights,i=t.getRemainingWeights,a=ao(n,e),o=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:o,gender:s}}}}function Ex(r){var e=[],t=Ze(r,e);function n(a){var o=t(a+"/weights",2),s=t(a+"/bias",1);return{weights:o,bias:s}}var i={fc:{age:n("fc/age"),gender:n("fc/gender")}};return Ve(r,e),{params:i,paramMappings:e}}var Fs=function(r){return r.FEMALE="female",r.MALE="male",r}(Fs||{});var kx=function(r){tt(e,r);function e(t){t===void 0&&(t=new Cx(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return K(function(){var a=t instanceof na?n.faceFeatureExtractor.forwardInput(t):t,o=Vr(a,[7,7],[2,2],"valid").as2D(a.shape[0],-1),s=mn(o,i.fc.age).as1D(),c=mn(o,i.fc.gender);return{age:s,gender:c}})},e.prototype.forwardInput=function(t){var n=this;return K(function(){var i=n.runNet(t),a=i.age,o=i.gender;return{age:a,gender:on(o)}})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Q(this,void 0,void 0,function(){var n,i,a,o,s,c,u=this;return J(this,function(l){switch(l.label){case 0:return[4,jt(t)];case 1:return n=l.sent(),[4,this.forwardInput(n)];case 2:return i=l.sent(),a=zt(i.age),o=zt(i.gender),s=a.map(function(d,h){return{ageTensor:d,genderTensor:o[h]}}),[4,Promise.all(s.map(function(d){var h=d.ageTensor,f=d.genderTensor;return Q(u,void 0,void 0,function(){var p,m,g,v,b;return J(this,function(_){switch(_.label){case 0:return[4,h.data()];case 1:return p=_.sent()[0],[4,f.data()];case 2:return m=_.sent()[0],g=m>.5,v=g?Fs.MALE:Fs.FEMALE,b=g?m:1-m,h.dispose(),f.dispose(),[2,{age:p,gender:v,genderProbability:b}]}})})}))];case 3:return c=l.sent(),i.age.dispose(),i.gender.dispose(),[2,n.isBatchInput?c:c[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,a=n.paramMappings;this._params=i,this._paramMappings=a},e.prototype.extractClassifierParams=function(t){return Sx(t)},e.prototype.extractParamsFromWeigthMap=function(t){var n=el(t),i=n.featureExtractorMap,a=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),Ex(a)},e.prototype.extractParams=function(t){var n=1539,i=t.slice(0,t.length-n),a=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e}(Be);var al=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.postProcess=function(t,n,i){var a=i.map(function(s){var c=s.width,u=s.height,l=n/Math.max(u,c);return{width:c*l,height:u*l}}),o=a.length;return K(function(){var s=function(h,f){return Ue([kn([68],h),kn([68],f)],1).as2D(1,136).as1D()},c=function(h,f){var p=a[h],m=p.width,g=p.height;return f(m,g)?Math.abs(m-g)/2:0},u=function(h){return c(h,function(f,p){return f<p})},l=function(h){return c(h,function(f,p){return p<f})},d=t.mul(kn([o,136],n)).sub(Ue(Array.from(Array(o),function(h,f){return s(u(f),l(f))}))).div(Ue(Array.from(Array(o),function(h,f){return s(a[f].width,a[f].height)})));return d})},e.prototype.forwardInput=function(t){var n=this;return K(function(){var i=n.runNet(t);return n.postProcess(i,t.inputSize,t.inputDimensions.map(function(a){var o=a[0],s=a[1];return{height:o,width:s}}))})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Q(this,void 0,void 0,function(){var n,i,a,o=this;return J(this,function(s){switch(s.label){case 0:return[4,jt(t)];case 1:return n=s.sent(),i=K(function(){return zt(o.forwardInput(n))}),[4,Promise.all(i.map(function(c,u){return Q(o,void 0,void 0,function(){var l,d,h,f,p;return J(this,function(m){switch(m.label){case 0:return h=(d=Array).from,[4,c.data()];case 1:return l=h.apply(d,[m.sent()]),f=l.filter(function(g,v){return bf(v)}),p=l.filter(function(g,v){return!bf(v)}),[2,new qu(Array(68).fill(0).map(function(g,v){return new Ct(f[v],p[v])}),{height:n.getInputHeight(u),width:n.getInputWidth(u)})]}})})}))];case 2:return a=s.sent(),i.forEach(function(c){return c.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(nl);var ol=function(r){tt(e,r);function e(t){return t===void 0&&(t=new tl),r.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(al);function Dx(r){var e=[],t=Zu(r,e).extractDenseBlock3Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Ve(r,e),{params:n,paramMappings:e}}function Ax(r){var e=[],t=We(r),n=t.extractWeights,i=t.getRemainingWeights,a=Qu(n,e).extractDenseBlock3Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),c=a(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:s,dense2:c}}}var Ix=function(r){tt(e,r);function e(){return r.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return K(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],o=gr(i,a).div(Z(255)),s=$u(o,n.dense0,!0);return s=$u(s,n.dense1),s=$u(s,n.dense2),s=Vr(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Dx(t)},e.prototype.extractParams=function(t){return Ax(t)},e}(Be);var Mx=function(r){tt(e,r);function e(t){return t===void 0&&(t=new Ix),r.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(al);var mz=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(ol);function Rx(r,e){return ht(se(r,e.weights),e.biases)}function Pf(r,e,t,n,i){i===void 0&&(i="same");var a=e.conv,o=a.filters,s=a.bias,c=Le(r,o,t,i);return c=ht(c,s),c=Rx(c,e.scale),n?Vt(c):c}function Tx(r,e){return Pf(r,e,[1,1],!0)}function Of(r,e){return Pf(r,e,[1,1],!1)}function sl(r,e){return Pf(r,e,[2,2],!0,"valid")}function TI(r,e){function t(s,c,u){var l=r(s),d=l.length/(c*u*u);if(ex(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+c+", filterSize: "+u);return K(function(){return Pn(Ae(l,[c,d,u,u]),[2,3,1,0])})}function n(s,c,u,l){var d=t(s,c,u),h=qt(r(c));return e.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:h}}function i(s,c){var u=qt(r(s)),l=qt(r(s));return e.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:u,biases:l}}function a(s,c,u,l){var d=n(s,c,u,l+"/conv"),h=i(c,l+"/scale");return{conv:d,scale:h}}function o(s,c,u,l,d){d===void 0&&(d=!1);var h=a((d?.5:1)*s,c,u,l+"/conv1"),f=a(s,c,u,l+"/conv2");return{conv1:h,conv2:f}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function Fx(r){var e=We(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],a=TI(t,i),o=a.extractConvLayerParams,s=a.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),u=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),S=K(function(){return Pn(hr(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var C={conv32_down:c,conv32_1:u,conv32_2:l,conv32_3:d,conv64_down:h,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:b,conv256_down:_,conv256_1:y,conv256_2:x,conv256_down_out:w,fc:S};return{params:C,paramMappings:i}}function FI(r,e){var t=Ze(r,e);function n(o){var s=t(o+"/scale/weights",1),c=t(o+"/scale/biases",1);return{weights:s,biases:c}}function i(o){var s=t(o+"/conv/filters",4),c=t(o+"/conv/bias",1),u=n(o);return{conv:{filters:s,bias:c},scale:u}}function a(o){return{conv1:i(o+"/conv1"),conv2:i(o+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function Px(r){var e=[],t=FI(r,e),n=t.extractConvLayerParams,i=t.extractResidualLayerParams,a=n("conv32_down"),o=i("conv32_1"),s=i("conv32_2"),c=i("conv32_3"),u=i("conv64_down"),l=i("conv64_1"),d=i("conv64_2"),h=i("conv64_3"),f=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),v=i("conv256_1"),b=i("conv256_2"),_=i("conv256_down_out"),y=r.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!tx(y))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var x={conv32_down:a,conv32_1:o,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:l,conv64_2:d,conv64_3:h,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:b,conv256_down_out:_,fc:y};return Ve(r,e),{params:x,paramMappings:e}}function $n(r,e){var t=Tx(r,e.conv1);return t=Of(t,e.conv2),t=ht(t,r),t=Vt(t),t}function Ps(r,e){var t=sl(r,e.conv1);t=Of(t,e.conv2);var n=Vr(r,2,2,"valid"),i=Kt(n.shape),a=n.shape[3]!==t.shape[3],o=n.shape[1]!==t.shape[1]||n.shape[2]!==t.shape[2];if(o){var s=Zi(t.shape);s[1]=1;var c=Kt(s);t=Zt([t,c],1);var u=Zi(t.shape);u[2]=1;var l=Kt(u);t=Zt([t,l],2)}return n=a?Zt([n,i],3):n,t=ht(n,t),t=Vt(t),t}var Nf=function(r){tt(e,r);function e(){return r.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return K(function(){var i=t.toBatchTensor(150,!0).toFloat(),a=[122.782,117.001,104.298],o=gr(i,a).div(Z(256)),s=sl(o,n.conv32_down);s=ue(s,3,2,"valid"),s=$n(s,n.conv32_1),s=$n(s,n.conv32_2),s=$n(s,n.conv32_3),s=Ps(s,n.conv64_down),s=$n(s,n.conv64_1),s=$n(s,n.conv64_2),s=$n(s,n.conv64_3),s=Ps(s,n.conv128_down),s=$n(s,n.conv128_1),s=$n(s,n.conv128_2),s=Ps(s,n.conv256_down),s=$n(s,n.conv256_1),s=$n(s,n.conv256_2),s=Ps(s,n.conv256_down_out);var c=s.mean([1,2]),u=Ja(c,n.fc);return u})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Q(this,void 0,void 0,function(){var n,i,a,o=this;return J(this,function(s){switch(s.label){case 0:return[4,jt(t)];case 1:return n=s.sent(),i=K(function(){return zt(o.forwardInput(n))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return a=s.sent(),i.forEach(function(c){return c.dispose()}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Px(t)},e.prototype.extractParams=function(t){return Fx(t)},e}(Be);function Lf(r,e){var t={descriptor:e};return Object.assign({},r,t)}function Bf(r,e){var t={age:e};return Object.assign({},r,t)}function Vf(r,e,t){var n={gender:e,genderProbability:t};return Object.assign({},r,n)}var Os=function(){function r(e){var t=e===void 0?{}:e,n=t.minFaceSize,i=t.scaleFactor,a=t.maxNumScales,o=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=i||.709,this._maxNumScales=a||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function PI(r,e){function t(c,u){var l=Ae(r(9*c),[3,3,c,1]),d=qt(r(c)),h=qt(r(c)),f=qt(r(c)),p=qt(r(c));return e.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:h,batch_norm_mean:f,batch_norm_variance:p}}function n(c,u,l,d,h){var f=Ae(r(c*u*l*l),[l,l,c,u]),p=qt(r(u));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(h?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function i(c,u,l,d){var h=n(c,u,l,d,!0),f=h.filters,p=h.bias;return{filters:f,batch_norm_offset:p}}function a(c,u,l){var d=t(c,l+"/depthwise_conv"),h=i(c,u,1,l+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:h}}function o(){var c=i(3,32,3,"mobilenetv1/conv_0"),u=a(32,64,"mobilenetv1/conv_1"),l=a(64,128,"mobilenetv1/conv_2"),d=a(128,128,"mobilenetv1/conv_3"),h=a(128,256,"mobilenetv1/conv_4"),f=a(256,256,"mobilenetv1/conv_5"),p=a(256,512,"mobilenetv1/conv_6"),m=a(512,512,"mobilenetv1/conv_7"),g=a(512,512,"mobilenetv1/conv_8"),v=a(512,512,"mobilenetv1/conv_9"),b=a(512,512,"mobilenetv1/conv_10"),_=a(512,512,"mobilenetv1/conv_11"),y=a(512,1024,"mobilenetv1/conv_12"),x=a(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:u,conv_2:l,conv_3:d,conv_4:h,conv_5:f,conv_6:p,conv_7:m,conv_8:g,conv_9:v,conv_10:b,conv_11:_,conv_12:y,conv_13:x}}function s(){var c=i(1024,256,1,"prediction_layer/conv_0"),u=i(256,512,3,"prediction_layer/conv_1"),l=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),h=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),m=i(64,128,3,"prediction_layer/conv_7"),g=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),y=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),x=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),w=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),E=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),R=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),M={box_encoding_predictor:g,class_predictor:v},L={box_encoding_predictor:b,class_predictor:_},B={box_encoding_predictor:y,class_predictor:x},O={box_encoding_predictor:w,class_predictor:S},z={box_encoding_predictor:C,class_predictor:E},W={box_encoding_predictor:D,class_predictor:R};return{conv_0:c,conv_1:u,conv_2:l,conv_3:d,conv_4:h,conv_5:f,conv_6:p,conv_7:m,box_predictor_0:M,box_predictor_1:L,box_predictor_2:B,box_predictor_3:O,box_predictor_4:z,box_predictor_5:W}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:s}}function Ox(r){var e=[],t=We(r),n=t.extractWeights,i=t.getRemainingWeights,a=PI(n,e),o=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,c=o(),u=s(),l=Tu(n(5118*4),[1,5118,4]),d={extra_dim:l};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:d},paramMappings:e}}function OI(r,e){var t=Ze(r,e);function n(u,l,d){var h=t(u+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),f=t(u+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:h,batch_norm_offset:f}}function i(u){var l="mobilenetv1/conv_"+u,d="MobilenetV1/Conv2d_"+u+"_depthwise",h=l+"/depthwise_conv",f=l+"/pointwise_conv",p=t(d+"/depthwise_weights",4,h+"/filters"),m=t(d+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),g=t(d+"/BatchNorm/beta",1,h+"/batch_norm_offset"),v=t(d+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),b=t(d+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:v,batch_norm_variance:b},pointwise_conv:n("MobilenetV1",u,f)}}function a(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function o(u,l){var d=t(u+"/weights",4,l+"/filters"),h=t(u+"/biases",1,l+"/bias");return{filters:d,bias:h}}function s(u){var l=o("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),d=o("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:l,class_predictor:d}}function c(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:c}}function Nx(r){var e=[],t=OI(r,e),n=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,a=r["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!bi(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:n(),prediction_layer:i(),output_layer:{extra_dim:a}};return Ve(r,e),{params:o,paramMappings:e}}function Nn(r,e,t){return K(function(){var n=Le(r,e.filters,t,"same");return n=ht(n,e.batch_norm_offset),vs(n,0,6)})}var NI=.0010000000474974513;function LI(r,e,t){return K(function(){var n=xs(r,e.filters,t,"same");return n=ef(n,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,NI),vs(n,0,6)})}function BI(r){return[2,4,6,12].some(function(e){return e===r})?[2,2]:[1,1]}function Lx(r,e){return K(function(){var t=null,n=Nn(r,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(a,o){var s=o+1,c=BI(s);n=LI(n,a.depthwise_conv,c),n=Nn(n,a.pointwise_conv,[1,1]),s===11&&(t=n)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:t}})}function Bx(r,e,t,n,i){var a=r.shape[0],o=Math.min(t,a),s=e.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>i}).sort(function(l,d){return d.score-l.score}),c=function(l){return l<=n?1:0},u=[];return s.forEach(function(l){if(!(u.length>=o)){for(var d=l.score,h=u.length-1;h>=0;--h){var f=VI(r,l.boxIndex,u[h]);if(f!==0&&(l.score*=c(f),l.score<=i))break}d===l.score&&u.push(l.boxIndex)}}),u}function VI(r,e,t){var n=r.arraySync(),i=Math.min(n[e][0],n[e][2]),a=Math.min(n[e][1],n[e][3]),o=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),c=Math.min(n[t][0],n[t][2]),u=Math.min(n[t][1],n[t][3]),l=Math.max(n[t][0],n[t][2]),d=Math.max(n[t][1],n[t][3]),h=(o-i)*(s-a),f=(l-c)*(d-u);if(h<=0||f<=0)return 0;var p=Math.max(i,c),m=Math.max(a,u),g=Math.min(o,l),v=Math.min(s,d),b=Math.max(g-p,0)*Math.max(v-m,0);return b/(h+f-b)}function WI(r){var e=zt(Pn(r,[1,0])),t=[Gt(e[2],e[0]),Gt(e[3],e[1])],n=[ht(e[0],Fn(t[0],Z(2))),ht(e[1],Fn(t[1],Z(2)))];return{sizes:t,centers:n}}function zI(r,e){var t=WI(r),n=t.sizes,i=t.centers,a=zt(Pn(e,[1,0])),o=Fn(se(Lu(Fn(a[2],Z(5))),n[0]),Z(2)),s=ht(se(Fn(a[0],Z(10)),n[0]),i[0]),c=Fn(se(Lu(Fn(a[3],Z(5))),n[1]),Z(2)),u=ht(se(Fn(a[1],Z(10)),n[1]),i[1]);return Pn(Ue([Gt(s,o),Gt(u,c),ht(s,o),ht(u,c)]),[1,0])}function Vx(r,e,t){return K(function(){var n=r.shape[0],i=zI(an(Ui(t.extra_dim,[n,1,1]),[-1,4]),an(r,[-1,4]));i=an(i,[n,i.shape[0]/n,4]);var a=tf(Un(e,[0,0,1],[-1,-1,-1])),o=Un(a,[0,0,0],[-1,-1,1]);o=an(o,[n,o.shape[1]]);var s=zt(i),c=zt(o);return{boxes:s,scores:c}})}function ra(r,e){return K(function(){var t=r.shape[0],n=an(Je(r,e.box_encoding_predictor),[t,-1,1,4]),i=an(Je(r,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:n,classPrediction:i}})}function Wx(r,e,t){return K(function(){var n=Nn(r,t.conv_0,[1,1]),i=Nn(n,t.conv_1,[2,2]),a=Nn(i,t.conv_2,[1,1]),o=Nn(a,t.conv_3,[2,2]),s=Nn(o,t.conv_4,[1,1]),c=Nn(s,t.conv_5,[2,2]),u=Nn(c,t.conv_6,[1,1]),l=Nn(u,t.conv_7,[2,2]),d=ra(e,t.box_predictor_0),h=ra(r,t.box_predictor_1),f=ra(i,t.box_predictor_2),p=ra(o,t.box_predictor_3),m=ra(c,t.box_predictor_4),g=ra(l,t.box_predictor_5),v=Zt([d.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),b=Zt([d.classPrediction,h.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:v,classPredictions:b}})}var _i=function(){function r(e){var t=e===void 0?{}:e,n=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}();var cl=function(r){tt(e,r);function e(){return r.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return K(function(){var i=t.toBatchTensor(512,!1).toFloat(),a=Gt(se(i,Z(.007843137718737125)),Z(1)),o=Lx(a,n.mobilenetv1),s=Wx(o.out,o.conv11,n.prediction_layer),c=s.boxPredictions,u=s.classPredictions;return Vx(c,u,n.output_layer)})},e.prototype.forward=function(t){return Q(this,void 0,void 0,function(){var n;return J(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,jt(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,n){return n===void 0&&(n={}),Q(this,void 0,void 0,function(){var i,a,o,s,c,u,l,d,h,f,p,m,g,v,b,_,y,x,w,S,C;return J(this,function(E){switch(E.label){case 0:return i=new _i(n),a=i.maxResults,o=i.minConfidence,[4,jt(t)];case 1:for(s=E.sent(),c=this.forwardInput(s),u=c.boxes,l=c.scores,d=u[0],h=l[0],f=1;f<u.length;f++)u[f].dispose(),l[f].dispose();return g=(m=Array).from,[4,h.data()];case 2:return p=g.apply(m,[E.sent()]),v=.5,b=Bx(d,p,a,v,o),_=s.getReshapedInputDimensions(0),y=s.inputSize,x=y/_.width,w=y/_.height,S=d.arraySync(),C=b.map(function(D){var R=[Math.max(0,S[D][0]),Math.min(1,S[D][2])].map(function(W){return W*w}),M=R[0],L=R[1],B=[Math.max(0,S[D][1]),Math.min(1,S[D][3])].map(function(W){return W*x}),O=B[0],z=B[1];return new ye(p[D],new eo(O,M,z-O,L-M),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),h.dispose(),[2,C]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Nx(t)},e.prototype.extractParams=function(t){return Ox(t)},e}(Be);var Fj=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(cl);var zx=.4,jx=[new Ct(.738768,.874946),new Ct(2.42204,2.65704),new Ct(4.30971,7.04493),new Ct(10.246,4.59428),new Ct(12.6868,11.8741)],Hx=[new Ct(1.603231,2.094468),new Ct(6.041143,7.080126),new Ct(2.882459,3.518061),new Ct(4.266906,5.178857),new Ct(9.041765,10.66308)],Ux=[117.001,114.697,97.404],Gx="tiny_yolov2_model",qx="tiny_yolov2_separable_conv_model";var ul=function(r){return typeof r=="number"};function Yx(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!ul(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(e){return e||{}}).every(function(e){return ul(e.x)&&ul(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(ul)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function uo(r){return K(function(){var e=se(r,Z(.10000000149011612));return ht(Vt(Gt(r,e)),e)})}function Ur(r,e){return K(function(){var t=Br(r,[[0,0],[1,1],[1,1],[0,0]]);return t=Le(t,e.conv.filters,[1,1],"valid"),t=Gt(t,e.bn.sub),t=se(t,e.bn.truediv),t=ht(t,e.conv.bias),uo(t)})}function Gr(r,e){return K(function(){var t=Br(r,[[0,0],[1,1],[1,1],[0,0]]);return t=_s(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=ht(t,e.bias),uo(t)})}function jI(r,e){var t=xi(r,e);function n(o,s){var c=qt(r(o)),u=qt(r(o));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:c,truediv:u}}function i(o,s,c){var u=t(o,s,3,c+"/conv"),l=n(s,c+"/bn");return{conv:u,bn:l}}var a=oo(r,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function Kx(r,e,t,n){var i=We(r),a=i.extractWeights,o=i.getRemainingWeights,s=[],c=jI(a,s),u=c.extractConvParams,l=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams,h;if(e.withSeparableConvs){var f=n[0],p=n[1],m=n[2],g=n[3],v=n[4],b=n[5],_=n[6],y=n[7],x=n[8],w=e.isFirstLayerConv2d?u(f,p,3,"conv0"):d(f,p,"conv0"),S=d(p,m,"conv1"),C=d(m,g,"conv2"),E=d(g,v,"conv3"),D=d(v,b,"conv4"),R=d(b,_,"conv5"),M=y?d(_,y,"conv6"):void 0,L=x?d(y,x,"conv7"):void 0,B=u(x||y||_,5*t,1,"conv8");h={conv0:w,conv1:S,conv2:C,conv3:E,conv4:D,conv5:R,conv6:M,conv7:L,conv8:B}}else{var f=n[0],p=n[1],m=n[2],g=n[3],v=n[4],b=n[5],_=n[6],y=n[7],x=n[8],w=l(f,p,"conv0"),S=l(p,m,"conv1"),C=l(m,g,"conv2"),E=l(g,v,"conv3"),D=l(v,b,"conv4"),R=l(b,_,"conv5"),M=l(_,y,"conv6"),L=l(y,x,"conv7"),B=u(x,5*t,1,"conv8");h={conv0:w,conv1:S,conv2:C,conv3:E,conv4:D,conv5:R,conv6:M,conv7:L,conv8:B}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:h,paramMappings:s}}function HI(r,e){var t=Ze(r,e);function n(s){var c=t(s+"/sub",1),u=t(s+"/truediv",1);return{sub:c,truediv:u}}function i(s){var c=t(s+"/filters",4),u=t(s+"/bias",1);return{filters:c,bias:u}}function a(s){var c=i(s+"/conv"),u=n(s+"/bn");return{conv:c,bn:u}}var o=so(t);return{extractConvParams:i,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function Xx(r,e){var t=[],n=HI(r,t),i=n.extractConvParams,a=n.extractConvWithBatchNormParams,o=n.extractSeparableConvParams,s;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:c>7?o("conv6"):void 0,conv7:c>8?o("conv7"):void 0,conv8:i("conv8")}}else s={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Ve(r,t),{params:s,paramMappings:t}}var ia=function(){function r(e){var t=e===void 0?{}:e,n=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}();var ll=function(r){tt(e,r);function e(t){var n=r.call(this,"TinyYolov2")||this;return Yx(t),n._config=t,n}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,n){var i=Ur(t,n.conv0);return i=ue(i,[2,2],[2,2],"same"),i=Ur(i,n.conv1),i=ue(i,[2,2],[2,2],"same"),i=Ur(i,n.conv2),i=ue(i,[2,2],[2,2],"same"),i=Ur(i,n.conv3),i=ue(i,[2,2],[2,2],"same"),i=Ur(i,n.conv4),i=ue(i,[2,2],[2,2],"same"),i=Ur(i,n.conv5),i=ue(i,[2,2],[1,1],"same"),i=Ur(i,n.conv6),i=Ur(i,n.conv7),Je(i,n.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,n){var i=this.config.isFirstLayerConv2d?uo(Je(t,n.conv0,"valid",!1)):Gr(t,n.conv0);return i=ue(i,[2,2],[2,2],"same"),i=Gr(i,n.conv1),i=ue(i,[2,2],[2,2],"same"),i=Gr(i,n.conv2),i=ue(i,[2,2],[2,2],"same"),i=Gr(i,n.conv3),i=ue(i,[2,2],[2,2],"same"),i=Gr(i,n.conv4),i=ue(i,[2,2],[2,2],"same"),i=Gr(i,n.conv5),i=ue(i,[2,2],[1,1],"same"),i=n.conv6?Gr(i,n.conv6):i,i=n.conv7?Gr(i,n.conv7):i,Je(i,n.conv8,"valid",!1)},e.prototype.forwardInput=function(t,n){var i=this,a=this.params;if(!a)throw new Error("TinyYolov2 - load model before inference");return K(function(){var o=t.toBatchTensor(n,!1).toFloat();return o=i.config.meanRgb?gr(o,i.config.meanRgb):o,o=o.div(Z(256)),i.config.withSeparableConvs?i.runMobilenet(o,a):i.runTinyYolov2(o,a)})},e.prototype.forward=function(t,n){return Q(this,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,jt(t)];case 1:return[4,i.apply(this,[a.sent(),n])];case 2:return[2,a.sent()]}})})},e.prototype.detect=function(t,n){return n===void 0&&(n={}),Q(this,void 0,void 0,function(){var i,a,o,s,c,u,l,d,h,f,p,m,g,v,b=this;return J(this,function(_){switch(_.label){case 0:return i=new ia(n),a=i.inputSize,o=i.scoreThreshold,[4,jt(t)];case 1:return s=_.sent(),[4,this.forwardInput(s,a)];case 2:return c=_.sent(),u=K(function(){return zt(c)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(u,s.getReshapedInputDimensions(0),o)];case 3:return d=_.sent(),c.dispose(),u.dispose(),h=d.map(function(y){return y.box}),f=d.map(function(y){return y.score}),p=d.map(function(y){return y.classScore}),m=d.map(function(y){return b.config.classes[y.label]}),g=jr(h.map(function(y){return y.rescale(a)}),f,this.config.iouThreshold,!0),v=g.map(function(y){return new Uu(f[y],p[y],m[y],h[y],l)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Xx(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=n?n.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return Kx(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,n,i){return Q(this,void 0,void 0,function(){var a,o,s,c,u,l,d,h,f,p,m,g,v,b,_,y,x,w,S,C,E,D,R,M,L,B,O,z,W,j=this;return J(this,function(G){switch(G.label){case 0:return a=n.width,o=n.height,s=Math.max(a,o),c=s/a,u=s/o,l=t.shape[1],d=this.config.anchors.length,h=K(function(){var X=t.reshape([l,l,d,j.boxEncodingSize]),et=X.slice([0,0,0,0],[l,l,d,4]),at=X.slice([0,0,0,4],[l,l,d,1]),lt=j.withClassScores?on(X.slice([0,0,0,5],[l,l,d,j.config.classes.length]),3):Z(0);return[et,at,lt]}),f=h[0],p=h[1],m=h[2],g=[],[4,p.array()];case 1:return v=G.sent(),[4,f.array()];case 2:b=G.sent(),_=0,G.label=3;case 3:if(!(_<l))return[3,12];y=0,G.label=4;case 4:if(!(y<l))return[3,11];x=0,G.label=5;case 5:return x<d?(w=Gu(v[_][y][x][0]),!i||w>i?(S=(y+Gu(b[_][y][x][0]))/l*c,C=(_+Gu(b[_][y][x][1]))/l*u,E=Math.exp(b[_][y][x][2])*this.config.anchors[x].x/l*c,D=Math.exp(b[_][y][x][3])*this.config.anchors[x].y/l*u,R=S-E/2,M=C-D/2,L={row:_,col:y,anchor:x},this.withClassScores?[4,this.extractPredictedClass(m,L)]:[3,7]):[3,9]):[3,10];case 6:return W=G.sent(),[3,8];case 7:W={classScore:1,label:0},G.label=8;case 8:B=W,O=B.classScore,z=B.label,g.push(Se({box:new ta(R,M,R+E,M+D),score:w,classScore:w*O,label:z},L)),G.label=9;case 9:return x++,[3,5];case 10:return y++,[3,4];case 11:return _++,[3,3];case 12:return f.dispose(),p.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,n){return Q(this,void 0,void 0,function(){var i,a,o,s;return J(this,function(c){switch(c.label){case 0:return i=n.row,a=n.col,o=n.anchor,[4,t.array()];case 1:return s=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,l){return s[i][a][o][l]}).map(function(u,l){return{classScore:u,label:l}}).reduce(function(u,l){return u.classScore>l.classScore?u:l})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Be);var Wf=function(r){tt(e,r);function e(t){t===void 0&&(t=!0);var n=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:zx,classes:["face"]},t?{anchors:Hx,meanRgb:Ux}:{anchors:jx,withClassScores:!0});return n=r.call(this,i)||this,n}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return Q(this,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return[4,this.detect(t,n)];case 1:return i=a.sent(),[2,i.map(function(o){return new ye(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?qx:Gx},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(ll);var $x=function(r){tt(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(ia);var vr=function(){function r(){}return r.prototype.then=function(e){return Q(this,void 0,void 0,function(){var t;return J(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return Q(this,void 0,void 0,function(){return J(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},r}();function aa(r,e,t,n,i){return i===void 0&&(i=function(a){var o=a.alignedRect;return o}),Q(this,void 0,void 0,function(){var a,o,s,c,u;return J(this,function(l){switch(l.label){case 0:return a=r.map(function(d){return il(d)?i(d):d.detection}),s=n,s?[3,5]:e instanceof Ut?[4,Ms(e,a)]:[3,2];case 1:return c=l.sent(),[3,4];case 2:return[4,Is(e,a)];case 3:c=l.sent(),l.label=4;case 4:s=c,l.label=5;case 5:return o=s,[4,t(o)];case 6:return u=l.sent(),o.forEach(function(d){return d instanceof Ut&&d.dispose()}),[2,u]}})})}function lo(r,e,t,n,i){return Q(this,void 0,void 0,function(){var a=this;return J(this,function(o){return[2,aa([r],e,function(s){return Q(a,void 0,void 0,function(){return J(this,function(c){return[2,t(s[0])]})})},n,i)]})})}function Qx(r){return K(function(){return Ue(zt(r,3).reverse(),3)})}var Ns=2,oa=12;function UI(r,e){var t=xi(r,e),n=ao(r,e);function i(u,l){var d=qt(r(u));return e.push({paramPath:l}),d}function a(u,l,d){d===void 0&&(d=!1);var h=t(u[0],u[1],3,l+"/conv1"),f=i(u[1],l+"/prelu1_alpha"),p=t(u[1],u[2],3,l+"/conv2"),m=i(u[2],l+"/prelu2_alpha"),g=t(u[2],u[3],d?2:3,l+"/conv3"),v=i(u[3],l+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function o(){var u=a([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Se(Se({},u),{conv4_1:l,conv4_2:d})}function s(){var u=a([3,28,48,64],"rnet",!0),l=n(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),h=n(128,2,"rnet/fc2_1"),f=n(128,4,"rnet/fc2_2");return Se(Se({},u),{fc1:l,prelu4_alpha:d,fc2_1:h,fc2_2:f})}function c(){var u=a([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),h=n(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),p=n(256,2,"onet/fc2_1"),m=n(256,4,"onet/fc2_2"),g=n(256,10,"onet/fc2_3");return Se(Se({},u),{conv4:l,prelu4_alpha:d,fc1:h,prelu5_alpha:f,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:o,extractRNetParams:s,extractONetParams:c}}function Jx(r){var e=We(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],a=UI(t,i),o=a.extractPNetParams,s=a.extractRNetParams,c=a.extractONetParams,u=o(),l=s(),d=c();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:u,rnet:l,onet:d},paramMappings:i}}function GI(r,e){var t=Ze(r,e);function n(l){var d=t(l+"/weights",4,l+"/filters"),h=t(l+"/bias",1);return{filters:d,bias:h}}function i(l){var d=t(l+"/weights",2),h=t(l+"/bias",1);return{weights:d,bias:h}}function a(l){return t(l,1)}function o(l){var d=n(l+"/conv1"),h=a(l+"/prelu1_alpha"),f=n(l+"/conv2"),p=a(l+"/prelu2_alpha"),m=n(l+"/conv3"),g=a(l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:f,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function s(){var l=o("pnet"),d=n("pnet/conv4_1"),h=n("pnet/conv4_2");return Se(Se({},l),{conv4_1:d,conv4_2:h})}function c(){var l=o("rnet"),d=i("rnet/fc1"),h=a("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),p=i("rnet/fc2_2");return Se(Se({},l),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:p})}function u(){var l=o("onet"),d=n("onet/conv4"),h=a("onet/prelu4_alpha"),f=i("onet/fc1"),p=a("onet/prelu5_alpha"),m=i("onet/fc2_1"),g=i("onet/fc2_2"),v=i("onet/fc2_3");return Se(Se({},l),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:s,extractRNetParams:c,extractONetParams:u}}function Zx(r){var e=[],t=GI(r,e),n=t.extractPNetParams,i=t.extractRNetParams,a=t.extractONetParams,o=n(),s=i(),c=a();return Ve(r,e),{params:{pnet:o,rnet:s,onet:c},paramMappings:e}}function Ls(r,e){var t=e[0],n=e[1];return{height:Math.floor(t*r),width:Math.floor(n*r)}}function t_(r,e,t){for(var n=t[0],i=t[1],a=oa/r,o=[],s=Math.min(n,i)*a,c=0;s>=12;)o.push(a*Math.pow(e,c)),s=s*e,c+=1;return o}var ho=function(r){tt(e,r);function e(t,n,i,a){return r.call(this,{left:t,top:n,right:i,bottom:a},!0)||this}return e}(Ge);function dl(r){return K(function(){return se(Gt(r,Z(127.5)),Z(.0078125))})}function qr(r,e){return K(function(){return ht(Vt(r),se(e,bs(Vt(bs(r)))))})}function fo(r,e,t){return t===void 0&&(t=!1),K(function(){var n=Je(r,e.conv1,"valid");return n=qr(n,e.prelu1_alpha),n=ue(n,t?[2,2]:[3,3],[2,2],"same"),n=Je(n,e.conv2,"valid"),n=qr(n,e.prelu2_alpha),n=t?n:ue(n,[3,3],[2,2],"valid"),n=Je(n,e.conv3,"valid"),n=qr(n,e.prelu3_alpha),n})}function e_(r,e){return K(function(){var t=fo(r,e,!0),n=Je(t,e.conv4_1,"valid"),i=Xe(Qi(n,3),3),a=on(Gt(n,i),3),o=Je(t,e.conv4_2,"valid");return{prob:a,regions:o}})}function qI(r,e){return K(function(){var t=Ls(e,r.shape.slice(1)),n=t.height,i=t.width,a=Cs.resizeBilinear(r,[n,i]),o=dl(a);return Pn(o,[0,2,1,3])})}function YI(r,e,t,n){for(var i=[],a=r.arraySync(),o=0;o<r.shape[0];o++)for(var s=0;s<r.shape[1];s++)a[o][s]>=n&&i.push(new Ct(s,o));var c=i.map(function(u){var l=new ta(Math.round((u.y*Ns+1)/t),Math.round((u.x*Ns+1)/t),Math.round((u.y*Ns+oa)/t),Math.round((u.x*Ns+oa)/t)),d=a[u.y][u.x],h=e.arraySync(),f=new ho(h[u.y][u.x][0],h[u.y][u.x][1],h[u.y][u.x][2],h[u.y][u.x][3]);return{cell:l,score:d,region:f}});return c}function n_(r,e,t,n,i){i.stage1=[];var a=e.map(function(h){return K(function(){var f={scale:h},p=qI(r,h),m=Date.now(),g=e_(p,n),v=g.prob,b=g.regions;f.pnet=Date.now()-m;var _=zt(zt(v,3)[1])[0],y=zt(b)[0];return{scoresTensor:_,regionsTensor:y,scale:h,statsForScale:f}})}),o=a.map(function(h){var f=h.scoresTensor,p=h.regionsTensor,m=h.scale,g=h.statsForScale,v=YI(f,p,m,t);if(f.dispose(),p.dispose(),!v.length)return i.stage1.push(g),[];var b=Date.now(),_=jr(v.map(function(y){return y.cell}),v.map(function(y){return y.score}),.5);return g.nms=Date.now()-b,g.numBoxes=_.length,i.stage1.push(g),_.map(function(y){return v[y]})}),s=o.reduce(function(h,f){return h.concat(f)},[]),c=[],u=[];if(s.length>0){var l=Date.now(),d=jr(s.map(function(h){return h.cell}),s.map(function(h){return h.score}),.7);i.stage1_nms=Date.now()-l,u=d.map(function(h){return s[h].score}),c=d.map(function(h){return s[h]}).map(function(h){var f=h.cell,p=h.region;return new ta(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:c,scores:u}}function hl(r,e,t){var n=t.width,i=t.height;return Q(this,void 0,void 0,function(){var a,o,s,c=this;return J(this,function(u){switch(u.label){case 0:return a=qe(r),[4,Promise.all(e.map(function(l){return Q(c,void 0,void 0,function(){var d,h,f,p,m,g,v,b;return J(this,function(_){return d=l.padAtBorders(r.height,r.width),h=d.y,f=d.ey,p=d.x,m=d.ex,g=p-1,v=h-1,b=a.getImageData(g,v,m-g,f-v),[2,Pt.isNodejs()?io(b):createImageBitmap(b)]})})}))];case 1:return o=u.sent(),s=[],o.forEach(function(l){var d=ea({width:n,height:i}),h=qe(d);h.drawImage(l,0,0,n,i);for(var f=h.getImageData(0,0,n,i).data,p=[],m=0;m<f.length;m+=4)p.push(f[m+2]),p.push(f[m+1]),p.push(f[m]);s.push(p)}),[2,s.map(function(l){var d=K(function(){var h=Pn(Ae(l,[1,n,i,3]),[0,2,1,3]).toFloat();return dl(h)});return d})]}})})}function r_(r,e){return K(function(){var t=fo(r,e),n=an(t,[t.shape[0],e.fc1.weights.shape[0]]),i=mn(n,e.fc1),a=qr(i,e.prelu4_alpha),o=mn(a,e.fc2_1),s=Xe(Qi(o,1),1),c=on(Gt(o,s),1),u=mn(a,e.fc2_2),l=zt(c,1)[1];return{scores:l,regions:u}})}function i_(r,e,t,n,i){return Q(this,void 0,void 0,function(){var a,o,s,c,u,l,d,h,f,p,m,g,v,b;return J(this,function(_){switch(_.label){case 0:return a=Date.now(),[4,hl(r,e,{width:24,height:24})];case 1:return o=_.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map(function(y){var x=r_(y,n);return y.dispose(),x}),i.stage2_rnet=Date.now()-a,c=s.length>1?Zt(s.map(function(y){return y.scores})):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[_.sent()]),c.dispose(),h=u.map(function(y,x){return{score:y,idx:x}}).filter(function(y){return y.score>t}).map(function(y){var x=y.idx;return x}),f=h.map(function(y){return e[y]}),p=h.map(function(y){return u[y]}),m=[],g=[],f.length>0&&(a=Date.now(),v=jr(f,p,.7),i.stage2_nms=Date.now()-a,b=v.map(function(y){var x=s[h[y]].regions.arraySync();return new ho(x[0][0],x[0][1],x[0][2],x[0][3])}),g=v.map(function(y){return p[y]}),m=v.map(function(y,x){return f[y].calibrate(b[x])})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function a_(r,e){return K(function(){var t=fo(r,e);t=ue(t,[2,2],[2,2],"same"),t=Je(t,e.conv4,"valid"),t=qr(t,e.prelu4_alpha);var n=an(t,[t.shape[0],e.fc1.weights.shape[0]]),i=mn(n,e.fc1),a=qr(i,e.prelu5_alpha),o=mn(a,e.fc2_1),s=Xe(Qi(o,1),1),c=on(Gt(o,s),1),u=mn(a,e.fc2_2),l=mn(a,e.fc2_3),d=zt(c,1)[1];return{scores:d,regions:u,points:l}})}function o_(r,e,t,n,i){return Q(this,void 0,void 0,function(){var a,o,s,c,u,l,d,h,f,p,m,g,v,b,_;return J(this,function(y){switch(y.label){case 0:return a=Date.now(),[4,hl(r,e,{width:48,height:48})];case 1:return o=y.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map(function(x){var w=a_(x,n);return x.dispose(),w}),i.stage3_onet=Date.now()-a,c=s.length>1?Zt(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[y.sent()]),c.dispose(),h=u.map(function(x,w){return{score:x,idx:w}}).filter(function(x){return x.score>t}).map(function(x){var w=x.idx;return w}),f=h.map(function(x){var w=s[x].regions.arraySync();return new ho(w[0][0],w[0][1],w[0][2],w[0][3])}),p=h.map(function(x,w){return e[x].calibrate(f[w])}),m=h.map(function(x){return u[x]}),g=[],v=[],b=[],p.length>0&&(a=Date.now(),_=jr(p,m,.7,!1),i.stage3_nms=Date.now()-a,g=_.map(function(x){return p[x]}),v=_.map(function(x){return m[x]}),b=_.map(function(x,w){return Array(5).fill(0).map(function(S,C){var E=s[x].points.arraySync();return new Ct(E[0][C]*(g[w].width+1)+g[w].left,E[0][C+5]*(g[w].height+1)+g[w].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:g,scores:v,points:b}]}})})}var zf=function(r){tt(e,r);function e(){return r.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return Q(this,void 0,void 0,function(){return J(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return Q(this,void 0,void 0,function(){return J(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,n){return n===void 0&&(n={}),Q(this,void 0,void 0,function(){var i,a,o,s,c,u,l,d,h,f,p,m,g,v,b,_,y,x,w,S,C;return J(this,function(E){switch(E.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(a=t.canvases[0],!a)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},s=Date.now(),c=K(function(){return Qx(Xe(Za.fromPixels(a)).toFloat())}),u=function(D){return c.dispose(),o.total=Date.now()-s,D},l=c.shape.slice(1),d=l[0],h=l[1],f=new Os(n),p=f.minFaceSize,m=f.scaleFactor,g=f.maxNumScales,v=f.scoreThresholds,b=f.scaleSteps,_=(b||t_(p,m,[d,h])).filter(function(D){var R=Ls(D,[d,h]);return Math.min(R.width,R.height)>oa}).slice(0,g),o.scales=_,o.pyramid=_.map(function(D){return Ls(D,[d,h])}),y=Date.now(),[4,n_(c,_,v[0],i.pnet,o)];case 1:return x=E.sent(),o.total_stage1=Date.now()-y,x.boxes.length?(o.stage2_numInputBoxes=x.boxes.length,y=Date.now(),[4,i_(a,x.boxes,v[1],i.rnet,o)]):[2,u({results:[],stats:o})];case 2:return w=E.sent(),o.total_stage2=Date.now()-y,w.boxes.length?(o.stage3_numInputBoxes=w.boxes.length,y=Date.now(),[4,o_(a,w.boxes,v[2],i.onet,o)]):[2,u({results:[],stats:o})];case 3:return S=E.sent(),o.total_stage3=Date.now()-y,C=S.boxes.map(function(D,R){return co(no({},new ye(S.scores[R],new eo(D.left/h,D.top/d,D.width/h,D.height/d),{height:d,width:h})),new ox(S.points[R].map(function(M){return M.sub(new Ct(D.left,D.top)).div(new Ct(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,u({results:C,stats:o})]}})})},e.prototype.forward=function(t,n){return n===void 0&&(n={}),Q(this,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,jt(t)];case 1:return[4,i.apply(this,[a.sent(),n])];case 2:return[2,a.sent().results]}})})},e.prototype.forwardWithStats=function(t,n){return n===void 0&&(n={}),Q(this,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return i=this.forwardInput,[4,jt(t)];case 1:return[2,i.apply(this,[a.sent(),n])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Zx(t)},e.prototype.extractParams=function(t){return Jx(t)},e}(Be);var s_=.4,c_=[new Ct(1.603231,2.094468),new Ct(6.041143,7.080126),new Ct(2.882459,3.518061),new Ct(4.266906,5.178857),new Ct(9.041765,10.66308)],u_=[117.001,114.697,97.404];var jf=function(r){tt(e,r);function e(){var t=this,n={withSeparableConvs:!0,iouThreshold:s_,classes:["face"],anchors:c_,meanRgb:u_,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,n)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return Q(this,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return[4,this.detect(t,n)];case 1:return i=a.sent(),[2,i.map(function(o){return new ye(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e}(ll);var Me={ssdMobilenetv1:new cl,tinyFaceDetector:new jf,tinyYolov2:new Wf,mtcnn:new zf,faceLandmark68Net:new ol,faceLandmark68TinyNet:new Mx,faceRecognitionNet:new Nf,faceExpressionNet:new yx,ageGenderNet:new kx};var l_=function(r){tt(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=i,a}return e}(vr);var Bs=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i=this;return J(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,aa(t,this.input,function(o){return Q(i,void 0,void 0,function(){return J(this,function(s){switch(s.label){case 0:return[4,Promise.all(o.map(function(c){return Me.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,t.map(function(o,s){return Tf(o,n[s])})]}})})},e.prototype.withAgeAndGender=function(){return new Ws(this,this.input)},e}(l_);var Vs=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,lo(t,this.input,function(a){return Me.faceExpressionNet.predictExpressions(a)},this.extractedFaces)]:[2];case 2:return n=i.sent(),[2,Tf(t,n)]}})})},e.prototype.withAgeAndGender=function(){return new zs(this,this.input)},e}(l_);var po=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new go(this,this.input)},e.prototype.withFaceDescriptors=function(){return new bo(this,this.input)},e}(Bs);var mo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new vo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new yo(this,this.input)},e}(Vs);var d_=function(r){tt(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.extractedFaces=i,a}return e}(vr);var Ws=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i=this;return J(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,aa(t,this.input,function(o){return Q(i,void 0,void 0,function(){return J(this,function(s){switch(s.label){case 0:return[4,Promise.all(o.map(function(c){return Me.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=a.sent(),[2,t.map(function(o,s){var c=n[s],u=c.age,l=c.gender,d=c.genderProbability;return Bf(Vf(o,l,d),u)})]}})})},e.prototype.withFaceExpressions=function(){return new Bs(this,this.input)},e}(d_);var zs=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i,a,o;return J(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,lo(t,this.input,function(c){return Me.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return n=s.sent(),i=n.age,a=n.gender,o=n.genderProbability,[2,Bf(Vf(t,a,o),i)]}})})},e.prototype.withFaceExpressions=function(){return new Vs(this,this.input)},e}(d_);var go=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new po(this,this.input)},e.prototype.withFaceDescriptors=function(){return new bo(this,this.input)},e}(Ws);var vo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new mo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new yo(this,this.input)},e}(zs);var h_=function(r){tt(e,r);function e(t,n){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i}return e}(vr);var bo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,aa(t,this.input,function(a){return Promise.all(a.map(function(o){return Me.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=i.sent(),[2,n.map(function(a,o){return Lf(t[o],a)})]}})})},e.prototype.withFaceExpressions=function(){return new po(this,this.input)},e.prototype.withAgeAndGender=function(){return new go(this,this.input)},e}(h_);var yo=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,lo(t,this.input,function(a){return Me.faceRecognitionNet.computeFaceDescriptor(a)},null,function(a){return a.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=i.sent(),[2,Lf(t,n)]}})})},e.prototype.withFaceExpressions=function(){return new mo(this,this.input)},e.prototype.withAgeAndGender=function(){return new vo(this,this.input)},e}(h_);var f_=function(r){tt(e,r);function e(t,n,i){var a=r.call(this)||this;return a.parentTask=t,a.input=n,a.useTinyLandmarkNet=i,a}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Me.faceLandmark68TinyNet:Me.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(vr);var p_=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i,a,o,s=this;return J(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),n=t.map(function(u){return u.detection}),this.input instanceof Ut?[4,Ms(this.input,n)]:[3,3];case 2:return a=c.sent(),[3,5];case 3:return[4,Is(this.input,n)];case 4:a=c.sent(),c.label=5;case 5:return i=a,[4,Promise.all(i.map(function(u){return s.landmarkNet.detectLandmarks(u)}))];case 6:return o=c.sent(),i.forEach(function(u){return u instanceof Ut&&u.dispose()}),[2,t.map(function(u,l){return co(u,o[l])})]}})})},e.prototype.withFaceExpressions=function(){return new po(this,this.input)},e.prototype.withAgeAndGender=function(){return new go(this,this.input)},e.prototype.withFaceDescriptors=function(){return new bo(this,this.input)},e}(f_);var m_=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i,a,o;return J(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(n=t.detection,this.input instanceof Ut?[4,Ms(this.input,[n])]:[3,3]):[2];case 2:return a=s.sent(),[3,5];case 3:return[4,Is(this.input,[n])];case 4:a=s.sent(),s.label=5;case 5:return i=a,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return o=s.sent(),i.forEach(function(c){return c instanceof Ut&&c.dispose()}),[2,co(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new mo(this,this.input)},e.prototype.withAgeAndGender=function(){return new vo(this,this.input)},e.prototype.withFaceDescriptor=function(){return new yo(this,this.input)},e}(f_);var g_=function(r){tt(e,r);function e(t,n){n===void 0&&(n=new _i);var i=r.call(this)||this;return i.input=t,i.options=n,i}return e}(vr);var Hf=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n,i,a;return J(this,function(o){switch(o.label){case 0:return t=this,n=t.input,i=t.options,i instanceof Os?[4,Me.mtcnn.forward(n,i)]:[3,2];case 1:return[2,o.sent().map(function(s){return s.detection})];case 2:if(a=i instanceof $x?function(s){return Me.tinyFaceDetector.locateFaces(s,i)}:i instanceof _i?function(s){return Me.ssdMobilenetv1.locateFaces(s,i)}:i instanceof ia?function(s){return Me.tinyYolov2.locateFaces(s,i)}:null,!a)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,a(n)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(n){return Q(t,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,n(i.map(function(o){return no({},o)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new p_(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new Bs(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new Ws(this.runAndExtendWithFaceDetections(),this.input)},e}(g_);var KI=function(r){tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return Q(this,void 0,void 0,function(){var t,n;return J(this,function(i){switch(i.label){case 0:return[4,new Hf(this.input,this.options)];case 1:return t=i.sent(),n=t[0],t.forEach(function(a){a.score>n.score&&(n=a)}),[2,n]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(n){return Q(t,void 0,void 0,function(){var i;return J(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return i=a.sent(),[2,n(i?no({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new m_(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new Vs(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new zs(this.runAndExtendWithFaceDetection(),this.input)},e}(g_);function Uf(r,e){return e===void 0&&(e=new _i),new Hf(r,e)}function v_(r,e){if(r.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),n=Array.from(e);return Math.sqrt(t.map(function(i,a){return i-n[a]}).reduce(function(i,a){return i+Math.pow(a,2)},0))}var CG=function(){function r(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,a=function(){return"person "+i++};this._labeledDescriptors=n.map(function(o){if(o instanceof ks)return o;if(o instanceof Float32Array)return new ks(a(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new ks(a(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(e,t){return t.map(function(n){return v_(n,e)}).reduce(function(n,i){return n+i},0)/(t.length||1)},r.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var i=n.descriptors,a=n.label;return new xf(a,t.computeMeanDistance(e,i))}).reduce(function(n,i){return n.distance<i.distance?n:i})},r.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new xf("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},r.fromJSON=function(e){var t=e.labeledDescriptors.map(function(n){return ks.fromJSON(n)});return new r(t,e.distanceThreshold)},r}();var $I=["fileInput"];function QI(r,e){r&1&&(I(0,"div",43)(1,"div",44),H(2,"Checking Human"),T()())}function JI(r,e){r&1&&(I(0,"div",45),Ir(),I(1,"svg",46),$(2,"path",47)(3,"polyline",48),T(),H(4,"Verified humain photo"),T())}function ZI(r,e){r&1&&(I(0,"div",49),H(1," Not verified as humain "),T())}var b_=(()=>{let e=class e{constructor(n){this.userService=n,this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1,this.user={},this.uploadedImageUrl="",this.modelUrl="https://justadudewhohacks.github.io/face-api.js/models/ssd_mobilenetv1_model-weights_manifest.json"}ngOnInit(){this.getUserProfile()}getUserProfile(){return en(this,null,function*(){let n=yield localStorage.getItem("user");if(n){let a=JSON.parse(n).email;this.userService.getUserByEmail(a).subscribe(o=>{this.user=o})}})}updateProfileImage(){return en(this,null,function*(){yield this.userService.uploadProfileImage(this.user.email,this.uploadedImageUrl).subscribe(()=>{this.user.image=this.uploadedImageUrl,this.uploadedImageUrl="",this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1},n=>{})})}onFileSelected(n){return en(this,null,function*(){let i=n.target.files[0];if(i){let a=new FormData;a.append("image",i),this.userService.uploadImage(a).subscribe(o=>en(this,null,function*(){this.uploadedImageUrl=o.url,this.displayStatusImage=!0,yield this.detectFaces(o.url)}),o=>{})}})}detectFaces(n){return en(this,null,function*(){yield Me.ssdMobilenetv1.loadFromUri(this.modelUrl);let i=yield dx(n),a=yield Uf(i);this.displayStatusImage=!1,a.length>0?(this.verifiedImageHumain=!0,this.NotVerifedHumain=!1):(this.NotVerifedHumain=!0,this.verifiedImageHumain=!1)})}};e.\u0275fac=function(i){return new(i||e)(rt(ai))},e.\u0275cmp=Et({type:e,selectors:[["app-profile"]],viewQuery:function(i,a){if(i&1&&Pe($I,5),i&2){let o;ke(o=De())&&(a.fileInput=o.first)}},decls:71,vars:16,consts:[[1,"h-100","gradient-custom-2"],[1,"container","py-5","h-100"],[1,"row","d-flex","justify-content-center","align-items-center","h-100"],[1,"col","col-lg-9","col-xl-7"],[1,"card"],[1,"rounded-top","text-white","d-flex","flex-row",2,"background-color","#000","height","200px"],[1,"ms-4","mt-5","d-flex","flex-column",2,"width","150px","height","150px"],["alt","Generic placeholder image",1,"img-fluid","img-thumbnail","mt-4","mb-2",2,"width","150px","height","150px","object-fit","cover","z-index","1",3,"src"],["type","button","data-mdb-button-init","","data-mdb-ripple-init","","data-mdb-ripple-color","dark","data-toggle","modal","data-target","#exampleModal",1,"btn","btn-outline-dark",2,"z-index","1"],[1,"ms-3",2,"margin-top","130px"],[1,"p-4","text-black",2,"background-color","#f8f9fa"],[1,"d-flex","justify-content-end","text-center","py-1"],[1,"mb-1","h5"],[1,"small","text-muted","mb-0"],[1,"px-3"],[1,"card-body","p-4","text-black"],[1,"mb-5"],[1,"lead","fw-normal","mb-1"],[1,"p-4",2,"margin-bottom","10px"],[1,"font-italic","mb-1"],[1,"font-italic","mb-0"],["id","exampleModal","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"flex","justify-center","h-screen","items-center","px-3"],[1,"rounded-lg","shadow-xl","bg-gray-50","md:w-1/2","w-[360px]"],[1,"m-4"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","cursor-pointer","flex-col","w-full","h-32","border-2","rounded-md","border-dashed","hover:bg-gray-100","hover:border-gray-300"],[1,"flex","flex-col","items-center","justify-center","pt-7"],["width","370","height","320",3,"src"],["type","file",1,"opacity-0",3,"change"],["fileInput",""],["class","progress",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["data-dismiss","modal","type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"alert","alert-success"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-check-circle"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["role","alert",1,"alert","alert-danger"]],template:function(i,a){i&1&&(I(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),$(7,"img",7),I(8,"button",8),H(9," Upload image "),T()(),I(10,"div",9)(11,"h5"),H(12),T(),I(13,"p"),H(14),T()()(),I(15,"div",10)(16,"div",11)(17,"div")(18,"p",12),H(19,"N/A"),T(),I(20,"p",13),H(21,"Projects"),T()(),I(22,"div",14)(23,"p",12),H(24,"N/A"),T(),I(25,"p",13),H(26,"Tasks"),T()()()(),I(27,"div",15)(28,"div",16)(29,"p",17),H(30,"Personal Information"),T(),I(31,"div",18)(32,"p",19),H(33),T(),I(34,"p",19),H(35),T(),I(36,"p",20),H(37),T(),I(38,"p",19),H(39),T(),I(40,"p",19),H(41),T(),I(42,"p",19),H(43),T(),I(44,"p",19),H(45),T(),I(46,"div",21)(47,"div",22)(48,"div",23)(49,"div",24)(50,"button",25)(51,"span",26),H(52,"\xD7"),T()()(),I(53,"div",27)(54,"div",28)(55,"div",29)(56,"div",30)(57,"div",31)(58,"label",32)(59,"div",33),$(60,"img",34),T(),I(61,"input",35,36),mt("change",function(s){return a.onFileSelected(s)}),T()(),Lt(63,QI,3,0,"div",37)(64,JI,5,0,"div",38),T(),Lt(65,ZI,2,0,"div",39),T()()()(),I(66,"div",40)(67,"button",41),H(68,"Close"),T(),I(69,"button",42),mt("click",function(){return a.updateProfileImage()}),H(70,"Update image"),T()()()()()()()()()()()()()),i&2&&(q(7),it("src",a.user.image!==""?a.user.image:"../assets/images/profile.jpg",wd),q(5),Dg("",a.user.firstname," ",a.user.lastname,""),q(2),oe(a.user.job),q(19),me("Firstname: ",a.user.firstname,""),q(2),me("Lastname: ",a.user.lastname,""),q(2),me("Email: ",a.user.email,""),q(2),me("Phone: ",a.user.number,""),q(2),me("Address: ",a.user.address,""),q(2),me("Age: ",a.user.number,""),q(2),me("Degree: ",a.user.degree,""),q(15),it("src",a.uploadedImageUrl||"https://cdn.pixabay.com/photo/2017/02/07/02/16/cloud-2044823_960_720.png",wd),q(3),it("ngIf",a.displayStatusImage),q(),it("ngIf",a.verifiedImageHumain),q(),it("ngIf",a.NotVerifedHumain),q(4),it("disabled",!a.verifiedImageHumain))},dependencies:[un],styles:[".gradient-custom-2[_ngcontent-%COMP%]{background:#fbc2eb;background:-webkit-linear-gradient(to right,rgba(251,194,235,1),rgba(166,193,238,1));background:linear-gradient(to right,#fbc2eb,#a6c1ee)}"]});let r=e;return r})();function tM(r,e){if(r&1&&(I(0,"div",15),H(1),T()),r&2){let t=ft();q(),oe(t.errorMessage)}}var y_=(()=>{let e=class e{constructor(n,i,a,o){this.authService=n,this.encryptionService=i,this.router=a,this.userService=o,this.authResponse={},this.status="",this.formRequest=new Aa({code:new Oi("",[Pi.required])})}ngOnInit(){return en(this,null,function*(){let n=yield localStorage.getItem("code");if(n){let i=JSON.parse(n);this.method=i.method,this.email=i.email}yield this.sendCode()})}timer(){let i=eg(0,1e3).pipe(Fe(a=>120-a),dg(a=>a>=0));this.countdown=i.pipe(Fe(a=>{let o=Math.floor(a/60),s=a%60;return`${this.pad(o)}:${this.pad(s)}`}))}pad(n){return n<10?`0${n}`:`${n}`}sendVerificationCode(n){this.method=="sms"&&this.authService.sendVerificationCode(n).subscribe(i=>{},i=>{}),this.method=="mail"&&this.authService.sendVerificationCodeMail(n).subscribe(i=>{},i=>{})}sendCode(){return en(this,null,function*(){this.timer(),this.sendVerificationCode(this.email)})}resend(){this.sendCode()}verify(){this.formRequest.valid&&this.authService.verifyCode(this.formRequest.value.code.toString(),this.email).subscribe({next:n=>{this.authResponse=n,localStorage.setItem("token",n.access_token),this.userService.getUser(this.email).subscribe({next:i=>{let a={firstname:i.firstname,lastname:i.lastname,email:i.email},o=this.encryptionService.encrypt(JSON.stringify(i.authorities),"2f7");localStorage.setItem("authorities",o),localStorage.setItem("user",JSON.stringify(a)),this.router.navigate(["/home"])},error:i=>{}})},error:n=>{this.errorMessage="Invalid code"}})}isValidCode(){let n=this.formRequest.value.code;return n&&n.toString().length===6}};e.\u0275fac=function(i){return new(i||e)(rt(Fa),rt(ii),rt(ln),rt(ai))},e.\u0275cmp=Et({type:e,selectors:[["app-sendcode"]],decls:26,vars:7,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-settings","auth-icon"],[3,"formGroup","ngSubmit"],[3,"click"],[1,"input-group","mb-3"],["type","number","placeholder","code","formControlName","code","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2",3,"disabled"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"]],template:function(i,a){i&1&&(I(0,"div",0)(1,"div",1)(2,"div",2),$(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),T(),I(7,"div",5)(8,"div",6)(9,"div",7),$(10,"i",8),T(),I(11,"form",9),mt("ngSubmit",function(){return a.verify()}),I(12,"h3",7),H(13,"We sent you a verification code"),T(),I(14,"h5",7),H(15),I(16,"a",10),mt("click",function(){return a.resend()}),H(17,"Resend?"),T()(),I(18,"p"),H(19),Rg(20,"async"),T(),I(21,"div",11),$(22,"input",12),T(),I(23,"button",13),H(24,"Verify"),T(),Lt(25,tM,2,1,"div",14),T()()()()()),i&2&&(q(11),it("formGroup",a.formRequest),q(4),me("Please verifiy your ",a.method,"."),q(4),me("Time left: ",Tg(20,5,a.countdown),""),q(4),it("disabled",!a.isValidCode()),q(2),it("ngIf",a.errorMessage))},dependencies:[un,cr,Rn,qg,dn,sr,ci,oi,si,Ng]});let r=e;return r})();function Us(r){return r+.5|0}var wi=(r,e,t)=>Math.max(Math.min(r,t),e);function js(r){return wi(Us(r*2.55),0,255)}function Ci(r){return wi(Us(r*255),0,255)}function Yr(r){return wi(Us(r/2.55)/100,0,1)}function x_(r){return wi(Us(r*100),0,100)}var Ln={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},qf=[..."0123456789ABCDEF"],eM=r=>qf[r&15],nM=r=>qf[(r&240)>>4]+qf[r&15],fl=r=>(r&240)>>4===(r&15),rM=r=>fl(r.r)&&fl(r.g)&&fl(r.b)&&fl(r.a);function iM(r){var e=r.length,t;return r[0]==="#"&&(e===4||e===5?t={r:255&Ln[r[1]]*17,g:255&Ln[r[2]]*17,b:255&Ln[r[3]]*17,a:e===5?Ln[r[4]]*17:255}:(e===7||e===9)&&(t={r:Ln[r[1]]<<4|Ln[r[2]],g:Ln[r[3]]<<4|Ln[r[4]],b:Ln[r[5]]<<4|Ln[r[6]],a:e===9?Ln[r[7]]<<4|Ln[r[8]]:255})),t}var aM=(r,e)=>r<255?e(r):"";function oM(r){var e=rM(r)?eM:nM;return r?"#"+e(r.r)+e(r.g)+e(r.b)+aM(r.a,e):void 0}var sM=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function S_(r,e,t){let n=e*Math.min(t,1-t),i=(a,o=(a+r/30)%12)=>t-n*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function cM(r,e,t){let n=(i,a=(i+r/60)%6)=>t-t*e*Math.max(Math.min(a,4-a,1),0);return[n(5),n(3),n(1)]}function uM(r,e,t){let n=S_(r,1,.5),i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)n[i]*=1-e-t,n[i]+=e;return n}function lM(r,e,t,n,i){return r===i?(e-t)/n+(e<t?6:0):e===i?(t-r)/n+2:(r-e)/n+4}function Yf(r){let t=r.r/255,n=r.g/255,i=r.b/255,a=Math.max(t,n,i),o=Math.min(t,n,i),s=(a+o)/2,c,u,l;return a!==o&&(l=a-o,u=s>.5?l/(2-a-o):l/(a+o),c=lM(t,n,i,l,a),c=c*60+.5),[c|0,u||0,s]}function Kf(r,e,t,n){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,t,n)).map(Ci)}function Xf(r,e,t){return Kf(S_,r,e,t)}function dM(r,e,t){return Kf(uM,r,e,t)}function hM(r,e,t){return Kf(cM,r,e,t)}function E_(r){return(r%360+360)%360}function fM(r){let e=sM.exec(r),t=255,n;if(!e)return;e[5]!==n&&(t=e[6]?js(+e[5]):Ci(+e[5]));let i=E_(+e[2]),a=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?n=dM(i,a,o):e[1]==="hsv"?n=hM(i,a,o):n=Xf(i,a,o),{r:n[0],g:n[1],b:n[2],a:t}}function pM(r,e){var t=Yf(r);t[0]=E_(t[0]+e),t=Xf(t),r.r=t[0],r.g=t[1],r.b=t[2]}function mM(r){if(!r)return;let e=Yf(r),t=e[0],n=x_(e[1]),i=x_(e[2]);return r.a<255?`hsla(${t}, ${n}%, ${i}%, ${Yr(r.a)})`:`hsl(${t}, ${n}%, ${i}%)`}var __={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},w_={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function gM(){let r={},e=Object.keys(w_),t=Object.keys(__),n,i,a,o,s;for(n=0;n<e.length;n++){for(o=s=e[n],i=0;i<t.length;i++)a=t[i],s=s.replace(a,__[a]);a=parseInt(w_[o],16),r[s]=[a>>16&255,a>>8&255,a&255]}return r}var pl;function vM(r){pl||(pl=gM(),pl.transparent=[0,0,0,0]);let e=pl[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}var bM=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function yM(r){let e=bM.exec(r),t=255,n,i,a;if(e){if(e[7]!==n){let o=+e[7];t=e[8]?js(o):wi(o*255,0,255)}return n=+e[1],i=+e[3],a=+e[5],n=255&(e[2]?js(n):wi(n,0,255)),i=255&(e[4]?js(i):wi(i,0,255)),a=255&(e[6]?js(a):wi(a,0,255)),{r:n,g:i,b:a,a:t}}}function xM(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${Yr(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}var Gf=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,xo=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function _M(r,e,t){let n=xo(Yr(r.r)),i=xo(Yr(r.g)),a=xo(Yr(r.b));return{r:Ci(Gf(n+t*(xo(Yr(e.r))-n))),g:Ci(Gf(i+t*(xo(Yr(e.g))-i))),b:Ci(Gf(a+t*(xo(Yr(e.b))-a))),a:r.a+t*(e.a-r.a)}}function ml(r,e,t){if(r){let n=Yf(r);n[e]=Math.max(0,Math.min(n[e]+n[e]*t,e===0?360:1)),n=Xf(n),r.r=n[0],r.g=n[1],r.b=n[2]}}function k_(r,e){return r&&Object.assign(e||{},r)}function C_(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=Ci(r[3]))):(e=k_(r,{r:0,g:0,b:0,a:1}),e.a=Ci(e.a)),e}function wM(r){return r.charAt(0)==="r"?yM(r):fM(r)}var Hs=class r{constructor(e){if(e instanceof r)return e;let t=typeof e,n;t==="object"?n=C_(e):t==="string"&&(n=iM(e)||vM(e)||wM(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=k_(this._rgb);return e&&(e.a=Yr(e.a)),e}set rgb(e){this._rgb=C_(e)}rgbString(){return this._valid?xM(this._rgb):void 0}hexString(){return this._valid?oM(this._rgb):void 0}hslString(){return this._valid?mM(this._rgb):void 0}mix(e,t){if(e){let n=this.rgb,i=e.rgb,a,o=t===a?.5:t,s=2*o-1,c=n.a-i.a,u=((s*c===-1?s:(s+c)/(1+s*c))+1)/2;a=1-u,n.r=255&u*n.r+a*i.r+.5,n.g=255&u*n.g+a*i.g+.5,n.b=255&u*n.b+a*i.b+.5,n.a=o*n.a+(1-o)*i.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=_M(this._rgb,e._rgb,t)),this}clone(){return new r(this.rgb)}alpha(e){return this._rgb.a=Ci(e),this}clearer(e){let t=this._rgb;return t.a*=1-e,this}greyscale(){let e=this._rgb,t=Us(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){let t=this._rgb;return t.a*=1+e,this}negate(){let e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return ml(this._rgb,2,e),this}darken(e){return ml(this._rgb,2,-e),this}saturate(e){return ml(this._rgb,1,e),this}desaturate(e){return ml(this._rgb,1,-e),this}rotate(e){return pM(this._rgb,e),this}};function xr(){}var L_=(()=>{let r=0;return()=>r++})();function Ft(r){return r===null||typeof r>"u"}function $t(r){if(Array.isArray&&Array.isArray(r))return!0;let e=Object.prototype.toString.call(r);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function kt(r){return r!==null&&Object.prototype.toString.call(r)==="[object Object]"}function le(r){return(typeof r=="number"||r instanceof Number)&&isFinite(+r)}function vn(r,e){return le(r)?r:e}function _t(r,e){return typeof r>"u"?e:r}var B_=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100:+r/e,Zf=(r,e)=>typeof r=="string"&&r.endsWith("%")?parseFloat(r)/100*e:+r;function Yt(r,e,t){if(r&&typeof r.call=="function")return r.apply(t,e)}function Wt(r,e,t,n){let i,a,o;if($t(r))if(a=r.length,n)for(i=a-1;i>=0;i--)e.call(t,r[i],i);else for(i=0;i<a;i++)e.call(t,r[i],i);else if(kt(r))for(o=Object.keys(r),a=o.length,i=0;i<a;i++)e.call(t,r[o[i]],o[i])}function Ys(r,e){let t,n,i,a;if(!r||!e||r.length!==e.length)return!1;for(t=0,n=r.length;t<n;++t)if(i=r[t],a=e[t],i.datasetIndex!==a.datasetIndex||i.index!==a.index)return!1;return!0}function yl(r){if($t(r))return r.map(yl);if(kt(r)){let e=Object.create(null),t=Object.keys(r),n=t.length,i=0;for(;i<n;++i)e[t[i]]=yl(r[t[i]]);return e}return r}function V_(r){return["__proto__","prototype","constructor"].indexOf(r)===-1}function CM(r,e,t,n){if(!V_(r))return;let i=e[r],a=t[r];kt(i)&&kt(a)?wo(i,a,n):e[r]=yl(a)}function wo(r,e,t){let n=$t(e)?e:[e],i=n.length;if(!kt(r))return r;t=t||{};let a=t.merger||CM,o;for(let s=0;s<i;++s){if(o=n[s],!kt(o))continue;let c=Object.keys(o);for(let u=0,l=c.length;u<l;++u)a(c[u],r,o,t)}return r}function So(r,e){return wo(r,e,{merger:SM})}function SM(r,e,t){if(!V_(r))return;let n=e[r],i=t[r];kt(n)&&kt(i)?So(n,i):Object.prototype.hasOwnProperty.call(e,r)||(e[r]=yl(i))}var D_={"":r=>r,x:r=>r.x,y:r=>r.y};function EM(r){let e=r.split("."),t=[],n="";for(let i of e)n+=i,n.endsWith("\\")?n=n.slice(0,-1)+".":(t.push(n),n="");return t}function kM(r){let e=EM(r);return t=>{for(let n of e){if(n==="")break;t=t&&t[n]}return t}}function $r(r,e){return(D_[e]||(D_[e]=kM(e)))(r)}function Cl(r){return r.charAt(0).toUpperCase()+r.slice(1)}var Eo=r=>typeof r<"u",Kr=r=>typeof r=="function",tp=(r,e)=>{if(r.size!==e.size)return!1;for(let t of r)if(!e.has(t))return!1;return!0};function W_(r){return r.type==="mouseup"||r.type==="click"||r.type==="contextmenu"}var Qt=Math.PI,Jt=2*Qt,DM=Jt+Qt,xl=Number.POSITIVE_INFINITY,AM=Qt/180,ve=Qt/2,sa=Qt/4,A_=Qt*2/3,Xr=Math.log10,Qn=Math.sign;function ko(r,e,t){return Math.abs(r-e)<t}function ep(r){let e=Math.round(r);r=ko(r,e,r/1e3)?e:r;let t=Math.pow(10,Math.floor(Xr(r))),n=r/t;return(n<=1?1:n<=2?2:n<=5?5:10)*t}function z_(r){let e=[],t=Math.sqrt(r),n;for(n=1;n<t;n++)r%n===0&&(e.push(n),e.push(r/n));return t===(t|0)&&e.push(t),e.sort((i,a)=>i-a).pop(),e}function la(r){return!isNaN(parseFloat(r))&&isFinite(r)}function j_(r,e){let t=Math.round(r);return t-e<=r&&t+e>=r}function np(r,e,t){let n,i,a;for(n=0,i=r.length;n<i;n++)a=r[n][t],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function Bn(r){return r*(Qt/180)}function Sl(r){return r*(180/Qt)}function rp(r){if(!le(r))return;let e=1,t=0;for(;Math.round(r*e)/e!==r;)e*=10,t++;return t}function ip(r,e){let t=e.x-r.x,n=e.y-r.y,i=Math.sqrt(t*t+n*n),a=Math.atan2(n,t);return a<-.5*Qt&&(a+=Jt),{angle:a,distance:i}}function _l(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function IM(r,e){return(r-e+DM)%Jt-Qt}function gn(r){return(r%Jt+Jt)%Jt}function Do(r,e,t,n){let i=gn(r),a=gn(e),o=gn(t),s=gn(a-i),c=gn(o-i),u=gn(i-a),l=gn(i-o);return i===a||i===o||n&&a===o||s>c&&u<l}function Re(r,e,t){return Math.max(e,Math.min(t,r))}function H_(r){return Re(r,-32768,32767)}function _r(r,e,t,n=1e-6){return r>=Math.min(e,t)-n&&r<=Math.max(e,t)+n}function El(r,e,t){t=t||(o=>r[o]<e);let n=r.length-1,i=0,a;for(;n-i>1;)a=i+n>>1,t(a)?i=a:n=a;return{lo:i,hi:n}}var br=(r,e,t,n)=>El(r,t,n?i=>{let a=r[i][e];return a<t||a===t&&r[i+1][e]===t}:i=>r[i][e]<t),U_=(r,e,t)=>El(r,t,n=>r[n][e]>=t);function G_(r,e,t){let n=0,i=r.length;for(;n<i&&r[n]<e;)n++;for(;i>n&&r[i-1]>t;)i--;return n>0||i<r.length?r.slice(n,i):r}var q_=["push","pop","shift","splice","unshift"];function Y_(r,e){if(r._chartjs){r._chartjs.listeners.push(e);return}Object.defineProperty(r,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),q_.forEach(t=>{let n="_onData"+Cl(t),i=r[t];Object.defineProperty(r,t,{configurable:!0,enumerable:!1,value(...a){let o=i.apply(this,a);return r._chartjs.listeners.forEach(s=>{typeof s[n]=="function"&&s[n](...a)}),o}})})}function ap(r,e){let t=r._chartjs;if(!t)return;let n=t.listeners,i=n.indexOf(e);i!==-1&&n.splice(i,1),!(n.length>0)&&(q_.forEach(a=>{delete r[a]}),delete r._chartjs)}function op(r){let e=new Set(r);return e.size===r.length?r:Array.from(e)}var sp=function(){return typeof window>"u"?function(r){return r()}:window.requestAnimationFrame}();function cp(r,e){let t=[],n=!1;return function(...i){t=i,n||(n=!0,sp.call(window,()=>{n=!1,r.apply(e,t)}))}}function K_(r,e){let t;return function(...n){return e?(clearTimeout(t),t=setTimeout(r,e,n)):r.apply(this,n),e}}var kl=r=>r==="start"?"left":r==="end"?"right":"center",Ye=(r,e,t)=>r==="start"?e:r==="end"?t:(e+t)/2,X_=(r,e,t,n)=>r===(n?"left":"right")?t:r==="center"?(e+t)/2:e;function up(r,e,t){let n=e.length,i=0,a=n;if(r._sorted){let{iScale:o,_parsed:s}=r,c=o.axis,{min:u,max:l,minDefined:d,maxDefined:h}=o.getUserBounds();d&&(i=Re(Math.min(br(s,c,u).lo,t?n:br(e,c,o.getPixelForValue(u)).lo),0,n-1)),h?a=Re(Math.max(br(s,o.axis,l,!0).hi+1,t?0:br(e,c,o.getPixelForValue(l),!0).hi+1),i,n)-i:a=n-i}return{start:i,count:a}}function lp(r){let{xScale:e,yScale:t,_scaleRanges:n}=r,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!n)return r._scaleRanges=i,!0;let a=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==t.min||n.ymax!==t.max;return Object.assign(n,i),a}var gl=r=>r===0||r===1,I_=(r,e,t)=>-(Math.pow(2,10*(r-=1))*Math.sin((r-e)*Jt/t)),M_=(r,e,t)=>Math.pow(2,-10*r)*Math.sin((r-e)*Jt/t)+1,_o={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>-r*(r-2),easeInOutQuad:r=>(r/=.5)<1?.5*r*r:-.5*(--r*(r-2)-1),easeInCubic:r=>r*r*r,easeOutCubic:r=>(r-=1)*r*r+1,easeInOutCubic:r=>(r/=.5)<1?.5*r*r*r:.5*((r-=2)*r*r+2),easeInQuart:r=>r*r*r*r,easeOutQuart:r=>-((r-=1)*r*r*r-1),easeInOutQuart:r=>(r/=.5)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2),easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>(r-=1)*r*r*r*r+1,easeInOutQuint:r=>(r/=.5)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2),easeInSine:r=>-Math.cos(r*ve)+1,easeOutSine:r=>Math.sin(r*ve),easeInOutSine:r=>-.5*(Math.cos(Qt*r)-1),easeInExpo:r=>r===0?0:Math.pow(2,10*(r-1)),easeOutExpo:r=>r===1?1:-Math.pow(2,-10*r)+1,easeInOutExpo:r=>gl(r)?r:r<.5?.5*Math.pow(2,10*(r*2-1)):.5*(-Math.pow(2,-10*(r*2-1))+2),easeInCirc:r=>r>=1?r:-(Math.sqrt(1-r*r)-1),easeOutCirc:r=>Math.sqrt(1-(r-=1)*r),easeInOutCirc:r=>(r/=.5)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1),easeInElastic:r=>gl(r)?r:I_(r,.075,.3),easeOutElastic:r=>gl(r)?r:M_(r,.075,.3),easeInOutElastic(r){return gl(r)?r:r<.5?.5*I_(r*2,.1125,.45):.5+.5*M_(r*2-1,.1125,.45)},easeInBack(r){return r*r*((1.70158+1)*r-1.70158)},easeOutBack(r){return(r-=1)*r*((1.70158+1)*r+1.70158)+1},easeInOutBack(r){let e=1.70158;return(r/=.5)<1?.5*(r*r*(((e*=1.525)+1)*r-e)):.5*((r-=2)*r*(((e*=1.525)+1)*r+e)+2)},easeInBounce:r=>1-_o.easeOutBounce(1-r),easeOutBounce(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},easeInOutBounce:r=>r<.5?_o.easeInBounce(r*2)*.5:_o.easeOutBounce(r*2-1)*.5+.5};function dp(r){if(r&&typeof r=="object"){let e=r.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function hp(r){return dp(r)?r:new Hs(r)}function $f(r){return dp(r)?r:new Hs(r).saturate(.5).darken(.1).hexString()}var MM=["x","y","borderWidth","radius","tension"],RM=["color","borderColor","backgroundColor"];function TM(r){r.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),r.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),r.set("animations",{colors:{type:"color",properties:RM},numbers:{type:"number",properties:MM}}),r.describe("animations",{_fallback:"animation"}),r.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function FM(r){r.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var R_=new Map;function PM(r,e){e=e||{};let t=r+JSON.stringify(e),n=R_.get(t);return n||(n=new Intl.NumberFormat(r,e),R_.set(t,n)),n}function Ao(r,e,t){return PM(e,t).format(r)}var $_={values(r){return $t(r)?r:""+r},numeric(r,e,t){if(r===0)return"0";let n=this.chart.options.locale,i,a=r;if(t.length>1){let u=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(u<1e-4||u>1e15)&&(i="scientific"),a=OM(r,t)}let o=Xr(Math.abs(a)),s=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:i,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(c,this.options.ticks.format),Ao(r,n,c)},logarithmic(r,e,t){if(r===0)return"0";let n=t[e].significand||r/Math.pow(10,Math.floor(Xr(r)));return[1,2,3,5,10,15].includes(n)||e>.8*t.length?$_.numeric.call(this,r,e,t):""}};function OM(r,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&r!==Math.floor(r)&&(t=r-Math.floor(r)),t}var Ks={formatters:$_};function NM(r){r.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ks.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),r.route("scale.ticks","color","","color"),r.route("scale.grid","color","","borderColor"),r.route("scale.border","color","","borderColor"),r.route("scale.title","color","","color"),r.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),r.describe("scales",{_fallback:"scale"}),r.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}var Ei=Object.create(null),Dl=Object.create(null);function Gs(r,e){if(!e)return r;let t=e.split(".");for(let n=0,i=t.length;n<i;++n){let a=t[n];r=r[a]||(r[a]=Object.create(null))}return r}function Qf(r,e,t){return typeof e=="string"?wo(Gs(r,e),t):wo(Gs(r,""),e)}var Jf=class{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,i)=>$f(i.backgroundColor),this.hoverBorderColor=(n,i)=>$f(i.borderColor),this.hoverColor=(n,i)=>$f(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return Qf(this,e,t)}get(e){return Gs(this,e)}describe(e,t){return Qf(Dl,e,t)}override(e,t){return Qf(Ei,e,t)}route(e,t,n,i){let a=Gs(this,e),o=Gs(this,n),s="_"+t;Object.defineProperties(a,{[s]:{value:a[t],writable:!0},[t]:{enumerable:!0,get(){let c=this[s],u=o[i];return kt(c)?Object.assign({},u,c):_t(c,u)},set(c){this[s]=c}}})}apply(e){e.forEach(t=>t(this))}},de=new Jf({_scriptable:r=>!r.startsWith("on"),_indexable:r=>r!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[TM,FM,NM]);function LM(r){return!r||Ft(r.size)||Ft(r.family)?null:(r.style?r.style+" ":"")+(r.weight?r.weight+" ":"")+r.size+"px "+r.family}function qs(r,e,t,n,i){let a=e[i];return a||(a=e[i]=r.measureText(i).width,t.push(i)),a>n&&(n=a),n}function Q_(r,e,t,n){n=n||{};let i=n.data=n.data||{},a=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(i=n.data={},a=n.garbageCollect=[],n.font=e),r.save(),r.font=e;let o=0,s=t.length,c,u,l,d,h;for(c=0;c<s;c++)if(d=t[c],d!=null&&!$t(d))o=qs(r,i,a,o,d);else if($t(d))for(u=0,l=d.length;u<l;u++)h=d[u],h!=null&&!$t(h)&&(o=qs(r,i,a,o,h));r.restore();let f=a.length/2;if(f>t.length){for(c=0;c<f;c++)delete i[a[c]];a.splice(0,f)}return o}function ki(r,e,t){let n=r.currentDevicePixelRatio,i=t!==0?Math.max(t/2,.5):0;return Math.round((e-i)*n)/n+i}function fp(r,e){e=e||r.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,r.width,r.height),e.restore()}function Al(r,e,t,n){pp(r,e,t,n,null)}function pp(r,e,t,n,i){let a,o,s,c,u,l,d,h,f=e.pointStyle,p=e.rotation,m=e.radius,g=(p||0)*AM;if(f&&typeof f=="object"&&(a=f.toString(),a==="[object HTMLImageElement]"||a==="[object HTMLCanvasElement]")){r.save(),r.translate(t,n),r.rotate(g),r.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),r.restore();return}if(!(isNaN(m)||m<=0)){switch(r.beginPath(),f){default:i?r.ellipse(t,n,i/2,m,0,0,Jt):r.arc(t,n,m,0,Jt),r.closePath();break;case"triangle":l=i?i/2:m,r.moveTo(t+Math.sin(g)*l,n-Math.cos(g)*m),g+=A_,r.lineTo(t+Math.sin(g)*l,n-Math.cos(g)*m),g+=A_,r.lineTo(t+Math.sin(g)*l,n-Math.cos(g)*m),r.closePath();break;case"rectRounded":u=m*.516,c=m-u,o=Math.cos(g+sa)*c,d=Math.cos(g+sa)*(i?i/2-u:c),s=Math.sin(g+sa)*c,h=Math.sin(g+sa)*(i?i/2-u:c),r.arc(t-d,n-s,u,g-Qt,g-ve),r.arc(t+h,n-o,u,g-ve,g),r.arc(t+d,n+s,u,g,g+ve),r.arc(t-h,n+o,u,g+ve,g+Qt),r.closePath();break;case"rect":if(!p){c=Math.SQRT1_2*m,l=i?i/2:c,r.rect(t-l,n-c,2*l,2*c);break}g+=sa;case"rectRot":d=Math.cos(g)*(i?i/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,h=Math.sin(g)*(i?i/2:m),r.moveTo(t-d,n-s),r.lineTo(t+h,n-o),r.lineTo(t+d,n+s),r.lineTo(t-h,n+o),r.closePath();break;case"crossRot":g+=sa;case"cross":d=Math.cos(g)*(i?i/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,h=Math.sin(g)*(i?i/2:m),r.moveTo(t-d,n-s),r.lineTo(t+d,n+s),r.moveTo(t+h,n-o),r.lineTo(t-h,n+o);break;case"star":d=Math.cos(g)*(i?i/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,h=Math.sin(g)*(i?i/2:m),r.moveTo(t-d,n-s),r.lineTo(t+d,n+s),r.moveTo(t+h,n-o),r.lineTo(t-h,n+o),g+=sa,d=Math.cos(g)*(i?i/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,h=Math.sin(g)*(i?i/2:m),r.moveTo(t-d,n-s),r.lineTo(t+d,n+s),r.moveTo(t+h,n-o),r.lineTo(t-h,n+o);break;case"line":o=i?i/2:Math.cos(g)*m,s=Math.sin(g)*m,r.moveTo(t-o,n-s),r.lineTo(t+o,n+s);break;case"dash":r.moveTo(t,n),r.lineTo(t+Math.cos(g)*(i?i/2:m),n+Math.sin(g)*m);break;case!1:r.closePath();break}r.fill(),e.borderWidth>0&&r.stroke()}}function yr(r,e,t){return t=t||.5,!e||r&&r.x>e.left-t&&r.x<e.right+t&&r.y>e.top-t&&r.y<e.bottom+t}function Xs(r,e){r.save(),r.beginPath(),r.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),r.clip()}function $s(r){r.restore()}function J_(r,e,t,n,i){if(!e)return r.lineTo(t.x,t.y);if(i==="middle"){let a=(e.x+t.x)/2;r.lineTo(a,e.y),r.lineTo(a,t.y)}else i==="after"!=!!n?r.lineTo(e.x,t.y):r.lineTo(t.x,e.y);r.lineTo(t.x,t.y)}function Z_(r,e,t,n){if(!e)return r.lineTo(t.x,t.y);r.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?t.cp2x:t.cp1x,n?t.cp2y:t.cp1y,t.x,t.y)}function BM(r,e){e.translation&&r.translate(e.translation[0],e.translation[1]),Ft(e.rotation)||r.rotate(e.rotation),e.color&&(r.fillStyle=e.color),e.textAlign&&(r.textAlign=e.textAlign),e.textBaseline&&(r.textBaseline=e.textBaseline)}function VM(r,e,t,n,i){if(i.strikethrough||i.underline){let a=r.measureText(n),o=e-a.actualBoundingBoxLeft,s=e+a.actualBoundingBoxRight,c=t-a.actualBoundingBoxAscent,u=t+a.actualBoundingBoxDescent,l=i.strikethrough?(c+u)/2:u;r.strokeStyle=r.fillStyle,r.beginPath(),r.lineWidth=i.decorationWidth||2,r.moveTo(o,l),r.lineTo(s,l),r.stroke()}}function WM(r,e){let t=r.fillStyle;r.fillStyle=e.color,r.fillRect(e.left,e.top,e.width,e.height),r.fillStyle=t}function Di(r,e,t,n,i,a={}){let o=$t(e)?e:[e],s=a.strokeWidth>0&&a.strokeColor!=="",c,u;for(r.save(),r.font=i.string,BM(r,a),c=0;c<o.length;++c)u=o[c],a.backdrop&&WM(r,a.backdrop),s&&(a.strokeColor&&(r.strokeStyle=a.strokeColor),Ft(a.strokeWidth)||(r.lineWidth=a.strokeWidth),r.strokeText(u,t,n,a.maxWidth)),r.fillText(u,t,n,a.maxWidth),VM(r,t,n,u,a),n+=Number(i.lineHeight);r.restore()}function Io(r,e){let{x:t,y:n,w:i,h:a,radius:o}=e;r.arc(t+o.topLeft,n+o.topLeft,o.topLeft,1.5*Qt,Qt,!0),r.lineTo(t,n+a-o.bottomLeft),r.arc(t+o.bottomLeft,n+a-o.bottomLeft,o.bottomLeft,Qt,ve,!0),r.lineTo(t+i-o.bottomRight,n+a),r.arc(t+i-o.bottomRight,n+a-o.bottomRight,o.bottomRight,ve,0,!0),r.lineTo(t+i,n+o.topRight),r.arc(t+i-o.topRight,n+o.topRight,o.topRight,0,-ve,!0),r.lineTo(t+o.topLeft,n)}var zM=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,jM=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function HM(r,e){let t=(""+r).match(zM);if(!t||t[1]==="normal")return e*1.2;switch(r=+t[2],t[3]){case"px":return r;case"%":r/=100;break}return e*r}var UM=r=>+r||0;function Il(r,e){let t={},n=kt(e),i=n?Object.keys(e):e,a=kt(r)?n?o=>_t(r[o],r[e[o]]):o=>r[o]:()=>r;for(let o of i)t[o]=UM(a(o));return t}function mp(r){return Il(r,{top:"y",right:"x",bottom:"y",left:"x"})}function Ai(r){return Il(r,["topLeft","topRight","bottomLeft","bottomRight"])}function Ke(r){let e=mp(r);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Ee(r,e){r=r||{},e=e||de.font;let t=_t(r.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let n=_t(r.style,e.style);n&&!(""+n).match(jM)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);let i={family:_t(r.family,e.family),lineHeight:HM(_t(r.lineHeight,e.lineHeight),t),size:t,style:n,weight:_t(r.weight,e.weight),string:""};return i.string=LM(i),i}function Mo(r,e,t,n){let i=!0,a,o,s;for(a=0,o=r.length;a<o;++a)if(s=r[a],s!==void 0&&(e!==void 0&&typeof s=="function"&&(s=s(e),i=!1),t!==void 0&&$t(s)&&(s=s[t%s.length],i=!1),s!==void 0))return n&&!i&&(n.cacheable=!1),s}function t1(r,e,t){let{min:n,max:i}=r,a=Zf(e,(i-n)/2),o=(s,c)=>t&&s===0?0:s+c;return{min:o(n,-Math.abs(a)),max:o(i,a)}}function Qr(r,e){return Object.assign(Object.create(r),e)}function Ml(r,e=[""],t,n,i=()=>r[0]){let a=t||r;typeof n>"u"&&(n=r1("_fallback",r));let o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:r,_rootScopes:a,_fallback:n,_getTarget:i,override:s=>Ml([s,...r],e,a,n)};return new Proxy(o,{deleteProperty(s,c){return delete s[c],delete s._keys,delete r[0][c],!0},get(s,c){return e1(s,c,()=>JM(c,e,r,s))},getOwnPropertyDescriptor(s,c){return Reflect.getOwnPropertyDescriptor(s._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(r[0])},has(s,c){return F_(s).includes(c)},ownKeys(s){return F_(s)},set(s,c,u){let l=s._storage||(s._storage=i());return s[c]=l[c]=u,delete s._keys,!0}})}function ua(r,e,t,n){let i={_cacheable:!1,_proxy:r,_context:e,_subProxy:t,_stack:new Set,_descriptors:gp(r,n),setContext:a=>ua(r,a,t,n),override:a=>ua(r.override(a),e,t,n)};return new Proxy(i,{deleteProperty(a,o){return delete a[o],delete r[o],!0},get(a,o,s){return e1(a,o,()=>qM(a,o,s))},getOwnPropertyDescriptor(a,o){return a._descriptors.allKeys?Reflect.has(r,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(r,o)},getPrototypeOf(){return Reflect.getPrototypeOf(r)},has(a,o){return Reflect.has(r,o)},ownKeys(){return Reflect.ownKeys(r)},set(a,o,s){return r[o]=s,delete a[o],!0}})}function gp(r,e={scriptable:!0,indexable:!0}){let{_scriptable:t=e.scriptable,_indexable:n=e.indexable,_allKeys:i=e.allKeys}=r;return{allKeys:i,scriptable:t,indexable:n,isScriptable:Kr(t)?t:()=>t,isIndexable:Kr(n)?n:()=>n}}var GM=(r,e)=>r?r+Cl(e):e,vp=(r,e)=>kt(e)&&r!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function e1(r,e,t){if(Object.prototype.hasOwnProperty.call(r,e))return r[e];let n=t();return r[e]=n,n}function qM(r,e,t){let{_proxy:n,_context:i,_subProxy:a,_descriptors:o}=r,s=n[e];return Kr(s)&&o.isScriptable(e)&&(s=YM(e,s,r,t)),$t(s)&&s.length&&(s=KM(e,s,r,o.isIndexable)),vp(e,s)&&(s=ua(s,i,a&&a[e],o)),s}function YM(r,e,t,n){let{_proxy:i,_context:a,_subProxy:o,_stack:s}=t;if(s.has(r))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+r);s.add(r);let c=e(a,o||n);return s.delete(r),vp(r,c)&&(c=bp(i._scopes,i,r,c)),c}function KM(r,e,t,n){let{_proxy:i,_context:a,_subProxy:o,_descriptors:s}=t;if(typeof a.index<"u"&&n(r))return e[a.index%e.length];if(kt(e[0])){let c=e,u=i._scopes.filter(l=>l!==c);e=[];for(let l of c){let d=bp(u,i,r,l);e.push(ua(d,a,o&&o[r],s))}}return e}function n1(r,e,t){return Kr(r)?r(e,t):r}var XM=(r,e)=>r===!0?e:typeof r=="string"?$r(e,r):void 0;function $M(r,e,t,n,i){for(let a of e){let o=XM(t,a);if(o){r.add(o);let s=n1(o._fallback,t,i);if(typeof s<"u"&&s!==t&&s!==n)return s}else if(o===!1&&typeof n<"u"&&t!==n)return null}return!1}function bp(r,e,t,n){let i=e._rootScopes,a=n1(e._fallback,t,n),o=[...r,...i],s=new Set;s.add(n);let c=T_(s,o,t,a||t,n);return c===null||typeof a<"u"&&a!==t&&(c=T_(s,o,a,c,n),c===null)?!1:Ml(Array.from(s),[""],i,a,()=>QM(e,t,n))}function T_(r,e,t,n,i){for(;t;)t=$M(r,e,t,n,i);return t}function QM(r,e,t){let n=r._getTarget();e in n||(n[e]={});let i=n[e];return $t(i)&&kt(t)?t:i||{}}function JM(r,e,t,n){let i;for(let a of e)if(i=r1(GM(a,r),t),typeof i<"u")return vp(r,i)?bp(t,n,r,i):i}function r1(r,e){for(let t of e){if(!t)continue;let n=t[r];if(typeof n<"u")return n}}function F_(r){let e=r._keys;return e||(e=r._keys=ZM(r._scopes)),e}function ZM(r){let e=new Set;for(let t of r)for(let n of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(n);return Array.from(e)}function yp(r,e,t,n){let{iScale:i}=r,{key:a="r"}=this._parsing,o=new Array(n),s,c,u,l;for(s=0,c=n;s<c;++s)u=s+t,l=e[u],o[s]={r:i.parse($r(l,a),u)};return o}var tR=Number.EPSILON||1e-14,Co=(r,e)=>e<r.length&&!r[e].skip&&r[e],i1=r=>r==="x"?"y":"x";function eR(r,e,t,n){let i=r.skip?e:r,a=e,o=t.skip?e:t,s=_l(a,i),c=_l(o,a),u=s/(s+c),l=c/(s+c);u=isNaN(u)?0:u,l=isNaN(l)?0:l;let d=n*u,h=n*l;return{previous:{x:a.x-d*(o.x-i.x),y:a.y-d*(o.y-i.y)},next:{x:a.x+h*(o.x-i.x),y:a.y+h*(o.y-i.y)}}}function nR(r,e,t){let n=r.length,i,a,o,s,c,u=Co(r,0);for(let l=0;l<n-1;++l)if(c=u,u=Co(r,l+1),!(!c||!u)){if(ko(e[l],0,tR)){t[l]=t[l+1]=0;continue}i=t[l]/e[l],a=t[l+1]/e[l],s=Math.pow(i,2)+Math.pow(a,2),!(s<=9)&&(o=3/Math.sqrt(s),t[l]=i*o*e[l],t[l+1]=a*o*e[l])}}function rR(r,e,t="x"){let n=i1(t),i=r.length,a,o,s,c=Co(r,0);for(let u=0;u<i;++u){if(o=s,s=c,c=Co(r,u+1),!s)continue;let l=s[t],d=s[n];o&&(a=(l-o[t])/3,s[`cp1${t}`]=l-a,s[`cp1${n}`]=d-a*e[u]),c&&(a=(c[t]-l)/3,s[`cp2${t}`]=l+a,s[`cp2${n}`]=d+a*e[u])}}function iR(r,e="x"){let t=i1(e),n=r.length,i=Array(n).fill(0),a=Array(n),o,s,c,u=Co(r,0);for(o=0;o<n;++o)if(s=c,c=u,u=Co(r,o+1),!!c){if(u){let l=u[e]-c[e];i[o]=l!==0?(u[t]-c[t])/l:0}a[o]=s?u?Qn(i[o-1])!==Qn(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}nR(r,i,a),rR(r,a,e)}function vl(r,e,t){return Math.max(Math.min(r,t),e)}function aR(r,e){let t,n,i,a,o,s=yr(r[0],e);for(t=0,n=r.length;t<n;++t)o=a,a=s,s=t<n-1&&yr(r[t+1],e),a&&(i=r[t],o&&(i.cp1x=vl(i.cp1x,e.left,e.right),i.cp1y=vl(i.cp1y,e.top,e.bottom)),s&&(i.cp2x=vl(i.cp2x,e.left,e.right),i.cp2y=vl(i.cp2y,e.top,e.bottom)))}function a1(r,e,t,n,i){let a,o,s,c;if(e.spanGaps&&(r=r.filter(u=>!u.skip)),e.cubicInterpolationMode==="monotone")iR(r,i);else{let u=n?r[r.length-1]:r[0];for(a=0,o=r.length;a<o;++a)s=r[a],c=eR(u,s,r[Math.min(a+1,o-(n?0:1))%o],e.tension),s.cp1x=c.previous.x,s.cp1y=c.previous.y,s.cp2x=c.next.x,s.cp2y=c.next.y,u=s}e.capBezierPoints&&aR(r,t)}function Rl(){return typeof window<"u"&&typeof document<"u"}function Tl(r){let e=r.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function wl(r,e,t){let n;return typeof r=="string"?(n=parseInt(r,10),r.indexOf("%")!==-1&&(n=n/100*e.parentNode[t])):n=r,n}var Fl=r=>r.ownerDocument.defaultView.getComputedStyle(r,null);function oR(r,e){return Fl(r).getPropertyValue(e)}var sR=["top","right","bottom","left"];function ca(r,e,t){let n={};t=t?"-"+t:"";for(let i=0;i<4;i++){let a=sR[i];n[a]=parseFloat(r[e+"-"+a+t])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var cR=(r,e,t)=>(r>0||e>0)&&(!t||!t.shadowRoot);function uR(r,e){let t=r.touches,n=t&&t.length?t[0]:r,{offsetX:i,offsetY:a}=n,o=!1,s,c;if(cR(i,a,r.target))s=i,c=a;else{let u=e.getBoundingClientRect();s=n.clientX-u.left,c=n.clientY-u.top,o=!0}return{x:s,y:c,box:o}}function Ii(r,e){if("native"in r)return r;let{canvas:t,currentDevicePixelRatio:n}=e,i=Fl(t),a=i.boxSizing==="border-box",o=ca(i,"padding"),s=ca(i,"border","width"),{x:c,y:u,box:l}=uR(r,t),d=o.left+(l&&s.left),h=o.top+(l&&s.top),{width:f,height:p}=e;return a&&(f-=o.width+s.width,p-=o.height+s.height),{x:Math.round((c-d)/f*t.width/n),y:Math.round((u-h)/p*t.height/n)}}function lR(r,e,t){let n,i;if(e===void 0||t===void 0){let a=Tl(r);if(!a)e=r.clientWidth,t=r.clientHeight;else{let o=a.getBoundingClientRect(),s=Fl(a),c=ca(s,"border","width"),u=ca(s,"padding");e=o.width-u.width-c.width,t=o.height-u.height-c.height,n=wl(s.maxWidth,a,"clientWidth"),i=wl(s.maxHeight,a,"clientHeight")}}return{width:e,height:t,maxWidth:n||xl,maxHeight:i||xl}}var bl=r=>Math.round(r*10)/10;function o1(r,e,t,n){let i=Fl(r),a=ca(i,"margin"),o=wl(i.maxWidth,r,"clientWidth")||xl,s=wl(i.maxHeight,r,"clientHeight")||xl,c=lR(r,e,t),{width:u,height:l}=c;if(i.boxSizing==="content-box"){let h=ca(i,"border","width"),f=ca(i,"padding");u-=f.width+h.width,l-=f.height+h.height}return u=Math.max(0,u-a.width),l=Math.max(0,n?u/n:l-a.height),u=bl(Math.min(u,o,c.maxWidth)),l=bl(Math.min(l,s,c.maxHeight)),u&&!l&&(l=bl(u/2)),(e!==void 0||t!==void 0)&&n&&c.height&&l>c.height&&(l=c.height,u=bl(Math.floor(l*n))),{width:u,height:l}}function xp(r,e,t){let n=e||1,i=Math.floor(r.height*n),a=Math.floor(r.width*n);r.height=Math.floor(r.height),r.width=Math.floor(r.width);let o=r.canvas;return o.style&&(t||!o.style.height&&!o.style.width)&&(o.style.height=`${r.height}px`,o.style.width=`${r.width}px`),r.currentDevicePixelRatio!==n||o.height!==i||o.width!==a?(r.currentDevicePixelRatio=n,o.height=i,o.width=a,r.ctx.setTransform(n,0,0,n,0,0),!0):!1}var s1=function(){let r=!1;try{let e={get passive(){return r=!0,!1}};Rl()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return r}();function _p(r,e){let t=oR(r,e),n=t&&t.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function Si(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:r.y+t*(e.y-r.y)}}function c1(r,e,t,n){return{x:r.x+t*(e.x-r.x),y:n==="middle"?t<.5?r.y:e.y:n==="after"?t<1?r.y:e.y:t>0?e.y:r.y}}function u1(r,e,t,n){let i={x:r.cp2x,y:r.cp2y},a={x:e.cp1x,y:e.cp1y},o=Si(r,i,t),s=Si(i,a,t),c=Si(a,e,t),u=Si(o,s,t),l=Si(s,c,t);return Si(u,l,t)}var dR=function(r,e){return{x(t){return r+r+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,n){return t-n},leftForLtr(t,n){return t-n}}},hR=function(){return{x(r){return r},setWidth(r){},textAlign(r){return r},xPlus(r,e){return r+e},leftForLtr(r,e){return r}}};function da(r,e,t){return r?dR(e,t):hR()}function wp(r,e){let t,n;(e==="ltr"||e==="rtl")&&(t=r.canvas.style,n=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),r.prevTextDirection=n)}function Cp(r,e){e!==void 0&&(delete r.prevTextDirection,r.canvas.style.setProperty("direction",e[0],e[1]))}function l1(r){return r==="angle"?{between:Do,compare:IM,normalize:gn}:{between:_r,compare:(e,t)=>e-t,normalize:e=>e}}function P_({start:r,end:e,count:t,loop:n,style:i}){return{start:r%t,end:e%t,loop:n&&(e-r+1)%t===0,style:i}}function fR(r,e,t){let{property:n,start:i,end:a}=t,{between:o,normalize:s}=l1(n),c=e.length,{start:u,end:l,loop:d}=r,h,f;if(d){for(u+=c,l+=c,h=0,f=c;h<f&&o(s(e[u%c][n]),i,a);++h)u--,l--;u%=c,l%=c}return l<u&&(l+=c),{start:u,end:l,loop:d,style:r.style}}function Sp(r,e,t){if(!t)return[r];let{property:n,start:i,end:a}=t,o=e.length,{compare:s,between:c,normalize:u}=l1(n),{start:l,end:d,loop:h,style:f}=fR(r,e,t),p=[],m=!1,g=null,v,b,_,y=()=>c(i,_,v)&&s(i,_)!==0,x=()=>s(a,v)===0||c(a,_,v),w=()=>m||y(),S=()=>!m||x();for(let C=l,E=l;C<=d;++C)b=e[C%o],!b.skip&&(v=u(b[n]),v!==_&&(m=c(v,i,a),g===null&&w()&&(g=s(v,i)===0?C:E),g!==null&&S()&&(p.push(P_({start:g,end:C,loop:h,count:o,style:f})),g=null),E=C,_=v));return g!==null&&p.push(P_({start:g,end:d,loop:h,count:o,style:f})),p}function Ep(r,e){let t=[],n=r.segments;for(let i=0;i<n.length;i++){let a=Sp(n[i],r.points,e);a.length&&t.push(...a)}return t}function pR(r,e,t,n){let i=0,a=e-1;if(t&&!n)for(;i<e&&!r[i].skip;)i++;for(;i<e&&r[i].skip;)i++;for(i%=e,t&&(a+=i);a>i&&r[a%e].skip;)a--;return a%=e,{start:i,end:a}}function mR(r,e,t,n){let i=r.length,a=[],o=e,s=r[e],c;for(c=e+1;c<=t;++c){let u=r[c%i];u.skip||u.stop?s.skip||(n=!1,a.push({start:e%i,end:(c-1)%i,loop:n}),e=o=u.stop?c:null):(o=c,s.skip&&(e=c)),s=u}return o!==null&&a.push({start:e%i,end:o%i,loop:n}),a}function d1(r,e){let t=r.points,n=r.options.spanGaps,i=t.length;if(!i)return[];let a=!!r._loop,{start:o,end:s}=pR(t,i,a,n);if(n===!0)return O_(r,[{start:o,end:s,loop:a}],t,e);let c=s<o?s+i:s,u=!!r._fullLoop&&o===0&&s===i-1;return O_(r,mR(t,o,c,u),t,e)}function O_(r,e,t,n){return!n||!n.setContext||!t?e:gR(r,e,t,n)}function gR(r,e,t,n){let i=r._chart.getContext(),a=N_(r.options),{_datasetIndex:o,options:{spanGaps:s}}=r,c=t.length,u=[],l=a,d=e[0].start,h=d;function f(p,m,g,v){let b=s?-1:1;if(p!==m){for(p+=c;t[p%c].skip;)p-=b;for(;t[m%c].skip;)m+=b;p%c!==m%c&&(u.push({start:p%c,end:m%c,loop:g,style:v}),l=v,d=m%c)}}for(let p of e){d=s?d:p.start;let m=t[d%c],g;for(h=d+1;h<=p.end;h++){let v=t[h%c];g=N_(n.setContext(Qr(i,{type:"segment",p0:m,p1:v,p0DataIndex:(h-1)%c,p1DataIndex:h%c,datasetIndex:o}))),vR(g,l)&&f(d,h-1,p.loop,l),m=v,l=g}d<h-1&&f(d,h-1,p.loop,l)}return u}function N_(r){return{backgroundColor:r.backgroundColor,borderCapStyle:r.borderCapStyle,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderJoinStyle:r.borderJoinStyle,borderWidth:r.borderWidth,borderColor:r.borderColor}}function vR(r,e){if(!e)return!1;let t=[],n=function(i,a){return dp(a)?(t.includes(a)||t.push(a),t.indexOf(a)):a};return JSON.stringify(r,n)!==JSON.stringify(e,n)}var Op=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,i){let a=t.listeners[i],o=t.duration;a.forEach(s=>s({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(n-t.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=sp.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;let a=n.items,o=a.length-1,s=!1,c;for(;o>=0;--o)c=a[o],c._active?(c._total>n.duration&&(n.duration=c._total),c.tick(e),s=!0):(a[o]=a[a.length-1],a.pop());s&&(i.draw(),this._notify(i,n,e,"progress")),a.length||(n.running=!1,this._notify(i,n,e,"complete"),n.initial=!1),t+=a.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){let t=this._charts,n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){let t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((n,i)=>Math.max(n,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;let t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){let t=this._charts.get(e);if(!t||!t.items.length)return;let n=t.items,i=n.length-1;for(;i>=0;--i)n[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}},Jr=new Op,h1="transparent",bR={boolean(r,e,t){return t>.5?e:r},color(r,e,t){let n=hp(r||h1),i=n.valid&&hp(e||h1);return i&&i.valid?i.mix(n,t).hexString():e},number(r,e,t){return r+(e-r)*t}},Np=class{constructor(e,t,n,i){let a=t[n];i=Mo([e.to,i,a,e.from]);let o=Mo([e.from,a,i]);this._active=!0,this._fn=e.fn||bR[e.type||typeof o],this._easing=_o[e.easing]||_o.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);let i=this._target[this._prop],a=n-this._start,o=this._duration-a;this._start=n,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=a,this._loop=!!e.loop,this._to=Mo([e.to,t,i,e.from]),this._from=Mo([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){let t=e-this._start,n=this._duration,i=this._prop,a=this._from,o=this._loop,s=this._to,c;if(this._active=a!==s&&(o||t<n),!this._active){this._target[i]=s,this._notify(!0);return}if(t<0){this._target[i]=a;return}c=t/n%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[i]=this._fn(a,s,c)}wait(){let e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){let t=e?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][t]()}},Hl=class{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!kt(e))return;let t=Object.keys(de.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{let a=e[i];if(!kt(a))return;let o={};for(let s of t)o[s]=a[s];($t(a.properties)&&a.properties||[i]).forEach(s=>{(s===i||!n.has(s))&&n.set(s,o)})})}_animateOptions(e,t){let n=t.options,i=xR(e,n);if(!i)return[];let a=this._createAnimations(i,n);return n.$shared&&yR(e.options.$animations,n).then(()=>{e.options=n},()=>{}),a}_createAnimations(e,t){let n=this._properties,i=[],a=e.$animations||(e.$animations={}),o=Object.keys(t),s=Date.now(),c;for(c=o.length-1;c>=0;--c){let u=o[c];if(u.charAt(0)==="$")continue;if(u==="options"){i.push(...this._animateOptions(e,t));continue}let l=t[u],d=a[u],h=n.get(u);if(d)if(h&&d.active()){d.update(h,l,s);continue}else d.cancel();if(!h||!h.duration){e[u]=l;continue}a[u]=d=new Np(h,e,u,l),i.push(d)}return i}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}let n=this._createAnimations(e,t);if(n.length)return Jr.add(this._chart,n),!0}};function yR(r,e){let t=[],n=Object.keys(e);for(let i=0;i<n.length;i++){let a=r[n[i]];a&&a.active()&&t.push(a.wait())}return Promise.all(t)}function xR(r,e){if(!e)return;let t=r.options;if(!t){r.options=e;return}return t.$shared&&(r.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function f1(r,e){let t=r&&r.options||{},n=t.reverse,i=t.min===void 0?e:0,a=t.max===void 0?e:0;return{start:n?a:i,end:n?i:a}}function _R(r,e,t){if(t===!1)return!1;let n=f1(r,t),i=f1(e,t);return{top:i.end,right:n.end,bottom:i.start,left:n.start}}function wR(r){let e,t,n,i;return kt(r)?(e=r.top,t=r.right,n=r.bottom,i=r.left):e=t=n=i=r,{top:e,right:t,bottom:n,left:i,disabled:r===!1}}function fw(r,e){let t=[],n=r._getSortedDatasetMetas(e),i,a;for(i=0,a=n.length;i<a;++i)t.push(n[i].index);return t}function p1(r,e,t,n={}){let i=r.keys,a=n.mode==="single",o,s,c,u;if(e!==null){for(o=0,s=i.length;o<s;++o){if(c=+i[o],c===t){if(n.all)continue;break}u=r.values[c],le(u)&&(a||e===0||Qn(e)===Qn(u))&&(e+=u)}return e}}function CR(r){let e=Object.keys(r),t=new Array(e.length),n,i,a;for(n=0,i=e.length;n<i;++n)a=e[n],t[n]={x:a,y:r[a]};return t}function m1(r,e){let t=r&&r.options.stacked;return t||t===void 0&&e.stack!==void 0}function SR(r,e,t){return`${r.id}.${e.id}.${t.stack||t.type}`}function ER(r){let{min:e,max:t,minDefined:n,maxDefined:i}=r.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}function kR(r,e,t){let n=r[e]||(r[e]={});return n[t]||(n[t]={})}function g1(r,e,t,n){for(let i of e.getMatchingVisibleMetas(n).reverse()){let a=r[i.index];if(t&&a>0||!t&&a<0)return i.index}return null}function v1(r,e){let{chart:t,_cachedMeta:n}=r,i=t._stacks||(t._stacks={}),{iScale:a,vScale:o,index:s}=n,c=a.axis,u=o.axis,l=SR(a,o,n),d=e.length,h;for(let f=0;f<d;++f){let p=e[f],{[c]:m,[u]:g}=p,v=p._stacks||(p._stacks={});h=v[u]=kR(i,l,m),h[s]=g,h._top=g1(h,o,!0,n.type),h._bottom=g1(h,o,!1,n.type);let b=h._visualValues||(h._visualValues={});b[s]=g}}function kp(r,e){let t=r.scales;return Object.keys(t).filter(n=>t[n].axis===e).shift()}function DR(r,e){return Qr(r,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function AR(r,e,t){return Qr(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function Qs(r,e){let t=r.controller.index,n=r.vScale&&r.vScale.axis;if(n){e=e||r._parsed;for(let i of e){let a=i._stacks;if(!a||a[n]===void 0||a[n][t]===void 0)return;delete a[n][t],a[n]._visualValues!==void 0&&a[n]._visualValues[t]!==void 0&&delete a[n]._visualValues[t]}}}var Dp=r=>r==="reset"||r==="none",b1=(r,e)=>e?r:Object.assign({},r),IR=(r,e,t)=>r&&!e.hidden&&e._stacked&&{keys:fw(t,!0),values:null},Ri=(()=>{class r{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=m1(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Qs(this._cachedMeta),this.index=t}linkScales(){let t=this.chart,n=this._cachedMeta,i=this.getDataset(),a=(h,f,p,m)=>h==="x"?f:h==="r"?m:p,o=n.xAxisID=_t(i.xAxisID,kp(t,"x")),s=n.yAxisID=_t(i.yAxisID,kp(t,"y")),c=n.rAxisID=_t(i.rAxisID,kp(t,"r")),u=n.indexAxis,l=n.iAxisID=a(u,o,s,c),d=n.vAxisID=a(u,s,o,c);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(s),n.rScale=this.getScaleForId(c),n.iScale=this.getScaleForId(l),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){let n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){let t=this._cachedMeta;this._data&&ap(this._data,this),t._stacked&&Qs(t)}_dataCheck(){let t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if(kt(n))this._data=CR(n);else if(i!==n){if(i){ap(i,this);let a=this._cachedMeta;Qs(a),a._parsed=[]}n&&Object.isExtensible(n)&&Y_(n,this),this._syncList=[],this._data=n}}addElements(){let t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){let n=this._cachedMeta,i=this.getDataset(),a=!1;this._dataCheck();let o=n._stacked;n._stacked=m1(n.vScale,n),n.stack!==i.stack&&(a=!0,Qs(n),n.stack=i.stack),this._resyncElements(t),(a||o!==n._stacked)&&v1(this,n._parsed)}configure(){let t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){let{_cachedMeta:i,_data:a}=this,{iScale:o,_stacked:s}=i,c=o.axis,u=t===0&&n===a.length?!0:i._sorted,l=t>0&&i._parsed[t-1],d,h,f;if(this._parsing===!1)i._parsed=a,i._sorted=!0,f=a;else{$t(a[t])?f=this.parseArrayData(i,a,t,n):kt(a[t])?f=this.parseObjectData(i,a,t,n):f=this.parsePrimitiveData(i,a,t,n);let p=()=>h[c]===null||l&&h[c]<l[c];for(d=0;d<n;++d)i._parsed[d+t]=h=f[d],u&&(p()&&(u=!1),l=h);i._sorted=u}s&&v1(this,f)}parsePrimitiveData(t,n,i,a){let{iScale:o,vScale:s}=t,c=o.axis,u=s.axis,l=o.getLabels(),d=o===s,h=new Array(a),f,p,m;for(f=0,p=a;f<p;++f)m=f+i,h[f]={[c]:d||o.parse(l[m],m),[u]:s.parse(n[m],m)};return h}parseArrayData(t,n,i,a){let{xScale:o,yScale:s}=t,c=new Array(a),u,l,d,h;for(u=0,l=a;u<l;++u)d=u+i,h=n[d],c[u]={x:o.parse(h[0],d),y:s.parse(h[1],d)};return c}parseObjectData(t,n,i,a){let{xScale:o,yScale:s}=t,{xAxisKey:c="x",yAxisKey:u="y"}=this._parsing,l=new Array(a),d,h,f,p;for(d=0,h=a;d<h;++d)f=d+i,p=n[f],l[d]={x:o.parse($r(p,c),f),y:s.parse($r(p,u),f)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){let a=this.chart,o=this._cachedMeta,s=n[t.axis],c={keys:fw(a,!0),values:n._stacks[t.axis]._visualValues};return p1(c,s,o.index,{mode:i})}updateRangeFromParsed(t,n,i,a){let o=i[n.axis],s=o===null?NaN:o,c=a&&i._stacks[n.axis];a&&c&&(a.values=c,s=p1(a,o,this._cachedMeta.index)),t.min=Math.min(t.min,s),t.max=Math.max(t.max,s)}getMinMax(t,n){let i=this._cachedMeta,a=i._parsed,o=i._sorted&&t===i.iScale,s=a.length,c=this._getOtherScale(t),u=IR(n,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:h}=ER(c),f,p;function m(){p=a[f];let g=p[c.axis];return!le(p[t.axis])||d>g||h<g}for(f=0;f<s&&!(!m()&&(this.updateRangeFromParsed(l,t,p,u),o));++f);if(o){for(f=s-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(l,t,p,u);break}}return l}getAllParsedValues(t){let n=this._cachedMeta._parsed,i=[],a,o,s;for(a=0,o=n.length;a<o;++a)s=n[a][t.axis],le(s)&&i.push(s);return i}getMaxOverflow(){return!1}getLabelAndValue(t){let n=this._cachedMeta,i=n.iScale,a=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:a?""+a.getLabelForValue(o[a.axis]):""}}_update(t){let n=this._cachedMeta;this.update(t||"default"),n._clip=wR(_t(this.options.clip,_R(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){let t=this._ctx,n=this.chart,i=this._cachedMeta,a=i.data||[],o=n.chartArea,s=[],c=this._drawStart||0,u=this._drawCount||a.length-c,l=this.options.drawActiveElementsOnTop,d;for(i.dataset&&i.dataset.draw(t,o,c,u),d=c;d<c+u;++d){let h=a[d];h.hidden||(h.active&&l?s.push(h):h.draw(t,o))}for(d=0;d<s.length;++d)s[d].draw(t,o)}getStyle(t,n){let i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){let a=this.getDataset(),o;if(t>=0&&t<this._cachedMeta.data.length){let s=this._cachedMeta.data[t];o=s.$context||(s.$context=AR(this.getContext(),t,s)),o.parsed=this.getParsed(t),o.raw=a.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=DR(this.chart.getContext(),this.index)),o.dataset=a,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){let a=n==="active",o=this._cachedDataOpts,s=t+"-"+n,c=o[s],u=this.enableOptionSharing&&Eo(i);if(c)return b1(c,u);let l=this.chart.config,d=l.datasetElementScopeKeys(this._type,t),h=a?[`${t}Hover`,"hover",t,""]:[t,""],f=l.getOptionScopes(this.getDataset(),d),p=Object.keys(de.elements[t]),m=()=>this.getContext(i,a,n),g=l.resolveNamedOptions(f,p,m,h);return g.$shared&&(g.$shared=u,o[s]=Object.freeze(b1(g,u))),g}_resolveAnimations(t,n,i){let a=this.chart,o=this._cachedDataOpts,s=`animation-${n}`,c=o[s];if(c)return c;let u;if(a.options.animation!==!1){let d=this.chart.config,h=d.datasetAnimationScopeKeys(this._type,n),f=d.getOptionScopes(this.getDataset(),h);u=d.createResolver(f,this.getContext(t,i,n))}let l=new Hl(a,u&&u.animations);return u&&u._cacheable&&(o[s]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||Dp(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){let i=this.resolveDataElementOptions(t,n),a=this._sharedOptions,o=this.getSharedOptions(i),s=this.includeOptions(n,o)||o!==a;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:s}}updateElement(t,n,i,a){Dp(a)?Object.assign(t,i):this._resolveAnimations(n,a).update(t,i)}updateSharedOptions(t,n,i){t&&!Dp(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,a){t.active=a;let o=this.getStyle(n,a);this._resolveAnimations(n,i,a).update(t,{options:!a&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){let t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){let t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){let n=this._data,i=this._cachedMeta.data;for(let[c,u,l]of this._syncList)this[c](u,l);this._syncList=[];let a=i.length,o=n.length,s=Math.min(o,a);s&&this.parse(0,s),o>a?this._insertElements(a,o-a,t):o<a&&this._removeElements(o,a-o)}_insertElements(t,n,i=!0){let a=this._cachedMeta,o=a.data,s=t+n,c,u=l=>{for(l.length+=n,c=l.length-1;c>=s;c--)l[c]=l[c-n]};for(u(o),c=t;c<s;++c)o[c]=new this.dataElementType;this._parsing&&u(a._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,a){}_removeElements(t,n){let i=this._cachedMeta;if(this._parsing){let a=i._parsed.splice(t,n);i._stacked&&Qs(i,a)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{let[n,i,a]=t;this[n](i,a)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){let t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);let i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return r})();function MR(r,e){if(!r._cache.$bar){let t=r.getMatchingVisibleMetas(e),n=[];for(let i=0,a=t.length;i<a;i++)n=n.concat(t[i].controller.getAllParsedValues(r));r._cache.$bar=op(n.sort((i,a)=>i-a))}return r._cache.$bar}function RR(r){let e=r.iScale,t=MR(e,r.type),n=e._length,i,a,o,s,c=()=>{o===32767||o===-32768||(Eo(s)&&(n=Math.min(n,Math.abs(o-s)||n)),s=o)};for(i=0,a=t.length;i<a;++i)o=e.getPixelForValue(t[i]),c();for(s=void 0,i=0,a=e.ticks.length;i<a;++i)o=e.getPixelForTick(i),c();return n}function TR(r,e,t,n){let i=t.barThickness,a,o;return Ft(i)?(a=e.min*t.categoryPercentage,o=t.barPercentage):(a=i*n,o=1),{chunk:a/n,ratio:o,start:e.pixels[r]-a/2}}function FR(r,e,t,n){let i=e.pixels,a=i[r],o=r>0?i[r-1]:null,s=r<i.length-1?i[r+1]:null,c=t.categoryPercentage;o===null&&(o=a-(s===null?e.end-e.start:s-a)),s===null&&(s=a+a-o);let u=a-(a-Math.min(o,s))/2*c;return{chunk:Math.abs(s-o)/2*c/n,ratio:t.barPercentage,start:u}}function PR(r,e,t,n){let i=t.parse(r[0],n),a=t.parse(r[1],n),o=Math.min(i,a),s=Math.max(i,a),c=o,u=s;Math.abs(o)>Math.abs(s)&&(c=s,u=o),e[t.axis]=u,e._custom={barStart:c,barEnd:u,start:i,end:a,min:o,max:s}}function pw(r,e,t,n){return $t(r)?PR(r,e,t,n):e[t.axis]=t.parse(r,n),e}function y1(r,e,t,n){let i=r.iScale,a=r.vScale,o=i.getLabels(),s=i===a,c=[],u,l,d,h;for(u=t,l=t+n;u<l;++u)h=e[u],d={},d[i.axis]=s||i.parse(o[u],u),c.push(pw(h,d,a,u));return c}function Ap(r){return r&&r.barStart!==void 0&&r.barEnd!==void 0}function OR(r,e,t){return r!==0?Qn(r):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function NR(r){let e,t,n,i,a;return r.horizontal?(e=r.base>r.x,t="left",n="right"):(e=r.base<r.y,t="bottom",n="top"),e?(i="end",a="start"):(i="start",a="end"),{start:t,end:n,reverse:e,top:i,bottom:a}}function LR(r,e,t,n){let i=e.borderSkipped,a={};if(!i){r.borderSkipped=a;return}if(i===!0){r.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:o,end:s,reverse:c,top:u,bottom:l}=NR(r);i==="middle"&&t&&(r.enableBorderRadius=!0,(t._top||0)===n?i=u:(t._bottom||0)===n?i=l:(a[x1(l,o,s,c)]=!0,i=u)),a[x1(i,o,s,c)]=!0,r.borderSkipped=a}function x1(r,e,t,n){return n?(r=BR(r,e,t),r=_1(r,t,e)):r=_1(r,e,t),r}function BR(r,e,t){return r===e?t:r===t?e:r}function _1(r,e,t){return r==="start"?e:r==="end"?t:r}function VR(r,{inflateAmount:e},t){r.inflateAmount=e==="auto"?t===1?.33:0:e}var WR=(()=>{class r extends Ri{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,n,i,a){return y1(t,n,i,a)}parseArrayData(t,n,i,a){return y1(t,n,i,a)}parseObjectData(t,n,i,a){let{iScale:o,vScale:s}=t,{xAxisKey:c="x",yAxisKey:u="y"}=this._parsing,l=o.axis==="x"?c:u,d=s.axis==="x"?c:u,h=[],f,p,m,g;for(f=i,p=i+a;f<p;++f)g=n[f],m={},m[o.axis]=o.parse($r(g,l),f),h.push(pw($r(g,d),m,s,f));return h}updateRangeFromParsed(t,n,i,a){super.updateRangeFromParsed(t,n,i,a);let o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){let n=this._cachedMeta,{iScale:i,vScale:a}=n,o=this.getParsed(t),s=o._custom,c=Ap(s)?"["+s.start+", "+s.end+"]":""+a.getLabelForValue(o[a.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:c}}initialize(){this.enableOptionSharing=!0,super.initialize();let t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){let n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,a){let o=a==="reset",{index:s,_cachedMeta:{vScale:c}}=this,u=c.getBasePixel(),l=c.isHorizontal(),d=this._getRuler(),{sharedOptions:h,includeOptions:f}=this._getSharedOptions(n,a);for(let p=n;p<n+i;p++){let m=this.getParsed(p),g=o||Ft(m[c.axis])?{base:u,head:u}:this._calculateBarValuePixels(p),v=this._calculateBarIndexPixels(p,d),b=(m._stacks||{})[c.axis],_={horizontal:l,base:g.base,enableBorderRadius:!b||Ap(m._custom)||s===b._top||s===b._bottom,x:l?g.head:v.center,y:l?v.center:g.head,height:l?v.size:Math.abs(g.size),width:l?Math.abs(g.size):v.size};f&&(_.options=h||this.resolveDataElementOptions(p,t[p].active?"active":a));let y=_.options||t[p].options;LR(_,y,b,s),VR(_,y,d.ratio),this.updateElement(t[p],p,_,a)}}_getStacks(t,n){let{iScale:i}=this._cachedMeta,a=i.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),o=i.options.stacked,s=[],c=u=>{let l=u.controller.getParsed(n),d=l&&l[u.vScale.axis];if(Ft(d)||isNaN(d))return!0};for(let u of a)if(!(n!==void 0&&c(u))&&((o===!1||s.indexOf(u.stack)===-1||o===void 0&&u.stack===void 0)&&s.push(u.stack),u.index===t))break;return s.length||s.push(void 0),s}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,n,i){let a=this._getStacks(t,i),o=n!==void 0?a.indexOf(n):-1;return o===-1?a.length-1:o}_getRuler(){let t=this.options,n=this._cachedMeta,i=n.iScale,a=[],o,s;for(o=0,s=n.data.length;o<s;++o)a.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));let c=t.barThickness;return{min:c||RR(n),pixels:a,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:c?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){let{_cachedMeta:{vScale:n,_stacked:i,index:a},options:{base:o,minBarLength:s}}=this,c=o||0,u=this.getParsed(t),l=u._custom,d=Ap(l),h=u[n.axis],f=0,p=i?this.applyStack(n,u,i):h,m,g;p!==h&&(f=p-h,p=h),d&&(h=l.barStart,p=l.barEnd-l.barStart,h!==0&&Qn(h)!==Qn(l.barEnd)&&(f=0),f+=h);let v=!Ft(o)&&!d?o:f,b=n.getPixelForValue(v);if(this.chart.getDataVisibility(t)?m=n.getPixelForValue(f+p):m=b,g=m-b,Math.abs(g)<s){g=OR(g,n,c)*s,h===c&&(b-=g/2);let _=n.getPixelForDecimal(0),y=n.getPixelForDecimal(1),x=Math.min(_,y),w=Math.max(_,y);b=Math.max(Math.min(b,w),x),m=b+g,i&&!d&&(u._stacks[n.axis]._visualValues[a]=n.getValueForPixel(m)-n.getValueForPixel(b))}if(b===n.getPixelForValue(c)){let _=Qn(g)*n.getLineWidthForValue(c)/2;b+=_,g-=_}return{size:g,base:b,head:m,center:m+g/2}}_calculateBarIndexPixels(t,n){let i=n.scale,a=this.options,o=a.skipNull,s=_t(a.maxBarThickness,1/0),c,u;if(n.grouped){let l=o?this._getStackCount(t):n.stackCount,d=a.barThickness==="flex"?FR(t,n,a,l):TR(t,n,a,l),h=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0);c=d.start+d.chunk*h+d.chunk/2,u=Math.min(s,d.chunk*d.ratio)}else c=i.getPixelForValue(this.getParsed(t)[i.axis],t),u=Math.min(s,n.min*n.ratio);return{base:c-u/2,head:c+u/2,center:c,size:u}}draw(){let t=this._cachedMeta,n=t.vScale,i=t.data,a=i.length,o=0;for(;o<a;++o)this.getParsed(o)[n.axis]!==null&&i[o].draw(this._ctx)}}return r})(),zR=(()=>{class r extends Ri{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,a){let o=super.parsePrimitiveData(t,n,i,a);for(let s=0;s<o.length;s++)o[s]._custom=this.resolveDataElementOptions(s+i).radius;return o}parseArrayData(t,n,i,a){let o=super.parseArrayData(t,n,i,a);for(let s=0;s<o.length;s++){let c=n[i+s];o[s]._custom=_t(c[2],this.resolveDataElementOptions(s+i).radius)}return o}parseObjectData(t,n,i,a){let o=super.parseObjectData(t,n,i,a);for(let s=0;s<o.length;s++){let c=n[i+s];o[s]._custom=_t(c&&c.r&&+c.r,this.resolveDataElementOptions(s+i).radius)}return o}getMaxOverflow(){let t=this._cachedMeta.data,n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:a,yScale:o}=n,s=this.getParsed(t),c=a.getLabelForValue(s.x),u=o.getLabelForValue(s.y),l=s._custom;return{label:i[t]||"",value:"("+c+", "+u+(l?", "+l:"")+")"}}update(t){let n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,a){let o=a==="reset",{iScale:s,vScale:c}=this._cachedMeta,{sharedOptions:u,includeOptions:l}=this._getSharedOptions(n,a),d=s.axis,h=c.axis;for(let f=n;f<n+i;f++){let p=t[f],m=!o&&this.getParsed(f),g={},v=g[d]=o?s.getPixelForDecimal(.5):s.getPixelForValue(m[d]),b=g[h]=o?c.getBasePixel():c.getPixelForValue(m[h]);g.skip=isNaN(v)||isNaN(b),l&&(g.options=u||this.resolveDataElementOptions(f,p.active?"active":a),o&&(g.options.radius=0)),this.updateElement(p,f,g,a)}}resolveDataElementOptions(t,n){let i=this.getParsed(t),a=super.resolveDataElementOptions(t,n);a.$shared&&(a=Object.assign({},a,{$shared:!1}));let o=a.radius;return n!=="active"&&(a.radius=0),a.radius+=_t(i&&i._custom,o),a}}return r})();function jR(r,e,t){let n=1,i=1,a=0,o=0;if(e<Jt){let s=r,c=s+e,u=Math.cos(s),l=Math.sin(s),d=Math.cos(c),h=Math.sin(c),f=(_,y,x)=>Do(_,s,c,!0)?1:Math.max(y,y*t,x,x*t),p=(_,y,x)=>Do(_,s,c,!0)?-1:Math.min(y,y*t,x,x*t),m=f(0,u,d),g=f(ve,l,h),v=p(Qt,u,d),b=p(Qt+ve,l,h);n=(m-v)/2,i=(g-b)/2,a=-(m+v)/2,o=-(g+b)/2}return{ratioX:n,ratioY:i,offsetX:a,offsetY:o}}var nm=(()=>{class r extends Ri{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){let n=t.data;if(n.labels.length&&n.datasets.length){let{labels:{pointStyle:i,color:a}}=t.legend.options;return n.labels.map((o,s)=>{let u=t.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:u.backgroundColor,strokeStyle:u.borderColor,fontColor:a,lineWidth:u.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}};constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){let i=this.getDataset().data,a=this._cachedMeta;if(this._parsing===!1)a._parsed=i;else{let o=u=>+i[u];if(kt(i[t])){let{key:u="value"}=this._parsing;o=l=>+$r(i[l],u)}let s,c;for(s=t,c=t+n;s<c;++s)a._parsed[s]=o(s)}}_getRotation(){return Bn(this.options.rotation-90)}_getCircumference(){return Bn(this.options.circumference)}_getRotationExtents(){let t=Jt,n=-Jt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){let a=this.chart.getDatasetMeta(i).controller,o=a._getRotation(),s=a._getCircumference();t=Math.min(t,o),n=Math.max(n,o+s)}return{rotation:t,circumference:n-t}}update(t){let n=this.chart,{chartArea:i}=n,a=this._cachedMeta,o=a.data,s=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,c=Math.max((Math.min(i.width,i.height)-s)/2,0),u=Math.min(B_(this.options.cutout,c),1),l=this._getRingWeight(this.index),{circumference:d,rotation:h}=this._getRotationExtents(),{ratioX:f,ratioY:p,offsetX:m,offsetY:g}=jR(h,d,u),v=(i.width-s)/f,b=(i.height-s)/p,_=Math.max(Math.min(v,b)/2,0),y=Zf(this.options.radius,_),x=Math.max(y*u,0),w=(y-x)/this._getVisibleDatasetWeightTotal();this.offsetX=m*y,this.offsetY=g*y,a.total=this.calculateTotal(),this.outerRadius=y-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*l,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){let i=this.options,a=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||a._parsed[t]===null||a.data[t].hidden?0:this.calculateCircumference(a._parsed[t]*o/Jt)}updateElements(t,n,i,a){let o=a==="reset",s=this.chart,c=s.chartArea,l=s.options.animation,d=(c.left+c.right)/2,h=(c.top+c.bottom)/2,f=o&&l.animateScale,p=f?0:this.innerRadius,m=f?0:this.outerRadius,{sharedOptions:g,includeOptions:v}=this._getSharedOptions(n,a),b=this._getRotation(),_;for(_=0;_<n;++_)b+=this._circumference(_,o);for(_=n;_<n+i;++_){let y=this._circumference(_,o),x=t[_],w={x:d+this.offsetX,y:h+this.offsetY,startAngle:b,endAngle:b+y,circumference:y,outerRadius:m,innerRadius:p};v&&(w.options=g||this.resolveDataElementOptions(_,x.active?"active":a)),b+=y,this.updateElement(x,_,w,a)}}calculateTotal(){let t=this._cachedMeta,n=t.data,i=0,a;for(a=0;a<n.length;a++){let o=t._parsed[a];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(a)&&!n[a].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){let n=this._cachedMeta.total;return n>0&&!isNaN(t)?Jt*(Math.abs(t)/n):0}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart,a=i.data.labels||[],o=Ao(n._parsed[t],i.options.locale);return{label:a[t]||"",value:o}}getMaxBorderWidth(t){let n=0,i=this.chart,a,o,s,c,u;if(!t){for(a=0,o=i.data.datasets.length;a<o;++a)if(i.isDatasetVisible(a)){s=i.getDatasetMeta(a),t=s.data,c=s.controller;break}}if(!t)return 0;for(a=0,o=t.length;a<o;++a)u=c.resolveDataElementOptions(a),u.borderAlign!=="inner"&&(n=Math.max(n,u.borderWidth||0,u.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,a=t.length;i<a;++i){let o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(_t(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return r})(),HR=(()=>{class r extends Ri{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){let n=this._cachedMeta,{dataset:i,data:a=[],_dataset:o}=n,s=this.chart._animationsDisabled,{start:c,count:u}=up(n,a,s);this._drawStart=c,this._drawCount=u,lp(n)&&(c=0,u=a.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=a;let l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!s,options:l},t),this.updateElements(a,c,u,t)}updateElements(t,n,i,a){let o=a==="reset",{iScale:s,vScale:c,_stacked:u,_dataset:l}=this._cachedMeta,{sharedOptions:d,includeOptions:h}=this._getSharedOptions(n,a),f=s.axis,p=c.axis,{spanGaps:m,segment:g}=this.options,v=la(m)?m:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||a==="none",_=n+i,y=t.length,x=n>0&&this.getParsed(n-1);for(let w=0;w<y;++w){let S=t[w],C=b?S:{};if(w<n||w>=_){C.skip=!0;continue}let E=this.getParsed(w),D=Ft(E[p]),R=C[f]=s.getPixelForValue(E[f],w),M=C[p]=o||D?c.getBasePixel():c.getPixelForValue(u?this.applyStack(c,E,u):E[p],w);C.skip=isNaN(R)||isNaN(M)||D,C.stop=w>0&&Math.abs(E[f]-x[f])>v,g&&(C.parsed=E,C.raw=l.data[w]),h&&(C.options=d||this.resolveDataElementOptions(w,S.active?"active":a)),b||this.updateElement(S,w,C,a),x=E}}getMaxOverflow(){let t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,a=t.data||[];if(!a.length)return i;let o=a[0].size(this.resolveDataElementOptions(0)),s=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(i,o,s)/2}draw(){let t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}return r})(),mw=(()=>{class r extends Ri{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){let n=t.data;if(n.labels.length&&n.datasets.length){let{labels:{pointStyle:i,color:a}}=t.legend.options;return n.labels.map((o,s)=>{let u=t.getDatasetMeta(0).controller.getStyle(s);return{text:o,fillStyle:u.backgroundColor,strokeStyle:u.borderColor,fontColor:a,lineWidth:u.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){let n=this._cachedMeta,i=this.chart,a=i.data.labels||[],o=Ao(n._parsed[t].r,i.options.locale);return{label:a[t]||"",value:o}}parseObjectData(t,n,i,a){return yp.bind(this)(t,n,i,a)}update(t){let n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){let t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,a)=>{let o=this.getParsed(a).r;!isNaN(o)&&this.chart.getDataVisibility(a)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){let t=this.chart,n=t.chartArea,i=t.options,a=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(a/2,0),s=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),c=(o-s)/t.getVisibleDatasetCount();this.outerRadius=o-c*this.index,this.innerRadius=this.outerRadius-c}updateElements(t,n,i,a){let o=a==="reset",s=this.chart,u=s.options.animation,l=this._cachedMeta.rScale,d=l.xCenter,h=l.yCenter,f=l.getIndexAngle(0)-.5*Qt,p=f,m,g=360/this.countVisibleElements();for(m=0;m<n;++m)p+=this._computeAngle(m,a,g);for(m=n;m<n+i;m++){let v=t[m],b=p,_=p+this._computeAngle(m,a,g),y=s.getDataVisibility(m)?l.getDistanceFromCenterForValue(this.getParsed(m).r):0;p=_,o&&(u.animateScale&&(y=0),u.animateRotate&&(b=_=f));let x={x:d,y:h,innerRadius:0,outerRadius:y,startAngle:b,endAngle:_,options:this.resolveDataElementOptions(m,v.active?"active":a)};this.updateElement(v,m,x,a)}}countVisibleElements(){let t=this._cachedMeta,n=0;return t.data.forEach((i,a)=>{!isNaN(this.getParsed(a).r)&&this.chart.getDataVisibility(a)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?Bn(this.resolveDataElementOptions(t,n).angle||i):0}}return r})(),UR=(()=>{class r extends nm{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}return r})(),GR=(()=>{class r extends Ri{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){let n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,a){return yp.bind(this)(t,n,i,a)}update(t){let n=this._cachedMeta,i=n.dataset,a=n.data||[],o=n.iScale.getLabels();if(i.points=a,t!=="resize"){let s=this.resolveDatasetElementOptions(t);this.options.showLine||(s.borderWidth=0);let c={_loop:!0,_fullLoop:o.length===a.length,options:s};this.updateElement(i,void 0,c,t)}this.updateElements(a,0,a.length,t)}updateElements(t,n,i,a){let o=this._cachedMeta.rScale,s=a==="reset";for(let c=n;c<n+i;c++){let u=t[c],l=this.resolveDataElementOptions(c,u.active?"active":a),d=o.getPointPositionForValue(c,this.getParsed(c).r),h=s?o.xCenter:d.x,f=s?o.yCenter:d.y,p={x:h,y:f,angle:d.angle,skip:isNaN(h)||isNaN(f),options:l};this.updateElement(u,c,p,a)}}}return r})(),qR=(()=>{class r extends Ri{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){let n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:a,yScale:o}=n,s=this.getParsed(t),c=a.getLabelForValue(s.x),u=o.getLabelForValue(s.y);return{label:i[t]||"",value:"("+c+", "+u+")"}}update(t){let n=this._cachedMeta,{data:i=[]}=n,a=this.chart._animationsDisabled,{start:o,count:s}=up(n,i,a);if(this._drawStart=o,this._drawCount=s,lp(n)&&(o=0,s=i.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:c,_dataset:u}=n;c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!u._decimated,c.points=i;let l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(c,void 0,{animated:!a,options:l},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,s,t)}addElements(){let{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,a){let o=a==="reset",{iScale:s,vScale:c,_stacked:u,_dataset:l}=this._cachedMeta,d=this.resolveDataElementOptions(n,a),h=this.getSharedOptions(d),f=this.includeOptions(a,h),p=s.axis,m=c.axis,{spanGaps:g,segment:v}=this.options,b=la(g)?g:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||o||a==="none",y=n>0&&this.getParsed(n-1);for(let x=n;x<n+i;++x){let w=t[x],S=this.getParsed(x),C=_?w:{},E=Ft(S[m]),D=C[p]=s.getPixelForValue(S[p],x),R=C[m]=o||E?c.getBasePixel():c.getPixelForValue(u?this.applyStack(c,S,u):S[m],x);C.skip=isNaN(D)||isNaN(R)||E,C.stop=x>0&&Math.abs(S[p]-y[p])>b,v&&(C.parsed=S,C.raw=l.data[x]),f&&(C.options=h||this.resolveDataElementOptions(x,w.active?"active":a)),_||this.updateElement(w,x,C,a),y=S}this.updateSharedOptions(h,a,d)}getMaxOverflow(){let t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let c=0;for(let u=n.length-1;u>=0;--u)c=Math.max(c,n[u].size(this.resolveDataElementOptions(u))/2);return c>0&&c}let i=t.dataset,a=i.options&&i.options.borderWidth||0;if(!n.length)return a;let o=n[0].size(this.resolveDataElementOptions(0)),s=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(a,o,s)/2}}return r})(),YR=Object.freeze({__proto__:null,BarController:WR,BubbleController:zR,DoughnutController:nm,LineController:HR,PieController:UR,PolarAreaController:mw,RadarController:GR,ScatterController:qR});function ha(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var Lp=class r{static override(e){Object.assign(r.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return ha()}parse(){return ha()}format(){return ha()}add(){return ha()}diff(){return ha()}startOf(){return ha()}endOf(){return ha()}},KR={_date:Lp};function XR(r,e,t,n){let{controller:i,data:a,_sorted:o}=r,s=i._cachedMeta.iScale;if(s&&e===s.axis&&e!=="r"&&o&&a.length){let c=s._reversePixels?U_:br;if(n){if(i._sharedOptions){let u=a[0],l=typeof u.getRange=="function"&&u.getRange(e);if(l){let d=c(a,e,t-l),h=c(a,e,t+l);return{lo:d.lo,hi:h.hi}}}}else return c(a,e,t)}return{lo:0,hi:a.length-1}}function sc(r,e,t,n,i){let a=r.getSortedVisibleDatasetMetas(),o=t[e];for(let s=0,c=a.length;s<c;++s){let{index:u,data:l}=a[s],{lo:d,hi:h}=XR(a[s],e,o,i);for(let f=d;f<=h;++f){let p=l[f];p.skip||n(p,u,f)}}}function $R(r){let e=r.indexOf("x")!==-1,t=r.indexOf("y")!==-1;return function(n,i){let a=e?Math.abs(n.x-i.x):0,o=t?Math.abs(n.y-i.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}}function Ip(r,e,t,n,i){let a=[];return!i&&!r.isPointInArea(e)||sc(r,t,e,function(s,c,u){!i&&!yr(s,r.chartArea,0)||s.inRange(e.x,e.y,n)&&a.push({element:s,datasetIndex:c,index:u})},!0),a}function QR(r,e,t,n){let i=[];function a(o,s,c){let{startAngle:u,endAngle:l}=o.getProps(["startAngle","endAngle"],n),{angle:d}=ip(o,{x:e.x,y:e.y});Do(d,u,l)&&i.push({element:o,datasetIndex:s,index:c})}return sc(r,t,e,a),i}function JR(r,e,t,n,i,a){let o=[],s=$R(t),c=Number.POSITIVE_INFINITY;function u(l,d,h){let f=l.inRange(e.x,e.y,i);if(n&&!f)return;let p=l.getCenterPoint(i);if(!(!!a||r.isPointInArea(p))&&!f)return;let g=s(e,p);g<c?(o=[{element:l,datasetIndex:d,index:h}],c=g):g===c&&o.push({element:l,datasetIndex:d,index:h})}return sc(r,t,e,u),o}function Mp(r,e,t,n,i,a){return!a&&!r.isPointInArea(e)?[]:t==="r"&&!n?QR(r,e,t,i):JR(r,e,t,n,i,a)}function w1(r,e,t,n,i){let a=[],o=t==="x"?"inXRange":"inYRange",s=!1;return sc(r,t,e,(c,u,l)=>{c[o](e[t],i)&&(a.push({element:c,datasetIndex:u,index:l}),s=s||c.inRange(e.x,e.y,i))}),n&&!s?[]:a}var ZR={evaluateInteractionItems:sc,modes:{index(r,e,t,n){let i=Ii(e,r),a=t.axis||"x",o=t.includeInvisible||!1,s=t.intersect?Ip(r,i,a,n,o):Mp(r,i,a,!1,n,o),c=[];return s.length?(r.getSortedVisibleDatasetMetas().forEach(u=>{let l=s[0].index,d=u.data[l];d&&!d.skip&&c.push({element:d,datasetIndex:u.index,index:l})}),c):[]},dataset(r,e,t,n){let i=Ii(e,r),a=t.axis||"xy",o=t.includeInvisible||!1,s=t.intersect?Ip(r,i,a,n,o):Mp(r,i,a,!1,n,o);if(s.length>0){let c=s[0].datasetIndex,u=r.getDatasetMeta(c).data;s=[];for(let l=0;l<u.length;++l)s.push({element:u[l],datasetIndex:c,index:l})}return s},point(r,e,t,n){let i=Ii(e,r),a=t.axis||"xy",o=t.includeInvisible||!1;return Ip(r,i,a,n,o)},nearest(r,e,t,n){let i=Ii(e,r),a=t.axis||"xy",o=t.includeInvisible||!1;return Mp(r,i,a,t.intersect,n,o)},x(r,e,t,n){let i=Ii(e,r);return w1(r,i,"x",t.intersect,n)},y(r,e,t,n){let i=Ii(e,r);return w1(r,i,"y",t.intersect,n)}}},gw=["left","top","right","bottom"];function Js(r,e){return r.filter(t=>t.pos===e)}function C1(r,e){return r.filter(t=>gw.indexOf(t.pos)===-1&&t.box.axis===e)}function Zs(r,e){return r.sort((t,n)=>{let i=e?n:t,a=e?t:n;return i.weight===a.weight?i.index-a.index:i.weight-a.weight})}function tT(r){let e=[],t,n,i,a,o,s;for(t=0,n=(r||[]).length;t<n;++t)i=r[t],{position:a,options:{stack:o,stackWeight:s=1}}=i,e.push({index:t,box:i,pos:a,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&a+o,stackWeight:s});return e}function eT(r){let e={};for(let t of r){let{stack:n,pos:i,stackWeight:a}=t;if(!n||!gw.includes(i))continue;let o=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=a}return e}function nT(r,e){let t=eT(r),{vBoxMaxWidth:n,hBoxMaxHeight:i}=e,a,o,s;for(a=0,o=r.length;a<o;++a){s=r[a];let{fullSize:c}=s.box,u=t[s.stack],l=u&&s.stackWeight/u.weight;s.horizontal?(s.width=l?l*n:c&&e.availableWidth,s.height=i):(s.width=n,s.height=l?l*i:c&&e.availableHeight)}return t}function rT(r){let e=tT(r),t=Zs(e.filter(u=>u.box.fullSize),!0),n=Zs(Js(e,"left"),!0),i=Zs(Js(e,"right")),a=Zs(Js(e,"top"),!0),o=Zs(Js(e,"bottom")),s=C1(e,"x"),c=C1(e,"y");return{fullSize:t,leftAndTop:n.concat(a),rightAndBottom:i.concat(c).concat(o).concat(s),chartArea:Js(e,"chartArea"),vertical:n.concat(i).concat(c),horizontal:a.concat(o).concat(s)}}function S1(r,e,t,n){return Math.max(r[t],e[t])+Math.max(r[n],e[n])}function vw(r,e){r.top=Math.max(r.top,e.top),r.left=Math.max(r.left,e.left),r.bottom=Math.max(r.bottom,e.bottom),r.right=Math.max(r.right,e.right)}function iT(r,e,t,n){let{pos:i,box:a}=t,o=r.maxPadding;if(!kt(i)){t.size&&(r[i]-=t.size);let d=n[t.stack]||{size:0,count:1};d.size=Math.max(d.size,t.horizontal?a.height:a.width),t.size=d.size/d.count,r[i]+=t.size}a.getPadding&&vw(o,a.getPadding());let s=Math.max(0,e.outerWidth-S1(o,r,"left","right")),c=Math.max(0,e.outerHeight-S1(o,r,"top","bottom")),u=s!==r.w,l=c!==r.h;return r.w=s,r.h=c,t.horizontal?{same:u,other:l}:{same:l,other:u}}function aT(r){let e=r.maxPadding;function t(n){let i=Math.max(e[n]-r[n],0);return r[n]+=i,i}r.y+=t("top"),r.x+=t("left"),t("right"),t("bottom")}function oT(r,e){let t=e.maxPadding;function n(i){let a={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{a[o]=Math.max(e[o],t[o])}),a}return n(r?["left","right"]:["top","bottom"])}function nc(r,e,t,n){let i=[],a,o,s,c,u,l;for(a=0,o=r.length,u=0;a<o;++a){s=r[a],c=s.box,c.update(s.width||e.w,s.height||e.h,oT(s.horizontal,e));let{same:d,other:h}=iT(e,t,s,n);u|=d&&i.length,l=l||h,c.fullSize||i.push(s)}return u&&nc(i,e,t,n)||l}function Pl(r,e,t,n,i){r.top=t,r.left=e,r.right=e+n,r.bottom=t+i,r.width=n,r.height=i}function E1(r,e,t,n){let i=t.padding,{x:a,y:o}=e;for(let s of r){let c=s.box,u=n[s.stack]||{count:1,placed:0,weight:1},l=s.stackWeight/u.weight||1;if(s.horizontal){let d=e.w*l,h=u.size||c.height;Eo(u.start)&&(o=u.start),c.fullSize?Pl(c,i.left,o,t.outerWidth-i.right-i.left,h):Pl(c,e.left+u.placed,o,d,h),u.start=o,u.placed+=d,o=c.bottom}else{let d=e.h*l,h=u.size||c.width;Eo(u.start)&&(a=u.start),c.fullSize?Pl(c,a,i.top,h,t.outerHeight-i.bottom-i.top):Pl(c,a,e.top+u.placed,h,d),u.start=a,u.placed+=d,a=c.right}}e.x=a,e.y=o}var tn={addBox(r,e){r.boxes||(r.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},r.boxes.push(e)},removeBox(r,e){let t=r.boxes?r.boxes.indexOf(e):-1;t!==-1&&r.boxes.splice(t,1)},configure(r,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(r,e,t,n){if(!r)return;let i=Ke(r.options.layout.padding),a=Math.max(e-i.width,0),o=Math.max(t-i.height,0),s=rT(r.boxes),c=s.vertical,u=s.horizontal;Wt(r.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});let l=c.reduce((m,g)=>g.box.options&&g.box.options.display===!1?m:m+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:a,availableHeight:o,vBoxMaxWidth:a/2/l,hBoxMaxHeight:o/2}),h=Object.assign({},i);vw(h,Ke(n));let f=Object.assign({maxPadding:h,w:a,h:o,x:i.left,y:i.top},i),p=nT(c.concat(u),d);nc(s.fullSize,f,d,p),nc(c,f,d,p),nc(u,f,d,p)&&nc(c,f,d,p),aT(f),E1(s.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,E1(s.rightAndBottom,f,d,p),r.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Wt(s.chartArea,m=>{let g=m.box;Object.assign(g,r.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}},Ul=class{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,i){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):n)}}isAttached(e){return!0}updateConfig(e){}},Bp=class extends Ul{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}},zl="$chartjs",sT={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},k1=r=>r===null||r==="";function cT(r,e){let t=r.style,n=r.getAttribute("height"),i=r.getAttribute("width");if(r[zl]={initial:{height:n,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",k1(i)){let a=_p(r,"width");a!==void 0&&(r.width=a)}if(k1(n))if(r.style.height==="")r.height=r.width/(e||2);else{let a=_p(r,"height");a!==void 0&&(r.height=a)}return r}var bw=s1?{passive:!0}:!1;function uT(r,e,t){r&&r.addEventListener(e,t,bw)}function lT(r,e,t){r&&r.canvas&&r.canvas.removeEventListener(e,t,bw)}function dT(r,e){let t=sT[r.type]||r.type,{x:n,y:i}=Ii(r,e);return{type:t,chart:e,native:r,x:n!==void 0?n:null,y:i!==void 0?i:null}}function Gl(r,e){for(let t of r)if(t===e||t.contains(e))return!0}function hT(r,e,t){let n=r.canvas,i=new MutationObserver(a=>{let o=!1;for(let s of a)o=o||Gl(s.addedNodes,n),o=o&&!Gl(s.removedNodes,n);o&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}function fT(r,e,t){let n=r.canvas,i=new MutationObserver(a=>{let o=!1;for(let s of a)o=o||Gl(s.removedNodes,n),o=o&&!Gl(s.addedNodes,n);o&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}var ic=new Map,D1=0;function yw(){let r=window.devicePixelRatio;r!==D1&&(D1=r,ic.forEach((e,t)=>{t.currentDevicePixelRatio!==r&&e()}))}function pT(r,e){ic.size||window.addEventListener("resize",yw),ic.set(r,e)}function mT(r){ic.delete(r),ic.size||window.removeEventListener("resize",yw)}function gT(r,e,t){let n=r.canvas,i=n&&Tl(n);if(!i)return;let a=cp((s,c)=>{let u=i.clientWidth;t(s,c),u<i.clientWidth&&t()},window),o=new ResizeObserver(s=>{let c=s[0],u=c.contentRect.width,l=c.contentRect.height;u===0&&l===0||a(u,l)});return o.observe(i),pT(r,a),o}function Rp(r,e,t){t&&t.disconnect(),e==="resize"&&mT(r)}function vT(r,e,t){let n=r.canvas,i=cp(a=>{r.ctx!==null&&t(dT(a,r))},r);return uT(n,e,i),i}var Vp=class extends Ul{acquireContext(e,t){let n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(cT(e,t),n):null}releaseContext(e){let t=e.canvas;if(!t[zl])return!1;let n=t[zl].initial;["height","width"].forEach(a=>{let o=n[a];Ft(o)?t.removeAttribute(a):t.setAttribute(a,o)});let i=n.style||{};return Object.keys(i).forEach(a=>{t.style[a]=i[a]}),t.width=t.width,delete t[zl],!0}addEventListener(e,t,n){this.removeEventListener(e,t);let i=e.$proxies||(e.$proxies={}),o={attach:hT,detach:fT,resize:gT}[t]||vT;i[t]=o(e,t,n)}removeEventListener(e,t){let n=e.$proxies||(e.$proxies={}),i=n[t];if(!i)return;({attach:Rp,detach:Rp,resize:Rp}[t]||lT)(e,t,i),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,i){return o1(e,t,n,i)}isAttached(e){let t=Tl(e);return!!(t&&t.isConnected)}};function bT(r){return!Rl()||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?Bp:Vp}var Jn=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){let{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return la(this.x)&&la(this.y)}getProps(e,t){let n=this.$animations;if(!t||!n)return this;let i={};return e.forEach(a=>{i[a]=n[a]&&n[a].active()?n[a]._to:this[a]}),i}};function yT(r,e){let t=r.options.ticks,n=xT(r),i=Math.min(t.maxTicksLimit||n,n),a=t.major.enabled?wT(e):[],o=a.length,s=a[0],c=a[o-1],u=[];if(o>i)return CT(e,u,a,o/i),u;let l=_T(a,e,i);if(o>0){let d,h,f=o>1?Math.round((c-s)/(o-1)):null;for(Ol(e,u,l,Ft(f)?0:s-f,s),d=0,h=o-1;d<h;d++)Ol(e,u,l,a[d],a[d+1]);return Ol(e,u,l,c,Ft(f)?e.length:c+f),u}return Ol(e,u,l),u}function xT(r){let e=r.options.offset,t=r._tickSize(),n=r._length/t+(e?0:1),i=r._maxLength/t;return Math.floor(Math.min(n,i))}function _T(r,e,t){let n=ST(r),i=e.length/t;if(!n)return Math.max(i,1);let a=z_(n);for(let o=0,s=a.length-1;o<s;o++){let c=a[o];if(c>i)return c}return Math.max(i,1)}function wT(r){let e=[],t,n;for(t=0,n=r.length;t<n;t++)r[t].major&&e.push(t);return e}function CT(r,e,t,n){let i=0,a=t[0],o;for(n=Math.ceil(n),o=0;o<r.length;o++)o===a&&(e.push(r[o]),i++,a=t[i*n])}function Ol(r,e,t,n,i){let a=_t(n,0),o=Math.min(_t(i,r.length),r.length),s=0,c,u,l;for(t=Math.ceil(t),i&&(c=i-n,t=c/Math.floor(c/t)),l=a;l<0;)s++,l=Math.round(a+s*t);for(u=Math.max(a,0);u<o;u++)u===l&&(e.push(r[u]),s++,l=Math.round(a+s*t))}function ST(r){let e=r.length,t,n;if(e<2)return!1;for(n=r[0],t=1;t<e;++t)if(r[t]-r[t-1]!==n)return!1;return n}var ET=r=>r==="left"?"right":r==="right"?"left":r,A1=(r,e,t)=>e==="top"||e==="left"?r[e]+t:r[e]-t,I1=(r,e)=>Math.min(e||r,r);function M1(r,e){let t=[],n=r.length/e,i=r.length,a=0;for(;a<i;a+=n)t.push(r[Math.floor(a)]);return t}function kT(r,e,t){let n=r.ticks.length,i=Math.min(e,n-1),a=r._startPixel,o=r._endPixel,s=1e-6,c=r.getPixelForTick(i),u;if(!(t&&(n===1?u=Math.max(c-a,o-c):e===0?u=(r.getPixelForTick(1)-c)/2:u=(c-r.getPixelForTick(i-1))/2,c+=i<e?u:-u,c<a-s||c>o+s)))return c}function DT(r,e){Wt(r,t=>{let n=t.gc,i=n.length/2,a;if(i>e){for(a=0;a<i;++a)delete t.data[n[a]];n.splice(0,i)}})}function tc(r){return r.drawTicks?r.tickLength:0}function R1(r,e){if(!r.display)return 0;let t=Ee(r.font,e),n=Ke(r.padding);return($t(r.text)?r.text.length:1)*t.lineHeight+n.height}function AT(r,e){return Qr(r,{scale:e,type:"scale"})}function IT(r,e,t){return Qr(r,{tick:t,index:e,type:"tick"})}function MT(r,e,t){let n=kl(r);return(t&&e!=="right"||!t&&e==="right")&&(n=ET(n)),n}function RT(r,e,t,n){let{top:i,left:a,bottom:o,right:s,chart:c}=r,{chartArea:u,scales:l}=c,d=0,h,f,p,m=o-i,g=s-a;if(r.isHorizontal()){if(f=Ye(n,a,s),kt(t)){let v=Object.keys(t)[0],b=t[v];p=l[v].getPixelForValue(b)+m-e}else t==="center"?p=(u.bottom+u.top)/2+m-e:p=A1(r,t,e);h=s-a}else{if(kt(t)){let v=Object.keys(t)[0],b=t[v];f=l[v].getPixelForValue(b)-g+e}else t==="center"?f=(u.left+u.right)/2-g+e:f=A1(r,t,e);p=Ye(n,o,i),d=t==="left"?-ve:ve}return{titleX:f,titleY:p,maxWidth:h,rotation:d}}var pa=class r extends Jn{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:i}=this;return e=vn(e,Number.POSITIVE_INFINITY),t=vn(t,Number.NEGATIVE_INFINITY),n=vn(n,Number.POSITIVE_INFINITY),i=vn(i,Number.NEGATIVE_INFINITY),{min:vn(e,n),max:vn(t,i),minDefined:le(e),maxDefined:le(t)}}getMinMax(e){let{min:t,max:n,minDefined:i,maxDefined:a}=this.getUserBounds(),o;if(i&&a)return{min:t,max:n};let s=this.getMatchingVisibleMetas();for(let c=0,u=s.length;c<u;++c)o=s[c].controller.getMinMax(this,e),i||(t=Math.min(t,o.min)),a||(n=Math.max(n,o.max));return t=a&&t>n?n:t,n=i&&t>n?t:n,{min:vn(t,vn(n,t)),max:vn(n,vn(t,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Yt(this.options.beforeUpdate,[this])}update(e,t,n){let{beginAtZero:i,grace:a,ticks:o}=this.options,s=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=t1(this,a,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let c=s<this.ticks.length;this._convertTicksToLabels(c?M1(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=yT(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,n;this.isHorizontal()?(t=this.left,n=this.right):(t=this.top,n=this.bottom,e=!e),this._startPixel=t,this._endPixel=n,this._reversePixels=e,this._length=n-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Yt(this.options.afterUpdate,[this])}beforeSetDimensions(){Yt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Yt(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Yt(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Yt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){let t=this.options.ticks,n,i,a;for(n=0,i=e.length;n<i;n++)a=e[n],a.label=Yt(t.callback,[a.value,n,e],this)}afterTickToLabelConversion(){Yt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Yt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let e=this.options,t=e.ticks,n=I1(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,a=t.maxRotation,o=i,s,c,u;if(!this._isVisible()||!t.display||i>=a||n<=1||!this.isHorizontal()){this.labelRotation=i;return}let l=this._getLabelSizes(),d=l.widest.width,h=l.highest.height,f=Re(this.chart.width-d,0,this.maxWidth);s=e.offset?this.maxWidth/n:f/(n-1),d+6>s&&(s=f/(n-(e.offset?.5:1)),c=this.maxHeight-tc(e.grid)-t.padding-R1(e.title,this.chart.options.font),u=Math.sqrt(d*d+h*h),o=Sl(Math.min(Math.asin(Re((l.highest.height+6)/s,-1,1)),Math.asin(Re(c/u,-1,1))-Math.asin(Re(h/u,-1,1)))),o=Math.max(i,Math.min(a,o))),this.labelRotation=o}afterCalculateLabelRotation(){Yt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Yt(this.options.beforeFit,[this])}fit(){let e={width:0,height:0},{chart:t,options:{ticks:n,title:i,grid:a}}=this,o=this._isVisible(),s=this.isHorizontal();if(o){let c=R1(i,t.options.font);if(s?(e.width=this.maxWidth,e.height=tc(a)+c):(e.height=this.maxHeight,e.width=tc(a)+c),n.display&&this.ticks.length){let{first:u,last:l,widest:d,highest:h}=this._getLabelSizes(),f=n.padding*2,p=Bn(this.labelRotation),m=Math.cos(p),g=Math.sin(p);if(s){let v=n.mirror?0:g*d.width+m*h.height;e.height=Math.min(this.maxHeight,e.height+v+f)}else{let v=n.mirror?0:m*d.width+g*h.height;e.width=Math.min(this.maxWidth,e.width+v+f)}this._calculatePadding(u,l,g,m)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,i){let{ticks:{align:a,padding:o},position:s}=this.options,c=this.labelRotation!==0,u=s!=="top"&&this.axis==="x";if(this.isHorizontal()){let l=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1),h=0,f=0;c?u?(h=i*e.width,f=n*t.height):(h=n*e.height,f=i*t.width):a==="start"?f=t.width:a==="end"?h=e.width:a!=="inner"&&(h=e.width/2,f=t.width/2),this.paddingLeft=Math.max((h-l+o)*this.width/(this.width-l),0),this.paddingRight=Math.max((f-d+o)*this.width/(this.width-d),0)}else{let l=t.height/2,d=e.height/2;a==="start"?(l=0,d=e.height):a==="end"&&(l=t.height,d=0),this.paddingTop=l+o,this.paddingBottom=d+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Yt(this.options.afterFit,[this])}isHorizontal(){let{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,n;for(t=0,n=e.length;t<n;t++)Ft(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){let t=this.options.ticks.sampleSize,n=this.ticks;t<n.length&&(n=M1(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){let{ctx:i,_longestTextCache:a}=this,o=[],s=[],c=Math.floor(t/I1(t,n)),u=0,l=0,d,h,f,p,m,g,v,b,_,y,x;for(d=0;d<t;d+=c){if(p=e[d].label,m=this._resolveTickFontOptions(d),i.font=g=m.string,v=a[g]=a[g]||{data:{},gc:[]},b=m.lineHeight,_=y=0,!Ft(p)&&!$t(p))_=qs(i,v.data,v.gc,_,p),y=b;else if($t(p))for(h=0,f=p.length;h<f;++h)x=p[h],!Ft(x)&&!$t(x)&&(_=qs(i,v.data,v.gc,_,x),y+=b);o.push(_),s.push(y),u=Math.max(_,u),l=Math.max(y,l)}DT(a,t);let w=o.indexOf(u),S=s.indexOf(l),C=E=>({width:o[E]||0,height:s[E]||0});return{first:C(0),last:C(t-1),widest:C(w),highest:C(S),widths:o,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){let t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);let t=this._startPixel+e*this._length;return H_(this._alignToPixels?ki(this.chart,t,0):t)}getDecimalForPixel(e){let t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){let t=this.ticks||[];if(e>=0&&e<t.length){let n=t[e];return n.$context||(n.$context=IT(this.getContext(),e,n))}return this.$context||(this.$context=AT(this.chart.getContext(),this))}_tickSize(){let e=this.options.ticks,t=Bn(this.labelRotation),n=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),a=this._getLabelSizes(),o=e.autoSkipPadding||0,s=a?a.widest.width+o:0,c=a?a.highest.height+o:0;return this.isHorizontal()?c*n>s*i?s/n:c/i:c*i<s*n?c/n:s/i}_isVisible(){let e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){let t=this.axis,n=this.chart,i=this.options,{grid:a,position:o,border:s}=i,c=a.offset,u=this.isHorizontal(),d=this.ticks.length+(c?1:0),h=tc(a),f=[],p=s.setContext(this.getContext()),m=p.display?p.width:0,g=m/2,v=function(z){return ki(n,z,m)},b,_,y,x,w,S,C,E,D,R,M,L;if(o==="top")b=v(this.bottom),S=this.bottom-h,E=b-g,R=v(e.top)+g,L=e.bottom;else if(o==="bottom")b=v(this.top),R=e.top,L=v(e.bottom)-g,S=b+g,E=this.top+h;else if(o==="left")b=v(this.right),w=this.right-h,C=b-g,D=v(e.left)+g,M=e.right;else if(o==="right")b=v(this.left),D=e.left,M=v(e.right)-g,w=b+g,C=this.left+h;else if(t==="x"){if(o==="center")b=v((e.top+e.bottom)/2+.5);else if(kt(o)){let z=Object.keys(o)[0],W=o[z];b=v(this.chart.scales[z].getPixelForValue(W))}R=e.top,L=e.bottom,S=b+g,E=S+h}else if(t==="y"){if(o==="center")b=v((e.left+e.right)/2);else if(kt(o)){let z=Object.keys(o)[0],W=o[z];b=v(this.chart.scales[z].getPixelForValue(W))}w=b-g,C=w-h,D=e.left,M=e.right}let B=_t(i.ticks.maxTicksLimit,d),O=Math.max(1,Math.ceil(d/B));for(_=0;_<d;_+=O){let z=this.getContext(_),W=a.setContext(z),j=s.setContext(z),G=W.lineWidth,X=W.color,et=j.dash||[],at=j.dashOffset,lt=W.tickWidth,gt=W.tickColor,bt=W.tickBorderDash||[],yt=W.tickBorderDashOffset;y=kT(this,_,c),y!==void 0&&(x=ki(n,y,G),u?w=C=D=M=x:S=E=R=L=x,f.push({tx1:w,ty1:S,tx2:C,ty2:E,x1:D,y1:R,x2:M,y2:L,width:G,color:X,borderDash:et,borderDashOffset:at,tickWidth:lt,tickColor:gt,tickBorderDash:bt,tickBorderDashOffset:yt}))}return this._ticksLength=d,this._borderValue=b,f}_computeLabelItems(e){let t=this.axis,n=this.options,{position:i,ticks:a}=n,o=this.isHorizontal(),s=this.ticks,{align:c,crossAlign:u,padding:l,mirror:d}=a,h=tc(n.grid),f=h+l,p=d?-l:f,m=-Bn(this.labelRotation),g=[],v,b,_,y,x,w,S,C,E,D,R,M,L="middle";if(i==="top")w=this.bottom-p,S=this._getXAxisLabelAlignment();else if(i==="bottom")w=this.top+p,S=this._getXAxisLabelAlignment();else if(i==="left"){let O=this._getYAxisLabelAlignment(h);S=O.textAlign,x=O.x}else if(i==="right"){let O=this._getYAxisLabelAlignment(h);S=O.textAlign,x=O.x}else if(t==="x"){if(i==="center")w=(e.top+e.bottom)/2+f;else if(kt(i)){let O=Object.keys(i)[0],z=i[O];w=this.chart.scales[O].getPixelForValue(z)+f}S=this._getXAxisLabelAlignment()}else if(t==="y"){if(i==="center")x=(e.left+e.right)/2-f;else if(kt(i)){let O=Object.keys(i)[0],z=i[O];x=this.chart.scales[O].getPixelForValue(z)}S=this._getYAxisLabelAlignment(h).textAlign}t==="y"&&(c==="start"?L="top":c==="end"&&(L="bottom"));let B=this._getLabelSizes();for(v=0,b=s.length;v<b;++v){_=s[v],y=_.label;let O=a.setContext(this.getContext(v));C=this.getPixelForTick(v)+a.labelOffset,E=this._resolveTickFontOptions(v),D=E.lineHeight,R=$t(y)?y.length:1;let z=R/2,W=O.color,j=O.textStrokeColor,G=O.textStrokeWidth,X=S;o?(x=C,S==="inner"&&(v===b-1?X=this.options.reverse?"left":"right":v===0?X=this.options.reverse?"right":"left":X="center"),i==="top"?u==="near"||m!==0?M=-R*D+D/2:u==="center"?M=-B.highest.height/2-z*D+D:M=-B.highest.height+D/2:u==="near"||m!==0?M=D/2:u==="center"?M=B.highest.height/2-z*D:M=B.highest.height-R*D,d&&(M*=-1),m!==0&&!O.showLabelBackdrop&&(x+=D/2*Math.sin(m))):(w=C,M=(1-R)*D/2);let et;if(O.showLabelBackdrop){let at=Ke(O.backdropPadding),lt=B.heights[v],gt=B.widths[v],bt=M-at.top,yt=0-at.left;switch(L){case"middle":bt-=lt/2;break;case"bottom":bt-=lt;break}switch(S){case"center":yt-=gt/2;break;case"right":yt-=gt;break;case"inner":v===b-1?yt-=gt:v>0&&(yt-=gt/2);break}et={left:yt,top:bt,width:gt+at.width,height:lt+at.height,color:O.backdropColor}}g.push({label:y,font:E,textOffset:M,options:{rotation:m,color:W,strokeColor:j,strokeWidth:G,textAlign:X,textBaseline:L,translation:[x,w],backdrop:et}})}return g}_getXAxisLabelAlignment(){let{position:e,ticks:t}=this.options;if(-Bn(this.labelRotation))return e==="top"?"left":"right";let i="center";return t.align==="start"?i="left":t.align==="end"?i="right":t.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){let{position:t,ticks:{crossAlign:n,mirror:i,padding:a}}=this.options,o=this._getLabelSizes(),s=e+a,c=o.widest.width,u,l;return t==="left"?i?(l=this.right+a,n==="near"?u="left":n==="center"?(u="center",l+=c/2):(u="right",l+=c)):(l=this.right-s,n==="near"?u="right":n==="center"?(u="center",l-=c/2):(u="left",l=this.left)):t==="right"?i?(l=this.left+a,n==="near"?u="right":n==="center"?(u="center",l-=c/2):(u="left",l-=c)):(l=this.left+s,n==="near"?u="left":n==="center"?(u="center",l+=c/2):(u="right",l=this.right)):u="right",{textAlign:u,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;let e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){let{ctx:e,options:{backgroundColor:t},left:n,top:i,width:a,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,i,a,o),e.restore())}getLineWidthForValue(e){let t=this.options.grid;if(!this._isVisible()||!t.display)return 0;let i=this.ticks.findIndex(a=>a.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){let t=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e)),a,o,s=(c,u,l)=>{!l.width||!l.color||(n.save(),n.lineWidth=l.width,n.strokeStyle=l.color,n.setLineDash(l.borderDash||[]),n.lineDashOffset=l.borderDashOffset,n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(u.x,u.y),n.stroke(),n.restore())};if(t.display)for(a=0,o=i.length;a<o;++a){let c=i[a];t.drawOnChartArea&&s({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),t.drawTicks&&s({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){let{chart:e,ctx:t,options:{border:n,grid:i}}=this,a=n.setContext(this.getContext()),o=n.display?a.width:0;if(!o)return;let s=i.setContext(this.getContext(0)).lineWidth,c=this._borderValue,u,l,d,h;this.isHorizontal()?(u=ki(e,this.left,o)-o/2,l=ki(e,this.right,s)+s/2,d=h=c):(d=ki(e,this.top,o)-o/2,h=ki(e,this.bottom,s)+s/2,u=l=c),t.save(),t.lineWidth=a.width,t.strokeStyle=a.color,t.beginPath(),t.moveTo(u,d),t.lineTo(l,h),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;let n=this.ctx,i=this._computeLabelArea();i&&Xs(n,i);let a=this.getLabelItems(e);for(let o of a){let s=o.options,c=o.font,u=o.label,l=o.textOffset;Di(n,u,0,l,c,s)}i&&$s(n)}drawTitle(){let{ctx:e,options:{position:t,title:n,reverse:i}}=this;if(!n.display)return;let a=Ee(n.font),o=Ke(n.padding),s=n.align,c=a.lineHeight/2;t==="bottom"||t==="center"||kt(t)?(c+=o.bottom,$t(n.text)&&(c+=a.lineHeight*(n.text.length-1))):c+=o.top;let{titleX:u,titleY:l,maxWidth:d,rotation:h}=RT(this,c,t,s);Di(e,n.text,0,0,a,{color:n.color,maxWidth:d,rotation:h,textAlign:MT(s,t,i),textBaseline:"middle",translation:[u,l]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){let e=this.options,t=e.ticks&&e.ticks.z||0,n=_t(e.grid&&e.grid.z,-1),i=_t(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==r.prototype.draw?[{z:t,draw:a=>{this.draw(a)}}]:[{z:n,draw:a=>{this.drawBackground(),this.drawGrid(a),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:a=>{this.drawLabels(a)}}]}getMatchingVisibleMetas(e){let t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[],a,o;for(a=0,o=t.length;a<o;++a){let s=t[a];s[n]===this.id&&(!e||s.type===e)&&i.push(s)}return i}_resolveTickFontOptions(e){let t=this.options.ticks.setContext(this.getContext(e));return Ee(t.font)}_maxDigits(){let e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}},To=class{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){let t=Object.getPrototypeOf(e),n;PT(t)&&(n=this.register(t));let i=this.items,a=e.id,o=this.scope+"."+a;if(!a)throw new Error("class does not have id: "+e);return a in i||(i[a]=e,TT(e,o,n),this.override&&de.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){let t=this.items,n=e.id,i=this.scope;n in t&&delete t[n],i&&n in de[i]&&(delete de[i][n],this.override&&delete Ei[n])}};function TT(r,e,t){let n=wo(Object.create(null),[t?de.get(t):{},de.get(e),r.defaults]);de.set(e,n),r.defaultRoutes&&FT(e,r.defaultRoutes),r.descriptors&&de.describe(e,r.descriptors)}function FT(r,e){Object.keys(e).forEach(t=>{let n=t.split("."),i=n.pop(),a=[r].concat(n).join("."),o=e[t].split("."),s=o.pop(),c=o.join(".");de.route(a,i,c,s)})}function PT(r){return"id"in r&&"defaults"in r}var Wp=class{constructor(){this.controllers=new To(Ri,"datasets",!0),this.elements=new To(Jn,"elements"),this.plugins=new To(Object,"plugins"),this.scales=new To(pa,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,n){[...t].forEach(i=>{let a=n||this._getRegistryForType(i);n||a.isForType(i)||a===this.plugins&&i.id?this._exec(e,a,i):Wt(i,o=>{let s=n||this._getRegistryForType(o);this._exec(e,s,o)})})}_exec(e,t,n){let i=Cl(e);Yt(n["before"+i],[],n),t[e](n),Yt(n["after"+i],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){let n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){let i=t.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return i}},Cr=new Wp,zp=class{constructor(){this._init=[]}notify(e,t,n,i){t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));let a=i?this._descriptors(e).filter(i):this._descriptors(e),o=this._notify(a,e,t,n);return t==="afterDestroy"&&(this._notify(a,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,t,n,i){i=i||{};for(let a of e){let o=a.plugin,s=o[n],c=[t,i,a.options];if(Yt(s,c,o)===!1&&i.cancelable)return!1}return!0}invalidate(){Ft(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;let t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){let n=e&&e.config,i=_t(n.options&&n.options.plugins,{}),a=OT(n);return i===!1&&!t?[]:LT(e,a,i,t)}_notifyStateChanges(e){let t=this._oldCache||[],n=this._cache,i=(a,o)=>a.filter(s=>!o.some(c=>s.plugin.id===c.plugin.id));this._notify(i(t,n),e,"stop"),this._notify(i(n,t),e,"start")}};function OT(r){let e={},t=[],n=Object.keys(Cr.plugins.items);for(let a=0;a<n.length;a++)t.push(Cr.getPlugin(n[a]));let i=r.plugins||[];for(let a=0;a<i.length;a++){let o=i[a];t.indexOf(o)===-1&&(t.push(o),e[o.id]=!0)}return{plugins:t,localIds:e}}function NT(r,e){return!e&&r===!1?null:r===!0?{}:r}function LT(r,{plugins:e,localIds:t},n,i){let a=[],o=r.getContext();for(let s of e){let c=s.id,u=NT(n[c],i);u!==null&&a.push({plugin:s,options:BT(r.config,{plugin:s,local:t[c]},u,o)})}return a}function BT(r,{plugin:e,local:t},n,i){let a=r.pluginScopeKeys(e),o=r.getOptionScopes(n,a);return t&&e.defaults&&o.push(e.defaults),r.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function jp(r,e){let t=de.datasets[r]||{};return((e.datasets||{})[r]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function VT(r,e){let t=r;return r==="_index_"?t=e:r==="_value_"&&(t=e==="x"?"y":"x"),t}function WT(r,e){return r===e?"_index_":"_value_"}function T1(r){if(r==="x"||r==="y"||r==="r")return r}function zT(r){if(r==="top"||r==="bottom")return"x";if(r==="left"||r==="right")return"y"}function Hp(r,...e){if(T1(r))return r;for(let t of e){let n=t.axis||zT(t.position)||r.length>1&&T1(r[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${r}' axis. Please provide 'axis' or 'position' option.`)}function F1(r,e,t){if(t[e+"AxisID"]===r)return{axis:e}}function jT(r,e){if(e.data&&e.data.datasets){let t=e.data.datasets.filter(n=>n.xAxisID===r||n.yAxisID===r);if(t.length)return F1(r,"x",t[0])||F1(r,"y",t[0])}return{}}function HT(r,e){let t=Ei[r.type]||{scales:{}},n=e.scales||{},i=jp(r.type,e),a=Object.create(null);return Object.keys(n).forEach(o=>{let s=n[o];if(!kt(s))return console.error(`Invalid scale configuration for scale: ${o}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);let c=Hp(o,s,jT(o,r),de.scales[s.type]),u=WT(c,i),l=t.scales||{};a[o]=So(Object.create(null),[{axis:c},s,l[c],l[u]])}),r.data.datasets.forEach(o=>{let s=o.type||r.type,c=o.indexAxis||jp(s,e),l=(Ei[s]||{}).scales||{};Object.keys(l).forEach(d=>{let h=VT(d,c),f=o[h+"AxisID"]||h;a[f]=a[f]||Object.create(null),So(a[f],[{axis:h},n[f],l[d]])})}),Object.keys(a).forEach(o=>{let s=a[o];So(s,[de.scales[s.type],de.scale])}),a}function xw(r){let e=r.options||(r.options={});e.plugins=_t(e.plugins,{}),e.scales=HT(r,e)}function _w(r){return r=r||{},r.datasets=r.datasets||[],r.labels=r.labels||[],r}function UT(r){return r=r||{},r.data=_w(r.data),xw(r),r}var P1=new Map,ww=new Set;function Nl(r,e){let t=P1.get(r);return t||(t=e(),P1.set(r,t),ww.add(t)),t}var ec=(r,e,t)=>{let n=$r(e,t);n!==void 0&&r.add(n)},Up=class{constructor(e){this._config=UT(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=_w(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){let e=this._config;this.clearCache(),xw(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Nl(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return Nl(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return Nl(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){let t=e.id,n=this.type;return Nl(`${n}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){let n=this._scopeCache,i=n.get(e);return(!i||t)&&(i=new Map,n.set(e,i)),i}getOptionScopes(e,t,n){let{options:i,type:a}=this,o=this._cachedScopes(e,n),s=o.get(t);if(s)return s;let c=new Set;t.forEach(l=>{e&&(c.add(e),l.forEach(d=>ec(c,e,d))),l.forEach(d=>ec(c,i,d)),l.forEach(d=>ec(c,Ei[a]||{},d)),l.forEach(d=>ec(c,de,d)),l.forEach(d=>ec(c,Dl,d))});let u=Array.from(c);return u.length===0&&u.push(Object.create(null)),ww.has(t)&&o.set(t,u),u}chartOptionScopes(){let{options:e,type:t}=this;return[e,Ei[t]||{},de.datasets[t]||{},{type:t},de,Dl]}resolveNamedOptions(e,t,n,i=[""]){let a={$shared:!0},{resolver:o,subPrefixes:s}=O1(this._resolverCache,e,i),c=o;if(qT(o,t)){a.$shared=!1,n=Kr(n)?n():n;let u=this.createResolver(e,n,s);c=ua(o,n,u)}for(let u of t)a[u]=c[u];return a}createResolver(e,t,n=[""],i){let{resolver:a}=O1(this._resolverCache,e,n);return kt(t)?ua(a,t,void 0,i):a}};function O1(r,e,t){let n=r.get(e);n||(n=new Map,r.set(e,n));let i=t.join(),a=n.get(i);return a||(a={resolver:Ml(e,t),subPrefixes:t.filter(s=>!s.toLowerCase().includes("hover"))},n.set(i,a)),a}var GT=r=>kt(r)&&Object.getOwnPropertyNames(r).some(e=>Kr(r[e]));function qT(r,e){let{isScriptable:t,isIndexable:n}=gp(r);for(let i of e){let a=t(i),o=n(i),s=(o||a)&&r[i];if(a&&(Kr(s)||GT(s))||o&&$t(s))return!0}return!1}var YT="4.4.2",KT=["top","bottom","left","right","chartArea"];function N1(r,e){return r==="top"||r==="bottom"||KT.indexOf(r)===-1&&e==="x"}function L1(r,e){return function(t,n){return t[r]===n[r]?t[e]-n[e]:t[r]-n[r]}}function B1(r){let e=r.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Yt(t&&t.onComplete,[r],e)}function XT(r){let e=r.chart,t=e.options.animation;Yt(t&&t.onProgress,[r],e)}function Cw(r){return Rl()&&typeof r=="string"?r=document.getElementById(r):r&&r.length&&(r=r[0]),r&&r.canvas&&(r=r.canvas),r}var jl={},V1=r=>{let e=Cw(r);return Object.values(jl).filter(t=>t.canvas===e).pop()};function $T(r,e,t){let n=Object.keys(r);for(let i of n){let a=+i;if(a>=e){let o=r[i];delete r[i],(t>0||a>e)&&(r[a+t]=o)}}}function QT(r,e,t,n){return!t||r.type==="mouseout"?null:n?e:r}function Ll(r,e,t){return r.options.clip?r[t]:e[t]}function JT(r,e){let{xScale:t,yScale:n}=r;return t&&n?{left:Ll(t,e,"left"),right:Ll(t,e,"right"),top:Ll(n,e,"top"),bottom:Ll(n,e,"bottom")}:e}var Xl=(()=>{class r{static defaults=de;static instances=jl;static overrides=Ei;static registry=Cr;static version=YT;static getChart=V1;static register(...t){Cr.add(...t),W1()}static unregister(...t){Cr.remove(...t),W1()}constructor(t,n){let i=this.config=new Up(n),a=Cw(t),o=V1(a);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");let s=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||bT(a)),this.platform.updateConfig(i);let c=this.platform.acquireContext(a,s.aspectRatio),u=c&&c.canvas,l=u&&u.height,d=u&&u.width;if(this.id=L_(),this.ctx=c,this.canvas=u,this.width=d,this.height=l,this._options=s,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new zp,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=K_(h=>this.update(h),s.resizeDelay||0),this._dataChanges=[],jl[this.id]=this,!c||!u){console.error("Failed to create chart: can't acquire context from the given item");return}Jr.listen(this,"complete",B1),Jr.listen(this,"progress",XT),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:a,_aspectRatio:o}=this;return Ft(t)?n&&o?o:a?i/a:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Cr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():xp(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return fp(this.canvas,this.ctx),this}stop(){return Jr.stop(this),this}resize(t,n){Jr.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){let i=this.options,a=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,s=this.platform.getMaximumSize(a,t,n,o),c=i.devicePixelRatio||this.platform.getDevicePixelRatio(),u=this.width?"resize":"attach";this.width=s.width,this.height=s.height,this._aspectRatio=this.aspectRatio,xp(this,c,!0)&&(this.notifyPlugins("resize",{size:s}),Yt(i.onResize,[this,s],this),this.attached&&this._doResize(u)&&this.render())}ensureScalesHaveIDs(){let n=this.options.scales||{};Wt(n,(i,a)=>{i.id=a})}buildOrUpdateScales(){let t=this.options,n=t.scales,i=this.scales,a=Object.keys(i).reduce((s,c)=>(s[c]=!1,s),{}),o=[];n&&(o=o.concat(Object.keys(n).map(s=>{let c=n[s],u=Hp(s,c),l=u==="r",d=u==="x";return{options:c,dposition:l?"chartArea":d?"bottom":"left",dtype:l?"radialLinear":d?"category":"linear"}}))),Wt(o,s=>{let c=s.options,u=c.id,l=Hp(u,c),d=_t(c.type,s.dtype);(c.position===void 0||N1(c.position,l)!==N1(s.dposition))&&(c.position=s.dposition),a[u]=!0;let h=null;if(u in i&&i[u].type===d)h=i[u];else{let f=Cr.getScale(d);h=new f({id:u,type:d,ctx:this.ctx,chart:this}),i[h.id]=h}h.init(c,t)}),Wt(a,(s,c)=>{s||delete i[c]}),Wt(i,s=>{tn.configure(this,s,s.options),tn.addBox(this,s)})}_updateMetasets(){let t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((a,o)=>a.index-o.index),i>n){for(let a=n;a<i;++a)this._destroyDatasetMeta(a);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(L1("order","index"))}_removeUnreferencedMetasets(){let{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,a)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(a)})}buildOrUpdateControllers(){let t=[],n=this.data.datasets,i,a;for(this._removeUnreferencedMetasets(),i=0,a=n.length;i<a;i++){let o=n[i],s=this.getDatasetMeta(i),c=o.type||this.config.type;if(s.type&&s.type!==c&&(this._destroyDatasetMeta(i),s=this.getDatasetMeta(i)),s.type=c,s.indexAxis=o.indexAxis||jp(c,this.options),s.order=o.order||0,s.index=i,s.label=""+o.label,s.visible=this.isDatasetVisible(i),s.controller)s.controller.updateIndex(i),s.controller.linkScales();else{let u=Cr.getController(c),{datasetElementType:l,dataElementType:d}=de.datasets[c];Object.assign(u,{dataElementType:Cr.getElement(d),datasetElementType:l&&Cr.getElement(l)}),s.controller=new u(this,i),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){Wt(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){let n=this.config;n.update();let i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),a=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;let o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let s=0;for(let l=0,d=this.data.datasets.length;l<d;l++){let{controller:h}=this.getDatasetMeta(l),f=!a&&o.indexOf(h)===-1;h.buildOrUpdateElements(f),s=Math.max(+h.getMaxOverflow(),s)}s=this._minPadding=i.layout.autoPadding?s:0,this._updateLayout(s),a||Wt(o,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(L1("z","_idx"));let{_active:c,_lastEvent:u}=this;u?this._eventHandler(u,!0):c.length&&this._updateHoverStyles(c,c,!0),this.render()}_updateScales(){Wt(this.scales,t=>{tn.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!tp(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(let{method:i,start:a,count:o}of n){let s=i==="_removeElements"?-o:o;$T(t,a,s)}}_getUniformDataChanges(){let t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];let n=this.data.datasets.length,i=o=>new Set(t.filter(s=>s[0]===o).map((s,c)=>c+","+s.splice(1).join(","))),a=i(0);for(let o=1;o<n;o++)if(!tp(a,i(o)))return;return Array.from(a).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;tn.update(this,this.width,this.height,t);let n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],Wt(this.boxes,a=>{i&&a.position==="chartArea"||(a.configure&&a.configure(),this._layers.push(...a._layers()))},this),this._layers.forEach((a,o)=>{a._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Kr(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){let i=this.getDatasetMeta(t),a={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",a)!==!1&&(i.controller._update(n),a.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",a))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Jr.has(this)?this.attached&&!Jr.running(this)&&Jr.start(this):(this.draw(),B1({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){let{width:i,height:a}=this._resizeBeforeDraw;this._resize(i,a),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){let n=this._sortedMetasets,i=[],a,o;for(a=0,o=n.length;a<o;++a){let s=n[a];(!t||s.visible)&&i.push(s)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){let n=this.ctx,i=t._clip,a=!i.disabled,o=JT(t,this.chartArea),s={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(a&&Xs(n,{left:i.left===!1?0:o.left-i.left,right:i.right===!1?this.width:o.right+i.right,top:i.top===!1?0:o.top-i.top,bottom:i.bottom===!1?this.height:o.bottom+i.bottom}),t.controller.draw(),a&&$s(n),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return yr(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,a){let o=ZR.modes[n];return typeof o=="function"?o(this,t,i,a):[]}getDatasetMeta(t){let n=this.data.datasets[t],i=this._metasets,a=i.filter(o=>o&&o._dataset===n).pop();return a||(a={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(a)),a}getContext(){return this.$context||(this.$context=Qr(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){let n=this.data.datasets[t];if(!n)return!1;let i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){let i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){let a=i?"show":"hide",o=this.getDatasetMeta(t),s=o.controller._resolveAnimations(void 0,a);Eo(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),s.update(o,{visible:i}),this.update(c=>c.datasetIndex===t?a:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){let n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),Jr.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),fp(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete jl[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let t=this._listeners,n=this.platform,i=(o,s)=>{n.addEventListener(this,o,s),t[o]=s},a=(o,s,c)=>{o.offsetX=s,o.offsetY=c,this._eventHandler(o)};Wt(this.options.events,o=>i(o,a))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let t=this._responsiveListeners,n=this.platform,i=(u,l)=>{n.addEventListener(this,u,l),t[u]=l},a=(u,l)=>{t[u]&&(n.removeEventListener(this,u,l),delete t[u])},o=(u,l)=>{this.canvas&&this.resize(u,l)},s,c=()=>{a("attach",c),this.attached=!0,this.resize(),i("resize",o),i("detach",s)};s=()=>{this.attached=!1,a("resize",o),this._stop(),this._resize(0,0),i("attach",c)},n.isAttached(this.canvas)?c():s()}unbindEvents(){Wt(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},Wt(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){let a=i?"set":"remove",o,s,c,u;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+a+"DatasetHoverStyle"]()),c=0,u=t.length;c<u;++c){s=t[c];let l=s&&this.getDatasetMeta(s.datasetIndex).controller;l&&l[a+"HoverStyle"](s.element,s.datasetIndex,s.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){let n=this._active||[],i=t.map(({datasetIndex:o,index:s})=>{let c=this.getDatasetMeta(o);if(!c)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:c.data[s],index:s}});!Ys(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){let a=this.options.hover,o=(u,l)=>u.filter(d=>!l.some(h=>d.datasetIndex===h.datasetIndex&&d.index===h.index)),s=o(n,t),c=i?t:o(t,n);s.length&&this.updateHoverStyle(s,a.mode,!1),c.length&&a.mode&&this.updateHoverStyle(c,a.mode,!0)}_eventHandler(t,n){let i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},a=s=>(s.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,a)===!1)return;let o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,a),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){let{_active:a=[],options:o}=this,s=n,c=this._getActiveElements(t,a,i,s),u=W_(t),l=QT(t,this._lastEvent,i,u);i&&(this._lastEvent=null,Yt(o.onHover,[t,c,this],this),u&&Yt(o.onClick,[t,c,this],this));let d=!Ys(c,a);return(d||n)&&(this._active=c,this._updateHoverStyles(c,a,n)),this._lastEvent=l,d}_getActiveElements(t,n,i,a){if(t.type==="mouseout")return[];if(!i)return n;let o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,a)}}return r})();function W1(){return Wt(Xl.instances,r=>r._plugins.invalidate())}function ZT(r,e,t){let{startAngle:n,pixelMargin:i,x:a,y:o,outerRadius:s,innerRadius:c}=e,u=i/s;r.beginPath(),r.arc(a,o,s,n-u,t+u),c>i?(u=i/c,r.arc(a,o,c,t+u,n-u,!0)):r.arc(a,o,i,t+ve,n-ve),r.closePath(),r.clip()}function tF(r){return Il(r,["outerStart","outerEnd","innerStart","innerEnd"])}function eF(r,e,t,n){let i=tF(r.options.borderRadius),a=(t-e)/2,o=Math.min(a,n*e/2),s=c=>{let u=(t-Math.min(a,c))*n/2;return Re(c,0,Math.min(a,u))};return{outerStart:s(i.outerStart),outerEnd:s(i.outerEnd),innerStart:Re(i.innerStart,0,o),innerEnd:Re(i.innerEnd,0,o)}}function Ro(r,e,t,n){return{x:t+r*Math.cos(e),y:n+r*Math.sin(e)}}function ql(r,e,t,n,i,a){let{x:o,y:s,startAngle:c,pixelMargin:u,innerRadius:l}=e,d=Math.max(e.outerRadius+n+t-u,0),h=l>0?l+n+t+u:0,f=0,p=i-c;if(n){let O=l>0?l-n:0,z=d>0?d-n:0,W=(O+z)/2,j=W!==0?p*W/(W+n):p;f=(p-j)/2}let m=Math.max(.001,p*d-t/Qt)/d,g=(p-m)/2,v=c+g+f,b=i-g-f,{outerStart:_,outerEnd:y,innerStart:x,innerEnd:w}=eF(e,h,d,b-v),S=d-_,C=d-y,E=v+_/S,D=b-y/C,R=h+x,M=h+w,L=v+x/R,B=b-w/M;if(r.beginPath(),a){let O=(E+D)/2;if(r.arc(o,s,d,E,O),r.arc(o,s,d,O,D),y>0){let G=Ro(C,D,o,s);r.arc(G.x,G.y,y,D,b+ve)}let z=Ro(M,b,o,s);if(r.lineTo(z.x,z.y),w>0){let G=Ro(M,B,o,s);r.arc(G.x,G.y,w,b+ve,B+Math.PI)}let W=(b-w/h+(v+x/h))/2;if(r.arc(o,s,h,b-w/h,W,!0),r.arc(o,s,h,W,v+x/h,!0),x>0){let G=Ro(R,L,o,s);r.arc(G.x,G.y,x,L+Math.PI,v-ve)}let j=Ro(S,v,o,s);if(r.lineTo(j.x,j.y),_>0){let G=Ro(S,E,o,s);r.arc(G.x,G.y,_,v-ve,E)}}else{r.moveTo(o,s);let O=Math.cos(E)*d+o,z=Math.sin(E)*d+s;r.lineTo(O,z);let W=Math.cos(D)*d+o,j=Math.sin(D)*d+s;r.lineTo(W,j)}r.closePath()}function nF(r,e,t,n,i){let{fullCircles:a,startAngle:o,circumference:s}=e,c=e.endAngle;if(a){ql(r,e,t,n,c,i);for(let u=0;u<a;++u)r.fill();isNaN(s)||(c=o+(s%Jt||Jt))}return ql(r,e,t,n,c,i),r.fill(),c}function rF(r,e,t,n,i){let{fullCircles:a,startAngle:o,circumference:s,options:c}=e,{borderWidth:u,borderJoinStyle:l,borderDash:d,borderDashOffset:h}=c,f=c.borderAlign==="inner";if(!u)return;r.setLineDash(d||[]),r.lineDashOffset=h,f?(r.lineWidth=u*2,r.lineJoin=l||"round"):(r.lineWidth=u,r.lineJoin=l||"bevel");let p=e.endAngle;if(a){ql(r,e,t,n,p,i);for(let m=0;m<a;++m)r.stroke();isNaN(s)||(p=o+(s%Jt||Jt))}f&&ZT(r,e,p),a||(ql(r,e,t,n,p,i),r.stroke())}var Gp=class extends Jn{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){let i=this.getProps(["x","y"],n),{angle:a,distance:o}=ip(i,{x:e,y:t}),{startAngle:s,endAngle:c,innerRadius:u,outerRadius:l,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=(this.options.spacing+this.options.borderWidth)/2,p=_t(d,c-s)>=Jt||Do(a,s,c),m=_r(o,u+h,l+h);return p&&m}getCenterPoint(e){let{x:t,y:n,startAngle:i,endAngle:a,innerRadius:o,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:u}=this.options,l=(i+a)/2,d=(o+s+u+c)/2;return{x:t+Math.cos(l)*d,y:n+Math.sin(l)*d}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){let{options:t,circumference:n}=this,i=(t.offset||0)/4,a=(t.spacing||0)/2,o=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=n>Jt?Math.floor(n/Jt):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();let s=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(s)*i,Math.sin(s)*i);let c=1-Math.sin(Math.min(Qt,n||0)),u=i*c;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,nF(e,this,u,a,o),rF(e,this,u,a,o),e.restore()}};function Sw(r,e,t=e){r.lineCap=_t(t.borderCapStyle,e.borderCapStyle),r.setLineDash(_t(t.borderDash,e.borderDash)),r.lineDashOffset=_t(t.borderDashOffset,e.borderDashOffset),r.lineJoin=_t(t.borderJoinStyle,e.borderJoinStyle),r.lineWidth=_t(t.borderWidth,e.borderWidth),r.strokeStyle=_t(t.borderColor,e.borderColor)}function iF(r,e,t){r.lineTo(t.x,t.y)}function aF(r){return r.stepped?J_:r.tension||r.cubicInterpolationMode==="monotone"?Z_:iF}function Ew(r,e,t={}){let n=r.length,{start:i=0,end:a=n-1}=t,{start:o,end:s}=e,c=Math.max(i,o),u=Math.min(a,s),l=i<o&&a<o||i>s&&a>s;return{count:n,start:c,loop:e.loop,ilen:u<c&&!l?n+u-c:u-c}}function oF(r,e,t,n){let{points:i,options:a}=e,{count:o,start:s,loop:c,ilen:u}=Ew(i,t,n),l=aF(a),{move:d=!0,reverse:h}=n||{},f,p,m;for(f=0;f<=u;++f)p=i[(s+(h?u-f:f))%o],!p.skip&&(d?(r.moveTo(p.x,p.y),d=!1):l(r,m,p,h,a.stepped),m=p);return c&&(p=i[(s+(h?u:0))%o],l(r,m,p,h,a.stepped)),!!c}function sF(r,e,t,n){let i=e.points,{count:a,start:o,ilen:s}=Ew(i,t,n),{move:c=!0,reverse:u}=n||{},l=0,d=0,h,f,p,m,g,v,b=y=>(o+(u?s-y:y))%a,_=()=>{m!==g&&(r.lineTo(l,g),r.lineTo(l,m),r.lineTo(l,v))};for(c&&(f=i[b(0)],r.moveTo(f.x,f.y)),h=0;h<=s;++h){if(f=i[b(h)],f.skip)continue;let y=f.x,x=f.y,w=y|0;w===p?(x<m?m=x:x>g&&(g=x),l=(d*l+y)/++d):(_(),r.lineTo(y,x),p=w,d=0,m=g=x),v=x}_()}function qp(r){let e=r.options,t=e.borderDash&&e.borderDash.length;return!r._decimated&&!r._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?sF:oF}function cF(r){return r.stepped?c1:r.tension||r.cubicInterpolationMode==="monotone"?u1:Si}function uF(r,e,t,n){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,n)&&i.closePath()),Sw(r,e.options),r.stroke(i)}function lF(r,e,t,n){let{segments:i,options:a}=e,o=qp(e);for(let s of i)Sw(r,a,s.style),r.beginPath(),o(r,e,s,{start:t,end:t+n-1})&&r.closePath(),r.stroke()}var dF=typeof Path2D=="function";function hF(r,e,t,n){dF&&!e.options.segment?uF(r,e,t,n):lF(r,e,t,n)}var $l=(()=>{class r extends Jn{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){let i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){let a=i.spanGaps?this._loop:this._fullLoop;a1(this._points,i,t,a,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=d1(this,this.options.segment))}first(){let t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){let t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){let i=this.options,a=t[n],o=this.points,s=Ep(this,{property:n,start:a,end:a});if(!s.length)return;let c=[],u=cF(i),l,d;for(l=0,d=s.length;l<d;++l){let{start:h,end:f}=s[l],p=o[h],m=o[f];if(p===m){c.push(p);continue}let g=Math.abs((a-p[n])/(m[n]-p[n])),v=u(p,m,g,i.stepped);v[n]=t[n],c.push(v)}return c.length===1?c[0]:c}pathSegment(t,n,i){return qp(this)(t,this,n,i)}path(t,n,i){let a=this.segments,o=qp(this),s=this._loop;n=n||0,i=i||this.points.length-n;for(let c of a)s&=o(t,this,c,{start:n,end:n+i-1});return!!s}draw(t,n,i,a){let o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),hF(t,this,i,a),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return r})();function z1(r,e,t,n){let i=r.options,{[t]:a}=r.getProps([t],n);return Math.abs(e-a)<i.radius+i.hitRadius}var fF=(()=>{class r extends Jn{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,n,i){let a=this.options,{x:o,y:s}=this.getProps(["x","y"],i);return Math.pow(t-o,2)+Math.pow(n-s,2)<Math.pow(a.hitRadius+a.radius,2)}inXRange(t,n){return z1(this,t,"x",n)}inYRange(t,n){return z1(this,t,"y",n)}getCenterPoint(t){let{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}size(t){t=t||this.options||{};let n=t.radius||0;n=Math.max(n,n&&t.hoverRadius||0);let i=n&&t.borderWidth||0;return(n+i)*2}draw(t,n){let i=this.options;this.skip||i.radius<.1||!yr(this,n,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Al(t,i,this.x,this.y))}getRange(){let t=this.options||{};return t.radius+t.hitRadius}}return r})();function kw(r,e){let{x:t,y:n,base:i,width:a,height:o}=r.getProps(["x","y","base","width","height"],e),s,c,u,l,d;return r.horizontal?(d=o/2,s=Math.min(t,i),c=Math.max(t,i),u=n-d,l=n+d):(d=a/2,s=t-d,c=t+d,u=Math.min(n,i),l=Math.max(n,i)),{left:s,top:u,right:c,bottom:l}}function Mi(r,e,t,n){return r?0:Re(e,t,n)}function pF(r,e,t){let n=r.options.borderWidth,i=r.borderSkipped,a=mp(n);return{t:Mi(i.top,a.top,0,t),r:Mi(i.right,a.right,0,e),b:Mi(i.bottom,a.bottom,0,t),l:Mi(i.left,a.left,0,e)}}function mF(r,e,t){let{enableBorderRadius:n}=r.getProps(["enableBorderRadius"]),i=r.options.borderRadius,a=Ai(i),o=Math.min(e,t),s=r.borderSkipped,c=n||kt(i);return{topLeft:Mi(!c||s.top||s.left,a.topLeft,0,o),topRight:Mi(!c||s.top||s.right,a.topRight,0,o),bottomLeft:Mi(!c||s.bottom||s.left,a.bottomLeft,0,o),bottomRight:Mi(!c||s.bottom||s.right,a.bottomRight,0,o)}}function gF(r){let e=kw(r),t=e.right-e.left,n=e.bottom-e.top,i=pF(r,t/2,n/2),a=mF(r,t/2,n/2);return{outer:{x:e.left,y:e.top,w:t,h:n,radius:a},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:n-i.t-i.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,a.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(i.b,i.r))}}}}function Tp(r,e,t,n){let i=e===null,a=t===null,s=r&&!(i&&a)&&kw(r,n);return s&&(i||_r(e,s.left,s.right))&&(a||_r(t,s.top,s.bottom))}function vF(r){return r.topLeft||r.topRight||r.bottomLeft||r.bottomRight}function bF(r,e){r.rect(e.x,e.y,e.w,e.h)}function Fp(r,e,t={}){let n=r.x!==t.x?-e:0,i=r.y!==t.y?-e:0,a=(r.x+r.w!==t.x+t.w?e:0)-n,o=(r.y+r.h!==t.y+t.h?e:0)-i;return{x:r.x+n,y:r.y+i,w:r.w+a,h:r.h+o,radius:r.radius}}var Yp=class extends Jn{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){let{inflateAmount:t,options:{borderColor:n,backgroundColor:i}}=this,{inner:a,outer:o}=gF(this),s=vF(o.radius)?Io:bF;e.save(),(o.w!==a.w||o.h!==a.h)&&(e.beginPath(),s(e,Fp(o,t,a)),e.clip(),s(e,Fp(a,-t,o)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),s(e,Fp(a,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,n){return Tp(this,e,t,n)}inXRange(e,t){return Tp(this,e,null,t)}inYRange(e,t){return Tp(this,null,e,t)}getCenterPoint(e){let{x:t,y:n,base:i,horizontal:a}=this.getProps(["x","y","base","horizontal"],e);return{x:a?(t+i)/2:t,y:a?n:(n+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}},yF=Object.freeze({__proto__:null,ArcElement:Gp,BarElement:Yp,LineElement:$l,PointElement:fF}),Kp=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],j1=Kp.map(r=>r.replace("rgb(","rgba(").replace(")",", 0.5)"));function Dw(r){return Kp[r%Kp.length]}function Aw(r){return j1[r%j1.length]}function xF(r,e){return r.borderColor=Dw(e),r.backgroundColor=Aw(e),++e}function _F(r,e){return r.backgroundColor=r.data.map(()=>Dw(e++)),e}function wF(r,e){return r.backgroundColor=r.data.map(()=>Aw(e++)),e}function CF(r){let e=0;return(t,n)=>{let i=r.getDatasetMeta(n).controller;i instanceof nm?e=_F(t,e):i instanceof mw?e=wF(t,e):i&&(e=xF(t,e))}}function H1(r){let e;for(e in r)if(r[e].borderColor||r[e].backgroundColor)return!0;return!1}function SF(r){return r&&(r.borderColor||r.backgroundColor)}var EF={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(r,e,t){if(!t.enabled)return;let{data:{datasets:n},options:i}=r.config,{elements:a}=i;if(!t.forceOverride&&(H1(n)||SF(i)||a&&H1(a)))return;let o=CF(r);n.forEach(o)}};function kF(r,e,t,n,i){let a=i.samples||n;if(a>=t)return r.slice(e,e+t);let o=[],s=(t-2)/(a-2),c=0,u=e+t-1,l=e,d,h,f,p,m;for(o[c++]=r[l],d=0;d<a-2;d++){let g=0,v=0,b,_=Math.floor((d+1)*s)+1+e,y=Math.min(Math.floor((d+2)*s)+1,t)+e,x=y-_;for(b=_;b<y;b++)g+=r[b].x,v+=r[b].y;g/=x,v/=x;let w=Math.floor(d*s)+1+e,S=Math.min(Math.floor((d+1)*s)+1,t)+e,{x:C,y:E}=r[l];for(f=p=-1,b=w;b<S;b++)p=.5*Math.abs((C-g)*(r[b].y-E)-(C-r[b].x)*(v-E)),p>f&&(f=p,h=r[b],m=b);o[c++]=h,l=m}return o[c++]=r[u],o}function DF(r,e,t,n){let i=0,a=0,o,s,c,u,l,d,h,f,p,m,g=[],v=e+t-1,b=r[e].x,y=r[v].x-b;for(o=e;o<e+t;++o){s=r[o],c=(s.x-b)/y*n,u=s.y;let x=c|0;if(x===l)u<p?(p=u,d=o):u>m&&(m=u,h=o),i=(a*i+s.x)/++a;else{let w=o-1;if(!Ft(d)&&!Ft(h)){let S=Math.min(d,h),C=Math.max(d,h);S!==f&&S!==w&&g.push(cn(Te({},r[S]),{x:i})),C!==f&&C!==w&&g.push(cn(Te({},r[C]),{x:i}))}o>0&&w!==f&&g.push(r[w]),g.push(s),l=x,a=0,p=m=u,d=h=f=o}}return g}function Iw(r){if(r._decimated){let e=r._data;delete r._decimated,delete r._data,Object.defineProperty(r,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function U1(r){r.data.datasets.forEach(e=>{Iw(e)})}function AF(r,e){let t=e.length,n=0,i,{iScale:a}=r,{min:o,max:s,minDefined:c,maxDefined:u}=a.getUserBounds();return c&&(n=Re(br(e,a.axis,o).lo,0,t-1)),u?i=Re(br(e,a.axis,s).hi+1,n,t)-n:i=t-n,{start:n,count:i}}var IF={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(r,e,t)=>{if(!t.enabled){U1(r);return}let n=r.width;r.data.datasets.forEach((i,a)=>{let{_data:o,indexAxis:s}=i,c=r.getDatasetMeta(a),u=o||i.data;if(Mo([s,r.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;let l=r.scales[c.xAxisID];if(l.type!=="linear"&&l.type!=="time"||r.options.parsing)return;let{start:d,count:h}=AF(c,u),f=t.threshold||4*n;if(h<=f){Iw(i);return}Ft(o)&&(i._data=u,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let p;switch(t.algorithm){case"lttb":p=kF(u,d,h,n,t);break;case"min-max":p=DF(u,d,h,n);break;default:throw new Error(`Unsupported decimation algorithm '${t.algorithm}'`)}i._decimated=p})},destroy(r){U1(r)}};function MF(r,e,t){let n=r.segments,i=r.points,a=e.points,o=[];for(let s of n){let{start:c,end:u}=s;u=rm(c,u,i);let l=Xp(t,i[c],i[u],s.loop);if(!e.segments){o.push({source:s,target:l,start:i[c],end:i[u]});continue}let d=Ep(e,l);for(let h of d){let f=Xp(t,a[h.start],a[h.end],h.loop),p=Sp(s,i,f);for(let m of p)o.push({source:m,target:h,start:{[t]:G1(l,f,"start",Math.max)},end:{[t]:G1(l,f,"end",Math.min)}})}}return o}function Xp(r,e,t,n){if(n)return;let i=e[r],a=t[r];return r==="angle"&&(i=gn(i),a=gn(a)),{property:r,start:i,end:a}}function RF(r,e){let{x:t=null,y:n=null}=r||{},i=e.points,a=[];return e.segments.forEach(({start:o,end:s})=>{s=rm(o,s,i);let c=i[o],u=i[s];n!==null?(a.push({x:c.x,y:n}),a.push({x:u.x,y:n})):t!==null&&(a.push({x:t,y:c.y}),a.push({x:t,y:u.y}))}),a}function rm(r,e,t){for(;e>r;e--){let n=t[e];if(!isNaN(n.x)&&!isNaN(n.y))break}return e}function G1(r,e,t,n){return r&&e?n(r[t],e[t]):r?r[t]:e?e[t]:0}function Mw(r,e){let t=[],n=!1;return $t(r)?(n=!0,t=r):t=RF(r,e),t.length?new $l({points:t,options:{tension:0},_loop:n,_fullLoop:n}):null}function q1(r){return r&&r.fill!==!1}function TF(r,e,t){let i=r[e].fill,a=[e],o;if(!t)return i;for(;i!==!1&&a.indexOf(i)===-1;){if(!le(i))return i;if(o=r[i],!o)return!1;if(o.visible)return i;a.push(i),i=o.fill}return!1}function FF(r,e,t){let n=LF(r);if(kt(n))return isNaN(n.value)?!1:n;let i=parseFloat(n);return le(i)&&Math.floor(i)===i?PF(n[0],e,i,t):["origin","start","end","stack","shape"].indexOf(n)>=0&&n}function PF(r,e,t,n){return(r==="-"||r==="+")&&(t=e+t),t===e||t<0||t>=n?!1:t}function OF(r,e){let t=null;return r==="start"?t=e.bottom:r==="end"?t=e.top:kt(r)?t=e.getPixelForValue(r.value):e.getBasePixel&&(t=e.getBasePixel()),t}function NF(r,e,t){let n;return r==="start"?n=t:r==="end"?n=e.options.reverse?e.min:e.max:kt(r)?n=r.value:n=e.getBaseValue(),n}function LF(r){let e=r.options,t=e.fill,n=_t(t&&t.target,t);return n===void 0&&(n=!!e.backgroundColor),n===!1||n===null?!1:n===!0?"origin":n}function BF(r){let{scale:e,index:t,line:n}=r,i=[],a=n.segments,o=n.points,s=VF(e,t);s.push(Mw({x:null,y:e.bottom},n));for(let c=0;c<a.length;c++){let u=a[c];for(let l=u.start;l<=u.end;l++)WF(i,o[l],s)}return new $l({points:i,options:{}})}function VF(r,e){let t=[],n=r.getMatchingVisibleMetas("line");for(let i=0;i<n.length;i++){let a=n[i];if(a.index===e)break;a.hidden||t.unshift(a.dataset)}return t}function WF(r,e,t){let n=[];for(let i=0;i<t.length;i++){let a=t[i],{first:o,last:s,point:c}=zF(a,e,"x");if(!(!c||o&&s)){if(o)n.unshift(c);else if(r.push(c),!s)break}}r.push(...n)}function zF(r,e,t){let n=r.interpolate(e,t);if(!n)return{};let i=n[t],a=r.segments,o=r.points,s=!1,c=!1;for(let u=0;u<a.length;u++){let l=a[u],d=o[l.start][t],h=o[l.end][t];if(_r(i,d,h)){s=i===d,c=i===h;break}}return{first:s,last:c,point:n}}var Yl=class{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,n){let{x:i,y:a,radius:o}=this;return t=t||{start:0,end:Jt},e.arc(i,a,o,t.end,t.start,!0),!n.bounds}interpolate(e){let{x:t,y:n,radius:i}=this,a=e.angle;return{x:t+Math.cos(a)*i,y:n+Math.sin(a)*i,angle:a}}};function jF(r){let{chart:e,fill:t,line:n}=r;if(le(t))return HF(e,t);if(t==="stack")return BF(r);if(t==="shape")return!0;let i=UF(r);return i instanceof Yl?i:Mw(i,n)}function HF(r,e){let t=r.getDatasetMeta(e);return t&&r.isDatasetVisible(e)?t.dataset:null}function UF(r){return(r.scale||{}).getPointPositionForValue?qF(r):GF(r)}function GF(r){let{scale:e={},fill:t}=r,n=OF(t,e);if(le(n)){let i=e.isHorizontal();return{x:i?n:null,y:i?null:n}}return null}function qF(r){let{scale:e,fill:t}=r,n=e.options,i=e.getLabels().length,a=n.reverse?e.max:e.min,o=NF(t,e,a),s=[];if(n.grid.circular){let c=e.getPointPositionForValue(0,a);return new Yl({x:c.x,y:c.y,radius:e.getDistanceFromCenterForValue(o)})}for(let c=0;c<i;++c)s.push(e.getPointPositionForValue(c,o));return s}function Pp(r,e,t){let n=jF(e),{line:i,scale:a,axis:o}=e,s=i.options,c=s.fill,u=s.backgroundColor,{above:l=u,below:d=u}=c||{};n&&i.points.length&&(Xs(r,t),YF(r,{line:i,target:n,above:l,below:d,area:t,scale:a,axis:o}),$s(r))}function YF(r,e){let{line:t,target:n,above:i,below:a,area:o,scale:s}=e,c=t._loop?"angle":e.axis;r.save(),c==="x"&&a!==i&&(Y1(r,n,o.top),K1(r,{line:t,target:n,color:i,scale:s,property:c}),r.restore(),r.save(),Y1(r,n,o.bottom)),K1(r,{line:t,target:n,color:a,scale:s,property:c}),r.restore()}function Y1(r,e,t){let{segments:n,points:i}=e,a=!0,o=!1;r.beginPath();for(let s of n){let{start:c,end:u}=s,l=i[c],d=i[rm(c,u,i)];a?(r.moveTo(l.x,l.y),a=!1):(r.lineTo(l.x,t),r.lineTo(l.x,l.y)),o=!!e.pathSegment(r,s,{move:o}),o?r.closePath():r.lineTo(d.x,t)}r.lineTo(e.first().x,t),r.closePath(),r.clip()}function K1(r,e){let{line:t,target:n,property:i,color:a,scale:o}=e,s=MF(t,n,i);for(let{source:c,target:u,start:l,end:d}of s){let{style:{backgroundColor:h=a}={}}=c,f=n!==!0;r.save(),r.fillStyle=h,KF(r,o,f&&Xp(i,l,d)),r.beginPath();let p=!!t.pathSegment(r,c),m;if(f){p?r.closePath():X1(r,n,d,i);let g=!!n.pathSegment(r,u,{move:p,reverse:!0});m=p&&g,m||X1(r,n,l,i)}r.closePath(),r.fill(m?"evenodd":"nonzero"),r.restore()}}function KF(r,e,t){let{top:n,bottom:i}=e.chart.chartArea,{property:a,start:o,end:s}=t||{};a==="x"&&(r.beginPath(),r.rect(o,n,s-o,i-n),r.clip())}function X1(r,e,t,n){let i=e.interpolate(t,n);i&&r.lineTo(i.x,i.y)}var XF={id:"filler",afterDatasetsUpdate(r,e,t){let n=(r.data.datasets||[]).length,i=[],a,o,s,c;for(o=0;o<n;++o)a=r.getDatasetMeta(o),s=a.dataset,c=null,s&&s.options&&s instanceof $l&&(c={visible:r.isDatasetVisible(o),index:o,fill:FF(s,o,n),chart:r,axis:a.controller.options.indexAxis,scale:a.vScale,line:s}),a.$filler=c,i.push(c);for(o=0;o<n;++o)c=i[o],!(!c||c.fill===!1)&&(c.fill=TF(i,o,t.propagate))},beforeDraw(r,e,t){let n=t.drawTime==="beforeDraw",i=r.getSortedVisibleDatasetMetas(),a=r.chartArea;for(let o=i.length-1;o>=0;--o){let s=i[o].$filler;s&&(s.line.updateControlPoints(a,s.axis),n&&s.fill&&Pp(r.ctx,s,a))}},beforeDatasetsDraw(r,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;let n=r.getSortedVisibleDatasetMetas();for(let i=n.length-1;i>=0;--i){let a=n[i].$filler;q1(a)&&Pp(r.ctx,a,r.chartArea)}},beforeDatasetDraw(r,e,t){let n=e.meta.$filler;!q1(n)||t.drawTime!=="beforeDatasetDraw"||Pp(r.ctx,n,r.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}},$1=(r,e)=>{let{boxHeight:t=e,boxWidth:n=e}=r;return r.usePointStyle&&(t=Math.min(t,e),n=r.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:t,itemHeight:Math.max(e,t)}},$F=(r,e)=>r!==null&&e!==null&&r.datasetIndex===e.datasetIndex&&r.index===e.index,Kl=class extends Jn{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let e=this.options.labels||{},t=Yt(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(n=>e.filter(n,this.chart.data))),e.sort&&(t=t.sort((n,i)=>e.sort(n,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){let{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}let n=e.labels,i=Ee(n.font),a=i.size,o=this._computeTitleHeight(),{boxWidth:s,itemHeight:c}=$1(n,a),u,l;t.font=i.string,this.isHorizontal()?(u=this.maxWidth,l=this._fitRows(o,a,s,c)+10):(l=this.maxHeight,u=this._fitCols(o,i,s,c)+10),this.width=Math.min(u,e.maxWidth||this.maxWidth),this.height=Math.min(l,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,i){let{ctx:a,maxWidth:o,options:{labels:{padding:s}}}=this,c=this.legendHitBoxes=[],u=this.lineWidths=[0],l=i+s,d=e;a.textAlign="left",a.textBaseline="middle";let h=-1,f=-l;return this.legendItems.forEach((p,m)=>{let g=n+t/2+a.measureText(p.text).width;(m===0||u[u.length-1]+g+2*s>o)&&(d+=l,u[u.length-(m>0?0:1)]=0,f+=l,h++),c[m]={left:0,top:f,row:h,width:g,height:i},u[u.length-1]+=g+s}),d}_fitCols(e,t,n,i){let{ctx:a,maxHeight:o,options:{labels:{padding:s}}}=this,c=this.legendHitBoxes=[],u=this.columnSizes=[],l=o-e,d=s,h=0,f=0,p=0,m=0;return this.legendItems.forEach((g,v)=>{let{itemWidth:b,itemHeight:_}=QF(n,t,a,g,i);v>0&&f+_+2*s>l&&(d+=h+s,u.push({width:h,height:f}),p+=h+s,m++,h=f=0),c[v]={left:p,top:f,col:m,width:b,height:_},h=Math.max(h,b),f+=_+s}),d+=h,u.push({width:h,height:f}),d}adjustHitBoxes(){if(!this.options.display)return;let e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:i},rtl:a}}=this,o=da(a,this.left,this.width);if(this.isHorizontal()){let s=0,c=Ye(n,this.left+i,this.right-this.lineWidths[s]);for(let u of t)s!==u.row&&(s=u.row,c=Ye(n,this.left+i,this.right-this.lineWidths[s])),u.top+=this.top+e+i,u.left=o.leftForLtr(o.x(c),u.width),c+=u.width+i}else{let s=0,c=Ye(n,this.top+e+i,this.bottom-this.columnSizes[s].height);for(let u of t)u.col!==s&&(s=u.col,c=Ye(n,this.top+e+i,this.bottom-this.columnSizes[s].height)),u.top=c,u.left+=this.left+i,u.left=o.leftForLtr(o.x(u.left),u.width),c+=u.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){let e=this.ctx;Xs(e,this),this._draw(),$s(e)}}_draw(){let{options:e,columnSizes:t,lineWidths:n,ctx:i}=this,{align:a,labels:o}=e,s=de.color,c=da(e.rtl,this.left,this.width),u=Ee(o.font),{padding:l}=o,d=u.size,h=d/2,f;this.drawTitle(),i.textAlign=c.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=u.string;let{boxWidth:p,boxHeight:m,itemHeight:g}=$1(o,d),v=function(w,S,C){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;i.save();let E=_t(C.lineWidth,1);if(i.fillStyle=_t(C.fillStyle,s),i.lineCap=_t(C.lineCap,"butt"),i.lineDashOffset=_t(C.lineDashOffset,0),i.lineJoin=_t(C.lineJoin,"miter"),i.lineWidth=E,i.strokeStyle=_t(C.strokeStyle,s),i.setLineDash(_t(C.lineDash,[])),o.usePointStyle){let D={radius:m*Math.SQRT2/2,pointStyle:C.pointStyle,rotation:C.rotation,borderWidth:E},R=c.xPlus(w,p/2),M=S+h;pp(i,D,R,M,o.pointStyleWidth&&p)}else{let D=S+Math.max((d-m)/2,0),R=c.leftForLtr(w,p),M=Ai(C.borderRadius);i.beginPath(),Object.values(M).some(L=>L!==0)?Io(i,{x:R,y:D,w:p,h:m,radius:M}):i.rect(R,D,p,m),i.fill(),E!==0&&i.stroke()}i.restore()},b=function(w,S,C){Di(i,C.text,w,S+g/2,u,{strikethrough:C.hidden,textAlign:c.textAlign(C.textAlign)})},_=this.isHorizontal(),y=this._computeTitleHeight();_?f={x:Ye(a,this.left+l,this.right-n[0]),y:this.top+l+y,line:0}:f={x:this.left+l,y:Ye(a,this.top+y+l,this.bottom-t[0].height),line:0},wp(this.ctx,e.textDirection);let x=g+l;this.legendItems.forEach((w,S)=>{i.strokeStyle=w.fontColor,i.fillStyle=w.fontColor;let C=i.measureText(w.text).width,E=c.textAlign(w.textAlign||(w.textAlign=o.textAlign)),D=p+h+C,R=f.x,M=f.y;c.setWidth(this.width),_?S>0&&R+D+l>this.right&&(M=f.y+=x,f.line++,R=f.x=Ye(a,this.left+l,this.right-n[f.line])):S>0&&M+x>this.bottom&&(R=f.x=R+t[f.line].width+l,f.line++,M=f.y=Ye(a,this.top+y+l,this.bottom-t[f.line].height));let L=c.x(R);if(v(L,M,w),R=X_(E,R+p+h,_?R+D:this.right,e.rtl),b(c.x(R),M,w),_)f.x+=D+l;else if(typeof w.text!="string"){let B=u.lineHeight;f.y+=Rw(w,B)+l}else f.y+=x}),Cp(this.ctx,e.textDirection)}drawTitle(){let e=this.options,t=e.title,n=Ee(t.font),i=Ke(t.padding);if(!t.display)return;let a=da(e.rtl,this.left,this.width),o=this.ctx,s=t.position,c=n.size/2,u=i.top+c,l,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),l=this.top+u,d=Ye(e.align,d,this.right-h);else{let p=this.columnSizes.reduce((m,g)=>Math.max(m,g.height),0);l=u+Ye(e.align,this.top,this.bottom-p-e.labels.padding-this._computeTitleHeight())}let f=Ye(s,d,d+h);o.textAlign=a.textAlign(kl(s)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=n.string,Di(o,t.text,f,l,n)}_computeTitleHeight(){let e=this.options.title,t=Ee(e.font),n=Ke(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,i,a;if(_r(e,this.left,this.right)&&_r(t,this.top,this.bottom)){for(a=this.legendHitBoxes,n=0;n<a.length;++n)if(i=a[n],_r(e,i.left,i.left+i.width)&&_r(t,i.top,i.top+i.height))return this.legendItems[n]}return null}handleEvent(e){let t=this.options;if(!tP(e.type,t))return;let n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){let i=this._hoveredItem,a=$F(i,n);i&&!a&&Yt(t.onLeave,[e,i,this],this),this._hoveredItem=n,n&&!a&&Yt(t.onHover,[e,n,this],this)}else n&&Yt(t.onClick,[e,n,this],this)}};function QF(r,e,t,n,i){let a=JF(n,r,e,t),o=ZF(i,n,e.lineHeight);return{itemWidth:a,itemHeight:o}}function JF(r,e,t,n){let i=r.text;return i&&typeof i!="string"&&(i=i.reduce((a,o)=>a.length>o.length?a:o)),e+t.size/2+n.measureText(i).width}function ZF(r,e,t){let n=r;return typeof e.text!="string"&&(n=Rw(e,t)),n}function Rw(r,e){let t=r.text?r.text.length:0;return e*t}function tP(r,e){return!!((r==="mousemove"||r==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(r==="click"||r==="mouseup"))}var eP={id:"legend",_element:Kl,start(r,e,t){let n=r.legend=new Kl({ctx:r.ctx,options:t,chart:r});tn.configure(r,n,t),tn.addBox(r,n)},stop(r){tn.removeBox(r,r.legend),delete r.legend},beforeUpdate(r,e,t){let n=r.legend;tn.configure(r,n,t),n.options=t},afterUpdate(r){let e=r.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(r,e){e.replay||r.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(r,e,t){let n=e.datasetIndex,i=t.chart;i.isDatasetVisible(n)?(i.hide(n),e.hidden=!0):(i.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:r=>r.chart.options.color,boxWidth:40,padding:10,generateLabels(r){let e=r.data.datasets,{labels:{usePointStyle:t,pointStyle:n,textAlign:i,color:a,useBorderRadius:o,borderRadius:s}}=r.legend.options;return r._getSortedDatasetMetas().map(c=>{let u=c.controller.getStyle(t?0:void 0),l=Ke(u.borderWidth);return{text:e[c.index].label,fillStyle:u.backgroundColor,fontColor:a,hidden:!c.visible,lineCap:u.borderCapStyle,lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:(l.width+l.height)/4,strokeStyle:u.borderColor,pointStyle:n||u.pointStyle,rotation:u.rotation,textAlign:i||u.textAlign,borderRadius:o&&(s||u.borderRadius),datasetIndex:c.index}},this)}},title:{color:r=>r.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:r=>!r.startsWith("on"),labels:{_scriptable:r=>!["generateLabels","filter","sort"].includes(r)}}},ac=class extends Jn{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){let n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;let i=$t(n.text)?n.text.length:1;this._padding=Ke(n.padding);let a=i*Ee(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=a:this.width=a}isHorizontal(){let e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){let{top:t,left:n,bottom:i,right:a,options:o}=this,s=o.align,c=0,u,l,d;return this.isHorizontal()?(l=Ye(s,n,a),d=t+e,u=a-n):(o.position==="left"?(l=n+e,d=Ye(s,i,t),c=Qt*-.5):(l=a-e,d=Ye(s,t,i),c=Qt*.5),u=i-t),{titleX:l,titleY:d,maxWidth:u,rotation:c}}draw(){let e=this.ctx,t=this.options;if(!t.display)return;let n=Ee(t.font),a=n.lineHeight/2+this._padding.top,{titleX:o,titleY:s,maxWidth:c,rotation:u}=this._drawArgs(a);Di(e,t.text,0,0,n,{color:t.color,maxWidth:c,rotation:u,textAlign:kl(t.align),textBaseline:"middle",translation:[o,s]})}};function nP(r,e){let t=new ac({ctx:r.ctx,options:e,chart:r});tn.configure(r,t,e),tn.addBox(r,t),r.titleBlock=t}var rP={id:"title",_element:ac,start(r,e,t){nP(r,t)},stop(r){let e=r.titleBlock;tn.removeBox(r,e),delete r.titleBlock},beforeUpdate(r,e,t){let n=r.titleBlock;tn.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},Bl=new WeakMap,iP={id:"subtitle",start(r,e,t){let n=new ac({ctx:r.ctx,options:t,chart:r});tn.configure(r,n,t),tn.addBox(r,n),Bl.set(r,n)},stop(r){tn.removeBox(r,Bl.get(r)),Bl.delete(r)},beforeUpdate(r,e,t){let n=Bl.get(r);tn.configure(r,n,t),n.options=t},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}},rc={average(r){if(!r.length)return!1;let e,t,n=new Set,i=0,a=0;for(e=0,t=r.length;e<t;++e){let s=r[e].element;if(s&&s.hasValue()){let c=s.tooltipPosition();n.add(c.x),i+=c.y,++a}}return{x:[...n].reduce((s,c)=>s+c)/n.size,y:i/a}},nearest(r,e){if(!r.length)return!1;let t=e.x,n=e.y,i=Number.POSITIVE_INFINITY,a,o,s;for(a=0,o=r.length;a<o;++a){let c=r[a].element;if(c&&c.hasValue()){let u=c.getCenterPoint(),l=_l(e,u);l<i&&(i=l,s=c)}}if(s){let c=s.tooltipPosition();t=c.x,n=c.y}return{x:t,y:n}}};function wr(r,e){return e&&($t(e)?Array.prototype.push.apply(r,e):r.push(e)),r}function Zr(r){return(typeof r=="string"||r instanceof String)&&r.indexOf(`
`)>-1?r.split(`
`):r}function aP(r,e){let{element:t,datasetIndex:n,index:i}=e,a=r.getDatasetMeta(n).controller,{label:o,value:s}=a.getLabelAndValue(i);return{chart:r,label:o,parsed:a.getParsed(i),raw:r.data.datasets[n].data[i],formattedValue:s,dataset:a.getDataset(),dataIndex:i,datasetIndex:n,element:t}}function Q1(r,e){let t=r.chart.ctx,{body:n,footer:i,title:a}=r,{boxWidth:o,boxHeight:s}=e,c=Ee(e.bodyFont),u=Ee(e.titleFont),l=Ee(e.footerFont),d=a.length,h=i.length,f=n.length,p=Ke(e.padding),m=p.height,g=0,v=n.reduce((y,x)=>y+x.before.length+x.lines.length+x.after.length,0);if(v+=r.beforeBody.length+r.afterBody.length,d&&(m+=d*u.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),v){let y=e.displayColors?Math.max(s,c.lineHeight):c.lineHeight;m+=f*y+(v-f)*c.lineHeight+(v-1)*e.bodySpacing}h&&(m+=e.footerMarginTop+h*l.lineHeight+(h-1)*e.footerSpacing);let b=0,_=function(y){g=Math.max(g,t.measureText(y).width+b)};return t.save(),t.font=u.string,Wt(r.title,_),t.font=c.string,Wt(r.beforeBody.concat(r.afterBody),_),b=e.displayColors?o+2+e.boxPadding:0,Wt(n,y=>{Wt(y.before,_),Wt(y.lines,_),Wt(y.after,_)}),b=0,t.font=l.string,Wt(r.footer,_),t.restore(),g+=p.width,{width:g,height:m}}function oP(r,e){let{y:t,height:n}=e;return t<n/2?"top":t>r.height-n/2?"bottom":"center"}function sP(r,e,t,n){let{x:i,width:a}=n,o=t.caretSize+t.caretPadding;if(r==="left"&&i+a+o>e.width||r==="right"&&i-a-o<0)return!0}function cP(r,e,t,n){let{x:i,width:a}=t,{width:o,chartArea:{left:s,right:c}}=r,u="center";return n==="center"?u=i<=(s+c)/2?"left":"right":i<=a/2?u="left":i>=o-a/2&&(u="right"),sP(u,r,e,t)&&(u="center"),u}function J1(r,e,t){let n=t.yAlign||e.yAlign||oP(r,t);return{xAlign:t.xAlign||e.xAlign||cP(r,e,t,n),yAlign:n}}function uP(r,e){let{x:t,width:n}=r;return e==="right"?t-=n:e==="center"&&(t-=n/2),t}function lP(r,e,t){let{y:n,height:i}=r;return e==="top"?n+=t:e==="bottom"?n-=i+t:n-=i/2,n}function Z1(r,e,t,n){let{caretSize:i,caretPadding:a,cornerRadius:o}=r,{xAlign:s,yAlign:c}=t,u=i+a,{topLeft:l,topRight:d,bottomLeft:h,bottomRight:f}=Ai(o),p=uP(e,s),m=lP(e,c,u);return c==="center"?s==="left"?p+=u:s==="right"&&(p-=u):s==="left"?p-=Math.max(l,h)+i:s==="right"&&(p+=Math.max(d,f)+i),{x:Re(p,0,n.width-e.width),y:Re(m,0,n.height-e.height)}}function Vl(r,e,t){let n=Ke(t.padding);return e==="center"?r.x+r.width/2:e==="right"?r.x+r.width-n.right:r.x+n.left}function tw(r){return wr([],Zr(r))}function dP(r,e,t){return Qr(r,{tooltip:e,tooltipItems:t,type:"tooltip"})}function ew(r,e){let t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?r.override(t):r}var Tw={beforeTitle:xr,title(r){if(r.length>0){let e=r[0],t=e.chart.data.labels,n=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return t[e.dataIndex]}return""},afterTitle:xr,beforeBody:xr,beforeLabel:xr,label(r){if(this&&this.options&&this.options.mode==="dataset")return r.label+": "+r.formattedValue||r.formattedValue;let e=r.dataset.label||"";e&&(e+=": ");let t=r.formattedValue;return Ft(t)||(e+=t),e},labelColor(r){let t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(r){let t=r.chart.getDatasetMeta(r.datasetIndex).controller.getStyle(r.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:xr,afterBody:xr,beforeFooter:xr,footer:xr,afterFooter:xr};function bn(r,e,t,n){let i=r[e].call(t,n);return typeof i>"u"?Tw[e].call(t,n):i}var nw=(()=>{class r extends Jn{static positioners=rc;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let t=this._cachedAnimations;if(t)return t;let n=this.chart,i=this.options.setContext(this.getContext()),a=i.enabled&&n.options.animation&&i.animations,o=new Hl(this.chart,a);return a._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=dP(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){let{callbacks:i}=n,a=bn(i,"beforeTitle",this,t),o=bn(i,"title",this,t),s=bn(i,"afterTitle",this,t),c=[];return c=wr(c,Zr(a)),c=wr(c,Zr(o)),c=wr(c,Zr(s)),c}getBeforeBody(t,n){return tw(bn(n.callbacks,"beforeBody",this,t))}getBody(t,n){let{callbacks:i}=n,a=[];return Wt(t,o=>{let s={before:[],lines:[],after:[]},c=ew(i,o);wr(s.before,Zr(bn(c,"beforeLabel",this,o))),wr(s.lines,bn(c,"label",this,o)),wr(s.after,Zr(bn(c,"afterLabel",this,o))),a.push(s)}),a}getAfterBody(t,n){return tw(bn(n.callbacks,"afterBody",this,t))}getFooter(t,n){let{callbacks:i}=n,a=bn(i,"beforeFooter",this,t),o=bn(i,"footer",this,t),s=bn(i,"afterFooter",this,t),c=[];return c=wr(c,Zr(a)),c=wr(c,Zr(o)),c=wr(c,Zr(s)),c}_createItems(t){let n=this._active,i=this.chart.data,a=[],o=[],s=[],c=[],u,l;for(u=0,l=n.length;u<l;++u)c.push(aP(this.chart,n[u]));return t.filter&&(c=c.filter((d,h,f)=>t.filter(d,h,f,i))),t.itemSort&&(c=c.sort((d,h)=>t.itemSort(d,h,i))),Wt(c,d=>{let h=ew(t.callbacks,d);a.push(bn(h,"labelColor",this,d)),o.push(bn(h,"labelPointStyle",this,d)),s.push(bn(h,"labelTextColor",this,d))}),this.labelColors=a,this.labelPointStyles=o,this.labelTextColors=s,this.dataPoints=c,c}update(t,n){let i=this.options.setContext(this.getContext()),a=this._active,o,s=[];if(!a.length)this.opacity!==0&&(o={opacity:0});else{let c=rc[i.position].call(this,a,this._eventPosition);s=this._createItems(i),this.title=this.getTitle(s,i),this.beforeBody=this.getBeforeBody(s,i),this.body=this.getBody(s,i),this.afterBody=this.getAfterBody(s,i),this.footer=this.getFooter(s,i);let u=this._size=Q1(this,i),l=Object.assign({},c,u),d=J1(this.chart,i,l),h=Z1(i,l,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:h.x,y:h.y,width:u.width,height:u.height,caretX:c.x,caretY:c.y}}this._tooltipItems=s,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,a){let o=this.getCaretPosition(t,i,a);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){let{xAlign:a,yAlign:o}=this,{caretSize:s,cornerRadius:c}=i,{topLeft:u,topRight:l,bottomLeft:d,bottomRight:h}=Ai(c),{x:f,y:p}=t,{width:m,height:g}=n,v,b,_,y,x,w;return o==="center"?(x=p+g/2,a==="left"?(v=f,b=v-s,y=x+s,w=x-s):(v=f+m,b=v+s,y=x-s,w=x+s),_=v):(a==="left"?b=f+Math.max(u,d)+s:a==="right"?b=f+m-Math.max(l,h)-s:b=this.caretX,o==="top"?(y=p,x=y-s,v=b-s,_=b+s):(y=p+g,x=y+s,v=b+s,_=b-s),w=y),{x1:v,x2:b,x3:_,y1:y,y2:x,y3:w}}drawTitle(t,n,i){let a=this.title,o=a.length,s,c,u;if(o){let l=da(i.rtl,this.x,this.width);for(t.x=Vl(this,i.titleAlign,i),n.textAlign=l.textAlign(i.titleAlign),n.textBaseline="middle",s=Ee(i.titleFont),c=i.titleSpacing,n.fillStyle=i.titleColor,n.font=s.string,u=0;u<o;++u)n.fillText(a[u],l.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+c,u+1===o&&(t.y+=i.titleMarginBottom-c)}}_drawColorBox(t,n,i,a,o){let s=this.labelColors[i],c=this.labelPointStyles[i],{boxHeight:u,boxWidth:l}=o,d=Ee(o.bodyFont),h=Vl(this,"left",o),f=a.x(h),p=u<d.lineHeight?(d.lineHeight-u)/2:0,m=n.y+p;if(o.usePointStyle){let g={radius:Math.min(l,u)/2,pointStyle:c.pointStyle,rotation:c.rotation,borderWidth:1},v=a.leftForLtr(f,l)+l/2,b=m+u/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,Al(t,g,v,b),t.strokeStyle=s.borderColor,t.fillStyle=s.backgroundColor,Al(t,g,v,b)}else{t.lineWidth=kt(s.borderWidth)?Math.max(...Object.values(s.borderWidth)):s.borderWidth||1,t.strokeStyle=s.borderColor,t.setLineDash(s.borderDash||[]),t.lineDashOffset=s.borderDashOffset||0;let g=a.leftForLtr(f,l),v=a.leftForLtr(a.xPlus(f,1),l-2),b=Ai(s.borderRadius);Object.values(b).some(_=>_!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,Io(t,{x:g,y:m,w:l,h:u,radius:b}),t.fill(),t.stroke(),t.fillStyle=s.backgroundColor,t.beginPath(),Io(t,{x:v,y:m+1,w:l-2,h:u-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(g,m,l,u),t.strokeRect(g,m,l,u),t.fillStyle=s.backgroundColor,t.fillRect(v,m+1,l-2,u-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){let{body:a}=this,{bodySpacing:o,bodyAlign:s,displayColors:c,boxHeight:u,boxWidth:l,boxPadding:d}=i,h=Ee(i.bodyFont),f=h.lineHeight,p=0,m=da(i.rtl,this.x,this.width),g=function(E){n.fillText(E,m.x(t.x+p),t.y+f/2),t.y+=f+o},v=m.textAlign(s),b,_,y,x,w,S,C;for(n.textAlign=s,n.textBaseline="middle",n.font=h.string,t.x=Vl(this,v,i),n.fillStyle=i.bodyColor,Wt(this.beforeBody,g),p=c&&v!=="right"?s==="center"?l/2+d:l+2+d:0,x=0,S=a.length;x<S;++x){for(b=a[x],_=this.labelTextColors[x],n.fillStyle=_,Wt(b.before,g),y=b.lines,c&&y.length&&(this._drawColorBox(n,t,x,m,i),f=Math.max(h.lineHeight,u)),w=0,C=y.length;w<C;++w)g(y[w]),f=h.lineHeight;Wt(b.after,g)}p=0,f=h.lineHeight,Wt(this.afterBody,g),t.y-=o}drawFooter(t,n,i){let a=this.footer,o=a.length,s,c;if(o){let u=da(i.rtl,this.x,this.width);for(t.x=Vl(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=u.textAlign(i.footerAlign),n.textBaseline="middle",s=Ee(i.footerFont),n.fillStyle=i.footerColor,n.font=s.string,c=0;c<o;++c)n.fillText(a[c],u.x(t.x),t.y+s.lineHeight/2),t.y+=s.lineHeight+i.footerSpacing}}drawBackground(t,n,i,a){let{xAlign:o,yAlign:s}=this,{x:c,y:u}=t,{width:l,height:d}=i,{topLeft:h,topRight:f,bottomLeft:p,bottomRight:m}=Ai(a.cornerRadius);n.fillStyle=a.backgroundColor,n.strokeStyle=a.borderColor,n.lineWidth=a.borderWidth,n.beginPath(),n.moveTo(c+h,u),s==="top"&&this.drawCaret(t,n,i,a),n.lineTo(c+l-f,u),n.quadraticCurveTo(c+l,u,c+l,u+f),s==="center"&&o==="right"&&this.drawCaret(t,n,i,a),n.lineTo(c+l,u+d-m),n.quadraticCurveTo(c+l,u+d,c+l-m,u+d),s==="bottom"&&this.drawCaret(t,n,i,a),n.lineTo(c+p,u+d),n.quadraticCurveTo(c,u+d,c,u+d-p),s==="center"&&o==="left"&&this.drawCaret(t,n,i,a),n.lineTo(c,u+h),n.quadraticCurveTo(c,u,c+h,u),n.closePath(),n.fill(),a.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){let n=this.chart,i=this.$animations,a=i&&i.x,o=i&&i.y;if(a||o){let s=rc[t.position].call(this,this._active,this._eventPosition);if(!s)return;let c=this._size=Q1(this,t),u=Object.assign({},s,this._size),l=J1(n,t,u),d=Z1(t,u,l,n);(a._to!==d.x||o._to!==d.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=c.width,this.height=c.height,this.caretX=s.x,this.caretY=s.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){let n=this.options.setContext(this.getContext()),i=this.opacity;if(!i)return;this._updateAnimationTarget(n);let a={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;let s=Ke(n.padding),c=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&c&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,a,n),wp(t,n.textDirection),o.y+=s.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),Cp(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){let i=this._active,a=t.map(({datasetIndex:c,index:u})=>{let l=this.chart.getDatasetMeta(c);if(!l)throw new Error("Cannot find a dataset at index "+c);return{datasetIndex:c,element:l.data[u],index:u}}),o=!Ys(i,a),s=this._positionChanged(a,n);(o||s)&&(this._active=a,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let a=this.options,o=this._active||[],s=this._getActiveElements(t,o,n,i),c=this._positionChanged(s,t),u=n||!Ys(s,o)||c;return u&&(this._active=s,(a.enabled||a.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),u}_getActiveElements(t,n,i,a){let o=this.options;if(t.type==="mouseout")return[];if(!a)return n.filter(c=>this.chart.data.datasets[c.datasetIndex]&&this.chart.getDatasetMeta(c.datasetIndex).controller.getParsed(c.index)!==void 0);let s=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&s.reverse(),s}_positionChanged(t,n){let{caretX:i,caretY:a,options:o}=this,s=rc[o.position].call(this,t,n);return s!==!1&&(i!==s.x||a!==s.y)}}return r})(),hP={id:"tooltip",_element:nw,positioners:rc,afterInit(r,e,t){t&&(r.tooltip=new nw({chart:r,options:t}))},beforeUpdate(r,e,t){r.tooltip&&r.tooltip.initialize(t)},reset(r,e,t){r.tooltip&&r.tooltip.initialize(t)},afterDraw(r){let e=r.tooltip;if(e&&e._willRender()){let t={tooltip:e};if(r.notifyPlugins("beforeTooltipDraw",cn(Te({},t),{cancelable:!0}))===!1)return;e.draw(r.ctx),r.notifyPlugins("afterTooltipDraw",t)}},afterEvent(r,e){if(r.tooltip){let t=e.replay;r.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(r,e)=>e.bodyFont.size,boxWidth:(r,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Tw},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:r=>r!=="filter"&&r!=="itemSort"&&r!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},fP=Object.freeze({__proto__:null,Colors:EF,Decimation:IF,Filler:XF,Legend:eP,SubTitle:iP,Title:rP,Tooltip:hP}),pP=(r,e,t,n)=>(typeof e=="string"?(t=r.push(e)-1,n.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function mP(r,e,t,n){let i=r.indexOf(e);if(i===-1)return pP(r,e,t,n);let a=r.lastIndexOf(e);return i!==a?t:i}var gP=(r,e)=>r===null?null:Re(Math.round(r),0,e);function rw(r){let e=this.getLabels();return r>=0&&r<e.length?e[r]:r}var vP=(()=>{class r extends pa{static id="category";static defaults={ticks:{callback:rw}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){let n=this._addedLabels;if(n.length){let i=this.getLabels();for(let{index:a,label:o}of n)i[a]===o&&i.splice(a,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(Ft(t))return null;let i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:mP(i,t,_t(n,t),this._addedLabels),gP(n,i.length-1)}determineDataLimits(){let{minDefined:t,maxDefined:n}=this.getUserBounds(),{min:i,max:a}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(a=this.getLabels().length-1)),this.min=i,this.max=a}buildTicks(){let t=this.min,n=this.max,i=this.options.offset,a=[],o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let s=t;s<=n;s++)a.push({value:s});return a}getLabelForValue(t){return rw.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){let n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}return r})();function bP(r,e){let t=[],{bounds:i,step:a,min:o,max:s,precision:c,count:u,maxTicks:l,maxDigits:d,includeBounds:h}=r,f=a||1,p=l-1,{min:m,max:g}=e,v=!Ft(o),b=!Ft(s),_=!Ft(u),y=(g-m)/(d+1),x=ep((g-m)/p/f)*f,w,S,C,E;if(x<1e-14&&!v&&!b)return[{value:m},{value:g}];E=Math.ceil(g/x)-Math.floor(m/x),E>p&&(x=ep(E*x/p/f)*f),Ft(c)||(w=Math.pow(10,c),x=Math.ceil(x*w)/w),i==="ticks"?(S=Math.floor(m/x)*x,C=Math.ceil(g/x)*x):(S=m,C=g),v&&b&&a&&j_((s-o)/a,x/1e3)?(E=Math.round(Math.min((s-o)/x,l)),x=(s-o)/E,S=o,C=s):_?(S=v?o:S,C=b?s:C,E=u-1,x=(C-S)/E):(E=(C-S)/x,ko(E,Math.round(E),x/1e3)?E=Math.round(E):E=Math.ceil(E));let D=Math.max(rp(x),rp(S));w=Math.pow(10,Ft(c)?D:c),S=Math.round(S*w)/w,C=Math.round(C*w)/w;let R=0;for(v&&(h&&S!==o?(t.push({value:o}),S<o&&R++,ko(Math.round((S+R*x)*w)/w,o,iw(o,y,r))&&R++):S<o&&R++);R<E;++R){let M=Math.round((S+R*x)*w)/w;if(b&&M>s)break;t.push({value:M})}return b&&h&&C!==s?t.length&&ko(t[t.length-1].value,s,iw(s,y,r))?t[t.length-1].value=s:t.push({value:s}):(!b||C===s)&&t.push({value:C}),t}function iw(r,e,{horizontal:t,minRotation:n}){let i=Bn(n),a=(t?Math.sin(i):Math.cos(i))||.001,o=.75*e*(""+r).length;return Math.min(e/a,o)}var Fo=class extends pa{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Ft(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){let{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds(),{min:i,max:a}=this,o=c=>i=t?i:c,s=c=>a=n?a:c;if(e){let c=Qn(i),u=Qn(a);c<0&&u<0?s(0):c>0&&u>0&&o(0)}if(i===a){let c=a===0?1:Math.abs(a*.05);s(a+c),e||o(i-c)}this.min=i,this.max=a}getTickLimit(){let e=this.options.ticks,{maxTicksLimit:t,stepSize:n}=e,i;return n?(i=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let e=this.options,t=e.ticks,n=this.getTickLimit();n=Math.max(2,n);let i={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},a=this._range||this,o=bP(i,a);return e.bounds==="ticks"&&np(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){let e=this.ticks,t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){let i=(n-t)/Math.max(e.length-1,1)/2;t-=i,n+=i}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return Ao(e,this.chart.options.locale,this.options.ticks.format)}},$p=class extends Fo{static id="linear";static defaults={ticks:{callback:Ks.formatters.numeric}};determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=le(e)?e:0,this.max=le(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){let e=this.isHorizontal(),t=e?this.width:this.height,n=Bn(this.options.ticks.minRotation),i=(e?Math.sin(n):Math.cos(n))||.001,a=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,a.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}},oc=r=>Math.floor(Xr(r)),fa=(r,e)=>Math.pow(10,oc(r)+e);function aw(r){return r/Math.pow(10,oc(r))===1}function ow(r,e,t){let n=Math.pow(10,t),i=Math.floor(r/n);return Math.ceil(e/n)-i}function yP(r,e){let t=e-r,n=oc(t);for(;ow(r,e,n)>10;)n++;for(;ow(r,e,n)<10;)n--;return Math.min(n,oc(r))}function xP(r,{min:e,max:t}){e=vn(r.min,e);let n=[],i=oc(e),a=yP(e,t),o=a<0?Math.pow(10,Math.abs(a)):1,s=Math.pow(10,a),c=i>a?Math.pow(10,i):0,u=Math.round((e-c)*o)/o,l=Math.floor((e-c)/s/10)*s*10,d=Math.floor((u-l)/Math.pow(10,a)),h=vn(r.min,Math.round((c+l+d*Math.pow(10,a))*o)/o);for(;h<t;)n.push({value:h,major:aw(h),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(a++,d=2,o=a>=0?1:o),h=Math.round((c+l+d*Math.pow(10,a))*o)/o;let f=vn(r.max,h);return n.push({value:f,major:aw(f),significand:d}),n}var Qp=class extends pa{static id="logarithmic";static defaults={ticks:{callback:Ks.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){let n=Fo.prototype.parse.apply(this,[e,t]);if(n===0){this._zero=!0;return}return le(n)&&n>0?n:null}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=le(e)?Math.max(0,e):null,this.max=le(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!le(this._userMin)&&(this.min=e===fa(this.min,0)?fa(this.min,-1):fa(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:e,maxDefined:t}=this.getUserBounds(),n=this.min,i=this.max,a=s=>n=e?n:s,o=s=>i=t?i:s;n===i&&(n<=0?(a(1),o(10)):(a(fa(n,-1)),o(fa(i,1)))),n<=0&&a(fa(i,-1)),i<=0&&o(fa(n,1)),this.min=n,this.max=i}buildTicks(){let e=this.options,t={min:this._userMin,max:this._userMax},n=xP(t,this);return e.bounds==="ticks"&&np(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":Ao(e,this.chart.options.locale,this.options.ticks.format)}configure(){let e=this.min;super.configure(),this._startValue=Xr(e),this._valueRange=Xr(this.max)-Xr(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Xr(e)-this._startValue)/this._valueRange)}getValueForPixel(e){let t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}};function Jp(r){let e=r.ticks;if(e.display&&r.display){let t=Ke(e.backdropPadding);return _t(e.font&&e.font.size,de.font.size)+t.height}return 0}function _P(r,e,t){return t=$t(t)?t:[t],{w:Q_(r,e.string,t),h:t.length*e.lineHeight}}function sw(r,e,t,n,i){return r===n||r===i?{start:e-t/2,end:e+t/2}:r<n||r>i?{start:e-t,end:e}:{start:e,end:e+t}}function wP(r){let e={l:r.left+r._padding.left,r:r.right-r._padding.right,t:r.top+r._padding.top,b:r.bottom-r._padding.bottom},t=Object.assign({},e),n=[],i=[],a=r._pointLabels.length,o=r.options.pointLabels,s=o.centerPointLabels?Qt/a:0;for(let c=0;c<a;c++){let u=o.setContext(r.getPointLabelContext(c));i[c]=u.padding;let l=r.getPointPosition(c,r.drawingArea+i[c],s),d=Ee(u.font),h=_P(r.ctx,d,r._pointLabels[c]);n[c]=h;let f=gn(r.getIndexAngle(c)+s),p=Math.round(Sl(f)),m=sw(p,l.x,h.w,0,180),g=sw(p,l.y,h.h,90,270);CP(t,e,f,m,g)}r.setCenterPoint(e.l-t.l,t.r-e.r,e.t-t.t,t.b-e.b),r._pointLabelItems=kP(r,n,i)}function CP(r,e,t,n,i){let a=Math.abs(Math.sin(t)),o=Math.abs(Math.cos(t)),s=0,c=0;n.start<e.l?(s=(e.l-n.start)/a,r.l=Math.min(r.l,e.l-s)):n.end>e.r&&(s=(n.end-e.r)/a,r.r=Math.max(r.r,e.r+s)),i.start<e.t?(c=(e.t-i.start)/o,r.t=Math.min(r.t,e.t-c)):i.end>e.b&&(c=(i.end-e.b)/o,r.b=Math.max(r.b,e.b+c))}function SP(r,e,t){let n=r.drawingArea,{extra:i,additionalAngle:a,padding:o,size:s}=t,c=r.getPointPosition(e,n+i+o,a),u=Math.round(Sl(gn(c.angle+ve))),l=IP(c.y,s.h,u),d=DP(u),h=AP(c.x,s.w,d);return{visible:!0,x:c.x,y:l,textAlign:d,left:h,top:l,right:h+s.w,bottom:l+s.h}}function EP(r,e){if(!e)return!0;let{left:t,top:n,right:i,bottom:a}=r;return!(yr({x:t,y:n},e)||yr({x:t,y:a},e)||yr({x:i,y:n},e)||yr({x:i,y:a},e))}function kP(r,e,t){let n=[],i=r._pointLabels.length,a=r.options,{centerPointLabels:o,display:s}=a.pointLabels,c={extra:Jp(a)/2,additionalAngle:o?Qt/i:0},u;for(let l=0;l<i;l++){c.padding=t[l],c.size=e[l];let d=SP(r,l,c);n.push(d),s==="auto"&&(d.visible=EP(d,u),d.visible&&(u=d))}return n}function DP(r){return r===0||r===180?"center":r<180?"left":"right"}function AP(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function IP(r,e,t){return t===90||t===270?r-=e/2:(t>270||t<90)&&(r-=e),r}function MP(r,e,t){let{left:n,top:i,right:a,bottom:o}=t,{backdropColor:s}=e;if(!Ft(s)){let c=Ai(e.borderRadius),u=Ke(e.backdropPadding);r.fillStyle=s;let l=n-u.left,d=i-u.top,h=a-n+u.width,f=o-i+u.height;Object.values(c).some(p=>p!==0)?(r.beginPath(),Io(r,{x:l,y:d,w:h,h:f,radius:c}),r.fill()):r.fillRect(l,d,h,f)}}function RP(r,e){let{ctx:t,options:{pointLabels:n}}=r;for(let i=e-1;i>=0;i--){let a=r._pointLabelItems[i];if(!a.visible)continue;let o=n.setContext(r.getPointLabelContext(i));MP(t,o,a);let s=Ee(o.font),{x:c,y:u,textAlign:l}=a;Di(t,r._pointLabels[i],c,u+s.lineHeight/2,s,{color:o.color,textAlign:l,textBaseline:"middle"})}}function Fw(r,e,t,n){let{ctx:i}=r;if(t)i.arc(r.xCenter,r.yCenter,e,0,Jt);else{let a=r.getPointPosition(0,e);i.moveTo(a.x,a.y);for(let o=1;o<n;o++)a=r.getPointPosition(o,e),i.lineTo(a.x,a.y)}}function TP(r,e,t,n,i){let a=r.ctx,o=e.circular,{color:s,lineWidth:c}=e;!o&&!n||!s||!c||t<0||(a.save(),a.strokeStyle=s,a.lineWidth=c,a.setLineDash(i.dash),a.lineDashOffset=i.dashOffset,a.beginPath(),Fw(r,t,o,n),a.closePath(),a.stroke(),a.restore())}function FP(r,e,t){return Qr(r,{label:t,index:e,type:"pointLabel"})}var Zp=class extends Fo{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ks.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let e=this._padding=Ke(Jp(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!1);this.min=le(e)&&!isNaN(e)?e:0,this.max=le(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Jp(this.options))}generateTickLabels(e){Fo.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((t,n)=>{let i=Yt(this.options.pointLabels.callback,[t,n],this);return i||i===0?i:""}).filter((t,n)=>this.chart.getDataVisibility(n))}fit(){let e=this.options;e.display&&e.pointLabels.display?wP(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,i))}getIndexAngle(e){let t=Jt/(this._pointLabels.length||1),n=this.options.startAngle||0;return gn(e*t+Bn(n))}getDistanceFromCenterForValue(e){if(Ft(e))return NaN;let t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Ft(e))return NaN;let t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){let t=this._pointLabels||[];if(e>=0&&e<t.length){let n=t[e];return FP(this.getContext(),e,n)}}getPointPosition(e,t,n=0){let i=this.getIndexAngle(e)-ve+n;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){let{left:t,top:n,right:i,bottom:a}=this._pointLabelItems[e];return{left:t,top:n,right:i,bottom:a}}drawBackground(){let{backgroundColor:e,grid:{circular:t}}=this.options;if(e){let n=this.ctx;n.save(),n.beginPath(),Fw(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){let e=this.ctx,t=this.options,{angleLines:n,grid:i,border:a}=t,o=this._pointLabels.length,s,c,u;if(t.pointLabels.display&&RP(this,o),i.display&&this.ticks.forEach((l,d)=>{if(d!==0||d===0&&this.min<0){c=this.getDistanceFromCenterForValue(l.value);let h=this.getContext(d),f=i.setContext(h),p=a.setContext(h);TP(this,f,c,o,p)}}),n.display){for(e.save(),s=o-1;s>=0;s--){let l=n.setContext(this.getPointLabelContext(s)),{color:d,lineWidth:h}=l;!h||!d||(e.lineWidth=h,e.strokeStyle=d,e.setLineDash(l.borderDash),e.lineDashOffset=l.borderDashOffset,c=this.getDistanceFromCenterForValue(t.ticks.reverse?this.min:this.max),u=this.getPointPosition(s,c),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(u.x,u.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){let e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;let i=this.getIndexAngle(0),a,o;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((s,c)=>{if(c===0&&this.min>=0&&!t.reverse)return;let u=n.setContext(this.getContext(c)),l=Ee(u.font);if(a=this.getDistanceFromCenterForValue(this.ticks[c].value),u.showLabelBackdrop){e.font=l.string,o=e.measureText(s.label).width,e.fillStyle=u.backdropColor;let d=Ke(u.backdropPadding);e.fillRect(-o/2-d.left,-a-l.size/2-d.top,o+d.width,l.size+d.height)}Di(e,s.label,0,-a,l,{color:u.color,strokeColor:u.textStrokeColor,strokeWidth:u.textStrokeWidth})}),e.restore()}drawTitle(){}},Ql={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},yn=Object.keys(Ql);function cw(r,e){return r-e}function uw(r,e){if(Ft(e))return null;let t=r._adapter,{parser:n,round:i,isoWeekday:a}=r._parseOpts,o=e;return typeof n=="function"&&(o=n(o)),le(o)||(o=typeof n=="string"?t.parse(o,n):t.parse(o)),o===null?null:(i&&(o=i==="week"&&(la(a)||a===!0)?t.startOf(o,"isoWeek",a):t.startOf(o,i)),+o)}function lw(r,e,t,n){let i=yn.length;for(let a=yn.indexOf(r);a<i-1;++a){let o=Ql[yn[a]],s=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((t-e)/(s*o.size))<=n)return yn[a]}return yn[i-1]}function PP(r,e,t,n,i){for(let a=yn.length-1;a>=yn.indexOf(t);a--){let o=yn[a];if(Ql[o].common&&r._adapter.diff(i,n,o)>=e-1)return o}return yn[t?yn.indexOf(t):0]}function OP(r){for(let e=yn.indexOf(r)+1,t=yn.length;e<t;++e)if(Ql[yn[e]].common)return yn[e]}function dw(r,e,t){if(!t)r[e]=!0;else if(t.length){let{lo:n,hi:i}=El(t,e),a=t[n]>=e?t[n]:t[i];r[a]=!0}}function NP(r,e,t,n){let i=r._adapter,a=+i.startOf(e[0].value,n),o=e[e.length-1].value,s,c;for(s=a;s<=o;s=+i.add(s,1,n))c=t[s],c>=0&&(e[c].major=!0);return e}function hw(r,e,t){let n=[],i={},a=e.length,o,s;for(o=0;o<a;++o)s=e[o],i[s]=o,n.push({value:s,major:!1});return a===0||!t?n:NP(r,n,i,t)}var tm=(()=>{class r extends pa{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){let i=t.time||(t.time={}),a=this._adapter=new KR._date(t.adapters.date);a.init(n),So(i.displayFormats,a.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:uw(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let t=this.options,n=this._adapter,i=t.time.unit||"day",{min:a,max:o,minDefined:s,maxDefined:c}=this.getUserBounds();function u(l){!s&&!isNaN(l.min)&&(a=Math.min(a,l.min)),!c&&!isNaN(l.max)&&(o=Math.max(o,l.max))}(!s||!c)&&(u(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&u(this.getMinMax(!1))),a=le(a)&&!isNaN(a)?a:+n.startOf(Date.now(),i),o=le(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(a,o-1),this.max=Math.max(a+1,o)}_getLabelBounds(){let t=this.getLabelTimestamps(),n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){let t=this.options,n=t.time,i=t.ticks,a=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&a.length&&(this.min=this._userMin||a[0],this.max=this._userMax||a[a.length-1]);let o=this.min,s=this.max,c=G_(a,o,s);return this._unit=n.unit||(i.autoSkip?lw(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):PP(this,c.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:OP(this._unit),this.initOffsets(a),t.reverse&&c.reverse(),hw(this,c,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,a,o;this.options.offset&&t.length&&(a=this.getDecimalForValue(t[0]),t.length===1?n=1-a:n=(this.getDecimalForValue(t[1])-a)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);let s=t.length<3?.5:.25;n=Re(n,0,s),i=Re(i,0,s),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){let t=this._adapter,n=this.min,i=this.max,a=this.options,o=a.time,s=o.unit||lw(o.minUnit,n,i,this._getLabelCapacity(n)),c=_t(a.ticks.stepSize,1),u=s==="week"?o.isoWeekday:!1,l=la(u)||u===!0,d={},h=n,f,p;if(l&&(h=+t.startOf(h,"isoWeek",u)),h=+t.startOf(h,l?"day":s),t.diff(i,n,s)>1e5*c)throw new Error(n+" and "+i+" are too far apart with stepSize of "+c+" "+s);let m=a.ticks.source==="data"&&this.getDataTimestamps();for(f=h,p=0;f<i;f=+t.add(f,c,s),p++)dw(d,f,m);return(f===i||a.bounds==="ticks"||p===1)&&dw(d,f,m),Object.keys(d).sort(cw).map(g=>+g)}getLabelForValue(t){let n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){let a=this.options.time.displayFormats,o=this._unit,s=n||a[o];return this._adapter.format(t,s)}_tickFormatFunction(t,n,i,a){let o=this.options,s=o.ticks.callback;if(s)return Yt(s,[t,n,i],this);let c=o.time.displayFormats,u=this._unit,l=this._majorUnit,d=u&&c[u],h=l&&c[l],f=i[n],p=l&&h&&f&&f.major;return this._adapter.format(t,a||(p?h:d))}generateTickLabels(t){let n,i,a;for(n=0,i=t.length;n<i;++n)a=t[n],a.label=this._tickFormatFunction(a.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){let n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){let n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){let n=this.options.ticks,i=this.ctx.measureText(t).width,a=Bn(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(a),s=Math.sin(a),c=this._resolveTickFontOptions(0).size;return{w:i*o+c*s,h:i*s+c*o}}_getLabelCapacity(t){let n=this.options.time,i=n.displayFormats,a=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,hw(this,[t],this._majorUnit),a),s=this._getLabelSize(o),c=Math.floor(this.isHorizontal()?this.width/s.w:this.height/s.h)-1;return c>0?c:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;let a=this.getMatchingVisibleMetas();if(this._normalized&&a.length)return this._cache.data=a[0].controller.getAllParsedValues(this);for(n=0,i=a.length;n<i;++n)t=t.concat(a[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){let t=this._cache.labels||[],n,i;if(t.length)return t;let a=this.getLabels();for(n=0,i=a.length;n<i;++n)t.push(uw(this,a[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return op(t.sort(cw))}}return r})();function Wl(r,e,t){let n=0,i=r.length-1,a,o,s,c;t?(e>=r[n].pos&&e<=r[i].pos&&({lo:n,hi:i}=br(r,"pos",e)),{pos:a,time:s}=r[n],{pos:o,time:c}=r[i]):(e>=r[n].time&&e<=r[i].time&&({lo:n,hi:i}=br(r,"time",e)),{time:a,pos:s}=r[n],{time:o,pos:c}=r[i]);let u=o-a;return u?s+(c-s)*(e-a)/u:s}var em=class extends tm{static id="timeseries";static defaults=tm.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=Wl(t,this.min),this._tableRange=Wl(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){let{min:t,max:n}=this,i=[],a=[],o,s,c,u,l;for(o=0,s=e.length;o<s;++o)u=e[o],u>=t&&u<=n&&i.push(u);if(i.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(o=0,s=i.length;o<s;++o)l=i[o+1],c=i[o-1],u=i[o],Math.round((l+c)/2)!==u&&a.push({time:u,pos:o/(s-1)});return a}_generate(){let e=this.min,t=this.max,n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(t)||n.length===1)&&n.push(t),n.sort((i,a)=>i-a)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;let t=this.getDataTimestamps(),n=this.getLabelTimestamps();return t.length&&n.length?e=this.normalize(t.concat(n)):e=t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(Wl(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){let t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return Wl(this._table,n*this._tableRange+this._minPos,!0)}},LP=Object.freeze({__proto__:null,CategoryScale:vP,LinearScale:$p,LogarithmicScale:Qp,RadialLinearScale:Zp,TimeScale:tm,TimeSeriesScale:em}),Pw=[YR,yF,fP,LP];Xl.register(...Pw);var cc=Xl;var BP=["barChart"],VP=["lineChart"],WP=["radarChart"],zP=["pieChart"],Ow=(()=>{let e=class e{constructor(n,i,a,o){this.projectService=n,this.payrollService=i,this.taskService=a,this.userService=o,this.title="ng-chart",this.chart=[],this.netSalariesByMonth=[],this.tasksNumber=0,this.employeesNumber=0}ngAfterViewInit(){this.projectService.getAllProjects().subscribe(n=>{this.projects=n,this.todo=this.projects.filter(i=>i.projectStatus==="ON_HOLD"),this.done=this.projects.filter(i=>i.projectStatus==="RUNNING"),this.finished=this.projects.filter(i=>i.projectStatus==="FINISHED"),this.numProjectsTodo=this.todo.length,this.numProjectsDone=this.done.length,this.numProjectsFinished=this.finished.length,this.creatPiechart(this.todo.length,this.done.length,this.finished.length)}),this.taskService.getAll().subscribe(n=>{this.tasksNumber=n.length}),this.userService.findAllUsers().subscribe(n=>{this.employeesNumber=n.length}),this.calculateNetSalariesForAllMonths(),new cc(this.barChartRef.nativeElement,{type:"bar",data:{labels:["Red","Blue","Yellow","Green","Purple","Orange"],datasets:[{label:"# of Votes",data:[12,19,3,5,2,3],backgroundColor:["red","blue","yellow","green","purple","orange"]}]}}),new cc(this.radarChartRef.nativeElement,{type:"radar",data:{labels:["Eating","Drinking","Sleeping","Designing","Coding","Cycling","Running"],datasets:[{label:"My Data",data:[65,59,90,81,56,55,40],fill:!0,backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)",pointBackgroundColor:"rgb(255, 99, 132)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)"}]}})}creatPiechart(n,i,a){new cc(this.pieChartRef.nativeElement,{type:"pie",data:{labels:["Todo","Done","Finished"],datasets:[{label:"# of Votes",data:[Number(n),Number(i),Number(a)],backgroundColor:["orange","red","green"]}]}})}calculateNetSalariesForAllMonths(){let n=Array.from({length:12},(a,o)=>o+1),i=[];n.forEach(a=>{i.push(this.payrollService.getPayrollsByMonth("2024-"+a.toString()))}),tg(i).pipe(Fe(a=>{this.netSalariesByMonth=a.map(o=>o.reduce((s,c)=>s+c.netSalary,0)),this.createLinechart()})).subscribe()}createLinechart(){new cc(this.lineChartRef.nativeElement,{type:"line",data:{labels:["January","February","March","April","May","June","July","August","September","October","November","December"],datasets:[{label:"Net Salaries",data:this.netSalariesByMonth,fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}})}};e.\u0275fac=function(i){return new(i||e)(rt(Kg),rt(Wc),rt(Xg),rt($g))},e.\u0275cmp=Et({type:e,selectors:[["app-dashboard"]],viewQuery:function(i,a){if(i&1&&(Pe(BP,5),Pe(VP,5),Pe(WP,5),Pe(zP,5)),i&2){let o;ke(o=De())&&(a.barChartRef=o.first),ke(o=De())&&(a.lineChartRef=o.first),ke(o=De())&&(a.radarChartRef=o.first),ke(o=De())&&(a.pieChartRef=o.first)}},decls:71,vars:2,consts:[["rel","stylesheet","type","text/css","href","https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"],["rel","stylesheet","type","text/css","href","/node_modules/primeng/resources/themes/nova-light/theme.css"],["rel","stylesheet","type","text/css","href","/node_modules/primeng/resources/primeng.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css"],["rel","stylesheet","type","text/css","href","https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap.min.css"],["href","https://fonts.googleapis.com/css?family=Montserrat&display=swap","rel","stylesheet"],[1,"pcoded-main-container"],[1,"pcoded-wrapper"],[1,"pcoded-content"],[1,"row"],[1,"col-xl-3","col-sm-6","col-12"],[1,"card"],[1,"card-content"],[1,"card-body"],[1,"media","d-flex"],[1,"align-self-center"],[1,"icon-graph","success","font-large-2","float-left"],[1,"media-body","text-right"],[1,"media-body","text-left"],[1,"danger"],[1,"icon-rocket","danger","font-large-2","float-right"],[1,"warning"],[1,"icon-pie-chart","warning","font-large-2","float-right"],[1,"icon-pencil","primary","font-large-2","float-left"],[1,"col"],["pieChart",""],["lineChart",""]],template:function(i,a){i&1&&($(0,"link",0)(1,"link",1)(2,"link",2)(3,"link",3)(4,"link",4)(5,"link",5)(6,"link",6)(7,"link",7),I(8,"div",8)(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"div",16)(17,"div",17),$(18,"i",18),T(),I(19,"div",19)(20,"h3"),H(21,"Total Tasks"),T(),I(22,"span"),H(23),T()()()()()()(),I(24,"div",12)(25,"div",13)(26,"div",14)(27,"div",15)(28,"div",16)(29,"div",20)(30,"h3",21),H(31,"Employees Number"),T(),I(32,"span"),H(33),T()(),I(34,"div",17),$(35,"i",22),T()()()()()(),I(36,"div",12)(37,"div",13)(38,"div",14)(39,"div",15)(40,"div",16)(41,"div",20)(42,"h3",23),H(43,"Total Quarter Shift"),T(),I(44,"span"),H(45,"0"),T()(),I(46,"div",17),$(47,"i",24),T()()()()()(),I(48,"div",12)(49,"div",13)(50,"div",14)(51,"div",15)(52,"div",16)(53,"div",17),$(54,"i",25),T(),I(55,"div",19)(56,"h3"),H(57,"Total Absent"),T(),I(58,"span"),H(59,"0"),T()()()()()()()()(),I(60,"div",11)(61,"div",26),$(62,"canvas",null,27),T(),I(64,"div",26),$(65,"canvas",null,28),T()(),I(67,"div",11)(68,"div",26),$(69,"canvas"),T(),$(70,"div",26),T()()()),i&2&&(q(23),oe(a.tasksNumber),q(10),oe(a.employeesNumber))}});let r=e;return r})();var Nw=(()=>{let e=class e{constructor(n){this._http=n,this.URL="http://localhost:3000/cvassistant/"}getThread(){return this._http.get(this.URL)}sendMessage(n,i){return this._http.post(this.URL+`sendMessage/${i}`,n)}};e.\u0275fac=function(i){return new(i||e)(nt(or))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function HP(r,e){if(r&1&&(I(0,"div",37),$(1,"div",38),I(2,"div",39),H(3),T()()),r&2){let t=ft().$implicit;q(3),me(" ",t," ")}}function UP(r,e){if(r&1&&(I(0,"div",40)(1,"div",38),$(2,"img",41),T(),I(3,"div",39),H(4),T()()),r&2){let t=ft().$implicit;q(4),me(" ",t," ")}}function GP(r,e){if(r&1&&(_g(0),Lt(1,HP,4,1,"div",35)(2,UP,5,1,"ng-template",null,36,Fg),wg()),r&2){let t=e.index,n=kg(3);q(),it("ngIf",t%2===0)("ngIfElse",n)}}var Lw=(()=>{let e=class e{constructor(n,i,a){this.fb=n,this.resumeAssistantService=i,this.router=a,this.thread="",this.messages=[],this.myForm=this.fb.group({msg:""})}ngOnInit(){return en(this,null,function*(){this.resumeAssistantService.getThread().subscribe({next:n=>{this.thread=n.thread},error:n=>{}})})}sendMessage(){let n={message:this.myForm.value.msg};this.messages.push(this.myForm.value.msg),this.myForm=this.fb.group({msg:""}),this.resumeAssistantService.sendMessage(n,this.thread).subscribe({next:i=>{this.messages.push(i.msg)},error:i=>{}})}};e.\u0275fac=function(i){return new(i||e)(rt(Yg),rt(Nw),rt(ln))},e.\u0275cmp=Et({type:e,selectors:[["app-welcome"]],decls:57,vars:3,consts:[[1,"message"],["id","chatWidget",1,"chat-widget"],["id","chat-widget-toggle","type","checkbox",1,"chat-widget-toggle"],["title","close chat","for","chat-widget-toggle",1,"chat-widget-button","chat-close-button"],["xmlns","http://www.w3.org/2000/svg","width","64","version","1.1","height","64","viewBox","0 0 64 64","enable-background","new 0 0 64 64"],["fill","#1D1D1B","d","M28.941,31.786L0.613,60.114c-0.787,0.787-0.787,2.062,0,2.849c0.393,0.394,0.909,0.59,1.424,0.59   c0.516,0,1.031-0.196,1.424-0.59l28.541-28.541l28.541,28.541c0.394,0.394,0.909,0.59,1.424,0.59c0.515,0,1.031-0.196,1.424-0.59   c0.787-0.787,0.787-2.062,0-2.849L35.064,31.786L63.41,3.438c0.787-0.787,0.787-2.062,0-2.849c-0.787-0.786-2.062-0.786-2.848,0   L32.003,29.15L3.441,0.59c-0.787-0.786-2.061-0.786-2.848,0c-0.787,0.787-0.787,2.062,0,2.849L28.941,31.786z"],[1,"chat-box"],[1,"chat-avatar-box"],["src","https://cdn.pixabay.com/photo/2017/08/30/17/27/business-woman-2697954_960_720.jpg",1,"chat-avatar"],[1,"chat-message-box"],[1,"chat-header"],[1,"chat-title"],[1,"chat-title-primary"],[1,"chat-title-sub"],[1,"chat-messages"],[1,"chat-messages-content"],[4,"ngFor","ngForOf"],[1,"chat-form-box"],["id","chat-form","name","chat-form",1,"chat-form",3,"formGroup","ngSubmit"],["type","text","placeholder","Type your message....","formControlName","msg",1,"chat-form-input"],["title","send message","type","submit",1,"chat-form-button",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","x","0px","y","0px","width","535.5px","height","535.5px","viewBox","0 0 535.5 535.5",2,"enable-background","new 0 0 535.5 535.5"],["points","0,497.25 535.5,267.75 0,38.25 0,216.75 382.5,267.75 0,318.75"],["title","open chat","for","chat-widget-toggle",1,"chat-widget-button","chat-open-button"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M21 2H3a2 2 0 00-2 2v12a2 2 0 002 2h4l2 3 3-3h5a2 2 0 002-2V4a2 2 0 00-2-2z"],[2,"background-color","#f8f9fa","padding","10px 20px","text-align","center"],[2,"color","#0d6efd"],[2,"list-style","none","padding","0","display","flex","justify-content","center","gap","20px"],["href","#",2,"text-decoration","none","color","#0d6efd","font-weight","bold"],[2,"padding","20px"],[2,"color","#666"],["src","assets/images/hero_1.jpg","alt","Image 1",2,"width","100%","height","auto","margin-bottom","10px"],["src","assets/images/hero_2.jpg","alt"," Image 2",2,"width","100%","height","auto","margin-bottom","10px"],[2,"background-color","#343a40","color","white","text-align","center","padding","10px"],["class","chat-message -right",4,"ngIf","ngIfElse"],["oddMessage",""],[1,"chat-message","-right"],[1,"chat-message-avatar"],[1,"chat-message-text"],[1,"chat-message","-left"],["src","https://cdn.pixabay.com/photo/2017/08/30/17/27/business-woman-2697954_960_720.jpg","alt","",1,"chat-avatar","-small"]],template:function(i,a){i&1&&($(0,"div",0),I(1,"div",1),$(2,"input",2),I(3,"label",3),Ir(),I(4,"svg",4)(5,"g"),$(6,"path",5),T()()(),Sa(),I(7,"div",6)(8,"div",7),$(9,"img",8),T(),I(10,"div",9)(11,"div",10)(12,"h1",11)(13,"span",12),H(14,"ResumeBot"),T(),I(15,"span",13),H(16,"Assistant"),T()()(),I(17,"div",14)(18,"div",15),Lt(19,GP,4,2,"ng-container",16),T()(),I(20,"div",17)(21,"form",18),mt("ngSubmit",function(){return a.sendMessage()}),$(22,"input",19),I(23,"button",20),Ir(),I(24,"svg",21),$(25,"polygon",22),T()()()()()(),Sa(),I(26,"label",23),Ir(),I(27,"svg",24),$(28,"path",25),T()()(),Sa(),I(29,"header",26)(30,"h1",27),H(31,"HR Website"),T(),I(32,"nav")(33,"ul",28)(34,"li")(35,"a",29),H(36,"Home"),T()(),I(37,"li")(38,"a",29),H(39,"About"),T()(),I(40,"li")(41,"a",29),H(42,"Services"),T()(),I(43,"li")(44,"a",29),H(45,"Contact"),T()()()()(),I(46,"main",30)(47,"section")(48,"h2",31),H(49,"Welcome to Our HR Website"),T(),I(50,"p",31),H(51,"This is the homepage of our HR website. Lorem ipsum dolor sit amet, consectetur adipiscing elit."),T(),$(52,"img",32)(53,"img",33),T()(),I(54,"footer",34)(55,"p"),H(56,"\xA9 2024 HR Website. All rights reserved."),T()()),i&2&&(q(19),it("ngForOf",a.messages),q(2),it("formGroup",a.myForm),q(2),it("disabled",a.myForm.value.msg.length===0))},dependencies:[ka,un,cr,Rn,dn,sr,oi,si],styles:['[_ngcontent-%COMP%]:root{--chat-zIndex: 1000;--chat-min-height: 220px;--chat-max-height: 440px;--chat-color-white: #fff;--chat-color-black: #222;--chat-color-primary: #06b7f1;--chat-default-shadow: 0 0 10px 5px rgba(112, 111, 102, .23)}body[_ngcontent-%COMP%]{margin:0}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(150%) scale(1.02)}75%{transform:translate(-20%) scale(.9)}to{transform:translate(0) scale(1)}}@keyframes _ngcontent-%COMP%_bounceIn{0%{opacity:0;transform:scale(.5)}75%{opacity:.8;transform:scale(1.05)}to{opacity:1;transform:scale(1)}}.chat-widget[_ngcontent-%COMP%]{position:fixed;top:-1000px;left:-1000px;box-sizing:border-box}.chat-widget[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{box-sizing:border-box;font-family:Montserrat,sans-serif;font-weight:400;font-size:14px;line-height:1.6}.chat-widget-toggle[_ngcontent-%COMP%]{position:absolute;z-index:-1;bottom:10px;right:15px}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-open-button[_ngcontent-%COMP%]{opacity:0;transform:translate(200px);transition:all .4s ease}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-box[_ngcontent-%COMP%]{opacity:1;transform:translate(0);transition:all .6s ease,opacity .2s ease-out}.chat-widget-toggle[_ngcontent-%COMP%]:checked ~ .chat-close-button[_ngcontent-%COMP%]{opacity:1;transform:scale(1);transition:all .4s ease .6s}.chat-box[_ngcontent-%COMP%]{position:fixed;z-index:var(--chat-zIndex);right:15px;bottom:15px;display:flex;flex-flow:column;width:320px;height:calc(100% - 95px);max-height:var(--chat-max-height);min-height:var(--chat-min-height);border-radius:15px;background:var(--chat-color-white);box-shadow:var(--chat-default-shadow);opacity:0;transform:translate(100%);transition:all .35s ease}.chat-avatar-box[_ngcontent-%COMP%]{position:absolute;z-index:100;top:-45px;left:50%;background:transparent;width:80px;height:80px;border-radius:50%;transform:translate(-50%)}.chat-avatar-box[_ngcontent-%COMP%]:before{content:"";position:absolute;z-index:-10;top:0;width:80px;height:40px;background:transparent;box-shadow:0 0 10px 5px #706f663b;border-top-left-radius:50px;border-top-right-radius:50px}.chat-avatar[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;object-fit:cover;object-position:center center;border:2px solid var(--chat-color-white)}.chat-avatar.-small[_ngcontent-%COMP%]{width:30px;height:30px}.chat-header[_ngcontent-%COMP%]{position:relative;z-index:100;padding-top:35px;box-shadow:0 1px 3px #0003}.chat-title[_ngcontent-%COMP%]{margin:0 0 10px;font-weight:100;text-align:center}.chat-title[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:block}.chat-title-primary[_ngcontent-%COMP%]{color:#5b5959;font-size:18px;margin-bottom:-3px}.chat-title-sub[_ngcontent-%COMP%]{color:#959595}.chat-message-box[_ngcontent-%COMP%]{display:flex;flex-flow:column;width:100%;height:100%;overflow:hidden}.chat-messages[_ngcontent-%COMP%]{flex:1 1 auto;max-height:500px;width:100%;overflow:hidden;overflow-y:auto;background-image:linear-gradient(to bottom right,#1b7b99 20%,#b5ff5f)}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#bbb}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#4c4c4c;border-radius:100px}.chat-messages-content[_ngcontent-%COMP%]{display:flex;flex-flow:column;padding:10px}.chat-message[_ngcontent-%COMP%]{display:flex;width:80%;min-height:30px;margin-bottom:10px;box-shadow:0 1px 5px #adadab33;border-radius:10px;background:#fff}.chat-message[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding:3px;font-size:14px;color:#555}.chat-message.-left[_ngcontent-%COMP%]{align-self:flex-start;border-top-left-radius:0}.chat-message.-left.-animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounceIn .6s ease-in backwards}.chat-message-avatar[_ngcontent-%COMP%]{flex:0 1 auto}.chat-message-text[_ngcontent-%COMP%]{flex:1;font-family:Roboto Slab,sans-serif}.chat-message.-right[_ngcontent-%COMP%]{align-self:flex-end;border-top-left-radius:0}.chat-message.-right.-animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideIn 1s ease 1 backwards}.chat-widget-button[_ngcontent-%COMP%]{position:fixed;z-index:var(--chat-zIndex);display:flex;align-items:center;justify-content:center;border-radius:50%;box-shadow:var(--chat-default-shadow);cursor:pointer}.chat-open-button[_ngcontent-%COMP%]{right:15px;bottom:15px;align-self:flex-end;width:65px;height:65px;background:var(--chat-color-primary);opacity:1;transform:translate(0);transition:all .3s ease .15s}.chat-open-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:25px;height:25px;fill:#fff}.chat-close-button[_ngcontent-%COMP%]{right:350px;bottom:20px;width:35px;height:35px;background:var(--chat-color-white);opacity:0;transform:scale(.5)}.chat-close-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:10px;height:10px;fill:var(--chat-color-black)}.chat-form-box[_ngcontent-%COMP%]{position:relative;z-index:100;padding:10px 0;flex:0 0 45px;box-shadow:0 -1px 3px #0000001a}.chat-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:95%;height:40px;padding:5px;overflow:hidden;margin:0 auto;border:1px solid #e1e1e1;border-radius:100px}.chat-form-input[_ngcontent-%COMP%]{width:100%;height:100%;border:none;padding-left:10px;color:#767070;font-family:inherit;font-size:14px}.chat-form-input[_ngcontent-%COMP%]::placeholder{color:#959595}.chat-form-input[_ngcontent-%COMP%]::-webkit-placeholder{color:#959595}.chat-form-input[_ngcontent-%COMP%]:focus{outline:none}.chat-form-button[_ngcontent-%COMP%]{display:flex;border:none;background:transparent;cursor:pointer}.chat-form-button[_ngcontent-%COMP%]:active, .chat-form-button[_ngcontent-%COMP%]:focus{outline:none}.chat-form-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px;fill:#06b7f1}']});let r=e;return r})();var qP=[{path:"",component:Lw},{path:"login",component:Sv},{path:"sendcode",component:y_},{path:"resetpassword",component:kv},{path:"newpassword",component:Dv},{path:"emailsended",component:Av},{path:"notfound",component:jd},{path:"home",component:Ov,canActivate:[Iv],children:[{path:"dashboard",component:Ow},{path:"profile",component:b_},{path:"users",loadChildren:()=>import("./chunk-PQWZJ4XD.js").then(r=>r.UserModule)},{path:"roles",loadChildren:()=>import("./chunk-O4FYYPH2.js").then(r=>r.RoleModule)},{path:"config",loadChildren:()=>import("./chunk-EMEA26JN.js").then(r=>r.ConfigManagementModule)},{path:"holiday",loadChildren:()=>import("./chunk-6OD2K3WY.js").then(r=>r.HolidayManagementModule)},{path:"department",loadChildren:()=>import("./chunk-2WHWL5D4.js").then(r=>r.DepartmentManagementModule)},{path:"attendance",loadChildren:()=>import("./chunk-K7UHDPKU.js").then(r=>r.AttendanceManagementModule)},{path:"tasks",loadChildren:()=>import("./chunk-ALFXUGH6.js").then(r=>r.TaskManagementModule)},{path:"projects",loadChildren:()=>import("./chunk-TMHS52XE.js").then(r=>r.ProjectManagementModule)},{path:"payroll",loadChildren:()=>import("./chunk-O5RHOH6D.js").then(r=>r.PayrollManagementModule)},{path:"allowance",loadChildren:()=>import("./chunk-4CX2PHFU.js").then(r=>r.AllowanceRoutingModule)},{path:"deduction",loadChildren:()=>import("./chunk-IPTTFFMP.js").then(r=>r.DeductionRoutingModule)}]},{path:"**",component:jd}],Bw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({imports:[Md.forRoot(qP),Md]});let r=e;return r})();var Vw=(()=>{let e=class e{ngOnInit(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Et({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,a){i&1&&$(0,"router-outlet")},dependencies:[Vc]});let r=e;return r})();var YP="@",KP=(()=>{let e=class e{constructor(n,i,a,o,s){this.doc=n,this.delegate=i,this.zone=a,this.animationType=o,this.moduleImpl=s,this._rendererFactoryPromise=null,this.scheduler=xe(Ic,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-2HIFKB67.js")).catch(i=>{throw new Ec(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:a})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let o=new a(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(n,i){let a=this.delegate.createRenderer(n,i);if(a.\u0275type===0)return a;typeof a.throwOnSyntheticProps=="boolean"&&(a.throwOnSyntheticProps=!1);let o=new im(a);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let c=s.createRenderer(n,i);o.use(c)}).catch(s=>{o.use(a)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(i){Ac()},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),im=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,n,i){this.delegate.insertBefore(e,t,n,i)}removeChild(e,t,n){this.delegate.removeChild(e,t,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,i){this.delegate.setAttribute(e,t,n,i)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,i){this.delegate.setStyle(e,t,n,i)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){this.shouldReplay(t)&&this.replay.push(i=>i.setProperty(e,t,n)),this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.shouldReplay(t)&&this.replay.push(i=>i.listen(e,t,n)),this.delegate.listen(e,t,n)}shouldReplay(e){return this.replay!==null&&e.startsWith(YP)}};function Ww(r="animations"){return Cd("NgAsyncAnimations"),Ea([{provide:Mc,useFactory:(e,t,n)=>new KP(e,t,n,r),deps:[Go,Lc,ir]},{provide:zo,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var zw=(()=>{let e=class e{constructor(n){this.platformId=n}intercept(n,i){if(Lg(this.platformId)){let a=localStorage.getItem("token");if(a){let o=n.clone({setHeaders:{Authorization:`Bearer ${a}`}});return i.handle(o).pipe(wa(s=>Jm(s)))}}return i.handle(n)}};e.\u0275fac=function(i){return new(i||e)(nt(pg))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})();var QP=["mat-calendar-body",""];function JP(r,e){if(r&1&&(I(0,"tr",0)(1,"td",2),H(2),T()()),r&2){let t=ft();q(),ar("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),zn("colspan",t.numCols),q(),me(" ",t.label," ")}}function ZP(r,e){if(r&1&&(I(0,"td",2),H(1),T()),r&2){let t=ft(2);ar("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),zn("colspan",t._firstRowOffset),q(),me(" ",t._firstRowOffset>=t.labelMinRequiredCells?t.label:""," ")}}function tO(r,e){if(r&1){let t=_n();I(0,"td",5)(1,"button",6),mt("click",function(i){let o=ie(t).$implicit,s=ft(2);return ae(s._cellClicked(o,i))})("focus",function(i){let o=ie(t).$implicit,s=ft(2);return ae(s._emitActiveDateChange(o,i))}),I(2,"span",7),H(3),T(),$(4,"span",8),T()()}if(r&2){let t=e.$implicit,n=e.$index,i=ft().$index,a=ft();ar("width",a._cellWidth)("padding-top",a._cellPadding)("padding-bottom",a._cellPadding),zn("data-mat-row",i)("data-mat-col",n),q(),ni("mat-calendar-body-disabled",!t.enabled)("mat-calendar-body-active",a._isActiveCell(i,n))("mat-calendar-body-range-start",a._isRangeStart(t.compareValue))("mat-calendar-body-range-end",a._isRangeEnd(t.compareValue))("mat-calendar-body-in-range",a._isInRange(t.compareValue))("mat-calendar-body-comparison-bridge-start",a._isComparisonBridgeStart(t.compareValue,i,n))("mat-calendar-body-comparison-bridge-end",a._isComparisonBridgeEnd(t.compareValue,i,n))("mat-calendar-body-comparison-start",a._isComparisonStart(t.compareValue))("mat-calendar-body-comparison-end",a._isComparisonEnd(t.compareValue))("mat-calendar-body-in-comparison-range",a._isInComparisonRange(t.compareValue))("mat-calendar-body-preview-start",a._isPreviewStart(t.compareValue))("mat-calendar-body-preview-end",a._isPreviewEnd(t.compareValue))("mat-calendar-body-in-preview",a._isInPreview(t.compareValue)),it("ngClass",t.cssClasses)("tabindex",a._isActiveCell(i,n)?0:-1),zn("aria-label",t.ariaLabel)("aria-disabled",!t.enabled||null)("aria-pressed",a._isSelected(t.compareValue))("aria-current",a.todayValue===t.compareValue?"date":null)("aria-describedby",a._getDescribedby(t.compareValue)),q(),ni("mat-calendar-body-selected",a._isSelected(t.compareValue))("mat-calendar-body-comparison-identical",a._isComparisonIdentical(t.compareValue))("mat-calendar-body-today",a.todayValue===t.compareValue),q(),me(" ",t.displayValue," ")}}function eO(r,e){if(r&1&&(I(0,"tr",3),Lt(1,ZP,2,6,"td",4),Fc(2,tO,5,48,"td",9,Tc),T()),r&2){let t=e.$implicit,n=e.$index,i=ft();q(),Uo(1,n===0&&i._firstRowOffset?1:-1),q(),Pc(t)}}function nO(r,e){if(r&1&&(I(0,"th",5)(1,"span",6),H(2),T(),I(3,"span",2),H(4),T()()),r&2){let t=e.$implicit;q(2),oe(t.long),q(2),oe(t.narrow)}}var rO=["*"];function iO(r,e){}function aO(r,e){if(r&1){let t=_n();I(0,"mat-month-view",2),Mn("activeDateChange",function(i){ie(t);let a=ft();return In(a.activeDate,i)||(a.activeDate=i),ae(i)}),mt("_userSelection",function(i){ie(t);let a=ft();return ae(a._dateSelected(i))})("dragStarted",function(i){ie(t);let a=ft();return ae(a._dragStarted(i))})("dragEnded",function(i){ie(t);let a=ft();return ae(a._dragEnded(i))}),T()}if(r&2){let t=ft();An("activeDate",t.activeDate),it("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)("startDateAccessibleName",t.startDateAccessibleName)("endDateAccessibleName",t.endDateAccessibleName)("activeDrag",t._activeDrag)}}function oO(r,e){if(r&1){let t=_n();I(0,"mat-year-view",3),Mn("activeDateChange",function(i){ie(t);let a=ft();return In(a.activeDate,i)||(a.activeDate=i),ae(i)}),mt("monthSelected",function(i){ie(t);let a=ft();return ae(a._monthSelectedInYearView(i))})("selectedChange",function(i){ie(t);let a=ft();return ae(a._goToDateInView(i,"month"))}),T()}if(r&2){let t=ft();An("activeDate",t.activeDate),it("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)}}function sO(r,e){if(r&1){let t=_n();I(0,"mat-multi-year-view",4),Mn("activeDateChange",function(i){ie(t);let a=ft();return In(a.activeDate,i)||(a.activeDate=i),ae(i)}),mt("yearSelected",function(i){ie(t);let a=ft();return ae(a._yearSelectedInMultiYearView(i))})("selectedChange",function(i){ie(t);let a=ft();return ae(a._goToDateInView(i,"year"))}),T()}if(r&2){let t=ft();An("activeDate",t.activeDate),it("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)}}function cO(r,e){}var uO=["button"];function lO(r,e){r&1&&(Ir(),I(0,"svg",3),$(1,"path",4),T())}var dO=[[["","matDatepickerToggleIcon",""]]],hO=["[matDatepickerToggleIcon]"];var dc=(()=>{let e=class e{constructor(){this.changes=new Wn,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(n,i){return`${n} \u2013 ${i}`}formatYearRangeLabel(n,i){return`${n} to ${i}`}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),lc=class{constructor(e,t,n,i,a={},o=e,s){this.value=e,this.displayValue=t,this.ariaLabel=n,this.enabled=i,this.cssClasses=a,this.compareValue=o,this.rawValue=s}},fO=1,jw=zc({passive:!1,capture:!0}),Ti=zc({passive:!0,capture:!0}),Jl=zc({passive:!0}),No=(()=>{let e=class e{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(n,i){this._elementRef=n,this._ngZone=i,this._platform=xe(Qg),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new re,this.previewChange=new re,this.activeDateChange=new re,this.dragStarted=new re,this.dragEnded=new re,this._didDragSinceMouseDown=!1,this._enterHandler=a=>{if(this._skipNextFocus&&a.type==="focus"){this._skipNextFocus=!1;return}if(a.target&&this.isRange){let o=this._getCellFromElement(a.target);o&&this._ngZone.run(()=>this.previewChange.emit({value:o.enabled?o:null,event:a}))}},this._touchmoveHandler=a=>{if(!this.isRange)return;let o=Hw(a),s=o?this._getCellFromElement(o):null;o!==a.target&&(this._didDragSinceMouseDown=!0),om(a.target)&&a.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:s?.enabled?s:null,event:a}))},this._leaveHandler=a=>{this.previewEnd!==null&&this.isRange&&(a.type!=="blur"&&(this._didDragSinceMouseDown=!0),a.target&&this._getCellFromElement(a.target)&&!(a.relatedTarget&&this._getCellFromElement(a.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:a})))},this._mousedownHandler=a=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let o=a.target&&this._getCellFromElement(a.target);!o||!this._isInRange(o.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:o.rawValue,event:a})})},this._mouseupHandler=a=>{if(!this.isRange)return;let o=om(a.target);if(!o){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:a})});return}o.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let s=this._getCellFromElement(o);this.dragEnded.emit({value:s?.rawValue??null,event:a})})},this._touchendHandler=a=>{let o=Hw(a);o&&this._mouseupHandler({target:o})},this._id=`mat-calendar-body-${fO++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,i.runOutsideAngular(()=>{let a=n.nativeElement;a.addEventListener("touchmove",this._touchmoveHandler,jw),a.addEventListener("mouseenter",this._enterHandler,Ti),a.addEventListener("focus",this._enterHandler,Ti),a.addEventListener("mouseleave",this._leaveHandler,Ti),a.addEventListener("blur",this._leaveHandler,Ti),a.addEventListener("mousedown",this._mousedownHandler,Jl),a.addEventListener("touchstart",this._mousedownHandler,Jl),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(n,i){this._didDragSinceMouseDown||n.enabled&&this.selectedValueChange.emit({value:n.value,event:i})}_emitActiveDateChange(n,i){n.enabled&&this.activeDateChange.emit({value:n.value,event:i})}_isSelected(n){return this.startValue===n||this.endValue===n}ngOnChanges(n){let i=n.numCols,{rows:a,numCols:o}=this;(n.rows||i)&&(this._firstRowOffset=a&&a.length&&a[0].length?o-a[0].length:0),(n.cellAspectRatio||i||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/o}%`),(i||!this._cellWidth)&&(this._cellWidth=`${100/o}%`)}ngOnDestroy(){let n=this._elementRef.nativeElement;n.removeEventListener("touchmove",this._touchmoveHandler,jw),n.removeEventListener("mouseenter",this._enterHandler,Ti),n.removeEventListener("focus",this._enterHandler,Ti),n.removeEventListener("mouseleave",this._leaveHandler,Ti),n.removeEventListener("blur",this._leaveHandler,Ti),n.removeEventListener("mousedown",this._mousedownHandler,Jl),n.removeEventListener("touchstart",this._mousedownHandler,Jl),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(n,i){let a=n*this.numCols+i;return n&&(a-=this._firstRowOffset),a==this.activeCell}_focusActiveCell(n=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Ca(1)).subscribe(()=>{setTimeout(()=>{let i=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");i&&(n||(this._skipNextFocus=!0),i.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(n){return sm(n,this.startValue,this.endValue)}_isRangeEnd(n){return cm(n,this.startValue,this.endValue)}_isInRange(n){return um(n,this.startValue,this.endValue,this.isRange)}_isComparisonStart(n){return sm(n,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(n,i,a){if(!this._isComparisonStart(n)||this._isRangeStart(n)||!this._isInRange(n))return!1;let o=this.rows[i][a-1];if(!o){let s=this.rows[i-1];o=s&&s[s.length-1]}return o&&!this._isRangeEnd(o.compareValue)}_isComparisonBridgeEnd(n,i,a){if(!this._isComparisonEnd(n)||this._isRangeEnd(n)||!this._isInRange(n))return!1;let o=this.rows[i][a+1];if(!o){let s=this.rows[i+1];o=s&&s[0]}return o&&!this._isRangeStart(o.compareValue)}_isComparisonEnd(n){return cm(n,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(n){return um(n,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(n){return this.comparisonStart===this.comparisonEnd&&n===this.comparisonStart}_isPreviewStart(n){return sm(n,this.previewStart,this.previewEnd)}_isPreviewEnd(n){return cm(n,this.previewStart,this.previewEnd)}_isInPreview(n){return um(n,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(n){return this.isRange?this.startValue===n&&this.endValue===n?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===n?this._startDateLabelId:this.endValue===n?this._endDateLabelId:null:null}_getCellFromElement(n){let i=om(n);if(i){let a=i.getAttribute("data-mat-row"),o=i.getAttribute("data-mat-col");if(a&&o)return this.rows[parseInt(a)][parseInt(o)]}return null}};e.\u0275fac=function(i){return new(i||e)(rt(xd),rt(ir))},e.\u0275cmp=Et({type:e,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[jo,Mr],attrs:QP,decls:7,vars:5,consts:[["aria-hidden","true"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"]],template:function(i,a){i&1&&(Lt(0,JP,3,6,"tr",0),Fc(1,eO,4,1,"tr",3,Tc),I(3,"label",1),H(4),T(),I(5,"label",1),H(6),T()),i&2&&(Uo(0,a._firstRowOffset<a.labelMinRequiredCells?0:-1),q(),Pc(a.rows),q(2),it("id",a._startDateLabelId),q(),me(" ",a.startDateAccessibleName,`
`),q(),it("id",a._endDateLabelId),q(),me(" ",a.endDateAccessibleName,`
`))},dependencies:[Oc],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let r=e;return r})();function am(r){return r?.nodeName==="TD"}function om(r){let e;return am(r)?e=r:am(r.parentNode)?e=r.parentNode:am(r.parentNode?.parentNode)&&(e=r.parentNode.parentNode),e?.getAttribute("data-mat-row")!=null?e:null}function sm(r,e,t){return t!==null&&e!==t&&r<t&&r===e}function cm(r,e,t){return e!==null&&e!==t&&r>=e&&r===t}function um(r,e,t,n){return n&&e!==null&&t!==null&&e!==t&&r>=e&&r<=t}function Hw(r){let e=r.changedTouches[0];return document.elementFromPoint(e.clientX,e.clientY)}var Vn=class{constructor(e,t){this.start=e,this.end=t}},Zl=(()=>{let e=class e{constructor(n,i){this.selection=n,this._adapter=i,this._selectionChanged=new Wn,this.selectionChanged=this._selectionChanged,this.selection=n}updateSelection(n,i){let a=this.selection;this.selection=n,this._selectionChanged.next({selection:n,source:i,oldValue:a})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(n){return this._adapter.isDateInstance(n)&&this._adapter.isValid(n)}};e.\u0275fac=function(i){Ac()},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),pO=(()=>{let e=class e extends Zl{constructor(n){super(null,n)}add(n){super.updateSelection(n,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let n=new e(this._adapter);return n.updateSelection(this.selection,this),n}};e.\u0275fac=function(i){return new(i||e)(nt(ur))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})();function mO(r,e){return r||new pO(e)}var gO={provide:Zl,deps:[[new gg,new vg,Zl],ur],useFactory:mO};var Kw=new pt("MAT_DATE_RANGE_SELECTION_STRATEGY");var lm=7,Uw=(()=>{let e=class e{get activeDate(){return this._activeDate}set activeDate(n){let i=this._activeDate,a=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(a,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof Vn?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,i,a,o,s){this._changeDetectorRef=n,this._dateFormats=i,this._dateAdapter=a,this._dir=o,this._rangeStrategy=s,this._rerenderSubscription=xa.EMPTY,this.activeDrag=null,this.selectedChange=new re,this._userSelection=new re,this.dragStarted=new re,this.dragEnded=new re,this.activeDateChange=new re,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(wc(null)).subscribe(()=>this._init())}ngOnChanges(n){let i=n.comparisonStart||n.comparisonEnd;i&&!i.firstChange&&this._setRanges(this.selected),n.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(n){let i=n.value,a=this._getDateFromDayOfMonth(i),o,s;this._selected instanceof Vn?(o=this._getDateInCurrentMonth(this._selected.start),s=this._getDateInCurrentMonth(this._selected.end)):o=s=this._getDateInCurrentMonth(this._selected),(o!==i||s!==i)&&this.selectedChange.emit(a),this._userSelection.emit({value:a,event:n.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(n){let i=n.value,a=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(i),this._dateAdapter.compareDate(a,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(n){let i=this._activeDate,a=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,a?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,a?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=n.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&n.preventDefault();return;case 27:this._previewEnd!=null&&!Jg(n)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:n}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:n})),n.preventDefault(),n.stopPropagation());return;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let n=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(lm+this._dateAdapter.getDayOfWeek(n)-this._dateAdapter.getFirstDayOfWeek())%lm,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(n){this._matCalendarBody._focusActiveCell(n)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:n,value:i}){if(this._rangeStrategy){let a=i?i.rawValue:null,o=this._rangeStrategy.createPreview(a,this.selected,n);if(this._previewStart=this._getCellCompareValue(o.start),this._previewEnd=this._getCellCompareValue(o.end),this.activeDrag&&a){let s=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,a,n);s&&(this._previewStart=this._getCellCompareValue(s.start),this._previewEnd=this._getCellCompareValue(s.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(n){if(this.activeDrag)if(n.value){let i=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,n.value,n.event);this.dragEnded.emit({value:i??null,event:n.event})}else this.dragEnded.emit({value:null,event:n.event})}_getDateFromDayOfMonth(n){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),n)}_initWeekdays(){let n=this._dateAdapter.getFirstDayOfWeek(),i=this._dateAdapter.getDayOfWeekNames("narrow"),o=this._dateAdapter.getDayOfWeekNames("long").map((s,c)=>({long:s,narrow:i[c]}));this._weekdays=o.slice(n).concat(o.slice(0,n))}_createWeekCells(){let n=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this._weeks=[[]];for(let a=0,o=this._firstWeekOffset;a<n;a++,o++){o==lm&&(this._weeks.push([]),o=0);let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),a+1),c=this._shouldEnableDate(s),u=this._dateAdapter.format(s,this._dateFormats.display.dateA11yLabel),l=this.dateClass?this.dateClass(s,"month"):void 0;this._weeks[this._weeks.length-1].push(new lc(a+1,i[a],u,c,l,this._getCellCompareValue(s),s))}}_shouldEnableDate(n){return!!n&&(!this.minDate||this._dateAdapter.compareDate(n,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(n,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(n))}_getDateInCurrentMonth(n){return n&&this._hasSameMonthAndYear(n,this.activeDate)?this._dateAdapter.getDate(n):null}_hasSameMonthAndYear(n,i){return!!(n&&i&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(i)&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(i))}_getCellCompareValue(n){if(n){let i=this._dateAdapter.getYear(n),a=this._dateAdapter.getMonth(n),o=this._dateAdapter.getDate(n);return new Date(i,a,o).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(n){n instanceof Vn?(this._rangeStart=this._getCellCompareValue(n.start),this._rangeEnd=this._getCellCompareValue(n.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(n),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(n){return!this.dateFilter||this.dateFilter(n)}_clearPreview(){this._previewStart=this._previewEnd=null}};e.\u0275fac=function(i){return new(i||e)(rt(rr),rt(qo,8),rt(ur,8),rt(jc,8),rt(Kw,8))},e.\u0275cmp=Et({type:e,selectors:[["mat-month-view"]],viewQuery:function(i,a){if(i&1&&Pe(No,5),i&2){let o;ke(o=De())&&(a._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[jo,Mr],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"]],template:function(i,a){i&1&&(I(0,"table",0)(1,"thead",1)(2,"tr"),Fc(3,nO,5,2,"th",5,Tc),T(),I(5,"tr",2),$(6,"th",3),T()(),I(7,"tbody",4),mt("selectedValueChange",function(s){return a._dateSelected(s)})("activeDateChange",function(s){return a._updateActiveDate(s)})("previewChange",function(s){return a._previewChanged(s)})("dragStarted",function(s){return a.dragStarted.emit(s)})("dragEnded",function(s){return a._dragEnded(s)})("keyup",function(s){return a._handleCalendarBodyKeyup(s)})("keydown",function(s){return a._handleCalendarBodyKeydown(s)}),T()()),i&2&&(q(3),Pc(a._weekdays),q(4),it("label",a._monthLabel)("rows",a._weeks)("todayValue",a._todayDate)("startValue",a._rangeStart)("endValue",a._rangeEnd)("comparisonStart",a._comparisonRangeStart)("comparisonEnd",a._comparisonRangeEnd)("previewStart",a._previewStart)("previewEnd",a._previewEnd)("isRange",a._isRange)("labelMinRequiredCells",3)("activeCell",a._dateAdapter.getDate(a.activeDate)-1)("startDateAccessibleName",a.startDateAccessibleName)("endDateAccessibleName",a.endDateAccessibleName))},dependencies:[No],encapsulation:2,changeDetection:0});let r=e;return r})(),Dn=24,dm=4,Gw=(()=>{let e=class e{get activeDate(){return this._activeDate}set activeDate(n){let i=this._activeDate,a=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(a,this.minDate,this.maxDate),Xw(this._dateAdapter,i,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(n){n instanceof Vn?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedYear(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,i,a){this._changeDetectorRef=n,this._dateAdapter=i,this._dir=a,this._rerenderSubscription=xa.EMPTY,this.selectedChange=new re,this.yearSelected=new re,this.activeDateChange=new re,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(wc(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let i=this._dateAdapter.getYear(this._activeDate)-uc(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let a=0,o=[];a<Dn;a++)o.push(i+a),o.length==dm&&(this._years.push(o.map(s=>this._createCellForYear(s))),o=[]);this._changeDetectorRef.markForCheck()}_yearSelected(n){let i=n.value,a=this._dateAdapter.createDate(i,0,1),o=this._getDateFromYear(i);this.yearSelected.emit(a),this.selectedChange.emit(o)}_updateActiveDate(n){let i=n.value,a=this._activeDate;this.activeDate=this._getDateFromYear(i),this._dateAdapter.compareDate(a,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let i=this._activeDate,a=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,a?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,a?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-dm);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,dm);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-uc(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,Dn-uc(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-Dn*10:-Dn);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?Dn*10:Dn);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_getActiveCell(){return uc(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(n){let i=this._dateAdapter.getMonth(this.activeDate),a=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(n,i,1));return this._dateAdapter.createDate(n,i,Math.min(this._dateAdapter.getDate(this.activeDate),a))}_createCellForYear(n){let i=this._dateAdapter.createDate(n,0,1),a=this._dateAdapter.getYearName(i),o=this.dateClass?this.dateClass(i,"multi-year"):void 0;return new lc(n,a,a,this._shouldEnableYear(n),o)}_shouldEnableYear(n){if(n==null||this.maxDate&&n>this._dateAdapter.getYear(this.maxDate)||this.minDate&&n<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let i=this._dateAdapter.createDate(n,0,1);for(let a=i;this._dateAdapter.getYear(a)==n;a=this._dateAdapter.addCalendarDays(a,1))if(this.dateFilter(a))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(n){if(this._selectedYear=null,n instanceof Vn){let i=n.start||n.end;i&&(this._selectedYear=this._dateAdapter.getYear(i))}else n&&(this._selectedYear=this._dateAdapter.getYear(n))}};e.\u0275fac=function(i){return new(i||e)(rt(rr),rt(ur,8),rt(jc,8))},e.\u0275cmp=Et({type:e,selectors:[["mat-multi-year-view"]],viewQuery:function(i,a){if(i&1&&Pe(No,5),i&2){let o;ke(o=De())&&(a._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Mr],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(i,a){i&1&&(I(0,"table",0)(1,"thead",1)(2,"tr"),$(3,"th",2),T()(),I(4,"tbody",3),mt("selectedValueChange",function(s){return a._yearSelected(s)})("activeDateChange",function(s){return a._updateActiveDate(s)})("keyup",function(s){return a._handleCalendarBodyKeyup(s)})("keydown",function(s){return a._handleCalendarBodyKeydown(s)}),T()()),i&2&&(q(4),it("rows",a._years)("todayValue",a._todayYear)("startValue",a._selectedYear)("endValue",a._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",a._getActiveCell()))},dependencies:[No],encapsulation:2,changeDetection:0});let r=e;return r})();function Xw(r,e,t,n,i){let a=r.getYear(e),o=r.getYear(t),s=$w(r,n,i);return Math.floor((a-s)/Dn)===Math.floor((o-s)/Dn)}function uc(r,e,t,n){let i=r.getYear(e);return vO(i-$w(r,t,n),Dn)}function $w(r,e,t){let n=0;return t?n=r.getYear(t)-Dn+1:e&&(n=r.getYear(e)),n}function vO(r,e){return(r%e+e)%e}var qw=(()=>{let e=class e{get activeDate(){return this._activeDate}set activeDate(n){let i=this._activeDate,a=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(a,this.minDate,this.maxDate),this._dateAdapter.getYear(i)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(n){n instanceof Vn?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n)),this._setSelectedMonth(n)}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}constructor(n,i,a,o){this._changeDetectorRef=n,this._dateFormats=i,this._dateAdapter=a,this._dir=o,this._rerenderSubscription=xa.EMPTY,this.selectedChange=new re,this.monthSelected=new re,this.activeDateChange=new re,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(wc(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(n){let i=n.value,a=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),i,1);this.monthSelected.emit(a);let o=this._getDateFromMonth(i);this.selectedChange.emit(o)}_updateActiveDate(n){let i=n.value,a=this._activeDate;this.activeDate=this._getDateFromMonth(i),this._dateAdapter.compareDate(a,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(n){let i=this._activeDate,a=this._isRtl();switch(n.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,a?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,a?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),n.preventDefault()}_handleCalendarBodyKeyup(n){(n.keyCode===32||n.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:n}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let n=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(i=>i.map(a=>this._createCellForMonth(a,n[a]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(n){return n&&this._dateAdapter.getYear(n)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(n):null}_getDateFromMonth(n){let i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),a=this._dateAdapter.getNumDaysInMonth(i);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,Math.min(this._dateAdapter.getDate(this.activeDate),a))}_createCellForMonth(n,i){let a=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),n,1),o=this._dateAdapter.format(a,this._dateFormats.display.monthYearA11yLabel),s=this.dateClass?this.dateClass(a,"year"):void 0;return new lc(n,i.toLocaleUpperCase(),o,this._shouldEnableMonth(n),s)}_shouldEnableMonth(n){let i=this._dateAdapter.getYear(this.activeDate);if(n==null||this._isYearAndMonthAfterMaxDate(i,n)||this._isYearAndMonthBeforeMinDate(i,n))return!1;if(!this.dateFilter)return!0;let a=this._dateAdapter.createDate(i,n,1);for(let o=a;this._dateAdapter.getMonth(o)==n;o=this._dateAdapter.addCalendarDays(o,1))if(this.dateFilter(o))return!0;return!1}_isYearAndMonthAfterMaxDate(n,i){if(this.maxDate){let a=this._dateAdapter.getYear(this.maxDate),o=this._dateAdapter.getMonth(this.maxDate);return n>a||n===a&&i>o}return!1}_isYearAndMonthBeforeMinDate(n,i){if(this.minDate){let a=this._dateAdapter.getYear(this.minDate),o=this._dateAdapter.getMonth(this.minDate);return n<a||n===a&&i<o}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(n){n instanceof Vn?this._selectedMonth=this._getMonthInCurrentYear(n.start)||this._getMonthInCurrentYear(n.end):this._selectedMonth=this._getMonthInCurrentYear(n)}};e.\u0275fac=function(i){return new(i||e)(rt(rr),rt(qo,8),rt(ur,8),rt(jc,8))},e.\u0275cmp=Et({type:e,selectors:[["mat-year-view"]],viewQuery:function(i,a){if(i&1&&Pe(No,5),i&2){let o;ke(o=De())&&(a._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Mr],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(i,a){i&1&&(I(0,"table",0)(1,"thead",1)(2,"tr"),$(3,"th",2),T()(),I(4,"tbody",3),mt("selectedValueChange",function(s){return a._monthSelected(s)})("activeDateChange",function(s){return a._updateActiveDate(s)})("keyup",function(s){return a._handleCalendarBodyKeyup(s)})("keydown",function(s){return a._handleCalendarBodyKeydown(s)}),T()()),i&2&&(q(4),it("label",a._yearLabel)("rows",a._months)("todayValue",a._todayMonth)("startValue",a._selectedMonth)("endValue",a._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",a._dateAdapter.getMonth(a.activeDate)))},dependencies:[No],encapsulation:2,changeDetection:0});let r=e;return r})(),bO=1,Qw=(()=>{let e=class e{constructor(n,i,a,o,s){this._intl=n,this.calendar=i,this._dateAdapter=a,this._dateFormats=o,this._id=`mat-calendar-header-${bO++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>s.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-Dn)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:Dn)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(n,i){return this.calendar.currentView=="month"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(n)==this._dateAdapter.getMonth(i):this.calendar.currentView=="year"?this._dateAdapter.getYear(n)==this._dateAdapter.getYear(i):Xw(this._dateAdapter,n,i,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let i=this._dateAdapter.getYear(this.calendar.activeDate)-uc(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),a=i+Dn-1,o=this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1)),s=this._dateAdapter.getYearName(this._dateAdapter.createDate(a,0,1));return[o,s]}};e.\u0275fac=function(i){return new(i||e)(rt(dc),rt(mg(()=>hm)),rt(ur,8),rt(qo,8),rt(rr))},e.\u0275cmp=Et({type:e,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Mr],ngContentSelectors:rO,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"]],template:function(i,a){i&1&&(Dd(),I(0,"div",0)(1,"div",1)(2,"label",2),H(3),T(),I(4,"button",3),mt("click",function(){return a.currentPeriodClicked()}),I(5,"span",4),H(6),T(),Ir(),I(7,"svg",5),$(8,"polygon",6),T()(),Sa(),$(9,"div",7),Ad(10),I(11,"button",8),mt("click",function(){return a.previousClicked()}),T(),I(12,"button",9),mt("click",function(){return a.nextClicked()}),T()()()),i&2&&(q(2),it("id",a._periodButtonLabelId),q(),oe(a.periodButtonDescription),q(),zn("aria-label",a.periodButtonLabel)("aria-describedby",a._periodButtonLabelId),q(2),oe(a.periodButtonText),q(),ni("mat-calendar-invert",a.calendar.currentView!=="month"),q(4),it("disabled",!a.previousEnabled()),zn("aria-label",a.prevButtonLabel),q(),it("disabled",!a.nextEnabled()),zn("aria-label",a.nextButtonLabel))},dependencies:[Rd,Td],encapsulation:2,changeDetection:0});let r=e;return r})(),hm=(()=>{let e=class e{get startAt(){return this._startAt}set startAt(n){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get selected(){return this._selected}set selected(n){n instanceof Vn?this._selected=n:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get minDate(){return this._minDate}set minDate(n){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get maxDate(){return this._maxDate}set maxDate(n){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(n))}get activeDate(){return this._clampedActiveDate}set activeDate(n){this._clampedActiveDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(n){let i=this._currentView!==n?n:null;this._currentView=n,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),i&&this.viewChanged.emit(i)}constructor(n,i,a,o){this._dateAdapter=i,this._dateFormats=a,this._changeDetectorRef=o,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new re,this.yearSelected=new re,this.monthSelected=new re,this.viewChanged=new re(!0),this._userSelection=new re,this._userDragDrop=new re,this._activeDrag=null,this.stateChanges=new Wn,this._intlChanges=n.changes.subscribe(()=>{o.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new av(this.headerComponent||Qw),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(n){let i=n.minDate&&!this._dateAdapter.sameDate(n.minDate.previousValue,n.minDate.currentValue)?n.minDate:void 0,a=n.maxDate&&!this._dateAdapter.sameDate(n.maxDate.previousValue,n.maxDate.currentValue)?n.maxDate:void 0,o=i||a||n.dateFilter;if(o&&!o.firstChange){let s=this._getCurrentViewComponent();s&&(this._changeDetectorRef.detectChanges(),s._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(n){let i=n.value;(this.selected instanceof Vn||i&&!this._dateAdapter.sameDate(i,this.selected))&&this.selectedChange.emit(i),this._userSelection.emit(n)}_yearSelectedInMultiYearView(n){this.yearSelected.emit(n)}_monthSelectedInYearView(n){this.monthSelected.emit(n)}_goToDateInView(n,i){this.activeDate=n,this.currentView=i}_dragStarted(n){this._activeDrag=n}_dragEnded(n){this._activeDrag&&(n.value&&this._userDragDrop.emit(n),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};e.\u0275fac=function(i){return new(i||e)(rt(dc),rt(ur,8),rt(qo,8),rt(rr))},e.\u0275cmp=Et({type:e,selectors:[["mat-calendar"]],viewQuery:function(i,a){if(i&1&&(Pe(Uw,5),Pe(qw,5),Pe(Gw,5)),i&2){let o;ke(o=De())&&(a.monthView=o.first),ke(o=De())&&(a.yearView=o.first),ke(o=De())&&(a.multiYearView=o.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[Ag([gO]),jo,Mr],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(i,a){if(i&1&&(Lt(0,iO,0,0,"ng-template",0),I(1,"div",1),Lt(2,aO,1,11)(3,oO,1,6)(4,sO,1,6),T()),i&2){let o;it("cdkPortalOutlet",a._calendarHeaderPortal),q(2),Uo(2,(o=a.currentView)==="month"?2:o==="year"?3:o==="multi-year"?4:-1)}},dependencies:[Fd,tv,Uw,qw,Gw],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let r=e;return r})(),Yw={transformPanel:Od("transformPanel",[Ko("void => enter-dropdown",Yo("120ms cubic-bezier(0, 0, 0.2, 1)",Ld([ui({opacity:0,transform:"scale(1, 0.8)"}),ui({opacity:1,transform:"scale(1, 1)"})]))),Ko("void => enter-dialog",Yo("150ms cubic-bezier(0, 0, 0.2, 1)",Ld([ui({opacity:0,transform:"scale(0.7)"}),ui({transform:"none",opacity:1})]))),Ko("* => void",Yo("100ms linear",ui({opacity:0})))]),fadeInCalendar:Od("fadeInCalendar",[Nd("void",ui({opacity:0})),Nd("enter",ui({opacity:1})),Ko("void => *",Yo("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var yO=new pt("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let r=xe(Pd);return()=>r.scrollStrategies.reposition()}});function xO(r){return()=>r.scrollStrategies.reposition()}var _O={provide:yO,deps:[Pd],useFactory:xO},wO=(()=>{let e=class e{constructor(n,i,a,o,s,c){this._elementRef=n,this._changeDetectorRef=i,this._globalModel=a,this._dateAdapter=o,this._rangeSelectionStrategy=s,this._subscriptions=new xa,this._animationDone=new Wn,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=c.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(n){let i=this._model.selection,a=n.value,o=i instanceof Vn;if(o&&this._rangeSelectionStrategy){let s=this._rangeSelectionStrategy.selectionFinished(a,i,n.event);this._model.updateSelection(s,this)}else a&&(o||!this._dateAdapter.sameDate(a,i))&&this._model.add(a);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(n){this._model.updateSelection(n.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(n){this._isAnimating=n.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(n,i){this._model=n?this._globalModel.clone():this._globalModel,this._actionsPortal=n,i&&this._changeDetectorRef.detectChanges()}};e.\u0275fac=function(i){return new(i||e)(rt(xd),rt(rr),rt(Zl),rt(ur),rt(Kw,8),rt(dc))},e.\u0275cmp=Et({type:e,selectors:[["mat-datepicker-content"]],viewQuery:function(i,a){if(i&1&&Pe(hm,5),i&2){let o;ke(o=De())&&(a._calendar=o.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(i,a){i&1&&Sg("@transformPanel.start",function(s){return a._handleAnimationEvent(s)})("@transformPanel.done",function(s){return a._handleAnimationEvent(s)}),i&2&&(Cg("@transformPanel",a._animationState),kd(a.color?"mat-"+a.color:""),ni("mat-datepicker-content-touch",a.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Mr],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(i,a){if(i&1&&(I(0,"div",0)(1,"mat-calendar",1),mt("yearSelected",function(s){return a.datepicker._selectYear(s)})("monthSelected",function(s){return a.datepicker._selectMonth(s)})("viewChanged",function(s){return a.datepicker._viewChanged(s)})("_userSelection",function(s){return a._handleUserSelection(s)})("_userDragDrop",function(s){return a._handleUserDragDrop(s)}),T(),Lt(2,cO,0,0,"ng-template",2),I(3,"button",3),mt("focus",function(){return a._closeButtonFocused=!0})("blur",function(){return a._closeButtonFocused=!1})("click",function(){return a.datepicker.close()}),H(4),T()()),i&2){let o;ni("mat-datepicker-content-container-with-custom-header",a.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",a._actionsPortal),zn("aria-modal",!0)("aria-labelledby",(o=a._dialogLabelId)!==null&&o!==void 0?o:void 0),q(),kd(a.datepicker.panelClass),it("id",a.datepicker.id)("startAt",a.datepicker.startAt)("startView",a.datepicker.startView)("minDate",a.datepicker._getMinDate())("maxDate",a.datepicker._getMaxDate())("dateFilter",a.datepicker._getDateFilter())("headerComponent",a.datepicker.calendarHeaderComponent)("selected",a._getSelected())("dateClass",a.datepicker.dateClass)("comparisonStart",a.comparisonStart)("comparisonEnd",a.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",a.startDateAccessibleName)("endDateAccessibleName",a.endDateAccessibleName),q(),it("cdkPortalOutlet",a._actionsPortal),q(),ni("cdk-visually-hidden",!a._closeButtonFocused),it("color",a.color||"primary"),q(),oe(a._closeButtonText)}},dependencies:[Zg,hm,Fd,Rd],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[Yw.transformPanel,Yw.fadeInCalendar]},changeDetection:0});let r=e;return r})();var CO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=fg({type:e,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let r=e;return r})(),SO=(()=>{let e=class e{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(n){this._disabled=n}constructor(n,i,a){this._intl=n,this._changeDetectorRef=i,this._stateChanges=xa.EMPTY;let o=Number(a);this.tabIndex=o||o===0?o:null}ngOnChanges(n){n.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(n){this.datepicker&&!this.disabled&&(this.datepicker.open(),n.stopPropagation())}_watchStateChanges(){let n=this.datepicker?this.datepicker.stateChanges:Fi(),i=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Fi(),a=this.datepicker?Ar(this.datepicker.openedStream,this.datepicker.closedStream):Fi();this._stateChanges.unsubscribe(),this._stateChanges=Ar(this._intl.changes,n,i,a).subscribe(()=>this._changeDetectorRef.markForCheck())}};e.\u0275fac=function(i){return new(i||e)(rt(dc),rt(rr),yg("tabindex"))},e.\u0275cmp=Et({type:e,selectors:[["mat-datepicker-toggle"]],contentQueries:function(i,a,o){if(i&1&&Eg(o,CO,5),i&2){let s;ke(s=De())&&(a._customIcon=s.first)}},viewQuery:function(i,a){if(i&1&&Pe(uO,5),i&2){let o;ke(o=De())&&(a._button=o.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(i,a){i&1&&mt("click",function(s){return a._open(s)}),i&2&&(zn("tabindex",null)("data-mat-calendar",a.datepicker?a.datepicker.id:null),ni("mat-datepicker-toggle-active",a.datepicker&&a.datepicker.opened)("mat-accent",a.datepicker&&a.datepicker.color==="accent")("mat-warn",a.datepicker&&a.datepicker.color==="warn"))},inputs:{datepicker:[kc.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[kc.None,"aria-label","ariaLabel"],disabled:[kc.HasDecoratorInputTransform,"disabled","disabled",Og],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[xg,jo,Mr],ngContentSelectors:hO,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(i,a){i&1&&(Dd(dO),I(0,"button",0,1),Lt(2,lO,2,0,":svg:svg",2),Ad(3),T()),i&2&&(it("disabled",a.disabled)("disableRipple",a.disableRipple),zn("aria-haspopup",a.datepicker?"dialog":null)("aria-label",a.ariaLabel||a._intl.openCalendarLabel)("tabindex",a.disabled?-1:a.tabIndex),q(2),Uo(2,a._customIcon?-1:2))},dependencies:[Td],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let r=e;return r})();var Jw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({providers:[dc,_O],imports:[Da,Ta,sv,ev,ov,nv,wO,SO,Qw,iv]});let r=e;return r})();var Zw=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({imports:[Da,bv,Ma,Ra,qc,Uc,Gc,Ta,Yc,Hc]});let r=e;return r})();var EO=(()=>{let e=class e extends Xc{constructor(n,i,a){super(n,i,a,xe(Ic,{optional:!0}))}ngOnDestroy(){this.flush()}};e.\u0275fac=function(i){return new(i||e)(nt(Go),nt(Xo),nt(Kc))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})();function kO(){return new _v}function DO(r,e,t){return new Cv(r,e,t)}var eC=[{provide:Kc,useFactory:kO},{provide:Xc,useClass:EO},{provide:Mc,useFactory:DO,deps:[Lc,Xc,ir]}],tC=[{provide:Xo,useFactory:()=>new wv},{provide:zo,useValue:"BrowserAnimations"},...eC],AO=[{provide:Xo,useClass:xv},{provide:zo,useValue:"NoopAnimations"},...eC],nC=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?AO:tC}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({providers:tC,imports:[Bc]});let r=e;return r})();function hc(r,e){let t=!e?.manualCleanup;t&&!e?.injector&&bg(hc);let n=t?e?.injector?.get(Ed)??xe(Ed):null,i;e?.requireSync?i=Sd({kind:0}):i=Sd({kind:1,value:e?.initialValue});let a=r.subscribe({next:o=>i.set({kind:1,value:o}),error:o=>{if(e?.rejectErrors)throw o;i.set({kind:2,error:o})}});return n?.onDestroy(a.unsubscribe.bind(a)),Rc(()=>{let o=i();switch(o.kind){case 1:return o.value;case 2:throw o.error;case 0:throw new Ec(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var Sm={};function vC(r,e){if(Sm[r]=(Sm[r]||0)+1,typeof e=="function")return _m(r,(...n)=>cn(Te({},e(...n)),{type:r}));switch(e?e._as:"empty"){case"empty":return _m(r,()=>({type:r}));case"props":return _m(r,n=>cn(Te({},n),{type:r}));default:throw new Error("Unexpected config.")}}function _m(r,e){return Object.defineProperty(e,"type",{value:r,writable:!1})}var pc="@ngrx/store/init",Sr=(()=>{let e=class e extends _a{constructor(){super({type:pc})}next(n){if(typeof n=="function")throw new TypeError(`
        Dispatch expected an object, instead it received a function.
        If you're using the createAction function, make sure to invoke the function
        before dispatching the action. For example, someAction should be someAction().`);if(typeof n>"u")throw new TypeError("Actions must be objects");if(typeof n.type>"u")throw new TypeError("Actions must have a type property");super.next(n)}complete(){}ngOnDestroy(){super.complete()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),MO=[Sr],bC=new pt("@ngrx/store Internal Root Guard"),rC=new pt("@ngrx/store Internal Initial State"),mc=new pt("@ngrx/store Initial State"),yC=new pt("@ngrx/store Reducer Factory"),iC=new pt("@ngrx/store Internal Reducer Factory Provider"),xC=new pt("@ngrx/store Initial Reducers"),wm=new pt("@ngrx/store Internal Initial Reducers"),aC=new pt("@ngrx/store Store Features"),oC=new pt("@ngrx/store Internal Store Reducers"),Cm=new pt("@ngrx/store Internal Feature Reducers"),sC=new pt("@ngrx/store Internal Feature Configs"),_C=new pt("@ngrx/store Internal Store Features"),cC=new pt("@ngrx/store Internal Feature Reducers Token"),wC=new pt("@ngrx/store Feature Reducers"),uC=new pt("@ngrx/store User Provided Meta Reducers"),td=new pt("@ngrx/store Meta Reducers"),lC=new pt("@ngrx/store Internal Resolved Meta Reducers"),dC=new pt("@ngrx/store User Runtime Checks Config"),hC=new pt("@ngrx/store Internal User Runtime Checks Config"),fc=new pt("@ngrx/store Internal Runtime Checks"),Am=new pt("@ngrx/store Check if Action types are unique"),RO=new pt("@ngrx/store Root Store Provider"),TO=new pt("@ngrx/store Feature State Provider");function Im(r,e={}){let t=Object.keys(r),n={};for(let a=0;a<t.length;a++){let o=t[a];typeof r[o]=="function"&&(n[o]=r[o])}let i=Object.keys(n);return function(o,s){o=o===void 0?e:o;let c=!1,u={};for(let l=0;l<i.length;l++){let d=i[l],h=n[d],f=o[d],p=h(f,s);u[d]=p,c=c||p!==f}return c?u:o}}function FO(r,e){return Object.keys(r).filter(t=>t!==e).reduce((t,n)=>Object.assign(t,{[n]:r[n]}),{})}function CC(...r){return function(e){if(r.length===0)return e;let t=r[r.length-1];return r.slice(0,-1).reduceRight((i,a)=>a(i),t(e))}}function SC(r,e){return Array.isArray(e)&&e.length>0&&(r=CC.apply(null,[...e,r])),(t,n)=>{let i=r(t);return(a,o)=>(a=a===void 0?n:a,i(a,o))}}function PO(r){let e=Array.isArray(r)&&r.length>0?CC(...r):t=>t;return(t,n)=>(t=e(t),(i,a)=>(i=i===void 0?n:i,t(i,a)))}var ma=class extends ei{},Lo=class extends Sr{},nd="@ngrx/store/update-reducers",ed=(()=>{let e=class e extends _a{get currentReducers(){return this.reducers}constructor(n,i,a,o){super(o(a,i)),this.dispatcher=n,this.initialState=i,this.reducers=a,this.reducerFactory=o}addFeature(n){this.addFeatures([n])}addFeatures(n){let i=n.reduce((a,{reducers:o,reducerFactory:s,metaReducers:c,initialState:u,key:l})=>{let d=typeof o=="function"?PO(c)(o,u):SC(s,c)(o,u);return a[l]=d,a},{});this.addReducers(i)}removeFeature(n){this.removeFeatures([n])}removeFeatures(n){this.removeReducers(n.map(i=>i.key))}addReducer(n,i){this.addReducers({[n]:i})}addReducers(n){this.reducers=Te(Te({},this.reducers),n),this.updateReducers(Object.keys(n))}removeReducer(n){this.removeReducers([n])}removeReducers(n){n.forEach(i=>{this.reducers=FO(this.reducers,i)}),this.updateReducers(n)}updateReducers(n){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:nd,features:n})}ngOnDestroy(){this.complete()}};e.\u0275fac=function(i){return new(i||e)(nt(Lo),nt(mc),nt(xC),nt(yC))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),OO=[ed,{provide:ma,useExisting:ed},{provide:Lo,useExisting:Sr}],Vo=(()=>{let e=class e extends Wn{ngOnDestroy(){this.complete()}};e.\u0275fac=(()=>{let n;return function(a){return(n||(n=Ho(e)))(a||e)}})(),e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),NO=[Vo],Bo=class extends ei{},fC=(()=>{let e=class e extends _a{constructor(n,i,a,o){super(o);let c=n.pipe(xc(yc)).pipe(Sc(i)),u={state:o},l=c.pipe(_c(LO,u));this.stateSubscription=l.subscribe(({state:d,action:h})=>{this.next(d),a.next(h)}),this.state=hc(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}};e.INIT=pc,e.\u0275fac=function(i){return new(i||e)(nt(Sr),nt(ma),nt(Vo),nt(mc))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})();function LO(r={state:void 0},[e,t]){let{state:n}=r;return{state:t(n,e),action:e}}var BO=[fC,{provide:Bo,useExisting:fC}],ga=(()=>{let e=class e extends ei{constructor(n,i,a){super(),this.actionsObserver=i,this.reducerManager=a,this.source=n,this.state=n.state}select(n,...i){return WO.call(null,n,...i)(this)}selectSignal(n,i){return Rc(()=>n(this.state()),i)}lift(n){let i=new e(this,this.actionsObserver,this.reducerManager);return i.operator=n,i}dispatch(n){this.actionsObserver.next(n)}next(n){this.actionsObserver.next(n)}error(n){this.actionsObserver.error(n)}complete(){this.actionsObserver.complete()}addReducer(n,i){this.reducerManager.addReducer(n,i)}removeReducer(n){this.reducerManager.removeReducer(n)}};e.\u0275fac=function(i){return new(i||e)(nt(Bo),nt(Sr),nt(ed))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),VO=[ga];function WO(r,e,...t){return function(i){let a;if(typeof r=="string"){let o=[e,...t].filter(Boolean);a=i.pipe(cg(r,...o))}else if(typeof r=="function")a=i.pipe(Fe(o=>r(o,e)));else throw new TypeError(`Unexpected type '${typeof r}' in select operator, expected 'string' or 'function'`);return a.pipe(ag())}}var Mm="https://ngrx.io/guide/store/configuration/runtime-checks";function pC(r){return r===void 0}function mC(r){return r===null}function EC(r){return Array.isArray(r)}function zO(r){return typeof r=="string"}function jO(r){return typeof r=="boolean"}function HO(r){return typeof r=="number"}function kC(r){return typeof r=="object"&&r!==null}function UO(r){return kC(r)&&!EC(r)}function GO(r){if(!UO(r))return!1;let e=Object.getPrototypeOf(r);return e===Object.prototype||e===null}function Em(r){return typeof r=="function"}function qO(r){return Em(r)&&r.hasOwnProperty("\u0275cmp")}function YO(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function KO(r){return r instanceof pt?xe(r):r}function XO(r,e){return e.map((t,n)=>{if(r[n]instanceof pt){let i=xe(r[n]);return{key:t.key,reducerFactory:i.reducerFactory?i.reducerFactory:Im,metaReducers:i.metaReducers?i.metaReducers:[],initialState:i.initialState}}return t})}function $O(r){return r.map(e=>e instanceof pt?xe(e):e)}function DC(r){return typeof r=="function"?r():r}function QO(r,e){return r.concat(e)}function JO(){if(xe(ga,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function ZO(r,e){return function(t,n){let i=e.action(n)?km(n):n,a=r(t,i);return e.state()?km(a):a}}function km(r){Object.freeze(r);let e=Em(r);return Object.getOwnPropertyNames(r).forEach(t=>{if(!t.startsWith("\u0275")&&YO(r,t)&&(!e||t!=="caller"&&t!=="callee"&&t!=="arguments")){let n=r[t];(kC(n)||Em(n))&&!Object.isFrozen(n)&&km(n)}}),r}function tN(r,e){return function(t,n){if(e.action(n)){let a=Dm(n);gC(a,"action")}let i=r(t,n);if(e.state()){let a=Dm(i);gC(a,"state")}return i}}function Dm(r,e=[]){return(pC(r)||mC(r))&&e.length===0?{path:["root"],value:r}:Object.keys(r).reduce((n,i)=>{if(n)return n;let a=r[i];return qO(a)?n:pC(a)||mC(a)||HO(a)||jO(a)||zO(a)||EC(a)?!1:GO(a)?Dm(a,[...e,i]):{path:[...e,i],value:a}},!1)}function gC(r,e){if(r===!1)return;let t=r.path.join("."),n=new Error(`Detected unserializable ${e} at "${t}". ${Mm}#strict${e}serializability`);throw n.value=r.value,n.unserializablePath=t,n}function eN(r,e){return function(t,n){if(e.action(n)&&!ir.isInAngularZone())throw new Error(`Action '${n.type}' running outside NgZone. ${Mm}#strictactionwithinngzone`);return r(t,n)}}function nN(r){return Pg()?Te({strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1},r):{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function rN({strictActionSerializability:r,strictStateSerializability:e}){return t=>r||e?tN(t,{action:n=>r&&!Rm(n),state:()=>e}):t}function iN({strictActionImmutability:r,strictStateImmutability:e}){return t=>r||e?ZO(t,{action:n=>r&&!Rm(n),state:()=>e}):t}function Rm(r){return r.type.startsWith("@ngrx")}function aN({strictActionWithinNgZone:r}){return e=>r?eN(e,{action:t=>r&&!Rm(t)}):e}function oN(r){return[{provide:hC,useValue:r},{provide:dC,useFactory:sN,deps:[hC]},{provide:fc,deps:[dC],useFactory:nN},{provide:td,multi:!0,deps:[fc],useFactory:iN},{provide:td,multi:!0,deps:[fc],useFactory:rN},{provide:td,multi:!0,deps:[fc],useFactory:aN}]}function AC(){return[{provide:Am,multi:!0,deps:[fc],useFactory:cN}]}function sN(r){return r}function cN(r){if(!r.strictActionTypeUniqueness)return;let e=Object.entries(Sm).filter(([,t])=>t>1).map(([t])=>t);if(e.length)throw new Error(`Action types are registered more than once, ${e.map(t=>`"${t}"`).join(", ")}. ${Mm}#strictactiontypeuniqueness`)}function uN(r={},e={}){return[{provide:bC,useFactory:JO},{provide:rC,useValue:e.initialState},{provide:mc,useFactory:DC,deps:[rC]},{provide:wm,useValue:r},{provide:oC,useExisting:r instanceof pt?r:wm},{provide:xC,deps:[wm,[new _d(oC)]],useFactory:KO},{provide:uC,useValue:e.metaReducers?e.metaReducers:[]},{provide:lC,deps:[td,uC],useFactory:QO},{provide:iC,useValue:e.reducerFactory?e.reducerFactory:Im},{provide:yC,deps:[iC,lC],useFactory:SC},MO,OO,NO,BO,VO,oN(e.runtimeChecks),AC()]}function lN(r,e,t={}){return[{provide:sC,multi:!0,useValue:r instanceof Object?{}:t},{provide:aC,multi:!0,useValue:{key:r instanceof Object?r.name:r,reducerFactory:!(t instanceof pt)&&t.reducerFactory?t.reducerFactory:Im,metaReducers:!(t instanceof pt)&&t.metaReducers?t.metaReducers:[],initialState:!(t instanceof pt)&&t.initialState?t.initialState:void 0}},{provide:_C,deps:[sC,aC],useFactory:XO},{provide:Cm,multi:!0,useValue:r instanceof Object?r.reducer:e},{provide:cC,multi:!0,useExisting:e instanceof pt?e:Cm},{provide:wC,multi:!0,deps:[Cm,[new _d(cC)]],useFactory:$O},AC()]}var gc=(()=>{let e=class e{constructor(n,i,a,o,s,c){}};e.\u0275fac=function(i){return new(i||e)(nt(Sr),nt(ma),nt(Vo),nt(ga),nt(bC,8),nt(Am,8))},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})(),rd=(()=>{let e=class e{constructor(n,i,a,o,s){this.features=n,this.featureReducers=i,this.reducerManager=a;let c=n.map((u,l)=>{let h=i.shift()[l];return cn(Te({},u),{reducers:h,initialState:DC(u.initialState)})});a.addFeatures(c)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}};e.\u0275fac=function(i){return new(i||e)(nt(_C),nt(wC),nt(ed),nt(gc),nt(Am,8))},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})(),IC=(()=>{let e=class e{static forRoot(n,i){return{ngModule:gc,providers:[...uN(n,i)]}}static forFeature(n,i,a={}){return{ngModule:rd,providers:[...lN(n,i,a)]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})();var bc="PERFORM_ACTION",dN="REFRESH",NC="RESET",LC="ROLLBACK",BC="COMMIT",VC="SWEEP",WC="TOGGLE_ACTION",hN="SET_ACTIONS_ACTIVE",zC="JUMP_TO_STATE",jC="JUMP_TO_ACTION",Um="IMPORT_STATE",HC="LOCK_CHANGES",UC="PAUSE_RECORDING",Wo=class{constructor(e,t){if(this.action=e,this.timestamp=t,this.type=bc,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},Tm=class{constructor(){this.type=dN}},Fm=class{constructor(e){this.timestamp=e,this.type=NC}},Pm=class{constructor(e){this.timestamp=e,this.type=LC}},Om=class{constructor(e){this.timestamp=e,this.type=BC}},Nm=class{constructor(){this.type=VC}},Lm=class{constructor(e){this.id=e,this.type=WC}};var Bm=class{constructor(e){this.index=e,this.type=zC}},Vm=class{constructor(e){this.actionId=e,this.type=jC}},Wm=class{constructor(e){this.nextLiftedState=e,this.type=Um}},zm=class{constructor(e){this.status=e,this.type=HC}},jm=class{constructor(e){this.status=e,this.type=UC}};var sd=new pt("@ngrx/store-devtools Options"),RC=new pt("@ngrx/store-devtools Initial Config");function GC(){return null}var fN="NgRx Store DevTools";function pN(r){let e={maxAge:!1,monitor:GC,actionSanitizer:void 0,stateSanitizer:void 0,name:fN,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},t=typeof r=="function"?r():r,n=t.logOnly?{pause:!0,export:!0,test:!0}:!1,i=t.features||n||e.features;i.import===!0&&(i.import="custom");let a=Object.assign({},e,{features:i},t);if(a.maxAge&&a.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${a.maxAge}`);return a}function TC(r,e){return r.filter(t=>e.indexOf(t)<0)}function qC(r){let{computedStates:e,currentStateIndex:t}=r;if(t>=e.length){let{state:i}=e[e.length-1];return i}let{state:n}=e[t];return n}function vc(r){return new Wo(r,+Date.now())}function mN(r,e){return Object.keys(e).reduce((t,n)=>{let i=Number(n);return t[i]=YC(r,e[i],i),t},{})}function YC(r,e,t){return cn(Te({},e),{action:r(e.action,t)})}function gN(r,e){return e.map((t,n)=>({state:KC(r,t.state,n),error:t.error}))}function KC(r,e,t){return r(e,t)}function XC(r){return r.predicate||r.actionsSafelist||r.actionsBlocklist}function vN(r,e,t,n){let i=[],a={},o=[];return r.stagedActionIds.forEach((s,c)=>{let u=r.actionsById[s];u&&(c&&Gm(r.computedStates[c],u,e,t,n)||(a[s]=u,i.push(s),o.push(r.computedStates[c])))}),cn(Te({},r),{stagedActionIds:i,actionsById:a,computedStates:o})}function Gm(r,e,t,n,i){let a=t&&!t(r,e.action),o=n&&!e.action.type.match(n.map(c=>FC(c)).join("|")),s=i&&e.action.type.match(i.map(c=>FC(c)).join("|"));return a||o||s}function FC(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $C(r){return{ngZone:r?xe(ir):null,connectInZone:r}}var cd=(()=>{let e=class e extends Sr{};e.\u0275fac=(()=>{let n;return function(a){return(n||(n=Ho(e)))(a||e)}})(),e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),id={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},Hm=new pt("@ngrx/store-devtools Redux Devtools Extension"),QC=(()=>{let e=class e{constructor(n,i,a){this.config=i,this.dispatcher=a,this.zoneConfig=$C(this.config.connectInZone),this.devtoolsExtension=n,this.createActionStreams()}notify(n,i){if(this.devtoolsExtension)if(n.type===bc){if(i.isLocked||i.isPaused)return;let a=qC(i);if(XC(this.config)&&Gm(a,n,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let o=this.config.stateSanitizer?KC(this.config.stateSanitizer,a,i.currentStateIndex):a,s=this.config.actionSanitizer?YC(this.config.actionSanitizer,n,i.nextActionId):n;this.sendToReduxDevtools(()=>this.extensionConnection.send(s,o))}else{let a=cn(Te({},i),{stagedActionIds:i.stagedActionIds,actionsById:this.config.actionSanitizer?mN(this.config.actionSanitizer,i.actionsById):i.actionsById,computedStates:this.config.stateSanitizer?gN(this.config.stateSanitizer,i.computedStates):i.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,a,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new ei(n=>{let i=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=i,i.init(),i.subscribe(a=>n.next(a)),i.unsubscribe}):Qm}createActionStreams(){let n=this.createChangesObservable().pipe(ug()),i=n.pipe(nr(l=>l.type===id.START)),a=n.pipe(nr(l=>l.type===id.STOP)),o=n.pipe(nr(l=>l.type===id.DISPATCH),Fe(l=>this.unwrapAction(l.payload)),vd(l=>l.type===Um?this.dispatcher.pipe(nr(d=>d.type===nd),Zm(1e3),ng(1e3),Fe(()=>l),wa(()=>Fi(l)),Ca(1)):Fi(l))),c=n.pipe(nr(l=>l.type===id.ACTION),Fe(l=>this.unwrapAction(l.payload))).pipe(Cc(a)),u=o.pipe(Cc(a));this.start$=i.pipe(Cc(a)),this.actions$=this.start$.pipe(yd(()=>c)),this.liftedActions$=this.start$.pipe(yd(()=>u))}unwrapAction(n){return typeof n=="string"?(0,eval)(`(${n})`):n}getExtensionConfig(n){let i={name:n.name,features:n.features,serialize:n.serialize,autoPause:n.autoPause??!1,trace:n.trace??!1,traceLimit:n.traceLimit??75};return n.maxAge!==!1&&(i.maxAge=n.maxAge),i}sendToReduxDevtools(n){try{n()}catch(i){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",i)}}};e.\u0275fac=function(i){return new(i||e)(nt(Hm),nt(sd),nt(cd))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})(),od={type:pc},bN="@ngrx/store-devtools/recompute",yN={type:bN};function JC(r,e,t,n,i){if(n)return{state:t,error:"Interrupted by an error up the chain"};let a=t,o;try{a=r(t,e)}catch(s){o=s.toString(),i.handleError(s)}return{state:a,error:o}}function ad(r,e,t,n,i,a,o,s,c){if(e>=r.length&&r.length===a.length)return r;let u=r.slice(0,e),l=a.length-(c?1:0);for(let d=e;d<l;d++){let h=a[d],f=i[h].action,p=u[d-1],m=p?p.state:n,g=p?p.error:void 0,b=o.indexOf(h)>-1?p:JC(t,f,m,g,s);u.push(b)}return c&&u.push(r[r.length-1]),u}function xN(r,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:vc(od)},stagedActionIds:[0],skippedActionIds:[],committedState:r,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function _N(r,e,t,n,i={}){return a=>(o,s)=>{let{monitorState:c,actionsById:u,nextActionId:l,stagedActionIds:d,skippedActionIds:h,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}=o||e;o||(u=Object.create(u));function b(x){let w=x,S=d.slice(1,w+1);for(let C=0;C<S.length;C++)if(m[C+1].error){w=C,S=d.slice(1,w+1);break}else delete u[S[C]];h=h.filter(C=>S.indexOf(C)===-1),d=[0,...d.slice(w+1)],f=m[w].state,m=m.slice(w),p=p>w?p-w:0}function _(){u={0:vc(od)},l=1,d=[0],h=[],f=m[p].state,p=0,m=[]}let y=0;switch(s.type){case HC:{g=s.status,y=1/0;break}case UC:{v=s.status,v?(d=[...d,l],u[l]=new Wo({type:"@ngrx/devtools/pause"},+Date.now()),l++,y=d.length-1,m=m.concat(m[m.length-1]),p===d.length-2&&p++,y=1/0):_();break}case NC:{u={0:vc(od)},l=1,d=[0],h=[],f=r,p=0,m=[];break}case BC:{_();break}case LC:{u={0:vc(od)},l=1,d=[0],h=[],p=0,m=[];break}case WC:{let{id:x}=s;h.indexOf(x)===-1?h=[x,...h]:h=h.filter(S=>S!==x),y=d.indexOf(x);break}case hN:{let{start:x,end:w,active:S}=s,C=[];for(let E=x;E<w;E++)C.push(E);S?h=TC(h,C):h=[...h,...C],y=d.indexOf(x);break}case zC:{p=s.index,y=1/0;break}case jC:{let x=d.indexOf(s.actionId);x!==-1&&(p=x),y=1/0;break}case VC:{d=TC(d,h),h=[],p=Math.min(p,d.length-1);break}case bc:{if(g)return o||e;if(v||o&&Gm(o.computedStates[p],s,i.predicate,i.actionsSafelist,i.actionsBlocklist)){let w=m[m.length-1];m=[...m.slice(0,-1),JC(a,s.action,w.state,w.error,t)],y=1/0;break}i.maxAge&&d.length===i.maxAge&&b(1),p===d.length-1&&p++;let x=l++;u[x]=s,d=[...d,x],y=d.length-1;break}case Um:{({monitorState:c,actionsById:u,nextActionId:l,stagedActionIds:d,skippedActionIds:h,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}=s.nextLiftedState);break}case pc:{y=0,i.maxAge&&d.length>i.maxAge&&(m=ad(m,y,a,f,u,d,h,t,v),b(d.length-i.maxAge),y=1/0);break}case nd:{if(m.filter(w=>w.error).length>0)y=0,i.maxAge&&d.length>i.maxAge&&(m=ad(m,y,a,f,u,d,h,t,v),b(d.length-i.maxAge),y=1/0);else{if(!v&&!g){p===d.length-1&&p++;let w=l++;u[w]=new Wo(s,+Date.now()),d=[...d,w],y=d.length-1,m=ad(m,y,a,f,u,d,h,t,v)}m=m.map(w=>cn(Te({},w),{state:a(w.state,yN)})),p=d.length-1,i.maxAge&&d.length>i.maxAge&&b(d.length-i.maxAge),y=1/0}break}default:{y=1/0;break}}return m=ad(m,y,a,f,u,d,h,t,v),c=n(c,s),{monitorState:c,actionsById:u,nextActionId:l,stagedActionIds:d,skippedActionIds:h,committedState:f,currentStateIndex:p,computedStates:m,isLocked:g,isPaused:v}}}var PC=(()=>{let e=class e{constructor(n,i,a,o,s,c,u,l){let d=xN(u,l.monitor),h=_N(u,d,c,l.monitor,l),f=Ar(Ar(i.asObservable().pipe(lg(1)),o.actions$).pipe(Fe(vc)),n,o.liftedActions$).pipe(xc(yc)),p=a.pipe(Fe(h)),m=$C(l.connectInZone),g=new $m(1);this.liftedStateSubscription=f.pipe(Sc(p),OC(m),_c(({state:_},[y,x])=>{let w=x(_,y);return y.type!==bc&&XC(l)&&(w=vN(w,l.predicate,l.actionsSafelist,l.actionsBlocklist)),o.notify(y,w),{state:w,action:y}},{state:d,action:null})).subscribe(({state:_,action:y})=>{if(g.next(_),y.type===bc){let x=y.action;s.next(x)}}),this.extensionStartSubscription=o.start$.pipe(OC(m)).subscribe(()=>{this.refresh()});let v=g.asObservable(),b=v.pipe(Fe(qC));Object.defineProperty(b,"state",{value:hc(b,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=n,this.liftedState=v,this.state=b}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(n){this.dispatcher.next(n)}next(n){this.dispatcher.next(n)}error(n){}complete(){}performAction(n){this.dispatch(new Wo(n,+Date.now()))}refresh(){this.dispatch(new Tm)}reset(){this.dispatch(new Fm(+Date.now()))}rollback(){this.dispatch(new Pm(+Date.now()))}commit(){this.dispatch(new Om(+Date.now()))}sweep(){this.dispatch(new Nm)}toggleAction(n){this.dispatch(new Lm(n))}jumpToAction(n){this.dispatch(new Vm(n))}jumpToState(n){this.dispatch(new Bm(n))}importState(n){this.dispatch(new Wm(n))}lockChanges(n){this.dispatch(new zm(n))}pauseRecording(n){this.dispatch(new jm(n))}};e.\u0275fac=function(i){return new(i||e)(nt(cd),nt(Sr),nt(ma),nt(QC),nt(Vo),nt(Dc),nt(mc),nt(sd))},e.\u0275prov=It({token:e,factory:e.\u0275fac});let r=e;return r})();function OC({ngZone:r,connectInZone:e}){return t=>e?new ei(n=>t.subscribe({next:i=>r.run(()=>n.next(i)),error:i=>r.run(()=>n.error(i)),complete:()=>r.run(()=>n.complete())})):t}var wN=new pt("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function CN(r,e){return!!r||e.monitor!==GC}function SN(){let r="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[r]<"u"?window[r]:null}function EN(r={}){return Ea([QC,cd,PC,{provide:RC,useValue:r},{provide:wN,deps:[Hm,sd],useFactory:CN},{provide:Hm,useFactory:SN},{provide:sd,deps:[RC],useFactory:pN},{provide:Bo,deps:[PC],useFactory:kN},{provide:Lo,useExisting:cd}])}function kN(r){return r.state}var ZC=(()=>{let e=class e{static instrument(n={}){return{ngModule:e,providers:[EN(n)]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})();var qm="__@ngrx/effects_create__";function DN(r){return Object.getOwnPropertyNames(r).filter(n=>r[n]&&r[n].hasOwnProperty(qm)?r[n][qm].hasOwnProperty("dispatch"):!1).map(n=>{let i=r[n][qm];return Te({propertyName:n},i)})}function AN(r){return DN(r)}function r2(r){return Object.getPrototypeOf(r)}function IN(r){return!!r.constructor&&r.constructor.name!=="Object"&&r.constructor.name!=="Function"}function i2(r){return typeof r=="function"}function t2(r){return r.filter(i2)}function MN(r){return r instanceof pt||i2(r)}function RN(r,e,t){let n=r2(r),a=!!n&&n.constructor.name!=="Object"?n.constructor.name:null,o=AN(r).map(({propertyName:s,dispatch:c,useEffectsErrorHandler:u})=>{let l=typeof r[s]=="function"?r[s]():r[s],d=u?t(l,e):l;return c===!1?d.pipe(rg()):d.pipe(sg()).pipe(Fe(f=>({effect:r[s],notification:f,propertyName:s,sourceName:a,sourceInstance:r})))});return Ar(...o)}var TN=10;function a2(r,e,t=TN){return r.pipe(wa(n=>(e&&e.handleError(n),t<=1?r:a2(r,e,t-1))))}var o2=new pt("@ngrx/effects Internal Root Guard"),ud=new pt("@ngrx/effects User Provided Effects"),Ym=new pt("@ngrx/effects Internal Root Effects"),s2=new pt("@ngrx/effects Internal Root Effects Instances"),e2=new pt("@ngrx/effects Internal Feature Effects"),c2=new pt("@ngrx/effects Internal Feature Effects Instance Groups"),FN=new pt("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>a2}),u2="@ngrx/effects/init",J7=vC(u2);function PN(r,e){if(r.notification.kind==="N"){let t=r.notification.value;!ON(t)&&e.handleError(new Error(`Effect ${NN(r)} dispatched an invalid action: ${LN(t)}`))}}function ON(r){return typeof r!="function"&&r&&r.type&&typeof r.type=="string"}function NN({propertyName:r,sourceInstance:e,sourceName:t}){let n=typeof e[r]=="function";return!!t?`"${t}.${String(r)}${n?"()":""}"`:`"${String(r)}()"`}function LN(r){try{return JSON.stringify(r)}catch{return r}}var BN="ngrxOnIdentifyEffects";function VN(r){return Km(r,BN)}var WN="ngrxOnRunEffects";function zN(r){return Km(r,WN)}var jN="ngrxOnInitEffects";function HN(r){return Km(r,jN)}function Km(r,e){return r&&e in r&&typeof r[e]=="function"}var l2=(()=>{let e=class e extends Wn{constructor(n,i){super(),this.errorHandler=n,this.effectsErrorHandler=i}addEffects(n){this.next(n)}toActions(){return this.pipe(bd(n=>IN(n)?r2(n):n),gd(n=>n.pipe(bd(UN))),gd(n=>{let i=n.pipe(og(o=>GN(this.errorHandler,this.effectsErrorHandler)(o)),Fe(o=>(PN(o,this.errorHandler),o.notification)),nr(o=>o.kind==="N"&&o.value!=null),ig()),a=n.pipe(Ca(1),nr(HN),Fe(o=>o.ngrxOnInitEffects()));return Ar(i,a)}))}};e.\u0275fac=function(i){return new(i||e)(nt(Dc),nt(FN))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function UN(r){return VN(r)?r.ngrxOnIdentifyEffects():""}function GN(r,e){return t=>{let n=RN(t,r,e);return zN(t)?t.ngrxOnRunEffects(n):n}}var d2=(()=>{let e=class e{get isStarted(){return!!this.effectsSubscription}constructor(n,i){this.effectSources=n,this.store=i,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};e.\u0275fac=function(i){return new(i||e)(nt(l2),nt(ga))},e.\u0275prov=It({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),h2=(()=>{let e=class e{constructor(n,i,a,o,s,c,u){this.sources=n,i.start();for(let l of o)n.addEffects(l);a.dispatch({type:u2})}addEffects(n){this.sources.addEffects(n)}};e.\u0275fac=function(i){return new(i||e)(nt(l2),nt(d2),nt(ga),nt(s2),nt(gc,8),nt(rd,8),nt(o2,8))},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})(),qN=(()=>{let e=class e{constructor(n,i,a,o){let s=i.flat();for(let c of s)n.addEffects(c)}};e.\u0275fac=function(i){return new(i||e)(nt(h2),nt(c2),nt(gc,8),nt(rd,8))},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})(),f2=(()=>{let e=class e{static forFeature(...n){let i=n.flat(),a=t2(i);return{ngModule:qN,providers:[a,{provide:e2,multi:!0,useValue:i},{provide:ud,multi:!0,useValue:[]},{provide:c2,multi:!0,useFactory:n2,deps:[e2,ud]}]}}static forRoot(...n){let i=n.flat(),a=t2(i);return{ngModule:h2,providers:[a,{provide:Ym,useValue:[i]},{provide:o2,useFactory:YN},{provide:ud,multi:!0,useValue:[]},{provide:s2,useFactory:n2,deps:[Ym,ud]}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({});let r=e;return r})();function n2(r,e){let t=[];for(let n of r)t.push(...n);for(let n of e)t.push(...n);return t.map(n=>MN(n)?xe(n):n)}function YN(){let r=xe(d2,{optional:!0,skipSelf:!0}),e=xe(Ym,{self:!0});if(!(e.length===1&&e[0].length===0)&&r)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}var p2=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e}),e.\u0275inj=pe({imports:[Da,yv,Ma,Ra,qc,Uc,Gc,Ta,Yc,Hc]});let r=e;return r})();var m2=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=fe({type:e,bootstrap:[Vw]}),e.\u0275inj=pe({providers:[jg(),Ww(),{provide:Vg,useClass:zw,multi:!0},Nc],imports:[Bc,Bw,Wg,Ra,Ma,uv,Bd,vv,cv,fv,gv,Jw,rv,Bd,lv,pv,mv,Zw,dv,p2,hv,nC,IC.forRoot({}),ZC.instrument({maxAge:25,autoPause:!0}),f2.forRoot([])]});let r=e;return r})();zg().bootstrapModule(m2).catch(r=>console.error(r));
