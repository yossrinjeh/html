import{a as yd,b as Ld}from"./chunk-LOZVEDIZ.js";import{a as Vd}from"./chunk-R7A2O4RY.js";import{a as Td}from"./chunk-XYKOSDJR.js";import{a as Fd}from"./chunk-GKVPWWDS.js";import{a as Qs,b as Js,c as kd,d as Ad,e as Zs,f as Id,g as eu,h as Rd}from"./chunk-QRGCNIAO.js";import{c as tu,d as Za,f as lr,g as nu,h as ru,i as ei}from"./chunk-AESYL7IM.js";import{a as au}from"./chunk-ZLDFRJE4.js";import"./chunk-QEBKWPPX.js";import{a as Md}from"./chunk-47K36B3M.js";import{a as Nd}from"./chunk-YVFPYOFC.js";import"./chunk-6VYLHM65.js";import{a as Pd}from"./chunk-BUOCKVF6.js";import{a as ir}from"./chunk-HG7DB6L2.js";import{a as md,b as or,c as Dr,e as Cn,f as sr,g as na,h as vd,i as kr,j as co,k as ur,l as gd,m as ra,n as aa,r as cr,u as lo,v as po}from"./chunk-4ZXNYKJD.js";import{a as Od,b as Bd}from"./chunk-MDM4TNH5.js";import{A as fo,E as Ed,G as En,H as Ja,I as Dd,_ as Sd,a as bd,c as ho,h as xd,t as _d,y as wd,z as Cd}from"./chunk-SDSENEPE.js";import{a as tg,b as ar}from"./chunk-3RCK6QBP.js";import"./chunk-WB6ARDAB.js";import{a as sd,b as Xs,c as ta,d as ud,e as cd,f as ld,g as dd,h as pd,j as hd,k as fd,l as uo,m as Xt,n as rr,o as $s}from"./chunk-HXFCOTNJ.js";import{$ as Ml,$b as ot,Aa as Vl,Ab as js,Ba as Vt,Ca as Xa,Cb as Qa,Cc as rd,Db as no,E as Rl,Ea as Wl,Eb as ro,Fa as zl,Fb as ao,G as zs,Ga as Ul,Gb as M,Hb as N,Ib as ee,Ic as Ks,J as Tl,Ka as $a,Ma as Hl,Mb as an,N as Fl,Ob as Kl,Pb as me,Pc as io,Qb as Xl,Qc as ad,Rb as fe,Rc as Kt,Sb as qs,Tb as Ys,Tc as id,Ub as $l,Uc as oo,Vb as on,Vc as so,Wb as qt,Xb as Yt,Xc as od,Y as Ji,Za as Gs,Zb as Y,_b as vt,ab as X,ac as Ql,ba as Nl,bb as oe,bc as xn,c as Vs,ca as je,cb as eo,cc as _n,dc as wn,e as Al,eb as Gl,ec as Jl,fc as On,g as nn,ga as Zi,gb as jl,gc as Zl,h as ea,ha as Ie,hc as ed,ia as Zn,ic as td,ja as Pl,jb as ql,jc as nd,ka as Je,la as Ze,lb as tr,m as Ya,ma as Ka,na as Ol,nb as to,oa as Us,ra as Ct,rb as Yl,s as Qi,sa as er,t as Il,ua as Hs,vb as ze,w as Ws,wb as rn,xa as Bl,xb as ue,ya as Ll,yb as bn,zb as nr}from"./chunk-OCYIH7HC.js";var Qd=Al((oa,$d)=>{"use strict";$d.exports=oa=window.fetch;oa.default=window.fetch.bind(window);oa.Headers=window.Headers;oa.Request=window.Request;oa.Response=window.Response});var Jd=Al(()=>{"use strict"});var ia=(()=>{let n=class n{constructor(t){this._http=t,this.URL="http://20.49.205.136:3000/auth/local/signin",this.LOGOUT_URL="http://20.49.205.136:3000/auth/logout",this.CODE_URL="http://20.49.205.136:3000/auth/sendsmscode/",this.CODE_URL_MAIL="http://20.49.205.136:3000/auth/sendmailcode/",this.VERIFY_URL="http://20.49.205.136:3000/auth/verifyCode/"}verifyCode(t,a){return this._http.post(this.VERIFY_URL+`${a}/${t}`,null)}sendVerificationCodeMail(t){return this._http.post(this.CODE_URL_MAIL+t,null)}sendVerificationCode(t){return this._http.post(this.CODE_URL+t,null)}login(t){return this._http.post(this.URL,t)}_is_logged(){return!!localStorage.getItem("token")}logout(){return this._http.post(this.LOGOUT_URL,{})}};n.\u0275fac=function(a){return new(a||n)(Vt(ta))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function ng(r,n){if(r&1&&(M(0,"div",18),Y(1),N()),r&2){let e=fe();X(),vt(e.errorMessage)}}var rg=()=>["/resetpassword"],uu=(()=>{let n=class n{constructor(t,a,i,o){this.encryptionService=t,this.authService=a,this.router=i,this.userService=o,this.authRequest={},this.authResponse={}}authenticate(){this.authService.login(this.authRequest).subscribe({next:t=>{if(this.authResponse=t,t.access_token=="sms"){let a={email:this.authRequest.email,method:t.access_token};localStorage.setItem("code",JSON.stringify(a)),this.router.navigate(["/sendcode"])}else if(t.access_token=="mail"){let a={email:this.authRequest.email,method:t.access_token};localStorage.setItem("code",JSON.stringify(a)),this.router.navigate(["/sendcode"])}else localStorage.setItem("token",t.access_token),this.userService.getUser(this.authRequest.email).subscribe({next:a=>{let i={firstname:a.firstname,lastname:a.lastname,email:a.email},o=this.encryptionService.encrypt(JSON.stringify(a.authorities),"2f7");localStorage.setItem("authorities",o),localStorage.setItem("user",JSON.stringify(i)),this.router.navigate(["/home"])},error:a=>{}})},error:t=>{this.errorMessage="Invalid email or password"}})}};n.\u0275fac=function(a){return new(a||n)(oe(ar),oe(ia),oe(Xt),oe(ir))},n.\u0275cmp=Ie({type:n,selectors:[["app-login"]],decls:25,vars:5,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-unlock","auth-icon"],[3,"ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","required","","name","email",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","mb-4"],["type","password","placeholder","password","required","","name","password",1,"form-control",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","shadow-2","mb-4"],["class","alert alert-danger",4,"ngIf"],[1,"mb-2","text-muted"],[3,"routerLink"],[1,"alert","alert-danger"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2),ee(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),N(),M(7,"div",5)(8,"div",6)(9,"div",7),ee(10,"i",8),N(),M(11,"form",9),me("ngSubmit",function(){return i.authenticate()}),M(12,"h3",7),Y(13,"Login"),N(),M(14,"div",10)(15,"input",11),wn("ngModelChange",function(s){return _n(i.authRequest.email,s)||(i.authRequest.email=s),s}),N()(),M(16,"div",12)(17,"input",13),wn("ngModelChange",function(s){return _n(i.authRequest.password,s)||(i.authRequest.password=s),s}),N()(),M(18,"button",14),Y(19,"Login"),N(),ze(20,ng,2,1,"div",15),N(),M(21,"p",16),Y(22,"Forgot password? "),M(23,"a",17),Y(24,"Reset"),N()()()()()()),a&2&&(X(15),xn("ngModel",i.authRequest.email),X(2),xn("ngModel",i.authRequest.password),X(3),ue("ngIf",i.errorMessage),X(3),ue("routerLink",Zl(4,rg)))},dependencies:[Kt,rr,ur,or,Cn,sr,cr,co,vd]});let r=n;return r})();var vo=(()=>{let n=class n{constructor(t){this.http=t,this.baseUrl="http://20.49.205.136:3000/passwordreset"}request(t){let a=new Xs().set("email",t);return this.http.post(`${this.baseUrl}/request`,null,{params:a})}reset(t,a){let i=new Xs().set("token",t).set("password",a);return this.http.post(`${this.baseUrl}/reset`,null,{params:i})}};n.\u0275fac=function(a){return new(a||n)(Vt(ta))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();var Ud=(()=>{let n=class n{constructor(t,a){this.router=t,this.resetpasswordService=a,this.status="",this.formRequest=new na({email:new kr("",[Dr.required])})}sendmail(){this.formRequest.valid&&this.resetpasswordService.request(this.formRequest.value.email).subscribe({next:t=>{this.router.navigate(["/emailsended"])}}),this.router.navigate(["/emailsended"])}};n.\u0275fac=function(a){return new(a||n)(oe(Xt),oe(vo))},n.\u0275cmp=Ie({type:n,selectors:[["app-resetpassword"]],decls:18,vars:1,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","email","placeholder","Email","formControlName","email","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2),ee(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),N(),M(7,"div",5)(8,"div",6)(9,"div",7),ee(10,"i",8),N(),M(11,"form",9),me("ngSubmit",function(){return i.sendmail()}),M(12,"h3",7),Y(13,"Reset Password"),N(),M(14,"div",10),ee(15,"input",11),N(),M(16,"button",12),Y(17,"Reset Password"),N()()()()()()),a&2&&(X(11),ue("formGroup",i.formRequest))},dependencies:[ur,or,Cn,sr,cr,ra,aa]});let r=n;return r})();function ag(r,n){if(r&1&&(M(0,"div",15),Y(1),N()),r&2){let e=fe();X(),ot(" ",e.status," ")}}var Hd=(()=>{let n=class n{constructor(t,a,i){this.router=t,this.route=a,this.resetpasswordService=i,this.formRequest=new na({password:new kr("",[Dr.required]),confirmPassword:new kr("",[Dr.required])})}ngOnInit(){this.token=this.route.snapshot.queryParamMap.get("token")}resetpassword(){this.formRequest.valid&&this.token&&this.formRequest.value.password===this.formRequest.value.confirmPassword?this.resetpasswordService.reset(this.token,this.formRequest.value.password).subscribe({next:t=>{this.router.navigate(["/login"])}}):this.status="Verify passwords!"}};n.\u0275fac=function(a){return new(a||n)(oe(Xt),oe(fd),oe(vo))},n.\u0275cmp=Ie({type:n,selectors:[["app-newpassword"]],decls:21,vars:3,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","password","placeholder","New password","formControlName","password","name","password","required","",1,"form-control"],["type","password","placeholder","Confirm password","formControlName","confirmPassword","required","",1,"form-control"],["class","alert alert-danger","role","alert",4,"ngIf","ngIfIs"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2"],["role","alert",1,"alert","alert-danger"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2),ee(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),N(),M(7,"div",5)(8,"div",6)(9,"div",7),ee(10,"i",8),N(),M(11,"form",9),me("ngSubmit",function(){return i.resetpassword()}),M(12,"h3",7),Y(13,"Reset Password"),N(),M(14,"div",10),ee(15,"input",11),N(),M(16,"div",10),ee(17,"input",12),N(),ze(18,ag,2,1,"div",13),M(19,"button",14),Y(20,"Reset Password"),N()()()()()()),a&2&&(X(11),ue("formGroup",i.formRequest),X(7),ue("ngIf",i.status)("ngIfIs",i.undefind))},dependencies:[Kt,ur,or,Cn,sr,cr,ra,aa]});let r=n;return r})();var Gd=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=Ie({type:n,selectors:[["app-emailsended"]],decls:18,vars:0,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-mail","auth-icon"],[1,"input-group","mb-3"],["routerLink","/login",1,"btn","btn-primary","shadow-2","mb-4",2,"color","white"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2),ee(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),N(),M(7,"div",5)(8,"div",6)(9,"div",7),ee(10,"i",8),N(),M(11,"h3",7),Y(12,"Email is sent"),N(),ee(13,"div",9),M(14,"p",7),Y(15,"Please check your email!"),N(),M(16,"a",10),Y(17,"Login"),N()()()()())},dependencies:[rr]});let r=n;return r})();var cu=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=Ie({type:n,selectors:[["app-not-found"]],decls:18,vars:0,consts:[[1,"maintenance-block"],[1,"container"],[1,"row","justify-content-center"],[1,"col-md-8"],[1,"card","error-card"],[1,"card-body"],[1,"error-image-block"],["src","../assets/images/404.png","alt","img",1,"img-fluid"],[1,"text-center"],[1,"mt-3"],[1,"mt-2","mb-4","text-muted"],["type","button","href","/home",1,"btn","btn-primary","mb-3"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),ee(7,"img",7),N(),M(8,"div",8)(9,"h1",9)(10,"b"),Y(11,"Oops! Page not found!"),N()(),M(12,"p",10),Y(13," The page you are looking was moved, removed,"),ee(14,"br"),Y(15," renamed, or might never exist! "),N(),M(16,"a",11),Y(17,"Go to home"),N()()()()()()()())}});let r=n;return r})();var jd=(()=>{let n=class n{constructor(t,a){this.encryptionService=t,this.router=a}canActivate(t,a){return localStorage.getItem("token")?!0:(localStorage.clear(),this.router.navigate(["/login"]),!1)}};n.\u0275fac=function(a){return new(a||n)(Vt(ar),Vt(Xt))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function ig(r,n){r&1&&(M(0,"li",11)(1,"a",21)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Projects"),N()()())}function og(r,n){r&1&&(M(0,"li",11)(1,"a",22)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Tasks"),N()()())}function sg(r,n){r&1&&(M(0,"li",11)(1,"a",23)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Payroll"),N()()())}function ug(r,n){r&1&&(M(0,"li",11)(1,"a",24)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Payslip"),N()()())}function cg(r,n){r&1&&(M(0,"li",11)(1,"a",25)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Configuration"),N()()())}function lg(r,n){r&1&&(M(0,"li",11)(1,"a",26)(2,"span",13),ee(3,"i",14),N(),M(4,"span",15),Y(5,"Holiday"),N()()())}function dg(r,n){r&1&&(M(0,"li",31)(1,"a",32)(2,"span"),Y(3," \xA0 \xA0Employees"),N()()())}function pg(r,n){r&1&&(M(0,"li",31)(1,"a",33)(2,"span"),Y(3," \xA0 \xA0Add Employees"),N()()())}function hg(r,n){if(r&1){let e=an();M(0,"li",27),me("click",function(){Je(e);let a=fe();return Ze(a.toggleDropdownEmployee())}),M(1,"a",28)(2,"span",13),ee(3,"i",14),N(),Y(4," Employee Management "),N(),M(5,"ul",29),ze(6,dg,4,0,"li",30)(7,pg,4,0,"li",30),N()()}if(r&2){let e=fe();X(5),bn("display",e.EmployeeManagment?"block":"none"),X(),ue("ngIf",e.displayEmployeeList),X(),ue("ngIf",e.displayEmployeeAdd)}}function fg(r,n){r&1&&(M(0,"li",31)(1,"a",34)(2,"span"),Y(3," \xA0 \xA0Roles"),N()()())}function mg(r,n){r&1&&(M(0,"li",31)(1,"a",35)(2,"span"),Y(3," \xA0 \xA0Add Roles"),N()()())}function vg(r,n){if(r&1){let e=an();M(0,"li",27),me("click",function(){Je(e);let a=fe();return Ze(a.toggleDropdownRole())}),M(1,"a",28)(2,"span",13),ee(3,"i",14),N(),Y(4," Role Management "),N(),M(5,"ul",29),ze(6,fg,4,0,"li",30)(7,mg,4,0,"li",30),N()()}if(r&2){let e=fe();X(5),bn("display",e.roleManagment?"block":"none"),X(),ue("ngIf",e.displayRoleList),X(),ue("ngIf",e.displayRoleAdd)}}function gg(r,n){r&1&&(M(0,"li",31)(1,"a",36)(2,"span"),Y(3," \xA0 \xA0Attendance Sheet"),N()()())}function yg(r,n){r&1&&(M(0,"li",31)(1,"a",37)(2,"span"),Y(3," \xA0 \xA0Update Attendance"),N()()())}function bg(r,n){r&1&&(M(0,"li",31)(1,"a",38)(2,"span"),Y(3," \xA0 \xA0Create Attendance"),N()()())}function xg(r,n){if(r&1){let e=an();M(0,"li",27),me("click",function(){Je(e);let a=fe();return Ze(a.toggleDropdownAttendance())}),M(1,"a",28)(2,"span",13),ee(3,"i",14),N(),Y(4," Attendances Management "),N(),M(5,"ul",29),ze(6,gg,4,0,"li",30)(7,yg,4,0,"li",30)(8,bg,4,0,"li",30),N()()}if(r&2){let e=fe();X(5),bn("display",e.AttendanceManagment?"block":"none"),X(),ue("ngIf",e.displayAttendanceUpdate),X(),ue("ngIf",e.displayAttendanceAdd),X(),ue("ngIf",e.displayAttendanceCreate)}}var qd=(()=>{let n=class n{toggleDropdownRole(){this.roleManagment=!this.roleManagment}toggleDropdownEmployee(){this.EmployeeManagment=!this.EmployeeManagment}toggleDropdownAttendance(){this.AttendanceManagment=!this.AttendanceManagment}constructor(t){this.encryptionService=t,this.visibiliyRoleManagment=!1,this.roleManagment=!1,this.displayRoleList=!1,this.displayRoleAdd=!1,this.visibiliyEmployeeManagment=!1,this.EmployeeManagment=!1,this.displayEmployeeList=!1,this.displayEmployeeAdd=!1,this.visibiliyAttendanceManagment=!1,this.AttendanceManagment=!1,this.displayAttendanceList=!1,this.displayAttendanceAdd=!1,this.displayAttendanceUpdate=!1,this.displayAttendanceCreate=!1,this.visibiliyProjectManagment=!1,this.ProjectManagment=!1,this.displayProjectList=!1,this.visibiliyHolidayManagment=!1,this.visibiliyTaskManagment=!1,this.visibiliyConfigManagment=!1,this.visibiliyPayrollManagment=!1}ngOnInit(){let t=localStorage.getItem("authorities"),a=this.encryptionService.decrypt(t,"2f7");a.includes("PAYROLL")&&(this.visibiliyPayrollManagment=!0),a.includes("CONFIG")&&(this.visibiliyConfigManagment=!0),a.includes("PROJECT")&&(this.visibiliyProjectManagment=!0),a.includes("TASK")&&(this.visibiliyTaskManagment=!0),a.includes("HOLIDAY")&&(this.visibiliyHolidayManagment=!0),a.includes("ATTENDANCE")&&(this.visibiliyAttendanceManagment=!0),a.includes("READ::ATTENDANCE")&&(this.displayAttendanceList=!0),a.includes("ADD::ATTENDANCE")&&(this.displayAttendanceAdd=!0),a.includes("EDIT::ATTENDANCE")&&(this.displayAttendanceUpdate=!0),a.includes("CREATE::ATTENDANCE")&&(this.displayAttendanceCreate=!0),a.includes("ROLE")&&(this.visibiliyRoleManagment=!0),a.includes("READ::ROLE")&&(this.displayRoleList=!0),a.includes("ADD::ROLE")&&(this.displayRoleAdd=!0),a.includes("USER")&&(this.visibiliyEmployeeManagment=!0),a.includes("READ::USER")&&(this.displayEmployeeList=!0),a.includes("ADD::USER")&&(this.displayEmployeeAdd=!0)}getPrivileges(){}};n.\u0275fac=function(a){return new(a||n)(oe(ar))},n.\u0275cmp=Ie({type:n,selectors:[["app-sidebar"]],decls:34,vars:9,consts:[[1,"pcoded-navbar"],[1,"navbar-wrapper"],[1,"navbar-brand","header-logo"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-collapse","href","javascript:",1,"mobile-menu"],[1,"slimScrollDiv",2,"position","relative","overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"navbar-content","scroll-div",2,"overflow","hidden","width","100%","height","calc(-70px + 100vh)"],[1,"nav","pcoded-inner-navbar"],["data-username","Table bootstrap datatable footable",1,"nav-item"],["routerLink","/home",1,"nav-link"],[1,"pcoded-micon"],[1,"feather","icon-server"],[1,"pcoded-mtext"],[1,"nav-item","pcoded-menu-caption"],["data-username","Table bootstrap datatable footable","class","nav-item",4,"ngIf"],["class","nav-item pcoded-hasmenu",3,"click",4,"ngIf"],[1,"slimScrollBar",2,"background","rgba(0, 0, 0, 0.5)","width","5px","position","absolute","top","34px","opacity","0.4","display","none","border-radius","7px","z-index","99","right","1px","height","634.318px"],[1,"slimScrollRail",2,"width","5px","height","100%","position","absolute","top","0px","display","none","border-radius","7px","background","rgb(51, 51, 51)","opacity","0.2","z-index","90","right","1px"],["routerLink","projects",1,"nav-link"],["routerLink","tasks",1,"nav-link"],["routerLink","payroll",1,"nav-link"],["routerLink","payroll/payslip",1,"nav-link"],["routerLink","config",1,"nav-link"],["routerLink","holiday",1,"nav-link"],[1,"nav-item","pcoded-hasmenu",3,"click"],[1,"nav-item","dropdown-toggle"],[1,"nav-dropdown",2,"width","250px"],["class","nav-item",4,"ngIf"],[1,"nav-item"],["routerLink","users/",1,"nav-link"],["routerLink","users/add",1,"nav-link"],["routerLink","roles/",1,"nav-link"],["routerLink","roles/add",1,"nav-link"],["routerLink","attendance/updateAttendance",1,"nav-link"],["routerLink","attendance/addAttendance",1,"nav-link"],["routerLink","attendance/createAttendance",1,"nav-link"]],template:function(a,i){a&1&&(M(0,"nav",0)(1,"div",1)(2,"div",2)(3,"a",3)(4,"div",4),ee(5,"i",5),N(),M(6,"span",6),Y(7,"HRMS"),N()(),M(8,"a",7),ee(9,"span"),N()(),M(10,"div",8)(11,"div",9)(12,"ul",10)(13,"li",11)(14,"a",12)(15,"span",13),ee(16,"i",14),N(),M(17,"span",15),Y(18,"Home"),N()()(),M(19,"li",16)(20,"label"),Y(21,"Navigation"),N()(),ze(22,ig,6,0,"li",17)(23,og,6,0,"li",17)(24,sg,6,0,"li",17)(25,ug,6,0,"li",17)(26,cg,6,0,"li",17)(27,lg,6,0,"li",17)(28,hg,8,4,"li",18)(29,vg,8,4,"li",18)(30,xg,9,5,"li",18),N()(),ee(31,"div",19)(32,"div",20),N()()(),ee(33,"router-outlet")),a&2&&(X(22),ue("ngIf",i.visibiliyProjectManagment),X(),ue("ngIf",i.visibiliyTaskManagment),X(),ue("ngIf",i.visibiliyPayrollManagment),X(),ue("ngIf",i.visibiliyPayrollManagment),X(),ue("ngIf",i.visibiliyConfigManagment),X(),ue("ngIf",i.visibiliyHolidayManagment),X(),ue("ngIf",i.visibiliyEmployeeManagment),X(),ue("ngIf",i.visibiliyRoleManagment),X(),ue("ngIf",i.visibiliyAttendanceManagment))},dependencies:[Kt,uo,rr]});let r=n;return r})();var Yd=(()=>{let n=class n{constructor(t){this.http=t,this.URL="http://20.49.205.136:3000/notifications",this.httpOptions={headers:new sd({"Content-Type":"application/json"})}}createNotification(t){return this.http.post(this.URL,t,this.httpOptions)}readNotification(t){return this.http.patch(`${this.URL}/${t}/read`,null,this.httpOptions)}unreadNotification(t){return this.http.patch(`${this.URL}/${t}/unread`,null,this.httpOptions)}cancelNotification(t){return this.http.patch(`${this.URL}/${t}/cancel`,null,this.httpOptions)}getNotificationsByRecipientId(t){return this.http.get(`${this.URL}/from/recipient/${t}`,this.httpOptions)}getReadNotifications(){return this.http.get(`${this.URL}/read`,this.httpOptions)}readAllNotifications(){return this.http.patch(`${this.URL}/read-all`,null,this.httpOptions)}cancelAllNotifications(){return this.http.patch(`${this.URL}/cancel-all`,null,this.httpOptions)}};n.\u0275fac=function(a){return new(a||n)(Vt(ta))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function Cg(r,n){if(r&1){let e=an();M(0,"li",56)(1,"div",57)(2,"img",58),me("click",function(){Je(e);let a=fe(),i=a.$implicit,o=a.index,s=fe();return Ze(s.changeStatus(i.id,o))}),N(),M(3,"div",59),me("click",function(){Je(e);let a=fe(),i=a.$implicit,o=a.index,s=fe();return Ze(s.changeStatus(i.id,o))}),M(4,"p")(5,"strong"),Y(6),N(),M(7,"span",60),ee(8,"i",61),Y(9),N()(),M(10,"p"),Y(11),N()(),M(12,"div",62)(13,"a",63),me("click",function(){Je(e);let a=fe().$implicit,i=fe();return Ze(i.deleteNotification(a.id))}),ee(14,"i",64),N()()()()}if(r&2){let e=fe(),t=e.index,a=e.$implicit,i=fe();bn("background-color",i.readStatus[t]?"white":"greenyellow"),X(6),vt(a.category),X(3),vt(i.getTimeDifference(a.createdAt)),X(2),vt(a.content)}}function Eg(r,n){if(r&1&&(M(0,"div"),ze(1,Cg,15,5,"li",55),N()),r&2){let e=n.$implicit;X(),ue("ngIf",!e.canceledAt)}}var Dg=r=>({show:r}),Kd=(()=>{let n=class n{getSettings(){this.userService.getSettings(this.email).subscribe(t=>{this.smsEnabled=t.smsEnabled,this.emailEnabled=t.emailEnabled},t=>{})}toggleSMS(){this.smsEnabled&&(this.emailEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(t=>{this.smsEnabled=t.smsEnabled,this.emailEnabled=t.emailEnabled},t=>{})),this.smsEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(t=>{this.smsEnabled=t.smsEnabled,this.emailEnabled=t.emailEnabled},t=>{})}toggleEmail(){this.emailEnabled&&(this.smsEnabled=!1,this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(t=>{this.smsEnabled=t.smsEnabled,this.emailEnabled=t.emailEnabled},t=>{})),this.emailEnabled||this.userService.setSettings(this.email,{smsEnabled:this.smsEnabled,emailEnabled:this.emailEnabled}).subscribe(t=>{this.smsEnabled=t.smsEnabled,this.emailEnabled=t.emailEnabled},t=>{})}constructor(t,a,i,o,s,u){this.router=t,this.notificationsService=a,this.payrollService=i,this.datePipe=o,this.authService=s,this.userService=u,this.user="",this.data=[],this.readStatus=[],this.isDropdownOpen=!1}ngOnInit(){return nn(this,null,function*(){let t=yield localStorage.getItem("user");if(t){let a=JSON.parse(t);this.user=a.firstname+" "+a.lastname,this.payrollService.getUserIdByEmail(a.email).subscribe(i=>{this.id=i.id}),this.email=a.email}this.getSettings(),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(a=>{this.data=a.reverse(),this.readStatus=a.map(i=>i.readAt!=null)}),this.notificationsService.getNotificationsByRecipientId(this.id).subscribe(a=>{})})}stopPropagation(t){t.stopPropagation()}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.ngOnInit()}logout(){this.authService.logout().subscribe(()=>{localStorage.clear(),this.router.navigate(["login"])},t=>{}),localStorage.clear(),this.router.navigate(["login"])}changeStatus(t,a){this.readStatus[a]?this.notificationsService.unreadNotification(t).subscribe(i=>{}):this.notificationsService.readNotification(t).subscribe(i=>{}),this.readStatus[a]=!this.readStatus[a]}deleteNotification(t){this.notificationsService.cancelNotification(t).subscribe(a=>{a&&this.ngOnInit()})}clearAll(){this.notificationsService.cancelAllNotifications().subscribe(t=>{t&&this.ngOnInit()})}getTimeDifference(t){let a=new Date;if(t){let i=new Date(t),o=a.getTime()-i.getTime(),s=Math.floor(o/(1e3*60)),u=this.datePipe.transform(new Date(0,0,0,0,s),s<=59?"mm":"HH"),c=u.startsWith("0")?u.substring(1):u;return s<=59?c+" minutes ago":c+" hours ago"}else return null}markAllAsRead(){this.notificationsService.readAllNotifications().subscribe(t=>{t&&this.ngOnInit()})}deleteAll(){this.notificationsService.cancelAllNotifications().subscribe(t=>{t&&this.ngOnInit()})}approveNotification(){}disapproveNotification(){}};n.\u0275fac=function(a){return new(a||n)(oe(Xt),oe(Yd),oe(yd),oe(oo),oe(ia),oe(ir))},n.\u0275cmp=Ie({type:n,selectors:[["app-navbar"]],decls:87,vars:7,consts:[[1,"navbar","pcoded-header","navbar-expand-lg","navbar-light"],[1,"m-header"],["id","mobile-collapse1","href","javascript:",1,"mobile-menu"],["href","index.html",1,"b-brand"],[1,"b-bg"],[1,"feather","icon-trending-up"],[1,"b-title"],["id","mobile-header","href","javascript:",1,"mobile-menu"],[1,"feather","icon-more-horizontal"],[1,"collapse","navbar-collapse"],[1,"navbar-nav","mr-auto"],["href","javascript:","onclick","javascript:toggleFullScreen()",1,"full-screen"],[1,"feather","icon-maximize"],[1,"nav-item","dropdown"],["href","javascript:","data-toggle","dropdown",1,"dropdown-toggle"],[1,"dropdown-menu"],["href","javascript:",1,"dropdown-item"],[1,"nav-item"],[1,"main-search"],[1,"input-group"],["type","text","id","m-search","placeholder","Search . . .",1,"form-control"],["href","javascript:",1,"input-group-append","search-close"],[1,"feather","icon-x","input-group-text"],[1,"input-group-append","search-btn","btn","btn-primary"],[1,"feather","icon-search","input-group-text"],[1,"navbar-nav","ml-auto"],[1,"dropdown"],["href","javascript:void(0);",1,"dropdown-toggle",3,"click"],[1,"icon","feather","icon-bell"],[1,"dropdown-menu","dropdown-menu-right","notification",3,"ngClass"],[1,"noti-head"],[1,"d-inline-block","m-b-0"],[1,"float-right"],["href","javascript:void(0);",1,"m-r-10",3,"click"],["href","javascript:void(0);",3,"click"],[1,"noti-body"],[4,"ngFor","ngForOf"],[1,"dropdown","drp-user"],[1,"icon","feather","icon-settings"],[1,"dropdown-menu","dropdown-menu-right","profile-notification"],[1,"pro-head"],["src","assets/images/user/avatar-1.jpg","alt","User-Profile-Image",1,"img-radius"],["title","Logout",1,"dud-logout",3,"click"],[1,"feather","icon-log-out"],[1,"pro-body"],["routerLink","profile",1,"dropdown-item"],[1,"feather","icon-user"],["href","",1,"dropdown-item"],[1,"feather","icon-mail"],[1,"dropdown-item"],[1,"feather","icon-settings"],["type","checkbox","id","smsToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],["type","checkbox","id","emailToggle",1,"form-check-input",3,"ngModel","ngModelChange","change"],[1,"dropdown-item",3,"click"],[1,"feather","icon-lock"],["class","notification",3,"background-color",4,"ngIf"],[1,"notification"],[1,"media"],["src","assets/images/user/avatar-1.jpg","alt","Generic placeholder image",1,"img-radius",3,"click"],[1,"media-body",3,"click"],[1,"n-time","text-muted"],[1,"icon","feather","icon-clock","m-r-10"],[1,"trash-icon"],["href","javascript:void(0);",1,"delete-btn",3,"click"],[1,"feather","icon-trash"]],template:function(a,i){a&1&&(M(0,"header",0)(1,"div",1)(2,"a",2),ee(3,"span"),N(),M(4,"a",3)(5,"div",4),ee(6,"i",5),N(),M(7,"span",6),Y(8,"Foyer"),N()()(),M(9,"a",7),ee(10,"i",8),N(),M(11,"div",9)(12,"ul",10)(13,"li")(14,"a",11),ee(15,"i",12),N()(),M(16,"li",13)(17,"a",14),Y(18,"Dropdown"),N(),M(19,"ul",15)(20,"li")(21,"a",16),Y(22,"Action"),N()(),M(23,"li")(24,"a",16),Y(25,"Another action"),N()(),M(26,"li")(27,"a",16),Y(28,"Something else here"),N()()()(),M(29,"li",17)(30,"div",18)(31,"div",19),ee(32,"input",20),M(33,"a",21),ee(34,"i",22),N(),M(35,"span",23),ee(36,"i",24),N()()()()(),M(37,"ul",25)(38,"li")(39,"div",26)(40,"a",27),me("click",function(){return i.toggleDropdown()}),ee(41,"i",28),N(),M(42,"div",29)(43,"div",30)(44,"h6",31),Y(45,"Notifications"),N(),M(46,"div",32)(47,"a",33),me("click",function(){return i.markAllAsRead()}),Y(48,"mark as read"),N(),M(49,"a",34),me("click",function(){return i.deleteAll()}),Y(50,"clear all"),N()()(),M(51,"ul",35),ze(52,Eg,2,1,"div",36),N()()()(),M(53,"li")(54,"div",37)(55,"a",14),ee(56,"i",38),N(),M(57,"div",39)(58,"div",40),ee(59,"img",41),M(60,"span"),Y(61),N(),M(62,"a",42),me("click",function(){return i.logout()}),ee(63,"i",43),N()(),M(64,"ul",44)(65,"li")(66,"a",45),ee(67,"i",46),Y(68," Profile"),N()(),M(69,"li")(70,"a",47),ee(71,"i",48),Y(72," My Messages"),N()(),M(73,"li")(74,"a",49),ee(75,"i",50),Y(76," 2FA with SMS\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),M(77,"input",51),wn("ngModelChange",function(s){return _n(i.smsEnabled,s)||(i.smsEnabled=s),s}),me("change",function(){return i.toggleSMS()}),N()()(),M(78,"li")(79,"a",49),ee(80,"i",50),Y(81," 2FA with Email\xA0\xA0\xA0\xA0\xA0\xA0\xA0 "),M(82,"input",52),wn("ngModelChange",function(s){return _n(i.emailEnabled,s)||(i.emailEnabled=s),s}),me("change",function(){return i.toggleEmail()}),N()()(),M(83,"li")(84,"a",53),me("click",function(){return i.logout()}),ee(85,"i",54),Y(86," Logout"),N()()()()()()()()()),a&2&&(X(42),ue("ngClass",ed(5,Dg,i.isDropdownOpen)),X(10),ue("ngForOf",i.data),X(9),vt(i.user),X(16),xn("ngModel",i.smsEnabled),X(5),xn("ngModel",i.emailEnabled))},dependencies:[io,ad,Kt,rr,md,Cn,co],styles:[".notification[_ngcontent-%COMP%]{position:relative;padding:15px}.media[_ngcontent-%COMP%]{display:flex;align-items:center}.media-body[_ngcontent-%COMP%]{flex:1}.trash-icon[_ngcontent-%COMP%]{margin-left:auto}.delete-btn[_ngcontent-%COMP%]{color:red}"]});let r=n;return r})();var Xd=(()=>{let n=class n{constructor(){}ngOnInit(){}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=Ie({type:n,selectors:[["app-home"]],decls:2,vars:0,template:function(a,i){a&1&&ee(0,"app-navbar")(1,"app-sidebar")},dependencies:[qd,Kd]});let r=n;return r})();var Op=function(r,n){return(Op=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(r,n)};function ln(r,n){function e(){this.constructor=r}Op(r,n),r.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}function re(r,n,e,t){return new(e||(e=Promise))(function(a,i){function o(c){try{u(t.next(c))}catch(l){i(l)}}function s(c){try{u(t.throw(c))}catch(l){i(l)}}function u(c){c.done?a(c.value):new e(function(l){l(c.value)}).then(o,s)}u((t=t.apply(r,n||[])).next())})}function ae(r,n){var e,t,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,t&&(a=2&l[0]?t.return:l[0]?t.throw||((a=t.return)&&a.call(t),0):t.next)&&!(a=a.call(t,l[1])).done)return a;switch(t=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,t=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){o=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(l[0]===6&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=n.call(r,o)}catch(d){l=[6,d],t=0}finally{e=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var Sg=function(){function r(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(n,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=n,this.platform=e},r.prototype.registerFlag=function(n,e,t){if(this.flagRegistry[n]={evaluationFn:e,setHook:t},this.urlFlags[n]!=null){var a=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+a+"."),this.set(n,a)}},r.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},r.prototype.getNumber=function(n){return this.get(n)},r.prototype.getBool=function(n){return this.get(n)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(n,e){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)},r.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},r.prototype.setFlags=function(n){this.flags=Object.assign({},n)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,t,a=(e=this.global.location.search,t={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];return Ag(t,o[0],o[1]),o.join("=")}),t);"tfjsflags"in a&&a.tfjsflags.split(",").forEach(function(i){var o=i.split(":"),s=o[0],u=o[1];n.urlFlags[s]=function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,u)})}},r}();function Ag(r,n,e){r[decodeURIComponent(n)]=decodeURIComponent(e||"")}function B(){return Bp}var Bp=null,Mo=new Map,Tu=new Map;function Lp(r,n){var e=Wp(r,n);return Mo.get(e)}function Ig(r){return Tu.get(r)}function Zd(r){for(var n=Mo.entries(),e=[];;){var t=n.next(),a=t.done,i=t.value;if(a)break;var o=i[0],s=i[1];o.split("_")[0]===r&&e.push(s)}return e}function Vp(r){var n=r.kernelName,e=r.backendName,t=Wp(n,e);if(Mo.has(t))throw new Error("The kernel '"+n+"' for backend '"+e+"' is already registered");Mo.set(t,r)}function Rg(r){var n=r.kernelName;Tu.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),Tu.set(n,r)}function Wp(r,n){return n+"_"+r}function ep(r){for(var n=r.length,e=0,t=0;n>0;)t=Math.random()*n|0,e=r[--n],r[n]=r[t],r[t]=e}function No(r,n,e){return Math.max(r,Math.min(n,e))}function Ju(r){return r%2==0?r:r+1}function zp(r){for(var n=0,e=0;e<r.length;e++)n+=r[e];return n}function E(r,n){if(!r)throw new Error(typeof n=="string"?n:n())}function Re(r,n,e){e===void 0&&(e=""),E(nt(r,n),function(){return e+" Shapes "+r+" and "+n+" must match"})}function Vr(r){E(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function zn(r,n,e){if(n===void 0&&(n=[]),e===void 0&&(e=!1),n==null&&(n=[]),Array.isArray(r)||bt(r)&&!e)for(var t=0;t<r.length;++t)zn(r[t],n,e);else n.push(r);return n}function ie(r){if(r.length===0)return 1;for(var n=r[0],e=1;e<r.length;e++)n*=r[e];return n}function nt(r,n){if(r===n)return!0;if(r==null||n==null||r.length!==n.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}function Ye(r){return r%1==0}function Up(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var n=Math.exp(2*r);return(n-1)/(n+1)}function Po(r){var n=Math.ceil(Math.sqrt(r));return[n,Math.ceil(r/n)]}function Mr(r,n){return n<=r.length?r:r+" ".repeat(n-r.length)}function Fu(r,n,e){return n===void 0&&(n=function(t){return 0}),new Promise(function(t,a){var i=0,o=function(){if(r())t();else{i++;var s=n(i);e!=null&&i>=e?a():setTimeout(o,s)}};o()})}function Hp(r,n){for(var e=1,t=-1,a=0;a<r.length;++a)if(r[a]>=0)e*=r[a];else if(r[a]===-1){if(t!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+t+" and dim "+a);t=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(t===-1){if(n>0&&n!==e)throw Error("Size("+n+") must match the product of shape "+r);return r}if(e===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(n%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+e);var i=r.slice();return i[t]=n/e,i}function at(r,n){var e=n.length;return E((r=r==null?n.map(function(t,a){return a}):[].concat(r)).every(function(t){return t>=-e&&t<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+r}),E(r.every(function(t){return Ye(t)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(t){return t<0?e+t:t})}function pr(r,n){for(var e=[],t=[],a=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||a?null:at(n,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(e.push(r[s]),t.push(s)),i[o]<=s&&o++}r[s]!==1&&(e.push(r[s]),t.push(s))}return{newShape:e,keptDims:t}}function ya(r,n){var e=null;if(r==null||r==="float32")e=new Float32Array(n);else if(r==="int32")e=new Int32Array(n);else{if(r!=="bool")throw new Error("Unknown data type "+r);e=new Uint8Array(n)}return e}function di(r,n){var e=null;if(r==null||r==="float32")e=new Float32Array(n);else if(r==="int32")e=new Int32Array(n);else if(r==="bool")e=new Uint8Array(n);else{if(r!=="string")throw new Error("Unknown data type "+r);e=new Array(n)}return e}function Gp(r,n){for(var e=0;e<r.length;e++){var t=r[e];if(isNaN(t)||!isFinite(t))throw Error("A tensor of type "+n+" being uploaded contains "+t+".")}}function jp(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function qp(r,n){return n!=="complex64"&&(n!=="float32"||r==="complex64")&&(n!=="int32"||r==="float32"||r==="complex64")&&(n!=="bool"||r!=="bool")}function bt(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function Zu(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Yp(r){if(r==null)return 0;var n=0;return r.forEach(function(e){return n+=e.length}),n}function hr(r){return typeof r=="string"||r instanceof String}function Kp(r){return typeof r=="boolean"}function Xp(r){return typeof r=="number"}function xa(r){return Array.isArray(r)?xa(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Xp(r)?"float32":hr(r)?"string":Kp(r)?"bool":"float32"}function Oo(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Bo(r,n){for(var e=n;e<r;++e)if(r%e==0)return e;return r}function un(r){var n=r.length;if(n<2)return[];var e=new Array(n-1);e[n-2]=r[n-1];for(var t=n-3;t>=0;--t)e[t]=e[t+1]*r[t+1];return e}function ec(r,n,e){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=zn(r)),e&&Gp(r,n),function(i,o){return i instanceof Float32Array&&o==="float32"||i instanceof Int32Array&&o==="int32"||i instanceof Uint8Array&&o==="bool"}(r,n))return r;if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool"){for(var t=new Uint8Array(r.length),a=0;a<t.length;++a)Math.round(r[a])!==0&&(t[a]=1);return t}throw new Error("Unknown data type "+n)}function Mu(r,n){if(r.length===0)return n[0];var e=r.reduce(function(t,a){return t*a});if(e===0)return[];if(e!==n.length)throw new Error("["+r+"] does not match the input size.");return function t(a,i,o){var s=new Array;if(i.length===1)for(var u=i[0],c=0;c<u;c++)s[c]=o[a+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(p,h){return p*h});for(c=0;c<u;c++)s[c]=t(a+c*d,l,o)}return s}(0,r,n)}function tc(r,n){for(var e=_a(r,n),t=0;t<e.length;t++)e[t]=1;return e}function _a(r,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+n)}function sn(){return B().platform.now()}function nc(r){r.forEach(function(n){E(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function $p(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",B().platform.encode(r,n)}function pi(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",B().platform.decode(r,n)}function Nu(r,n,e){if(n===0)return 0;if(n===1)return r[0];for(var t=r[r.length-1],a=0;a<r.length-1;++a)t+=e[a]*r[a];return t}function Qp(r,n,e){if(n===0)return[];if(n===1)return[r];for(var t=new Array(n),a=0;a<t.length-1;++a)t[a]=Math.floor(r/e[a]),r-=t[a]*e[a];return t[t.length-1]=r,t}var ww=Object.freeze({shuffle:ep,clamp:No,nearestLargerEven:Ju,sum:zp,randUniform:function(r,n){var e=Math.random();return n*e+(1-e)*r},distSquared:function(r,n){for(var e=0,t=0;t<r.length;t++){var a=Number(r[t])-Number(n[t]);e+=a*a}return e},assert:E,assertShapesMatch:Re,assertNonNull:Vr,flatten:zn,sizeFromShape:ie,isScalarShape:function(r){return r.length===0},arraysEqual:nt,isInt:Ye,tanh:Up,sizeToSquarishShape:Po,createShuffledIndices:function(r){for(var n=new Uint32Array(r),e=0;e<r;++e)n[e]=e;return ep(n),n},rightPad:Mr,repeatedTry:Fu,inferFromImplicitShape:Hp,parseAxisParam:at,squeezeShape:pr,getTypedArrayFromDType:ya,getArrayFromDType:di,checkConversionForErrors:Gp,isValidDtype:jp,hasEncodingLoss:qp,isTypedArray:bt,bytesPerElement:Zu,bytesFromStringArray:Yp,isString:hr,isBoolean:Kp,isNumber:Xp,inferDtype:xa,isFunction:Oo,nearestDivisor:Bo,computeStrides:un,toTypedArray:ec,toNestedArray:Mu,makeOnesTypedArray:tc,makeZerosTypedArray:_a,now:sn,assertNonNegativeIntegerDimensions:nc,fetch:function(r,n){return B().platform.fetch(r,n)},encodeString:$p,decodeString:pi,locToIndex:Nu,indexToLoc:Qp}),Tg=function(){function r(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new Fg)}return r.prototype.profileKernel=function(n,e,t){var a,i=this,o=this.backendTimer.time(function(){a=t()});return a.forEach(function(s){s.data().then(function(u){(function(c,l,d){if(l!=="float32")return!1;for(var p=0;p<c.length;p++){var h=c[p];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,n),o.then(function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,e,l)})})}),a},r}(),Fg=function(){function r(){}return r.prototype.logKernelProfile=function(n,e,t,a,i,o){var s=typeof a=="number"?Mr(a+"ms",9):a.error,u=Mr(n,25),c=e.rank,l=e.size,d=Mr(e.shape.toString(),14),p="";for(var h in i){var f=i[h].shape||e.shape,v=f.length;p+=h+": "+v+"D "+(v>0?f:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+d+"	%c"+l+"	%c"+p+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}(),tp=20,ni=3,lu=7;function Mg(r,n,e,t){var a=un(n),i=function(c,l,d,p){var h=ie(l),f=p[p.length-1],v=new Array(f).fill(0),m=l.length,g=d==="complex64"?ai(c):c;if(m>1)for(var b=0;b<h/f;b++)for(var x=b*f,y=0;y<f;y++)v[y]=Math.max(v[y],ri(g[x+y],0,d).length);return v}(r,n,e,a),o=n.length,s=function c(l,d,p,h,f,v){v===void 0&&(v=!0);var m=p==="complex64"?2:1,g=d[0],b=d.length;if(b===0)return p==="complex64"?[ri(ai(l)[0],0,p)]:p==="bool"?[Jp(l[0])]:[l[0].toString()];if(b===1){if(g>tp){var x=ni*m,y=Array.from(l.slice(0,x)),_=Array.from(l.slice((g-ni)*m,g*m));return p==="complex64"&&(y=ai(y),_=ai(_)),["["+y.map(function(V,H){return ri(V,f[H],p)}).join(", ")+", ..., "+_.map(function(V,H){return ri(V,f[g-ni+H],p)}).join(", ")+"]"]}return["["+(p==="complex64"?ai(l):Array.from(l)).map(function(V,H){return ri(V,f[H],p)}).join(", ")+"]"]}var w=d.slice(1),A=h.slice(1),S=h[0]*m,D=[];if(g>tp){for(var k=0;k<ni;k++){var F=(T=k*S)+S;D.push.apply(D,c(l.slice(T,F),w,p,A,f,!1))}for(D.push("..."),k=g-ni;k<g;k++)F=(T=k*S)+S,D.push.apply(D,c(l.slice(T,F),w,p,A,f,k===g-1))}else for(k=0;k<g;k++){var T;F=(T=k*S)+S,D.push.apply(D,c(l.slice(T,F),w,p,A,f,k===g-1))}var W=b===2?",":"";for(D[0]="["+D[0]+W,k=1;k<D.length-1;k++)D[k]=" "+D[k]+W;var L=`,
`;for(k=2;k<b;k++)L+=`
`;return D[D.length-1]=" "+D[D.length-1]+"]"+(v?"":L),D}(r,n,e,a,i),u=["Tensor"];return t&&(u.push("  dtype: "+e),u.push("  rank: "+o),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ri(r,n,e){return Mr(Array.isArray(r)?parseFloat(r[0].toFixed(lu))+" + "+parseFloat(r[1].toFixed(lu))+"j":hr(r)?"'"+r+"'":e==="bool"?Jp(r):parseFloat(r.toFixed(lu)).toString(),n)}function Jp(r){return r===0?"false":"true"}function ai(r){for(var n=[],e=0;e<r.length;e+=2)n.push([r[e],r[e+1]]);return n}var hi=function(){function r(n,e,t){var a=this;if(this.dtype=e,this.shape=n.slice(),this.size=ie(n),t!=null){var i=t.length;E(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+a.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=t||di(e,this.size),this.strides=un(n)}return r.prototype.set=function(n){for(var e=this,t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];t.length===0&&(t=[0]),E(t.length===this.rank,function(){return"The number of provided coordinates ("+t.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(t);this.values[i]=n},r.prototype.get=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];n.length===0&&(n=[0]);for(var t=0,a=0,i=n;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[t]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}t++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},r.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var e=n[n.length-1],t=0;t<n.length-1;++t)e+=this.strides[t]*n[t];return e},r.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var e=new Array(this.shape.length),t=0;t<e.length-1;++t)e[t]=Math.floor(n/this.strides[t]),n-=e[t]*this.strides[t];return e[e.length-1]=n,e},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return Dn().makeTensor(this.values,this.shape,this.dtype)},r}(),Dn=null,O=null,Zp=null,Pe=function(){function r(n,e,t,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=ie(n),this.strides=un(n),this.dataId=t,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(n,e){return this.throwIfDisposed(),this.reshape([n,e])},r.prototype.as3D=function(n,e,t){return this.throwIfDisposed(),this.reshape([n,e,t])},r.prototype.as4D=function(n,e,t,a){return this.throwIfDisposed(),this.reshape([n,e,t,a])},r.prototype.as5D=function(n,e,t,a,i){return this.throwIfDisposed(),this.reshape([n,e,t,a,i])},r.prototype.asType=function(n){return this.throwIfDisposed(),O.cast(this,n)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return re(this,void 0,void 0,function(){var n;return ae(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,O.buffer(this.shape,this.dtype,n)]}})})},r.prototype.bufferSync=function(){return O.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return re(this,void 0,void 0,function(){var n;return ae(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return n=e.sent(),[2,Mu(this.shape,n)]}})})},r.prototype.arraySync=function(){return Mu(this.shape,this.dataSync())},r.prototype.data=function(){return re(this,void 0,void 0,function(){var n,e;return ae(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),n=Dn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:e=t.sent();try{return[2,e.map(function(a){return pi(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}t.label=2;case 2:return[2,n]}})})},r.prototype.dataSync=function(){this.throwIfDisposed();var n=Dn().readSync(this.dataId);if(this.dtype==="string")try{return n.map(function(e){return pi(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},r.prototype.bytes=function(){return re(this,void 0,void 0,function(){var n;return ae(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,Dn().read(this.dataId)];case 1:return n=e.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(Dn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(n){return n===void 0&&(n=!1),O.print(this,n)},r.prototype.reshape=function(n){return this.throwIfDisposed(),O.reshape(this,n)},r.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},r.prototype.expandDims=function(n){return n===void 0&&(n=0),O.expandDims(this,n)},r.prototype.cumsum=function(n,e,t){return n===void 0&&(n=0),e===void 0&&(e=!1),t===void 0&&(t=!1),O.cumsum(this,n,e,t)},r.prototype.squeeze=function(n){return this.throwIfDisposed(),O.squeeze(this,n)},r.prototype.clone=function(){return this.throwIfDisposed(),O.clone(this)},r.prototype.oneHot=function(n,e,t){return this.throwIfDisposed(),O.oneHot(this,n,e,t)},r.prototype.toString=function(n){return n===void 0&&(n=!1),Mg(this.dataSync(),this.shape,this.dtype,n)},r.prototype.tile=function(n){return this.throwIfDisposed(),O.tile(this,n)},r.prototype.gather=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),O.gather(this,n,e)},r.prototype.matMul=function(n,e,t){return e===void 0&&(e=!1),t===void 0&&(t=!1),this.throwIfDisposed(),O.matMul(this,n,e,t)},r.prototype.dot=function(n){return this.throwIfDisposed(),O.dot(this,n)},r.prototype.norm=function(n,e,t){return n===void 0&&(n="euclidean"),e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),O.norm(this,n,e,t)},r.prototype.slice=function(n,e){return this.throwIfDisposed(),O.slice(this,n,e)},r.prototype.reverse=function(n){return this.throwIfDisposed(),O.reverse(this,n)},r.prototype.concat=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),n instanceof r&&(n=[n]),O.concat([this].concat(n),e)},r.prototype.split=function(n,e){return e===void 0&&(e=0),this.throwIfDisposed(),O.split(this,n,e)},r.prototype.stack=function(n,e){return e===void 0&&(e=0),O.stack([this,n],e)},r.prototype.unstack=function(n){return n===void 0&&(n=0),O.unstack(this,n)},r.prototype.pad=function(n,e){return e===void 0&&(e=0),O.pad(this,n,e)},r.prototype.batchNormalization=function(n,e,t,a,i){return t===void 0&&(t=.001),Zp("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,e,i,a,t)},r.prototype.batchNorm=function(n,e,t,a,i){return i===void 0&&(i=.001),this.throwIfDisposed(),O.batchNorm(this,n,e,t,a,i)},r.prototype.all=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.all(this,n,e)},r.prototype.any=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.any(this,n,e)},r.prototype.logSumExp=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.logSumExp(this,n,e)},r.prototype.sum=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.sum(this,n,e)},r.prototype.prod=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.prod(this,n,e)},r.prototype.mean=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.mean(this,n,e)},r.prototype.min=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.min(this,n,e)},r.prototype.max=function(n,e){return n===void 0&&(n=null),e===void 0&&(e=!1),this.throwIfDisposed(),O.max(this,n,e)},r.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),O.argMin(this,n)},r.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),O.argMax(this,n)},r.prototype.cast=function(n){return this.throwIfDisposed(),O.cast(this,n)},r.prototype.add=function(n){return this.throwIfDisposed(),O.add(this,n)},r.prototype.addStrict=function(n){return this.throwIfDisposed(),O.addStrict(this,n)},r.prototype.atan2=function(n){return this.throwIfDisposed(),O.atan2(this,n)},r.prototype.sub=function(n){return this.throwIfDisposed(),O.sub(this,n)},r.prototype.subStrict=function(n){return this.throwIfDisposed(),O.subStrict(this,n)},r.prototype.pow=function(n){return this.throwIfDisposed(),O.pow(this,n)},r.prototype.powStrict=function(n){return this.throwIfDisposed(),O.powStrict(this,n)},r.prototype.mul=function(n){return this.throwIfDisposed(),O.mul(this,n)},r.prototype.mulStrict=function(n){return this.throwIfDisposed(),O.mulStrict(this,n)},r.prototype.div=function(n){return this.throwIfDisposed(),O.div(this,n)},r.prototype.divNoNan=function(n){return this.throwIfDisposed(),O.divNoNan(this,n)},r.prototype.floorDiv=function(n){return this.throwIfDisposed(),O.floorDiv(this,n)},r.prototype.divStrict=function(n){return this.throwIfDisposed(),O.divStrict(this,n)},r.prototype.minimum=function(n){return this.throwIfDisposed(),O.minimum(this,n)},r.prototype.minimumStrict=function(n){return this.throwIfDisposed(),O.minimumStrict(this,n)},r.prototype.maximum=function(n){return this.throwIfDisposed(),O.maximum(this,n)},r.prototype.maximumStrict=function(n){return this.throwIfDisposed(),O.maximumStrict(this,n)},r.prototype.mod=function(n){return this.throwIfDisposed(),O.mod(this,n)},r.prototype.modStrict=function(n){return this.throwIfDisposed(),O.modStrict(this,n)},r.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),O.squaredDifferenceStrict(this,n)},r.prototype.transpose=function(n){return this.throwIfDisposed(),O.transpose(this,n)},r.prototype.notEqual=function(n){return this.throwIfDisposed(),O.notEqual(this,n)},r.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),O.notEqualStrict(this,n)},r.prototype.less=function(n){return this.throwIfDisposed(),O.less(this,n)},r.prototype.lessStrict=function(n){return this.throwIfDisposed(),O.lessStrict(this,n)},r.prototype.equal=function(n){return this.throwIfDisposed(),O.equal(this,n)},r.prototype.equalStrict=function(n){return this.throwIfDisposed(),O.equalStrict(this,n)},r.prototype.lessEqual=function(n){return this.throwIfDisposed(),O.lessEqual(this,n)},r.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),O.lessEqualStrict(this,n)},r.prototype.greater=function(n){return this.throwIfDisposed(),O.greater(this,n)},r.prototype.greaterStrict=function(n){return this.throwIfDisposed(),O.greaterStrict(this,n)},r.prototype.greaterEqual=function(n){return this.throwIfDisposed(),O.greaterEqual(this,n)},r.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),O.greaterEqualStrict(this,n)},r.prototype.logicalAnd=function(n){return this.throwIfDisposed(),O.logicalAnd(this,n)},r.prototype.logicalOr=function(n){return this.throwIfDisposed(),O.logicalOr(this,n)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),O.logicalNot(this)},r.prototype.logicalXor=function(n){return this.throwIfDisposed(),O.logicalXor(this,n)},r.prototype.where=function(n,e){return this.throwIfDisposed(),O.where(n,this,e)},r.prototype.neg=function(){return this.throwIfDisposed(),O.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),O.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),O.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),O.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),O.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),O.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),O.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),O.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),O.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),O.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),O.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),O.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),O.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),O.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),O.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),O.abs(this)},r.prototype.clipByValue=function(n,e){return this.throwIfDisposed(),O.clipByValue(this,n,e)},r.prototype.relu=function(){return this.throwIfDisposed(),O.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),O.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),O.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),O.selu(this)},r.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),O.leakyRelu(this,n)},r.prototype.prelu=function(n){return this.throwIfDisposed(),O.prelu(this,n)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),O.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),O.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),O.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),O.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),O.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),O.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),O.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),O.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),O.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),O.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),O.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),O.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),O.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),O.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),O.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),O.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),O.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),O.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),O.round(this)},r.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),O.step(this,n)},r.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),O.softmax(this,n)},r.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),O.logSoftmax(this,n)},r.prototype.resizeBilinear=function(n,e){return e===void 0&&(e=!1),this.throwIfDisposed(),O.image.resizeBilinear(this,n,e)},r.prototype.resizeNearestNeighbor=function(n,e){return e===void 0&&(e=!1),this.throwIfDisposed(),O.image.resizeNearestNeighbor(this,n,e)},r.prototype.conv1d=function(n,e,t,a,i,o){return a===void 0&&(a="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),O.conv1d(this,n,e,t,a,i,o)},r.prototype.conv2d=function(n,e,t,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),O.conv2d(this,n,e,t,a,i,o)},r.prototype.conv2dTranspose=function(n,e,t,a,i){return this.throwIfDisposed(),O.conv2dTranspose(this,n,e,t,a,i)},r.prototype.depthwiseConv2D=function(n,e,t,a,i,o){return a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),O.depthwiseConv2d(this,n,e,t,a,i,o)},r.prototype.separableConv2d=function(n,e,t,a,i,o){return i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),O.separableConv2d(this,n,e,t,a,i,o)},r.prototype.avgPool=function(n,e,t,a){return this.throwIfDisposed(),O.avgPool(this,n,e,t,a)},r.prototype.maxPool=function(n,e,t,a){return this.throwIfDisposed(),O.maxPool(this,n,e,t,a)},r.prototype.localResponseNormalization=function(n,e,t,a){return n===void 0&&(n=5),e===void 0&&(e=1),t===void 0&&(t=1),a===void 0&&(a=.5),O.localResponseNormalization(this,n,e,t,a)},r.prototype.pool=function(n,e,t,a,i){return this.throwIfDisposed(),O.pool(this,n,e,t,a,i)},r.prototype.variable=function(n,e,t){return n===void 0&&(n=!0),this.throwIfDisposed(),Dn().makeVariable(this,n,e,t)},r.prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),O.unsortedSegmentSum(this,n,e)},r.prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),O.batchToSpaceND(this,n,e)},r.prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),O.spaceToBatchND(this,n,e)},r.prototype.topk=function(n,e){return n===void 0&&(n=1),e===void 0&&(e=!0),this.throwIfDisposed(),O.topk(this,n,e)},r.prototype.stridedSlice=function(n,e,t,a,i,o,s,u){return a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),O.stridedSlice(this,n,e,t,a,i,o,s,u)},r.prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),O.depthToSpace(this,n,e)},r.prototype.fft=function(){return this.throwIfDisposed(),O.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),O.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),O.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),O.spectral.irfft(this)},r}();Object.defineProperty(Pe,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var np,Pu,Ou,Bu,Lu,Pr=function(r){function n(e,t,a,i){var o=r.call(this,e.shape,e.dtype,e.dataId,i)||this;return o.trainable=t,o.name=a,o}return ln(n,r),n.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!nt(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Dn().disposeTensor(this),this.dataId=e.dataId,Dn().incRef(this,null)},n.prototype.dispose=function(){Dn().disposeVariable(this),this.isDisposedInternal=!0},n}(Pe);Object.defineProperty(Pr,Symbol.hasInstance,{value:function(r){return r instanceof Pe&&r.assign!=null&&r.assign instanceof Function}}),function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"}(np||(np={})),function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"}(Pu||(Pu={})),function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"}(Ou||(Ou={})),function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"}(Bu||(Bu={})),function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"}(Lu||(Lu={}));var Ng={float32:Bu,int32:Pu,bool:Ou,complex64:Lu};function lt(r,n){if(r==="string"||n==="string"){if(r==="string"&&n==="string")return"string";throw new Error("Can not upcast "+r+" with "+n)}return Ng[r][n]}function du(r){return lt(r,"int32")}function Ue(r,n){if(r.dtype===n.dtype)return[r,n];var e=lt(r.dtype,n.dtype);return[r.cast(e),n.cast(e)]}function eh(r,n){E(r.dtype===n.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+n.dtype+") input must match"})}function rc(r){var n=[];return function e(t,a,i){if(t!=null){if(t instanceof Pe)return void a.push(t);if(o=t,!(!Array.isArray(o)&&typeof o!="object")){var o,s=t;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,a,i))}}}}(r,n,new Set),n}var pu,Cw=Object.freeze({makeTypesMatch:Ue,assertTypesMatch:eh,isTensorInList:function(r,n){return n.some(function(e){return e.id===r.id})},getTensorsInContainer:rc}),rp=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},r}(),Pg=function(){function r(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new rp}return r.prototype.ready=function(){return re(this,void 0,void 0,function(){var n,e,t;return ae(this,function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),e=0,a.label=1;case 1:return e<n.length?(t=n[e],[4,this.initializeBackend(t).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(t)]:[3,4];case 3:return a.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),e=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},r.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},r.prototype.registerBackend=function(n,e,t){return t===void 0&&(t=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:e,priority:t},!0)},r.prototype.setBackend=function(n){return re(this,void 0,void 0,function(){var e,t,a;return ae(this,function(i){switch(i.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(n),t=e.success,e.asyncInit?[4,t]:[3,2]);case 1:return a=i.sent(),[3,3];case 2:a=t,i.label=3;case 3:if(!a)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new Tg(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var n=this;Zd(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(n.backendInstance)})},r.prototype.disposeRegisteredKernels=function(n){var e=this;Zd(n).forEach(function(t){t.disposeFunc!=null&&t.disposeFunc(e.registry[n])})},r.prototype.initializeBackend=function(n){var e=this,t=this.registryFactory[n];if(t==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var a=t.factory();if(Promise.resolve(a)===a){var i=++this.pendingBackendInitId,o=a.then(function(s){return!(i<e.pendingBackendInitId)&&(e.registry[n]=s,e.pendingBackendInit=null,!0)}).catch(function(s){return!(i<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[n]=a,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,t){return n.registryFactory[t].priority-n.registryFactory[e].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),e=0;e<n.length;e++){var t=n[e],a=this.initializeBackend(t),i=a.success,o=a.asyncInit;if(o||i)return{name:t,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(n,e){var t=this.state.tensorInfo.get(e),a=t.backend,i=this.readSync(e);a.disposeData(e),t.backend=n,n.move(e,i,t.shape,t.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(n,e){var t,a=this,i=null;if(e==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");e=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun(function(){return a.startScope(i)},function(){return a.endScope(t)},function(){return(t=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),t})},r.prototype.scopedRun=function(n,e,t){n();try{var a=t();return e(),a}catch(i){throw e(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(n){var e=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),t={x:n};return this.addTapeNode(this.state.activeScope.name,t,[e],function(a){return{x:function(){return a.toFloat()}}},[]),e},r.prototype.runKernel=function(n,e,t,a,i){return this.runKernelFunc(null,e,null,n,t,a,i)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(n,e,t){var a=this.backend.numDataIds(),i=0;t.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-e-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},r.prototype.runKernelFunc=function(n,e,t,a,i,o,s){var u,c=this;o===void 0&&(o=[]),s===void 0&&(s=[]);var l=[],d=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var p,h=function(b){d&&(l=b.map(function(x){return c.keep(c.clone(x))}))},f=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=Lp(a,this.backendName);return p=g!=null?function(){var b=c.backend.numDataIds();m=g.kernelFunc({inputs:e,attrs:i,backend:c.backend});var x=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(a,b,x);var y=x.map(function(w){var A=w.dataId,S=w.shape,D=w.dtype;return c.makeTensorFromDataId(A,S,D)}),_=y.filter(function(w,A){return s[A]});return h((o||[]).slice().concat(_)),y}:function(){var b=c.backend.numDataIds();m=c.tidy(function(){return n(c.backend,h)});var x=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(a,b,x),x},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(a,e,function(){return p()}):p()}),d&&this.addTapeNode(a,e,u,t,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(b){return e[b].shape}),outputShapes:u.map(function(b){return b.shape})}),Array.isArray(m)?u:u[0]},r.prototype.makeTensor=function(n,e,t,a){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");t=t||"float32",a=a||this.backend;var i=n;t==="string"&&hr(n[0])&&(i=n.map(function(l){return $p(l)}));var o=a.write(i,e,t),s=new Pe(e,t,o,this.nextTensorId());if(this.incRef(s,a),t==="string"){var u=this.state.tensorInfo.get(o),c=Yp(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(n,e,t,a){var i=new Pe(e,t=t||"float32",n,this.nextTensorId());return this.incRef(i,a),i},r.prototype.makeVariable=function(n,e,t,a){e===void 0&&(e=!0),t=t||this.nextVariableId().toString(),a!=null&&a!==n.dtype&&(n=n.asType(a));var i=new Pr(n,e,t,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.incRef=function(n,e){var t=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,t===0){this.state.numDataBuffers++;var a=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(a=n.size*Zu(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:e||this.backend,dtype:n.dtype,shape:n.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Pr||this.track(n)},r.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(n.dataId);e.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var e=this.state.registeredVariables[n];this.disposeVariable(e)}},r.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},r.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},r.prototype.profile=function(n){return re(this,void 0,void 0,function(){var e,t;return ae(this,function(a){return this.state.profiling=!0,e=this.state.numBytes,t=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-t,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(n,e,t,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:e,outputs:t,saved:i},u=Ig(n);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=function(c){return c=c.map(function(l,d){if(l==null){var p=t[d],h=_a(p.size,p.dtype);return o.makeTensor(h,p.shape,p.dtype)}return l}),a(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},r.prototype.keep=function(n){return n.kept=!0,n},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(n){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(e.name=n),this.state.scopeStack.push(e),this.state.activeScope=e},r.prototype.endScope=function(n){for(var e=this,t=rc(n),a=new Set(t.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||a.has(o.id)||o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},r.prototype.gradients=function(n,e,t,a){var i=this;if(a===void 0&&(a=!1),E(e.length>0,function(){return"gradients() received an empty list of xs."}),t!=null&&t.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+t.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",n)});E(o instanceof Pe,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},p={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var f=(w=u[h]).inputs;for(var v in f){for(var m=f[v],g=!1,b=0;b<c.length;b++)if(d[m.id]){w.outputs.forEach(function(k){return d[k.id]=!0}),g=!0,p[w.id]=!0;break}if(g)break}}var x={};x[l.id]=!0;var y={};for(h=u.length-1;h>=0;h--)for(f=(w=u[h]).inputs,b=0;b<w.outputs.length;b++)if(x[w.outputs[b].id]){for(var v in f)x[f[v].id]=!0,y[w.id]=!0;break}var _=[];for(h=0;h<u.length;h++){var w;if(p[(w=u[h]).id]&&y[w.id]){var A={};for(var v in w.inputs){var S=w.inputs[v];d[S.id]&&(A[v]=S)}var D=Object.assign({},w);D.inputs=A,D.outputs=w.outputs,_.push(D)}}return _}(this.state.activeTape,e,o);if(!a&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[o.id]=t??(u=o.shape,c=tc(ie(u),"float32"),R.makeTensor(c,u,"float32")),function(p,h,f){for(var v=function(g){var b=h[g],x=[];if(b.outputs.forEach(function(A){var S=p[A.id];S!=null?x.push(S):x.push(null)}),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var y=b.gradient(x),_=function(A){if(!(A in y))throw new Error("Cannot backprop through input "+A+". Available gradients found: "+Object.keys(y)+".");var S=f(function(){return y[A]()});if(S.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+A+" must have 'float32' dtype, but has '"+S.dtype+"'");var D=b.inputs[A];if(!nt(S.shape,D.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+A+"' has shape '"+S.shape+"', which does not match the shape of the input '"+D.shape+"'");if(p[D.id]==null)p[D.id]=S;else{var k=p[D.id];p[D.id]=k.add(S),k.dispose()}};for(var w in b.inputs)_(w)},m=h.length-1;m>=0;m--)v(m)}(l,s,function(p){return i.tidy(p)});var d=e.map(function(p){return l[p.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(p){for(var h=0,f=p.saved;h<f.length;h++)f[h].dispose()}),i.state.activeTape=null),{value:o,grads:d}})},r.prototype.customGrad=function(n){var e=this;return E(Oo(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var t,a=[],i=0;i<arguments.length;i++)a[i]=arguments[i];E(a.every(function(s){return s instanceof Pe}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return a.forEach(function(s,u){o[u]=s}),e.runKernelFunc(function(s,u){return E((t=n.apply(void 0,a.concat([u]))).value instanceof Pe,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),E(Oo(t.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),t.value},o,function(s,u){var c=t.gradFunc(s,u),l=Array.isArray(c)?c:[c];E(l.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),E(l.every(function(p){return p instanceof Pe}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(p,h){d[h]=function(){return p}}),d})}},r.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},r.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},r.prototype.time=function(n){return re(this,void 0,void 0,function(){var e,t;return ae(this,function(a){switch(a.label){case 0:return e=sn(),[4,this.backend.time(n)];case 1:return(t=a.sent()).wallMs=sn()-e,[2,t]}})})},r.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new rp,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r}(),R=function(){var r=function(){if(pu==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}pu=e}return pu}();if(r._tfengine==null){var n=new Sg(r);r._tfengine=new Pg(n)}return function(e){Bp=e}(r._tfengine.ENV),Dn=function(){return r._tfengine},r._tfengine}();function th(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Bn=B();Bn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Bn.registerFlag("IS_BROWSER",function(){return th()}),Bn.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Bn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Bn.registerFlag("PROD",function(){return!1}),Bn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Bn.getBool("DEBUG")}),Bn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Bn.registerFlag("IS_TEST",function(){return!1});var fi,zt,Wt,Ir={},hu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function nh(r,n){Ir[r]=n}function In(r){r in Ir||(Ir[r]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(a){a.preventDefault(),delete Ir[e]},!1),e===1?t.getContext("webgl",hu)||t.getContext("experimental-webgl",hu):t.getContext("webgl2",hu)}(r));var n=Ir[r];return n.isContextLost()?(delete Ir[r],In(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Ir[r])}function Xo(r,n){return[n,r]}function ci(r){var n=ie(r);return Po(Math.ceil(n/4))}function _i(r,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(r/2))]}function ac(r,n){var e,t,a,i,o,s,u,c,l,d=r;return B().getNumber("WEBGL_VERSION")===2?(e=d.R32F,t=d.R16F,a=d.RGBA16F,i=d.RGBA32F,o=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=r.RGBA,t=r.RGBA,a=r.RGBA,i=d.RGBA,o=r.RGBA,s=4,u=4,c=n!=null?n.HALF_FLOAT_OES:null,l=r.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:t,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function ne(r,n,e){var t=e();return n&&function(a){var i=a.getError();if(i!==a.NO_ERROR)throw new Error("WebGL Error: "+ah(a,i))}(r),t}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(fi||(fi={})),function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"}(zt||(zt={})),function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Wt||(Wt={}));var Og=596e-10,Bg=65504;function rh(r){return!!(B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||Og<Math.abs(r)&&Math.abs(r)<Bg)}function ah(r,n){switch(n){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function oi(r,n,e){return Un(r,n,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function ih(r,n,e){var t=Un(r,n,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ne(r,n,function(){return r.shaderSource(t,e)}),ne(r,n,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function oh(r,n,e){var t=Un(r,n,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ne(r,n,function(){return r.shaderSource(t,e)}),ne(r,n,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw function(a,i){var o=Lg.exec(i);if(o==null)return console.log("Couldn't parse line number in error: "+i),void console.log(a);for(var s=+o[1],u=a.split(`
`),c=u.length.toString().length+2,l=u.map(function(m,g){return Mr((g+1).toString(),c)+m}),d=0,p=0;p<l.length;p++)d=Math.max(l[p].length,d);var h=l.slice(0,s-1),f=l.slice(s-1,s),v=l.slice(s);console.log(h.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Mr(f[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var ko,So,Lg=/ERROR: [0-9]+:([0-9]+):/g;function sh(r,n){return Un(r,n,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function uh(r,n,e){if(ne(r,n,function(){return r.linkProgram(e)}),r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Ao(r,n,e){if(ne(r,n,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function ch(r,n,e){var t=Un(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ne(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),ne(r,n,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function lh(r,n,e){var t=Un(r,n,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return ne(r,n,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),ne(r,n,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function dh(r,n){return Un(r,n,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function ph(r,n){var e=B().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||n<=0){var t="["+r+"x"+n+"]";throw new Error("Requested texture size "+t+" is invalid.")}if(r>e||n>e)throw t="["+r+"x"+n+"]",new Error("Requested texture size "+t+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function hh(r,n){return Un(r,n,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Vu(r,n,e,t,a,i,o,s){var u=r.getAttribLocation(e,t);return u!==-1&&(ne(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,a)}),ne(r,n,function(){return r.vertexAttribPointer(u,i,r.FLOAT,!1,o,s)}),ne(r,n,function(){return r.enableVertexAttribArray(u)}),!0)}function fh(r,n,e,t){bh(r,t),ne(r,n,function(){return r.activeTexture(r.TEXTURE0+t)}),ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function mh(r,n,e,t){return Un(r,n,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function vh(r,n,e){return r.getUniformLocation(n,e)}function gh(r,n,e,t,a,i){ne(r,n,function(){return fh(r,n,t,i)}),ne(r,n,function(){return r.uniform1i(a,i)})}function Io(r,n,e,t){ne(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),ne(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Wu(r,n,e){ne(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),ne(r,n,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function si(r){var n=r.checkFramebufferStatus(r.FRAMEBUFFER);if(n!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+yh(r,n))}function yh(r,n){switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function Un(r,n,e,t){var a=ne(r,n,function(){return e()});if(a==null)throw new Error(t);return a}function bh(r,n){var e=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,t=n+r.TEXTURE0;if(t<r.TEXTURE0||t>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function mi(r,n){return n===void 0&&(n=2),ie(r.slice(0,r.length-n))}function vi(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Ro(r){var n=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(n=[mi(r)].concat(vi(r))),n}function xh(r,n){var e;n===void 0&&(n=!1);var t=B().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(t*=2,(r=r.map(function(c,l){return l>=r.length-2?Ju(r[l]):r[l]})).length===1&&(r=[2,r[0]])),r.length!==2){var a=pr(r);r=a.newShape}var i=ie(r);if(r.length<=1&&i<=t)return[1,i];if(r.length===2&&r[0]<=t&&r[1]<=t)return r;if(r.length===3&&r[0]*r[1]<=t&&r[2]<=t)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=t&&r[1]*r[2]<=t)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=t&&r[3]<=t)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=t&&r[1]*r[2]*r[3]<=t)return[r[0],r[1]*r[2]*r[3]];if(n){var o=mi(r),s=2,u=2;return r.length&&(s=(e=vi(r))[0],u=e[1]),Po(i=o*(s/2)*(u/2)).map(function(c){return 2*c})}return Po(i)}function go(r){return r%2==0}function ui(r,n){if(nt(r=r.slice(-2),n=n.slice(-2))||!r.length||!n.length||r[0]===0||r[1]===0||n[0]===0||n[1]===0)return!0;if(r.length!==n.length){var e=r.slice(-1)[0],t=n.slice(-1)[0];if(e===t||go(e)&&go(t)&&(r[0]===1||n[0]===1))return!0}return r[1]===n[1]&&go(r[0])&&go(n[0])}function _h(r){if(ko==null){var n=In(r);ko=n.getParameter(n.MAX_TEXTURE_SIZE)}return ko}function wh(r){if(So==null){var n=In(r);So=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,So)}function Ch(r){if(r===0)return 0;var n=In(r);return Ut(n,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Ut(n,"EXT_disjoint_timer_query")?1:0}function Ut(r,n){return r.getExtension(n)!=null}function zu(r){try{if(In(r)!=null)return!0}catch{return!1}return!1}function Eh(r){if(r===0)return!1;var n=In(r);if(r===1){if(!Ut(n,"OES_texture_float"))return!1}else if(!Ut(n,"EXT_color_buffer_float"))return!1;return Uu(n)}function Dh(r){if(r===0)return!1;var n=In(r);if(r!==1){if(Ut(n,"EXT_color_buffer_float"))return Uu(n);if(Ut(n,"EXT_color_buffer_half_float")){var e=n.getExtension("EXT_color_buffer_half_float");return function(t,a){var i=ac(t,a),o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0);var u=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(o),t.deleteFramebuffer(s),u}(n,e)}return!1}return!!Ut(n,"OES_texture_float")&&!!Ut(n,"WEBGL_color_buffer_float")&&Uu(n)}function Uu(r){var n=ac(r),e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var t=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);var a=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(e),r.deleteFramebuffer(t),a}function kh(r){return r===2&&In(r).fenceSync!=null}var Vg=Object.freeze({callAndCheck:ne,canBeRepresented:rh,getWebGLErrorMessage:ah,getExtensionOrThrow:oi,createVertexShader:ih,createFragmentShader:oh,createProgram:sh,linkProgram:uh,validateProgram:Ao,createStaticVertexBuffer:ch,createStaticIndexBuffer:lh,getNumChannels:function(){return B().getNumber("WEBGL_VERSION")===2?1:4},createTexture:dh,validateTextureSize:ph,createFramebuffer:hh,bindVertexBufferToProgramAttribute:Vu,bindTextureUnit:fh,unbindTextureUnit:function(r,n,e){bh(r,e),ne(r,n,function(){return r.activeTexture(r.TEXTURE0+e)}),ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:mh,getProgramUniformLocation:vh,bindTextureToProgramUniformSampler:gh,bindCanvasToFramebuffer:function(r,n){ne(r,n,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),ne(r,n,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),ne(r,n,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})},bindColorTextureToFramebuffer:Io,unbindColorTextureFromFramebuffer:Wu,validateFramebuffer:si,getFramebufferErrorMessage:yh,getBatchDim:mi,getRowsCols:vi,getShapeAs3D:Ro,getTextureShapeFromLogicalShape:xh,isReshapeFree:ui,getWebGLMaxTextureSize:_h,resetMaxTextureSize:function(){ko=null},resetMaxTexturesInShader:function(){So=null},getMaxTexturesInShader:wh,getWebGLDisjointQueryTimerVersion:Ch,hasExtension:Ut,isWebGLVersionEnabled:zu,isCapableOfRenderingToFloatTexture:Eh,isDownloadFloatTextureEnabled:Dh,isWebGLFenceEnabled:kh}),pe=B();function Sh(r){B().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function j(r,n){return R.tidy(r,n)}function Ot(r){rc(r).forEach(function(n){return n.dispose()})}function Wg(r){return R.keep(r)}function Lo(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];B().getBool("IS_TEST")||console.warn.apply(console,r)}function An(r,n){var e=r;if(bt(r))return n==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var t=[];Array.isArray(e)||bt(e)&&n!=="string";)t.push(e.length),e=e[0];return Array.isArray(r)&&B().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(i,o,s){if(s=s||[],!Array.isArray(i)&&!bt(i))return void E(o.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});E(o.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),E(i.length===o[0],function(){return"Element arr["+s.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"});for(var u=o.slice(1),c=0;c<i.length;++c)a(i[c],u,s.concat(c))}(r,t,[]),t}function ap(r,n,e,t){if(r!=null&&(r!=="numeric"&&r!==n||r==="numeric"&&n==="string"))throw new Error("Argument '"+e+"' passed to '"+t+"' must be "+r+" tensor, but got "+n+" tensor")}function C(r,n,e,t){if(t===void 0&&(t="numeric"),r instanceof Pe)return ap(t,r.dtype,n,e),r;var a=xa(r);if(a!=="string"&&["bool","int32","float32"].indexOf(t)>=0&&(a=t),ap(t,a,n,e),r==null||!bt(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+n+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+i+"'")}var o=An(r,a);bt(r)||Array.isArray(r)||(r=[r]);var s=a!=="string"?ec(r,a,B().getBool("DEBUG")):zn(r,[],!0);return R.makeTensor(s,o,a)}function Vo(r,n,e,t){if(t===void 0&&(t="numeric"),!Array.isArray(r))throw new Error("Argument "+n+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(a,i){return C(a,n+"["+i+"]",e)},t)}function ic(r,n){for(var e=0;e<r.length;++e)if(r[r.length-e-1]!==n-1-e)return!1;return!0}function Ah(r,n,e){for(var t=r.length+n.length,a=[],i=0,o=0,s=0;s<t;s++)e.indexOf(s)===-1?a.push(r[i++]):a.push(n[o++]);return a}function yt(r,n){for(var e=[],t=r.length,a=0;a<t;a++)n.indexOf(a)===-1&&e.push(r[a]);return[e,n.map(function(i){return r[i]})]}function It(r,n){return Ah(r,n.map(function(e){return 1}),n)}function Nt(r,n,e){E(ic(n,e),function(){return r+" supports only inner-most axes for now. Got axes "+n+" and rank-"+e+" input."})}function dn(r,n){if(ic(r,n))return null;for(var e=[],t=0;t<n;++t)r.indexOf(t)===-1&&e.push(t);return r.forEach(function(a){return e.push(a)}),e}function $o(r){return r.map(function(n,e){return[e,n]}).sort(function(n,e){return n[1]-e[1]}).map(function(n){return n[0]})}function pn(r,n){for(var e=[],t=n-r;t<n;++t)e.push(t);return e}function Ih(r,n){var e=r[0].length;r.forEach(function(a,i){E(a.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),E(n>=0&&n<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var t=r[0];r.forEach(function(a,i){for(var o=0;o<e;o++)E(o===n||a[o]===t[o],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+a+") does not match the shape of the rest ("+t+") along the non-concatenated axis "+i+"."})})}function Or(r,n){for(var e=r[0].slice(),t=1;t<r.length;t++)e[n]+=r[t][n];return e}function I(r){var n=Object.keys(r);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var e=n[0],t=r[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];R.startScope(e);try{var s=t.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),R.endScope(s),s}catch(u){throw R.endScope(null),u}};return Object.defineProperty(a,"name",{value:e,configurable:!0}),a}pe.registerFlag("HAS_WEBGL",function(){return pe.getNumber("WEBGL_VERSION")>0}),pe.registerFlag("WEBGL_VERSION",function(){return zu(2)?2:zu(1)?1:0}),pe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return pe.get("WEBGL_VERSION")===2}),pe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),pe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),pe.registerFlag("WEBGL_PACK",function(){return pe.getBool("HAS_WEBGL")}),pe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_CLIP",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),pe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_PACK_REDUCE",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_CONV_IM2COL",function(){return pe.getBool("WEBGL_PACK")}),pe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return _h(pe.getNumber("WEBGL_VERSION"))}),pe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return wh(pe.getNumber("WEBGL_VERSION"))}),pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=pe.getNumber("WEBGL_VERSION");return r===0?0:Ch(r)}),pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return pe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),pe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Eh(pe.getNumber("WEBGL_VERSION"))}),pe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!pe.getBool("WEBGL_FORCE_F16_TEXTURES")&&pe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),pe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Dh(pe.getNumber("WEBGL_VERSION"))}),pe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return kh(pe.getNumber("WEBGL_VERSION"))}),pe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return pe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Zp=Sh;var gt=I({complex_:function(r,n){var e=C(r,"real","complex"),t=C(n,"imag","complex");return Re(e.shape,t.shape,"real and imag shapes, "+e.shape+" and "+t.shape+", must match in call to tf.complex()."),R.runKernelFunc(function(a){return a.complex(e,t)},{$real:e,$imag:t})}}),$t=I({real_:function(r){var n=C(r,"input","real");return R.runKernelFunc(function(e){return e.real(n)},{$input:n})}}),kn=I({imag_:function(r){var n=C(r,"input","imag");return R.runKernelFunc(function(e){return e.imag(n)},{$input:n})}});function dt(r,n,e){return vr(r,n,An(r,e),e)}function vr(r,n,e,t){if(t==null&&(t=xa(r)),t==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!bt(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){nc(n);var a=ie(n),i=ie(e);E(a===i,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+a+" values but has "+i});for(var o=0;o<e.length;++o){var s=e[o],u=o!==e.length-1||s!==ie(n.slice(o));E(e[o]===n[o]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+n+"). "})}}return bt(r)||Array.isArray(r)||(r=[r]),n=n||e,r=t!=="string"?ec(r,t,B().getBool("DEBUG")):zn(r,[],!0),R.makeTensor(r,n,t)}function J(r,n){if((bt(r)&&n!=="string"||Array.isArray(r))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&bt(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vr(r,[],[],n)}function Be(r,n){Vr(r);var e=An(r,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vr(r,null,e,n)}function Sn(r,n,e){if(Vr(r),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var t=An(r,e);if(t.length!==2&&t.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(t.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vr(r,n,t,e)}function Qo(r,n,e){if(Vr(r),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var t=An(r,e);if(t.length!==3&&t.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(t.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vr(r,n,t,e)}function st(r,n,e){if(Vr(r),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var t=An(r,e);if(t.length!==4&&t.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(t.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vr(r,n,t,e)}function zg(r,n,e){if(Vr(r),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var t=An(r,e);if(t.length!==5&&t.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(t.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vr(r,n,t,e)}function Ug(r,n,e){if(Vr(r),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var t=An(r,e);if(t.length!==6&&t.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(t.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vr(r,n=n||t,t,e)}function Hg(r,n,e,t){return n===void 0&&(n=!0),R.makeVariable(r,n,e,t)}function wa(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var e=wa(r,"float32"),t=Le(r,"float32");return gt(e,t)}var a=tc(ie(r),n);return R.makeTensor(a,r,n)}function Le(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var e=Le(r,"float32"),t=Le(r,"float32");return gt(e,t)}var a=_a(ie(r),n);return R.makeTensor(a,r,n)}function Gt(r,n,e){return R.runKernelFunc(function(t){return t.fill(r,n,e)},{})}function Gg(r,n,e){if(e<=0)throw new Error("The number of values should be positive.");return R.runKernelFunc(function(t){return t.linspace(r,n,e)},{})}function Wo(r,n,e,t){if(e===void 0&&(e=1),t===void 0&&(t="float32"),e===0)throw new Error("Cannot have a step of zero");if(r===n||r<n&&e<0||n<r&&e>1)return Le([0],t);var a=_a(Math.abs(Math.ceil((n-r)/e)),t);n<r&&e===1&&(e=-1),a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+e;return Be(a,t)}var Rh=I({onesLike_:function(r){var n=C(r,"x","onesLike");if(n.dtype==="complex64"){var e=Rh($t(n)),t=ke(kn(n));return gt(e,t)}return R.runKernelFunc(function(a){return a.onesLike(n)},{$x:n},function(a,i){return{$x:function(){return ke(a)}}})}}),ke=I({zerosLike_:function(r){var n=C(r,"x","zerosLike");return R.runKernelFunc(function(e){return e.zerosLike(n)},{$x:n},function(e,t){return{$x:function(){return ke(e)}}})}}),We=I({concat_:function(r,n){n===void 0&&(n=0),E(r.length>=1,function(){return"Pass at least one tensor to concat"});var e=Vo(r,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),n=at(n,e[0].shape)[0];var t=Or(e.map(function(s){return s.shape}),n);if(ie(t)===0)return dt([],t);if((e=e.filter(function(s){return s.size>0})).length===1)return e[0];var a=e.map(function(s){return s.shape});Ih(a,n);var i=e,o={axis:n};return R.runKernelFunc(function(s){return s.concat(e,n)},i,function(s){var u=a.map(function(c){return c[n]});return oc(s,u,n).map(function(c){return function(){return c}})},"Concat",o)}}),jg=I({concat1d_:function(r){return We(r,0)}}),qg=I({concat2d_:function(r,n){return We(r,n)}}),Yg=I({concat3d_:function(r,n){return We(r,n)}}),Kg=I({concat4d_:function(r,n){return We(r,n)}}),oc=I({split_:function(r,n,e){e===void 0&&(e=0);var t,a=C(r,"x","split");return e=at(e,a.shape)[0],typeof n=="number"?(E(a.shape[e]%n==0,function(){return"Number of splits must evenly divide the axis."}),t=new Array(n).fill(a.shape[e]/n)):(E(a.shape[e]===n.reduce(function(i,o){return i+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),t=n),R.runKernelFunc(function(i){return i.split(a,t,e)},{$x:a},function(i){return{$x:function(){return We(i,e)}}})}});function Wr(r,n){return r(n={exports:{}},n.exports),n.exports}var Xg=Wr(function(r){(function(n,e,t){function a(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var p=0;p<d.length;p++){var h=.02519603282416938*(u+=d.charCodeAt(p));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var d=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function o(s,u){var c=new a(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.alea=o})(0,r,!1)}),$g=Wr(function(r){(function(n,e,t){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var p=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.xor128=o})(0,r,!1)}),Qg=Wr(function(r){(function(n,e,t){function a(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var p=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.xorwow=o})(0,r,!1)}),Jg=Wr(function(r){(function(n,e,t){function a(s){var u=this;u.next=function(){var c,l,d=u.x,p=u.i;return c=d[p],l=(c^=c>>>7)^c<<24,l^=(c=d[p+1&7])^c>>>10,l^=(c=d[p+3&7])^c>>>3,l^=(c=d[p+4&7])^c<<7,c=d[p+7&7],l^=(c^=c<<13)^c<<9,d[p]=l,u.i=p+1&7,l},function(c,l){var d,p=[];if(l===(0|l))p[0]=l;else for(l=""+l,d=0;d<l.length;++d)p[7&d]=p[7&d]<<15^l.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],c.x=p,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var p=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.xorshift7=o})(0,r,!1)}),Zg=Wr(function(r){(function(n,e,t){function a(s){var u=this;u.next=function(){var c,l,d=u.w,p=u.X,h=u.i;return u.w=d=d+1640531527|0,l=p[h+34&127],c=p[h=h+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=p[h]=l^c,u.i=h,l+(d^d>>>16)|0},function(c,l){var d,p,h,f,v,m=[],g=128;for(l===(0|l)?(p=l,l=null):(l+="\0",p=0,g=Math.max(g,l.length)),h=0,f=-32;f<g;++f)l&&(p^=l.charCodeAt((f+32)%l.length)),f===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,f>=0&&(v=v+1640531527|0,h=(d=m[127&f]^=p+v)==0?h+1:0);for(h>=128&&(m[127&(l&&l.length||0)]=-1),h=127,f=512;f>0;--f)p=m[h+34&127],d=m[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,m[h]=p^d;c.w=v,c.X=m,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var p=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.xor4096=o})(0,r,!1)}),e0=Wr(function(r){(function(n,e,t){function a(s){var u=this,c="";u.next=function(){var d=u.b,p=u.c,h=u.d,f=u.a;return d=d<<25^d>>>7^p,p=p-h|0,h=h<<24^h>>>8^f,f=f-d|0,u.b=d=d<<20^d>>>12^p,u.c=p=p-h|0,u.d=h<<16^p>>>16^f,u.a=f-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var p=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=c.next,d.quick=d,l&&(typeof l=="object"&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=o:t&&t.amd?t(function(){return o}):this.tychei=o})(0,r,!1)}),Rr=Wr(function(r){(function(n,e){var t,a=this,i=256,o=6,s="random",u=e.pow(i,o),c=e.pow(2,52),l=2*c,d=i-1;function p(g,b,x){var y=[],_=v(function S(D,k){var F,T=[],W=typeof D;if(k&&W=="object")for(F in D)try{T.push(S(D[F],k-1))}catch{}return T.length?T:W=="string"?D:D+"\0"}((b=b==1?{entropy:!0}:b||{}).entropy?[g,m(n)]:g??function(){try{var S;return t&&(S=t.randomBytes)?S=S(i):(S=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(S)),m(S)}catch{var D=a.navigator,k=D&&D.plugins;return[+new Date,a,k,a.screen,m(n)]}}(),3),y),w=new h(y),A=function(){for(var S=w.g(o),D=u,k=0;S<c;)S=(S+k)*i,D*=i,k=w.g(1);for(;S>=l;)S/=2,D/=2,k>>>=1;return(S+k)/D};return A.int32=function(){return 0|w.g(4)},A.quick=function(){return w.g(4)/4294967296},A.double=A,v(m(w.S),n),(b.pass||x||function(S,D,k,F){return F&&(F.S&&f(F,w),S.state=function(){return f(w,{})}),k?(e[s]=S,D):S})(A,_,"global"in b?b.global:this==e,b.state)}function h(g){var b,x=g.length,y=this,_=0,w=y.i=y.j=0,A=y.S=[];for(x||(g=[x++]);_<i;)A[_]=_++;for(_=0;_<i;_++)A[_]=A[w=d&w+g[_%x]+(b=A[_])],A[w]=b;(y.g=function(S){for(var D,k=0,F=y.i,T=y.j,W=y.S;S--;)D=W[F=d&F+1],k=k*i+W[d&(W[F]=W[T=d&T+D])+(W[T]=D)];return y.i=F,y.j=T,k})(i)}function f(g,b){return b.i=g.i,b.j=g.j,b.S=g.S.slice(),b}function v(g,b){for(var x,y=g+"",_=0;_<y.length;)b[d&_]=d&(x^=19*b[d&_])+y.charCodeAt(_++);return m(b)}function m(g){return String.fromCharCode.apply(0,g)}if(e["seed"+s]=p,v(e.random(),n),r.exports){r.exports=p;try{t=tg()}catch{}}})([],Math)});Rr.alea=Xg,Rr.xor128=$g,Rr.xorwow=Qg,Rr.xorshift7=Jg,Rr.xor4096=Zg,Rr.tychei=e0;var Jo=Rr.alea,sc=function(){function r(n,e,t,a,i){this.mean=n,this.stdDev=e,this.dtype=t,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Jo(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var e,t,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,t=this.mean+this.stdDev*o*u,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)},r.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},r.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},r}(),t0=function(){function r(n,e,t,a){this.alpha=n,this.beta=1/e,this.dtype=t;var i=a||Math.random();this.randu=Jo(i.toString()),this.randn=new sc(0,1,t,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var n,e,t,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=1-.331*(n=a*a)*n,t=.5*n+this.d*(1-o+Math.log(o)),(i=this.randu())<e||Math.log(i)<t)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},r}(),n0=function(){function r(n,e,t,a){var i=this;if(n===void 0&&(n=0),e===void 0&&(e=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=n,this.range=e-n,this.dtype=t,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+e+" <= 1 and dtype is not float");this.random=Jo(a)}return r.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function he(r,n,e){return n===void 0&&(n="float32"),n=n||"float32",nc(r),new hi(r,n,e)}function r0(r,n){n===void 0&&(n=!1),console.log(r.toString(n))}var Th=I({batchToSpaceND_:function(r,n,e){var t=C(r,"x","batchToSpaceND"),a=n.reduce(function(i,o){return i*o});return E(t.rank>=1+n.length,function(){return"input rank is "+t.rank+" but should be > than blockShape.length "+n.length}),E(e.length===n.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+n.length}),E(t.shape[0]%a==0,function(){return"input tensor batch is "+t.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+a}),R.runKernelFunc(function(i){return i.batchToSpaceND(t,n,e)},{$x:t},function(i){return{$x:function(){return i.spaceToBatchND(n,e)}}})}}),a0=I({broadcastTo_:function(r,n){var e=C(r,"broadcastTo","x"),t=e.shape;if(n.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<e.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+e.rank+".");if(n.length>e.rank){for(var a=e.shape.slice();a.length<n.length;)a.unshift(1);e=e.reshape(a)}for(var i=Array.from(n),o=n.length-1;o>=0;o--)if(e.shape[o]===n[o])i[o]=1;else if(e.shape[o]!==1)throw new Error("broadcastTo(): ["+t+"] cannot be broadcast to ["+n+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return s.length===0?e.clone():R.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),i0=I({cast_:function(r,n){var e=C(r,"x","cast");if(!jp(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var t={dtype:n};return R.runKernelFunc(function(a){return a.cast(e,n)},{x:e},function(a){return{x:function(){return a.clone()}}},"Cast",t)}}),o0=I({clone_:function(r){var n=C(r,"x","clone",null);return R.runKernelFunc(function(){return R.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(e){return{$x:function(){return e.toFloat()}}})}}),s0=I({cumsum_:function(r,n,e,t){n===void 0&&(n=0),e===void 0&&(e=!1),t===void 0&&(t=!1);var a=C(r,"x","cumsum"),i=dn([n|=0],a.rank),o=a;i!=null&&(o=a.transpose(i));var s=pn(1,a.rank)[0],u=R.runKernelFunc(function(c){return c.cumsum(o,s,e,t)},{permutedX:o},function(c){return{permutedX:function(){return c.cumsum(n,e,!t)}}});return i!=null&&(u=u.transpose(i)),u}}),u0=I({depthToSpace_:function(r,n,e){e===void 0&&(e="NHWC");var t=C(r,"x","depthToSpace"),a=e==="NHWC"?t.shape[1]:t.shape[2],i=e==="NHWC"?t.shape[2]:t.shape[3],o=e==="NHWC"?t.shape[3]:t.shape[1];return E(a*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+n+`  for depthToSpace with input shape
      `+t.shape}),E(i*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+n+` for depthToSpace with input shape
          `+t.shape}),E(o%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+o+" for depthToSpace with input shape "+t.shape}),R.runKernelFunc(function(s){return s.depthToSpace(t,n,e)},{$x:t})}}),Et=I({expandDims_:function(r,n){n===void 0&&(n=0);var e=C(r,"x","expandDims",null);E(n<=e.rank,function(){return"Axis must be <= rank of the tensor"});var t=e.shape.slice();return n<0&&(E(-(e.rank+1)<=n,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),n=e.rank+n+1),t.splice(n,0,1),Tt(e,t)}}),Fh=I({eye_:function(r,n,e,t){t===void 0&&(t="float32"),n==null&&(n=r);for(var a=he([r,n],t),i=r<=n?r:n,o=0;o<i;++o)a.set(1,o,o);var s=a.toTensor().as2D(r,n);if(e==null)return s;if(e.length===1)return Nr(Et(s,0),[e[0],1,1]);if(e.length===2)return Nr(Et(Et(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return Nr(Et(Et(Et(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),c0=I({multinomial_:function(r,n,e,t){t===void 0&&(t=!1);var a=C(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);e=e||Math.random();var s=o===1?a.as2D(1,-1):a,u=R.runKernelFunc(function(c){return c.multinomial(s,t,n,e)},{logits2D:s});return o===1?u.as1D():u}}),Hu=I({oneHot_:function(r,n,e,t){if(e===void 0&&(e=1),t===void 0&&(t=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var a=C(r,"indices","oneHot","int32"),i=a.shape.concat([n]);return a=a.flatten(),R.runKernelFunc(function(o){return o.oneHot(a,n,e,t)},{$indices:a},function(o){return{$indices:function(){return Le(a.shape,"float32")}}}).reshape(i)}}),Hn=I({pad_:function(r,n,e){e===void 0&&(e=0);var t=C(r,"x","pad");if(t.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:n,constantValue:e};return R.runKernelFunc(function(i){return i.pad(t,n,e)},{x:t},function(i){var o=n.map(function(s){return s[0]});return{x:function(){return i.slice(o,t.shape)}}},"PadV2",a)}}),l0=I({pad1d_:function(r,n,e){return e===void 0&&(e=0),E(n.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Hn(r,[n],e)}}),d0=I({pad2d_:function(r,n,e){return e===void 0&&(e=0),E(n.length===2&&n[0].length===2&&n[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hn(r,n,e)}}),p0=I({pad3d_:function(r,n,e){return e===void 0&&(e=0),E(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hn(r,n,e)}}),h0=I({pad4d_:function(r,n,e){return e===void 0&&(e=0),E(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hn(r,n,e)}}),f0=I({rand_:function(r,n,e){var t=ie(r),a=null;if(e==null||e==="float32")a=new Float32Array(t);else if(e==="int32")a=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);a=new Uint8Array(t)}for(var i=0;i<t;i++)a[i]=n();return R.makeTensor(a,r,e)}}),m0=I({randomNormal_:function(r,n,e,t,a){if(n===void 0&&(n=0),e===void 0&&(e=1),t!=null&&t==="bool")throw new Error("Unsupported data type "+t);for(var i=new sc(n,e,t,!1,a),o=he(r,t),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),v0=I({randomGamma_:function(r,n,e,t,a){if(e===void 0&&(e=1),t===void 0&&(t="float32"),e==null&&(e=1),t==null&&(t="float32"),t!=="float32"&&t!=="int32")throw new Error("Unsupported data type "+t);for(var i=new t0(n,e,t,a),o=he(r,t),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Mh=I({randomUniform_:function(r,n,e,t,a){n===void 0&&(n=0),e===void 0&&(e=1),t===void 0&&(t="float32");for(var i=he(r,t),o=new n0(n,e,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),Tt=I({reshape_:function(r,n){var e=C(r,"x","reshape",null);n=Hp(n,e.size),E(e.size===ie(n),function(){return"new shape and old shape must have the same number of elements."});var t={shape:n};return R.runKernelFunc(function(a){return a.reshape(e,n)},{x:e},function(a){return{x:function(){return a.reshape(e.shape)}}},"Reshape",t)}}),Nh=I({spaceToBatchND_:function(r,n,e){var t=C(r,"x","spaceToBatchND");return E(t.rank>=1+n.length,function(){return"input rank "+t.rank+" should be > than [blockShape] "+n.length}),E(e.length===n.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+n.length}),E(t.shape.reduce(function(a,i,o){return o>0&&o<=n.length?a&&(i+e[o-1][0]+e[o-1][1])%n[o-1]==0:a},!0),function(){return"input spatial dimensions "+t.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+n.toString()}),R.runKernelFunc(function(a){return a.spaceToBatchND(t,n,e)},{$x:t},function(a){return{$x:function(){return a.batchToSpaceND(n,e)}}})}}),Ph=I({squeeze_:function(r,n){var e=C(r,"x","squeeze");return Tt(e,pr(e.shape,n).newShape)}}),xt=I({stack_:function(r,n){n===void 0&&(n=0);var e=Vo(r,"tensors","stack");if(E(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(n);var t=e[0].rank,a=e[0].shape,i=e[0].dtype;E(n<=t,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Re(a,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){E(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=e.map(function(s){return s.expandDims(n)});return We(o,n)}}),Nr=I({tile_:function(r,n){var e=C(r,"x","tile",null);E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+n+"."});var t=[e],a={reps:n};return R.runKernelFunc(function(i,o){var s=i.tile(e,n);return o([e]),s},{x:e},function(i,o){var s=o[0];return{x:function(){var u=ke(s);if(s.rank===1)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var p=0;p<n[3];++p)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],p*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",a,t)}}),g0=I({truncatedNormal_:function(r,n,e,t,a){if(n===void 0&&(n=0),e===void 0&&(e=1),t!=null&&t==="bool")throw new Error("Unsupported data type "+t);for(var i=new sc(n,e,t,!0,a),o=he(r,t),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Fe=I({unstack_:function(r,n){n===void 0&&(n=0),n=n||0;var e=C(r,"x","unstack");E(n>=-e.shape.length&&n<e.shape.length,function(){return"Axis = "+n+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),n<0&&(n+=e.shape.length);var t={axis:n};return R.runKernelFunc(function(a){return a.unstack(e,n)},{x:e},function(a){return{x:function(){return xt(a,n)}}},"Unpack",t)}}),y0=function(r,n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s,u,c,l,d;return ae(this,function(p){switch(p.label){case 0:return e=C(r,"x","setdiff1d"),t=C(n,"y","setdiff1d"),E(e.dtype===t.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+t.dtype+")."}),E(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),E(t.rank===1,function(){return"y should be 1D tensor, but got y ("+t.shape+")."}),[4,e.data()];case 1:return a=p.sent(),[4,t.data()];case 2:for(i=p.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new hi([s],e.dtype),c=new hi([s],"int32"),l=0,d=0;l<a.length;l++)o.has(a[l])||(u.values[d]=a[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})};function zo(r,n,e,t){t===void 0&&(t=!0);var a=[];if(t)(a=a.concat(n.slice(0))).push(r[0]/e),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=n.length,o=0;o<i;++o)a=a.concat([r[o+1]/n[o],n[o]]);a=a.concat(r.slice(i+1))}return a}function Uo(r,n,e){e===void 0&&(e=!0);var t=[];if(e){t.push(n);for(var a=n+1;a<r;++a)a<=2*n?(t.push(a),t.push(a-(n+1))):t.push(a)}else{var i=[],o=[];for(a=1;a<r;++a)a>=2*n+1||a%2==1?o.push(a):i.push(a);t.push.apply(t,i),t.push(0),t.push.apply(t,o)}return t}function Ho(r,n,e,t){t===void 0&&(t=!0);var a=[];t?a.push(r[0]/e):a.push(r[0]*e);for(var i=1;i<r.length;++i)i<=n.length?t?a.push(n[i-1]*r[i]):a.push(r[i]/n[i-1]):a.push(r[i]);return a}function Oh(r,n){for(var e=[0],t=0;t<n;++t)e.push(r[t][0]);return e}function Bh(r,n,e){for(var t=r.slice(0,1),a=0;a<e;++a)t.push(r[a+1]-n[a][0]-n[a][1]);return t}function uc(r,n){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var e=n.shape,t=e[e.length-1],a=1,i=0;i<e.length-1;++i)a*=e[i];var o=r.shape,s=e.slice();s.pop();var u=1;for(i=t;i<r.rank;++i)u*=o[i],s.push(o[i]);var c=un(r.shape).map(function(l){return l/u}).concat([1]).slice(0,t);return[s,a,u,c]}var Ew=Object.freeze({prepareAndValidate:uc}),cc=30;function To(r){return r<=cc?r:Bo(r,Math.floor(Math.sqrt(r)))}function Lh(r,n,e){var t=n.rank>1?n.shape[n.rank-1]:1,a=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+n.shape+", shape: "+r+", sliceDim: "+t+", and batchDim: "+a+".";if(e.rank<a)throw new Error(i+" update.rank < "+a+". ");if(r.length<t+(e.rank-a))throw new Error(i+" Output shape length < "+(t+(e.rank-a)));if(e.rank!==a+r.length-t)throw new Error(i+" update.rank != "+(a+r.length-t));for(var o=0;o<a;++o)if(e.shape[o]!==n.shape[o])throw new Error(i+" updates.shape["+o+"] ("+e.shape[o]+") != indices.shape["+o+"] ("+n.shape[o]+").");for(o=0;o<e.rank-a;++o)if(e.shape[o+a]!==r[o+t])throw new Error(i+" updates.shape["+(o+a)+"] ("+e.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")")}function Vh(r,n,e){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}Lh(e,n,r)}function gi(r,n,e){for(var t=n.shape.length,a=t>1?n.shape[t-1]:1,i=e.length,o=1,s=a;s<i;++s)o*=e[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:ie(n.shape)/u,sliceSize:o,strides:un(e.slice(0,a)).concat([1]),outputSize:ie(e)}}var Dw=Object.freeze({validateUpdateShape:Lh,validateInput:Vh,calculateShapes:gi});function Wh(r,n,e){E(r.rank===n.length,function(){return"Error in slice"+r.rank+"D: Length of begin "+n+" must match the rank of the array ("+r.rank+")."}),E(r.rank===e.length,function(){return"Error in slice"+r.rank+"D: Length of size "+e+" must match the rank of the array ("+r.rank+")."});for(var t=function(i){E(n[i]+e[i]<=r.shape[i],function(){return"Error in slice"+r.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+e[i])+") would overflow input.shape["+i+"] ("+r.shape[i]+")"})},a=0;a<r.rank;++a)t(a)}function Gu(r){for(var n=[],e=0;r>0;)1&r&&n.push(e),r/=2,e++;return n}function Zo(r,n,e){for(var t=[],a=0;a<r.length;a++)t[a]=Math.ceil((n[a]-r[a])/e[a]);return t}function zh(r,n,e,t,a){var i=n[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=t[a];return i<0&&(i+=s),i=No(0,i,s-1)}function Uh(r,n,e,t,a){var i=n[a],o=e[a]||1;(r&1<<a||i==null)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=t[a];return i<0&&(i+=s),i=o>0?No(0,i,s):No(-1,i,s-1)}function lc(r,n,e){for(var t=e.length,a=0;a<e.length;a++)if(e[a]>1){t=a;break}for(a=t+1;a<e.length;a++)if(n[a]>0||e[a]!==r[a])return!1;return!0}function dc(r,n){for(var e=r.length>0?r[r.length-1]:1,t=0;t<r.length-1;t++)e+=r[t]*n[t];return e}var kw=Object.freeze({assertParamsValid:Wh,maskToAxes:Gu,computeOutShape:Zo,startForAxis:zh,stopForAxis:Uh,isSliceContinous:lc,computeFlatOffset:dc});function b0(r,n){E(Oo(r),function(){return"The f passed in variableGrads(f) must be a function"}),E(n==null||Array.isArray(n)&&n.every(function(l){return l instanceof Pr}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=n!=null;if(!e)for(var t in n=[],R.registeredVariables)n.push(R.registeredVariables[t]);var a=e?n.filter(function(l){return!l.trainable}):null,i=n.length;E((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var o=R.gradients(r,n,null,!0),s=o.value,u=o.grads;E(u.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),E(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return n.forEach(function(l,d){u[d]!=null&&(c[l.name]=u[d])}),a?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}function es(r){return R.customGrad(r)}var Ft=I({softmax_:function(r,n){n===void 0&&(n=-1);var e=C(r,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+n);return R.runKernelFunc(function(t,a){var i=t.softmax(e,n);return a([i]),i},{logits:e},function(t,a){var i=a[0],o=t.mul(i);return{logits:function(){return o.sub(o.sum([n],!0).mul(i))}}},"Softmax",{dim:n},[],[!0])}}),x0=I({logSoftmax_:function(r,n){n===void 0&&(n=-1);var e=C(r,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+n);return es(function(t,a){var i=t.max(n,!0),o=t.sub(i),s=o.toFloat().sub(o.exp().sum(n,!0).log());return a([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}})(e)}}),Hh=function(){function r(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},r.prototype.set=function(n,e){this.dataIdsCount++,this.data.set(n,e)},r.prototype.has=function(n){return this.data.has(n)},r.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),Gh=function(){function r(){}return r.prototype.time=function(n){return P("time")},r.prototype.read=function(n){return P("read")},r.prototype.readSync=function(n){return P("readSync")},r.prototype.numDataIds=function(){return P("numDataIds")},r.prototype.disposeData=function(n){return P("disposeData")},r.prototype.write=function(n,e,t){return P("write")},r.prototype.move=function(n,e,t,a){return P("move")},r.prototype.memory=function(){return P("memory")},r.prototype.floatPrecision=function(){return P("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(n,e,t,a){return P("batchMatMul")},r.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,P("fusedBatchMatMul")},r.prototype.slice=function(n,e,t){return P("slice")},r.prototype.stridedSlice=function(n,e,t,a){return P("stridedSlice")},r.prototype.unstack=function(n,e){return P("unstack")},r.prototype.reverse=function(n,e){return P("reverse")},r.prototype.concat=function(n,e){return P("concat")},r.prototype.neg=function(n){return P("neg")},r.prototype.add=function(n,e){return P("add")},r.prototype.addN=function(n){return P("addN")},r.prototype.subtract=function(n,e){return P("subtract")},r.prototype.multiply=function(n,e){return P("multiply")},r.prototype.realDivide=function(n,e){return P("realDivide")},r.prototype.floorDiv=function(n,e){return P("floorDiv")},r.prototype.sum=function(n,e){return P("sum")},r.prototype.prod=function(n,e){return P("prod")},r.prototype.unsortedSegmentSum=function(n,e,t){return P("unsortedSegmentSum")},r.prototype.argMin=function(n,e){return P("argMin")},r.prototype.argMax=function(n,e){return P("argMax")},r.prototype.equal=function(n,e){return P("equal")},r.prototype.notEqual=function(n,e){return P("notEqual")},r.prototype.less=function(n,e){return P("less")},r.prototype.lessEqual=function(n,e){return P("lessEqual")},r.prototype.greater=function(n,e){return P("greater")},r.prototype.greaterEqual=function(n,e){return P("greaterEqual")},r.prototype.logicalNot=function(n){return P("logicalNot")},r.prototype.logicalAnd=function(n,e){return P("logicalAnd")},r.prototype.logicalOr=function(n,e){return P("logicalOr")},r.prototype.where=function(n){return P("where")},r.prototype.select=function(n,e,t){return P("select")},r.prototype.topk=function(n,e,t){return P("topk")},r.prototype.min=function(n,e){return P("min")},r.prototype.minimum=function(n,e){return P("minimum")},r.prototype.mod=function(n,e){return P("mod")},r.prototype.max=function(n,e){return P("max")},r.prototype.maximum=function(n,e){return P("maximum")},r.prototype.all=function(n,e){return P("all")},r.prototype.any=function(n,e){return P("any")},r.prototype.squaredDifference=function(n,e){return P("squaredDifference")},r.prototype.ceil=function(n){return P("ceil")},r.prototype.floor=function(n){return P("floor")},r.prototype.round=function(n){return P("round")},r.prototype.sign=function(n){return P("sign")},r.prototype.isNaN=function(n){return P("isNaN")},r.prototype.isInf=function(n){return P("isInf")},r.prototype.isFinite=function(n){return P("isFinite")},r.prototype.pow=function(n,e){return P("pow")},r.prototype.exp=function(n){return P("exp")},r.prototype.expm1=function(n){return P("expm1")},r.prototype.softmax=function(n,e){return P("softmax")},r.prototype.log=function(n){return P("log")},r.prototype.log1p=function(n){return P("log1p")},r.prototype.sqrt=function(n){return P("sqrt")},r.prototype.rsqrt=function(n){return P("rsqrt")},r.prototype.square=function(n){return P("square")},r.prototype.reciprocal=function(n){return P("reciprocal")},r.prototype.relu=function(n){return P("relu")},r.prototype.relu6=function(n){return P("relu6")},r.prototype.prelu=function(n,e){return P("prelu")},r.prototype.elu=function(n){return P("elu")},r.prototype.eluDer=function(n,e){return P("eluDer")},r.prototype.selu=function(n){return P("selu")},r.prototype.int=function(n){return P("int")},r.prototype.clip=function(n,e,t){return P("clip")},r.prototype.abs=function(n){return P("abs")},r.prototype.complexAbs=function(n){return P("complexAbs")},r.prototype.sigmoid=function(n){return P("sigmoid")},r.prototype.softplus=function(n){return P("softplus")},r.prototype.sin=function(n){return P("sin")},r.prototype.cos=function(n){return P("cos")},r.prototype.tan=function(n){return P("tan")},r.prototype.asin=function(n){return P("asin")},r.prototype.acos=function(n){return P("acos")},r.prototype.atan=function(n){return P("atan")},r.prototype.atan2=function(n,e){return P("atan2")},r.prototype.sinh=function(n){return P("sinh")},r.prototype.cosh=function(n){return P("cosh")},r.prototype.tanh=function(n){return P("tanh")},r.prototype.asinh=function(n){return P("asinh")},r.prototype.acosh=function(n){return P("acosh")},r.prototype.atanh=function(n){return P("atanh")},r.prototype.erf=function(n){return P("erf")},r.prototype.step=function(n,e){return P("step")},r.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,P("fusedConv2d")},r.prototype.conv2d=function(n,e,t){return P("conv2d")},r.prototype.conv2dDerInput=function(n,e,t){return P("conv2dDerInput")},r.prototype.conv2dDerFilter=function(n,e,t){return P("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,P("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(n,e,t){return P("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(n,e,t){return P("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(n,e,t){return P("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(n,e,t){return P("conv3d")},r.prototype.conv3dDerInput=function(n,e,t){return P("conv3dDerInput")},r.prototype.conv3dDerFilter=function(n,e,t){return P("conv3dDerFilter")},r.prototype.maxPool=function(n,e){return P("maxPool")},r.prototype.maxPoolBackprop=function(n,e,t,a){return P("maxPoolBackprop")},r.prototype.avgPool=function(n,e){return P("avgPool")},r.prototype.avgPoolBackprop=function(n,e,t){return P("avgPoolBackprop")},r.prototype.avgPool3d=function(n,e){return P("avgPool3d")},r.prototype.avgPool3dBackprop=function(n,e,t){return P("avgPool3dBackprop")},r.prototype.maxPool3d=function(n,e){return P("maxPool3d")},r.prototype.maxPool3dBackprop=function(n,e,t,a){return P("maxPool3dBackprop")},r.prototype.reshape=function(n,e){return P("reshape")},r.prototype.cast=function(n,e){return P("cast")},r.prototype.tile=function(n,e){return P("tile")},r.prototype.pad=function(n,e,t){return P("pad")},r.prototype.transpose=function(n,e){return P("transpose")},r.prototype.gather=function(n,e,t){return P("gather")},r.prototype.gatherND=function(n,e){return P("gatherND")},r.prototype.scatterND=function(n,e,t){return P("scatterND")},r.prototype.batchToSpaceND=function(n,e,t){return P("batchToSpaceND")},r.prototype.spaceToBatchND=function(n,e,t){return P("spaceToBatchND")},r.prototype.resizeBilinear=function(n,e,t,a){return P("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(n,e,t){return P("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(n,e,t,a){return P("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(n,e,t){return P("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(n,e,t,a,i,o){return P("batchNormalization")},r.prototype.localResponseNormalization4D=function(n,e,t,a,i){return P("localResponseNormalization4D")},r.prototype.LRNGrad=function(n,e,t,a,i,o,s){return P("LRNGrad")},r.prototype.multinomial=function(n,e,t,a){return P("multinomial")},r.prototype.oneHot=function(n,e,t,a){return P("oneHot")},r.prototype.cumsum=function(n,e,t,a){return P("cumsum")},r.prototype.nonMaxSuppression=function(n,e,t,a,i){return P("nonMaxSuppression")},r.prototype.fft=function(n){return P("fft")},r.prototype.ifft=function(n){return P("ifft")},r.prototype.complex=function(n,e){return P("complex")},r.prototype.real=function(n){return P("real")},r.prototype.imag=function(n){return P("imag")},r.prototype.cropAndResize=function(n,e,t,a,i,o){return P("cropAndResize")},r.prototype.depthToSpace=function(n,e,t){return P("depthToSpace")},r.prototype.split=function(n,e,t){return P("split")},r.prototype.sparseToDense=function(n,e,t,a){return P("sparseToDense")},r.prototype.diag=function(n){return P("diag")},r.prototype.fill=function(n,e,t){return P("fill")},r.prototype.onesLike=function(n){return P("onesLike")},r.prototype.zerosLike=function(n){return P("zerosLike")},r.prototype.linspace=function(n,e,t){return P("linspace")},r.prototype.dispose=function(){return P("dispose")},r}();function P(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Wn(r,n){for(var e=r.length,t=[],a=0;a<e;a++){var i=e-1-a,o=r[i]||1;(n[n.length-1-a]||1)>1&&o===1&&t.unshift(i)}return t}function rt(r,n){for(var e=[],t=0;t<n.length;t++){var a=r[r.length-t-1],i=n.length-t-1,o=n[i];(a==null||a===1&&o>1)&&e.unshift(i)}return e}function xe(r,n){for(var e=[],t=Math.max(r.length,n.length),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=n[n.length-a-1];if(o==null&&(o=1),i===1)e.unshift(o);else if(o===1)e.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+r+" and "+n+".");e.unshift(i)}}return e}function ba(r,n,e,t,a,i,o){o===void 0&&(o="channelsLast");var s,u=Go(n),c=u[0],l=u[1];if(o==="channelsLast")s=[c,l,r[3],r[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);s=[c,l,r[1],r[1]]}return gr(r,s,e,t,a,i,!1,o)}function yi(r,n,e,t,a,i,o){o===void 0&&(o="NDHWC");var s,u,c=ju(n),l=c[0],d=c[1],p=c[2];if(o==="NDHWC")u="channelsLast",s=[l,d,p,r[4],r[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);u="channelsFirst",s=[l,d,p,r[1],r[1]]}return bi(r,s,e,t,a,!1,u,i)}function gr(r,n,e,t,a,i,o,s){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],p=u[3];if(s==="channelsLast")c=r[0],l=r[1],d=r[2],p=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=r[0],p=r[1],l=r[2],d=r[3]}var h,f=n[0],v=n[1],m=n[3],g=Go(e),b=g[0],x=g[1],y=Go(t),_=y[0],w=y[1],A=fa(f,_),S=fa(v,w),D=function(L,V,H,U,z,q,K,te){var se,le,ye;if(typeof L=="number"){se={top:L,bottom:L,left:L,right:L,type:L===0?"VALID":"NUMBER"};var be=function(Ce,Ne,Ae,Xe,He){Xe==null&&(Xe=pc(Ce,Ne,Ae));var Ge=Ce[0],vn=Ce[1],gn=li((Ge-Ne+2*Xe)/Ae+1,He);E(Ye(gn),function(){return"The output # of rows ("+gn+") must be an integer. Change the stride and/or zero pad parameters"});var Lt=li((vn-Ne+2*Xe)/Ae+1,He);return E(Ye(Lt),function(){return"The output # of columns ("+Lt+") must be an integer. Change the stride and/or zero pad parameters"}),[gn,Lt]}([V,H],q,U,L,te);le=be[0],ye=be[1]}else if(L==="same"){le=Math.ceil(V/U),ye=Math.ceil(H/z);var _e=Math.max(0,(le-1)*U+q-V),Ee=Math.max(0,(ye-1)*z+K-H),we=Math.floor(_e/2),De=_e-we,Qe=Math.floor(Ee/2);se={top:we,bottom:De,left:Qe,right:Ee-Qe,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);se={top:0,bottom:0,left:0,right:0,type:"VALID"},le=Math.ceil((V-q+1)/U),ye=Math.ceil((H-K+1)/z)}return{padInfo:se,outHeight:le,outWidth:ye}}(a,l,d,b,x,A,S,i),k=D.padInfo,F=D.outHeight,T=D.outWidth,W=o?m*p:m;return s==="channelsFirst"?h=[c,W,F,T]:s==="channelsLast"&&(h=[c,F,T,W]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:p,outHeight:F,outWidth:T,outChannels:W,padInfo:k,strideHeight:b,strideWidth:x,filterHeight:f,filterWidth:v,effectiveFilterHeight:A,effectiveFilterWidth:S,dilationHeight:_,dilationWidth:w,inShape:r,outShape:h,filterShape:n}}function bi(r,n,e,t,a,i,o,s){i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],p=u[3],h=u[4];if(o==="channelsLast")c=r[0],l=r[1],d=r[2],p=r[3],h=r[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);c=r[0],h=r[1],l=r[2],d=r[3],p=r[4]}var f,v=n[0],m=n[1],g=n[2],b=n[4],x=ju(e),y=x[0],_=x[1],w=x[2],A=ju(t),S=A[0],D=A[1],k=A[2],F=fa(v,S),T=fa(m,D),W=fa(g,k),L=function(K,te,se,le,ye,be,_e,Ee,we,De,Qe){var Ce,Ne,Ae,Xe;if(typeof K=="number"){Ce={top:K,bottom:K,left:K,right:K,front:K,back:K,type:K===0?"VALID":"NUMBER"};var He=function(Jr,Pn,Ns,Zr,yn,Ps){yn==null&&(yn=pc(Jr,Pn,Zr));var Jv=Jr[0],Zv=Jr[1],eg=Jr[2],Os=li((Jv-Pn+2*yn)/Zr+1,Ps);E(Ye(Os),function(){return"The output # of depths ("+Os+") must be an integer. Change the stride and/or zero pad parameters"});var Bs=li((Zv-Pn+2*yn)/Zr+1,Ps);E(Ye(Bs),function(){return"The output # of rows ("+Bs+") must be an integer. Change the stride and/or zero pad parameters"});var Ls=li((eg-Pn+2*yn)/Zr+1,Ps);return E(Ye(Ls),function(){return"The output # of columns ("+Ls+") must be an integer. Change the stride and/or zero pad parameters"}),[Os,Bs,Ls,Ns]}([te,se,le,1],Ee,1,ye,K,Qe);Ne=He[0],Ae=He[1],Xe=He[2]}else if(K==="same"){Ne=Math.ceil(te/ye),Ae=Math.ceil(se/be),Xe=Math.ceil(le/_e);var Ge=(Ne-1)*ye+Ee-te,vn=(Ae-1)*be+we-se,gn=(Xe-1)*_e+De-le,Lt=Math.floor(Ge/2),Qr=Ge-Lt,Mn=Math.floor(vn/2),Jn=vn-Mn,Nn=Math.floor(gn/2);Ce={top:Mn,bottom:Jn,left:Nn,right:gn-Nn,front:Lt,back:Qr,type:"SAME"}}else{if(K!=="valid")throw Error("Unknown padding parameter: "+K);Ce={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ne=Math.ceil((te-Ee+1)/ye),Ae=Math.ceil((se-we+1)/be),Xe=Math.ceil((le-De+1)/_e)}return{padInfo:Ce,outDepth:Ne,outHeight:Ae,outWidth:Xe}}(a,l,d,p,y,_,w,F,T,W,s),V=L.padInfo,H=L.outDepth,U=L.outHeight,z=L.outWidth,q=i?b*h:b;return o==="channelsFirst"?f=[c,q,H,U,z]:o==="channelsLast"&&(f=[c,H,U,z,q]),{batchSize:c,dataFormat:o,inDepth:l,inHeight:d,inWidth:p,inChannels:h,outDepth:H,outHeight:U,outWidth:z,outChannels:q,padInfo:V,strideDepth:y,strideHeight:_,strideWidth:w,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:F,effectiveFilterHeight:T,effectiveFilterWidth:W,dilationDepth:S,dilationHeight:D,dilationWidth:k,inShape:r,outShape:f,filterShape:n}}function pc(r,n,e,t){t===void 0&&(t=1);var a=fa(n,t);return Math.floor((r[0]*(e-1)-e+a)/2)}function Go(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function ju(r){return typeof r=="number"?[r,r,r]:r}function fa(r,n){return n<=1?r:r+(r-1)*(n-1)}function li(r,n){if(!n)return r;switch(n){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+n)}}function Br(r){var n=Go(r),e=n[0],t=n[1],a=n[2];return e===1&&t===1&&a===1}function Rt(r,n){return Br(r)||Br(n)}function ts(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function hc(r,n,e){if(n==="complex64"){if(r.dtype==="complex64")return r.clone();var t=Le(r.shape),a=r.toFloat(),i=e.complex(a,t);return t.dispose(),a.dispose(),i}if(!qp(r.dtype,n))return R.makeTensorFromDataId(r.dataId,r.shape,n);if(r.dtype==="complex64"){var o=e.real(r);return i=o.cast(n),o.dispose(),i}if(n==="int32")return e.int(r);if(n==="bool"){var s=J(0,r.dtype);return i=e.notEqual(r,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+n)}function jo(r,n){return R.makeTensorFromDataId(r.dataId,n,r.dtype)}function fc(r,n,e){var t=(n-r)/(e-1),a=_a(e,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+t;return Be(a,"float32")}var Sw=Object.freeze({castTensor:hc,reshapeTensor:jo,linspaceImpl:fc,upcastType:lt,axesAreInnerMostDims:ic,combineLocations:Ah,computeOutAndReduceShapes:yt,expandShapeToKeepDim:It,assertAxesAreInnerMostDims:Nt,getAxesPermutation:dn,getUndoAxesPermutation:$o,getInnerMostAxes:pn,getBroadcastDims:Wn,getReductionAxes:rt,assertAndGetBroadcastShape:xe,assertParamsConsistent:Ih,computeOutShape:Or,computePool2DInfo:ba,computePool3DInfo:yi,computeConv2DInfo:gr,computeConv3DInfo:bi,computeDefaultPad:pc,tupleValuesAreOne:Br,eitherStridesOrDilationsAreOne:Rt,convertConv2DDataFormat:ts,PARALLELIZE_THRESHOLD:cc,computeOptimalWindowSize:To});function qu(r,n){if(r.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+n.length+".");for(var e=new Float32Array(2*r.length),t=0;t<e.length;t+=2)e[t]=r[t/2],e[t+1]=n[t/2];return e}function ip(r,n){return{real:r[2*n],imag:r[2*n+1]}}function _0(r,n,e,t){r[2*t]=n,r[2*t+1]=e}function w0(r,n,e){var t=(e?2:-2)*Math.PI*(r/n);return{real:Math.cos(t),imag:Math.sin(t)}}function C0(r,n,e){var t=function(i,o,s){return function(u,c,l){for(var d=0,p=u.length,h=0,f=!1;d<p;){var v=l(c,u[h=d+(p-d>>>1)]);v>0?d=h+1:(p=h,f=!v)}return f?d:-d-1}(i,o,s||E0)}(r,n,e),a=t<0?-(t+1):t;r.splice(a,0,n)}function E0(r,n){return r>n?1:r<n?-1:0}function mc(r,n,e,t,a){return jh(r,n,e,t,a,0).selectedIndices}function vc(r,n,e,t,a,i){var o=jh(r,n,e,t,a,i,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function jh(r,n,e,t,a,i,o,s){o===void 0&&(o=!1),s===void 0&&(s=!1);for(var u=Array.from(n).map(function(y,_){return{score:y,boxIndex:_,suppressBeginIndex:0}}).filter(function(y){return y.score>a}).sort(op),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var p=u.pop(),h=p.score,f=p.boxIndex,v=p.suppressBeginIndex;if(h<a)break;for(var m=!1,g=l.length-1;g>=v;--g){var b=D0(r,f,l[g]);if(b>=t){m=!0;break}if(p.score=p.score*k0(t,c,b),p.score<=a)break}p.suppressBeginIndex=l.length,m||(p.score===h?(l.push(f),d.push(p.score)):p.score>a&&C0(u,p,op))}var x=l.length;return s&&(l.fill(0,x),d.fill(0,x)),{selectedIndices:Be(l,"int32"),selectedScores:Be(d,"float32"),numValidOutputs:J(x,"int32")}}function D0(r,n,e){var t=r.subarray(4*n,4*n+4),a=r.subarray(4*e,4*e+4),i=Math.min(t[0],t[2]),o=Math.min(t[1],t[3]),s=Math.max(t[0],t[2]),u=Math.max(t[1],t[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),h=(s-i)*(u-o),f=(d-c)*(p-l);if(h<=0||f<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,d),b=Math.min(u,p),x=Math.max(g-v,0)*Math.max(b-m,0);return x/(h+f-x)}function k0(r,n,e){var t=Math.exp(n*e*e);return e<=r?t:0}function op(r,n){return r.score-n.score||r.score===n.score&&n.boxIndex-r.boxIndex}function qh(r,n,e){var t=new Array(r.rank).fill(0),a=r.shape.slice();return n.map(function(i){a[e]=i;var o=r.slice(t,a);return t[e]+=i,o})}function Yh(r,n){for(var e=new Array(r.rank),t=0;t<e.length;t++)e[t]=r.shape[t]*n[t];var a=he(e,r.dtype);for(t=0;t<a.values.length;++t){for(var i=a.indexToLoc(t),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[t]=r.values[u]}return a.toTensor()}function Kh(r,n,e,t,a){for(var i=n[n.length-1],o=[r.length/i,i],s=o[0],u=o[1],c=ya(e,s*t),l=ya("int32",s*t),d=0;d<s;d++){for(var p=d*u,h=r.subarray(p,p+u),f=[],v=0;v<h.length;v++)f.push({value:h[v],index:v});f.sort(function(y,_){return _.value-y.value});var m=d*t,g=c.subarray(m,m+t),b=l.subarray(m,m+t);for(v=0;v<t;v++)g[v]=f[v].value,b[v]=f[v].index}var x=n.slice();return x[x.length-1]=t,[dt(c,x,e),dt(l,x,"int32")]}function gc(r,n){for(var e=[],t=0;t<n.length;t++)n[t]&&e.push(t);var a=he(r,"int32"),i=he([e.length,r.length],"int32");for(t=0;t<e.length;t++){var o=a.indexToLoc(e[t]),s=t*r.length;i.values.set(o,s)}return i.toTensor()}var S0=function(r,n){this.outputShape=[],this.outputShape=r,this.variableNames=n.map(function(a,i){return"T"+i});var e=[];this.variableNames.forEach(function(a){e.push("float v"+a+" = get"+a+"AtOutCoords();")});var t=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+t+`;
        setOutput(result);
      }
    `},A0=function(r,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=n.map(function(a,i){return"T"+i});var e=[];this.variableNames.forEach(function(a){e.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var t=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+t+`;
        setOutput(result);
      }
    `},I0=function(r,n,e){this.variableNames=["A"];var t=r.windowSize,a=r.batchSize,i=r.inSize,o=Math.ceil(i/t);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,o];var s=n==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+t+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function Xh(r,n){return["x","y","z","w","u","v"].slice(0,n).map(function(e){return r+"."+e})}function Pt(r,n){return n===1?[r]:Xh(r,n)}function Dt(){var r,n,e,t,a,i,o,s,u,c;return B().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",n="in",e="out",t="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",n="attribute",e="varying",t="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:n,varyingVs:e,varyingFs:t,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Tr(r,n,e){e===void 0&&(e="index");var t=un(n);return t.map(function(a,i){return"int "+r[i]+" = "+e+" / "+a+"; "+(i===t.length-1?"int "+r[i+1]+" = "+e+" - "+r[i]+" * "+a:"index -= "+r[i]+" * "+a)+";"}).join("")}function yc(r){var n=un(r).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var $h=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function R0(r,n,e,t){var a=[];r.forEach(function(h){var f=ie(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?a.push("uniform float "+h.name+(f>1?"["+f+"]":"")+";"):(a.push("uniform sampler2D "+h.name+";"),a.push("uniform int offset"+h.name+";"))});var i,o,s=a.join(`
`),u=r.map(function(h){return function(f,v,m){m===void 0&&(m=!1);var g="";g+=m?Qh(f):la(f);var b=f.shapeInfo.logicalShape,x=v.logicalShape;return b.length<=x.length&&(g+=m?function(y,_){var w,A=y.name,S=A.charAt(0).toUpperCase()+A.slice(1),D="get"+S+"AtOutCoords",k=y.shapeInfo.logicalShape.length,F=_.logicalShape.length,T=Wn(y.shapeInfo.logicalShape,_.logicalShape),W=Ve(F),L=F-k,V=["x","y","z","w","u","v"];w=k===0?"":F<2&&T.length>=1?"coords = 0;":T.map(function(se){return"coords."+V[se+L]+" = 0;"}).join(`
`);var H="";H=F<2&&k>0?"coords":y.shapeInfo.logicalShape.map(function(se,le){return"coords."+V[le+L]}).join(", ");var U="return outputValue;",z=ie(y.shapeInfo.logicalShape)===1,q=ie(_.logicalShape)===1;if(k!==1||z||q){if(z&&!q)U=F===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(T.length){var K=k-2,te=k-1;T.indexOf(K)>-1&&T.indexOf(te)>-1?U="return vec4(outputValue.x);":T.indexOf(K)>-1?U="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":T.indexOf(te)>-1&&(U="return vec4(outputValue.xx, outputValue.zz);")}}else U=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+D+`() {
      `+W+` coords = getOutputCoords();
      `+w+`
      vec4 outputValue = get`+S+"("+H+`);
      `+U+`
    }
  `}(f,v):function(y,_){var w=y.name,A=w.charAt(0).toUpperCase()+w.slice(1),S="get"+A+"AtOutCoords",D=_.texShape,k=y.shapeInfo.texShape,F=y.shapeInfo.logicalShape.length,T=_.logicalShape.length;if(!y.shapeInfo.isUniform&&F===T&&y.shapeInfo.flatOffset==null&&nt(k,D))return`
      float `+S+`() {
        return sampleTexture(`+w+`, resultUV);
      }
    `;var W,L=Ve(T),V=Wn(y.shapeInfo.logicalShape,_.logicalShape),H=T-F,U=["x","y","z","w","u","v"];W=F===0?"":T<2&&V.length>=1?"coords = 0;":V.map(function(q){return"coords."+U[q+H]+" = 0;"}).join(`
`);var z="";return z=T<2&&F>0?"coords":y.shapeInfo.logicalShape.map(function(q,K){return"coords."+U[K+H]}).join(", "),`
    float `+S+`() {
      `+L+` coords = getOutputCoords();
      `+W+`
      return get`+A+"("+z+`);
    }
  `}(f,v)),g}(h,n,t)}).join(`
`),c=n.texShape,l=Dt(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(l),p=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+T0+`
    `+F0+`
    `+M0+`
  `}(l);return n.isPacked?(i=function(h,f){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(y,_){var w=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];return w[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return 2 * (resTexRC.x * `+w[1]+` + resTexRC.y);
    }
  `}(0,f);case 2:return function(y,_){var w=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)];if(nt(y,_))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `;var A=Math.ceil(y[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec2(r, c);
    }
  `}(h,f);case 3:return v=h,m=f,g=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],b=Math.ceil(v[2]/2),x=b*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(y,_){for(var w=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],A=Math.ceil(y[y.length-1]/2),S=A*Math.ceil(y[y.length-2]/2),D=S,k="",F="b, r, c",T=2;T<y.length-1;T++)D*=y[y.length-T-1],k=`
      int b`+T+" = index / "+D+`;
      index -= b`+T+" * "+D+`;
    `+k,F="b"+T+", "+F;return`
    ivec`+y.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+k+`

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec`+y.length+"("+F+`);
    }
  `}(h,f)}var v,m,g,b,x}(n.logicalShape,c),o=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(l)):(i=function(h,f){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `}(0,f);case 2:return function(g,b){return nt(g,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(h,f);case 3:return v=f,m=Tr(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,b){var x=Tr(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(h,f);case 5:return function(g,b){var x=Tr(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,f);case 6:return function(g,b){var x=Tr(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,f);default:throw new Error(h.length+"-D output sampling is not yet supported")}var v,m}(n.logicalShape,c),o=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),t&&(p+=N0),[p,d,o,s,i,u,e].join(`
`)}function la(r){var n=r.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+a+"() {return "+t+";}";var i=e.shapeInfo.texShape,o=i[0],s=i[1];if(o===1&&s===1)return`
      float `+a+`() {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var u=e.shapeInfo.texShape,c=u[0],l=u[1],d=Sr(t);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+d+`);
      return sampleTexture(`+t+`, uv);
    }
  `}(r);case 1:return function(e){var t=e.name,a="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+sa(e)+`
      }
    `;var i=e.shapeInfo.texShape,o=i[0],s=i[1];if(s===1&&o===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var u=Sr(t);return s===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+o+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:o===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+s+", index + "+u+`);
      return sampleTexture(`+t+`, uv);
    }
  `}(r);case 2:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=e.shapeInfo.texShape;if(o!=null&&nt(t,o)){var s=o[0],u=o[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var c=pr(t),l=c.newShape,d=c.keptDims,p=l;if(p.length<t.length){var h=da(e,p);return`
      `+la(h)+`
      float `+i+`(int row, int col) {
        return `+i+"("+pa(["row","col"],d)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+t[1]+`, 1)));
        `+sa(e)+`
      }
    `;var f=o[0],v=o[1],m=Sr(a);return v===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+f+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:f===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+t[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+f+", "+v+`, index);
    return sampleTexture(`+a+`, uv);
  }
`}(r);case 3:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t[1]*t[2],s=t[2],u=pr(t),c=u.newShape,l=u.keptDims,d=c;if(d.length<t.length){var p=da(e,d);return`
        `+la(p)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+pa(["row","col","depth"],l)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+s+`, 1)));
        `+sa(e)+`
      }
    `;var h=e.shapeInfo.texShape,f=h[0],v=h[1],m=e.shapeInfo.flatOffset;if(v===o&&m==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+f+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(v===s&&m==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+f+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var g=Sr(a);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+s+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+f+", "+v+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `}(r);case 4:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t[3],s=t[2]*o,u=t[1]*s,c=pr(t),l=c.newShape,d=c.keptDims;if(l.length<t.length){var p=da(e,l);return`
      `+la(p)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+pa(["row","col","depth","depth2"],d)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+o+`, 1)));
        `+sa(e)+`
      }
    `;var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,v=f[0],m=f[1];if(m===u&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(m===o&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var g=Sr(a);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+g+`);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);case 5:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t[4],s=t[3]*o,u=t[2]*s,c=t[1]*u,l=pr(t),d=l.newShape,p=l.keptDims;if(d.length<t.length){var h=da(e,d);return`
      `+la(h)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+pa(["row","col","depth","depth2","depth3"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+o+`)) +
          depth3;
        `+sa(e)+`
      }
    `;var f=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===c&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(g===o&&f==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]+`,
               `+t[2]*t[3]+", "+t[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var b=Sr(a);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+o+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);case 6:return function(e){var t=e.shapeInfo.logicalShape,a=e.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=pr(t),s=o.newShape,u=o.keptDims;if(s.length<t.length){var c=da(e,s);return`
      `+la(c)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+pa(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=t[5],d=t[4]*l,p=t[3]*d,h=t[2]*p,f=t[1]*h;if(e.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+f+", "+h+", "+p+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+sa(e)+`
      }
    `;var v=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],b=m[1];if(b===f&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+p+", "+d+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(b===l&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+t[1]*t[2]*t[3]*t[4]+`,
               `+t[2]*t[3]*t[4]+`,
               `+t[3]*t[4]+`,
               `+t[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var x=Sr(a);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+f+" + col * "+h+" + depth * "+p+` +
          depth2 * `+d+" + depth3 * "+l+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+b+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(r);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function Qh(r){var n,e,t;switch(r.shapeInfo.logicalShape.length){case 0:return n=r.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),t=Dt(),`
    vec4 `+e+`() {
      return `+t.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return function(a){var i=a.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=a.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Dt();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+i+`, uv);
    }
  `}(r);case 2:return function(a){var i=a.shapeInfo.logicalShape,o=a.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),u=a.shapeInfo.texShape,c=u[0],l=u[1],d=Dt();if(u!=null&&nt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+d.texture2D+"("+o+`, uv);
      }
    `;var p=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+p[0]+", "+p[1]+`, row, col);
      return `+d.texture2D+"("+o+`, uv);
    }
  `}(r);case 3:return function(a){var i=a.shapeInfo.logicalShape,o=a.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),u=a.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var l=i.slice(1),d=da(a,l);return`
        `+Qh(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+pa(["b","row","col"],[1,2])+`);
        }
      `}var p=c[0],h=c[1],f=Math.ceil(i[2]/2),v=f*Math.ceil(i[1]/2),m=Dt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+p+", "+h+", "+v+", "+f+`, b, row, col);
      return `+m.texture2D+"("+o+`, uv);
    }
  `}(r);default:return function(a){for(var i=a.shapeInfo.logicalShape,o=i.length,s=a.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=a.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],p=l[1],h=Math.ceil(i[o-1]/2),f=h*Math.ceil(i[o-2]/2),v="int b, int row, int col",m="b * "+f+" + (row / 2) * "+h+" + (col / 2)",g=2;g<o-1;g++)v="int b"+g+", "+v,f*=i[o-g-1],m="b"+g+" * "+f+" + "+m;var b=Dt();return`
    vec4 `+u+"("+v+`) {
      int index = `+m+`;
      int texR = index / `+p+`;
      int texC = index - texR * `+p+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+p+", "+d+`);
      return `+b.texture2D+"("+s+`, uv);
    }
  `}(r)}}var T0=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,F0=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,M0=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,N0=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Sr(r){return"offset"+r}function sa(r){var n=r.name,e=ie(r.shapeInfo.logicalShape);return e<2?"return "+n+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function Ve(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function da(r,n){var e=JSON.parse(JSON.stringify(r));return e.shapeInfo.logicalShape=n,e}function pa(r,n){return n.map(function(e){return r[e]}).join(", ")}var P0=function(r,n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(r.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var a=r[r.length-1],i=Math.ceil(a/n);this.outputShape=r.slice(0,-1),i>1&&this.outputShape.push(i),t||this.variableNames.push("bestIndicesA");var o,s,u=this.outputShape,c=u.length,l=Ve(c),d=Pt("coords",c);if(i===1){var p=Ve(s=c+1);o=`
        `+p+" sourceLocR = "+p+"("+d.join()+`, 0);
        ++`+d[c-1]+`;
        `+p+" sourceLocG = "+p+"("+d.join()+`, 0);
        ++`+d[c-2]+`;
        `+p+" sourceLocA = "+p+"("+d.join()+`, 0);
        --`+d[c-1]+`;
        `+p+" sourceLocB = "+p+"("+d.join()+`, 0);
        --`+d[c-2]+";"}else s=c,o=`
        `+l+` sourceLocR = coords;
        ++`+d[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+d[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+d[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),f="."+h[s-1],v=h.map(function(S){return"int "+S}),m=Pt("sourceLocR",s-1).concat("inIdx.r"),g=Pt("sourceLocG",s-1).concat("inIdx.g"),b=Pt("sourceLocB",s-1).concat("inIdx.b"),x=Pt("sourceLocA",s-1).concat("inIdx.a"),y=e==="max"?"greaterThan":"lessThan",_=t?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",w=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",A=t?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+A+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+d[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+d[c-2]+" < "+(u[c-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+f+", sourceLocG"+f+`,
          sourceLocB`+f+", sourceLocA"+f+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+w+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+_+`
          vec4 candidate = `+w+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+y+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},O0=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterHeight,e=r.filterWidth,t=r.strideHeight,a=r.strideWidth,i=r.dilationHeight,o=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,c=s-1-r.padInfo.top,l=u-1-r.padInfo.left,d=1/(n*e);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},B0=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterDepth,e=r.filterHeight,t=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,h=l-1-r.padInfo.front,f=d-1-r.padInfo.top,v=p-1-r.padInfo.left,m=1/(n*e*t);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+f+", "+v+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+p+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},L0=function(r,n,e,t,a,i){this.outputShape=[],this.variableNames=["x","mean","variance"],xe(r,n),xe(r,e);var o="0.0";t!=null&&(xe(r,t),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";a!=null&&(xe(r,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},V0=function(r,n,e,t,a,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xe(r,n),xe(r,e);var o="vec4(0.0)";t!=null&&(xe(r,t),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";a!=null&&(xe(r,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},W0="return areal * breal - aimag * bimag;",z0="return areal * bimag + aimag * breal;",sp=function(r,n,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xe(n,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},fu="return a + b;",mu="return a - b;",up="return a * b;",Jh="return (a < 0.) ? b * a : a;",$e=function(r,n,e){this.variableNames=["A","B"],this.outputShape=xe(n,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},Zh=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Ln=function(r,n,e,t){t===void 0&&(t=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xe(n,e);var a=this.outputShape.length,i="";if(t)if(a===0||ie(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Ve(a)+` coords = getOutputCoords();
        `,a===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=Pt("coords",a);i+=`
            bool nextRowOutOfBounds =
              (`+o[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+o[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},U0=function(){function r(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,e){var t=this;return function(a,i){t.minLoc==null&&(t.minLoc=a.getUniformLocationNoThrow(i,"minVal"),t.maxLoc=a.getUniformLocationNoThrow(i,"maxVal")),a.gl.uniform1f(t.minLoc,n),a.gl.uniform1f(t.maxLoc,e)}},r}(),H0=function(){function r(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,e){var t=this;return function(a,i){t.minLoc==null&&(t.minLoc=a.getUniformLocationNoThrow(i,"minVal"),t.maxLoc=a.getUniformLocationNoThrow(i,"maxVal")),a.gl.uniform1f(t.minLoc,n),a.gl.uniform1f(t.maxLoc,e)}},r}(),G0=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},j0=function(r){this.outputShape=[],this.outputShape=Or(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var n=new Array(r.length-1);n[0]=r[0][1];for(var e=1;e<n.length;e++)n[e]=n[e-1]+r[e][1];var t=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<n.length;e++){var a=n[e-1];t.push("else if (yC < "+n[e]+") setOutput(getT"+e+"(yR, yC-"+a+"));")}var i=n.length,o=n[n.length-1];t.push("else setOutput(getT"+i+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+t.join(`
        `)+`
      }
    `},q0=function(r,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Or(r,n);var e=this.outputShape,t=e.length,a=Ve(t),i=Pt("coords",t),o=["x","y","z","w","u","v"].slice(0,t);this.variableNames=r.map(function(m,g){return"T"+g});var s=new Array(r.length-1);s[0]=r[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][n];var c=o[n],l=o.slice(-2),d=o.join(),p="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];p+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+yo(o,c,h)+`),
            vec2(`+yo(l,c,h)+`));
        }`}var f=s.length,v=s[s.length-1];p+=`
        return getChannel(
          getT`+f+"("+yo(o,c,v)+`),
          vec2(`+yo(l,c,v)+"));",this.userCode=`
      float getValue(`+o.map(function(m){return"int "+m})+`) {
        `+p+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[t-1]+" = "+i[t-1]+` + 1;
        if (`+i[t-1]+" < "+e[t-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[t-2]+" = "+i[t-2]+` + 1;
        if (`+i[t-2]+" < "+e[t-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[t-1]+" = "+i[t-1]+` - 1;
        if (`+i[t-2]+" < "+e[t-2]+` &&
            `+i[t-1]+" < "+e[t-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function yo(r,n,e){var t=r.indexOf(n);return r.map(function(a,i){return i===t?a+" - "+e:a}).join()}var Y0=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,e=r.strideWidth,t=r.padInfo.top,a=r.padInfo.left,i=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+t+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},K0=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,e=r.filterWidth,t=r.strideHeight,a=r.strideWidth,i=r.dataFormat==="channelsLast",o=n-1-r.padInfo.top,s=e-1-r.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},X0=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideDepth,e=r.strideHeight,t=r.strideWidth,a=r.padInfo.front,i=r.padInfo.top,o=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+a+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+i+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+t+" - "+o+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},$0=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterDepth,e=r.filterHeight,t=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,s=n-1-r.padInfo.front,u=e-1-r.padInfo.top,c=t-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+t+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+t+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Q0=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,e=r.strideWidth,t=r.padInfo.top,a=r.padInfo.left,i=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+t+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},J0=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,e=r.filterWidth,t=r.strideHeight,a=r.strideWidth,i=n-1-r.padInfo.top,o=e-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},cp=function(r,n,e,t){n===void 0&&(n=!1),e===void 0&&(e=null),t===void 0&&(t=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.padInfo.top,i=r.padInfo.left,o=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterHeight,d=r.filterWidth,p=4*Math.floor(r.inChannels/4),h=r.inChannels%4,f=r.dataFormat==="channelsLast",v=f?1:2,m=f?2:3,g=f?3:1,b="",x="";e&&(b=t?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,x="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+o+", "+s+`);
      const ivec2 pads = ivec2(`+a+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+p+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+f+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+f+`) {
                dotProd +=
                    getX(batch, xR, xC, `+p+`) *
                    getW(wR, wC, `+p+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+p+`, xR, xC) *
                    getW(wR, wC, `+p+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2)
              );

              if (`+f+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2),
                getW(wR, wC, `+p+` + 2, d2)
              );

              if (`+f+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1),
                  getX(batch, xR, xC, `+p+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC),
                  getX(batch, `+p+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+y+`
        `+x+`
        setOutput(result);
      }
    `},Z0=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var n=r.padInfo.front,e=r.padInfo.top,t=r.padInfo.left,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.filterDepth,d=r.filterHeight,p=r.filterWidth,h=4*Math.floor(r.inChannels/4),f=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+n+", "+e+", "+t+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(f===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(f===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(f===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},lp=function(r,n,e,t){n===void 0&&(n=!1),e===void 0&&(e=null),t===void 0&&(t=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.inHeight,i=r.inWidth,o=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.filterHeight,h=r.filterWidth,f=r.outChannels/r.inChannels,v="",m="";e&&(v=t?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,m="result = activation(result);");var g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+f+`;
        int q = d2 - d1 * `+f+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+p+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+m+`
        setOutput(result);
      }
    `},dp=function(r,n,e,t){n===void 0&&(n=!1),e===void 0&&(e=null),t===void 0&&(t=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var a=r.inHeight,i=r.inWidth,o=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.filterHeight,h=r.filterWidth,f=h,v="int xR; int xC; int xCOffset;",m=0;m<p;m++)for(var g=0;g<h;g++)v+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<p;m++)for(var b=0;b<f;b++){if(v+=`
          xR = xRCorner + `+m*l+`;
          xC = xCCorner + `+(g=2*b)*d+`;
        `,c===1){if(g<h&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+m+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<h)){var x=s%2==0?Ju(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<h&&(v+=`
              if(xR >= 0 && xR < `+a+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<h&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<h&&(v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),v+="}");g<h&&(v+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<h&&(v+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<p;m++)for(g=0;g<h;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var y="",_="";e&&(y=t?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,_="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),t&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+w+`
        `+_+`
        setOutput(result);
      }
    `},ey=function(r,n,e,t,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=r[0],o=r[1],s=r[2],u=r[3],c=n[0],l=e[0],d=e[1];this.outputShape=[c,l,d,u];var p=t==="bilinear"?1:0,h=[o-1+".0",s-1+".0"],f=h[0],v=h[1],m=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],g=m[0],b=m[1],x=m[2],y=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],_=y[0],w=y[1],A=y[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+_+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+w+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+f+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+A+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+p+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},ty=function(r,n,e){this.variableNames=["x"],this.outputShape=r;var t=r.length,a=r[r.length-1],i=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ve(t)+` coords = getOutputCoords();
        int end = `+pp(t,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+pp(t,"coords")+` = idx;
          val += getX(`+function(o,s){if(o===1)return""+s;if(o===2)return s+".x, "+s+".y";if(o===3)return s+".x, "+s+".y, "+s+".z";if(o===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(t,"coords")+`);
        }
        setOutput(val);
      }
    `};function pp(r,n){if(r===1)return""+n;if(r===2)return n+".y";if(r===3)return n+".z";if(r===4)return n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var ny=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=fi.DENSE;var n=ci(r),e=Dt();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Tr(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},ry=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=fi.DENSE;var n=ci(r),e=Dt();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Tr(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},ay=function(){function r(n,e,t){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=t,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}(),iy=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},oy=function(r){this.variableNames=["A"],this.outTexUsage=zt.DOWNLOAD;var n=Dt();this.outputShape=r,this.userCode=`
      `+$h+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},sy=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=zt.DOWNLOAD;var n=Dt();this.outputShape=r,this.userCode=`
      `+$h+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},uy=function(r,n,e){e===void 0&&(e=!1),this.variableNames=["A"];var t=Dt(),a=n[0],i=n[1];this.outputShape=r;var o="result";e&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+yc(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+a+`.0);
        vec4 values = `+t.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+t.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},cy=function(r,n,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Dt(),a=n[0],i=n[1];this.outputShape=r;var o="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;o+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+r[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+a+`.0);
              values = `+t.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+yc(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+t.output+" = "+s+`;
      }
    `},ly="return real * expR - imag * expI;",dy="return real * expI + imag * expR;",hp=function(r,n,e){this.variableNames=["real","imag"];var t=n[1];this.outputShape=n;var a=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=e?t+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+t+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+t+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},py=function(){function r(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var e=this;return function(t,a){e.valueLoc==null&&(e.valueLoc=t.getUniformLocationNoThrow(a,"value")),t.gl.uniform1f(e.valueLoc,n)}},r}(),hy=function(r,n,e){this.variableNames=["A","indices"];var t=r.slice();t[e]=n,this.outputShape=t,this.rank=t.length;var a=Ve(this.rank),i=function(o,s){var u=o.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<o.length;d++)d===s?l.push("int(getIndices("+c[d]+"))"):l.push(""+c[d]);return l.join()}(r,e);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},fy=function(r,n,e){this.sliceDim=r,this.strides=n,this.variableNames=["x","indices"],this.outputShape=e;var t=Ve(n.length),a=Ve(e.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+t+" strides = "+t+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function ef(r,n){var e=Dt();return ih(r,n,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function tf(r,n){return ch(r,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function nf(r,n){return lh(r,n,new Uint16Array([0,1,2,2,1,3]))}function wi(r,n,e,t,a,i,o){ph(e,t);var s=dh(r,n),u=r.TEXTURE_2D;return ne(r,n,function(){return r.bindTexture(u,s)}),ne(r,n,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),ne(r,n,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),ne(r,n,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),ne(r,n,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),ne(r,n,function(){return r.texImage2D(u,0,a,e,t,0,i,o,null)}),ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function rf(r,n,e,t,a){var i=Xo(e,t);return wi(r,n,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,r.FLOAT)}function af(r,n,e,t,a){var i=Xo(e,t);return wi(r,n,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function of(r,n,e,t,a){var i=Xo(e,t);return wi(r,n,i[0],i[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function sf(r,n,e,t,a){var i=_i(e,t);return wi(r,n,i[0],i[1],a.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function uf(r,n,e,t,a){var i=_i(e,t);return wi(r,n,i[0],i[1],a.internalFormatPackedHalfFloat,r.RGBA,a.textureTypeHalfFloat)}function cf(r,n,e,t){return ne(r,n,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Vu(r,n,e,"clipSpacePos",t,3,20,0)&&Vu(r,n,e,"uv",t,2,20,12)}function lf(r,n,e,t,a,i,o){var s,u,c;ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(t*a*4),u=r.UNSIGNED_BYTE,c=r.RGBA):(s=new Float32Array(t*a*4),u=r.FLOAT,c=o.internalFormatPackedFloat),s.set(i),ne(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,c,t,a,0,r.RGBA,u,s)}),ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function df(r,n,e,t){ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?ne(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):ne(r,n,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),ne(r,n,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function pf(r,n,e,t,a){var i=r.createBuffer();ne(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,i)});var o=16*e*t;return ne(r,n,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,o,r.STREAM_READ)}),ne(r,n,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),ne(r,n,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),i}function hf(r,n,e){var t=r,a=new Float32Array(e);return t.bindBuffer(t.PIXEL_PACK_BUFFER,n),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,a),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),a}function ff(r,n,e,t,a){var i=Xo(e,t),o=i[0],s=i[1],u=new Uint8Array(e*t*4);return ne(r,n,function(){return r.readPixels(0,0,o,s,a.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function mf(r,n,e,t,a,i,o,s){var u=r,c=new Float32Array(function(l,d){var p=_i(l,d);return p[0]*p[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function vf(r,n,e,t){var a=new Float32Array(e*t*4);return ne(r,n,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,a)}),a}var my=Object.freeze({createVertexShader:ef,createVertexBuffer:tf,createIndexBuffer:nf,createFloat32MatrixTexture:rf,createFloat16MatrixTexture:af,createUnsignedBytesMatrixTexture:of,createPackedMatrixTexture:sf,createFloat16PackedMatrixTexture:uf,bindVertexProgramAttributeStreams:cf,uploadDenseMatrixToTexture:lf,uploadPixelDataToTexture:df,createBufferFromOutputTexture:pf,downloadFloat32MatrixFromBuffer:hf,downloadByteEncodedFloatMatrixFromOutputTexture:ff,downloadPackedMatrixFromBuffer:mf,downloadMatrixFromPackedOutputTexture:vf}),gf=function(){function r(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=B().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,nh(e,n)):this.gl=In(e);var t="WEBGL_color_buffer_float";if(B().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=oi(this.gl,this.debug,"OES_texture_float"),Ut(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=oi(this.gl,this.debug,"OES_texture_half_float");else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(t),Ut(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=oi(this.gl,this.debug,"EXT_color_buffer_half_float");else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(t="EXT_color_buffer_float",Ut(this.gl,t))this.colorBufferFloatExtension=this.gl.getExtension(t);else{if(!Ut(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=tf(this.gl,this.debug),this.indexBuffer=nf(this.gl,this.debug),this.framebuffer=hh(this.gl,this.debug),this.textureConfig=ac(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return B().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;ne(e,this.debug,function(){return e.finish()}),ne(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ne(e,this.debug,function(){return e.deleteFramebuffer(n.framebuffer)}),ne(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),ne(e,this.debug,function(){return e.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(n,e){return this.throwIfDisposed(),rf(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(n,e){return this.throwIfDisposed(),af(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(n,e){return this.throwIfDisposed(),of(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(n,e){this.throwIfDisposed(),df(this.gl,this.debug,n,e)},r.prototype.uploadDenseMatrixToTexture=function(n,e,t,a){this.throwIfDisposed(),lf(this.gl,this.debug,n,e,t,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(n,e){return this.throwIfDisposed(),uf(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(n,e){return this.throwIfDisposed(),sf(this.gl,this.debug,n,e,this.textureConfig)},r.prototype.deleteMatrixTexture=function(n){var e=this;this.throwIfDisposed(),this.outputTexture===n&&(Wu(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ne(this.gl,this.debug,function(){return e.gl.deleteTexture(n)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,e,t){var a=this;return this.downloadMatrixDriver(n,function(){return ff(a.gl,a.debug,e,t,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(n,e,t,a,i,o){return mf(this.gl,n,0,0,0,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(n,e){return hf(this.gl,n,e)},r.prototype.createBufferFromTexture=function(n,e,t){this.bindTextureToFrameBuffer(n);var a=pf(this.gl,this.debug,e,t,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},r.prototype.createFence=function(n){var e,t,a=this;if(B().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),t=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=o}else B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),t=function(){return a.isQueryAvailable(e,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):t=function(){return!0};return{query:e,isFencePassed:t}},r.prototype.downloadMatrixFromPackedTexture=function(n,e,t){var a=this;return this.downloadMatrixDriver(n,function(){return vf(a.gl,a.debug,e,t)})},r.prototype.createProgram=function(n){this.throwIfDisposed();var e=this.gl,t=oh(e,this.debug,n),a=ef(e,this.debug),i=sh(e,this.debug);return ne(e,this.debug,function(){return e.attachShader(i,a)}),ne(e,this.debug,function(){return e.attachShader(i,t)}),uh(e,this.debug,i),this.debug&&Ao(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=cf(e,this.debug,this.program,this.vertexBuffer)),i},r.prototype.deleteProgram=function(n){var e=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&ne(this.gl,this.debug,function(){return e.gl.deleteProgram(n)})},r.prototype.setProgram=function(n){var e=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&Ao(this.gl,this.debug,this.program),ne(this.gl,this.debug,function(){return e.gl.useProgram(n)})},r.prototype.getUniformLocation=function(n,e,t){return t===void 0&&(t=!0),this.throwIfDisposed(),t?mh(this.gl,this.debug,n,e):vh(this.gl,n,e)},r.prototype.getAttributeLocation=function(n,e){var t=this;return this.throwIfDisposed(),ne(this.gl,this.debug,function(){return t.gl.getAttribLocation(n,e)})},r.prototype.getUniformLocationNoThrow=function(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)},r.prototype.setInputMatrixTexture=function(n,e,t){this.throwIfDisposed(),this.throwIfNoProgram(),gh(this.gl,this.debug,this.program,n,e,t)},r.prototype.setOutputMatrixTexture=function(n,e,t){this.setOutputMatrixTextureDriver(n,t,e)},r.prototype.setOutputPackedMatrixTexture=function(n,e,t){this.throwIfDisposed();var a=_i(e,t),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(n,i,o)},r.prototype.setOutputMatrixWriteRegion=function(n,e,t,a){this.setOutputMatrixWriteRegionDriver(t,n,a,e)},r.prototype.setOutputPackedMatrixWriteRegion=function(n,e,t,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Ao(this.gl,this.debug,this.program),si(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),ne(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return n.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=oi(this.gl,this.debug,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,e=this.getQueryTimerExtensionWebGL2(),t=n.createQuery();return n.beginQuery(e.TIME_ELAPSED_EXT,t),t}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(n){return re(this,void 0,void 0,function(){var e=this;return ae(this,function(t){switch(t.label){case 0:return[4,Fu(function(){return e.disposed||e.isQueryAvailable(n,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return t.sent(),[2,this.getQueryTime(n,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(n,e){if(e===0)return null;if(e===2){var t=this.gl;return t.getQueryParameter(n,t.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(n,e){if(e===0)return!0;if(e===2){var t=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint},r.prototype.pollFence=function(n){var e=this;return new Promise(function(t){e.addItemToPoll(function(){return n.isFencePassed()},function(){return t()})})},r.prototype.pollItems=function(){for(var n=function(t){for(var a=0;a<t.length&&t[a]();++a);return a-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=n;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},r.prototype.addItemToPoll=function(n,e){var t=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1||Fu(function(){return t.pollItems(),t.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Io(this.gl,this.debug,n,this.framebuffer),this.debug&&si(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Io(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&si(this.gl)):Wu(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(n,e){this.bindTextureToFrameBuffer(n);var t=e();return this.unbindTextureToFrameBuffer(),t},r.prototype.setOutputMatrixTextureDriver=function(n,e,t){this.throwIfDisposed();var a=this.gl;Io(a,this.debug,n,this.framebuffer),this.debug&&si(a),this.outputTexture=n,ne(a,this.debug,function(){return a.viewport(0,0,e,t)}),ne(a,this.debug,function(){return a.scissor(0,0,e,t)})},r.prototype.setOutputMatrixWriteRegionDriver=function(n,e,t,a){var i=this;this.throwIfDisposed(),ne(this.gl,this.debug,function(){return i.gl.scissor(n,e,t,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function fp(r,n){if(r.length!==n.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+n.length+" inputs");r.forEach(function(e,t){var a=e.logicalShape,i=n[t],o=i.shape;if(!nt(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+o+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!nt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var vy=function(r,n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t=e.filterWidth,a=e.inChannels,i=e.strideWidth,o=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,p=s.left,h=s.top,f=a*t,v=Dt(),m=d==="channelsLast",g=m?0:1,b=m?1:2,x="",y=0;y<=1;y++)for(var _=0;_<=1;_++)x+=`
          blockIndex = rc.y + `+_+`;
          pos = rc.x + `+y+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+o+" - "+h+`;
            d0 = offsetY + `+l+" * (pos / "+f+`);

            if(d0 < `+n[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+p+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+f+".) / "+a+`.));

              if(d1 < `+n[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*y+_)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*y+_)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+v.output+` = result;
      }
    `},gy=function(r,n,e,t,a){this.variableNames=["x"],this.outputShape=[];var i,o=n,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+t+") * sum";i=a===.5?"inversesqrt("+u+")":a===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},yy=function(r,n,e,t,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=n,this.bias=e,this.alpha=t,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+t+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+t+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},by=function(r,n,e,t,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,o=n,s=r[3]-1;this.outputShape=r;var u="float("+e+") + float("+t+") * sum";i=a===.5?"inversesqrt("+u+")":a===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},xy=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideHeight,e=r.strideWidth,t=r.dilationHeight,a=r.effectiveFilterHeight,i=r.effectiveFilterWidth,o=a-1-r.padInfo.top,s=i-1-r.padInfo.left,u=a*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+t+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},_y=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideDepth,e=r.strideHeight,t=r.strideWidth,a=r.dilationDepth,i=r.dilationHeight,o=r.dilationWidth,s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=s-1-r.padInfo.front,d=u-1-r.padInfo.top,p=c-1-r.padInfo.left,h=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+d+", "+p+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+t+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},vu=function(r,n,e,t,a,i,o){e===void 0&&(e=!1),t===void 0&&(t=!1),a===void 0&&(a=!1),i===void 0&&(i=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=e?r[1]:r[2],u=Math.ceil(s/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=t?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=t?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",f="";i&&(h=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,f="result = activation(result);");var v=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+p[0]+`);
          result += (`+d[1]+" * "+p[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+f+`

        setOutput(result);
      }
    `},wy=function(){function r(n,e,t){this.variableNames=["probs"],this.outputShape=[n,t],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var e=this;return function(t,a){e.seedLoc==null&&(e.seedLoc=t.getUniformLocation(a,"seed")),t.gl.uniform1f(e.seedLoc,n)}},r}(),Cy=function(r,n,e,t){this.variableNames=["indices"],this.outputShape=[r,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+t+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},Ey=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var n=r.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=Pt("rc",n),t=Ve(n),a=function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(n,r,e),i=function(s,u,c,l){if(s===1)return"";var d=l.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `}(n,r[r.length-1],r[r.length-2],e),o=function(s,u){var c=s.length,l=function(d,p){for(var h=[],f=0;f<=1;f++)for(var v=0;v<=1;v++){for(var m=(f===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<d;g++)m=p[p.length-1-g]+","+m;h.push(m)}return h}(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(r,e);this.userCode=`
        void main() {
          `+t+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},Dy=function(r,n,e){this.variableNames=["x"],this.outputShape=n.map(function(u,c){return u[0]+r[c]+u[1]});var t=r.length,a=Ve(t),i=n.map(function(u){return u[0]}).join(","),o=n.map(function(u,c){return u[0]+r[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,t);this.userCode=t!==1?`
      `+a+" start = "+a+"("+i+`);
      `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},ky=function(r,n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(m,g){return m[0]+r[g]+m[1]});for(var t=r.length,a=Ve(t),i=n.map(function(m){return m[0]}).join(","),o=n.map(function(m,g){return m[0]+r[g]}).join(","),s=Pt("rc",t),u=Pt("source",t),c=s[t-1]+" < "+this.outputShape[t-1],l=t===1?"source":"vec2("+u.slice(-2).join()+")",d=[a+" rc = outputLoc;",s[t-1]+` += 1;
       if(`+c+`) {
      `,t===1?"":`}
       rc = outputLoc;
       `+s[t-2]+` += 1;
       if(`+s[t-2]+" < "+this.outputShape[t-2]+") {",t===1?"":"  "+s[t-1]+` += 1;
         if(`+c+") {"],p=t===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",f=0,v=t===1?2:4;f<v;f++)h+=`
        `+d[f]+`
        if (`+p+`) {
          result[`+f+"] = float("+e+`);
        } else {
          `+a+` source = rc - start;
          result[`+f+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;h+=t===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+i+`);
      const `+a+" end = "+a+"("+o+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},gu=function(r,n,e){if(this.variableNames=["x"],n==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var t=r.filterWidth,a=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,c=r.effectiveFilterWidth,l=r.padInfo.top,d=r.padInfo.left;this.outputShape=r.outShape;var p=n==="avg",h="0.0";if(p||(h="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+i+`);
        const ivec2 pads = ivec2(`+l+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var f=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(f="avgValue / count");var v=4*Math.floor(t/4),m=t%4,g=`
      if (`+p+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+i+`);
      const ivec2 pads = ivec2(`+l+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+f+`);
      }
    `}},yu=function(r,n,e){if(this.variableNames=["x"],n==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var t=r.filterWidth,a=r.strideDepth,i=r.strideHeight,o=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,h=r.padInfo.front,f=r.padInfo.top,v=r.padInfo.left;this.outputShape=r.outShape;var m=n==="avg",g="0.0";if(m||(g="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+i+", "+o+`);
        const ivec3 pads = ivec3(`+h+", "+f+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+p+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+p+` +
                      wR * `+p+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(b="avgValue / count");var x=4*Math.floor(t/4),y=t%4,_=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+i+", "+o+`);
      const ivec3 pads = ivec3(`+h+", "+f+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+_+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(y===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+_+`
            } else if (`+(y===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+_+`
            } else if (`+(y===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+_+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},Sy=function(r,n){this.variableNames=["x"];var e=r.windowSize,t=r.batchSize,a=r.inSize,i=Math.ceil(a/e);this.outputShape=[t,i];var o="0.0",s="";n==="prod"?o="1.0":n==="min"?(o="1.0 / 1e-20",s="min"):n==="max"&&(o="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,p="vec4";n==="all"?(o="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(o="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var h="";a%e>0&&(h=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===2)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===3)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},Ay=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e="",t=0;t<4;t++){var a="thisRC = rc;";t%2==1&&(a+="thisRC.z += 1;"),t>1&&(a+="thisRC.y += 1;"),e+=`
        `+a+`
        `+(t>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+t+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(t>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Tr(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+yc(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+e+`

        setOutput(result);
      }
    `},Iy=function(r,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var t=n.shape,a=t[1],i=t[2],o=r.shape,s=o[1],u=o[2],c=[e&&s>1?a-1:a,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],p=c[1]/l[1],h=1/d,f=1/p,v=2*Math.ceil(h)+2,m=2*Math.ceil(f)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+f+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Ry=function(r,n,e,t){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],s=r[3];this.outputShape=[a,n,e,s];var u=[t&&n>1?i-1:i,t&&e>1?o-1:o],c=[t&&n>1?n-1:n,t&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},Ty=function(r,n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=r[0],i=r[1],o=r[2],s=r[3];this.outputShape=[a,n,e,s];var u=[t&&n>1?i-1:i,t&&e>1?o-1:o],c=[t&&n>1?n-1:n,t&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Fy=function(r,n,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var t=n.shape,a=t[1],i=t[2],o=r.shape,s=o[1],u=o[2],c=[e&&s>1?a-1:a,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],p=c[1]/l[1],h=1/d,f=1/p,v=2*Math.ceil(h)+2,m=2*Math.ceil(f)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+f+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},My=function(r,n,e,t){this.variableNames=["A"],this.outputShape=[];var a=r[0],i=r[1],o=r[2],s=r[3];this.outputShape=[a,n,e,s];var u=[t&&n>1?i-1:i,t&&e>1?o-1:o],c=[t&&n>1?n-1:n,t&&e>1?e-1:e],l=t?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},Ny=function(r,n){this.variableNames=["x"];var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,e!==1){var t=r.map(function(i,o){return function(s){return n.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(o)}).join(","),a=Ve(e);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+t+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},Py=function(r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=r.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=r;var t=Pt("rc",e),a=t[e-1]+" + 1 < "+this.outputShape[e-1],i=t[e-2]+" + 1 < "+this.outputShape[e-2],o=Ve(e);function s(u){var c=r.map(function(l,d){return function(p,h){return n.indexOf(p)!==-1&&r[p]!==1?r[p]+" - "+h[p]+" - 1":""+h[p]}(d,u)});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(t.slice())+`;
          if(`+a+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(t.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(t.slice())+`;
            if(`+a+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(t.slice())+`;
            }
          }
          setOutput(result);
        }
    `},mp=function(r,n,e,t,a,i,o){o===void 0&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Ve(a.length),u=Ve(i.length),c="";e===1?c="i":e===2&&(c="i, j");var l="getIndices("+c+")",d="";t===1?d="i":t===2&&(d="i, coords[1]");var p="getUpdates("+d+")",h=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+a+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+p+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Oy=function(r,n){this.variableNames=["x","segmentIds"];var e=r.windowSize,t=r.batchSize,a=r.inSize,i=r.numSegments,o=i*Math.ceil(a/e);this.outputShape=[t,o];var s=4*Math.floor(e/4),u=e%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";a%e>0&&(l=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var d="";a%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},By=function(r,n,e){var t,a;if(this.variableNames=["c","a","b"],this.outputShape=n,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)a="resRC",t="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<r&&o.push(""+i[u]);t=o.join(),a=s.join()}var c=Ve(e);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+t+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},Ly=function(){function r(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var e,t=Ve(this.rank),a="uniform int start["+this.rank+"];",i=function(o){if(o===1)return"sourceLoc";if(o<=6)return bu.slice(0,o).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);e=`
        `+t+` sourceLoc;
        `+t+` coords = getOutputCoords();
        `+n.map(function(o,s){return"sourceLoc."+bu[s]+" = start["+s+"] + coords."+bu[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+e+`
        setOutput(getSource(`+i+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(t,a){e.startLoc==null&&(e.startLoc=t.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||t.gl.uniform1iv(e.startLoc,n)}},r}(),bu=["x","y","z","w","u","v"],Vy=function(){function r(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var e=Ve(this.rank),t=Pt("coords",this.rank),a=Pt("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+i+")",s=`
      result.x = `+o+`;
      if (++`+t[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+t[this.rank-1]+`;
      if (++`+t[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+t[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+e+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return a[d]+" = "+t[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var e=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(t,a){e.startLoc==null&&(e.startLoc=t.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||t.gl.uniform1iv(e.startLoc,n)}},r}(),Wy=function(r,n,e){this.variableNames=["x"],this.outputShape=e;var t=e.length,a=Ve(e.length),i=Ve(e.length),o="";if(t===1)o="coords * strides + begin";else{var s=0;o=e.map(function(u,c){return s++,e.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+r+`);
      `+a+" strides = "+a+"("+n+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},zy=function(){function r(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(n,e,t){var a,i=vp(e,t),o=gp(n,i,t);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[o].shift();return this.usedTextures[o].push(s),s}return this.numUsedTextures++,this.log(),i===Wt.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===Wt.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===Wt.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===Wt.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===Wt.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[o].push(a),a},r.prototype.releaseTexture=function(n,e,t,a){if(this.freeTextures!=null){var i=gp(e,vp(t,a),a);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],s=o.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(t){n.gpgpu.deleteMatrixTexture(t)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(a){n.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r}();function vp(r,n){if(r===zt.UPLOAD)return Wt.PACKED_2X2_FLOAT32;if(r===zt.RENDER||r==null)return function(e){return B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Wt.PACKED_2X2_FLOAT32:Wt.UNPACKED_FLOAT32:e?Wt.PACKED_2X2_FLOAT16:Wt.UNPACKED_FLOAT16}(n);if(r===zt.DOWNLOAD||r===zt.PIXELS)return Wt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function gp(r,n,e){return r[0]+"_"+r[1]+"_"+n+"_"+e}var Uy=function(r,n){this.variableNames=["A"];for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[t]*n[t];this.outputShape=e,this.rank=e.length;var a=Ve(this.rank),i=function(o){var s=o.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+o[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<o.length;l++)c.push("imod("+u[l]+", "+o[l]+")");return c.join()}(r);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},Hy=function(r,n){this.variableNames=["A"];for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[n[t]];this.outputShape=e,this.rank=e.length;var a=Ve(this.rank),i=function(o){var s=o.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<o.length;l++)c[o[l]]=u[l];return c.join()}(n);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},Gy=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(r.length),t=0;t<e.length;t++)e[t]=r[n[t]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=Ve(this.rank),i=Xh("rc",this.rank),o=new Array(this.rank);for(t=0;t<n.length;t++)o[n[t]]=i[t];var s="vec2("+o.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+o.join()+"), "+s+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},bc=1.7580993408473768,xc=1.0507009873554805,ve=function(r,n){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},hn="if (isnan(x)) return x;",jy="return x;",yp="return abs(x);",yf=hn+`
  return (x < 0.0) ? 0.0 : x;
`,bf=hn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,xf="return (x >= 0.0) ? x : (exp(x) - 1.0);",qy=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+bc+`;
  float scale = `+xc+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,bp="return -x;",xp="return ceil(x);",_p="return floor(x);",wp="return exp(x);",Cp="return exp(x) - 1.0;",Yy=hn+`
  return sin(x);
`,Ky=hn+`
  return cos(x);
`,Xy=hn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,$y=hn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Qy=hn+`
  return atan(x);
`,Jy=hn+"return log(x + sqrt(x * x + 1.0));",Zy=hn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,eb=hn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,bo="return x;",tb="return x;",_f=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wf=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cf=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ii=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},nb=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var n=r.length,e=Pt("rc",n),t=Ve(n),a=function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(n,e),i=e.slice(-2),o=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+t+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},xo={};function _o(r,n){if(n===void 0&&(n=!1),r==="linear")return n?tb:jy;if(r==="relu")return n?_f:yf;if(r==="elu")return n?Cf:xf;if(r==="relu6")return n?wf:bf;if(r==="prelu")return n?Zh:Jh;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var rb=600,Ef=function(r){function n(e){var t,a=r.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!B().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var i=In(B().getNumber("WEBGL_VERSION"));a.binaryCache=((t=B().getNumber("WEBGL_VERSION"))in xo||(xo[t]={}),xo[t]),a.gpgpu=new gf(i),a.canvas=i.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=e,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=e.gl.canvas;return a.textureManager=new zy(a.gpgpu),a.numMBBeforeWarning=B().global.screen==null?1024:B().global.screen.height*B().global.screen.width*window.devicePixelRatio*rb/1024/1024,a.texData=new Hh(a,R),a}return ln(n,r),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(e,t,a){if(B().getBool("DEBUG")&&this.checkNumericalProblems(e),a==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:t,dtype:a,values:e,usage:zt.UPLOAD}),i},n.prototype.move=function(e,t,a,i){if(B().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:a,dtype:i,values:t,usage:zt.UPLOAD})},n.prototype.readSync=function(e){var t=this.texData.get(e),a=t.values,i=t.dtype,o=t.complexTensors,s=t.slice,u=t.shape,c=t.isPacked;if(s!=null){var l=void 0;l=c?new ii(u,bo):new ve(u,bo);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeData(d.dataId),p}if(a!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return a;var h,f,v=this.activeTimers!=null;return v&&(h=sn()),i==="complex64"?f=qu(o.real.dataSync(),o.imag.dataSync()):f=this.getValuesFromTexture(e),v&&(this.downloadWaitMs+=sn()-h),this.convertAndCacheOnCPU(e,f)},n.prototype.read=function(e){return re(this,void 0,void 0,function(){var t,a,i,o,s,u,c,l,d,p,h,f,v,m,g,b,x,y,_,w,A,S;return ae(this,function(D){switch(D.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(k){return t.push(k)})];if(a=this.texData.get(e),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensors,l=a.isPacked,s!=null)return d=void 0,d=l?new ii(o,bo):new ve(o,bo),p=this.runWebGLProgram(d,[{dataId:e,shape:o,dtype:u}],u),h=this.read(p.dataId),this.disposeData(p.dataId),[2,h];if(i!=null)return[2,this.convertAndCacheOnCPU(e)];if(!B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&B().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=null,u!=="complex64"&&B().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(e),m=this.texData.get(v.dataId),f=(S=this.gpgpu).createBufferFromTexture.apply(S,[m.texture].concat(ci(o)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:D.sent(),D.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=D.sent(),x=b[0],y=b[1],g=qu(x,y),[3,5];case 4:f==null?g=this.getValuesFromTexture(e):(_=ie(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(f,_)),D.label=5;case 5:return v!=null&&this.disposeData(v.dataId),w=this.convertAndCacheOnCPU(e,g),A=this.pendingRead.get(e),this.pendingRead.delete(e),A.forEach(function(k){return k(w)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,w]}})})},n.prototype.checkNumericalProblems=function(e){if(e!=null)for(var t=0;t<e.length;t++){var a=e[t];if(!rh(a))throw B().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(e){var t,a=this.texData.get(e),i=a.shape,o=a.dtype,s=a.isPacked,u=ie(i);if(B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[l.texture].concat(ci(i))).subarray(0,u);return this.disposeData(c.dataId),d}var p=B().getBool("WEBGL_PACK")&&s===!0,h=p?Ro(i):i,f=p?new sy(h):new oy(h),v=this.runWebGLProgram(f,[{shape:h,dtype:o,dataId:e}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),g},n.prototype.time=function(e){return re(this,void 0,void 0,function(){var t,a,i,o,s,u,c;return ae(this,function(l){switch(l.label){case 0:return t=this.activeTimers,a=[],i=!1,this.programTimersStack==null?(this.programTimersStack=a,i=!0):this.activeTimers.push(a),this.activeTimers=a,e(),o=zn(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=zn(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=t,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return c=l.sent(),u.kernelMs=zp(c),u.getExtraProfileInfo=function(){return c.map(function(d,p){return{name:s[p],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sn(),endMs:null}},n.prototype.endTimer=function(e){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=sn(),e)},n.prototype.getQueryTime=function(e){return re(this,void 0,void 0,function(){var t;return ae(this,function(a){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var t=this.texData.get(e),a=t.texture,i=t.dtype,o=t.texShape,s=t.usage,u=t.isPacked,c=t.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var p=this.texData.get(e);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getDataInfo=function(e){return this.texData.get(e)},n.prototype.getCPUBackend=function(){return B().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=R.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var a=this;return t===void 0&&(t=128),this.getCPUBackend()!=null&&e.every(function(i){return a.texData.get(i.dataId).texture==null&&i.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,t){var a=this.makeOutput(e.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(t.clone())},a},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,a);if(ie(a)===0)return dt([],a,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=lc(e.shape,t,a);if(i||!o){var s=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vy(a):new Ly(a),u=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,a)},n.prototype.shallowSlice=function(e,t,a){var i=this.texData.get(e.dataId),o=this.makeOutput(a,e.dtype),s=this.texData.get(o.dataId);Object.assign(s,i),s.shape=a,s.dtype=e.dtype;var u=dc(t,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),o},n.prototype.stridedSlice=function(e,t,a,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,a,i);var o=Zo(t,a,i);if(o.some(function(u){return u===0}))return dt([],o);var s=new Wy(t,i,o);return this.compileAndRun(s,[e])},n.prototype.reverse=function(e,t){var a=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Py(e.shape,t):new Ny(e.shape,t);return this.compileAndRun(a,[e])},n.prototype.concat=function(e,t){if(e[0].dtype==="complex64"){var a=e.map(function(h){return $t(h)}),i=e.map(function(h){return kn(h)});return gt(this.concat(a,t),this.concat(i,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(e.length===1)return e[0];if(e.length>B().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),s=this.concat(e.slice(0,o),t),u=this.concat(e.slice(o),t);return this.concat([s,u],t)}if(B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new q0(e.map(function(h){return h.shape}),t);return this.compileAndRun(c,e)}var l=Or(e.map(function(h){return h.shape}),t),d=e.map(function(h){return h.as2D(-1,ie(h.shape.slice(t)))}),p=new j0(d.map(function(h){return h.shape}));return this.compileAndRun(p,d).reshape(l)},n.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bp,e.dtype);var t=new ve(e.shape,bp);return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,a,i){var o=a?e.shape[2]:e.shape[1],s=i?t.shape[1]:t.shape[2],u=a?e.shape[1]:e.shape[2],c=e.shape[0];if((o===1||s===1)&&u>1e3){a&&(e=e.transpose([0,2,1])),i&&(t=t.transpose([0,2,1]));var l=s===1?e:e.as3D(c,u,1),d=s===1?2:1,p=s===1?t.as3D(c,1,u):t;return this.multiply(l,p).sum(d,!0)}var h=lt(e.dtype,t.dtype),f=new vu(e.shape,[c,o,s],a,i);return this.compileAndRun(f,[e,t],h)},n.prototype.fusedBatchMatMul=function(e){var t=e.a,a=e.b,i=e.transposeA,o=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?t.shape[2]:t.shape[1],d=o?a.shape[1]:a.shape[2],p=t.shape[0],h=lt(t.dtype,a.dtype),f=s!=null,v=c!=null,m=u?_o(u,!0):null,g=new vu(t.shape,[p,l,d],i,o,f,m,v),b=[t,a];return s&&b.push(s),c&&b.push(c),this.compileAndRun(g,b,h)},n.prototype.multiply=function(e,t){if(e.dtype==="complex64"){var a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=new sp(W0,e.shape,t.shape),s=new sp(z0,e.shape,t.shape),u=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag),this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(o,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,up,e.dtype);var p=new $e(up,e.shape,t.shape);return this.compileAndRun(p,[e,t],e.dtype)},n.prototype.batchNormalization=function(e,t,a,i,o,s){var u=[e,t,a],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(o!=null&&(l=o.shape,u.push(o)),B().getBool("WEBGL_PACK_NORMALIZATION")){var d=new V0(e.shape,t.shape,a.shape,c,l,i);return this.compileAndRun(d,u)}var p=new L0(e.shape,t.shape,a.shape,c,l,i);return this.compileAndRun(p,u)},n.prototype.localResponseNormalization4D=function(e,t,a,i,o){var s=B().getBool("WEBGL_PACK_NORMALIZATION")?new by(e.shape,t,a,i,o):new gy(e.shape,t,a,i,o);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,t,a,i,o,s,u){var c=new yy(t.shape,i,o,s,u);return this.compileAndRun(c,[t,a,e])},n.prototype.tile=function(e,t){if(e.dtype==="string"){var a=this.readSync(e.dataId).map(function(o){return pi(o)});return Yh(he(e.shape,e.dtype,a),t)}var i=new Uy(e.shape,t);return this.compileAndRun(i,[e])},n.prototype.pad=function(e,t,a){var i=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ky(e.shape,t,a):new Dy(e.shape,t,a);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var a=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gy(e.shape,t):new Hy(e.shape,t);return this.compileAndRun(a,[e])},n.prototype.gather=function(e,t,a){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,a);var i=new hy(e.shape,t.size,a);return this.compileAndRun(i,[e,t])},n.prototype.batchToSpaceND=function(e,t,a){E(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(d,p){return d*p}),o=zo(e.shape,t,i),s=Uo(o.length,t.length),u=Ho(e.shape,t,i),c=Oh(a,t.length),l=Bh(u,a,t.length);return e.reshape(o).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,t,a){E(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(p,h){return p*h}),o=[[0,0]];o.push.apply(o,a);for(var s=1+t.length;s<e.shape.length;++s)o.push([0,0]);var u=e.pad(o),c=zo(u.shape,t,i,!1),l=Uo(c.length,t.length,!1),d=Ho(u.shape,t,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.reduce=function(e,t,a){var i=e.shape[0],o=e.shape[1],s=To(o),u=new Sy({windowSize:s,inSize:o,batchSize:i},t),c=this.compileAndRun(u,[e],a);return c.shape[1]===1?c:this.reduce(c,t,a)},n.prototype.argReduce=function(e,t,a){a===void 0&&(a=null);var i=e.shape[0],o=e.shape[1];a!=null&&(i=a.shape[0],o=a.shape[1]);var s=To(o),u=new I0({windowSize:s,inSize:o,batchSize:i},t,a==null),c=[e];a!=null&&c.push(a);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(e,t,l)},n.prototype.argReducePacked=function(e,t,a){a===void 0&&(a=null);var i=a!=null?a.shape:e.shape,o=To(i[i.length-1]),s=new P0(i,o,t,a==null),u=a==null?[e]:[e,a],c=this.compileAndRun(s,u,"int32");return c.rank===e.rank?this.argReducePacked(e,t,c):c},n.prototype.sum=function(e,t){Nt("sum",t,e.rank);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o),u=du(e.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o),u=du(e.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(e,t,a){var i=0,o=dn([i],e.rank),s=e;o!=null&&(s=e.transpose(o),i=pn(1,e.rank)[0]);var u=function(h,f,v){for(var m=[],g=h.length,b=0;b<g;b++)b!==f?m.push(h[b]):m.push(v);return m}(s.shape,i,a),c=ie([s.shape[i]]),l=s.as2D(-1,c),d=du(e.dtype),p=this.segOpCompute(l,"unsortedSegmentSum",t,d,a).reshape(u);return o!=null&&(p=p.transpose($o(o))),p},n.prototype.segOpCompute=function(e,t,a,i,o){var s=e.shape[0],u=e.shape[1],c=function(p,h){var f,v=!1;for(p<=cc?(f=p,v=!0):f=Bo(p,Math.floor(Math.sqrt(p)));!v;)f>h||f===p?v=!0:f=Bo(p,f+1);return f}(u,o),l=new Oy({windowSize:c,inSize:u,batchSize:s,numSegments:o},t),d=this.compileAndRun(l,[e,a],i);return d.shape[1]===o?d:(a=Wo(0,o).tile([u/c]),this.segOpCompute(d,t,a,i,o))},n.prototype.argMinMaxReduce=function(e,t,a){var i=[t];if(Nt("arg"+a.charAt(0).toUpperCase()+a.slice(1),i,e.rank),!B().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=yt(e.shape,i),s=o[0],u=ie(o[1]),c=e.as2D(-1,u);return this.argReduce(c,a).reshape(s)}return this.argReducePacked(e,a)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,a,i){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new ty(e.shape,a,i);return this.compileAndRun(o,[e])},n.prototype.equal=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(equal(a, b));
`,"bool");var a=new $e("return float(a == b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.notEqual=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(notEqual(a, b));
`,"bool");var a=new $e("return float(a != b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThan(a, b));
`,"bool");var a=new $e("return float(a < b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.lessEqual=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new $e("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new $e("return float(a > b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.greaterEqual=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new $e("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.logicalNot=function(e){var t=new ve(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new $e("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.logicalOr=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new $e("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")},n.prototype.select=function(e,t,a){var i=new By(e.rank,t.shape,t.rank);return this.compileAndRun(i,[e,t,a],lt(t.dtype,a.dtype))},n.prototype.where=function(e){Lo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return gc(e.shape,t)},n.prototype.topk=function(e,t,a){return Kh(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){Nt("min",t,e.rank);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.mod=function(e,t){var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new $e(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Nt("max",t,e.rank);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.all=function(e,t){Nt("all",t,e.rank);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,t){Nt("any",t,e.rank);var a=yt(e.shape,t),i=a[0],o=ie(a[1]),s=e.as2D(-1,o);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var a=new $e(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,t.shape);return this.compileAndRun(a,[e,t],"float32")},n.prototype.floorDiv=function(e,t){if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new $e(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,t.shape);return this.compileAndRun(a,[e,t],"int32")},n.prototype.add=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,fu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var a=lt(e.dtype,t.dtype);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,fu,a);var i=new $e(fu,e.shape,t.shape);return this.compileAndRun(i,[e,t],a)},n.prototype.packedUnaryOp=function(e,t,a){var i=new ii(e.shape,t);return this.compileAndRun(i,[e],a)},n.prototype.packedBinaryOp=function(e,t,a,i,o){o===void 0&&(o=!1);var s=new Ln(a,e.shape,t.shape,o);return this.compileAndRun(s,[e,t],i)},n.prototype.complexSeparableBinaryOp=function(e,t,a){var i=this,o=this.texData.get(e.dataId),s=this.texData.get(t.dataId),u=[[o.complexTensors.real,s.complexTensors.real],[o.complexTensors.imag,s.complexTensors.imag]].map(function(p){var h=p[0],f=p[1],v=i.makeComplexComponentTensorInfo(e,h),m=i.makeComplexComponentTensorInfo(t,f),g=new $e(a,e.shape,t.shape);return i.compileAndRun(g,[v,m],lt(h.dtype,f.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>B().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),a=this.addN(e.slice(0,t)),i=this.addN(e.slice(t));return this.addN([a,i])}var o=e.map(function(c){return c.dtype}).reduce(function(c,l){return lt(c,l)}),s=e.map(function(c){return c.shape}),u=B().getBool("WEBGL_PACK")?new A0(e[0].shape,s):new S0(e[0].shape,s);return this.compileAndRun(u,e,o)},n.prototype.subtract=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,mu);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var a=lt(e.dtype,t.dtype);if(B().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,mu,e.dtype);var i=new $e(mu,e.shape,t.shape);return this.compileAndRun(i,[e,t],a)},n.prototype.pow=function(e,t){var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new $e(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,t.shape),i=lt(e.dtype,t.dtype);return this.compileAndRun(a,[e,t],i)},n.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xp,e.dtype);var t=new ve(e.shape,xp);return this.compileAndRun(t,[e])},n.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_p,e.dtype);var t=new ve(e.shape,_p);return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new ve(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new ve(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.isInf=function(e){var t=new ve(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.isFinite=function(e){var t=new ve(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},n.prototype.round=function(e){var t=new ve(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(t,[e])},n.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wp,e.dtype);var t=new ve(e.shape,wp);return this.compileAndRun(t,[e])},n.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Cp,e.dtype);var t=new ve(e.shape,Cp);return this.compileAndRun(t,[e])},n.prototype.softmax=function(e,t){var a=at([t],e.shape),i=this.max(e,a),o=It(i.shape,a),s=this.subtract(e,i.reshape(o)),u=this.exp(s),c=this.sum(u,a).reshape(o);return this.realDivide(u,c)},n.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var t=new ve(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new ve(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new ve(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new ve(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new ve(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=B().getBool("WEBGL_PACK")?new ii(e.shape,_f):new ve(e.shape,yf),this.compileAndRun(t,[e])},n.prototype.relu6=function(e){var t;return t=B().getBool("WEBGL_PACK")?new ii(e.shape,wf):new ve(e.shape,bf),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(Zh,e.shape,t.shape):new $e(Jh,e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.elu=function(e){if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Cf,e.dtype);var t=new ve(e.shape,xf);return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,t.shape):new $e("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.selu=function(e){var t=new ve(e.shape,qy);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new ve(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},n.prototype.clip=function(e,t,a){var i,o=(i=B().getBool("WEBGL_PACK_CLIP")?new H0(e.shape):new U0(e.shape)).getCustomSetupFunc(t,a);return this.compileAndRun(i,[e],null,o)},n.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yp,e.dtype);var t=new ve(e.shape,yp);return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),a=new G0(e.shape),i=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(a,i)},n.prototype.sigmoid=function(e){var t=new ve(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new ve(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new ve(e.shape,Yy);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new ve(e.shape,Ky);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new ve(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new ve(e.shape,Xy);return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new ve(e.shape,$y);return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new ve(e.shape,Qy);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new $e(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,t.shape);return this.compileAndRun(a,[e,t])},n.prototype.sinh=function(e){var t=new ve(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new ve(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new ve(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new ve(e.shape,Jy);return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new ve(e.shape,Zy);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new ve(e.shape,eb);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new ve(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var a=new ve(e.shape,function(i){return i===void 0&&(i=0),hn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(t));return this.compileAndRun(a,[e])},n.prototype.conv2dByMatMul=function(e,t,a,i,o,s){var u=e.shape,c=this.texData.get(e.dataId),l=a.inChannels,d=u[0]*u[1]*u[2],p=a.outChannels,h=a.dataFormat==="channelsLast",f=(d===1||p===1)&&l>1e3,v=u[2]%2!=0&&!!c.isPacked;if(f||!B().getBool("WEBGL_LAZILY_UNPACK")||!B().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(e,[1,m,a.inChannels]),b=this.reshape(t,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:s}),a.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),y={dataId:e.dataId,shape:[1,x,a.inChannels],dtype:e.dtype},_=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,E(ui(c.shape,y.shape),function(){return"packed reshape "+c.shape+" to "+y.shape+" isn't free"});var w=this.reshape(t,[1,a.inChannels,a.outChannels]),A=this.fusedBatchMatMul({a:y,b:w,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:s}),S=this.texData.get(A.dataId);return E(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=_,S.shape=a.outShape,R.makeTensorFromDataId(A.dataId,a.outShape,A.dtype)},n.prototype.conv2dWithIm2Row=function(e,t,a,i,o,s){var u=a.filterWidth,c=a.filterHeight,l=a.inChannels,d=a.outWidth,p=a.outHeight,h=a.dataFormat==="channelsLast",f=u*c*l,v=p*d,m=[f,v],g=e.squeeze([0]),b=t.reshape([1,f,-1]),x=new vy(m,g.shape,a),y=this.compileAndRun(x,[g]).reshape([1,m[0],m[1]]),_=i!=null,w=s!=null,A=o?_o(o,!0):null,S=new vu(y.shape,[1,v,a.outChannels],!0,!1,_,A,w),D=[y,b];i&&D.push(i),w&&D.push(s);var k=this.compileAndRun(S,D);return h?k.reshape([1,p,d,a.outChannels]):k.reshape([1,a.outChannels,p,d])},n.prototype.fusedConv2d=function(e){var t=e.input,a=e.filter,i=e.convInfo,o=e.bias,s=e.activation,u=e.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,a,i,o,s,u);if(B().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,a,i,o,s,u);var c=o!=null,l=u!=null,d=s?_o(s,!1):null,p=new cp(i,c,d,l),h=[t,a];return o&&h.push(o),u&&h.push(u),this.compileAndRun(p,h)},n.prototype.conv2d=function(e,t,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(e,t,a);if(B().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,t,a);var i=new cp(a);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerInput=function(e,t,a){var i=new K0(a);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerFilter=function(e,t,a){var i=new Y0(a);return this.compileAndRun(i,[e,t])},n.prototype.fusedDepthwiseConv2D=function(e){var t,a=e.input,i=e.filter,o=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=B().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,d=u?_o(u,l):null,p=[a,i],h=s!=null,f=c!=null;return h&&p.push(s),f&&p.push(c),l?(t=new dp(o,h,d,f),this.compileAndRun(t,p)):(t=new lp(o,h,d,f),this.compileAndRun(t,p))},n.prototype.depthwiseConv2D=function(e,t,a){var i;return B().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(i=new dp(a),this.compileAndRun(i,[e,t])):(i=new lp(a),this.compileAndRun(i,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,a){var i=new J0(a);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,a){var i=new Q0(a);return this.compileAndRun(i,[e,t])},n.prototype.conv3d=function(e,t,a){var i=new Z0(a);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerInput=function(e,t,a){var i=new $0(a);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerFilter=function(e,t,a){var i=new X0(a);return this.compileAndRun(i,[e,t])},n.prototype.maxPool=function(e,t){var a=new gu(t,"max",!1);return this.compileAndRun(a,[e])},n.prototype.avgPool=function(e,t){var a=new gu(t,"avg",!1);return this.compileAndRun(a,[e],"float32")},n.prototype.maxPoolBackprop=function(e,t,a,i){var o=new gu(i,"max",!0),s=this.compileAndRun(o,[t]),u=new xy(i),c=this.compileAndRun(u,[e,s],t.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(e,t,a){var i=new O0(a);return this.compileAndRun(i,[e],t.dtype)},n.prototype.cast=function(e,t){return hc(e,t,this)},n.prototype.unstack=function(e,t){for(var a=e.shape[t],i=new Array(e.rank-1),o=0,s=0;s<e.rank;s++)s!==t&&(i[o++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[t]=1;var l=new Array(a);for(s=0;s<l.length;s++)u[t]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.avgPool3d=function(e,t){var a=new yu(t,"avg",!1);return this.compileAndRun(a,[e],"float32")},n.prototype.avgPool3dBackprop=function(e,t,a){var i=new B0(a);return this.compileAndRun(i,[e],t.dtype)},n.prototype.maxPool3d=function(e,t){var a=new yu(t,"max",!1);return this.compileAndRun(a,[e],"float32")},n.prototype.maxPool3dBackprop=function(e,t,a,i){var o=new yu(i,"max",!0),s=this.compileAndRun(o,[t]),u=new _y(i),c=this.compileAndRun(u,[e,s],t.dtype);return s.dispose(),c},n.prototype.reshape=function(e,t){var a=this.texData.get(e.dataId);if(a.isPacked&&!ui(e.shape,t)&&(a.texture===null||!ui(a.shape,t))){var i=this.packedReshape(e,t);return R.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return jo(e,t)},n.prototype.resizeBilinear=function(e,t,a,i){var o=B().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ty(e.shape,t,a,i):new Ry(e.shape,t,a,i);return this.compileAndRun(o,[e],"float32")},n.prototype.resizeBilinearBackprop=function(e,t,a){var i=new Iy(e,t,a);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,t,a,i){var o=new My(e.shape,t,a,i);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,a){var i=new Fy(e,t,a);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,t,a,i){var o=t?e:Ft(e),s=o.shape[0],u=o.shape[1],c=new wy(s,u,a),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[o],"int32",l)},n.prototype.oneHot=function(e,t,a,i){var o=new Cy(e.size,t,a,i);return this.compileAndRun(o,[e])},n.prototype.diag=function(e){var t=new iy(e.size);return this.compileAndRun(t,[e])},n.prototype.nonMaxSuppression=function(e,t,a,i,o){return Lo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),mc(e.dataSync(),t.dataSync(),a,i,o)},n.prototype.cropAndResize=function(e,t,a,i,o,s){var u=new ey(e.shape,t.shape,i,o,s);return this.compileAndRun(u,[e,t,a],"float32")},n.prototype.depthToSpace=function(e,t,a){E(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var i=e.shape[0],o=a==="NHWC"?e.shape[1]:e.shape[2],s=a==="NHWC"?e.shape[2]:e.shape[3],u=a==="NHWC"?e.shape[3]:e.shape[1],c=o*t,l=s*t,d=u/(t*t),p=new ay(a==="NHWC"?[i,c,l,d]:[i,d,c,l],t,a);return this.compileAndRun(p,[e])},n.prototype.split=function(e,t,a){return qh(e,t,a)},n.prototype.scatterND=function(e,t,a){var i=gi(0,e,a),o=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],p=e.reshape([s,o]),h=t.reshape([s,u]);if(l===0)return jo(dt([]),a);var f=J(0),v=new mp(s,o,p.rank,h.rank,c,d);return this.compileAndRun(v,[h,p,f]).reshape(a)},n.prototype.sparseToDense=function(e,t,a,i){var o=gi(0,e,a),s=o.sliceRank,u=o.numUpdates,c=o.strides,l=o.outputSize,d=new mp(u,s,e.rank,t.rank,c,[l,1],!1);return this.compileAndRun(d,[t,e,i]).reshape(a)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var a=this.texData.get(e.dataId),i=new hp(ly,e.shape,t),o=new hp(dy,e.shape,t),s=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(o,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(e,t){var a=t.shape,i=a[a.length-1],o=uc(e,t),s=o[0],u=o[1],c=o[2],l=o[3],d=t.reshape([u,i]),p=e.reshape([e.size/c,c]),h=new fy(i,l,[u,c]);return this.compileAndRun(h,[p,d]).reshape(s)},n.prototype.fill=function(e,t,a){if((a=a||xa(t))==="string"){var i=di(a,ie(e));return i.fill(t),R.makeTensor(i,e,a,this)}var o=new py(e,t),s=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],a,s)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},n.prototype.linspace=function(e,t,a){return fc(e,t,a)},n.prototype.makeTensorInfo=function(e,t){var a=this.write(null,e,t);return this.texData.get(a).usage=null,{dataId:a,shape:e,dtype:t}},n.prototype.makeOutput=function(e,t){var a=this.makeTensorInfo(e,t).dataId;return R.makeTensorFromDataId(a,e,t,this)},n.prototype.unpackTensor=function(e){var t=new nb(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},n.prototype.packTensor=function(e){var t=new Ey(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},n.prototype.packedReshape=function(e,t){var a=[mi(e.shape)].concat(vi(e.shape)),i={dtype:e.dtype,shape:a,dataId:e.dataId},o=[mi(t)].concat(vi(t)),s=new Ay(o,a),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}},n.prototype.decode=function(e){var t,a=this.texData.get(e),i=a.isPacked,o=a.shape,s=a.dtype,u=Ro(o);return t=i?new ry(u):new ny(u),{dtype:s,shape:o,dataId:this.runWebGLProgram(t,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(e,t,a,i,o){var s=this;o===void 0&&(o=!1);var u=this.makeTensorInfo(e.outputShape,a),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===fi.DENSE){var l=ci(e.outputShape);c.texShape=l.map(function(x){return 2*x})}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),ie(u.shape)===0)return c.values=ya(u.dtype,0),u;var d=[],p=t.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var y=s.texData.get(x.dataId);if(y.texture==null){if(!e.packedInputs&&ie(x.shape)<=B().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=x.shape)}else if(!!y.isPacked!=!!e.packedInputs)x=y.isPacked?s.unpackTensor(x):s.packTensor(x),d.push(x),y=s.texData.get(x.dataId);else if(y.isPacked&&!ui(y.shape,x.shape)){var _=x,w=x.shape;x.shape=y.shape,x=s.packedReshape(x,w),d.push(x),y=s.texData.get(x.dataId),_.shape=w}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:y,isUniform:!1}});this.uploadToGPU(u.dataId);var h,f={shape:u.shape,texData:c,isUniform:!1},v=function(x,y,_){var w="";y.concat(_).forEach(function(D){var k=D.texData!=null&&D.texData.slice!=null&&D.texData.slice.flatOffset>0,F=D.isUniform?"uniform":D.texData.texShape;w+=D.shape+"_"+F+"_"+k});var A=x.userCode,S=x.constructor.name;return S+="_"+w+"_"+A}(e,p,f),m=this.getAndSaveBinary(v,function(){return function(x,y,_,w){var A=y.userCode,S=_.map(function(z,q){var K={logicalShape:z.shape,texShape:z.isUniform?null:z.texData.texShape,isUniform:z.isUniform,isPacked:!z.isUniform&&z.texData.isPacked,flatOffset:null};return z.texData!=null&&z.texData.slice!=null&&z.texData.slice.flatOffset>0&&(K.flatOffset=z.texData.slice.flatOffset),{name:y.variableNames[q],shapeInfo:K}}),D=S.map(function(z){return z.shapeInfo}),k={logicalShape:w.shape,texShape:w.texData.texShape,isUniform:!1,isPacked:w.texData.isPacked,flatOffset:null},F=R0(S,k,A,y.packedInputs),T=x.createProgram(F),W=null,L=x.getUniformLocation(T,"NAN",!1);B().getNumber("WEBGL_VERSION")===1&&(W=x.getUniformLocation(T,"INFINITY",!1));for(var V={},H=0;H<y.variableNames.length;H++){var U=y.variableNames[H];V[U]=x.getUniformLocation(T,U,!1),V["offset"+U]=x.getUniformLocation(T,"offset"+U,!1)}return{program:y,source:F,webGLProgram:T,uniformLocations:V,inShapeInfos:D,outShapeInfo:k,infLoc:W,nanLoc:L}}(s.gpgpu,e,p,f)}),g=this.activeTimers!=null;if(g&&(h=this.startTimer()),function(x,y,_,w,A){fp(y.inShapeInfos,_),fp([y.outShapeInfo],[w]);var S=w.texData.texture,D=w.texData.texShape;w.texData.isPacked?x.setOutputPackedMatrixTexture(S,D[0],D[1]):x.setOutputMatrixTexture(S,D[0],D[1]),x.setProgram(y.webGLProgram),B().getNumber("WEBGL_VERSION")===1&&y.infLoc!==null&&x.gl.uniform1f(y.infLoc,1/0),y.nanLoc!==null&&x.gl.uniform1f(y.nanLoc,NaN),_.forEach(function(k,F){var T=y.program.variableNames[F],W=y.uniformLocations[T],L=y.uniformLocations["offset"+T];if(W!=null)if(k.isUniform)if(ie(k.shape)<2)x.gl.uniform1f(W,k.uniformValues[0]);else{var V=k.uniformValues;V instanceof Float32Array||(V=new Float32Array(V)),x.gl.uniform1fv(W,V)}else k.texData.slice!=null&&L!=null&&x.gl.uniform1i(L,k.texData.slice.flatOffset),x.setInputMatrixTexture(k.texData.texture,W,F)}),A?.(x,y.webGLProgram),x.executeProgram()}(this.gpgpu,m,p,f,i),d.forEach(function(x){return s.disposeData(x.dataId)}),g&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!B().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(e,t,a,i,o){o===void 0&&(o=!1),a=a||t[0].dtype;var s=this.runWebGLProgram(e,t,a,i,o);return R.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var e=this;this.disposed||(B().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=j(function(){if(!B().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=B().getBool("DEBUG");B().set("DEBUG",!1);var a=e.abs(J(1e-8)).dataSync()[0];if(B().set("DEBUG",t),a>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var t,a=this.texData.get(e),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var d,p=this.activeTimers!=null;p&&(d=sn());var h=a.texShape;if(h==null&&(h=xh(i,l),a.texShape=h),s!=null){var f=Ro(i),v=void 0,m=h[1],g=h[0],b=s instanceof Uint8Array;l?(m=(t=_i(h[0],h[1]))[0],g=t[1],v=new cy(f,[g,m],b)):v=new uy(f,[g,m],b);var x=this.makeTensorInfo([g,m],o);this.texData.get(x.dataId).usage=b?zt.PIXELS:zt.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,g,s);var y=this.runWebGLProgram(v,[x],o,null,!0),_=this.texData.get(y.dataId);a.texture=_.texture,a.texShape=_.texShape,a.isPacked=_.isPacked,a.usage=_.usage,this.disposeData(x.dataId),this.texData.delete(y.dataId),a.values=null,p&&(this.uploadWaitMs+=sn()-d)}else{var w=this.acquireTexture(h,c,o,l);a.texture=w}}},n.prototype.convertAndCacheOnCPU=function(e,t){var a=this.texData.get(e),i=a.dtype;return this.releaseGPUData(e),t!=null&&(a.values=function(o,s){if(s==="float32"||s==="complex64")return o;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(o.length):new Uint8Array(o.length),c=0;c<u.length;++c)u[c]=Math.round(o[c]);return u}throw new Error("Unknown dtype "+s)}(t,i)),a.values},n.prototype.acquireTexture=function(e,t,a,i){if(this.numBytesInGPU+=this.computeBytes(e,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,i)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*Zu(t)},n}(Gh);th()&&R.registerBackend("webgl",function(){return new Ef},2);var ab=I({square_:function(r){var n=C(r,"x","square"),e=[n];return R.runKernelFunc(function(t,a){return a([n]),t.square(n)},{x:n},null,"Square",{},e,[])}}),xi="SquaredDifference",Df=I({squaredDifference_:function(r,n){var e,t=C(r,"a","squaredDifference"),a=C(n,"b","squaredDifference");e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape);var i={a:t,b:a},o=[t,a];return R.runKernelFunc(function(s,u){var c=s.squaredDifference(t,a);return u([t,a]),c},i,function(s,u){var c=u[0],l=u[1],d=J(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},xi,{},o,[])}}),ib=I({abs_:function(r){var n=C(r,"x","abs");return n.dtype==="complex64"?R.runKernelFunc(function(e){return e.complexAbs(n)},{$x:n}):R.runKernelFunc(function(e,t){var a=e.abs(n);return t([n]),a},{x:n},function(e,t){var a=t[0];return{x:function(){return e.mul(a.toFloat().step(-1))}}},"Abs")}}),ob=I({acos_:function(r){var n=C(r,"x","acos");return R.runKernelFunc(function(e,t){var a=e.acos(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.divStrict(J(1).sub(a.toFloat().square()).sqrt()).neg()}}})}}),sb=I({acosh_:function(r){var n=C(r,"x","acosh");return R.runKernelFunc(function(e,t){var a=e.acosh(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.divStrict(a.toFloat().square().sub(1).sqrt())}}})}}),ub=I({asin_:function(r){var n=C(r,"x","asin");return R.runKernelFunc(function(e,t){var a=e.asin(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.divStrict(J(1).sub(a.toFloat().square()).sqrt())}}})}}),cb=I({asinh_:function(r){var n=C(r,"x","asinh");return R.runKernelFunc(function(e,t){var a=e.asinh(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.divStrict(J(1).add(a.toFloat().square()).sqrt())}}})}}),lb=I({atan_:function(r){var n=C(r,"x","atan");return R.runKernelFunc(function(e,t){var a=e.atan(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(a.toFloat().square().add(1))}}})}}),db=I({atanh_:function(r){var n=C(r,"x","atanh");return R.runKernelFunc(function(e,t){var a=e.atanh(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(J(1).sub(a.toFloat().square()))}}})}}),pb=I({ceil_:function(r){var n=C(r,"x","ceil");return R.runKernelFunc(function(e){return e.ceil(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),Ci=I({clipByValue_:function(r,n,e){var t=C(r,"x","clipByValue");E(n<=e,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+e+")."});var a=[t],i={min:n,max:e};return R.runKernelFunc(function(o,s){var u=o.clip(t,n,e);return s([t]),u},{x:t},function(o,s){var u=s[0];return{x:function(){return o.where(u.greaterEqual(n).logicalAnd(u.lessEqual(e)),ke(o))}}},"ClipByValue",i,a)}}),hb=I({cos_:function(r){var n=C(r,"x","cos"),e=[n];return R.runKernelFunc(function(t,a){var i=t.cos(n);return a([n]),i},{x:n},function(t,a){var i=a[0];return{x:function(){return i.toFloat().sin().neg().mul(t)}}},"Cos",{},e)}}),fb=I({cosh_:function(r){var n=C(r,"x","cosh");return R.runKernelFunc(function(e,t){var a=e.cosh(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return a.toFloat().sinh().mulStrict(e)}}})}}),mb=I({erf_:function(r){var n=C(r,"x","erf");return E(n.dtype==="int32"||n.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),n.dtype==="int32"&&(n=n.toFloat()),R.runKernelFunc(function(e,t){var a=e.erf(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),ns=I({exp_:function(r){var n=C(r,"x","exp");return R.runKernelFunc(function(e,t){var a=e.exp(n);return t([a]),a},{x:n},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),vb=I({expm1_:function(r){var n=C(r,"x","expm1");return R.runKernelFunc(function(e,t){var a=e.expm1(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.mul(a.exp())}}})}}),gb=I({floor_:function(r){var n=C(r,"x","floor");return R.runKernelFunc(function(e){return e.floor(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),yb=I({log_:function(r){var n=C(r,"x","log"),e=[n];return R.runKernelFunc(function(t,a){var i=t.log(n);return a([n]),i},{x:n},function(t,a){var i=a[0];return{x:function(){return t.div(i.toFloat())}}},"Log",{},e)}}),bb=I({log1p_:function(r){var n=C(r,"x","log1p");return R.runKernelFunc(function(e,t){var a=e.log1p(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(a.add(1))}}})}}),xb=I({logSigmoid_:function(r){var n=C(r,"x","logSigmoid");return R.runKernelFunc(function(e,t){var a=e.softplus(n.neg()).neg();return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.mul(a.neg().sigmoid())}}})}}),Ei=I({neg_:function(r){var n=C(r,"x","neg"),e=[n];return R.runKernelFunc(function(t){return t.neg(n)},{x:n},function(t){return{x:function(){return t.neg()}}},"Neg",{},e)}}),_b=I({reciprocal_:function(r){var n=C(r,"x","reciprocal");return R.runKernelFunc(function(e,t){var a=e.reciprocal(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(a.square().neg())}}})}}),wb=I({round_:function(r){var n=C(r,"x","round");return R.runKernelFunc(function(e){return e.round(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),kf=I({rsqrt_:function(r){var n=C(r,"x","rsqrt"),e=[n];return R.runKernelFunc(function(t,a){var i=t.rsqrt(n);return a([n]),i},{x:n},function(t,a){var i=a[0];return{x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),_c=I({sigmoid_:function(r){var n=C(r,"x","sigmoid");return R.runKernelFunc(function(e,t){var a=e.sigmoid(n);return t([a]),a},{x:n},function(e,t){var a=t[0];return{x:function(){return e.mul(a.mul(J(1).sub(a)))}}},"Sigmoid")}}),Cb=I({sign_:function(r){var n=C(r,"x","sign");return R.runKernelFunc(function(e){return e.sign(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),Eb=I({isNaN_:function(r){var n=C(r,"x","isNaN");return R.runKernelFunc(function(e){return e.isNaN(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),Db=I({isInf_:function(r){var n=C(r,"x","isInf");return R.runKernelFunc(function(e){return e.isInf(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),kb=I({isFinite_:function(r){var n=C(r,"x","isFinite");return R.runKernelFunc(function(e){return e.isFinite(n)},{$x:n},function(e){return{$x:function(){return ke(e)}}})}}),Sb=I({sin_:function(r){var n=C(r,"x","sin"),e=[n];return R.runKernelFunc(function(t,a){var i=t.sin(n);return a([n]),i},{x:n},function(t,a){var i=a[0];return{x:function(){return i.toFloat().cos().mul(t)}}},"Sin",{},e)}}),Ab=I({sinh_:function(r){var n=C(r,"x","sinh");return R.runKernelFunc(function(e,t){var a=e.sinh(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return a.toFloat().cosh().mulStrict(e)}}})}}),Ib=I({softplus_:function(r){var n=C(r,"x","softplus");return R.runKernelFunc(function(e,t){var a=e.softplus(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.mul(a.sigmoid())}}})}}),Rb=I({sqrt_:function(r){var n=C(r,"x","sqrt");return R.runKernelFunc(function(e,t){var a=e.sqrt(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(a.toFloat().sqrt().mul(2))}}})}}),Tb=I({step_:function(r,n){n===void 0&&(n=0);var e=C(r,"x","step");return R.runKernelFunc(function(t){return t.step(e,n)},{$x:e},function(t){return{$x:function(){return ke(t)}}})}}),Fb=I({tan_:function(r){var n=C(r,"x","tan");return R.runKernelFunc(function(e,t){var a=e.tan(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return e.div(a.cos().square())}}})}}),Mb=I({tanh_:function(r){var n=C(r,"x","tanh");return R.runKernelFunc(function(e,t){var a=e.tanh(n);return t([a]),a},{x:n},function(e,t){var a=t[0];return{x:function(){return J(1).sub(a.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Sf(r,n,e,t,a,i){var o,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return a!=null&&(o=C(a,"scale","batchNorm")),t!=null&&(s=C(t,"offset","batchNorm")),E(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),E(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),o!=null&&E(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),s!=null&&E(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Di(u,c,l,s,o,i)}function Af(r,n,e,t,a,i){var o,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return a!=null&&(o=C(a,"scale","batchNorm")),t!=null&&(s=C(t,"offset","batchNorm")),E(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),E(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),E(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),o!=null&&E(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),s!=null&&E(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Di(u,c,l,s,o,i)}function If(r,n,e,t,a,i){var o,s,u=C(r,"x","batchNorm"),c=C(n,"mean","batchNorm"),l=C(e,"variance","batchNorm");return a!=null&&(o=C(a,"scale","batchNorm")),t!=null&&(s=C(t,"offset","batchNorm")),E(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),E(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),E(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),o!=null&&E(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),s!=null&&E(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Di(u,c,l,s,o,i)}function Di(r,n,e,t,a,i){i==null&&(i=.001);var o,s,u,c=C(r,"x","batchNorm"),l=C(n,"mean","batchNorm"),d=C(e,"variance","batchNorm");a!=null&&(o=C(a,"scale","batchNorm")),t!=null&&(s=C(t,"offset","batchNorm")),E(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E(o==null||l.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var p=[c,l,d,o];return R.runKernelFunc(function(h,f){var v=h.batchNormalization(u,wo(l),wo(d),i,wo(o),wo(s));return f([c,l,d,o]),v},{x:c,mean:l,variance:d,scale:o,offset:s},function(h,f){var v=f,m=v[0],g=v[1],b=v[2],x=v[3],y=x??J(1),_=rt(g.shape,u.shape),w=[];if(g.rank===1){for(var A=0;A<u.shape.length-1;++A)w.push(u.shape[A]);w.push(1)}var S=m.sub(g),D=h.mul(y),k=kf(b.add(J(i))),F=k.mul(k).mul(k).mul(J(-.5));return{x:function(){return g.rank===1?h.mul(Nr(k.as4D(1,1,1,g.shape[0]),w)).mul(y).reshape(m.shape):h.mul(k).mul(y).reshape(m.shape)},mean:function(){var T=k.mul(J(-1)).mul(D);return g.rank===1&&(T=T.sum(_)),T.reshape(g.shape)},variance:function(){var T=F.mul(S).mul(D);return g.rank===1&&(T=T.sum(_)),T.reshape(g.shape)},scale:function(){var T=S.mul(k),W=h.mul(T);return g.rank===1&&(W=W.sum(_)),W.reshape(g.shape)},offset:function(){var T=h;return g.rank===1&&(T=T.sum(_)),T.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:i},p).reshape(c.shape)}function wo(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function rs(){Sh("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Nb=I({batchNormalization2d_:function(r,n,e,t,a,i){return t===void 0&&(t=.001),rs(),Sf(r,n,e,i,a,t)}}),Pb=I({batchNormalization3d_:function(r,n,e,t,a,i){return t===void 0&&(t=.001),rs(),Af(r,n,e,i,a,t)}}),Ob=I({batchNormalization4d_:function(r,n,e,t,a,i){return t===void 0&&(t=.001),rs(),If(r,n,e,i,a,t)}}),Bb=I({batchNormalization_:function(r,n,e,t,a,i){return t===void 0&&(t=.001),rs(),Di(r,n,e,i,a,t)}}),wc=I({batchNorm_:Di}),Lb=I({batchNorm2d_:Sf}),Vb=I({batchNorm3d_:Af}),Wb=I({batchNorm4d_:If}),as=I({logicalAnd_:function(r,n){var e=C(r,"a","logicalAnd","bool"),t=C(n,"b","logicalAnd","bool");return xe(e.shape,t.shape),R.runKernelFunc(function(a){return a.logicalAnd(e,t)},{a:e,b:t},null,"LogicalAnd")}}),zb=I({logicalNot_:function(r){var n=C(r,"x","logicalNot","bool");return R.runKernelFunc(function(e){return e.logicalNot(n)},{$x:n})}}),Rf=I({logicalOr_:function(r,n){var e=C(r,"a","logicalOr","bool"),t=C(n,"b","logicalOr","bool");return xe(e.shape,t.shape),R.runKernelFunc(function(a){return a.logicalOr(e,t)},{$a:e,$b:t})}}),Ub=I({logicalXor_:function(r,n){var e=C(r,"a","logicalXor","bool"),t=C(n,"b","logicalXor","bool");return xe(e.shape,t.shape),Rf(r,n).logicalAnd(as(r,n).logicalNot())}}),Lr=I({where_:function(r,n,e){var t=C(n,"a","where"),a=C(e,"b","where"),i=C(r,"condition","where","bool");return Re(t.shape,a.shape,"Error in where: "),i.rank===1?E(i.shape[0]===t.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Re(i.shape,a.shape,"Error in where: "),R.runKernelFunc(function(o,s){var u=o.select(i,t,a);return s([i]),u},{$condition:i,$a:t,$b:a},function(o,s){var u=s[0];return{$condition:function(){return ke(u).toFloat()},$a:function(){return o.mul(u.cast(o.dtype))},$b:function(){return o.mul(u.logicalNot().cast(o.dtype))}}})}}),Tf=function(r){return re(this,void 0,void 0,function(){var n,e,t;return ae(this,function(a){switch(a.label){case 0:return[4,(n=C(r,"condition","whereAsync","bool")).data()];case 1:return e=a.sent(),t=gc(n.shape,e),r!==n&&n.dispose(),[2,t]}})})},de=I({add_:function(r,n){var e,t=C(r,"a","add"),a=C(n,"b","add");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o){return o.add(t,a)},{a:t,b:a},function(o){return{a:function(){var s=o,u=rt(t.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(t.shape)},b:function(){var s=o,u=rt(a.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(a.shape)}}},"Add")}}),Hb=I({addN_:function(r){E(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),E(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var n=r.map(function(a,i){return C(a,"tensors"+i,"addN")}),e=n[0];n.forEach(function(a){if(a.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(a){if(!nt(a.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var t=n;return R.runKernelFunc(function(a){return a.addN(n)},t,function(a){var i={};return n.forEach(function(o,s){i[s]=function(){return a.clone()}}),i},"AddN")}}),Gb=I({addStrict_:function(r,n){var e=C(r,"a","addStrict"),t=C(n,"b","addStrict");return Re(e.shape,t.shape,"Error in addStrict: "),e.add(t)}}),jb=I({atan2_:function(r,n){var e,t=C(r,"a","atan2"),a=C(n,"b","atan2");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o,s){var u=o.atan2(t,a);return s([t,a]),u},{$a:t,$b:a},function(o,s){var u=s[0],c=s[1];return{$a:function(){var l=de(u.square(),c.square()),d=o.mul(c.div(l)),p=rt(u.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(u.shape)},$b:function(){var l=de(u.square(),c.square()),d=Ei(o.mul(u.div(l))),p=rt(c.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(c.shape)}}})}}),Qt=I({div_:function(r,n){var e,t=C(r,"a","div"),a=C(n,"b","div");if(e=Ue(t,a),t=e[0],a=e[1],t.dtype==="int32"&&a.dtype==="int32")return Ff(t,a);var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o,s){var u=o.realDivide(t,a);return s([t,a]),u},{a:t,b:a},function(o,s){var u=s[0],c=s[1];return{a:function(){var l=o.div(c.toFloat()),d=rt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=o.mul(u.toFloat()),d=rt(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var p=c.square();return l.div(p.toFloat()).neg()}}},"Div")}}),qb=I({divNoNan_:function(r,n){var e,t=C(r,"a","div"),a=C(n,"b","div");t=(e=Ue(t,a))[0],a=e[1];var i=Qt(t,a),o=ke(i),s=a.equal(o);return Lr(s,o,i)}}),Yb=I({divStrict_:function(r,n){var e=C(r,"a","div"),t=C(n,"b","div");return Re(e.shape,t.shape,"Error in divideStrict: "),e.div(t)}}),Ff=I({floorDiv_:function(r,n){var e,t=C(r,"a","floorDiv"),a=C(n,"b","floorDiv");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o,s){var u=o.floorDiv(t,a);return s([t,a]),u},{a:t,b:a},function(o,s){var u=s[0],c=s[1];return{a:function(){var l=o.div(c.toFloat()),d=rt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=o.mul(u.toFloat()),d=rt(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var p=c.square();return l.div(p.toFloat()).neg()}}},"FloorDiv")}}),Cc=I({maximum_:function(r,n){var e,t=C(r,"a","maximum"),a=C(n,"b","maximum");return e=Ue(t,a),t=e[0],a=e[1],t.dtype==="bool"&&(t=t.toInt(),a=a.toInt()),xe(t.shape,a.shape),R.runKernelFunc(function(i,o){var s=i.maximum(t,a);return o([t,a]),s},{a:t,b:a},function(i,o){var s=o[0],u=o[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),Kb=I({maximumStrict_:function(r,n){var e=C(r,"a","maximumStrict"),t=C(n,"b","maximumStrict");return Re(e.shape,t.shape,"Error in maximumStrict: "),e.maximum(t)}}),Mf=I({minimum_:function(r,n){var e,t=C(r,"a","minimum"),a=C(n,"b","minimum");return e=Ue(t,a),t=e[0],a=e[1],t.dtype==="bool"&&(t=t.toInt(),a=a.toInt()),xe(t.shape,a.shape),R.runKernelFunc(function(i,o){var s=i.minimum(t,a);return o([t,a]),s},{a:t,b:a},function(i,o){var s=o[0],u=o[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),Xb=I({minimumStrict_:function(r,n){var e=C(r,"a","minimumStrict"),t=C(n,"b","minimumStrict");return Re(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)}}),$b=I({mod_:function(r,n){var e,t=C(r,"a","mod"),a=C(n,"b","mod");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o,s){var u=o.mod(t,a);return s([t,a]),u},{$a:t,$b:a},function(o,s){var u=s[0],c=s[1];return{$a:function(){var l=rt(u.shape,i);return l.length>0?o.sum(l).reshape(u.shape):o},$b:function(){var l=o.mul(u.div(c).floor().neg()),d=rt(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),Qb=I({modStrict_:function(r,n){var e=C(r,"a","modStrict"),t=C(n,"b","modStrict");return Re(e.shape,t.shape,"Error in modStrict: "),e.mod(t)}}),qe=I({mul_:function(r,n){var e,t=C(r,"a","mul"),a=C(n,"b","mul");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o,s){var u=o.multiply(t,a);return s([t,a]),u},{a:t,b:a},function(o,s){var u=s[0],c=s[1];return{a:function(){var l=o.mul(c.toFloat()),d=rt(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=o.mul(u.toFloat()),d=rt(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),Jb=I({mulStrict_:function(r,n){var e=C(r,"a","mul"),t=C(n,"b","mul");return Re(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)}}),qo=I({pow_:function(r,n){var e,t=C(r,"base","pow"),a=C(n,"exp","pow");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape),o=[t,a];return R.runKernelFunc(function(s,u){var c=s.pow(t,a);return u([t,a,c]),c},{a:t,b:a},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var p=l.toFloat(),h=s.mul(p.mul(c.pow(p.sub(J(1))))),f=rt(c.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(c.shape)},b:function(){var p=c.greater(0),h=c.log().where(p,ke(c)),f=s.mul(d.mul(h)),v=rt(l.shape,i);return v.length>0&&(f=f.sum(v)),f.reshape(l.shape)}}},"Pow",{},o,[!0])}}),Zb=I({powStrict_:function(r,n){return Re(r.shape,n.shape,"Error in powStrict: "),r.pow(n)}}),ex=I({squaredDifferenceStrict_:function(r,n){var e=C(r,"a","squaredDifferenceStrict"),t=C(n,"b","squaredDifferenceStrict");return Re(e.shape,t.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(t)}}),Oe=I({sub_:function(r,n){var e,t=C(r,"a","sub"),a=C(n,"b","sub");e=Ue(t,a),t=e[0],a=e[1];var i=xe(t.shape,a.shape);return R.runKernelFunc(function(o){return o.subtract(t,a)},{a:t,b:a},function(o){return{a:function(){var s=o,u=rt(t.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(t.shape)},b:function(){var s=o,u=rt(a.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(a.shape)}}},"Sub")}}),tx=I({subStrict_:function(r,n){var e=C(r,"a","subStrict"),t=C(n,"b","subStrict");return Re(e.shape,t.shape,"Error in subStrict: "),e.sub(t)}}),Nf=I({equal_:function(r,n){var e,t=C(r,"a","equal"),a=C(n,"b","equal");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i){return i.equal(t,a)},{$a:t,$b:a})}}),nx=I({equalStrict_:function(r,n){var e=C(r,"a","equalStrict"),t=C(n,"b","equalStrict");return Re(e.shape,t.shape,"Error in equalStrict: "),e.equal(t)}}),rx=I({greater_:function(r,n){var e,t=C(r,"a","greater"),a=C(n,"b","greater");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i){return i.greater(t,a)},{a:t,b:a},null,"Greater")}}),Pf=I({greaterEqual_:function(r,n){var e,t=C(r,"a","greaterEqual"),a=C(n,"b","greaterEqual");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i,o){var s=i.greaterEqual(t,a);return o([t,a]),s},{a:t,b:a},function(i,o){var s=o[0],u=o[1];return{a:function(){return ke(s)},b:function(){return ke(u)}}},"GreaterEqual")}}),ax=I({greaterEqualStrict_:function(r,n){var e=C(r,"a","greaterEqualStrict"),t=C(n,"b","greaterEqualStrict");return Re(e.shape,t.shape,"Error in greaterEqualStrict: "),e.greaterEqual(t)}}),ix=I({greaterStrict_:function(r,n){var e=C(r,"a","greaterStrict"),t=C(n,"b","greaterStrict");return Re(e.shape,t.shape,"Error in greaterStrict: "),e.greater(t)}}),ox=I({less_:function(r,n){var e,t=C(r,"a","less"),a=C(n,"b","less");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i){return i.less(t,a)},{a:t,b:a},null,"Less")}}),sx=I({lessEqual_:function(r,n){var e,t=C(r,"a","lessEqual"),a=C(n,"b","lessEqual");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i,o){var s=i.lessEqual(t,a);return o([t,a]),s},{a:t,b:a},null,"LessEqual")}}),ux=I({lessEqualStrict_:function(r,n){var e=C(r,"a","lessEqualStrict"),t=C(n,"b","lessEqualStrict");return Re(e.shape,t.shape,"Error in lessEqualStrict: "),e.lessEqual(t)}}),cx=I({lessStrict_:function(r,n){var e=C(r,"a","lessStrict"),t=C(n,"b","lessStrict");return Re(e.shape,t.shape,"Error in lessStrict: "),e.less(t)}}),lx=I({notEqual_:function(r,n){var e,t=C(r,"a","notEqual"),a=C(n,"b","notEqual");return e=Ue(t,a),t=e[0],a=e[1],xe(t.shape,a.shape),R.runKernelFunc(function(i){return i.notEqual(t,a)},{a:t,b:a},null,"NotEqual")}}),dx=I({notEqualStrict_:function(r,n){var e=C(r,"a","notEqualStrict"),t=C(n,"b","notEqualStrict");return Re(e.shape,t.shape,"Error in notEqualStrict: "),e.notEqual(t)}});function Ep(r,n){for(var e=[],t=r;t<n;++t)e.push(t);return e}function Dp(r){for(var n=[],e=0;e<r.length;++e)for(var t=0;t<r[e].length;++t)n.push(r[e][t]);return n}var Ec=I({gather_:function(r,n,e){e===void 0&&(e=0);var t=C(r,"x","gather"),a=C(n,"indices","gather","int32");e=at(e,t.shape)[0];var i=function(o,s,u){for(var c=o.shape[u],l=[],d=1,p=1,h=0;h<u;h++)l.push(o.shape[h]),d*=o.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<o.rank;h++)l.push(o.shape[h]),p*=o.shape[h];return{batchSize:d,sliceSize:p,dimSize:c,outputShape:l}}(t,a,e);return R.runKernelFunc(function(o,s){var u=o.gather(t,a.flatten(),e);return s([a]),u},{x:t,indices:a},function(o,s){var u=s[0];return{x:function(){var c=t.shape,l=u.size,d=c.slice(0,e),p=d.length,h=c.slice(e,c.length).slice(1),f=h.length,v=Ep(0,p),m=Ep(p+1,p+1+f),g=Dp([d,[l],h]),b=o.reshape(g),x=u.reshape([l]),y=Dp([[p],v,m]),_=b.transpose(y),w=Of(_,x,t.shape[e]),A=$o(y);return w=w.transpose(A)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),Of=I({unsortedSegmentSum_:function(r,n,e){var t=C(r,"x","unsortedSegmentSum"),a=C(n,"segmentIds","unsortedSegmentSum","int32");return E(Ye(e),function(){return"numSegments must be of dtype int"}),R.runKernelFunc(function(i,o){var s=i.unsortedSegmentSum(t,a,e);return o([a]),s},{$x:t},function(i,o){var s=o[0];return{$x:function(){return function(u,c){for(var l=Cc(c,ke(c)),d=Ec(u,l),p=Pf(c,J(0,"int32")),h=d.rank-p.rank,f=0;f<h;++f)p=Et(p,f+1);p=as(p,wa(d.shape,"bool"));var v=ke(d);return Lr(p,d,v)}(i,s)}}})}}),px=function(r,n,e){return re(this,void 0,void 0,function(){var t,a,i,o,s,u,c,l,d,p,h,f,v;return ae(this,function(m){switch(m.label){case 0:for(t=C(r,"tensor","boolMask"),a=C(n,"mask","boolMask","bool"),i=e??0,o=a.rank,s=t.shape,E(o>0,function(){return"mask cannot be scalar"}),Re(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),d=t.reshape(l),p=a.reshape([-1]),[4,Tf(p)];case 1:return h=m.sent(),f=h.squeeze([1]),v=Ec(d,f,i),r!==t&&t.dispose(),n!==a&&a.dispose(),f.dispose(),d.dispose(),p.dispose(),h.dispose(),[2,v]}})})};function Bf(r,n,e,t,a,i,o){i===void 0&&(i="NHWC"),E(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var s=r,u=n,c=!1;n.rank===3&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,r[0],r[1],r[2]]),E(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),E(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),E(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l=i==="NHWC"?s[3]:s[1],d=i==="NHWC"?u.shape[3]:u.shape[1];E(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),E(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),o!=null&&E(Ye(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var p=ts(i),h=gr(s,e.shape,t,1,a,o,!1,p),f=R.runKernelFunc(function(v,m){var g=v.conv2dDerInput(u,e,h);return m([e,u]),g},{dy4D:u,filter:e},function(v,m){var g=m[0],b=m[1];return{dy4D:function(){return pt(v,g,t,a,i,1,o)},filter:function(){return Dc(v,b,g.shape,t,a,i,o)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function xu(r){var n=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(r),e=n[0],t=n[1],a=n[2];return e===1&&t===1&&a===1}function Lf(r,n,e,t,a){E(r.length===n.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"});var i=r,o=n,s=!1;n.rank===4&&(s=!0,o=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];E(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),E(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),E(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),E(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),E(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=bi(i,e.shape,t,1,a),d=R.runKernelFunc(function(p){return p.conv3dDerInput(o,e,l)},{dy5D:o});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var hx=I({conv1d_:function(r,n,e,t,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=C(r,"x","conv1d"),u=C(n,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),E(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),E(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),o!=null&&E(Ye(t),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+t+"."}),E(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),E(Rt(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),E(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),p=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=pt(p,d,[1,e],t,"NHWC",[1,i],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),pt=I({conv2d_:function(r,n,e,t,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=C(r,"x","conv2d"),u=C(n,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),E(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),o!=null&&E(Ye(t),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+t+"."});var d=a==="NHWC"?c.shape[3]:c.shape[1];E(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),E(Rt(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var p=ts(a),h=gr(c.shape,u.shape,e,i,t,o,!1,p),f=[u,c],v=R.runKernelFunc(function(m,g){var b=m.conv2d(c,u,h);return g([u,c]),b},{x:c,filter:u},function(m,g){var b=g,x=b[0],y=b[1];return E(Br(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return Vf(y.shape,m,x,e,t,a)},filter:function(){return Dc(y,m,x.shape,e,t,a)}}},"Conv2D",h,f);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),fx=I({conv3d_:function(r,n,e,t,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=C(r,"x","conv3d"),s=C(n,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),E(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),E(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),E(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),E(function(p,h){return xu(p)||xu(h)}(e,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),E(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var l=bi(u.shape,s.shape,e,i,t),d=R.runKernelFunc(function(p,h){var f=p.conv3d(u,s,l);return h([u,s]),f},{x:u,$filter:s},function(p,h){E(xu(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var f=h[0],v=h[1];return{x:function(){return Lf(f.shape,p,v,e,t)},$filter:function(){return function(m,g,b,x,y){var _=m;m.rank===4&&(_=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var w=g;w.rank===4&&(w=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),E(_.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+_.shape+"."}),E(w.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+w.shape+"."}),E(b.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."}),E(_.shape[4]===b[3],function(){return"Error in conv3dDerFilter: depth of input "+_.shape[4]+") must match input depth in filter ("+b[3]+"."}),E(w.shape[4]===b[4],function(){return"Error in conv3dDerFilter: depth of dy ("+w.shape[4]+") must match output depth for filter ("+b[4]+")."});var A=bi(_.shape,b,x,1,y);return R.runKernelFunc(function(S){return S.conv3dDerFilter(_,w,A)},{x5D:_,dy5D:w})}(f,p,v.shape,e,t)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Dc=I({conv2dDerFilter_:function(r,n,e,t,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=n;u.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),E(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),E(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),E(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];E(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),E(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),o!=null&&E(Ye(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var d=ts(i),p=gr(s.shape,e,t,1,a,o,!1,d);return R.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,p)},{x4D:s,dy4D:u})}}),Vf=I({conv2dDerInput_:Bf}),ki=I({depthwiseConv2d_:function(r,n,e,t,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=C(r,"x","depthwiseConv2d"),u=C(n,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),E(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),E(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),E(Rt(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),o!=null&&E(Ye(t),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+t+"."});var d=gr(c.shape,u.shape,e,i,t,o,!0),p=[c,u],h=R.runKernelFunc(function(f,v){var m=f.depthwiseConv2D(c,u,d);return v([c,u]),m},{x:c,filter:u},function(f,v){E(Br(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var m=v[0],g=v[1];return{x:function(){return Wf(m.shape,f,g,d)},filter:function(){return zf(m,f,g.shape,d)}}},"DepthwiseConv2dNative",d,p);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Wf=I({depthwiseConv2dDerInput_:function(r,n,e,t){var a=n,i=!1;n.rank===3&&(i=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=R.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(a,e,t)},{dy4D:a});return i?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),zf=I({depthwiseConv2dDerFilter_:function(r,n,e,t){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=n;return i.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),R.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(a,i,t)},{x4D:a,dy4D:i})}}),Si=I({separableConv2d_:function(r,n,e,t,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=C(r,"x","separableConv2d"),u=C(n,"depthwiseFilter","separableConv2d"),c=C(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(s.rank===3&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),E(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),E(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),E(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),E(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var p=u.shape[2],h=u.shape[3];E(c.shape[2]===p*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*h+", but got "+c.shape[2]+"."});var f=ki(l,u,t,a,o,i),v=pt(f,c,1,"valid",o);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),mx=I({conv2dTranspose_:function(r,n,e,t,a,i){return Bf(e,C(r,"x","conv2dTranspose"),C(n,"filter","conv2dTranspose"),t,a,"NHWC",i)}}),vx=I({conv3dTranspose_:function(r,n,e,t,a){return Lf(e,C(r,"x","conv3dTranspose"),C(n,"filter","conv3dTranspose"),t,a)}}),Ca=I({matMul_:function(r,n,e,t){var a;e===void 0&&(e=!1),t===void 0&&(t=!1);var i=C(r,"a","matMul"),o=C(n,"b","matMul");a=Ue(i,o),i=a[0],o=a[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=t?o.shape[o.rank-2]:o.shape[o.rank-1],d=i.shape.slice(0,-2),p=o.shape.slice(0,-2),h=ie(d),f=ie(p);E(i.rank>=2&&o.rank>=2&&i.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+o.rank+"."}),E(nt(d,p),function(){return"Error in matMul: outer dimensions ("+d+") and ("+p+") of Tensors with shapes "+i.shape+" and "+o.shape+" must match."}),E(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+e+" and transposeB="+t+" must match."});var v=i.shape.slice(0,-2).concat([c,l]),m=e?i.as3D(h,s,c):i.as3D(h,c,s),g=t?o.as3D(f,l,u):o.as3D(f,u,l),b={transposeA:e,transposeB:t};return R.runKernelFunc(function(x,y){var _=x.batchMatMul(m,g,e,t);return y([m,g]),_},{a:m,b:g},function(x,y){var _=y,w=_[0],A=_[1];return e||t?!e&&t?{a:function(){return x.matMul(A,!1,!1)},b:function(){return x.matMul(w,!0,!1)}}:e&&!t?{a:function(){return A.matMul(x,!1,!0)},b:function(){return w.matMul(x,!1,!1)}}:{a:function(){return A.matMul(x,!0,!0)},b:function(){return x.matMul(w,!0,!0)}}:{a:function(){return x.matMul(A,!1,!0)},b:function(){return w.matMul(x,!0,!1)}}},"BatchMatMul",b).reshape(v)}}),gx=I({dot_:function(r,n){var e=C(r,"t1","dot"),t=C(n,"t2","dot");E(!(e.rank!==1&&e.rank!==2||t.rank!==1&&t.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+t.rank+"."});var a=e.rank===1?e.size:e.shape[1],i=t.rank===1?t.size:t.shape[0];return E(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+i+"."}),e.rank===1&&t.rank===1?e.as2D(1,-1).matMul(t.as2D(-1,1)).asScalar():e.rank===1&&t.rank===2?e.as2D(1,-1).matMul(t.as2D(t.shape[0],t.shape[1])).as1D():e.rank===2&&t.rank===1?e.matMul(t.as2D(-1,1)).as1D():e.matMul(t.as2D(t.shape[0],t.shape[1]))}}),yx=I({outerProduct_:function(r,n){var e=C(r,"v1","outerProduct"),t=C(n,"v2","outerProduct");return E(e.rank===1&&t.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+t.rank+"."}),e.as2D(-1,1).matMul(t.as2D(1,-1))}}),Ai=I({reverse_:function(r,n){var e=C(r,"x","reverse");if(e.rank===0)return e.clone();var t=at(n,e.shape);return R.runKernelFunc(function(a){return a.reverse(e,t)},{$x:e},function(a){return{$x:function(){return a.reverse(t)}}}).reshapeAs(e)}}),bx=I({reverse1d_:function(r){var n=C(r,"x","reverse");return E(n.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),Ai(n,0)}}),xx=I({reverse2d_:function(r,n){var e=C(r,"x","reverse");return E(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Ai(e,n)}}),_x=I({reverse3d_:function(r,n){var e=C(r,"x","reverse");return E(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Ai(e,n)}}),wx=I({reverse4d_:function(r,n){var e=C(r,"x","reverse");return E(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Ai(e,n)}});function Uf(r,n,e,t,a,i){var o=C(r,"x","maxPool"),s=o,u=!1;o.rank===3&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),t==null&&(t=[1,1]),E(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),E(Rt(e,t),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+t+"'"}),i!=null&&E(Ye(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var c=ba(s.shape,n,e,t,a,i);if(c.filterWidth===1&&c.filterHeight===1&&nt(c.inShape,c.outShape))return o.clone();var l=[s],d=R.runKernelFunc(function(p,h){var f=p.maxPool(s,c);return h([s,f]),f},{x:s},function(p,h){var f=h[0],v=h[1];return{x:function(){return function(m,g,b,x,y,_,w,A){var S=C(m,"dy","maxPoolBackprop"),D=C(g,"input","maxPoolBackprop"),k=C(b,"output","maxPoolBackprop");E(D.rank===S.rank,function(){return"Rank of input ("+D.rank+") does not match rank of dy ("+S.rank+")"}),_==null&&(_=[1,1]),E(Rt(y,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+_+"'"}),E(S.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),E(D.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+D.rank+"."}),A!=null&&E(Ye(w),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+w+"."});var F=ba(D.shape,x,y,_,w,A);return R.runKernelFunc(function(T){return T.maxPoolBackprop(S,D,k,F)},{$dy:S,$input:D})}(p,f,v,n,e,t,a)}}},"MaxPool",c,l);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function Hf(r,n,e,t,a,i){var o=C(r,"x","avgPool","float32");t==null&&(t=[1,1]),E(Rt(e,t),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+t+"'"});var s=o,u=!1;o.rank===3&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),E(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&E(Ye(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var c=ba(s.shape,n,e,t,a,i);if(c.filterWidth===1&&c.filterHeight===1&&nt(c.inShape,c.outShape))return o.clone();var l=R.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(p,h,f,v,m,g){var b=C(p,"dy","avgPoolBackprop"),x=C(h,"input","avgPoolBackprop");E(x.rank===b.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+b.rank+")"}),m==null&&(m=[1,1]),E(Rt(v,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"});var y=x,_=b,w=!1;x.rank===3&&(w=!0,y=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),_=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),E(_.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),E(y.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+y.rank+"."});var A=ba(y.shape,f,v,m,g),S=R.runKernelFunc(function(D){return D.avgPoolBackprop(_,y,A)},{dy4D:_,input4D:y});return w?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(d,s,n,e,t,a)}}},"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Ke=I({maxPool_:function(r,n,e,t,a){return Uf(r,n,e,1,t,a)}}),Gn=I({avgPool_:function(r,n,e,t,a){return Hf(r,n,e,1,t,a)}}),Cx=I({pool_:function(r,n,e,t,a,i){a==null&&(a=[1,1]),i==null&&(i=1),t===0&&(t="valid");var o=C(r,"x","maxPool"),s=o,u=!1;o.rank===3&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),E(Rt(i,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"});var c,l=ba(s.shape,n,i,a,t),d=[l.dilationHeight,l.dilationWidth];c=t==="same"?function(y,_){var w=y.map(function(D,k){return D+(D-1)*(_[k]-1)}).map(function(D){return D-1}),A=w.map(function(D){return Math.floor(D/2)}),S=w.map(function(D,k){return D-A[k]});return w.map(function(D,k){return[A[k],S[k]]})}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var p=d[0]===1&&d[1]===1,h=function(y,_,w){var A=w.map(function(L){return L[0]}),S=w.map(function(L){return L[1]}),D=y.concat(A,S),k=_.map(function(L,V){return(L-D[V]%L)%L}),F=S.map(function(L,V){return L+k[V]}),T=_.map(function(L,V){return[A[V],F[V]]}),W=_.map(function(L,V){return[0,k[V]]});return[T,W]}([l.inHeight,l.inWidth],d,c),f=h[0],v=h[1],m=p?t:"valid",g=p?s:Nh(s,d,f),b=(e==="avg"?function(){return Hf(g,n,i,1,m)}:function(){return Uf(g,n,i,1,m)})(),x=p?b:Th(b,d,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Ex=I({maxPool3d_:function(r,n,e,t,a,i,o){i===void 0&&(i="NDHWC");var s=C(r,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),o==null&&(o=[1,1,1]),E(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),E(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),E(Rt(e,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),a!=null&&E(Ye(t),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+t+"."});var l=yi(u.shape,n,e,o,t,a,i),d=R.runKernelFunc(function(p,h){var f=p.maxPool3d(u,l);return h([u,f]),f},{x:u},function(p,h){var f=h[0],v=h[1];return{x:function(){return function(m,g,b,x,y,_,w,A){var S=C(m,"dy","maxPool3dBackprop"),D=C(g,"input","maxPool3dBackprop"),k=C(b,"output","maxPool3dBackprop"),F=S,T=D,W=k,L=!1;D.rank===4&&(L=!0,F=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),T=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3]),W=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),E(F.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+F.rank+"."}),E(T.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),E(W.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+W.rank+"."}),_==null&&(_=[1,1,1]),E(Rt(y,_),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+_+"'"}),A!=null&&E(Ye(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+w+"."});var V=yi(T.shape,x,y,_,w,A),H=R.runKernelFunc(function(U){return U.maxPool3dBackprop(F,T,W,V)},{dy5D:F,input5D:T});return L?H.as4D(H.shape[1],H.shape[2],H.shape[3],H.shape[4]):H}(p,f,v,n,e,o,t,a)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Dx=I({avgPool3d_:function(r,n,e,t,a,i,o){i===void 0&&(i="NDHWC");var s=C(r,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),o==null&&(o=[1,1,1]),E(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),E(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),E(Rt(e,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),a!=null&&E(Ye(t),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+t+"."});var l=yi(u.shape,n,e,o,t,a,i),d=R.runKernelFunc(function(p){return p.avgPool3d(u,l)},{x:u},function(p){return{x:function(){return function(h,f,v,m,g,b,x){var y=C(h,"dy","avgPool3dBackprop"),_=C(f,"input","avgPool3dBackprop"),w=y,A=_,S=!1;_.rank===4&&(S=!0,w=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),A=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),E(w.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+w.rank+"."}),E(A.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),g==null&&(g=[1,1,1]),E(Rt(m,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"}),x!=null&&E(Ye(b),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+b+"."});var D=yi(A.shape,v,m,g,b,x),k=R.runKernelFunc(function(F){return F.avgPool3dBackprop(w,A,D)},{dy5D:w,input5D:A});return S?k.as4D(k.shape[1],k.shape[2],k.shape[3],k.shape[4]):k}(p,u,n,e,o,t,a)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),cn=I({slice_:function(r,n,e){var t,a,i=C(r,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(t=typeof n=="number"?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach(function(u){E(u!==-1,function(){return"slice() does not support negative begin indexing."})}),a=(a=e==null?new Array(i.rank).fill(-1):typeof e=="number"?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(E(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-t[c])}),Wh(i,t,a);var o=i.shape,s={begin:t,size:a};return R.runKernelFunc(function(u){return u.slice(i,t,a)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([t[l],o[l]-t[l]-a[l]]);return{x:function(){return u.pad(c)}}},"Slice",s)}}),kx=I({slice1d_:function(r,n,e){var t=C(r,"x","slice1d");return E(t.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+t.rank+" tensor"}),cn(t,[n],[e])}}),Sx=I({slice2d_:function(r,n,e){var t=C(r,"x","slice2d");return E(t.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+t.rank+" tensor"}),cn(t,n,e)}}),kc=I({slice3d_:function(r,n,e){var t=C(r,"x","slice3d");return E(t.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+t.rank+" tensor"}),cn(t,n,e)}}),Ax=I({slice4d_:function(r,n,e){var t=C(r,"x","slice4d");return E(t.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+t.rank+" tensor"}),cn(t,n,e)}});function Gf(r,n,e,t,a){return n.rank<e.rank&&(n=n.reshape(It(n.shape,t))),r.rank<e.rank&&(r=r.reshape(It(r.shape,t))),{x:function(){var i=r.mul(e.equal(n).cast(r.dtype));return a==null?i:i.transpose(a)}}}var Ix=I({all_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","all","bool"),a=at(n,t.shape),i=a,o=dn(i,t.rank);o!=null&&(t=t.transpose(o),i=pn(i.length,t.rank));var s=R.runKernelFunc(function(c){return c.all(t,i)},{$x:t});if(e){var u=It(s.shape,a);return s.reshape(u)}return s}}),Rx=I({any_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","any","bool"),a=at(n,t.shape),i=a,o=dn(i,t.rank);o!=null&&(t=t.transpose(o),i=pn(i.length,t.rank));var s=R.runKernelFunc(function(c){return c.any(t,i)},{$x:t});if(e){var u=It(s.shape,a);return s.reshape(u)}return s}}),Tx=I({argMax_:function(r,n){n===void 0&&(n=0);var e=C(r,"x","argMax");n==null&&(n=0);var t=at(n,e.shape),a=dn(t,e.rank);a!=null&&(e=e.transpose(a),t=pn(t.length,e.rank));var i={axis:t[0]},o=[e];return R.runKernelFunc(function(s,u){var c=s.argMax(e,t[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return ke(c)}}},"ArgMax",i,o)}}),Fx=I({argMin_:function(r,n){n===void 0&&(n=0);var e=C(r,"x","argMin");n==null&&(n=0);var t=at(n,e.shape),a=dn(t,e.rank);return a!=null&&(e=e.transpose(a),t=pn(t.length,e.rank)),R.runKernelFunc(function(i,o){var s=i.argMin(e,t[0]);return o([e]),s},{$x:e},function(i,o){var s=o[0];return{$x:function(){return ke(s)}}})}}),Mx=I({logSumExp_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","logSumExp"),a=at(n,t.shape),i=t.max(a,!0),o=t.sub(i).exp().sum(a).log(),s=i.reshape(o.shape).add(o);if(e){var u=It(s.shape,a);return s.reshape(u)}return s}}),zr=I({max_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","max"),a=t,i=at(n,t.shape),o=i,s=dn(o,t.rank);s!=null&&(t=t.transpose(s),o=pn(o.length,t.rank));var u=[t],c=R.runKernelFunc(function(d,p){var h=d.max(t,o);return p([a,h]),h},{x:t},function(d,p){return Gf(d,p[1],p[0],i,s)},"Max",{axes:o},u,[!0]);if(e){var l=It(c.shape,i);c=c.reshape(l)}return c}}),Nx=I({mean_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","mean"),a=at(n,t.shape),i=ie(yt(t.shape,a)[1]);return es(function(o){var s=J(i);return{value:(s.dtype===o.dtype?o:o.cast(s.dtype)).div(s).sum(n,e),gradFunc:function(u){var c=o.shape.slice();return a.forEach(function(l){c[l]=1}),u.reshape(c).mul(wa(o.shape,"float32")).div(i)}}})(t)}}),Px=I({min_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","min"),a=t,i=at(n,t.shape),o=i,s=dn(o,t.rank);s!=null&&(t=t.transpose(s),o=pn(o.length,t.rank));var u=[t],c=R.runKernelFunc(function(d,p){var h=d.min(t,o);return p([a,h]),h},{x:t},function(d,p){return Gf(d,p[1],p[0],i,s)},"Min",{axes:o},u,[!0]);if(e){var l=It(c.shape,i);c=c.reshape(l)}return c}}),Ox=I({moments_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=at(n,(r=C(r,"x","moments")).shape),a=r.mean(t,e),i=a.shape;e||(i=It(a.shape,t));var o=r.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(t,e)}}}),jf=I({sum_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","sum");t.dtype==="bool"&&(t=t.toInt());var a=at(n,t.shape);return es(function(i){var o=dn(a,i.rank),s=a,u=i;o!=null&&(u=i.transpose(o),s=pn(s.length,i.rank));var c=function(h){var f=i.shape.slice();return a.forEach(function(v){f[v]=1}),h.reshape(f).mul(wa(i.shape,"float32"))},l={axes:s},d=R.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",l);if(e){var p=It(d.shape,a);d=d.reshape(p)}return{value:d,gradFunc:c}})(t)}}),Bx=I({prod_:function(r,n,e){n===void 0&&(n=null),e===void 0&&(e=!1);var t=C(r,"x","prod");t.dtype==="bool"&&(t=t.toInt());var a=at(n,t.shape),i=dn(a,t.rank),o=a,s=t;i!=null&&(s=t.transpose(i),o=pn(o.length,t.rank));var u=R.runKernelFunc(function(l){return l.prod(s,o)},{permutedX:s});if(e){var c=It(u.shape,a);u=u.reshape(c)}return u}}),qf=I({elu_:function(r){var n=C(r,"x","elu");return R.runKernelFunc(function(e,t){var a=e.elu(n);return t([a]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){return R.runKernelFunc(function(i){return i.eluDer(e,a)},{dy:e,y:a})}}})}}),Lx=I({leakyRelu_:function(r,n){n===void 0&&(n=.2);var e=C(r,"x","leakyRelu");return Cc(J(n).mul(e),e)}}),Yf=I({prelu_:function(r,n){var e=C(r,"x","prelu"),t=C(n,"alpha","prelu");return R.runKernelFunc(function(a,i){var o=a.prelu(e,t);return i([e,t]),o},{x:e,alpha:t},function(a,i){var o=i[0],s=i[1],u=o.greater(0);return{x:function(){return Lr(u,a,a.mul(s))},alpha:function(){var c=Lr(u,ke(a),a.mul(o)),l=rt(s.shape,a.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),Te=I({relu_:function(r){var n=C(r,"x","relu");return n.dtype==="bool"?n.toInt():R.runKernelFunc(function(e,t){var a=e.relu(n);return t([n]),a},{x:n},function(e,t){var a=t[0];return{x:function(){return e.mulStrict(a.step().toFloat())}}},"Relu")}}),Kf=I({relu6_:function(r){var n=C(r,"x","relu6");return n.dtype==="bool"?n.toInt():R.runKernelFunc(function(e,t){var a=e.relu6(n);return t([n]),a},{x:n},function(e,t){var a=t[0],i=a.lessEqual(6).mul(a.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),Vx=I({selu_:function(r){var n=C(r,"x","selu");return R.runKernelFunc(function(e,t){var a=e.selu(n);return t([n]),a},{$x:n},function(e,t){var a=t[0];return{$x:function(){var i=a.greater(J(0)),o=J(bc),s=J(xc),u=e.mul(s),c=e.mul(o).mul(a.toFloat().exp());return Lr(i,u,c)}}})}}),Jt=I({transpose_:function(r,n){var e=C(r,"x","transpose");if(n==null&&(n=e.shape.map(function(a,i){return i}).reverse()),E(e.rank===n.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+n+"."}),n.forEach(function(a){E(a>=0&&a<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+n})}),e.rank<=1)return e.clone();var t={perm:n};return R.runKernelFunc(function(a){return a.transpose(e,n)},{x:e},function(a){var i=$o(n);return{x:function(){return a.transpose(i)}}},"Transpose",t)}}),Wx=I({localResponseNormalization_:function(r,n,e,t,a){n===void 0&&(n=5),e===void 0&&(e=1),t===void 0&&(t=1),a===void 0&&(a=.5);var i=C(r,"x","localResponseNormalization");E(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),E(Ye(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var o=i,s=!1;i.rank===3&&(s=!0,o=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=R.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(o,n,e,t,a);return l([o,d]),d},{x4D:o},function(c,l){var d=l[0],p=l[1];return{x4D:function(){return R.runKernelFunc(function(h){return h.LRNGrad(c,d,p,n,e,t,a)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Xf=I({norm_:function(r,n,e,t){n===void 0&&(n="euclidean"),e===void 0&&(e=null),t===void 0&&(t=!1);var a=function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(J(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(r=C(r,"x","norm"),n,e),i=a.shape;if(t){var o=at(e,r.shape);i=It(a.shape,o)}return a.reshape(i)}}),zx=I({basicLSTMCell_:function(r,n,e,t,a,i){var o=C(r,"forgetBias","basicLSTMCell"),s=C(n,"lstmKernel","basicLSTMCell"),u=C(e,"lstmBias","basicLSTMCell"),c=C(t,"data","basicLSTMCell"),l=C(a,"c","basicLSTMCell"),d=C(i,"h","basicLSTMCell"),p=c.concat(d,1).matMul(s).add(u),h=p.shape[0],f=p.shape[1]/4,v=[h,f],m=p.slice([0,0],v),g=p.slice([0,f],v),b=p.slice([0,2*f],v),x=p.slice([0,3*f],v),y=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(o.add(b).sigmoid())),_=y.tanh().mulStrict(x.sigmoid());return[y,_]}}),Ux=I({multiRNNCell_:function(r,n,e,t){for(var a=C(n,"data","multiRNNCell"),i=Vo(e,"c","multiRNNCell"),o=Vo(t,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],p=[];for(c=0;c<u.length;c+=2)d.push(u[c]),p.push(u[c+1]);return[d,p]}}),Hx=I({movingAverage_:function(r,n,e,t,a){a===void 0&&(a=!0);var i=C(r,"v","movingAverage"),o=C(n,"x","movingAverage"),s=C(e,"decay","movingAverage");eh(i,o),E(nt(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=J(1),c=u.sub(s),l=o.sub(i).mul(c);if(a){E(t!=null,function(){return"When using zeroDebias: true, step is required."});var d=C(t,"step","movingAverage");l=l.div(u.sub(qo(s,d)))}return i.add(l)}}),Gx=I({stridedSlice_:function(r,n,e,t,a,i,o,s,u){if(a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0),t==null&&(t=new Array(n.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var c=C(r,"x","stridedSlice"),l=Gu(s),d=c.shape.slice();l.forEach(function(m){n[m]=0,e[m]=1,d.splice(m,0,1)}),c=c.reshape(d);for(var p=0;p<c.rank;p++)n[p]=zh(a,n,t,c.shape,p),e[p]=Uh(i,e,t,c.shape,p),t[p]=t[p]||1;var h=Gu(u);h.forEach(function(m){e[m]=n[m]+1,t[m]=1});var f=Zo(n,e,t),v=f.filter(function(m,g){return h.indexOf(g)===-1});return t.every(function(m){return m===1})?cn(c,n,f).reshape(v):R.runKernelFunc(function(m){return m.stridedSlice(c,n,e,t)},{$x:c}).reshape(v)}}),jx=I({topk_:function(r,n,e){n===void 0&&(n=1),e===void 0&&(e=!0);var t=C(r,"x","topk");if(t.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=t.shape[t.shape.length-1];if(n>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+n);var i=R.runKernelFunc(function(o){return o.topk(t,n,e)},{$x:t});return{values:i[0],indices:i[1]}}}),qx=I({scatterND_:function(r,n,e){var t=C(r,"indices","scatterND","int32"),a=C(n,"updates","scatterND");return Vh(a,t,e),R.runKernelFunc(function(i){return i.scatterND(t,a,e)},{indices:t,updates:a},null,"ScatterNd",{shape:e})}}),Sc=I({fft_:function(r){E(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],e=r.size/n,t=r.as2D(e,n);return R.runKernelFunc(function(a){return a.fft(t)},{input:r}).reshape(r.shape)}}),Yo=I({ifft_:function(r){E(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var n=r.shape[r.shape.length-1],e=r.size/n,t=r.as2D(e,n);return R.runKernelFunc(function(a){return a.ifft(t)},{input:r}).reshape(r.shape)}}),Ac=I({rfft_:function(r,n){E(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var e,t=r.shape[r.shape.length-1],a=r.size/t;if(n!=null&&n<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=n,e=r.slice(i,o),t=n}else if(n!=null&&n>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=n-t,e=r.concat(Le(s),r.shape.length-1),t=n}else e=r;var u=e.zerosLike(),c=gt(e,u).as2D(a,t),l=Sc(c),d=Math.floor(t/2)+1,p=$t(l),h=kn(l),f=p.split([d,t-d],p.shape.length-1),v=h.split([d,t-d],h.shape.length-1),m=e.shape.slice();return m[e.shape.length-1]=d,gt(f[0],v[0]).reshape(m)}}),$f=I({irfft_:function(r){var n=r.shape[r.shape.length-1],e=r.size/n;if(n<=2){var t=r.as2D(e,n),a=Yo(t);return $t(a)}var i=[e,2*(n-1)],o=$t(r).as2D(e,n),s=kn(r).as2D(e,n),u=o.slice([0,1],[e,n-2]).reverse(1),c=s.slice([0,1],[e,n-2]).reverse(1).mul(J(-1)),l=o.concat(u,1),d=s.concat(c,1);return t=gt(l,d).as2D(i[0],i[1]),a=Yo(t),$t(a)}}),Yx=Object.freeze({fft:Sc,ifft:Yo,rfft:Ac,irfft:$f}),Kx=I({sparseToDense_:function(r,n,e,t){t===void 0&&(t=0);var a=C(r,"sparseIndices","sparseToDense","int32"),i=C(n,"sparseValues","sparseToDense"),o=C(t,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,p=s.rank>1?s.shape[1]:1;if(c.length!==p)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+p+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,e,o),R.runKernelFunc(function(s){return s.sparseToDense(a,i,e,o)},{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),Xx=I({gatherND_:function(r,n){var e=C(n,"indices","gatherND","int32"),t=C(r,"x","gatherND");return R.runKernelFunc(function(a){return a.gatherND(t,e)},{x:t,indices:e},null,"GatherNd")}}),$x=I({diag_:function(r){var n=C(r,"x","diag").flatten(),e=r.shape.concat(r.shape);return R.runKernelFunc(function(t){return t.diag(n)},{$x:n}).reshape(e)}}),Qx=I({dropout_:function(r,n,e,t){var a=C(r,"x","dropout");if(E(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),E(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),n===0)return r instanceof Pe?a.clone():a;var i=function(u,c){if(c==null)return u.shape.slice();if(nt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)c[d]==null&&u.shape[d]!=null?l.push(u.shape[d]):l.push(c[d]);return l}return c}(a,e),o=1-n,s=Mh(i,0,1,"float32",t).add(o).floor().div(o);return a.mul(s)}});function Qf(r,n,e){for(var t=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+t-1);a[i]=n-e*Math.cos(o)}return Be(a,"float32")}var Ic=I({hannWindow_:function(r){return Qf(r,.5,.5)}}),Jf=I({hammingWindow_:function(r){return Qf(r,.54,.46)}}),Rc=I({frame_:function(r,n,e,t,a){t===void 0&&(t=!1),a===void 0&&(a=0);for(var i=0,o=[];i+n<=r.size;)o.push(cn(r,i,n)),i+=e;if(t)for(;i<r.size;){var s=i+n-r.size,u=We([cn(r,i,n-s),Gt([s],a)]);o.push(u),i+=e}return o.length===0?Sn([],[0,n]):We(o).as2D(o.length,n)}}),Zf=I({stft_:function(r,n,e,t,a){var i;a===void 0&&(a=Ic),t==null&&(i=n,t=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var o=Rc(r,n,e),s=qe(o,a(n)),u=[],c=0;c<o.shape[0];c++)u.push(Ac(s.slice([c,0],[1,n]),t));return We(u)}}),Jx=Object.freeze({hannWindow:Ic,hammingWindow:Jf,frame:Rc,stft:Zf}),kt,Zx=function(r,n,e){return e===void 0&&(e=1),re(this,void 0,void 0,function(){var t,a,i,o,s,u,c,l,d,p,h,f,v,m;return ae(this,function(g){switch(g.label){case 0:return t=C(r,"predictions","inTopK"),a=C(n,"targets","inTopK"),E(t.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+t.rank}),E(t.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+t.rank+" and targets rank "+a.rank}),Re(t.shape.slice(0,t.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=t.shape[t.shape.length-1],E(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,t.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=[o.length/i,i],l=u[1],d=ya("bool",c=u[0]),p=0;p<c;p++){for(h=p*l,f=o.subarray(h,h+l),v=[],m=0;m<f.length;m++)v.push({value:f[m],index:m});for(v.sort(function(b,x){return x.value-b.value}),d[p]=0,m=0;m<e;m++)if(v[m].index===s[p]){d[p]=1;break}}return r!==t&&t.dispose(),n!==a&&a.dispose(),[2,dt(d,a.shape,"bool")]}})})};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(kt||(kt={}));var e1=I({absoluteDifference_:function(r,n,e,t){t===void 0&&(t=kt.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","absoluteDifference"),i=C(n,"predictions","absoluteDifference"),o=null;e!=null&&(o=C(e,"weights","absoluteDifference")),Re(a.shape,i.shape,"Error in absoluteDifference: ");var s=a.sub(i).abs();return jn(s,o,t)}}),jn=I({computeWeightedLoss_:function(r,n,e){e===void 0&&(e=kt.SUM_BY_NONZERO_WEIGHTS);var t=C(r,"losses","computeWeightedLoss"),a=null;n!=null&&(a=C(n,"weights","computeWeightedLoss"));var i=a==null?t:t.mul(a);if(e===kt.NONE)return i;if(e===kt.SUM)return i.sum();if(e===kt.MEAN){if(a==null)return i.mean();var o=t.size/a.size,s=i.sum().div(a.sum());return o>1?s.div(J(o)):s}if(e===kt.SUM_BY_NONZERO_WEIGHTS){if(a==null)return i.sum().div(J(t.size));var u=a.mul(wa(t.shape)).notEqual(J(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),t1=I({cosineDistance_:function(r,n,e,t,a){a===void 0&&(a=kt.SUM_BY_NONZERO_WEIGHTS);var i=C(r,"labels","cosineDistance"),o=C(n,"predictions","cosineDistance"),s=null;t!=null&&(s=C(t,"weights","cosineDistance")),Re(i.shape,o.shape,"Error in cosineDistance: ");var u=J(1).sub(i.mul(o).sum(e,!0));return jn(u,s,a)}}),n1=I({hingeLoss_:function(r,n,e,t){t===void 0&&(t=kt.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","hingeLoss"),i=C(n,"predictions","hingeLoss"),o=null;e!=null&&(o=C(e,"weights","hingeLoss")),Re(a.shape,i.shape,"Error in hingeLoss: ");var s=J(1);a=J(2).mul(a).sub(s);var u=s.sub(a.mul(i)).relu();return jn(u,o,t)}}),r1=I({huberLoss_:function(r,n,e,t,a){t===void 0&&(t=1),a===void 0&&(a=kt.SUM_BY_NONZERO_WEIGHTS);var i=C(r,"labels","huberLoss"),o=C(n,"predictions","huberLoss"),s=null;e!=null&&(s=C(e,"weights","huberLoss")),Re(i.shape,o.shape,"Error in huberLoss: ");var u=J(t),c=o.sub(i).abs(),l=Mf(c,u),d=c.sub(l),p=J(.5).mul(l.square()).add(u.mul(d));return jn(p,s,a)}}),a1=I({logLoss_:function(r,n,e,t,a){t===void 0&&(t=1e-7),a===void 0&&(a=kt.SUM_BY_NONZERO_WEIGHTS);var i=C(r,"labels","logLoss"),o=C(n,"predictions","logLoss"),s=null;e!=null&&(s=C(e,"weights","logLoss")),Re(i.shape,o.shape,"Error in logLoss: ");var u=J(1),c=J(t),l=i.mul(o.add(c).log()).neg().sub(u.sub(i).mul(u.sub(o).add(c).log()));return jn(l,s,a)}}),i1=I({meanSquaredError_:function(r,n,e,t){t===void 0&&(t=kt.SUM_BY_NONZERO_WEIGHTS);var a=C(r,"labels","meanSquaredError"),i=C(n,"predictions","meanSquaredError"),o=null;e!=null&&(o=C(e,"weights","meanSquaredError")),Re(a.shape,i.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(i);return jn(s,o,t)}}),o1=I({sigmoidCrossEntropy_:function(r,n,e,t,a){t===void 0&&(t=0),a===void 0&&(a=kt.SUM_BY_NONZERO_WEIGHTS);var i=C(r,"multiClassLabels","sigmoidCrossEntropy"),o=C(n,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=C(e,"weights","sigmoidCrossEntropy")),Re(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),t>0){var u=J(t),c=J(1),l=J(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(p,h){var f=C(p,"labels","sigmoidCrossEntropyWithLogits"),v=C(h,"logits","sigmoidCrossEntropyWithLogits");Re(f.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=v.relu(),g=v.mul(f),b=v.abs().neg().exp().log1p();return m.sub(g).add(b)}(i,o);return jn(d,s,a)}}),s1=I({softmaxCrossEntropy_:function(r,n,e,t,a){t===void 0&&(t=0),a===void 0&&(a=kt.SUM_BY_NONZERO_WEIGHTS);var i=C(r,"onehotLabels","softmaxCrossEntropy"),o=C(n,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=C(e,"weights","softmaxCrossEntropy")),Re(i.shape,o.shape,"Error in softmaxCrossEntropy: "),t>0){var u=J(t),c=J(1),l=J(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(p,h,f){if(f===void 0&&(f=-1),f===-1&&(f=h.rank-1),f!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+f);return es(function(v,m,g){var b=m.logSumExp([f],!0),x=m.toFloat().sub(b);return g([v,x]),{value:x.mul(v).neg().sum([f]),gradFunc:function(y,_){var w=_[0],A=_[1],S=It(y.shape,[f]);return[y.reshape(S).mul(w.toFloat().sub(A.exp())),y.reshape(S).mul(A.exp().sub(w.toFloat()))]}}})(p,h)}(i,o);return jn(d,s,a)}}),u1=Object.freeze({get Reduction(){return kt},absoluteDifference:e1,computeWeightedLoss:jn,cosineDistance:t1,hingeLoss:n1,huberLoss:r1,logLoss:a1,meanSquaredError:i1,sigmoidCrossEntropy:o1,softmaxCrossEntropy:s1});function kp(r,n){return n===void 0&&(n=!1),R.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var e=r.shape[0],t=r.shape[1],a=Fh(e),i=r.clone(),o=Sn([[1]],[1,1]),s=o.clone(),u=e>=t?t:e,c=function(d){var p,h=i,f=s,v=a;p=R.tidy(function(){var m=i.slice([d,d],[e-d,1]),g=m.norm(),b=i.slice([d,d],[1,1]),x=Sn([[-1]]).where(b.greater(0),Sn([[1]])),y=b.sub(x.mul(g)),_=m.div(y);s=_.shape[0]===1?o.clone():o.concat(_.slice([1,0],[_.shape[0]-1,_.shape[1]]),0);var w=x.matMul(y).div(g).neg(),A=i.slice([d,0],[e-d,t]),S=w.mul(s);if(d===0)i=A.sub(S.matMul(s.transpose().matMul(A)));else{var D=A.sub(S.matMul(s.transpose().matMul(A)));i=i.slice([0,0],[d,t]).concat(D,0)}var k=a.slice([0,d],[e,a.shape[1]-d]);if(d===0)a=k.sub(k.matMul(s).matMul(S.transpose()));else{var F=k.sub(k.matMul(s).matMul(S.transpose()));a=a.slice([0,0],[e,d]).concat(F,1)}return[s,i,a]}),s=p[0],i=p[1],a=p[2],Ot([h,f,v])},l=0;l<u;++l)c(l);return!n&&e>t&&(a=a.slice([0,0],[e,t]),i=i.slice([0,0],[t,t])),[a,i]})}var c1=I({bandPart_:function(r,n,e){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var t=C(r,"a","bandPart");if(t.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+t.rank+".");var a=t.shape,i=t.shape.slice(-2),o=i[0],s=i[1];if(!(n<=o))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+o+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");n<0&&(n=o),e<0&&(e=s);var u=Wo(0,o,1,"int32").reshape([-1,1]),c=Wo(0,s,1,"int32"),l=Oe(u,c),d=as(l.lessEqual(J(+n,"int32")),l.greaterEqual(J(-e,"int32"))),p=Le([o,s],t.dtype);return xt(Fe(t.reshape([-1,o,s])).map(function(h){return Lr(d,h,p)})).reshape(a)}}),l1=I({gramSchmidt_:function(r){var n;if(Array.isArray(r)){n=!1,E(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=r[0].shape[0],t=function(u){E(r[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+e+")"})},a=1;a<r.length;++a)t(a)}else n=!0,r=oc(r,r.shape[0],0).map(function(u){return Ph(u,[0])});E(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var i=[],o=r,s=function(u){i.push(R.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var d=jf(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(Xf(c,"euclidean"))}))};for(a=0;a<r.length;++a)s(a);return n?xt(i,0):i}}),d1=I({qr_:function(r,n){if(n===void 0&&(n=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return kp(r,n);var e=r.shape.slice(0,r.shape.length-2).reduce(function(o,s){return o*s}),t=Fe(r.reshape([e,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];return t.forEach(function(o){var s=kp(o,n),u=s[0],c=s[1];a.push(u),i.push(c)}),[xt(a,0).reshape(r.shape),xt(i,0).reshape(r.shape)]}}),p1=Object.freeze({bandPart:c1,gramSchmidt:l1,qr:d1});function is(r,n,e,t,a,i){t==null&&(t=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return e=Math.min(e,o),E(0<=t&&t<=1,function(){return"iouThreshold must be in [0, 1], but was '"+t+"'"}),E(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),E(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),E(n.rank===1,function(){return"scores must be a 1D tensor"}),E(n.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+n.shape[0]}),E(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:t,scoreThreshold:a,softNmsSigma:i}}var h1=I({resizeBilinear_:function(r,n,e){e===void 0&&(e=!1);var t=C(r,"images","resizeBilinear");E(t.rank===3||t.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+t.rank+"."}),E(n.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var a=t,i=!1;t.rank===3&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([a]),c.resizeBilinear(a,o,s,e)},{x:a},function(c,l){return{x:function(){return R.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:o,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),f1=I({resizeNearestNeighbor_:function(r,n,e){e===void 0&&(e=!1);var t=C(r,"images","resizeNearestNeighbor");E(t.rank===3||t.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+t.rank+"."}),E(n.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),E(t.dtype==="float32"||t.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=t,i=!1;t.rank===3&&(i=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=n[0],s=n[1],u=R.runKernelFunc(function(c,l){return l([a]),c.resizeNearestNeighbor(a,o,s,e)},{batchImages:a},function(c,l){return{batchImages:function(){return R.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),m1=I({nonMaxSuppression_:function(r,n,e,t,a){t===void 0&&(t=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=C(r,"boxes","nonMaxSuppression"),o=C(n,"scores","nonMaxSuppression"),s=is(i,o,e,t,a);e=s.maxOutputSize,t=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:e,iouThreshold:t,scoreThreshold:a};return R.runKernelFunc(function(c){return c.nonMaxSuppression(i,o,e,t,a)},{boxes:i,scores:o},null,"NonMaxSuppressionV3",u)}}),v1=function(r,n,e,t,a){return t===void 0&&(t=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),re(this,void 0,void 0,function(){var i,o,s,u,c,l,d;return ae(this,function(p){switch(p.label){case 0:return i=C(r,"boxes","nonMaxSuppressionAsync"),o=C(n,"scores","nonMaxSuppressionAsync"),s=is(i,o,e,t,a),e=s.maxOutputSize,t=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=p.sent(),c=u[0],l=u[1],d=mc(c,l,e,t,a),i!==r&&i.dispose(),o!==n&&o.dispose(),[2,d]}})})},g1=I({nonMaxSuppressionWithScore_:function(r,n,e,t,a,i){t===void 0&&(t=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=C(r,"boxes","nonMaxSuppression"),s=C(n,"scores","nonMaxSuppression"),u=is(o,s,e,t,a,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:t=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=R.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),y1=function(r,n,e,t,a,i){return t===void 0&&(t=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),re(this,void 0,void 0,function(){var o,s,u,c,l,d,p;return ae(this,function(h){switch(h.label){case 0:return o=C(r,"boxes","nonMaxSuppressionAsync"),s=C(n,"scores","nonMaxSuppressionAsync"),u=is(o,s,e,t,a,i),e=u.maxOutputSize,t=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=h.sent(),l=c[0],d=c[1],p=vc(l,d,e,t,a,i),o!==r&&o.dispose(),s!==n&&s.dispose(),[2,p]}})})},b1=I({cropAndResize_:function(r,n,e,t,a,i){var o=C(r,"image","cropAndResize"),s=C(n,"boxes","cropAndResize","float32"),u=C(e,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var c=s.shape[0];return E(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),E(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),E(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),E(t.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+t.length+"."}),E(t[0]>=1&&t[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+t}),E(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),R.runKernelFunc(function(l,d){return l.cropAndResize(o,s,u,t,a,i)},{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:t})}}),Ii=Object.freeze({resizeBilinear:h1,resizeNearestNeighbor:f1,nonMaxSuppression:m1,nonMaxSuppressionAsync:v1,nonMaxSuppressionWithScore:g1,nonMaxSuppressionWithScoreAsync:y1,cropAndResize:b1}),Tc=function(r,n){return!(r>0)||n==="linear"},Fc=function(r,n,e){if(e==null||e==="linear")return r;if(e==="relu")return r.mul(n.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Mc=function(r,n){var e=n,t=rt(r.shape,n.shape);return t.length>0&&(e=e.sum(t)),e.reshape(r.shape)},Nc=function(r,n,e){if(n==="linear")return r;if(n==="relu")return Te(r);if(n==="elu")return qf(r);if(n==="relu6")return Kf(r);if(n==="prelu")return Yf(r,e);throw new Error("Unknown fused activation "+n+".")},x1=I({fusedMatMul_:function(r){var n,e=r.a,t=r.b,a=r.transposeA,i=a!==void 0&&a,o=r.transposeB,s=o!==void 0&&o,u=r.bias,c=r.activation,l=c===void 0?"linear":c,d=r.preluActivationWeights;if(Tc(R.state.gradientDepth,l)===!1){var p=Ca(e,t,i,s);return u!=null&&(p=de(p,u)),Nc(p,l,d)}var h=C(e,"a","fused matMul"),f=C(t,"b","fused matMul");n=Ue(h,f),h=n[0],f=n[1];var v=i?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?f.shape[f.rank-1]:f.shape[f.rank-2],g=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?f.shape[f.rank-2]:f.shape[f.rank-1],x=h.shape.slice(0,-2),y=f.shape.slice(0,-2),_=ie(x),w=ie(y);E(h.rank>=2&&f.rank>=2&&h.rank===f.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+f.rank+"."}),E(nt(x,y),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+y+") of Tensors with shapes "+h.shape+" and "+f.shape+" must match."}),E(v===m,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+h.shape+" and "+f.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var A,S,D=h.shape.slice(0,-2).concat([g,b]),k=i?h.as3D(_,v,g):h.as3D(_,g,v),F=s?f.as3D(w,b,m):f.as3D(w,m,b);u!=null&&xe(D,(A=Ue(A=C(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(S=C(d,"prelu weights","fused matMul"));var T={a:k,b:F};u!=null&&(T.bias=A),d!=null&&(T.preluActivationWeights=S);var W=[k,F];return R.runKernelFunc(function(L,V){var H=L.fusedBatchMatMul({a:k,b:F,transposeA:i,transposeB:s,bias:A,activation:l,preluActivationWeights:S});return V([k,F,H]),H},T,function(L,V){var H=V[0],U=V[1],z=V[2],q=Fc(L,z,l),K={};return u!=null&&(K={bias:function(){return Mc(A,q)}}),Object.assign(i||s?!i&&s?{a:function(){return q.matMul(U,!1,!1)},b:function(){return q.matMul(H,!0,!1)}}:i&&!s?{a:function(){return U.matMul(q,!1,!0)},b:function(){return H.matMul(q,!1,!1)}}:{a:function(){return U.matMul(q,!0,!0)},b:function(){return q.matMul(H,!0,!0)}}:{a:function(){return q.matMul(U,!1,!0)},b:function(){return H.matMul(q,!0,!1)}},K)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},W,[!0]).reshape(D)}}),_1=I({fusedConv2d_:function(r){var n=r.x,e=r.filter,t=r.strides,a=r.pad,i=r.dataFormat,o=i===void 0?"NHWC":i,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,d=r.activation,p=d===void 0?"linear":d,h=r.preluActivationWeights;if(p=p||"linear",Tc(R.state.gradientDepth,p)===!1){var f=pt(n,e,t,a,o,u,c);return l!=null&&(f=de(f,l)),Nc(f,p,h)}var v=C(n,"x","conv2d"),m=C(e,"filter","conv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),E(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),E(m.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),c!=null&&E(Ye(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+a+"."}),E(g.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),E(Rt(t,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"}),E(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var x,y,_=gr(g.shape,m.shape,t,u,a,c);l!=null&&(x=Ue(x=C(l,"bias","fused conv2d"),v)[0],xe(_.outShape,x.shape)),h!=null&&(y=C(h,"prelu weights","fused conv2d"));var w={x:g,filter:m};l!=null&&(w.bias=x),h!=null&&(w.preluActivationWeights=y);var A=[m,g],S=R.runKernelFunc(function(D,k){var F=D.fusedConv2d({input:g,filter:m,convInfo:_,bias:x,activation:p,preluActivationWeights:y});return k([m,g,F]),F},w,function(D,k){var F=k,T=F[0],W=F[1],L=F[2],V=Fc(D,L,p);E(Br(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var H={};return l!=null&&(H={bias:function(){return Mc(x,V)}}),Object.assign({x:function(){return Vf(W.shape,V,T,t,a)},filter:function(){return Dc(W,V,T.shape,t,a)}},H)},"FusedConv2D",{convInfo:_,activation:p},A,[!0]);return b?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),w1=I({fusedDepthwiseConv2d_:function(r){var n=r.x,e=r.filter,t=r.strides,a=r.pad,i=r.dataFormat,o=i===void 0?"NHWC":i,s=r.dilations,u=s===void 0?[1,1]:s,c=r.dimRoundingMode,l=r.bias,d=r.activation,p=d===void 0?"linear":d,h=r.preluActivationWeights;if(Tc(R.state.gradientDepth,p)===!1){var f=ki(n,e,t,a,o,u,c);return l!=null&&(f=de(f,l)),Nc(f,p,h)}var v=C(n,"x","depthwiseConv2d"),m=C(e,"filter","depthwiseConv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),E(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),E(m.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),E(g.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),u==null&&(u=[1,1]),E(Rt(t,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"}),c!=null&&E(Ye(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+a+"."});var x,y,_=gr(g.shape,m.shape,t,u,a,c,!0);l!=null&&(x=Ue(x=C(l,"bias","fused conv2d"),v)[0],xe(_.outShape,x.shape)),h!=null&&(y=C(h,"prelu weights","fused depthwiseConv2d"));var w={x:g,filter:m};l!=null&&(w.bias=x),h!=null&&(w.preluActivationWeights=y);var A=[m,g],S=R.runKernelFunc(function(D,k){var F=D.fusedDepthwiseConv2D({input:g,filter:m,convInfo:_,bias:x,activation:p,preluActivationWeights:y});return k([m,g,F]),F},w,function(D,k){E(Br(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var F=k[0],T=k[1],W=k[2],L=Fc(D,W,p),V={};return l!=null&&(V={bias:function(){return Mc(x,L)}}),Object.assign({x:function(){return Wf(T.shape,L,F,_)},filter:function(){return zf(T,L,F.shape,_)}},V)},"FusedDepthwiseConv2D",{convInfo:_,activation:p},A,[!0]);return b?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),C1=Object.freeze({matMul:x1,conv2d:_1,depthwiseConv2d:w1}),E1=Object.freeze({image:Ii,linalg:p1,losses:u1,spectral:Yx,fused:C1,signal:Jx,square:ab,squaredDifference:Df,conv1d:hx,conv2d:pt,conv3d:fx,depthwiseConv2d:ki,separableConv2d:Si,conv2dTranspose:mx,conv3dTranspose:vx,op:I,batchNormalization2d:Nb,batchNormalization3d:Pb,batchNormalization4d:Ob,batchNormalization:Bb,batchNorm:wc,batchNorm2d:Lb,batchNorm3d:Vb,batchNorm4d:Wb,booleanMaskAsync:px,complex:gt,real:$t,imag:kn,concat:We,concat1d:jg,concat2d:qg,concat3d:Yg,concat4d:Kg,split:oc,matMul:Ca,dot:gx,outerProduct:yx,reverse:Ai,reverse1d:bx,reverse2d:xx,reverse3d:_x,reverse4d:wx,maxPool:Ke,avgPool:Gn,pool:Cx,maxPool3d:Ex,avgPool3d:Dx,slice:cn,slice1d:kx,slice2d:Sx,slice3d:kc,slice4d:Ax,abs:ib,acos:ob,acosh:sb,asin:ub,asinh:cb,atan:lb,atanh:db,ceil:pb,clipByValue:Ci,cos:hb,cosh:fb,erf:mb,exp:ns,expm1:vb,floor:gb,log:yb,log1p:bb,logSigmoid:xb,neg:Ei,reciprocal:_b,round:wb,rsqrt:kf,sigmoid:_c,sign:Cb,isNaN:Eb,isInf:Db,isFinite:kb,sin:Sb,sinh:Ab,softplus:Ib,sqrt:Rb,step:Tb,tan:Fb,tanh:Mb,all:Ix,any:Rx,argMax:Tx,argMin:Fx,logSumExp:Mx,max:zr,mean:Nx,min:Px,moments:Ox,sum:jf,prod:Bx,equal:Nf,equalStrict:nx,greater:rx,greaterEqual:Pf,greaterEqualStrict:ax,greaterStrict:ix,less:ox,lessEqual:sx,lessEqualStrict:ux,lessStrict:cx,notEqual:lx,notEqualStrict:dx,add:de,addN:Hb,addStrict:Gb,atan2:jb,div:Qt,divNoNan:qb,divStrict:Yb,floorDiv:Ff,maximum:Cc,maximumStrict:Kb,minimum:Mf,minimumStrict:Xb,mod:$b,modStrict:Qb,mul:qe,mulStrict:Jb,pow:qo,powStrict:Zb,squaredDifferenceStrict:ex,sub:Oe,subStrict:tx,elu:qf,leakyRelu:Lx,prelu:Yf,relu:Te,relu6:Kf,selu:Vx,logicalAnd:as,logicalNot:zb,logicalOr:Rf,logicalXor:Ub,where:Lr,whereAsync:Tf,buffer:he,print:r0,batchToSpaceND:Th,broadcastTo:a0,cast:i0,clone:o0,cumsum:s0,depthToSpace:u0,expandDims:Et,eye:Fh,multinomial:c0,oneHot:Hu,pad:Hn,pad1d:l0,pad2d:d0,pad3d:p0,pad4d:h0,rand:f0,randomNormal:m0,randomGamma:v0,randomUniform:Mh,reshape:Tt,spaceToBatchND:Nh,squeeze:Ph,stack:xt,tile:Nr,truncatedNormal:g0,unstack:Fe,setdiff1dAsync:y0,fill:Gt,linspace:Gg,ones:wa,range:Wo,scalar:J,tensor:dt,tensor1d:Be,tensor2d:Sn,tensor3d:Qo,tensor4d:st,tensor5d:zg,tensor6d:Ug,variable:Hg,zeros:Le,onesLike:Rh,zerosLike:ke,transpose:Jt,softmax:Ft,logSoftmax:x0,localResponseNormalization:Wx,norm:Xf,gather:Ec,unsortedSegmentSum:Of,basicLSTMCell:zx,multiRNNCell:Ux,movingAverage:Hx,stridedSlice:Gx,topk:jx,scatterND:qx,fft:Sc,ifft:Yo,rfft:Ac,irfft:$f,sparseToDense:Kx,gatherND:Xx,diag:$x,dropout:Qx,hannWindow:Ic,hammingWindow:Jf,frame:Rc,stft:Zf,inTopKAsync:Zx});function G(r,n){Array.isArray(r)||(r=[r]),r.forEach(function(e){e!=null&&E(e.dtype!=="complex64",function(){return n+" does not support complex64 tensors."})})}function _u(r,n,e,t){if(e==="linear")return r.linear(n);if(e==="relu")return r.relu(n);if(e==="elu")return r.elu(n);if(e==="relu6")return r.relu6(n);if(e==="prelu")return r.prelu(n,t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var D1=function(r){function n(){var e=r.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Hh(e,R),e}return ln(n,r),n.prototype.write=function(e,t,a){this.firstUse&&(this.firstUse=!1,B().get("IS_NODE")&&Lo(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:e,dtype:a}),i},n.prototype.move=function(e,t,a,i){this.data.set(e,{values:t,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),a=t.dtype,i=t.complexTensors;return a==="complex64"?qu(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),a=t;if(e.dtype==="string")try{a=t.map(function(i){return pi(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return he(e.shape,e.dtype,a)},n.prototype.makeOutput=function(e,t,a){var i=this.write(e,t,a);return R.makeTensorFromDataId(i,t,a,this)},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return re(this,void 0,void 0,function(){var t;return ae(this,function(a){return t=sn(),e(),[2,{kernelMs:sn()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var a=this.makeOutput(null,e.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:R.keep(e.clone()),imag:R.keep(t.clone())},a},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,a){if(G(e,"slice"),lc(e.shape,t,a)){var i=dc(t,e.strides),o=ie(a);return dt(this.readSync(e.dataId).subarray(i,i+o),a,e.dtype)}for(var s=he(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,p){return d+t[p]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,t,a,i){G(e,"stridedSlice");var o=Zo(t,a,i);if(o.some(function(h){return h===0}))return dt([],o);for(var s=he(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),p=0;p<d.length;p++)d[p]=l[p]*i[p]+t[p];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(e){for(var t=this.readSync(e.dataId),a=he([e.size,e.size],e.dtype),i=a.values,o=0;o<t.length;o++)i[o*e.size+o]=t[o];return a.toTensor()},n.prototype.unstack=function(e,t){for(var a=e.shape[t],i=new Array(e.rank-1),o=0,s=0;s<e.rank;s++)s!==t&&(i[o++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[t]=1;var l=new Array(a);for(s=0;s<l.length;s++)u[t]=s,l[s]=this.slice(e,u,c).reshape(i);return l},n.prototype.reverse=function(e,t){G(e,"reverse");for(var a=he(e.shape,e.dtype),i=this.bufferSync(e),o=function(u){var c=a.indexToLoc(u),l=c.slice();t.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),a.set.apply(a,[i.get.apply(i,l)].concat(c))},s=0;s<a.size;s++)o(s);return a.toTensor()},n.prototype.concat=function(e,t){var a=this;if(e[0].dtype==="complex64"){var i=e.map(function(h){return $t(h)}),o=e.map(function(h){return kn(h)});return gt(this.concat(i,t),this.concat(o,t))}var s=e.map(function(h){var f=ie(h.shape.slice(t));return h.as2D(-1,f)}),u=Or(s.map(function(h){return h.shape}),1),c=he(u,e[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(h){c.set(a.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var f=a.readSync(h.dataId),v=0,m=0;m<h.shape[0];++m)for(var g=m*u[1]+d,b=0;b<h.shape[1];++b)c[g+b]=f[v++];d+=h.shape[1]})}var p=Or(e.map(function(h){return h.shape}),t);return dt(c,p,e[0].dtype)},n.prototype.neg=function(e){return G(e,"neg"),this.multiply(J(-1),e)},n.prototype.add=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(a,i,o,s){return{real:a+o,imag:i+s}}):this.broadcastedBinaryOp(e,t,lt(e.dtype,t.dtype),function(a,i){return a+i})},n.prototype.addN=function(e){var t=this;G(e,"addN");for(var a=e.map(function(l){return t.readSync(l.dataId)}),i=he(e[0].shape,e[0].dtype),o=i.values,s=0;s<e.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(e,t){var a=at([t],e.shape),i=this.max(e,a),o=It(i.shape,a),s=this.subtract(e,i.reshape(o)),u=this.exp(s),c=this.sum(u,a).reshape(o);return this.realDivide(u,c)},n.prototype.subtract=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(a,i,o,s){return{real:a-o,imag:i-s}}):this.broadcastedBinaryOp(e,t,lt(e.dtype,t.dtype),function(a,i){return a-i})},n.prototype.pow=function(e,t){return G([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){return Math.pow(a,i)})},n.prototype.batchMatMul=function(e,t,a,i){G([e,t],"matMul");for(var o=a?e.shape[1]:e.shape[2],s=a?e.shape[2]:e.shape[1],u=i?t.shape[1]:t.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(t.dataId),p=a?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=p[0],f=p[1],v=p[2],m=i?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],g=m[0],b=m[1],x=m[2],y=s*u,_=he([c,s,u],e.dtype),w=_.values,A=this.blockSize,S=0;S<c;S++)for(var D=0;D<s;D+=A)for(var k=0;k<u;k+=A)for(var F=0;F<o;F+=A)for(var T=Math.min(D+A,s),W=Math.min(k+A,u),L=Math.min(F+A,o),V=D;V<T;V++)for(var H=k;H<W;H++){for(var U=0,z=F;z<L;z++)U+=l[S*h+V*f+z*v]*d[z*g+H*b+S*x];w[S*y+(V*u+H)]+=U}return _.toTensor()},n.prototype.fusedBatchMatMul=function(e){var t=e.a,a=e.b,i=e.transposeA,o=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(t,a,i,o);return s&&(l=this.add(l,s)),u&&(l=_u(this,l,u,c)),l},n.prototype.multiply=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(a,i,o,s){return{real:a*o-i*s,imag:a*s+i*o}}):this.broadcastedBinaryOp(e,t,lt(e.dtype,t.dtype),function(a,i){return a*i})},n.prototype.realDivide=function(e,t){return G([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(a,i){return a/i})},n.prototype.floorDiv=function(e,t){return G([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(a,i){return Math.floor(a/i)})},n.prototype.sum=function(e,t){G(e,"sum"),Nt("sum",t,e.rank);for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,lt(e.dtype,"int32")),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=0,f=0;f<u;++f)h+=l[p+f];c[d]=h}return s},n.prototype.prod=function(e,t){G(e,"sum");for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,lt(e.dtype,"int32")),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=1,f=0;f<u;++f)h*=l[p+f];c[d]=h}return s},n.prototype.unsortedSegmentSum=function(e,t,a){G(e,"unsortedSegmentSum");for(var i=[],o=e.rank-t.rank,s=0;s<o;++s)t=t.expandDims(s+1);for(s=0;s<a;++s){var u=J(s,"int32"),c=Nf(u,t).asType("float32").mul(e).sum(0);i.push(c)}return xt(i)},n.prototype.argMin=function(e,t){G(e,"argMin");var a=[t];Nt("argMin",a,e.rank);for(var i=yt(e.shape,a),o=i[0],s=i[1],u=Le(o,"int32"),c=ie(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<l.length;++p){for(var h=p*c,f=d[h],v=0,m=0;m<c;++m){var g=d[h+m];g<f&&(f=g,v=m)}l[p]=v}return u},n.prototype.argMax=function(e,t){G(e,"argMax");var a=[t];Nt("argMax",a,e.rank);for(var i=yt(e.shape,a),o=i[0],s=i[1],u=Le(o,"int32"),c=ie(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),p=0;p<l.length;++p){for(var h=p*c,f=d[h],v=0,m=0;m<c;++m){var g=d[h+m];g>f&&(f=g,v=m)}l[p]=v}return u},n.prototype.cumsum=function(e,t,a,i){if(G(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=lt(e.dtype,"int32"),s=Le(e.shape,o),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(m,g){return m+l-g-1}:function(m,g){return m+g},p=0;p<c.length;p+=l)for(var h=0;h<l;h++){var f=d(p,h);if(h===0)u[f]=a?0:c[f];else{var v=d(p,h-1);u[f]=a?c[v]+u[v]:c[f]+u[v]}}return s},n.prototype.equal=function(e,t){return G([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a===i?1:0})},n.prototype.notEqual=function(e,t){return G([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a!==i?1:0})},n.prototype.less=function(e,t){return G([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a<i?1:0})},n.prototype.lessEqual=function(e,t){return G([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a<=i?1:0})},n.prototype.greater=function(e,t){return G([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a>i?1:0})},n.prototype.greaterEqual=function(e,t){return G([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a>=i?1:0})},n.prototype.logicalNot=function(e){G(e,"logicalNot");for(var t=this.readSync(e.dataId),a=new Uint8Array(t.length),i=0;i<t.length;++i)a[i]=t[i]?0:1;return this.makeOutput(a,e.shape,"bool")},n.prototype.logicalAnd=function(e,t){return G([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a&&i})},n.prototype.logicalOr=function(e,t){return G([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(a,i){return a||i})},n.prototype.select=function(e,t,a){G([e,t,a],"select");for(var i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=this.readSync(a.dataId),u=Le(t.shape,lt(t.dtype,a.dtype)),c=this.readSync(u.dataId),l=0,d=e.rank===0||e.rank>1||t.rank===1?1:ie(t.shape.slice(1)),p=0;p<i.length;p++)for(var h=0;h<d;h++)i[p]===1?c[l++]=o[p]:c[l++]=s[p];return u},n.prototype.where=function(e){G([e],"where");var t=this.readSync(e.dataId);return gc(e.shape,t)},n.prototype.topk=function(e,t,a){return G(e,"topk"),Kh(this.readSync(e.dataId),e.shape,e.dtype,t)},n.prototype.min=function(e,t){G(e,"min"),Nt("min",t,e.rank);for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,e.dtype),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=l[p],f=0;f<u;++f){var v=l[p+f];v<h&&(h=v)}c[d]=h}return s},n.prototype.minimum=function(e,t){return G([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){return Math.min(a,i)})},n.prototype.mod=function(e,t){return G([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){var o=a%i;return a<0&&i<0||a>=0&&i>=0?o:(o+i)%i})},n.prototype.max=function(e,t){G(e,"max"),Nt("max",t,e.rank);for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,e.dtype),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=l[p],f=0;f<u;++f){var v=l[p+f];v>h&&(h=v)}c[d]=h}return s},n.prototype.maximum=function(e,t){return G([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){return Math.max(a,i)})},n.prototype.all=function(e,t){G(e,"all"),Nt("all",t,e.rank);for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,e.dtype),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=l[p],f=0;f<u;++f){var v=l[p+f];h=h&&v}c[d]=h}return s},n.prototype.any=function(e,t){G(e,"any"),Nt("any",t,e.rank);for(var a=yt(e.shape,t),i=a[0],o=a[1],s=Le(i,e.dtype),u=ie(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var p=d*u,h=l[p],f=0;f<u;++f){var v=l[p+f];h=h||v}c[d]=h}return s},n.prototype.squaredDifference=function(e,t){return G([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){var o=a-i;return o*o})},n.prototype.ceil=function(e){G(e,"ceil");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)a[i]=Math.ceil(t[i]);return this.makeOutput(a,e.shape,"float32")},n.prototype.floor=function(e){G(e,"floor");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)a[i]=Math.floor(t[i]);return this.makeOutput(a,e.shape,"float32")},n.prototype.sign=function(e){G(e,"x");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)t[i]<0?a[i]=-1:t[i]>0?a[i]=1:a[i]=0;return this.makeOutput(a,e.shape,"float32")},n.prototype.isNaN=function(e){G(e,"x");for(var t=this.readSync(e.dataId),a=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isNaN(t[i])&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},n.prototype.isInf=function(e){G(e,"x");for(var t=this.readSync(e.dataId),a=new Uint8Array(t.length),i=0;i<t.length;++i)Math.abs(t[i])===1/0&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},n.prototype.isFinite=function(e){G(e,"x");for(var t=this.readSync(e.dataId),a=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isFinite(t[i])&&(a[i]=1);return this.makeOutput(a,e.shape,"bool")},n.prototype.round=function(e){G(e,"round");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i){var o=Math.floor(t[i]);t[i]-o<.5?a[i]=Math.floor(t[i]):t[i]-o>.5?a[i]=Math.ceil(t[i]):a[i]=o%2==0?o:o+1}return this.makeOutput(a,e.shape,"float32")},n.prototype.exp=function(e){G(e,"exp");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)a[i]=Math.exp(t[i]);return this.makeOutput(a,e.shape,"float32")},n.prototype.expm1=function(e){G(e,"expm1");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)a[i]=Math.expm1(t[i]);return this.makeOutput(a,e.shape,"float32")},n.prototype.log=function(e){G(e,"log");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];a[i]=Math.log(o)}return this.makeOutput(a,e.shape,"float32")},n.prototype.log1p=function(e){G(e,"log1p");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];a[i]=Math.log1p(o)}return this.makeOutput(a,e.shape,"float32")},n.prototype.sqrt=function(e){G(e,"sqrt");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];a[i]=Math.sqrt(o)}return this.makeOutput(a,e.shape,"float32")},n.prototype.rsqrt=function(e){G(e,"rsqrt");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];a[i]=1/Math.sqrt(o)}return this.makeOutput(a,e.shape,"float32")},n.prototype.reciprocal=function(e){G(e,"reciprocal");for(var t=this.readSync(e.dataId),a=new Float32Array(t.length),i=0;i<t.length;++i)a[i]=1/t[i];return this.makeOutput(a,e.shape,"float32")},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){G(e,"relu");for(var t=Le(e.shape,e.dtype),a=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)a[o]=Math.max(0,i[o]);return t},n.prototype.relu6=function(e){G(e,"relu");for(var t=Le(e.shape,e.dtype),a=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)a[o]=Math.min(Math.max(0,i[o]),6);return t},n.prototype.prelu=function(e,t){return G([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){return a<0?i*a:a})},n.prototype.elu=function(e){G(e,"elu");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];t[i]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},n.prototype.eluDer=function(e,t){G([e,t],"eluDer");for(var a=new Float32Array(t.size),i=this.readSync(t.dataId),o=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];a[s]=u>=1?o[s]:o[s]*(u+1)}return this.makeOutput(a,t.shape,"float32")},n.prototype.selu=function(e){G(e,"selu");for(var t=bc,a=xc,i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=0?a*u:t*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},n.prototype.clip=function(e,t,a){G(e,"clip");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>a?a:u<t?t:u}return this.makeOutput(i,e.shape,"float32")},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.abs(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<e.size;++i){var o=a[2*i],s=a[2*i+1];t[i]=Math.hypot(o,s)}return this.makeOutput(t,e.shape,"float32")},n.prototype.int=function(e){G(e,"int");for(var t=new Int32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=a[i];return this.makeOutput(t,e.shape,"int32")},n.prototype.sigmoid=function(e){G(e,"sigmoid");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=1/(1+Math.exp(-a[i]));return this.makeOutput(t,e.shape,"float32")},n.prototype.softplus=function(e){G(e,"softplus");for(var t=Math.log(11920928955078125e-23)+2,a=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o]>-t,u=i[o]<t,c=Math.exp(i[o]),l=void 0;l=u?c:s?i[o]:Math.log(1+c),a[o]=l}return this.makeOutput(a,e.shape,"float32")},n.prototype.sin=function(e){G(e,"sin");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.sin(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.cos=function(e){G(e,"cos");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.cos(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.tan=function(e){G(e,"tan");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.tan(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.asin=function(e){G(e,"asin");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.asin(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.acos=function(e){G(e,"acos");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.acos(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atan=function(e){G(e,"atan");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.atan(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atan2=function(e,t){return G([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(a,i){return Math.atan2(a,i)})},n.prototype.sinh=function(e){G(e,"sinh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.sinh(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.cosh=function(e){G(e,"cosh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.cosh(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.tanh=function(e){G(e,"tanh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Up(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.asinh=function(e){G(e,"asinh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.asinh(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.acosh=function(e){G(e,"acosh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.acosh(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.atanh=function(e){G(e,"atanh");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i)t[i]=Math.atanh(a[i]);return this.makeOutput(t,e.shape,"float32")},n.prototype.erf=function(e){G(e,"erf");for(var t=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=Math.sign(a[i]),s=Math.abs(a[i]),u=1/(1+.3275911*s);t[i]=o*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(t,e.shape,"float32")},n.prototype.step=function(e,t){t===void 0&&(t=0),G(e,"step");for(var a=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o];isNaN(s)?a[o]=NaN:a[o]=s>0?1:t}return this.makeOutput(a,e.shape,"float32")},n.prototype.fusedConv2d=function(e){var t=e.input,a=e.filter,i=e.convInfo,o=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(t,a,i);return o&&(c=this.add(c,o)),s&&(c=_u(this,c,s,u)),c},n.prototype.conv2d=function(e,t,a){G([e,t],"conv2d");for(var i=a.filterHeight,o=a.filterWidth,s=a.dilationHeight,u=a.dilationWidth,c=a.padInfo.left,l=a.padInfo.top,d=a.dataFormat==="channelsLast",p=he(a.outShape,e.dtype),h=e.strides[0],f=d?e.strides[1]:e.strides[2],v=d?e.strides[2]:1,m=d?1:e.strides[1],g=p.strides[0],b=d?p.strides[1]:p.strides[2],x=d?p.strides[2]:1,y=d?1:p.strides[1],_=this.readSync(e.dataId),w=this.readSync(t.dataId),A=p.values,S=0;S<a.batchSize;++S)for(var D=S*h,k=S*g,F=0;F<a.outHeight;++F)for(var T=k+F*b,W=F*a.strideHeight-l,L=0;L<i;L++){var V=W+L*s;if(!(V<0||V>=a.inHeight))for(var H=L*t.strides[0],U=D+V*f,z=0;z<a.outWidth;++z)for(var q=T+z*x,K=z*a.strideWidth-c,te=0;te<o;te++){var se=K+te*u;if(!(se<0||se>=a.inWidth))for(var le=U+se*v,ye=H+te*t.strides[1],be=0;be<a.inChannels;++be){for(var _e=_[le+be*m],Ee=0;Ee<a.outChannels;++Ee)A[q+Ee*y]+=_e*w[ye+Ee];ye+=a.outChannels}}}return p.toTensor()},n.prototype.conv3d=function(e,t,a){for(var i=a.filterDepth,o=a.filterHeight,s=a.filterWidth,u=a.dilationDepth,c=a.dilationHeight,l=a.dilationWidth,d=a.padInfo.front,p=a.padInfo.left,h=a.padInfo.top,f=he(a.outShape,e.dtype),v=this.readSync(e.dataId),m=this.readSync(t.dataId),g=f.values,b=0;b<a.batchSize;++b)for(var x=b*e.strides[0],y=b*f.strides[0],_=0;_<a.outDepth;++_)for(var w=y+_*f.strides[1],A=_*a.strideDepth-d,S=0;S<i;S++){var D=A+S*u;if(!(D<0||D>=a.inDepth))for(var k=S*t.strides[0],F=x+D*e.strides[1],T=0;T<a.outHeight;++T)for(var W=w+T*f.strides[2],L=T*a.strideHeight-h,V=0;V<o;V++){var H=L+V*c;if(!(H<0||H>=a.inHeight))for(var U=k+V*t.strides[1],z=F+H*e.strides[2],q=0;q<a.outWidth;++q)for(var K=W+q*a.outChannels,te=q*a.strideWidth-p,se=0;se<s;se++){var le=te+se*l;if(!(le<0||le>=a.inWidth))for(var ye=U+se*t.strides[2],be=z+le*a.inChannels,_e=ye,Ee=0;Ee<a.inChannels;++Ee){for(var we=v[be+Ee],De=0;De<a.outChannels;++De)g[K+De]+=we*m[_e+De];_e+=a.outChannels}}}}return f.toTensor()},n.prototype.conv2dDerInput=function(e,t,a){G([e,t],"conv2dDerInput");for(var i=he(a.inShape,"float32"),o=i.values,s=this.readSync(e.dataId),u=this.readSync(t.dataId),c=t.strides,l=c[0],d=c[1],p=c[2],h=a.batchSize,f=a.filterHeight,v=a.filterWidth,m=a.inChannels,g=a.inHeight,b=a.inWidth,x=a.outChannels,y=a.outHeight,_=a.outWidth,w=a.strideHeight,A=a.strideWidth,S=a.dataFormat,D=f-1-a.padInfo.top,k=v-1-a.padInfo.left,F=S==="channelsLast",T=i.strides[0],W=F?i.strides[1]:i.strides[2],L=F?i.strides[2]:1,V=F?1:i.strides[1],H=e.strides[0],U=F?e.strides[1]:e.strides[2],z=F?e.strides[2]:1,q=F?1:e.strides[1],K=0;K<h;++K)for(var te=0;te<m;++te)for(var se=0;se<g;++se)for(var le=se-D,ye=Math.max(0,Math.ceil(le/w)),be=Math.min(y,(f+le)/w),_e=0;_e<b;++_e){for(var Ee=_e-k,we=Math.max(0,Math.ceil(Ee/A)),De=Math.min(_,(v+Ee)/A),Qe=0,Ce=ye;Ce<be;++Ce)for(var Ne=Ce*w-le,Ae=we;Ae<De;++Ae)for(var Xe=H*K+U*Ce+z*Ae,He=l*(f-1-Ne)+d*(v-1-(Ae*A-Ee))+p*te,Ge=0;Ge<x;++Ge)Qe+=s[Xe+q*Ge]*u[He+Ge];o[T*K+W*se+L*_e+V*te]=Qe}return i.toTensor()},n.prototype.conv3dDerInput=function(e,t,a){for(var i=he(a.inShape,"float32"),o=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],p=this.readSync(e.dataId),h=e.strides,f=h[0],v=h[1],m=h[2],g=h[3],b=this.readSync(t.dataId),x=t.strides,y=x[0],_=x[1],w=x[2],A=x[3],S=a.batchSize,D=a.filterDepth,k=a.filterHeight,F=a.filterWidth,T=a.inChannels,W=a.inDepth,L=a.inHeight,V=a.inWidth,H=a.outChannels,U=a.outDepth,z=a.outHeight,q=a.outWidth,K=a.strideDepth,te=a.strideHeight,se=a.strideWidth,le=D-1-a.padInfo.front,ye=k-1-a.padInfo.top,be=F-1-a.padInfo.left,_e=0;_e<S;++_e)for(var Ee=0;Ee<T;++Ee)for(var we=0;we<W;++we)for(var De=we-le,Qe=Math.max(0,Math.ceil(De/K)),Ce=Math.min(U,(D+De)/K),Ne=0;Ne<L;++Ne)for(var Ae=Ne-ye,Xe=Math.max(0,Math.ceil(Ae/te)),He=Math.min(z,(k+Ae)/te),Ge=0;Ge<V;++Ge){for(var vn=Ge-be,gn=Math.max(0,Math.ceil(vn/se)),Lt=Math.min(q,(F+vn)/se),Qr=0,Mn=Qe;Mn<Ce;++Mn)for(var Jn=Mn*K-De,Nn=Xe;Nn<He;++Nn)for(var Jr=Nn*te-Ae,Pn=gn;Pn<Lt;++Pn)for(var Ns=f*_e+v*Mn+m*Nn+g*Pn,Zr=y*(D-1-Jn)+_*(k-1-Jr)+w*(F-1-(Pn*se-vn))+A*Ee,yn=0;yn<H;++yn)Qr+=p[Ns+yn]*b[Zr+yn];o[u*_e+c*we+l*Ne+d*Ge+Ee]=Qr}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,t,a){G([e,t],"conv2dDerFilter");for(var i=a.strideHeight,o=a.strideWidth,s=a.filterHeight,u=a.filterWidth,c=a.dataFormat==="channelsLast",l=he(a.filterShape,"float32"),d=a.padInfo.left,p=a.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((p-v)/i)),g=Math.min(a.outHeight,(a.inHeight+p-v)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((d-b)/o)),y=Math.min(a.outWidth,(a.inWidth+d-b)/o),_=0;_<a.inChannels;++_)for(var w=0;w<a.outChannels;++w){for(var A=0,S=0;S<a.batchSize;++S)for(var D=m;D<g;++D)for(var k=v+D*i-p,F=x;F<y;++F){var T=b+F*o-d;A+=c?h.get(S,k,T,_)*f.get(S,D,F,w):h.get(S,_,k,T)*f.get(S,w,D,F)}l.set(A,v,b,_,w)}return l.toTensor()},n.prototype.conv3dDerFilter=function(e,t,a){for(var i=a.strideDepth,o=a.strideHeight,s=a.strideWidth,u=a.filterDepth,c=a.filterHeight,l=a.filterWidth,d=he(a.filterShape,"float32"),p=d.values,h=d.strides,f=h[0],v=h[1],m=h[2],g=h[3],b=this.readSync(t.dataId),x=t.strides,y=x[0],_=x[1],w=x[2],A=x[3],S=this.readSync(e.dataId),D=e.strides,k=D[0],F=D[1],T=D[2],W=D[3],L=a.padInfo.front,V=a.padInfo.left,H=a.padInfo.top,U=0;U<u;++U)for(var z=Math.max(0,Math.ceil((L-U)/i)),q=Math.min(a.outDepth,(a.inDepth+L-U)/i),K=U*f,te=0;te<c;++te)for(var se=Math.max(0,Math.ceil((H-te)/o)),le=Math.min(a.outHeight,(a.inHeight+H-te)/o),ye=te*v+K,be=0;be<l;++be)for(var _e=Math.max(0,Math.ceil((V-be)/s)),Ee=Math.min(a.outWidth,(a.inWidth+V-be)/s),we=be*m+ye,De=0;De<a.inChannels;++De)for(var Qe=De*g+we,Ce=0;Ce<a.outChannels;++Ce){for(var Ne=0,Ae=0;Ae<a.batchSize;++Ae)for(var Xe=Ae*k,He=Ae*y,Ge=z;Ge<q;++Ge)for(var vn=(U+Ge*i-L)*F+Xe,gn=Ge*_+He,Lt=se;Lt<le;++Lt)for(var Qr=(te+Lt*o-H)*T+vn,Mn=Lt*w+gn,Jn=_e;Jn<Ee;++Jn){var Nn=Jn*A+Mn;Ne+=S[(be+Jn*s-V)*W+Qr+De]*b[Nn+Ce]}p[Qe+Ce]=Ne}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,a=e.filter,i=e.convInfo,o=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(t,a,i);return o&&(c=this.add(c,o)),s&&(c=_u(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(e,t,a){G([e,t],"depthwiseConv2D");for(var i=a.filterHeight,o=a.filterWidth,s=a.dilationHeight,u=a.dilationWidth,c=a.padInfo.left,l=a.padInfo.top,d=a.outChannels/a.inChannels,p=he(a.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),v=p.values,m=0;m<a.batchSize;++m)for(var g=m*e.strides[0],b=m*p.strides[0],x=0;x<a.outHeight;++x)for(var y=b+x*p.strides[1],_=x*a.strideHeight-c,w=0;w<i;++w){var A=_+w*s;if(!(A<0||A>=a.inHeight))for(var S=w*t.strides[0],D=g+A*e.strides[1],k=0;k<a.outWidth;++k)for(var F=y+k*p.strides[2],T=k*a.strideWidth-l,W=0;W<o;++W){var L=T+W*u;if(!(L<0||L>=a.inWidth))for(var V=S+W*t.strides[1],H=D+L*a.inChannels,U=F,z=V,q=0;q<a.inChannels;++q){for(var K=h[H+q],te=0;te<d;++te)v[U+te]+=K*f[z+te];U+=d,z+=d}}}return p.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,a){G([e,t],"depthwiseConv2DDerInput");for(var i=he(a.inShape,"float32"),o=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),p=e.strides,h=p[0],f=p[1],v=p[2],m=this.readSync(t.dataId),g=t.strides,b=g[0],x=g[1],y=g[2],_=a.batchSize,w=a.filterHeight,A=a.filterWidth,S=a.inChannels,D=a.inHeight,k=a.inWidth,F=a.outChannels,T=a.outHeight,W=a.outWidth,L=a.strideHeight,V=a.strideWidth,H=w-1-a.padInfo.top,U=A-1-a.padInfo.left,z=F/S,q=0;q<_;++q)for(var K=0;K<S;++K)for(var te=0;te<D;++te)for(var se=te-H,le=Math.max(0,Math.ceil(se/L)),ye=Math.min(T,(w+se)/L),be=0;be<k;++be){for(var _e=be-U,Ee=Math.max(0,Math.ceil(_e/V)),we=Math.min(W,(A+_e)/V),De=0,Qe=le;Qe<ye;++Qe)for(var Ce=Qe*L-se,Ne=Ee;Ne<we;++Ne)for(var Ae=h*q+f*Qe+v*Ne,Xe=b*(w-1-Ce)+x*(A-1-(Ne*V-_e))+y*K,He=0;He<z;++He)De+=d[Ae+(K*z+He)]*m[Xe+He];o[u*q+c*te+l*be+K]=De}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,a){G([e,t],"depthwiseConv2DDerFilter");for(var i=a.strideHeight,o=a.strideWidth,s=a.filterHeight,u=a.filterWidth,c=he(a.filterShape,"float32"),l=a.padInfo.left,d=a.padInfo.top,p=a.outChannels/a.inChannels,h=this.bufferSync(e),f=this.bufferSync(t),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((d-v)/i)),g=Math.min(a.outHeight,(a.inHeight+d-v)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((l-b)/o)),y=Math.min(a.outWidth,(a.inWidth+l-b)/o),_=0;_<a.outChannels;++_){for(var w=Math.trunc(_/p),A=_%p,S=0,D=0;D<a.batchSize;++D)for(var k=m;k<g;++k)for(var F=v+k*i-d,T=x;T<y;++T){var W=b+T*o-l;S+=h.get(D,F,W,w)*f.get(D,k,T,_)}c.set(S,v,b,w,A)}return c.toTensor()},n.prototype.tile=function(e,t){return G(e,"tile"),Yh(this.bufferSync(e),t)},n.prototype.pad=function(e,t,a){G(e,"pad");var i=t.map(function(p,h){return p[0]+e.shape[h]+p[1]}),o=t.map(function(p){return p[0]}),s=this.bufferSync(e),u=he(i,e.dtype);a!==0&&u.values.fill(a);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(p,h){return p+o[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},n.prototype.transpose=function(e,t){G(e,"transpose");for(var a=new Array(e.rank),i=0;i<a.length;i++)a[i]=e.shape[t[i]];var o=this.readSync(e.dataId),s=he(a,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[t[d]];var p=s.locToIndex(l);s.values[p]=o[i]}return s.toTensor()},n.prototype.gather=function(e,t,a){G([e,t],"gather");var i=e.shape.slice(),o=this.readSync(t.dataId);i[a]=o.length;for(var s=he(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[a]=o[l[a]];var p=u.locToIndex(d);s.values[c]=u.values[p]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,t,a){G([e],"batchToSpaceND");var i=t.reduce(function(d,p){return d*p}),o=zo(e.shape,t,i),s=Uo(o.length,t.length),u=Ho(e.shape,t,i),c=Oh(a,t.length),l=Bh(u,a,t.length);return e.reshape(o).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(e,t,a){G([e],"spaceToBatchND");var i=t.reduce(function(p,h){return p*h}),o=[[0,0]];o.push.apply(o,a);for(var s=1+t.length;s<e.shape.length;++s)o.push([0,0]);var u=e.pad(o),c=zo(u.shape,t,i,!1),l=Uo(c.length,t.length,!1),d=Ho(u.shape,t,i,!1);return u.reshape(c).transpose(l).reshape(d)},n.prototype.pool=function(e,t,a){G(e,"pool");for(var i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left,h=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=this.readSync(e.dataId),v=he(t.outShape,e.dtype),m=v.values,g=t.outShape[1]*t.outShape[2]*t.outShape[3],b=t.outShape[2]*t.outShape[3],x=t.outShape[3],y=0;y<t.batchSize;++y)for(var _=y*g,w=y*e.strides[0],A=0;A<t.inChannels;++A)for(var S=0;S<t.outHeight;++S)for(var D=S*i-d,k=Math.max(0,D),F=Math.min(t.inHeight,c+D),T=_+S*b,W=0;W<t.outWidth;++W){for(var L=W*o-p,V=Math.max(0,L),H=Math.min(t.inWidth,l+L),U=h,z=0,q=0,K=k;K<F;K+=s){for(var te=w+K*e.strides[1],se=V;se<H;se+=u){var le=f[te+se*e.strides[2]+A];a==="max"&&le>U?U=le:a==="avg"&&(z+=le,q++)}if(isNaN(U))break}m[T+W*x+A]=a==="avg"?z/q:U}return v.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var a=he(t.outShape,"int32"),i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left,h=this.bufferSync(e),f=0;f<t.batchSize;++f)for(var v=0;v<t.inChannels;++v)for(var m=0;m<t.outHeight;++m){for(var g=m*i-d,b=g;b<0;)b+=s;for(var x=Math.min(t.inHeight,c+g),y=0;y<t.outWidth;++y){for(var _=y*o-p,w=_;w<0;)w+=u;for(var A=Math.min(t.inWidth,l+_),S=Number.NEGATIVE_INFINITY,D=-1,k=b;k<x;k+=s)for(var F=k-g,T=w;T<A;T+=u){var W=T-_,L=h.get(f,k,T,v);L>S&&(S=L,D=F*l+W)}a.set(D,f,m,y,v)}}return a.toTensor()},n.prototype.maxPoolBackprop=function(e,t,a,i){G([t,a],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,h=p-1-i.padInfo.left,f=d-1-i.padInfo.top,v=he(t.shape,"float32"),m=this.bufferSync(o),g=this.bufferSync(e),b=0;b<i.batchSize;++b)for(var x=0;x<i.inChannels;++x)for(var y=0;y<i.inHeight;++y)for(var _=0;_<i.inWidth;++_){for(var w=y-f,A=_-h,S=0,D=0;D<d;D+=c){var k=(w+D)/s;if(!(k<0||k>=i.outHeight||Math.floor(k)!==k))for(var F=0;F<p;F+=l){var T=(A+F)/u;if(!(T<0||T>=i.outWidth||Math.floor(T)!==T)){var W=d*p-1-m.get(b,k,T,x)===D*p+F?1:0;W!==0&&(S+=g.get(b,k,T,x)*W)}}}v.set(S,b,y,_,x)}return v.toTensor()},n.prototype.avgPoolBackprop=function(e,t,a){G([e,t],"avgPoolBackprop");for(var i=a.strideHeight,o=a.strideWidth,s=a.filterHeight,u=a.filterWidth,c=a.dilationHeight,l=a.dilationWidth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,h=p-1-a.padInfo.left,f=d-1-a.padInfo.top,v=he(t.shape,"float32"),m=1/(s*u),g=this.bufferSync(e),b=0;b<a.batchSize;++b)for(var x=0;x<a.inChannels;++x)for(var y=0;y<a.inHeight;++y)for(var _=0;_<a.inWidth;++_){for(var w=y-f,A=_-h,S=0,D=0;D<d;D+=c){var k=(w+D)/i;if(!(k<0||k>=a.outHeight||Math.floor(k)!==k))for(var F=0;F<p;F+=l){var T=(A+F)/o;T<0||T>=a.outWidth||Math.floor(T)!==T||(S+=g.get(b,k,T,x))}}v.set(S*m,b,y,_,x)}return v.toTensor()},n.prototype.pool3d=function(e,t,a){G(e,"pool3d");for(var i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,v=t.padInfo.top,m=t.padInfo.left,g=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(e.dataId),x=he(t.outShape,e.dtype),y=x.values,_=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[2]*t.outShape[3]*t.outShape[4],A=t.outShape[3]*t.outShape[4],S=t.outShape[4],D=0;D<t.batchSize;++D)for(var k=D*_,F=D*e.strides[0],T=0;T<t.inChannels;++T)for(var W=0;W<t.outDepth;++W){for(var L=W*i-f,V=L;V<0;)V+=u;for(var H=Math.min(t.inDepth,d+L),U=k+W*w,z=0;z<t.outHeight;++z){for(var q=z*o-v,K=q;K<0;)K+=c;for(var te=Math.min(t.inHeight,p+q),se=U+z*A,le=0;le<t.outWidth;++le){for(var ye=le*s-m,be=ye;be<0;)be+=l;for(var _e=Math.min(t.inWidth,h+ye),Ee=se+le*S,we=g,De=0,Qe=0,Ce=V;Ce<H;Ce+=u){for(var Ne=F+Ce*e.strides[1],Ae=K;Ae<te;Ae+=c){for(var Xe=Ne+Ae*e.strides[2],He=be;He<_e;He+=l){var Ge=b[Xe+He*e.strides[3]+T];if(a==="max"&&Ge>we?we=Ge:a==="avg"&&(De+=Ge,Qe++),isNaN(we))break}if(isNaN(we))break}if(isNaN(we))break}y[Ee+T]=a==="avg"?De/Qe:we}}}return x.toTensor()},n.prototype.avgPool3d=function(e,t){return G(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(e,t,a){G([e,t],"avgPool3dBackprop");for(var i=a.strideDepth,o=a.strideHeight,s=a.strideWidth,u=a.filterDepth,c=a.filterHeight,l=a.filterWidth,d=a.dilationDepth,p=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterDepth,v=a.effectiveFilterHeight,m=a.effectiveFilterWidth,g=f-1-a.padInfo.front,b=m-1-a.padInfo.left,x=v-1-a.padInfo.top,y=he(t.shape,"float32"),_=1/(u*c*l),w=this.bufferSync(e),A=0;A<a.batchSize;++A)for(var S=0;S<a.inChannels;++S)for(var D=0;D<a.inDepth;++D)for(var k=0;k<a.inHeight;++k)for(var F=0;F<a.inWidth;++F){for(var T=D-g,W=k-x,L=F-b,V=0,H=0;H<f;H+=d){var U=(T+H)/i;if(!(U<0||U>=a.outDepth||Math.floor(U)!==U))for(var z=0;z<v;z+=p){var q=(W+z)/o;if(!(q<0||q>=a.outHeight||Math.floor(q)!==q))for(var K=0;K<m;K+=h){var te=(L+K)/s;te<0||te>=a.outWidth||Math.floor(te)!==te||(V+=w.get(A,U,q,te,S))}}}y.set(V*_,A,D,k,F,S)}return y.toTensor()},n.prototype.maxPool3d=function(e,t){return G(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},n.prototype.maxPool3dPositions=function(e,t){for(var a=he(t.outShape,"int32"),i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,v=t.padInfo.top,m=t.padInfo.left,g=this.bufferSync(e),b=0;b<t.batchSize;++b)for(var x=0;x<t.inChannels;++x)for(var y=0;y<t.outDepth;++y){for(var _=y*i-f,w=_;w<0;)w+=u;for(var A=Math.min(t.inDepth,d+_),S=0;S<t.outHeight;++S){for(var D=S*o-v,k=D;k<0;)k+=c;for(var F=Math.min(t.inHeight,p+D),T=0;T<t.outWidth;++T){for(var W=T*s-m,L=W;L<0;)L+=l;for(var V=Math.min(t.inWidth,h+W),H=Number.NEGATIVE_INFINITY,U=-1,z=w;z<A;z+=u)for(var q=z-_,K=k;K<F;K+=c)for(var te=K-D,se=L;se<V;se+=l){var le=se-W,ye=g.get(b,z,K,se,x);ye>=H&&(H=ye,U=q*p*h+te*p+le)}a.set(U,b,y,S,T,x)}}}return a.toTensor()},n.prototype.maxPool3dBackprop=function(e,t,a,i){G([t,a],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,p=i.dilationWidth,h=i.effectiveFilterDepth,f=i.effectiveFilterHeight,v=i.effectiveFilterWidth,m=h-1-i.padInfo.front,g=v-1-i.padInfo.left,b=f-1-i.padInfo.top,x=he(t.shape,"float32"),y=this.bufferSync(o),_=this.bufferSync(e),w=0;w<i.batchSize;++w)for(var A=0;A<i.inChannels;++A)for(var S=0;S<i.inDepth;++S)for(var D=0;D<i.inHeight;++D)for(var k=0;k<i.inWidth;++k){for(var F=S-m,T=D-b,W=k-g,L=0,V=0;V<h;V+=l){var H=(F+V)/s;if(!(H<0||H>=i.outDepth||Math.floor(H)!==H))for(var U=0;U<f;U+=d){var z=(T+U)/u;if(!(z<0||z>=i.outHeight||Math.floor(z)!==z))for(var q=0;q<v;q+=p){var K=(W+q)/c;if(!(K<0||K>=i.outWidth||Math.floor(K)!==K)){var te=h*f*v-1-y.get(w,H,z,K,A)===V*f*v+U*v+q?1:0;te!==0&&(L+=_.get(w,H,z,K,A)*te)}}}}x.set(L,w,S,D,k,A)}return x.toTensor()},n.prototype.cast=function(e,t){return hc(e,t,this)},n.prototype.reshape=function(e,t){return jo(e,t)},n.prototype.avgPool=function(e,t){return G(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,a,i){G(e,"resizeBilinear");for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],d=this.readSync(e.dataId),p=new Float32Array(ie([s,t,a,l])),h=[i&&t>1?u-1:u,i&&a>1?c-1:c],f=[i&&t>1?t-1:t,i&&a>1?a-1:a],v=0,m=h[0]/f[0],g=h[1]/f[1],b=0;b<s;b++)for(var x=0;x<t;x++)for(var y=m*x,_=Math.floor(y),w=y-_,A=Math.min(u-1,Math.ceil(y)),S=b*e.strides[0]+_*e.strides[1],D=b*e.strides[0]+A*e.strides[1],k=0;k<a;k++)for(var F=g*k,T=Math.floor(F),W=F-T,L=Math.min(c-1,Math.ceil(F)),V=S+T*e.strides[2],H=D+T*e.strides[2],U=S+L*e.strides[2],z=D+L*e.strides[2],q=0;q<l;q++){var K=d[V+q],te=d[H+q],se=K+(d[U+q]-K)*W,le=se+(te+(d[z+q]-te)*W-se)*w;p[v++]=le}return dt(p,[s,t,a,l])},n.prototype.resizeBilinearBackprop=function(e,t,a){G([e,t],"resizeBilinearBackprop");for(var i=t.shape,o=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],p=l[2],h=new Float32Array(o*s*u*c),f=[a&&d>1?s-1:s,a&&p>1?u-1:u],v=[a&&d>1?d-1:d,a&&p>1?p-1:p],m=f[0]/v[0],g=f[1]/v[1],b=this.readSync(e.dataId),x=0,y=0;y<o;y++)for(var _=y*t.strides[0],w=0;w<d;w++)for(var A=w*m,S=Math.floor(A),D=Math.min(Math.ceil(A),s-1),k=_+S*t.strides[1],F=_+D*t.strides[1],T=A-S,W=1-T,L=0;L<p;L++)for(var V=L*g,H=Math.floor(V),U=Math.min(Math.ceil(V),u-1),z=V-H,q=1-z,K=k+H*t.strides[2],te=k+U*t.strides[2],se=F+H*t.strides[2],le=F+U*t.strides[2],ye=W*q,be=W*z,_e=T*q,Ee=T*z,we=0;we<c;we++){var De=b[x++];h[K+we]+=De*ye,h[te+we]+=De*be,h[se+we]+=De*_e,h[le+we]+=De*Ee}return st(h,[o,u,s,c],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,a,i){G(e,"resizeNearestNeighbor");for(var o=e.shape,s=o[0],u=o[1],c=o[2],l=o[3],d=this.readSync(e.dataId),p=new Float32Array(s*t*a*l),h=[i&&t>1?u-1:u,i&&a>1?c-1:c],f=[i&&t>1?t-1:t,i&&a>1?a-1:a],v=h[0]/f[0],m=h[1]/f[1],g=0,b=0;b<s;b++)for(var x=b*e.strides[0],y=0;y<t;y++)for(var _=v*y,w=x+Math.min(u-1,i?Math.round(_):Math.floor(_))*e.strides[1],A=0;A<a;A++)for(var S=m*A,D=w+Math.min(c-1,i?Math.round(S):Math.floor(S))*e.strides[2],k=0;k<l;k++){var F=d[D+k];p[g++]=F}return dt(p,[s,t,a,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,a){G([e,t],"resizeNearestNeighborBackprop");for(var i=t.shape,o=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],p=l[2],h=new Float32Array(o*s*u*c),f=this.readSync(e.dataId),v=[a&&d>1?s-1:s,a&&p>1?u-1:u],m=[a&&d>1?d-1:d,a&&p>1?p-1:p],g=v[0]/m[0],b=v[1]/m[1],x=1/g,y=1/b,_=2*Math.ceil(x)+2,w=2*Math.ceil(y)+2,A=0;A<o;A++)for(var S=A*t.strides[0],D=0;D<s;D++)for(var k=S+D*t.strides[1],F=Math.floor(D*x),T=Math.floor(F-_/2),W=0;W<u;W++)for(var L=k+W*t.strides[2],V=Math.floor(W*y),H=Math.floor(V-w/2),U=0;U<c;U++){for(var z=0,q=0;q<_;q++){var K=q+T;if(!(K<0||K>=d)){var te=S+K*e.strides[1],se=K*g;if(D===Math.min(s-1,a?Math.round(se):Math.floor(se)))for(var le=0;le<w;le++){var ye=le+H;if(!(ye<0||ye>=p)){var be=te+ye*e.strides[2],_e=ye*b;W===Math.min(u-1,a?Math.round(_e):Math.floor(_e))&&(z+=f[be+U])}}}}h[L+U]=z}return st(h,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,a,i,o,s){G([e,t,a,o,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(a.dataId),d=o?this.readSync(o.dataId):new Float32Array([1]),p=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),f=p.length,v=d.length,m=l.length,g=c.length,b=0,x=0,y=0,_=0,w=0;w<u.length;++w)h[w]=p[b++]+(u[w]-c[x++])*d[y++]/Math.sqrt(l[_++]+i),b>=f&&(b=0),x>=g&&(x=0),y>=v&&(y=0),_>=m&&(_=0);return st(h,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,a,i,o){G(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function p(m){for(var g=m%s,b=m-g+Math.max(0,g-t),x=m-g+Math.min(g+t,u),y=0;b<=x;b++){var _=c[b];y+=_*_}return y}for(var h=0;h<l;h++){var f=p(h),v=c[h]*Math.pow(a+i*f,-o);d[h]=v}return st(d,e.shape)},n.prototype.LRNGrad=function(e,t,a,i,o,s,u){G(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(t.dataId),p=this.readSync(a.dataId),h=new Float32Array(e.size),f=e.size,v=0;v<f;v++){for(var m=v%c,g=v-m+Math.max(0,m-i),b=v-m+Math.min(c,m+i+1),x=0,y=g;y<b;y++)x+=Math.pow(d[y],2);for(x=s*x+o,y=g;y<b;y++){var _=-2*s*u*d[y]*p[v]/x;v===y&&(_+=Math.pow(x,-u)),_*=l[v],h[y]+=_}}return st(h,e.shape)},n.prototype.multinomial=function(e,t,a,i){G(e,"multinomial");for(var o=t?e:Ft(e),s=o.shape[0],u=o.shape[1],c=Le([s,a],"int32"),l=this.readSync(c.dataId),d=this.readSync(o.dataId),p=0;p<s;++p){var h=p*u,f=new Float32Array(u-1);f[0]=d[h];for(var v=1;v<f.length;++v)f[v]=f[v-1]+d[h+v];for(var m=Jo(i.toString()),g=p*a,b=0;b<a;++b){var x=m();l[g+b]=f.length;for(var y=0;y<f.length;y++)if(x<f[y]){l[g+b]=y;break}}}return c},n.prototype.oneHot=function(e,t,a,i){G(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<t&&(o[u*t+s[u]]=a);return Sn(o,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,a,i,o){return G(e,"nonMaxSuppression"),mc(this.readSync(e.dataId),this.readSync(t.dataId),a,i,o)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var a=e.shape[0],i=e.shape[1],o=he(e.shape,"float32"),s=he(e.shape,"float32"),u=$t(e).as2D(a,i),c=kn(e).as2D(a,i),l=0;l<a;l++)for(var d=u.slice([l,0],[1,i]),p=c.slice([l,0],[1,i]),h=gt(d,p),f=this.readSync(this.fftImpl(h,t).dataId),v=0;v<i;v++){var m=ip(f,v);o.values[l*i+v]=m.real,s.values[l*i+v]=m.imag}return gt(o.toTensor(),s.toTensor()).as2D(a,i)},n.prototype.fftImpl=function(e,t){var a=e.as1D(),i=a.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(a,i,t).as2D(e.shape[0],e.shape[1]);return t&&(o=gt($t(o).div(J(i)),kn(o).div(J(i)))),o}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),p=0;p<c.length;p+=2)l[p/2]=c[p],d[p/2]=c[p+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,t));return gt(u.real,u.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return(e&e-1)==0},n.prototype.fftRadix2=function(e,t,a){if(t===1)return e;var i=this.readSync(e.dataId),o=t/2,s=function(g){for(var b=Math.ceil(g.length/4),x=new Float32Array(b),y=new Float32Array(b),_=0;_<g.length;_+=4)x[Math.floor(_/4)]=g[_],y[Math.floor(_/4)]=g[_+1];return{real:x,imag:y}}(i),u=gt(s.real,s.imag).as1D(),c=function(g){for(var b=Math.floor(g.length/4),x=new Float32Array(b),y=new Float32Array(b),_=2;_<g.length;_+=4)x[Math.floor(_/4)]=g[_],y[Math.floor(_/4)]=g[_+1];return{real:x,imag:y}}(i),l=gt(c.real,c.imag).as1D();u=this.fftRadix2(u,o,a),l=this.fftRadix2(l,o,a);var d=function(g,b){for(var x=new Float32Array(g/2),y=new Float32Array(g/2),_=0;_<Math.ceil(g/2);_++){var w=(b?2:-2)*Math.PI*(_/g);x[_]=Math.cos(w),y[_]=Math.sin(w)}return{real:x,imag:y}}(t,a),p=gt(d.real,d.imag).mul(l),h=u.add(p),f=u.sub(p),v=$t(h).concat($t(f)),m=kn(h).concat(kn(f));return gt(v,m).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,a){for(var i=new Float32Array(2*t),o=0;o<t;o++){for(var s=0,u=0,c=0;c<t;c++){var l=w0(o*c,t,a),d=ip(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}a&&(s/=t,u/=t),_0(i,s,u,o)}return i},n.prototype.depthToSpace=function(e,t,a){E(a==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),E(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var i=e.shape[0],o=e.shape[1],s=e.shape[2],u=e.shape[3],c=o*t,l=s*t,d=u/(t*t),p=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),f=0,v=0;v<i;++v)for(var m=0;m<c;++m)for(var g=Math.floor(m/t),b=m%t,x=0;x<l;++x)for(var y=Math.floor(x/t),_=(b*t+x%t)*d,w=0;w<d;++w){var A=w+_+u*(y+s*(g+o*v));h[f++]=p[A]}return st(h,[i,c,l,d])},n.prototype.broadcastedBinaryOp=function(e,t,a,i){var o=xe(e.shape,t.shape),s=he(o,a),u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=Wn(e.shape,o),d=Wn(t.shape,o),p=s.values;if(l.length+d.length===0)for(var h=0;h<p.length;++h)p[h]=i(u[h%u.length],c[h%c.length]);else{var f=this.bufferSync(e),v=this.bufferSync(t),m=function(g){var b=s.indexToLoc(g),x=b.slice(-e.rank);l.forEach(function(A){return x[A]=0});var y=f.locToIndex(x),_=b.slice(-t.rank);d.forEach(function(A){return _[A]=0});var w=v.locToIndex(_);p[g]=i(u[y],c[w])};for(h=0;h<p.length;++h)m(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,a){var i=xe(e.shape,t.shape),o=he(i,"float32"),s=he(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=Wn(e.shape,i),d=Wn(t.shape,i),p=o.values,h=s.values;if(l.length+d.length===0)for(var f=0;f<p.length;f++){var v=f%u.length,m=f%c.length,g=a(u[2*v],u[2*v+1],c[2*m],c[2*m+1]);p[f]=g.real,h[f]=g.imag}else{var b=this.bufferSync(this.data.get(e.dataId).complexTensors.real),x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(_){var w=o.indexToLoc(_),A=w.slice(-e.rank);l.forEach(function(T){return A[T]=0});var S=b.locToIndex(A),D=w.slice(-t.rank);d.forEach(function(T){return D[T]=0});var k=x.locToIndex(D),F=a(u[2*S],u[2*S+1],c[2*k],c[2*k+1]);p[_]=F.real,h[_]=F.imag};for(f=0;f<p.length;f++)y(f)}return this.complex(o.toTensor(),s.toTensor())},n.prototype.split=function(e,t,a){return qh(e,t,a)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,t,a,i,o,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],p=u[3],h=t.shape[0],f=i[0],v=i[1],m=he([h,f,v,p],"float32"),g=this.readSync(t.dataId),b=this.readSync(a.dataId),x=this.readSync(e.dataId),y=e.strides,_=m.strides,w=0;w<h;w++){var A=4*w,S=g[A],D=g[A+1],k=g[A+2],F=g[A+3],T=b[w];if(!(T>=c))for(var W=f>1?(k-S)*(l-1)/(f-1):0,L=v>1?(F-D)*(d-1)/(v-1):0,V=0;V<f;V++){var H=f>1?S*(l-1)+V*W:.5*(S+k)*(l-1);if(H<0||H>l-1)for(var U=0;U<v;U++)for(var z=0;z<p;z++){var q=z+U*_[2]+V*_[1]+w*_[0];m.values[q]=s}else if(o==="bilinear"){var K=Math.floor(H),te=Math.ceil(H),se=H-K;for(U=0;U<v;U++)if((Ce=v>1?D*(d-1)+U*L:.5*(D+F)*(d-1))<0||Ce>d-1)for(z=0;z<p;z++)q=z+U*_[2]+V*_[1]+w*_[0],m.values[q]=s;else{var le=Math.floor(Ce),ye=Math.ceil(Ce),be=Ce-le;for(z=0;z<p;z++){var _e=x[q=z+le*y[2]+K*y[1]+T*y[0]],Ee=x[q=z+ye*y[2]+K*y[1]+T*y[0]],we=x[q=z+le*y[2]+te*y[1]+T*y[0]],De=_e+(Ee-_e)*be,Qe=we+(x[q=z+ye*y[2]+te*y[1]+T*y[0]]-we)*be;q=z+U*_[2]+V*_[1]+w*_[0],m.values[q]=De+(Qe-De)*se}}}else for(U=0;U<v;++U){var Ce;if((Ce=v>1?D*(d-1)+U*L:.5*(D+F)*(d-1))<0||Ce>d-1)for(z=0;z<p;z++)q=z+U*_[2]+V*_[1]+w*_[0],m.values[q]=s;else{var Ne=Math.round(Ce),Ae=Math.round(H);for(z=0;z<p;z++){var Xe=z+Ne*y[2]+Ae*y[1]+T*y[0],He=z+U*_[2]+V*_[1]+w*_[0];m.values[He]=x[Xe]}}}}}return m.toTensor()},n.prototype.sparseToDense=function(e,t,a,i){var o=gi(0,e,a),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,d=o.outputSize;return this.scatter(e,t,a,d,c,u,s,l,i,!1)},n.prototype.gatherND=function(e,t){var a=t.shape,i=a[a.length-1],o=uc(e,t),s=o[0],u=o[1],c=o[2],l=o[3];if(u===0)return dt([],s,e.dtype);for(var d=new hi([u,c],e.dtype),p=this.readSync(t.dataId),h=this.readSync(e.dataId),f=0;f<u;f++){for(var v=[],m=0,g=0;g<i;g++){var b=p[f*i+g];m+=b*l[g],v.push(b)}if(m<0||m>=e.size/c)throw new Error("Invalid indices: "+v+" does not index into "+e.shape);for(var x=0;x<c;x++)d.values[f*c+x]=h[m*c+x]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(e,t,a){var i=gi(0,e,a),o=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=J(0);return this.scatter(e,t,a,l,u,s,o,c,d,!0)},n.prototype.fill=function(e,t,a){var i=di(a=a||xa(t),ie(e));return i.fill(t),R.makeTensor(i,e,a,this)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=di(e.dtype,ie(e.shape));return this.makeOutput(t,e.shape,e.dtype)},n.prototype.linspace=function(e,t,a){return fc(e,t,a)},n.prototype.scatter=function(e,t,a,i,o,s,u,c,l,d){var p=[i/o,o],h=this.readSync(e.dataId),f=this.readSync(t.dataId);if(i===0)return dt([],a,t.dtype);var v=new hi(p,t.dtype);v.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var g=[],b=0,x=0;x<u;x++){var y=h[m*u+x];g.push(y),b+=y*c[x]}if(b<0||b>=i/o)throw new Error("Invalid indices: "+g+" does not index into "+a);for(var _=0;_<o;_++)d?v.values[b*o+_]+=f[m*o+_]:v.values[b*o+_]=t.rank===0?f[0]:f[m*o+_]}return v.toTensor().reshape(a)},n}(Gh);R.registerBackend("cpu",function(){return new D1},1);for(Co=0,wu=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=r.attrs,a=n,i=a.boxes,o=a.scores,s=t,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,p=e;G(i,"NonMaxSuppressionWithScore");var h=vc(p.data.get(i.dataId).values,p.data.get(o.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=n.x,a=e;G(t,"square");for(var i=a.data.get(t.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}},{kernelName:xi,backendName:"cpu",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=n,a=t.a,i=t.b,o=e;G([a,i],xi);var s=o.data.get(a.dataId).values,u=o.data.get(i.dataId).values,c=function(p,h,f,v,m,g){var b=xe(p,h),x=b.length,y=un(b),_=ya(m,ie(b)),w=p.length,A=h.length,S=un(p),D=un(h),k=Wn(p,b),F=Wn(h,b);if(k.length+F.length===0)for(var T=0;T<_.length;++T)_[T]=g(f[T%f.length],v[T%v.length]);else{var W=function(L){var V=Qp(L,x,y),H=V.slice(-w);k.forEach(function(K){return H[K]=0});var U=Nu(H,w,S),z=V.slice(-A);F.forEach(function(K){return z[K]=0});var q=Nu(z,A,D);_[L]=g(f[U],v[q])};for(T=0;T<_.length;++T)W(T)}return[_,b]}(a.shape,i.shape,s,u,a.dtype,function(p,h){var f=p-h;return f*f}),l=c[0],d=c[1];return{dataId:o.write(l,d,a.dtype),shape:d,dtype:a.dtype}}}];Co<wu.length;Co++)Vp(wu[Co]);var Co,wu,ua,k1=function(r){this.variableNames=["A"];var n=Dt(),e=r[0],t=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+t+".0, "+e+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},S1=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Dt(),e=r[0],t=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+t+".0, "+e+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(Eo=0,Cu=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=r.attrs,a=n.pixels,i=t.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=u[0],l=u[1],d=[l,c],p=[l,c,i];(s||o)&&(ua==null&&(ua=document.createElement("canvas").getContext("2d")),ua.canvas.width=c,ua.canvas.height=l,ua.drawImage(a,0,0,c,l),a=ua.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=zt.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),a);var f=B().getBool("WEBGL_PACK")?new S1(p):new k1(p),v=e.runWebGLProgram(f,[h],"int32");return e.disposeData(h.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=r.attrs;Lo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n,i=a.boxes,o=a.scores,s=t,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,p=e,h=vc(p.readSync(i.dataId),p.readSync(o.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=n.x,a=e,i=new ve(t.shape,"return x * x;");return a.runWebGLProgram(i,[t],t.dtype)}},{kernelName:xi,backendName:"webgl",kernelFunc:function(r){var n=r.inputs,e=r.backend,t=n,a=t.a,i=t.b,o=e,s=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ln("return (a - b) * (a - b);",a.shape,i.shape):new $e("return (a - b) * (a - b);",a.shape,i.shape);return o.compileAndRun(s,[a,i])}}];Eo<Cu.length;Eo++)Vp(Cu[Eo]);var Eo,Cu;for(Do=0,Eu=[{kernelName:"Square",gradFunc:function(r,n){var e=n[0];return{x:function(){return r.mul(e.toFloat().mul(2))}}}},{kernelName:xi,gradFunc:function(r,n){var e=n[0],t=n[1],a=J(2);return{a:function(){return qe(r,qe(a,Oe(e,t)))},b:function(){return qe(r,qe(a,Oe(t,e)))}}}}];Do<Eu.length;Do++)Rg(Eu[Do]);var Do,Eu,A1=function(){function r(){}return r.prototype.fetch=function(n,e){return fetch(n,e)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},r.prototype.decode=function(n,e){return new TextDecoder(e).decode(n)},r}();B().get("IS_BROWSER")&&B().setPlatform("browser",new A1);var Du,I1=function(){return Qd()},R1=function(){function r(){this.util=Jd(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(n,e){return B().global.fetch!=null?B().global.fetch(n,e):(Du==null&&(Du=I1()),Du(n,e))},r.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},r.prototype.encode=function(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(n)},r.prototype.decode=function(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)},r}();B().get("IS_NODE")&&B().setPlatform("node",new R1);var Yu={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ko=4;function em(r,n){for(var e={},t=0,a=function(s){var u=s.name,c=s.dtype,l=s.shape,d=ie(l),p=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var f=Yu[h.dtype],v=r.slice(t,t+d*f),m=h.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(c==="float32")p=Float32Array.from(m,function(w){return w*h.scale+h.min});else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);p=Int32Array.from(m,function(w){return Math.round(w*h.scale+h.min)})}t+=d*f}else if(c==="string"){var g=ie(s.shape);p=[];for(var b=0;b<g;b++){var x=new Uint32Array(r.slice(t,t+Ko))[0];t+=Ko;var y=new Uint8Array(r.slice(t,t+x));p.push(y),t+=x}}else{var _=Yu[c];if(v=r.slice(t,t+d*_),c==="float32")p=new Float32Array(v);else if(c==="int32")p=new Int32Array(v);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);p=new Uint8Array(v)}t+=d*_}e[u]=dt(p,l,c)},i=0,o=n;i<o.length;i++)a(o[i]);return e}function T1(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var n=0,e=[];r.forEach(function(i){if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var t=new Uint8Array(n),a=0;return e.forEach(function(i){t.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),t.buffer}var Ku=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Sp(r){return Ku?Buffer.byteLength(r):new Blob([r]).size}function Pc(r){var n=0;r.forEach(function(a){n+=a.byteLength});var e=new Uint8Array(n),t=0;return r.forEach(function(a){e.set(new Uint8Array(a),t),t+=a.byteLength}),e.buffer}function Ap(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var n=r.split("/");return n[n.length-1]}function Ri(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:Sp(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:Sp(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var Ht=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(n){r.getInstance().saveRouters.push(n)},r.registerLoadRouter=function(n){r.getInstance().loadRouters.push(n)},r.getSaveHandlers=function(n){return r.getHandlers(n,"save")},r.getLoadHandlers=function(n,e){return r.getHandlers(n,"load",e)},r.getHandlers=function(n,e,t){var a=[];return(e==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(i){var o=i(n,t);o!==null&&a.push(o)}),a},r}(),ma="://",mr=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(n,e){E(n!=null,function(){return"scheme must not be undefined or null."}),n.endsWith(ma)&&(n=n.slice(0,n.indexOf(ma))),E(n.length>0,function(){return"scheme must not be an empty string."});var t=r.getInstance();E(t.managers[n]==null,function(){return"A model store manager is already registered for scheme '"+n+"'."}),t.managers[n]=e},r.getManager=function(n){var e=this.getInstance().managers[n];if(e==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return e},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function Fo(r){if(r.indexOf(ma)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+mr.getSchemes().join(","));return{scheme:r.split(ma)[0],path:r.split(ma)[1]}}function Ip(r,n,e){return e===void 0&&(e=!1),re(this,void 0,void 0,function(){var t,a,i,o,s,u,c,l,d;return ae(this,function(p){switch(p.label){case 0:return E(r!==n,function(){return"Old path and new path are the same: '"+r+"'"}),E((t=Ht.getLoadHandlers(r)).length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),E(t.length<2,function(){return"Copying failed because more than one ("+t.length+") load handlers for source URL "+r+"."}),a=t[0],E((i=Ht.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),E(i.length<2,function(){return"Copying failed because more than one ("+t.length+") save handlers for destination URL "+n+"."}),o=i[0],s=Fo(r).scheme,u=Fo(r).path,c=s===Fo(r).scheme,[4,a.load()];case 1:return l=p.sent(),e&&c?[4,mr.getManager(s).removeModel(u)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,o.save(l)];case 4:return d=p.sent(),!e||c?[3,6]:[4,mr.getManager(s).removeModel(u)];case 5:p.sent(),p.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Fr="models_store",fr="model_info_store";function tm(){if(!B().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,n=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function Xu(r){var n=r.result;n.createObjectStore(Fr,{keyPath:"modelPath"}),n.createObjectStore(fr,{keyPath:"modelPath"})}var va=function(){function r(n){if(this.indexedDB=tm(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return r.prototype.save=function(n){return re(this,void 0,void 0,function(){return ae(this,function(e){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},r.prototype.load=function(){return re(this,void 0,void 0,function(){return ae(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(n,e){var t=this;return new Promise(function(a,i){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Xu(o)},o.onsuccess=function(){var s=o.result;if(e==null){var u=s.transaction(Fr,"readonly"),c=u.objectStore(Fr).get(t.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+t.modelPath+"' in IndexedDB."));a(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=Ri(e),p=s.transaction(fr,"readwrite"),h=p.objectStore(fr),f=h.put({modelPath:t.modelPath,modelArtifactsInfo:d});f.onsuccess=function(){var v=(l=s.transaction(Fr,"readwrite")).objectStore(Fr).put({modelPath:t.modelPath,modelArtifacts:e,modelArtifactsInfo:d});v.onsuccess=function(){return a({modelArtifactsInfo:d})},v.onerror=function(m){var g=(h=p.objectStore(fr)).delete(t.modelPath);g.onsuccess=function(){return s.close(),i(v.error)},g.onerror=function(b){return s.close(),i(v.error)}}},f.onerror=function(v){return s.close(),i(f.error)},p.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r.URL_SCHEME="indexeddb://",r}(),Rp=function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(va.URL_SCHEME)?(n=r.slice(va.URL_SCHEME.length),new va(n)):null;var n};Ht.registerSaveRouter(Rp),Ht.registerLoadRouter(Rp);var F1=function(){function r(){this.indexedDB=tm()}return r.prototype.listModels=function(){return re(this,void 0,void 0,function(){var n=this;return ae(this,function(e){return[2,new Promise(function(t,a){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Xu(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(fr,"readonly"),u=s.objectStore(fr).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var p=d[l];c[p.modelPath]=p.modelArtifactsInfo}t(c)},u.onerror=function(c){return o.close(),a(u.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(n){return re(this,void 0,void 0,function(){var e=this;return ae(this,function(t){var a;return n=(a=n).startsWith(va.URL_SCHEME)?a.slice(va.URL_SCHEME.length):a,[2,new Promise(function(i,o){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Xu(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(fr,"readwrite"),d=l.objectStore(fr),p=d.get(n);p.onsuccess=function(){if(p.result==null)return c.close(),o(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=d.delete(n),f=function(){var v=(u=c.transaction(Fr,"readwrite")).objectStore(Fr).delete(n);v.onsuccess=function(){return i(p.result.modelArtifactsInfo)},v.onerror=function(m){return o(p.error)}};h.onsuccess=f,h.onerror=function(v){return f(),c.close(),o(p.error)}},p.onerror=function(h){return c.close(),o(p.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return o(s.error)}})]})})},r}();if(B().getBool("IS_BROWSER"))try{mr.registerManager(va.URL_SCHEME,new F1)}catch{}var Vn="/",ha="tensorflowjs_models",nm="info",M1="model_topology",N1="weight_specs",P1="weight_data",O1="model_metadata";function rm(r){return{info:[ha,r,nm].join(Vn),topology:[ha,r,M1].join(Vn),weightSpecs:[ha,r,N1].join(Vn),weightData:[ha,r,P1].join(Vn),modelMetadata:[ha,r,O1].join(Vn)}}function B1(r){var n=r.split(Vn);if(n.length<3)throw new Error("Invalid key format: "+r);return n.slice(1,n.length-1).join(Vn)}var ga=function(){function r(n){if(!B().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=rm(this.modelPath)}return r.prototype.save=function(n){return re(this,void 0,void 0,function(){var e,t,a;return ae(this,function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(n.modelTopology),t=JSON.stringify(n.weightSpecs),a=Ri(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,t),this.LS.setItem(this.keys.weightData,function(o){if(Ku)return Buffer.from(o).toString("base64");for(var s=new Uint8Array(o),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},r.prototype.load=function(){return re(this,void 0,void 0,function(){var n,e,t,a,i,o,s;return ae(this,function(u){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(t=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=t,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=a,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(i),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy,e.userDefinedMetadata=o.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(Ku){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),p=new Uint8Array(d.length),h=0;h<d.length;++h)p.set([d.charCodeAt(h)],h);return p.buffer}(s),[2,e]})})},r.URL_SCHEME="localstorage://",r}(),Tp=function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ga.URL_SCHEME)?(n=r.slice(ga.URL_SCHEME.length),new ga(n)):null;var n};Ht.registerSaveRouter(Tp),Ht.registerLoadRouter(Tp);var L1=function(){function r(){E(B().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),E(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return re(this,void 0,void 0,function(){var n,e,t,a,i,o;return ae(this,function(s){for(n={},e=ha+Vn,t=Vn+nm,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(e)&&i.endsWith(t)&&(o=B1(i),n[o]=JSON.parse(this.LS.getItem(i)));return[2,n]})})},r.prototype.removeModel=function(n){return re(this,void 0,void 0,function(){var e,t;return ae(this,function(a){var i;if(n=(i=n).startsWith(ga.URL_SCHEME)?i.slice(ga.URL_SCHEME.length):i,e=rm(n),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+n+"'");return t=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,t]})})},r}();if(B().getBool("IS_BROWSER"))try{mr.registerManager(ga.URL_SCHEME,new L1)}catch{}var V1="model",W1=".json",z1=".weights.bin";function Fp(r){return new Promise(function(n){return setTimeout(n)}).then(r)}var ku=function(){function r(n){if(!B().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(r.URL_SCHEME)&&(n=n.slice(r.URL_SCHEME.length)),n!=null&&n.length!==0||(n=V1),this.modelTopologyFileName=n+W1,this.weightDataFileName=n+z1}return r.prototype.save=function(n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s;return ae(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return t=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:t},i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,[4,Fp(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,Fp(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Ri(n)}]}})})},r.URL_SCHEME="downloads://",r}(),U1=function(){function r(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return r.prototype.load=function(){return re(this,void 0,void 0,function(){var n,e,t=this;return ae(this,function(a){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,o){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){e.length===0&&i({modelTopology:l});var d=c.weightsManifest;if(d!=null){var p;try{p=t.checkManifestAndWeightFiles(d,e)}catch(m){return void o(m)}var h=[],f=[],v=[];d.forEach(function(m){m.paths.forEach(function(g){f.push(g),v.push(null)}),h.push.apply(h,m.weights)}),d.forEach(function(m){m.paths.forEach(function(g){var b=new FileReader;b.onload=function(x){var y=x.target.result,_=f.indexOf(g);v[_]=y,v.indexOf(null)===-1&&i({modelTopology:l,weightSpecs:h,weightData:Pc(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(x){return o("Failed to weights data from file of path '"+g+"'.")},b.readAsArrayBuffer(p[g])})})}else o(new Error("weightManifest field is missing from file "+n.name))}else o(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return o("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},r.prototype.checkManifestAndWeightFiles=function(n,e){for(var t=[],a=e.map(function(u){return Ap(u.name)}),i={},o=0,s=n;o<s.length;o++)s[o].paths.forEach(function(u){var c=Ap(u);if(t.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(t.push(c),a.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[a.indexOf(c)]});if(t.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+t.length+") and the number of weight files provided ("+e.length+").");return i},r}();function Mp(r,n,e,t){(function(i){E(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(r),function(i,o){E(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),E(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),E(o>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+o})}(e=e??0,t=t??1);var a=0;return Promise.all(r.map(function(i){return i.then(function(o){var s=e+ ++a/r.length*(t-e);return n(s),o}),i}))}function am(r,n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s,u,c,l;return ae(this,function(d){switch(d.label){case 0:return n==null&&(n={}),e=n.fetchFunc==null?B().platform.fetch:n.fetchFunc,t=r.map(function(p){return e(p,n.requestInit,{isBinary:!0})}),a=0,i=.5,n.onProgress!=null?[3,2]:[4,Promise.all(t)];case 1:return o=d.sent(),[3,4];case 2:return[4,Mp(t,n.onProgress,a,i)];case 3:o=d.sent(),d.label=4;case 4:return s=o.map(function(p){return p.arrayBuffer()}),u=.5,c=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,Mp(s,n.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function Np(r){var n=this;return function(e,t,a){return t===void 0&&(t=""),re(n,void 0,void 0,function(){var i,o,s,u,c,l,d,p,h,f;return ae(this,function(v){switch(v.label){case 0:if(i=e.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],e.forEach(function(m,g){var b=0;m.weights.forEach(function(x){var y="quantization"in x?x.quantization.dtype:x.dtype,_=Yu[y]*ie(x.shape),w=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:x,groupOffset:b,sizeBytes:_})};a!=null?a.forEach(function(A,S){A===x.name&&(w(),s[S]=!0)}):w(),u.push(x.name),b+=_})}),!s.every(function(m){return m}))throw c=a.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=i.reduce(function(m,g,b){return g&&m.push(b),m},[]),d=[],l.forEach(function(m){e[m].paths.forEach(function(g){var b=t+(t.endsWith("/")?"":"/")+g;d.push(b)})}),[4,r(d)];case 1:return p=v.sent(),h={},f=0,l.forEach(function(m){for(var g=e[m].paths.length,b=0,x=0;x<g;x++)b+=p[f+x].byteLength;for(var y=new ArrayBuffer(b),_=new Uint8Array(y),w=0,A=0;A<g;A++){var S=new Uint8Array(p[f+A]);_.set(S,w),w+=S.byteLength}o[m].forEach(function(D){var k=em(y.slice(D.groupOffset,D.groupOffset+D.sizeBytes),[D.manifestEntry]);for(var F in k)h[F]=k[F]}),f+=g}),[2,h]}})})}}Ht.registerSaveRouter(function(r){return B().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ku.URL_SCHEME)?function(n){return n===void 0&&(n="model"),new ku(n)}(r.slice(ku.URL_SCHEME.length)):null});var im=function(){function r(n,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(E(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=B().platform.fetch,E(n!=null&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&E(n.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return r.prototype.save=function(n){return re(this,void 0,void 0,function(){var e,t,a,i;return ae(this,function(o){switch(o.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:t},e.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),n.weightData!=null&&e.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:Ri(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},r.prototype.load=function(){return re(this,void 0,void 0,function(){var n,e,t,a,i,o,s,u,c,l,d,p;return ae(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),t="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t);case 5:if(a=e.modelTopology,i=e.weightsManifest,o=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:p=h.sent(),l=p[0],d=p[1],h.label=7;case 7:return[2,{modelTopology:a,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:o,convertedBy:s,format:u}]}})})},r.prototype.loadWeights=function(n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s,u,c,l,d,p;return ae(this,function(h){switch(h.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,t=function(f){var v=f.lastIndexOf("/"),m=f.lastIndexOf("?"),g=f.substring(0,v),b=m>v?f.substring(m):"";return[g+"/",b]}(e),a=t[0],i=t[1],o=this.weightPathPrefix||a,s=[],u=0,c=n;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return d=[],n.forEach(function(f){f.paths.forEach(function(v){d.push(o+v+i)})}),[4,am(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=h.sent(),[2,[s,Pc(p)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r}();function $u(r){return r.match(im.URL_SCHEME_REGEX)!=null}var Pp=function(r,n){return typeof fetch>"u"?null:(Array.isArray(r)?r.every(function(e){return $u(e)}):$u(r))?Qu(r,{onProgress:n}):null};function Qu(r,n){return new im(r,n)}Ht.registerSaveRouter(Pp),Ht.registerLoadRouter(Pp);var Su=function(){function r(n){this.modelArtifacts=n}return r.prototype.load=function(){return re(this,void 0,void 0,function(){return ae(this,function(n){return[2,this.modelArtifacts]})})},r}(),H1=function(){function r(n){this.saveHandler=n}return r.prototype.save=function(n){return re(this,void 0,void 0,function(){return ae(this,function(e){return[2,this.saveHandler(n)]})})},r}(),os=Object.freeze({browserFiles:function(r){return new U1(r)},browserHTTPRequest:function(r,n){return Qu(r,n)},concatenateArrayBuffers:Pc,decodeWeights:em,encodeWeights:function(r,n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s=this;return ae(this,function(u){switch(u.label){case 0:for(e=[],t=[],a=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),i=function(c){var l=a[c],d=Array.isArray(r)?r[c].tensor:r[l];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var p={name:l,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(f){return re(s,void 0,void 0,function(){var v,m,g,b,x,y,_;return ae(this,function(w){switch(w.label){case 0:return[4,d.bytes()];case 1:for(v=w.sent(),m=v.reduce(function(A,S){return A+S.length},0)+Ko*v.length,g=new Uint8Array(m),b=0,x=0;x<v.length;x++)y=v[x],_=new Uint8Array(new Uint32Array([y.length]).buffer),g.set(_,b),b+=Ko,g.set(y,b),b+=y.length;return f(g),[2]}})})});t.push(h)}else t.push(d.data());n!=null&&(p.group=n),e.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(t)];case 1:return[2,{data:T1(u.sent()),specs:e}]}})})},fromMemory:function(r,n,e,t){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new Su(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Su({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Su({modelTopology:r,weightSpecs:n,weightData:e,trainingConfig:t}))},getLoadHandlers:function(r,n){return Ht.getLoadHandlers(r,n)},getModelArtifactsInfoForJSON:Ri,getSaveHandlers:function(r){return Ht.getSaveHandlers(r)},http:Qu,isHTTPScheme:$u,loadWeights:function(r,n,e,t){return n===void 0&&(n=""),re(this,void 0,void 0,function(){return ae(this,function(a){return[2,Np(function(i){return am(i,{requestInit:t})})(r,n,e)]})})},registerLoadRouter:function(r){return Ht.registerLoadRouter(r)},registerSaveRouter:function(r){return Ht.registerSaveRouter(r)},weightsLoaderFactory:Np,withSaveHandler:function(r){return new H1(r)},copyModel:function(r,n){return re(this,void 0,void 0,function(){return ae(this,function(e){return[2,Ip(r,n,!1)]})})},listModels:function(){return re(this,void 0,void 0,function(){var r,n,e,t,a,i,o;return ae(this,function(s){switch(s.label){case 0:r=mr.getSchemes(),n={},e=0,t=r,s.label=1;case 1:return e<t.length?(a=t[e],[4,mr.getManager(a).listModels()]):[3,4];case 2:for(o in i=s.sent())n[a+ma+o]=i[o];s.label=3;case 3:return e++,[3,1];case 4:return[2,n]}})})},moveModel:function(r,n){return re(this,void 0,void 0,function(){return ae(this,function(e){return[2,Ip(r,n,!0)]})})},removeModel:function(r){return re(this,void 0,void 0,function(){var n;return ae(this,function(e){return n=Fo(r),[2,mr.getManager(n.scheme).removeModel(n.path)]})})}}),ca,G1=I({confusionMatrix_:function(r,n,e){var t=C(r,"labels","confusionMatrix"),a=C(n,"predictions","confusionMatrix");E(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),E(t.rank===1,function(){return"Expected the rank of labels to be 1, but got "+t.rank}),E(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),E(t.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+t.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),E(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=Hu(t.asType("int32"),e),o=Hu(a.asType("int32"),e);return i.transpose().matMul(o).asType("int32")}}),Aw=Object.freeze({confusionMatrix:G1}),j1=I({fromPixels_:function(r,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,t=!1,a=!1,i=!1,o=!1;if(r.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)t=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);o=!0}if(a&&a&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Lp("FromPixels",R.backendName)!=null)return R.runKernel("FromPixels",{pixels:r},{numChannels:n});var s,u,c=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],l=c[0],d=c[1];if(o?s=r.getContext("2d").getImageData(0,0,l,d).data:t||e?s=r.data:(i||a)&&(ca==null&&(ca=document.createElement("canvas").getContext("2d")),ca.canvas.width=l,ca.canvas.height=d,ca.drawImage(r,0,0,l,d),s=ca.getImageData(0,0,l,d).data),n===4)u=new Int32Array(s);else{var p=l*d;u=new Int32Array(p*n);for(var h=0;h<p;h++)for(var f=0;f<n;++f)u[h*n+f]=s[4*h+f]}return Qo(u,[d,l,n],"int32")}}),Ea=Object.freeze({toPixels:function(r,n){return re(this,void 0,void 0,function(){var e,t,a,i,o,s,u,c,l,d,p,h,f,v,m,g,b,x,y,_,w,A,S;return ae(this,function(D){switch(D.label){case 0:if(e=C(r,"img","toPixels"),r instanceof Pe||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(t=e.shape.slice(0,2),a=t[0],i=t[1],(o=e.rank===2?1:e.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,e.data()];case 1:return s=D.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=D.sent(),d=l[0],p=l[1],h=d[0],f=p[0],u.dispose(),c.dispose(),e.dtype==="float32"){if(h<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+f+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+f+"].")}for(v=e.dtype==="float32"?255:1,m=new Uint8ClampedArray(i*a*4),g=0;g<a*i;++g)b=void 0,x=void 0,y=void 0,_=void 0,o===1?(b=s[g]*v,x=s[g]*v,y=s[g]*v,_=255):o===3?(b=s[3*g]*v,x=s[3*g+1]*v,y=s[3*g+2]*v,_=255):o===4&&(b=s[4*g]*v,x=s[4*g+1]*v,y=s[4*g+2]*v,_=s[4*g+3]*v),m[(w=4*g)+0]=Math.round(b),m[w+1]=Math.round(x),m[w+2]=Math.round(y),m[w+3]=Math.round(_);return n!=null&&(n.width=i,n.height=a,A=n.getContext("2d"),S=new ImageData(m,i,a),A.putImageData(S,0,0)),e!==r&&e.dispose(),[2,m]}})})},fromPixels:j1}),om=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(n,e){return new n(e)},r}(),sm=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(n){r.getMap().classNameMap[n.className]=[n,n.fromConfig]},r}();function yr(r){E(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),E(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),E(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),sm.register(r)}var Iw=Object.freeze({Serializable:om,SerializationMap:sm,registerClass:yr}),q1=.001,um=.1;function Au(){return R.backend.floatPrecision()===32?q1:um}function Iu(r,n,e){var t=!0;if((bt(r)||bt(n))&&(t=!1),bt(r)&&bt(n)&&(t=!0),t){var a=r.constructor.name,i=n.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: "+a+". Expected: "+i)}if(Array.isArray(r)&&Array.isArray(n)){var o=An(r),s=An(n);if(!nt(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var u=bt(r)?r:zn(r),c=bt(n)?n:zn(n);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+`.
Actual:   `+u+`.
Expected: `+c+".");for(var l=0;l<c.length;++l){var d=u[l],p=c[l];if(!e(d,p))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+p+`.
Actual:   `+u+`.
Expected: `+c+".")}}function Ru(r,n,e){return!isFinite(r)&&!isFinite(n)||!(isNaN(r)||isNaN(n)||Math.abs(r-n)>e)}var Rw=Object.freeze({TEST_EPSILON_FLOAT16:um,expectArraysClose:function(r,n,e){return e==null&&(e=Au()),Iu(r,n,function(t,a){return Ru(t,a,e)})},testEpsilon:Au,expectPromiseToFail:function(r,n){r().then(function(){return n.fail()},function(){return n()})},expectArraysEqual:function(r,n){var e=typeof n=="string"||typeof n=="number"||typeof n=="boolean"?[n]:n;return hr(r)||hr(r[0])||hr(n)||hr(n[0])?Iu(r,e,function(t,a){return t==a}):Iu(r,n,function(t,a){return Ru(t,a,0)})},expectNumbersClose:function(r,n,e){if(e==null&&(e=Au()),!Ru(r,n,e))throw new Error("Numbers differ: actual === "+r+", expected === "+n)},expectValuesInRange:function(r,n,e){for(var t=0;t<r.length;t++)if(r[t]<n||r[t]>e)throw new Error("Value out of range:"+r[t]+" low: "+n+", high: "+e)},expectArrayBuffersEqual:function(r,n){expect(new Float32Array(r)).toEqual(new Float32Array(n))}});var Tw=Object.freeze({gpgpu_util:my,webgl_util:Vg,forceHalfFloat:function(){B().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ef,setWebGLContext:nh,GPGPUContext:gf}),Ur=function(r){function n(){return r!==null&&r.apply(this,arguments)||this}return ln(n,r),n.prototype.minimize=function(e,t,a){t===void 0&&(t=!1);var i=this.computeGradients(e,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Ot(s),t?o:(o.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(e,t){return b0(e,t)},n.prototype.dispose=function(){this.iterations_!=null&&Ot(this.iterations_)},n.prototype.saveIterations=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:J(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(e){return re(this,void 0,void 0,function(){var t;return ae(this,function(a){switch(a.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=a.sent()[0],[2,e.slice(1)]}})})},n}(om);Object.defineProperty(Ur,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var cm=function(r){function n(e,t,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=e,i.rho=t,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=R.backend.epsilon()),i}return ln(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,i){var o=R.registeredVariables[a];t.accumulatedGrads[i]==null&&(t.accumulatedGrads[i]={originalName:a+"/accum_grad",variable:j(function(){return ke(o).variable(!1)})}),t.accumulatedUpdates[i]==null&&(t.accumulatedUpdates[i]={originalName:a+"/accum_var",variable:j(function(){return ke(o).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[a];if(s!=null){var u=t.accumulatedGrads[i].variable,c=t.accumulatedUpdates[i].variable;j(function(){var l=u.mul(t.rho).add(s.square().mul(1-t.rho)),d=c.add(t.epsilon).sqrt().div(u.add(t.epsilon).sqrt()).mul(s),p=c.mul(t.rho).add(d.square().mul(1-t.rho));u.assign(l),c.assign(p);var h=d.mul(-t.learningRate).add(o);o.assign(h)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Ot(this.accumulatedGrads.map(function(e){return e.variable})),Ot(this.accumulatedUpdates.map(function(e){return e.variable})))},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var e;return ae(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){var t;return ae(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},n.className="Adadelta",n}(Ur);yr(cm);var lm=function(r){function n(e,t){t===void 0&&(t=.1);var a=r.call(this)||this;return a.learningRate=e,a.initialAccumulatorValue=t,a.accumulatedGrads=[],a}return ln(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,i){var o=R.registeredVariables[a];t.accumulatedGrads[i]==null&&(t.accumulatedGrads[i]={originalName:a+"/accumulator",variable:j(function(){return Gt(o.shape,t.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[a];if(s!=null){var u=t.accumulatedGrads[i].variable;j(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(R.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&Ot(this.accumulatedGrads.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},n.className="Adagrad",n}(Ur);yr(lm);var dm=function(r){function n(e,t,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=e,o.beta1=t,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],j(function(){o.accBeta1=J(t).variable(),o.accBeta2=J(a).variable()}),i==null&&(o.epsilon=R.backend.epsilon()),o}return ln(n,r),n.prototype.applyGradients=function(e){var t=this,a=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);j(function(){var i=Oe(1,t.accBeta1),o=Oe(1,t.accBeta2);a.forEach(function(s,u){var c=R.registeredVariables[s];t.accumulatedFirstMoment[u]==null&&(t.accumulatedFirstMoment[u]={originalName:s+"/m",variable:j(function(){return ke(c).variable(!1)})}),t.accumulatedSecondMoment[u]==null&&(t.accumulatedSecondMoment[u]={originalName:s+"/v",variable:j(function(){return ke(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(l!=null){var d=t.accumulatedFirstMoment[u].variable,p=t.accumulatedSecondMoment[u].variable,h=d.mul(t.beta1).add(l.mul(1-t.beta1)),f=p.mul(t.beta2).add(l.square().mul(1-t.beta2)),v=h.div(i),m=f.div(o);d.assign(h),p.assign(f);var g=v.div(m.sqrt().add(t.epsilon)).mul(-t.learningRate).add(c);c.assign(g)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ot(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&Ot(this.accumulatedSecondMoment.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var e;return ae(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){var t,a=this;return ae(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),j(function(){a.accBeta1.assign(qo(a.beta1,a.iterations_+1)),a.accBeta2.assign(qo(a.beta2,a.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},n.className="Adam",n}(Ur);yr(dm);var pm=function(r){function n(e,t,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=e,s.beta1=t,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],j(function(){s.iteration=J(0).variable(),s.accBeta1=J(t).variable()}),i==null&&(s.epsilon=R.backend.epsilon()),s}return ln(n,r),n.prototype.applyGradients=function(e){var t=this,a=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);j(function(){var i=Oe(1,t.accBeta1),o=Qt(-t.learningRate,t.iteration.mul(t.decay).add(1));a.forEach(function(s,u){var c=R.registeredVariables[s];t.accumulatedFirstMoment[u]==null&&(t.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ke(c).variable(!1)}),t.accumulatedWeightedInfNorm[u]==null&&(t.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:ke(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(l!=null){var d=t.accumulatedFirstMoment[u].variable,p=t.accumulatedWeightedInfNorm[u].variable,h=d.mul(t.beta1).add(l.mul(1-t.beta1)),f=p.mul(t.beta2),v=l.abs(),m=f.maximum(v);d.assign(h),p.assign(m);var g=o.div(i).mul(h.div(m.add(t.epsilon))).add(c);c.assign(g)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ot(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&Ot(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},n.className="Adamax",n}(Ur);yr(pm);var Oc=function(r){function n(e){var t=r.call(this)||this;return t.learningRate=e,t.setLearningRate(e),t}return ln(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,i){var o=Array.isArray(e)?e[i].tensor:e[a];if(o!=null){var s=R.registeredVariables[a];j(function(){var u=t.c.mul(o).add(s);s.assign(u)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Wg(J(-e))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=t.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(e,t){return new e(t.learningRate)},n.className="SGD",n}(Ur);yr(Oc);var hm=function(r){function n(e,t,a){a===void 0&&(a=!1);var i=r.call(this,e)||this;return i.learningRate=e,i.momentum=t,i.useNesterov=a,i.accumulations=[],i.m=J(i.momentum),i}return ln(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,i){var o=R.registeredVariables[a];t.accumulations[i]==null&&(t.accumulations[i]={originalName:a+"/momentum",variable:j(function(){return ke(o).variable(!1)})});var s=t.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[a];u!=null&&j(function(){var c,l=t.m.mul(s).add(u);c=t.useNesterov?t.c.mul(u.add(l.mul(t.m))).add(o):t.c.mul(l).add(o),s.assign(l),o.assign(c)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Ot(this.accumulations.map(function(e){return e.variable}))},n.prototype.setMomentum=function(e){this.momentum=e},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){return ae(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){return ae(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},n.className="Momentum",n}(Oc);yr(hm);var fm=function(r){function n(e,t,a,i,o){t===void 0&&(t=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=e,s.decay=t,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=R.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return ln(n,r),n.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,i){var o=R.registeredVariables[a];t.accumulatedMeanSquares[i]==null&&(t.accumulatedMeanSquares[i]={originalName:a+"/rms",variable:j(function(){return ke(o).variable(!1)})}),t.accumulatedMoments[i]==null&&(t.accumulatedMoments[i]={originalName:a+"/momentum",variable:j(function(){return ke(o).variable(!1)})}),t.accumulatedMeanGrads[i]==null&&t.centered&&(t.accumulatedMeanGrads[i]={originalName:a+"/mg",variable:j(function(){return ke(o).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[a];if(s!=null){var u=t.accumulatedMeanSquares[i].variable,c=t.accumulatedMoments[i].variable;j(function(){var l=u.mul(t.decay).add(s.square().mul(1-t.decay));if(t.centered){var d=t.accumulatedMeanGrads[i].variable,p=d.mul(t.decay).add(s.mul(1-t.decay)),h=c.mul(t.momentum).add(s.mul(t.learningRate).div(l.sub(p.square().add(t.epsilon)).sqrt()));u.assign(l),d.assign(p),c.assign(h);var f=o.sub(h);o.assign(f)}else{var v=u.mul(t.decay).add(s.square().mul(1-t.decay));h=c.mul(t.momentum).add(s.mul(t.learningRate).div(v.add(t.epsilon).sqrt())),u.assign(v),c.assign(h),f=o.sub(h),o.assign(f)}})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Ot(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Ot(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&Ot(this.accumulatedMoments.map(function(e){return e.variable}))},n.prototype.getWeights=function(){return re(this,void 0,void 0,function(){var e;return ae(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},n.prototype.setWeights=function(e){return re(this,void 0,void 0,function(){var t;return ae(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},n.className="RMSProp",n}(Ur);yr(fm);var Ar=function(){function r(){}return r.sgd=function(n){return new Oc(n)},r.momentum=function(n,e,t){return t===void 0&&(t=!1),new hm(n,e,t)},r.rmsprop=function(n,e,t,a,i){return e===void 0&&(e=.9),t===void 0&&(t=0),a===void 0&&(a=null),i===void 0&&(i=!1),new fm(n,e,t,a,i)},r.adam=function(n,e,t,a){return n===void 0&&(n=.001),e===void 0&&(e=.9),t===void 0&&(t=.999),a===void 0&&(a=null),new dm(n,e,t,a)},r.adadelta=function(n,e,t){return n===void 0&&(n=.001),e===void 0&&(e=.95),t===void 0&&(t=null),new cm(n,e,t)},r.adamax=function(n,e,t,a,i){return n===void 0&&(n=.002),e===void 0&&(e=.9),t===void 0&&(t=.999),a===void 0&&(a=null),i===void 0&&(i=0),new pm(n,e,t,a,i)},r.adagrad=function(n,e){return e===void 0&&(e=.1),new lm(n,e)},r}(),Fw={sgd:Ar.sgd,momentum:Ar.momentum,adadelta:Ar.adadelta,adagrad:Ar.adagrad,rmsprop:Ar.rmsprop,adamax:Ar.adamax,adam:Ar.adam};Pe.prototype.squaredDifference=function(r){return Df(this,r)},O=E1;function br(r,n,e){if(e===void 0&&(e=!1),r.beginPath(),n.slice(1).forEach(function(i,o){var s=i.x,u=i.y,c=n[o];r.moveTo(c.x,c.y),r.lineTo(s,u)}),e){var t=n[n.length-1],a=n[0];if(!t||!a)return;r.moveTo(t.x,t.y),r.lineTo(a.x,a.y)}r.stroke()}var Bc=function(r,n){return Bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},Bc(r,n)};function Z(r,n){Bc(r,n);function e(){this.constructor=r}r.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}var it=function(){return it=Object.assign||function(n){for(var e,t=1,a=arguments.length;t<a;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},it.apply(this,arguments)};function $(r,n,e,t){function a(i){return i instanceof e?i:new e(function(o){o(i)})}return new(e||(e=Promise))(function(i,o){function s(l){try{c(t.next(l))}catch(d){o(d)}}function u(l){try{c(t.throw(l))}catch(d){o(d)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((t=t.apply(r,n||[])).next())})}function Q(r,n){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},t,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,a=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(c[0]===6&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=n.call(r,e)}catch(l){c=[6,l],a=0}finally{t=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Hr(){for(var r=0,n=0,e=arguments.length;n<e;n++)r+=arguments[n].length;for(var t=Array(r),a=0,n=0;n<e;n++)for(var i=arguments[n],o=0,s=i.length;o<s;o++,a++)t[a]=i[o];return t}var fn=function(){function r(n,e){if(!Rn(n)||!Rn(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:e}));this._width=n,this._height=e}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r}();function Ti(r,n){return r instanceof Pe&&r.shape.length===n}function mm(r){return Ti(r,2)}function xr(r){return Ti(r,3)}function Zt(r){return Ti(r,4)}function vm(r){return r%1!==0}function Lc(r){return r%2===0}function ss(r,n){n===void 0&&(n=2);var e=Math.pow(10,n);return Math.floor(r*e)/e}function Vc(r){return r&&r.width&&r.height}function gm(r,n){var e=r.width,t=r.height,a=n/Math.max(t,e);return new fn(Math.round(e*a),Math.round(t*a))}function Da(r){return r.reduce(function(n,e){return n.add(e)},new ge(0,0)).div(new ge(r.length,r.length))}function qn(r,n,e){return Array(r).fill(0).map(function(t,a){return n+a*e})}function Rn(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function us(r){return Rn(r)&&0<=r&&r<=1}var ge=function(){function r(n,e){this._x=n,this._y=e}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(n){return new r(this.x+n.x,this.y+n.y)},r.prototype.sub=function(n){return new r(this.x-n.x,this.y-n.y)},r.prototype.mul=function(n){return new r(this.x*n.x,this.y*n.y)},r.prototype.div=function(n){return new r(this.x/n.x,this.y/n.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r}();var _t=function(){function r(n,e){e===void 0&&(e=!0);var t=n||{},a=[t.left,t.top,t.right,t.bottom].every(Rn),i=[t.x,t.y,t.width,t.height].every(Rn);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(t));var o=i?[t.x,t.y,t.width,t.height]:[t.left,t.top,t.right-t.left,t.bottom-t.top],s=o[0],u=o[1],c=o[2],l=o[3];r.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return r.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(Rn)},r.assertIsValidBox=function(n,e,t){if(t===void 0&&(t=!1),!r.isRect(n))throw new Error(e+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!t&&(n.width<0||n.height<0))throw new Error(e+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new ge(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new ge(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new ge(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new ge(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),e=n[0],t=n[1],a=n[2],i=n[3];return new r({x:e,y:t,width:a,height:i})},r.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),e=n[0],t=n[1],a=n[2],i=n[3];return new r({x:e,y:t,width:a,height:i})},r.prototype.toSquare=function(){var n=this,e=n.x,t=n.y,a=n.width,i=n.height,o=Math.abs(a-i);return a<i&&(e-=o/2,a+=o),i<a&&(t-=o/2,i+=o),new r({x:e,y:t,width:a,height:i})},r.prototype.rescale=function(n){var e=Vc(n)?n.width:n,t=Vc(n)?n.height:n;return new r({x:this.x*e,y:this.y*t,width:this.width*e,height:this.height*t})},r.prototype.pad=function(n,e){var t=[this.x-n/2,this.y-e/2,this.width+n,this.height+e],a=t[0],i=t[1],o=t[2],s=t[3];return new r({x:a,y:i,width:o,height:s})},r.prototype.clipAtImageBorders=function(n,e){var t=this,a=t.x,i=t.y,o=t.right,s=t.bottom,u=Math.max(a,0),c=Math.max(i,0),l=o-u,d=s-c,p=Math.min(l,n-u),h=Math.min(d,e-c);return new r({x:u,y:c,width:p,height:h}).floor()},r.prototype.shift=function(n,e){var t=this,a=t.width,i=t.height,o=this.x+n,s=this.y+e;return new r({x:o,y:s,width:a,height:i})},r.prototype.padAtBorders=function(n,e){var t=this.width+1,a=this.height+1,i=1,o=1,s=t,u=a,c=this.left,l=this.top,d=this.right,p=this.bottom;return d>e&&(s=-d+e+t,d=e),p>n&&(u=-p+n+a,p=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:o,edy:u,dx:i,edx:s,y:l,ey:p,x:c,ex:d,w:t,h:a}},r.prototype.calibrate=function(n){return new r({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},r}();var Gr=function(r){Z(n,r);function n(e,t,a,i,o){return o===void 0&&(o=!1),r.call(this,{left:e,top:t,right:a,bottom:i},o)||this}return n}(_t);var cs=function(){function r(n,e,t,a,i){this._imageDims=new fn(i.width,i.height),this._score=n,this._classScore=e,this._className=t,this._box=new _t(a).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new _t(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,e){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:e})},r}();var et=function(r){Z(n,r);function n(e,t,a){return r.call(this,e,e,"",t,a)||this}return n.prototype.forSize=function(e,t){var a=r.prototype.forSize.call(this,e,t),i=a.score,o=a.relativeBox,s=a.imageDims;return new n(i,o,s)},n}(cs);function ym(r,n,e){e===void 0&&(e=!0);var t=Math.max(0,Math.min(r.right,n.right)-Math.max(r.left,n.left)),a=Math.max(0,Math.min(r.bottom,n.bottom)-Math.max(r.top,n.top)),i=t*a;return e?i/(r.area+n.area-i):i/Math.min(r.area,n.area)}function bm(r){var n=r.map(function(s){return s.x}),e=r.map(function(s){return s.y}),t=n.reduce(function(s,u){return u<s?u:s},1/0),a=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),o=e.reduce(function(s,u){return s<u?u:s},0);return new Gr(t,a,i,o)}function Yn(r,n,e,t){t===void 0&&(t=!0);for(var a=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],o=function(){var s=a.pop();i.push(s);for(var u=a,c=[],l=0;l<u.length;l++){var d=u[l],p=r[s],h=r[d];c.push(ym(p,h,t))}a=a.filter(function(f,v){return c[v]<=e})};a.length>0;)o();return i}function Tn(r,n){return j(function(){var e=n[0],t=n[1],a=n[2],i=Gt(Hr(r.shape.slice(0,3),[1]),e),o=Gt(Hr(r.shape.slice(0,3),[1]),t),s=Gt(Hr(r.shape.slice(0,3),[1]),a),u=We([i,o,s],3);return Oe(r,u)})}function xm(r,n){return n===void 0&&(n=!1),j(function(){var e=r.shape.slice(1),t=e[0],a=e[1];if(t===a)return r;var i=Math.abs(t-a),o=Math.round(i*(n?.5:1)),s=t>a?2:1,u=function(h){var f=r.shape.slice();return f[s]=h,Gt(f,0)},c=u(o),l=i-c.shape[s],d=n&&l?u(l):null,p=[d,r,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return We(p,s)})}function ls(r){return 1/(1+Math.exp(-r))}var ka=function(r){Z(n,r);function n(e,t,a,i,o){return o===void 0&&(o=!1),r.call(this,{x:e,y:t,width:a,height:i},o)||this}return n}(_t);var K1=.5,X1=.43,$1=.45,Kn=function(){function r(n,e,t){t===void 0&&(t=new ge(0,0));var a=e.width,i=e.height;this._imgDims=new fn(a,i),this._shift=t,this._positions=n.map(function(o){return o.mul(new ge(a,i)).add(t)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new ge(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(e){return e.sub(n._shift).div(new ge(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,e){return new this.constructor(this.relativePositions,{width:n,height:e})},r.prototype.shiftBy=function(n,e){return new this.constructor(this.relativePositions,this._imgDims,new ge(n,e))},r.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},r.prototype.align=function(n,e){if(e===void 0&&(e={}),n){var t=n instanceof et?n.box.floor():new _t(n);return this.shiftBy(t.x,t.y).align(null,e)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=a.useDlibAlignment,o=a.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)},r.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),e=n[0],t=n[1],a=n[2],i=function(d){return a.sub(d).magnitude()},o=(i(e)+i(t))/2,s=Math.floor(o/$1),u=Da(n),c=Math.floor(Math.max(0,u.x-K1*s)),l=Math.floor(Math.max(0,u.y-X1*s));return new ka(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},r.prototype.alignMinBbox=function(n){var e=bm(this.positions);return e.pad(e.width*n,e.height*n)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r}();var _m=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Da([e[3],e[4]])]},n}(Kn);var ds=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Da)},n}(Kn);var Wc=function(){function r(n,e){this._label=n,this._distance=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+ss(this.distance)+")":"")},r}();var zc=function(r){Z(n,r);function n(e,t){var a=r.call(this,e)||this;return a._label=t,a}return n.assertIsValidLabeledBox=function(e,t){if(_t.assertIsValidBox(e,t),!Rn(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(_t);var Fi=function(){function r(n,e){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},r.fromJSON=function(n){var e=n.descriptors.map(function(t){return new Float32Array(t)});return new r(n.label,e)},r}();var H2=function(r){Z(n,r);function n(e,t,a,i){var o=r.call(this,e,t)||this;return o._score=a,o._classScore=i,o}return n.assertIsValidPredictedBox=function(e,t){if(zc.assertIsValidLabeledBox(e,t),!us(e.score)||!us(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n}(zc);function Mi(r){return r.detection instanceof et}function Sa(r,n){var e={detection:n};return Object.assign({},r,e)}function Uc(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:n}}function ps(r){var n="";if(!r)try{r=Vs("fs")}catch(t){n=t.toString()}var e=r?function(t){return new Promise(function(a,i){r.readFile(t,function(o,s){return o?i(o):a(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:e}}function Hc(){var r=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,e=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},t=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=ps();return it({Canvas:r||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:n||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:e,createImageElement:t,fetch:a},i)}function Gc(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function jc(){return typeof global=="object"&&typeof Vs=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var ut;function Q1(){if(!ut)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ut}function qc(r){ut=r}function Yc(){Gc()&&qc(Uc()),jc()&&qc(Hc())}function J1(r){if(ut||Yc(),!ut)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=r.Canvas,e=n===void 0?ut.Canvas:n,t=r.Image,a=t===void 0?ut.Image:t;ut.Canvas=e,ut.Image=a,ut.createCanvasElement=r.createCanvasElement||function(){return new e},ut.createImageElement=r.createImageElement||function(){return new a},ut.ImageData=r.ImageData||ut.ImageData,ut.Video=r.Video||ut.Video,ut.fetch=r.fetch||ut.fetch,ut.readFile=r.readFile||ut.readFile}var Se={getEnv:Q1,setEnv:qc,initialize:Yc,createBrowserEnv:Uc,createFileSystem:ps,createNodejsEnv:Hc,monkeyPatch:J1,isBrowser:Gc,isNodejs:jc};Yc();function Aa(r){return!Se.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function wt(r){var n=Se.getEnv(),e=n.Canvas,t=n.CanvasRenderingContext2D;if(r instanceof t)return r;var a=Aa(r);if(!(a instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=a.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var _r=function(r){return r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r}(_r||{}),Kc=function(){function r(n){n===void 0&&(n={});var e=n.anchorPosition,t=n.backgroundColor,a=n.fontColor,i=n.fontSize,o=n.fontStyle,s=n.padding;this.anchorPosition=e||_r.TOP_LEFT,this.backgroundColor=t||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4}return r}();var Xc=function(){function r(n,e,t){t===void 0&&(t={}),this.text=typeof n=="string"?[n]:n instanceof r?n.text:n,this.anchor=e,this.options=new Kc(t)}return r.prototype.measureWidth=function(n){var e=this.options.padding;return this.text.map(function(t){return n.measureText(t).width}).reduce(function(t,a){return t<a?a:t},0)+2*e},r.prototype.measureHeight=function(){var n=this.options,e=n.fontSize,t=n.padding;return this.text.length*e+2*t},r.prototype.getUpperLeft=function(n,e){var t=this.options.anchorPosition,a=t===_r.BOTTOM_RIGHT||t===_r.TOP_RIGHT,i=t===_r.BOTTOM_LEFT||t===_r.BOTTOM_RIGHT,o=this.measureWidth(n),s=this.measureHeight(),u=a?this.anchor.x-o:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var l=e.width,d=e.height,p=Math.max(Math.min(u,l-o),0),h=Math.max(Math.min(c,d-s),0);return{x:p,y:h}}return{x:u,y:c}},r.prototype.draw=function(n){var e=Aa(n),t=wt(e),a=this.options,i=a.backgroundColor,o=a.fontColor,s=a.fontSize,u=a.fontStyle,c=a.padding;t.font=s+"px "+u;var l=this.measureWidth(t),d=this.measureHeight();t.fillStyle=i;var p=this.getUpperLeft(t,e);t.fillRect(p.x,p.y,l,d),t.fillStyle=o,this.text.forEach(function(h,f){var v=c+p.x,m=c+p.y+(f+1)*s;t.fillText(h,v,m)})},r}();var Z1=function(){function r(n){n===void 0&&(n={});var e=n.boxColor,t=n.lineWidth,a=n.label,i=n.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=t||2,this.label=a;var o={anchorPosition:_r.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Kc(Object.assign({},o,i))}return r}();var e_=function(){function r(n,e){e===void 0&&(e={}),this.box=new _t(n),this.options=new Z1(e)}return r.prototype.draw=function(n){var e=wt(n),t=this.options,a=t.boxColor,i=t.lineWidth,o=this.box,s=o.x,u=o.y,c=o.width,l=o.height;e.strokeStyle=a,e.lineWidth=i,e.strokeRect(s,u,c,l);var d=this.options.label;d&&new Xc([d],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(n)},r}();function hs(r){var n=Se.getEnv(),e=n.Image,t=n.Video;return r instanceof e&&r.complete||r instanceof t&&r.readyState>=3}function wm(r){return new Promise(function(n,e){if(r instanceof Se.getEnv().Canvas||hs(r))return n();function t(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",t),i.currentTarget.removeEventListener("error",a),n(i))}function a(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",t),i.currentTarget.removeEventListener("error",a),e(i))}r.addEventListener("load",t),r.addEventListener("error",a)})}function Cm(r){return new Promise(function(n,e){if(!(r instanceof Blob))return e("bufferToImage - expected buf to be of type: Blob");var t=new FileReader;t.onload=function(){if(typeof t.result!="string")return e("bufferToImage - expected reader.result to be a string, in onload");var a=Se.getEnv().createImageElement();a.onload=function(){return n(a)},a.onerror=e,a.src=t.result},t.onerror=e,t.readAsDataURL(r)})}function Ni(r){var n=Se.getEnv(),e=n.Image,t=n.Video;return r instanceof e?new fn(r.naturalWidth,r.naturalHeight):r instanceof t?new fn(r.videoWidth,r.videoHeight):new fn(r.width,r.height)}function jr(r){var n=r.width,e=r.height,t=Se.getEnv().createCanvasElement,a=t();return a.width=n,a.height=e,a}function Ia(r,n){var e=Se.getEnv().ImageData;if(!(r instanceof e)&&!hs(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var t=n||Ni(r),a=t.width,i=t.height,o=jr({width:a,height:i});return r instanceof e?wt(o).putImageData(r,0,0):wt(o).drawImage(r,0,0,a,i),o}function Em(r,n){return $(this,void 0,void 0,function(){var e,t,a,i,o,s;return Q(this,function(u){switch(u.label){case 0:return e=n||Se.getEnv().createCanvasElement(),t=r.shape.slice(Zt(r)?1:0),a=t[0],i=t[1],o=t[2],s=j(function(){return r.as3D(a,i,o).toInt()}),[4,Ea.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function $c(r){var n=Se.getEnv(),e=n.Image,t=n.Canvas,a=n.Video;return r instanceof e||r instanceof t||r instanceof a}function Dm(r,n,e){e===void 0&&(e=!1);var t=Se.getEnv(),a=t.Image,i=t.Canvas;if(!(r instanceof a||r instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=Ni(r),s=n/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=jr({width:n,height:n}),d=r instanceof i?r:Ia(r),p=Math.abs(u-c)/2,h=e&&u<c?p:0,f=e&&c<u?p:0;return wt(l).drawImage(d,h,f,u,c),l}var qr=function(){function r(n,e){var t=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=e,this._batchSize=n.length,n.forEach(function(a,i){if(xr(a)){t._imageTensors[i]=a,t._inputDimensions[i]=a.shape;return}if(Zt(a)){var o=a.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");t._imageTensors[i]=a,t._inputDimensions[i]=a.shape.slice(1);return}var s=a instanceof Se.getEnv().Canvas?a:Ia(a);t._canvases[i]=s,t._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var n=this;return qn(this.batchSize,0,1).map(function(e,t){return n.getReshapedInputDimensions(t)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},r.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},r.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},r.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},r.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(n),t=this.getInputHeight(n);return gm({width:e,height:t},this.inputSize)},r.prototype.toBatchTensor=function(n,e){var t=this;return e===void 0&&(e=!0),this._inputSize=n,j(function(){var a=qn(t.batchSize,0,1).map(function(o){var s=t.getInput(o);if(s instanceof Pe){var u=Zt(s)?s:s.expandDims();return u=xm(u,e),(u.shape[1]!==n||u.shape[2]!==n)&&(u=Ii.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof Se.getEnv().Canvas)return Ea.fromPixels(Dm(s,n,e));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=xt(a.map(function(o){return o.toFloat()})).as4D(t.batchSize,n,n,3);return i})},r}();function Me(r){return $(this,void 0,void 0,function(){var n,e,t;return Q(this,function(a){switch(a.label){case 0:if(r instanceof qr)return[2,r];if(n=Array.isArray(r)?r:[r],!n.length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(r)?" at input index "+i+":":""},t=n.map(Aa),t.forEach(function(i,o){if(!$c(i)&&!xr(i)&&!Zt(i))throw typeof n[o]=="string"?new Error("toNetInput -"+e(o)+" string passed, but could not resolve HTMLElement for element id "+n[o]):new Error("toNetInput -"+e(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Zt(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+e(o)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(t.map(function(i){return $c(i)&&wm(i)}))];case 1:return a.sent(),[2,new qr(t,Array.isArray(r))]}})})}function Pi(r,n){return $(this,void 0,void 0,function(){var e,t,a,i,o,s,u;return Q(this,function(c){switch(c.label){case 0:return e=Se.getEnv().Canvas,t=r,r instanceof e?[3,5]:[4,Me(r)];case 1:if(a=c.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=a.getInput(0),i instanceof e?(o=i,[3,4]):[3,2];case 2:return[4,Em(i)];case 3:o=c.sent(),c.label=4;case 4:t=o,c.label=5;case 5:return s=wt(t),u=n.map(function(l){return l instanceof et?l.forSize(t.width,t.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(t.width,t.height)}),[2,u.map(function(l){var d=l.x,p=l.y,h=l.width,f=l.height,v=jr({width:h,height:f});return wt(v).putImageData(s.getImageData(d,p,h,f),0,0),v})]}})})}function Oi(r,n){return $(this,void 0,void 0,function(){return Q(this,function(e){if(!xr(r)&&!Zt(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Zt(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,j(function(){var t=r.shape.slice(Zt(r)?1:0),a=t[0],i=t[1],o=t[2],s=n.map(function(c){return c instanceof et?c.forSize(i,a).box:c}).map(function(c){return c.clipAtImageBorders(i,a)}),u=s.map(function(c){var l=c.x,d=c.y,p=c.width,h=c.height;return kc(r.as3D(a,i,o),[d,l,0],[h,p,o])});return u})]})})}function Bi(r,n){return $(this,void 0,void 0,function(){var e,t;return Q(this,function(a){switch(a.label){case 0:return e=Se.getEnv().fetch,[4,e(r,n)];case 1:if(t=a.sent(),!(t.status<400))throw new Error("failed to fetch: ("+t.status+") "+t.statusText+", from url: "+t.url);return[2,t]}})})}function km(r){return $(this,void 0,void 0,function(){var n,e;return Q(this,function(t){switch(t.label){case 0:return[4,Bi(r)];case 1:return n=t.sent(),[4,n.blob()];case 2:if(e=t.sent(),!e.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+e.type+", for url: "+n.url);return[2,Cm(e)]}})})}function Sm(r){return $(this,void 0,void 0,function(){return Q(this,function(n){switch(n.label){case 0:return[4,Bi(r)];case 1:return[2,n.sent().json()]}})})}function fs(r,n){var e=n+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:e};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var t=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(t,"");var a=r.split("/").filter(function(s){return s}),i=r.endsWith(".json")?a[a.length-1]:e,o=t+(r.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return o=r.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+i:o+"/"+i}}function Am(r,n){return $(this,void 0,void 0,function(){var e,t,a,i;return Q(this,function(o){switch(o.label){case 0:return e=fs(r,n),t=e.manifestUri,a=e.modelBaseUri,[4,Sm(t)];case 1:return i=o.sent(),[2,os.loadWeights(i,a)]}})})}var ht=function(){function r(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(n){var e=this.traversePropertyPath(n),t=e.obj,a=e.objProp;return t[a]},r.prototype.reassignParamFromPath=function(n,e){var t=this.traversePropertyPath(n),a=t.obj,i=t.objProp;a[i].dispose(),a[i]=e},r.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(e){var t=e.paramPath;return{path:t,tensor:n.getParamFromPath(t)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Pr})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Pr)})},r.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(e){var t=e.path,a=e.tensor;n.reassignParamFromPath(t,a.variable())})},r.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(e){var t=e.path,a=e.tensor,i=dt(a.dataSync());a.dispose(),n.reassignParamFromPath(t,i)})},r.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(e){if(n&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var e=n.tensor;return Array.from(e.dataSync())}).reduce(function(n,e){return n.concat(e)}))},r.prototype.load=function(n){return $(this,void 0,void 0,function(){return Q(this,function(e){switch(e.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return e.sent(),[2]}})})},r.prototype.loadFromUri=function(n){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Am(n,this.getDefaultModelName())];case 1:return e=t.sent(),this.loadFromWeightMap(e),[2]}})})},r.prototype.loadFromDisk=function(n){return $(this,void 0,void 0,function(){var e,t,a,i,o,s,u,c,l,d;return Q(this,function(p){switch(p.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=Se.getEnv().readFile,t=fs(n,this.getDefaultModelName()),a=t.manifestUri,i=t.modelBaseUri,o=function(h){return Promise.all(h.map(function(f){return e(f).then(function(v){return v.buffer})}))},s=os.weightsLoaderFactory(o),l=(c=JSON).parse,[4,e(a)];case 1:return u=l.apply(c,[p.sent().toString()]),[4,s(u,i)];case 2:return d=p.sent(),this.loadFromWeightMap(d),[2]}})})},r.prototype.loadFromWeightMap=function(n){var e=this.extractParamsFromWeigthMap(n),t=e.paramMappings,a=e.params;this._paramMappings=t,this._params=a},r.prototype.extractWeights=function(n){var e=this.extractParams(n),t=e.paramMappings,a=e.params;this._paramMappings=t,this._params=a},r.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=n.split("/").reduce(function(i,o){if(!i.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+n);return{obj:i.nextObj,objProp:o,nextObj:i.nextObj[o]}},{nextObj:this.params}),t=e.obj,a=e.objProp;if(!t||!a||!(t[a]instanceof Pe))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:t,objProp:a}},r}();function Mt(r,n,e){return j(function(){var t=Si(r,n.depthwise_filter,n.pointwise_filter,e,"same");return t=de(t,n.bias),t})}function ms(r,n,e){return e===void 0&&(e=!1),j(function(){var t=Te(e?de(pt(r,n.conv0.filters,[2,2],"same"),n.conv0.bias):Mt(r,n.conv0,[2,2])),a=Mt(t,n.conv1,[1,1]),i=Te(de(t,a)),o=Mt(i,n.conv2,[1,1]);return Te(de(t,de(a,o)))})}function Li(r,n,e,t){return e===void 0&&(e=!1),t===void 0&&(t=!0),j(function(){var a=Te(e?de(pt(r,n.conv0.filters,t?[2,2]:[1,1],"same"),n.conv0.bias):Mt(r,n.conv0,t?[2,2]:[1,1])),i=Mt(a,n.conv1,[1,1]),o=Te(de(a,i)),s=Mt(o,n.conv2,[1,1]),u=Te(de(a,de(i,s))),c=Mt(u,n.conv3,[1,1]);return Te(de(a,de(i,de(s,c))))})}function St(r,n,e,t){return e===void 0&&(e="same"),t===void 0&&(t=!1),j(function(){var a=de(pt(r,n.filters,[1,1],e),n.bias);return t?Te(a):a})}function ft(r,n){Object.keys(r).forEach(function(e){n.some(function(t){return t.originalPath===e})||r[e].dispose()})}function wr(r,n){return function(e,t,a,i){var o=st(r(e*t*a*a),[a,a,e,t]),s=Be(r(t));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:o,bias:s}}}function Ra(r,n){return function(e,t,a){var i=Sn(r(e*t),[e,t]),o=Be(r(t));return n.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:i,bias:o}}}var Qc=function(){function r(n,e,t){this.depthwise_filter=n,this.pointwise_filter=e,this.bias=t}return r}();function Ta(r,n){return function(e,t,a){var i=st(r(9*e),[3,3,e,1]),o=st(r(e*t),[1,1,e,t]),s=Be(r(t));return n.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Qc(i,o,s)}}function Fa(r){return function(n){var e=r(n+"/depthwise_filter",4),t=r(n+"/pointwise_filter",4),a=r(n+"/bias",1);return new Qc(e,t,a)}}function At(r,n){return function(e,t,a){var i=r[e];if(!Ti(i,t))throw new Error("expected weightMap["+e+"] to be a Tensor"+t+"D, instead have "+i);return n.push({originalPath:e,paramPath:a||e}),i}}function mt(r){var n=r;function e(a){var i=n.slice(0,a);return n=n.slice(a),i}function t(){return n}return{extractWeights:e,getRemainingWeights:t}}function vs(r,n){var e=wr(r,n),t=Ta(r,n);function a(o,s,u,c){c===void 0&&(c=!1);var l=c?e(o,s,3,u+"/conv0"):t(o,s,u+"/conv0"),d=t(s,s,u+"/conv1"),p=t(s,s,u+"/conv2");return{conv0:l,conv1:d,conv2:p}}function i(o,s,u,c){c===void 0&&(c=!1);var l=a(o,s,u,c),d=l.conv0,p=l.conv1,h=l.conv2,f=t(s,s,u+"/conv3");return{conv0:d,conv1:p,conv2:h,conv3:f}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:i}}function Im(r){var n=[],e=mt(r),t=e.extractWeights,a=e.getRemainingWeights,i=vs(t,n).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}function gs(r){return function(n){var e=r(n+"/filters",4),t=r(n+"/bias",1);return{filters:e,bias:t}}}function ys(r,n){var e=At(r,n),t=gs(e),a=Fa(e);function i(s,u){u===void 0&&(u=!1);var c=u?t(s+"/conv0"):a(s+"/conv0"),l=a(s+"/conv1"),d=a(s+"/conv2");return{conv0:c,conv1:l,conv2:d}}function o(s,u){u===void 0&&(u=!1);var c=u?t(s+"/conv0"):a(s+"/conv0"),l=a(s+"/conv1"),d=a(s+"/conv2"),p=a(s+"/conv3");return{conv0:c,conv1:l,conv2:d,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function Rm(r){var n=[],e=ys(r,n).extractDenseBlock4Params,t={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return ft(r,n),{params:t,paramMappings:n}}var bs=function(r){Z(n,r);function n(){return r.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return j(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=Tn(a,i).div(J(255)),s=Li(o,t.dense0,!0);return s=Li(s,t.dense1),s=Li(s,t.dense2),s=Li(s,t.dense3),s=Gn(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Rm(e)},n.prototype.extractParams=function(e){return Im(e)},n}(ht);function Bt(r,n){return j(function(){return de(Ca(r,n.weights),n.bias)})}function Tm(r,n,e){var t=[],a=mt(r),i=a.extractWeights,o=a.getRemainingWeights,s=Ra(i,t),u=s(n,e,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:u}}}function Fm(r){var n=[],e=At(r,n);function t(i){var o=e(i+"/weights",2),s=e(i+"/bias",1);return{weights:o,bias:s}}var a={fc:t("fc")};return ft(r,n),{params:a,paramMappings:n}}function xs(r){var n={},e={};return Object.keys(r).forEach(function(t){var a=t.startsWith("fc")?e:n;a[t]=r[t]}),{featureExtractorMap:n,classifierMap:e}}var _s=function(r){Z(n,r);function n(e,t){var a=r.call(this,e)||this;return a._faceFeatureExtractor=t,a}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var t=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return j(function(){var i=e instanceof qr?t.faceFeatureExtractor.forwardInput(e):e;return Bt(i.as2D(i.shape[0],-1),a.fc)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.params,i=t.paramMappings;this._params=a,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return Tm(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(e){var t=xs(e),a=t.featureExtractorMap,i=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Fm(i)},n.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),i=a*t+a,o=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(s)},n}(ht);var Mm=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ws=function(){function r(n){var e=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);Mm.forEach(function(t,a){e[t]=n[a]})}return r.prototype.asSortedArray=function(){var n=this;return Mm.map(function(e){return{expression:e,probability:n[e]}}).sort(function(e,t){return t.probability-e.probability})},r}();var Nm=function(r){Z(n,r);function n(e){return e===void 0&&(e=new bs),r.call(this,"FaceExpressionNet",e)||this}return n.prototype.forwardInput=function(e){var t=this;return j(function(){return Ft(t.runNet(e))})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.predictExpressions=function(e){return $(this,void 0,void 0,function(){var t,a,i,o,s=this;return Q(this,function(u){switch(u.label){case 0:return[4,Me(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return a=u.sent(),[4,Promise.all(Fe(a).map(function(c){return $(s,void 0,void 0,function(){var l;return Q(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),a.dispose(),o=i.map(function(c){return new ws(c)}),[2,t.isBatchInput?o:o[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}(_s);function Jc(r,n){var e={expressions:n};return Object.assign({},r,e)}function Cs(r){return Mi(r)&&r.landmarks instanceof Kn&&r.unshiftedLandmarks instanceof Kn&&r.alignedRect instanceof et}function Ma(r,n){var e=r.detection.box,t=n.shiftBy(e.x,e.y),a=t.align(),i=r.detection.imageDims,o=new et(r.detection.score,a.rescale(i.reverse()),i),s={landmarks:t,unshiftedLandmarks:n,alignedRect:o};return Object.assign({},r,s)}var t_=function(){function r(n){n===void 0&&(n={});var e=n.drawLines,t=e===void 0?!0:e,a=n.drawPoints,i=a===void 0?!0:a,o=n.lineWidth,s=n.lineColor,u=n.pointSize,c=n.pointColor;this.drawLines=t,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"}return r}();var sS=function(){function r(n,e){e===void 0&&(e={}),this.faceLandmarks=n,this.options=new t_(e)}return r.prototype.draw=function(n){var e=wt(n),t=this.options,a=t.drawLines,i=t.drawPoints,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;if(a&&this.faceLandmarks instanceof ds&&(e.strokeStyle=s,e.lineWidth=o,br(e,this.faceLandmarks.getJawOutline()),br(e,this.faceLandmarks.getLeftEyeBrow()),br(e,this.faceLandmarks.getRightEyeBrow()),br(e,this.faceLandmarks.getNose()),br(e,this.faceLandmarks.getLeftEye(),!0),br(e,this.faceLandmarks.getRightEye(),!0),br(e,this.faceLandmarks.getMouth(),!0)),i){e.strokeStyle=c,e.fillStyle=c;var l=function(d){e.beginPath(),e.arc(d.x,d.y,u,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(l)}},r}();function r_(r,n){var e=wr(r,n),t=Ta(r,n);function a(o,s,u){var c=t(o,s,u+"/separable_conv0"),l=t(s,s,u+"/separable_conv1"),d=e(o,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:d}}function i(o,s){var u=t(o,o,s+"/separable_conv0"),c=t(o,o,s+"/separable_conv1"),l=t(o,o,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:e,extractSeparableConvParams:t,extractReductionBlockParams:a,extractMainBlockParams:i}}function Pm(r,n){var e=[],t=mt(r),a=t.extractWeights,i=t.getRemainingWeights,o=r_(a,e),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),p=c(32,64,"entry_flow/reduction_block_0"),h=c(64,128,"entry_flow/reduction_block_1"),f={conv_in:d,reduction_block_0:p,reduction_block_1:h},v={};qn(n,0,1).forEach(function(x){v["main_block_"+x]=l(128,"middle_flow/main_block_"+x)});var m=c(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),b={reduction_block:m,separable_conv:g};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:f,middle_flow:v,exit_flow:b}}}function a_(r,n){var e=At(r,n),t=gs(e),a=Fa(e);function i(s){var u=a(s+"/separable_conv0"),c=a(s+"/separable_conv1"),l=t(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function o(s){var u=a(s+"/separable_conv0"),c=a(s+"/separable_conv1"),l=a(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:a,extractReductionBlockParams:i,extractMainBlockParams:o}}function Om(r,n){var e=[],t=a_(r,e),a=t.extractConvParams,i=t.extractSeparableConvParams,o=t.extractReductionBlockParams,s=t.extractMainBlockParams,u=a("entry_flow/conv_in"),c=o("entry_flow/reduction_block_0"),l=o("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:c,reduction_block_1:l},p={};qn(n,0,1).forEach(function(m){p["main_block_"+m]=s("middle_flow/main_block_"+m)});var h=o("exit_flow/reduction_block"),f=i("exit_flow/separable_conv"),v={reduction_block:h,separable_conv:f};return ft(r,e),{params:{entry_flow:d,middle_flow:p,exit_flow:v},paramMappings:e}}function Bm(r,n,e){return de(pt(r,n.filters,e,"same"),n.bias)}function Zc(r,n,e){e===void 0&&(e=!0);var t=e?Te(r):r;return t=Mt(t,n.separable_conv0,[1,1]),t=Mt(Te(t),n.separable_conv1,[1,1]),t=Ke(t,[3,3],[2,2],"same"),t=de(t,Bm(r,n.expansion_conv,[2,2])),t}function i_(r,n){var e=Mt(Te(r),n.separable_conv0,[1,1]);return e=Mt(Te(e),n.separable_conv1,[1,1]),e=Mt(Te(e),n.separable_conv2,[1,1]),e=de(e,r),e}var Lm=function(r){Z(n,r);function n(e){var t=r.call(this,"TinyXception")||this;return t._numMainBlocks=e,t}return n.prototype.forwardInput=function(e){var t=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return j(function(){var i=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=Tn(i,o).div(J(256)),u=Te(Bm(s,a.entry_flow.conv_in,[2,2]));return u=Zc(u,a.entry_flow.reduction_block_0,!1),u=Zc(u,a.entry_flow.reduction_block_1),qn(t._numMainBlocks,0,1).forEach(function(c){u=i_(u,a.middle_flow["main_block_"+c])}),u=Zc(u,a.exit_flow.reduction_block),u=Te(Mt(u,a.exit_flow.separable_conv,[1,1])),u})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Om(e,this._numMainBlocks)},n.prototype.extractParams=function(e){return Pm(e,this._numMainBlocks)},n}(ht);function Vm(r){var n=[],e=mt(r),t=e.extractWeights,a=e.getRemainingWeights,i=Ra(t,n),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:{age:o,gender:s}}}}function Wm(r){var n=[],e=At(r,n);function t(i){var o=e(i+"/weights",2),s=e(i+"/bias",1);return{weights:o,bias:s}}var a={fc:{age:t("fc/age"),gender:t("fc/gender")}};return ft(r,n),{params:a,paramMappings:n}}var Vi=function(r){return r.FEMALE="female",r.MALE="male",r}(Vi||{});var zm=function(r){Z(n,r);function n(e){e===void 0&&(e=new Lm(2));var t=r.call(this,"AgeGenderNet")||this;return t._faceFeatureExtractor=e,t}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(e){var t=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return j(function(){var i=e instanceof qr?t.faceFeatureExtractor.forwardInput(e):e,o=Gn(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=Bt(o,a.fc.age).as1D(),u=Bt(o,a.fc.gender);return{age:s,gender:u}})},n.prototype.forwardInput=function(e){var t=this;return j(function(){var a=t.runNet(e),i=a.age,o=a.gender;return{age:i,gender:Ft(o)}})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.predictAgeAndGender=function(e){return $(this,void 0,void 0,function(){var t,a,i,o,s,u,c=this;return Q(this,function(l){switch(l.label){case 0:return[4,Me(e)];case 1:return t=l.sent(),[4,this.forwardInput(t)];case 2:return a=l.sent(),i=Fe(a.age),o=Fe(a.gender),s=i.map(function(d,p){return{ageTensor:d,genderTensor:o[p]}}),[4,Promise.all(s.map(function(d){var p=d.ageTensor,h=d.genderTensor;return $(c,void 0,void 0,function(){var f,v,m,g,b;return Q(this,function(x){switch(x.label){case 0:return[4,p.data()];case 1:return f=x.sent()[0],[4,h.data()];case 2:return v=x.sent()[0],m=v>.5,g=m?Vi.MALE:Vi.FEMALE,b=m?v:1-v,p.dispose(),h.dispose(),[2,{age:f,gender:g,genderProbability:b}]}})})}))];case 3:return u=l.sent(),a.age.dispose(),a.gender.dispose(),[2,t.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},n.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.params,i=t.paramMappings;this._params=a,this._paramMappings=i},n.prototype.extractClassifierParams=function(e){return Vm(e)},n.prototype.extractParamsFromWeigthMap=function(e){var t=xs(e),a=t.featureExtractorMap,i=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Wm(i)},n.prototype.extractParams=function(e){var t=1539,a=e.slice(0,e.length-t),i=e.slice(e.length-t);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)},n}(ht);var Es=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.postProcess=function(e,t,a){var i=a.map(function(s){var u=s.width,c=s.height,l=t/Math.max(c,u);return{width:u*l,height:c*l}}),o=i.length;return j(function(){var s=function(p,h){return xt([Gt([68],p),Gt([68],h)],1).as2D(1,136).as1D()},u=function(p,h){var f=i[p],v=f.width,m=f.height;return h(v,m)?Math.abs(v-m)/2:0},c=function(p){return u(p,function(h,f){return h<f})},l=function(p){return u(p,function(h,f){return f<h})},d=e.mul(Gt([o,136],t)).sub(xt(Array.from(Array(o),function(p,h){return s(c(h),l(h))}))).div(xt(Array.from(Array(o),function(p,h){return s(i[h].width,i[h].height)})));return d})},n.prototype.forwardInput=function(e){var t=this;return j(function(){var a=t.runNet(e);return t.postProcess(a,e.inputSize,e.inputDimensions.map(function(i){var o=i[0],s=i[1];return{height:o,width:s}}))})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.detectLandmarks=function(e){return $(this,void 0,void 0,function(){var t,a,i,o=this;return Q(this,function(s){switch(s.label){case 0:return[4,Me(e)];case 1:return t=s.sent(),a=j(function(){return Fe(o.forwardInput(t))}),[4,Promise.all(a.map(function(u,c){return $(o,void 0,void 0,function(){var l,d,p,h,f;return Q(this,function(v){switch(v.label){case 0:return p=(d=Array).from,[4,u.data()];case 1:return l=p.apply(d,[v.sent()]),h=l.filter(function(m,g){return Lc(g)}),f=l.filter(function(m,g){return!Lc(g)}),[2,new ds(Array(68).fill(0).map(function(m,g){return new ge(h[g],f[g])}),{height:t.getInputHeight(c),width:t.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),a.forEach(function(u){return u.dispose()}),[2,t.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}(_s);var Ds=function(r){Z(n,r);function n(e){return e===void 0&&(e=new bs),r.call(this,"FaceLandmark68Net",e)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(Es);function Um(r){var n=[],e=ys(r,n).extractDenseBlock3Params,t={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return ft(r,n),{params:t,paramMappings:n}}function Hm(r){var n=[],e=mt(r),t=e.extractWeights,a=e.getRemainingWeights,i=vs(t,n).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:o,dense1:s,dense2:u}}}var Gm=function(r){Z(n,r);function n(){return r.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return j(function(){var a=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],o=Tn(a,i).div(J(255)),s=ms(o,t.dense0,!0);return s=ms(s,t.dense1),s=ms(s,t.dense2),s=Gn(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Um(e)},n.prototype.extractParams=function(e){return Hm(e)},n}(ht);var jm=function(r){Z(n,r);function n(e){return e===void 0&&(e=new Gm),r.call(this,"FaceLandmark68TinyNet",e)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(Es);var kA=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Ds);function qm(r,n){return de(qe(r,n.weights),n.biases)}function el(r,n,e,t,a){a===void 0&&(a="same");var i=n.conv,o=i.filters,s=i.bias,u=pt(r,o,e,a);return u=de(u,s),u=qm(u,n.scale),t?Te(u):u}function Ym(r,n){return el(r,n,[1,1],!0)}function tl(r,n){return el(r,n,[1,1],!1)}function ks(r,n){return el(r,n,[2,2],!0,"valid")}function o_(r,n){function e(s,u,c){var l=r(s),d=l.length/(u*c*c);if(vm(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return j(function(){return Jt(st(l,[u,d,c,c]),[2,3,1,0])})}function t(s,u,c,l){var d=e(s,u,c),p=Be(r(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:p}}function a(s,u){var c=Be(r(s)),l=Be(r(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function i(s,u,c,l){var d=t(s,u,c,l+"/conv"),p=a(u,l+"/scale");return{conv:d,scale:p}}function o(s,u,c,l,d){d===void 0&&(d=!1);var p=i((d?.5:1)*s,u,c,l+"/conv1"),h=i(s,u,c,l+"/conv2");return{conv1:p,conv2:h}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Km(r){var n=mt(r),e=n.extractWeights,t=n.getRemainingWeights,a=[],i=o_(e,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),f=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),_=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),A=j(function(){return Jt(Sn(e(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),t().length!==0)throw new Error("weights remaing after extract: "+t().length);var S={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:p,conv64_1:h,conv64_2:f,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:b,conv256_down:x,conv256_1:y,conv256_2:_,conv256_down_out:w,fc:A};return{params:S,paramMappings:a}}function s_(r,n){var e=At(r,n);function t(o){var s=e(o+"/scale/weights",1),u=e(o+"/scale/biases",1);return{weights:s,biases:u}}function a(o){var s=e(o+"/conv/filters",4),u=e(o+"/conv/bias",1),c=t(o);return{conv:{filters:s,bias:u},scale:c}}function i(o){return{conv1:a(o+"/conv1"),conv2:a(o+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:i}}function Xm(r){var n=[],e=s_(r,n),t=e.extractConvLayerParams,a=e.extractResidualLayerParams,i=t("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),d=a("conv64_2"),p=a("conv64_3"),h=a("conv128_down"),f=a("conv128_1"),v=a("conv128_2"),m=a("conv256_down"),g=a("conv256_1"),b=a("conv256_2"),x=a("conv256_down_out"),y=r.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!mm(y))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var _={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:p,conv128_down:h,conv128_1:f,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:b,conv256_down_out:x,fc:y};return ft(r,n),{params:_,paramMappings:n}}function mn(r,n){var e=Ym(r,n.conv1);return e=tl(e,n.conv2),e=de(e,r),e=Te(e),e}function Wi(r,n){var e=ks(r,n.conv1);e=tl(e,n.conv2);var t=Gn(r,2,2,"valid"),a=Le(t.shape),i=t.shape[3]!==e.shape[3],o=t.shape[1]!==e.shape[1]||t.shape[2]!==e.shape[2];if(o){var s=Hr(e.shape);s[1]=1;var u=Le(s);e=We([e,u],1);var c=Hr(e.shape);c[2]=1;var l=Le(c);e=We([e,l],2)}return t=i?We([t,a],3):t,e=de(t,e),e=Te(e),e}var nl=function(r){Z(n,r);function n(){return r.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return j(function(){var a=e.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],o=Tn(a,i).div(J(256)),s=ks(o,t.conv32_down);s=Ke(s,3,2,"valid"),s=mn(s,t.conv32_1),s=mn(s,t.conv32_2),s=mn(s,t.conv32_3),s=Wi(s,t.conv64_down),s=mn(s,t.conv64_1),s=mn(s,t.conv64_2),s=mn(s,t.conv64_3),s=Wi(s,t.conv128_down),s=mn(s,t.conv128_1),s=mn(s,t.conv128_2),s=Wi(s,t.conv256_down),s=mn(s,t.conv256_1),s=mn(s,t.conv256_2),s=Wi(s,t.conv256_down_out);var u=s.mean([1,2]),c=Ca(u,t.fc);return c})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.computeFaceDescriptor=function(e){return $(this,void 0,void 0,function(){var t,a,i,o=this;return Q(this,function(s){switch(s.label){case 0:return[4,Me(e)];case 1:return t=s.sent(),a=j(function(){return Fe(o.forwardInput(t))}),[4,Promise.all(a.map(function(u){return u.data()}))];case 2:return i=s.sent(),a.forEach(function(u){return u.dispose()}),[2,t.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Xm(e)},n.prototype.extractParams=function(e){return Km(e)},n}(ht);function rl(r,n){var e={descriptor:n};return Object.assign({},r,e)}function al(r,n){var e={age:n};return Object.assign({},r,e)}function il(r,n,e){var t={gender:n,genderProbability:e};return Object.assign({},r,t)}var zi=function(){function r(n){var e=n===void 0?{}:n,t=e.minFaceSize,a=e.scaleFactor,i=e.maxNumScales,o=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=t||20,this._scaleFactor=a||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r}();function u_(r,n){function e(u,c){var l=st(r(9*u),[3,3,u,1]),d=Be(r(u)),p=Be(r(u)),h=Be(r(u)),f=Be(r(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:p,batch_norm_mean:h,batch_norm_variance:f}}function t(u,c,l,d,p){var h=st(r(u*c*l*l),[l,l,u,c]),f=Be(r(c));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(p?"batch_norm_offset":"bias")}),{filters:h,bias:f}}function a(u,c,l,d){var p=t(u,c,l,d,!0),h=p.filters,f=p.bias;return{filters:h,batch_norm_offset:f}}function i(u,c,l){var d=e(u,l+"/depthwise_conv"),p=a(u,c,1,l+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:p}}function o(){var u=a(3,32,3,"mobilenetv1/conv_0"),c=i(32,64,"mobilenetv1/conv_1"),l=i(64,128,"mobilenetv1/conv_2"),d=i(128,128,"mobilenetv1/conv_3"),p=i(128,256,"mobilenetv1/conv_4"),h=i(256,256,"mobilenetv1/conv_5"),f=i(256,512,"mobilenetv1/conv_6"),v=i(512,512,"mobilenetv1/conv_7"),m=i(512,512,"mobilenetv1/conv_8"),g=i(512,512,"mobilenetv1/conv_9"),b=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),y=i(512,1024,"mobilenetv1/conv_12"),_=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:p,conv_5:h,conv_6:f,conv_7:v,conv_8:m,conv_9:g,conv_10:b,conv_11:x,conv_12:y,conv_13:_}}function s(){var u=a(1024,256,1,"prediction_layer/conv_0"),c=a(256,512,3,"prediction_layer/conv_1"),l=a(512,128,1,"prediction_layer/conv_2"),d=a(128,256,3,"prediction_layer/conv_3"),p=a(256,128,1,"prediction_layer/conv_4"),h=a(128,256,3,"prediction_layer/conv_5"),f=a(256,64,1,"prediction_layer/conv_6"),v=a(64,128,3,"prediction_layer/conv_7"),m=t(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=t(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=t(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=t(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),y=t(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),_=t(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),w=t(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),A=t(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),S=t(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),D=t(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),k=t(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),F=t(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),T={box_encoding_predictor:m,class_predictor:g},W={box_encoding_predictor:b,class_predictor:x},L={box_encoding_predictor:y,class_predictor:_},V={box_encoding_predictor:w,class_predictor:A},H={box_encoding_predictor:S,class_predictor:D},U={box_encoding_predictor:k,class_predictor:F};return{conv_0:u,conv_1:c,conv_2:l,conv_3:d,conv_4:p,conv_5:h,conv_6:f,conv_7:v,box_predictor_0:T,box_predictor_1:W,box_predictor_2:L,box_predictor_3:V,box_predictor_4:H,box_predictor_5:U}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:s}}function $m(r){var n=[],e=mt(r),t=e.extractWeights,a=e.getRemainingWeights,i=u_(t,n),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l=Qo(t(5118*4),[1,5118,4]),d={extra_dim:l};if(n.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:n}}function c_(r,n){var e=At(r,n);function t(c,l,d){var p=e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),h=e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:p,batch_norm_offset:h}}function a(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",p=l+"/depthwise_conv",h=l+"/pointwise_conv",f=e(d+"/depthwise_weights",4,p+"/filters"),v=e(d+"/BatchNorm/gamma",1,p+"/batch_norm_scale"),m=e(d+"/BatchNorm/beta",1,p+"/batch_norm_offset"),g=e(d+"/BatchNorm/moving_mean",1,p+"/batch_norm_mean"),b=e(d+"/BatchNorm/moving_variance",1,p+"/batch_norm_variance");return{depthwise_conv:{filters:f,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:b},pointwise_conv:t("MobilenetV1",c,h)}}function i(){return{conv_0:t("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function o(c,l){var d=e(c+"/weights",4,l+"/filters"),p=e(c+"/biases",1,l+"/bias");return{filters:d,bias:p}}function s(c){var l=o("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),d=o("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:d}}function u(){return{conv_0:t("Prediction",0,"prediction_layer/conv_0"),conv_1:t("Prediction",1,"prediction_layer/conv_1"),conv_2:t("Prediction",2,"prediction_layer/conv_2"),conv_3:t("Prediction",3,"prediction_layer/conv_3"),conv_4:t("Prediction",4,"prediction_layer/conv_4"),conv_5:t("Prediction",5,"prediction_layer/conv_5"),conv_6:t("Prediction",6,"prediction_layer/conv_6"),conv_7:t("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function Qm(r){var n=[],e=c_(r,n),t=e.extractMobilenetV1Params,a=e.extractPredictionLayerParams,i=r["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!xr(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var o={mobilenetv1:t(),prediction_layer:a(),output_layer:{extra_dim:i}};return ft(r,n),{params:o,paramMappings:n}}function en(r,n,e){return j(function(){var t=pt(r,n.filters,e,"same");return t=de(t,n.batch_norm_offset),Ci(t,0,6)})}var l_=.0010000000474974513;function d_(r,n,e){return j(function(){var t=ki(r,n.filters,e,"same");return t=wc(t,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,l_),Ci(t,0,6)})}function p_(r){return[2,4,6,12].some(function(n){return n===r})?[2,2]:[1,1]}function Jm(r,n){return j(function(){var e=null,t=en(r,n.conv_0,[2,2]),a=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(a.forEach(function(i,o){var s=o+1,u=p_(s);t=d_(t,i.depthwise_conv,u),t=en(t,i.pointwise_conv,[1,1]),s===11&&(e=t)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:t,conv11:e}})}function Zm(r,n,e,t,a){var i=r.shape[0],o=Math.min(e,i),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>a}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=t?1:0},c=[];return s.forEach(function(l){if(!(c.length>=o)){for(var d=l.score,p=c.length-1;p>=0;--p){var h=h_(r,l.boxIndex,c[p]);if(h!==0&&(l.score*=u(h),l.score<=a))break}d===l.score&&c.push(l.boxIndex)}}),c}function h_(r,n,e){var t=r.arraySync(),a=Math.min(t[n][0],t[n][2]),i=Math.min(t[n][1],t[n][3]),o=Math.max(t[n][0],t[n][2]),s=Math.max(t[n][1],t[n][3]),u=Math.min(t[e][0],t[e][2]),c=Math.min(t[e][1],t[e][3]),l=Math.max(t[e][0],t[e][2]),d=Math.max(t[e][1],t[e][3]),p=(o-a)*(s-i),h=(l-u)*(d-c);if(p<=0||h<=0)return 0;var f=Math.max(a,u),v=Math.max(i,c),m=Math.min(o,l),g=Math.min(s,d),b=Math.max(m-f,0)*Math.max(g-v,0);return b/(p+h-b)}function f_(r){var n=Fe(Jt(r,[1,0])),e=[Oe(n[2],n[0]),Oe(n[3],n[1])],t=[de(n[0],Qt(e[0],J(2))),de(n[1],Qt(e[1],J(2)))];return{sizes:e,centers:t}}function m_(r,n){var e=f_(r),t=e.sizes,a=e.centers,i=Fe(Jt(n,[1,0])),o=Qt(qe(ns(Qt(i[2],J(5))),t[0]),J(2)),s=de(qe(Qt(i[0],J(10)),t[0]),a[0]),u=Qt(qe(ns(Qt(i[3],J(5))),t[1]),J(2)),c=de(qe(Qt(i[1],J(10)),t[1]),a[1]);return Jt(xt([Oe(s,o),Oe(c,u),de(s,o),de(c,u)]),[1,0])}function ev(r,n,e){return j(function(){var t=r.shape[0],a=m_(Tt(Nr(e.extra_dim,[t,1,1]),[-1,4]),Tt(r,[-1,4]));a=Tt(a,[t,a.shape[0]/t,4]);var i=_c(cn(n,[0,0,1],[-1,-1,-1])),o=cn(i,[0,0,0],[-1,-1,1]);o=Tt(o,[t,o.shape[1]]);var s=Fe(a),u=Fe(o);return{boxes:s,scores:u}})}function Yr(r,n){return j(function(){var e=r.shape[0],t=Tt(St(r,n.box_encoding_predictor),[e,-1,1,4]),a=Tt(St(r,n.class_predictor),[e,-1,3]);return{boxPredictionEncoding:t,classPrediction:a}})}function tv(r,n,e){return j(function(){var t=en(r,e.conv_0,[1,1]),a=en(t,e.conv_1,[2,2]),i=en(a,e.conv_2,[1,1]),o=en(i,e.conv_3,[2,2]),s=en(o,e.conv_4,[1,1]),u=en(s,e.conv_5,[2,2]),c=en(u,e.conv_6,[1,1]),l=en(c,e.conv_7,[2,2]),d=Yr(n,e.box_predictor_0),p=Yr(r,e.box_predictor_1),h=Yr(a,e.box_predictor_2),f=Yr(o,e.box_predictor_3),v=Yr(u,e.box_predictor_4),m=Yr(l,e.box_predictor_5),g=We([d.boxPredictionEncoding,p.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),b=We([d.classPrediction,p.classPrediction,h.classPrediction,f.classPrediction,v.classPrediction,m.classPrediction],1);return{boxPredictions:g,classPredictions:b}})}var Cr=function(){function r(n){var e=n===void 0?{}:n,t=e.minConfidence,a=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=t||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r}();var Ss=function(r){Z(n,r);function n(){return r.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return j(function(){var a=e.toBatchTensor(512,!1).toFloat(),i=Oe(qe(a,J(.007843137718737125)),J(1)),o=Jm(i,t.mobilenetv1),s=tv(o.out,o.conv11,t.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return ev(u,c,t.output_layer)})},n.prototype.forward=function(e){return $(this,void 0,void 0,function(){var t;return Q(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,Me(e)];case 1:return[2,t.apply(this,[a.sent()])]}})})},n.prototype.locateFaces=function(e,t){return t===void 0&&(t={}),$(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,p,h,f,v,m,g,b,x,y,_,w,A,S;return Q(this,function(D){switch(D.label){case 0:return a=new Cr(t),i=a.maxResults,o=a.minConfidence,[4,Me(e)];case 1:for(s=D.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,d=c[0],p=l[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return m=(v=Array).from,[4,p.data()];case 2:return f=m.apply(v,[D.sent()]),g=.5,b=Zm(d,f,i,g,o),x=s.getReshapedInputDimensions(0),y=s.inputSize,_=y/x.width,w=y/x.height,A=d.arraySync(),S=b.map(function(k){var F=[Math.max(0,A[k][0]),Math.min(1,A[k][2])].map(function(U){return U*w}),T=F[0],W=F[1],L=[Math.max(0,A[k][1]),Math.min(1,A[k][3])].map(function(U){return U*_}),V=L[0],H=L[1];return new et(f[k],new ka(V,T,H-V,W-T),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),p.dispose(),[2,S]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(e){return Qm(e)},n.prototype.extractParams=function(e){return $m(e)},n}(ht);var GI=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n}(Ss);var nv=.4,rv=[new ge(.738768,.874946),new ge(2.42204,2.65704),new ge(4.30971,7.04493),new ge(10.246,4.59428),new ge(12.6868,11.8741)],av=[new ge(1.603231,2.094468),new ge(6.041143,7.080126),new ge(2.882459,3.518061),new ge(4.266906,5.178857),new ge(9.041765,10.66308)],iv=[117.001,114.697,97.404],ov="tiny_yolov2_model",sv="tiny_yolov2_separable_conv_model";var As=function(r){return typeof r=="number"};function uv(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!As(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(n){return n||{}}).every(function(n){return As(n.x)&&As(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(As)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function Na(r){return j(function(){var n=qe(r,J(.10000000149011612));return de(Te(Oe(r,n)),n)})}function Xn(r,n){return j(function(){var e=Hn(r,[[0,0],[1,1],[1,1],[0,0]]);return e=pt(e,n.conv.filters,[1,1],"valid"),e=Oe(e,n.bn.sub),e=qe(e,n.bn.truediv),e=de(e,n.conv.bias),Na(e)})}function $n(r,n){return j(function(){var e=Hn(r,[[0,0],[1,1],[1,1],[0,0]]);return e=Si(e,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),e=de(e,n.bias),Na(e)})}function v_(r,n){var e=wr(r,n);function t(o,s){var u=Be(r(o)),c=Be(r(o));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function a(o,s,u){var c=e(o,s,3,u+"/conv"),l=t(s,u+"/bn");return{conv:c,bn:l}}var i=Ta(r,n);return{extractConvParams:e,extractConvWithBatchNormParams:a,extractSeparableConvParams:i}}function cv(r,n,e,t){var a=mt(r),i=a.extractWeights,o=a.getRemainingWeights,s=[],u=v_(i,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,p;if(n.withSeparableConvs){var h=t[0],f=t[1],v=t[2],m=t[3],g=t[4],b=t[5],x=t[6],y=t[7],_=t[8],w=n.isFirstLayerConv2d?c(h,f,3,"conv0"):d(h,f,"conv0"),A=d(f,v,"conv1"),S=d(v,m,"conv2"),D=d(m,g,"conv3"),k=d(g,b,"conv4"),F=d(b,x,"conv5"),T=y?d(x,y,"conv6"):void 0,W=_?d(y,_,"conv7"):void 0,L=c(_||y||x,5*e,1,"conv8");p={conv0:w,conv1:A,conv2:S,conv3:D,conv4:k,conv5:F,conv6:T,conv7:W,conv8:L}}else{var h=t[0],f=t[1],v=t[2],m=t[3],g=t[4],b=t[5],x=t[6],y=t[7],_=t[8],w=l(h,f,"conv0"),A=l(f,v,"conv1"),S=l(v,m,"conv2"),D=l(m,g,"conv3"),k=l(g,b,"conv4"),F=l(b,x,"conv5"),T=l(x,y,"conv6"),W=l(y,_,"conv7"),L=c(_,5*e,1,"conv8");p={conv0:w,conv1:A,conv2:S,conv3:D,conv4:k,conv5:F,conv6:T,conv7:W,conv8:L}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:p,paramMappings:s}}function g_(r,n){var e=At(r,n);function t(s){var u=e(s+"/sub",1),c=e(s+"/truediv",1);return{sub:u,truediv:c}}function a(s){var u=e(s+"/filters",4),c=e(s+"/bias",1);return{filters:u,bias:c}}function i(s){var u=a(s+"/conv"),c=t(s+"/bn");return{conv:u,bn:c}}var o=Fa(e);return{extractConvParams:a,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function lv(r,n){var e=[],t=g_(r,e),a=t.extractConvParams,i=t.extractConvWithBatchNormParams,o=t.extractSeparableConvParams,s;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?a("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:u>7?o("conv6"):void 0,conv7:u>8?o("conv7"):void 0,conv8:a("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return ft(r,e),{params:s,paramMappings:e}}var Kr=function(){function r(n){var e=n===void 0?{}:n,t=e.inputSize,a=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=t||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r}();var Is=function(r){Z(n,r);function n(e){var t=r.call(this,"TinyYolov2")||this;return uv(e),t._config=e,t}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(e,t){var a=Xn(e,t.conv0);return a=Ke(a,[2,2],[2,2],"same"),a=Xn(a,t.conv1),a=Ke(a,[2,2],[2,2],"same"),a=Xn(a,t.conv2),a=Ke(a,[2,2],[2,2],"same"),a=Xn(a,t.conv3),a=Ke(a,[2,2],[2,2],"same"),a=Xn(a,t.conv4),a=Ke(a,[2,2],[2,2],"same"),a=Xn(a,t.conv5),a=Ke(a,[2,2],[1,1],"same"),a=Xn(a,t.conv6),a=Xn(a,t.conv7),St(a,t.conv8,"valid",!1)},n.prototype.runMobilenet=function(e,t){var a=this.config.isFirstLayerConv2d?Na(St(e,t.conv0,"valid",!1)):$n(e,t.conv0);return a=Ke(a,[2,2],[2,2],"same"),a=$n(a,t.conv1),a=Ke(a,[2,2],[2,2],"same"),a=$n(a,t.conv2),a=Ke(a,[2,2],[2,2],"same"),a=$n(a,t.conv3),a=Ke(a,[2,2],[2,2],"same"),a=$n(a,t.conv4),a=Ke(a,[2,2],[2,2],"same"),a=$n(a,t.conv5),a=Ke(a,[2,2],[1,1],"same"),a=t.conv6?$n(a,t.conv6):a,a=t.conv7?$n(a,t.conv7):a,St(a,t.conv8,"valid",!1)},n.prototype.forwardInput=function(e,t){var a=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return j(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=a.config.meanRgb?Tn(o,a.config.meanRgb):o,o=o.div(J(256)),a.config.withSeparableConvs?a.runMobilenet(o,i):a.runTinyYolov2(o,i)})},n.prototype.forward=function(e,t){return $(this,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Me(e)];case 1:return[4,a.apply(this,[i.sent(),t])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(e,t){return t===void 0&&(t={}),$(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,p,h,f,v,m,g,b=this;return Q(this,function(x){switch(x.label){case 0:return a=new Kr(t),i=a.inputSize,o=a.scoreThreshold,[4,Me(e)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),c=j(function(){return Fe(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),o)];case 3:return d=x.sent(),u.dispose(),c.dispose(),p=d.map(function(y){return y.box}),h=d.map(function(y){return y.score}),f=d.map(function(y){return y.classScore}),v=d.map(function(y){return b.config.classes[y.label]}),m=Yn(p.map(function(y){return y.rescale(i)}),h,this.config.iouThreshold,!0),g=m.map(function(y){return new cs(h[y],f[y],v[y],p[y],l)}),[2,g]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(e){return lv(e,this.config)},n.prototype.extractParams=function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,a=t?t.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return cv(e,this.config,this.boxEncodingSize,t)},n.prototype.extractBoxes=function(e,t,a){return $(this,void 0,void 0,function(){var i,o,s,u,c,l,d,p,h,f,v,m,g,b,x,y,_,w,A,S,D,k,F,T,W,L,V,H,U,z=this;return Q(this,function(q){switch(q.label){case 0:return i=t.width,o=t.height,s=Math.max(i,o),u=s/i,c=s/o,l=e.shape[1],d=this.config.anchors.length,p=j(function(){var K=e.reshape([l,l,d,z.boxEncodingSize]),te=K.slice([0,0,0,0],[l,l,d,4]),se=K.slice([0,0,0,4],[l,l,d,1]),le=z.withClassScores?Ft(K.slice([0,0,0,5],[l,l,d,z.config.classes.length]),3):J(0);return[te,se,le]}),h=p[0],f=p[1],v=p[2],m=[],[4,f.array()];case 1:return g=q.sent(),[4,h.array()];case 2:b=q.sent(),x=0,q.label=3;case 3:if(!(x<l))return[3,12];y=0,q.label=4;case 4:if(!(y<l))return[3,11];_=0,q.label=5;case 5:return _<d?(w=ls(g[x][y][_][0]),!a||w>a?(A=(y+ls(b[x][y][_][0]))/l*u,S=(x+ls(b[x][y][_][1]))/l*c,D=Math.exp(b[x][y][_][2])*this.config.anchors[_].x/l*u,k=Math.exp(b[x][y][_][3])*this.config.anchors[_].y/l*c,F=A-D/2,T=S-k/2,W={row:x,col:y,anchor:_},this.withClassScores?[4,this.extractPredictedClass(v,W)]:[3,7]):[3,9]):[3,10];case 6:return U=q.sent(),[3,8];case 7:U={classScore:1,label:0},q.label=8;case 8:L=U,V=L.classScore,H=L.label,m.push(it({box:new Gr(F,T,F+D,T+k),score:w,classScore:w*V,label:H},W)),q.label=9;case 9:return _++,[3,5];case 10:return y++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),f.dispose(),v.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(e,t){return $(this,void 0,void 0,function(){var a,i,o,s;return Q(this,function(u){switch(u.label){case 0:return a=t.row,i=t.col,o=t.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[a][i][o][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(ht);var ol=function(r){Z(n,r);function n(e){e===void 0&&(e=!0);var t=this,a=Object.assign({},{withSeparableConvs:e,iouThreshold:nv,classes:["face"]},e?{anchors:av,meanRgb:iv}:{anchors:rv,withClassScores:!0});return t=r.call(this,a)||this,t}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,t){return $(this,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return[4,this.detect(e,t)];case 1:return a=i.sent(),[2,a.map(function(o){return new et(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?sv:ov},n.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},n}(Is);var dv=function(r){Z(n,r);function n(){var e=r!==null&&r.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return n}(Kr);var Fn=function(){function r(){}return r.prototype.then=function(n){return $(this,void 0,void 0,function(){var e;return Q(this,function(t){switch(t.label){case 0:return e=n,[4,this.run()];case 1:return[2,e.apply(void 0,[t.sent()])]}})})},r.prototype.run=function(){return $(this,void 0,void 0,function(){return Q(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},r}();function Xr(r,n,e,t,a){return a===void 0&&(a=function(i){var o=i.alignedRect;return o}),$(this,void 0,void 0,function(){var i,o,s,u,c;return Q(this,function(l){switch(l.label){case 0:return i=r.map(function(d){return Cs(d)?a(d):d.detection}),s=t,s?[3,5]:n instanceof Pe?[4,Oi(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Pi(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return o=s,[4,e(o)];case 6:return c=l.sent(),o.forEach(function(d){return d instanceof Pe&&d.dispose()}),[2,c]}})})}function Pa(r,n,e,t,a){return $(this,void 0,void 0,function(){var i=this;return Q(this,function(o){return[2,Xr([r],n,function(s){return $(i,void 0,void 0,function(){return Q(this,function(u){return[2,e(s[0])]})})},t,a)]})})}function pv(r){return j(function(){return xt(Fe(r,3).reverse(),3)})}var Ui=2,$r=12;function y_(r,n){var e=wr(r,n),t=Ra(r,n);function a(c,l){var d=Be(r(c));return n.push({paramPath:l}),d}function i(c,l,d){d===void 0&&(d=!1);var p=e(c[0],c[1],3,l+"/conv1"),h=a(c[1],l+"/prelu1_alpha"),f=e(c[1],c[2],3,l+"/conv2"),v=a(c[2],l+"/prelu2_alpha"),m=e(c[2],c[3],d?2:3,l+"/conv3"),g=a(c[3],l+"/prelu3_alpha");return{conv1:p,prelu1_alpha:h,conv2:f,prelu2_alpha:v,conv3:m,prelu3_alpha:g}}function o(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return it(it({},c),{conv4_1:l,conv4_2:d})}function s(){var c=i([3,28,48,64],"rnet",!0),l=t(576,128,"rnet/fc1"),d=a(128,"rnet/prelu4_alpha"),p=t(128,2,"rnet/fc2_1"),h=t(128,4,"rnet/fc2_2");return it(it({},c),{fc1:l,prelu4_alpha:d,fc2_1:p,fc2_2:h})}function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=a(128,"onet/prelu4_alpha"),p=t(1152,256,"onet/fc1"),h=a(256,"onet/prelu5_alpha"),f=t(256,2,"onet/fc2_1"),v=t(256,4,"onet/fc2_2"),m=t(256,10,"onet/fc2_3");return it(it({},c),{conv4:l,prelu4_alpha:d,fc1:p,prelu5_alpha:h,fc2_1:f,fc2_2:v,fc2_3:m})}return{extractPNetParams:o,extractRNetParams:s,extractONetParams:u}}function hv(r){var n=mt(r),e=n.extractWeights,t=n.getRemainingWeights,a=[],i=y_(e,a),o=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=o(),l=s(),d=u();if(t().length!==0)throw new Error("weights remaing after extract: "+t().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:a}}function b_(r,n){var e=At(r,n);function t(l){var d=e(l+"/weights",4,l+"/filters"),p=e(l+"/bias",1);return{filters:d,bias:p}}function a(l){var d=e(l+"/weights",2),p=e(l+"/bias",1);return{weights:d,bias:p}}function i(l){return e(l,1)}function o(l){var d=t(l+"/conv1"),p=i(l+"/prelu1_alpha"),h=t(l+"/conv2"),f=i(l+"/prelu2_alpha"),v=t(l+"/conv3"),m=i(l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:p,conv2:h,prelu2_alpha:f,conv3:v,prelu3_alpha:m}}function s(){var l=o("pnet"),d=t("pnet/conv4_1"),p=t("pnet/conv4_2");return it(it({},l),{conv4_1:d,conv4_2:p})}function u(){var l=o("rnet"),d=a("rnet/fc1"),p=i("rnet/prelu4_alpha"),h=a("rnet/fc2_1"),f=a("rnet/fc2_2");return it(it({},l),{fc1:d,prelu4_alpha:p,fc2_1:h,fc2_2:f})}function c(){var l=o("onet"),d=t("onet/conv4"),p=i("onet/prelu4_alpha"),h=a("onet/fc1"),f=i("onet/prelu5_alpha"),v=a("onet/fc2_1"),m=a("onet/fc2_2"),g=a("onet/fc2_3");return it(it({},l),{conv4:d,prelu4_alpha:p,fc1:h,prelu5_alpha:f,fc2_1:v,fc2_2:m,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function fv(r){var n=[],e=b_(r,n),t=e.extractPNetParams,a=e.extractRNetParams,i=e.extractONetParams,o=t(),s=a(),u=i();return ft(r,n),{params:{pnet:o,rnet:s,onet:u},paramMappings:n}}function Hi(r,n){var e=n[0],t=n[1];return{height:Math.floor(e*r),width:Math.floor(t*r)}}function mv(r,n,e){for(var t=e[0],a=e[1],i=$r/r,o=[],s=Math.min(t,a)*i,u=0;s>=12;)o.push(i*Math.pow(n,u)),s=s*n,u+=1;return o}var Oa=function(r){Z(n,r);function n(e,t,a,i){return r.call(this,{left:e,top:t,right:a,bottom:i},!0)||this}return n}(_t);function Rs(r){return j(function(){return qe(Oe(r,J(127.5)),J(.0078125))})}function Qn(r,n){return j(function(){return de(Te(r),qe(n,Ei(Te(Ei(r)))))})}function Ba(r,n,e){return e===void 0&&(e=!1),j(function(){var t=St(r,n.conv1,"valid");return t=Qn(t,n.prelu1_alpha),t=Ke(t,e?[2,2]:[3,3],[2,2],"same"),t=St(t,n.conv2,"valid"),t=Qn(t,n.prelu2_alpha),t=e?t:Ke(t,[3,3],[2,2],"valid"),t=St(t,n.conv3,"valid"),t=Qn(t,n.prelu3_alpha),t})}function vv(r,n){return j(function(){var e=Ba(r,n,!0),t=St(e,n.conv4_1,"valid"),a=Et(zr(t,3),3),i=Ft(Oe(t,a),3),o=St(e,n.conv4_2,"valid");return{prob:i,regions:o}})}function x_(r,n){return j(function(){var e=Hi(n,r.shape.slice(1)),t=e.height,a=e.width,i=Ii.resizeBilinear(r,[t,a]),o=Rs(i);return Jt(o,[0,2,1,3])})}function __(r,n,e,t){for(var a=[],i=r.arraySync(),o=0;o<r.shape[0];o++)for(var s=0;s<r.shape[1];s++)i[o][s]>=t&&a.push(new ge(s,o));var u=a.map(function(c){var l=new Gr(Math.round((c.y*Ui+1)/e),Math.round((c.x*Ui+1)/e),Math.round((c.y*Ui+$r)/e),Math.round((c.x*Ui+$r)/e)),d=i[c.y][c.x],p=n.arraySync(),h=new Oa(p[c.y][c.x][0],p[c.y][c.x][1],p[c.y][c.x][2],p[c.y][c.x][3]);return{cell:l,score:d,region:h}});return u}function gv(r,n,e,t,a){a.stage1=[];var i=n.map(function(p){return j(function(){var h={scale:p},f=x_(r,p),v=Date.now(),m=vv(f,t),g=m.prob,b=m.regions;h.pnet=Date.now()-v;var x=Fe(Fe(g,3)[1])[0],y=Fe(b)[0];return{scoresTensor:x,regionsTensor:y,scale:p,statsForScale:h}})}),o=i.map(function(p){var h=p.scoresTensor,f=p.regionsTensor,v=p.scale,m=p.statsForScale,g=__(h,f,v,e);if(h.dispose(),f.dispose(),!g.length)return a.stage1.push(m),[];var b=Date.now(),x=Yn(g.map(function(y){return y.cell}),g.map(function(y){return y.score}),.5);return m.nms=Date.now()-b,m.numBoxes=x.length,a.stage1.push(m),x.map(function(y){return g[y]})}),s=o.reduce(function(p,h){return p.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=Yn(s.map(function(p){return p.cell}),s.map(function(p){return p.score}),.7);a.stage1_nms=Date.now()-l,c=d.map(function(p){return s[p].score}),u=d.map(function(p){return s[p]}).map(function(p){var h=p.cell,f=p.region;return new Gr(h.left+f.left*h.width,h.top+f.top*h.height,h.right+f.right*h.width,h.bottom+f.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function Ts(r,n,e){var t=e.width,a=e.height;return $(this,void 0,void 0,function(){var i,o,s,u=this;return Q(this,function(c){switch(c.label){case 0:return i=wt(r),[4,Promise.all(n.map(function(l){return $(u,void 0,void 0,function(){var d,p,h,f,v,m,g,b;return Q(this,function(x){return d=l.padAtBorders(r.height,r.width),p=d.y,h=d.ey,f=d.x,v=d.ex,m=f-1,g=p-1,b=i.getImageData(m,g,v-m,h-g),[2,Se.isNodejs()?Ia(b):createImageBitmap(b)]})})}))];case 1:return o=c.sent(),s=[],o.forEach(function(l){var d=jr({width:t,height:a}),p=wt(d);p.drawImage(l,0,0,t,a);for(var h=p.getImageData(0,0,t,a).data,f=[],v=0;v<h.length;v+=4)f.push(h[v+2]),f.push(h[v+1]),f.push(h[v]);s.push(f)}),[2,s.map(function(l){var d=j(function(){var p=Jt(st(l,[1,t,a,3]),[0,2,1,3]).toFloat();return Rs(p)});return d})]}})})}function yv(r,n){return j(function(){var e=Ba(r,n),t=Tt(e,[e.shape[0],n.fc1.weights.shape[0]]),a=Bt(t,n.fc1),i=Qn(a,n.prelu4_alpha),o=Bt(i,n.fc2_1),s=Et(zr(o,1),1),u=Ft(Oe(o,s),1),c=Bt(i,n.fc2_2),l=Fe(u,1)[1];return{scores:l,regions:c}})}function bv(r,n,e,t,a){return $(this,void 0,void 0,function(){var i,o,s,u,c,l,d,p,h,f,v,m,g,b;return Q(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,Ts(r,n,{width:24,height:24})];case 1:return o=x.sent(),a.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(y){var _=yv(y,t);return y.dispose(),_}),a.stage2_rnet=Date.now()-i,u=s.length>1?We(s.map(function(y){return y.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[x.sent()]),u.dispose(),p=c.map(function(y,_){return{score:y,idx:_}}).filter(function(y){return y.score>e}).map(function(y){var _=y.idx;return _}),h=p.map(function(y){return n[y]}),f=p.map(function(y){return c[y]}),v=[],m=[],h.length>0&&(i=Date.now(),g=Yn(h,f,.7),a.stage2_nms=Date.now()-i,b=g.map(function(y){var _=s[p[y]].regions.arraySync();return new Oa(_[0][0],_[0][1],_[0][2],_[0][3])}),m=g.map(function(y){return f[y]}),v=g.map(function(y,_){return h[y].calibrate(b[_])})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function xv(r,n){return j(function(){var e=Ba(r,n);e=Ke(e,[2,2],[2,2],"same"),e=St(e,n.conv4,"valid"),e=Qn(e,n.prelu4_alpha);var t=Tt(e,[e.shape[0],n.fc1.weights.shape[0]]),a=Bt(t,n.fc1),i=Qn(a,n.prelu5_alpha),o=Bt(i,n.fc2_1),s=Et(zr(o,1),1),u=Ft(Oe(o,s),1),c=Bt(i,n.fc2_2),l=Bt(i,n.fc2_3),d=Fe(u,1)[1];return{scores:d,regions:c,points:l}})}function _v(r,n,e,t,a){return $(this,void 0,void 0,function(){var i,o,s,u,c,l,d,p,h,f,v,m,g,b,x;return Q(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,Ts(r,n,{width:48,height:48})];case 1:return o=y.sent(),a.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=o.map(function(_){var w=xv(_,t);return _.dispose(),w}),a.stage3_onet=Date.now()-i,u=s.length>1?We(s.map(function(_){return _.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),p=c.map(function(_,w){return{score:_,idx:w}}).filter(function(_){return _.score>e}).map(function(_){var w=_.idx;return w}),h=p.map(function(_){var w=s[_].regions.arraySync();return new Oa(w[0][0],w[0][1],w[0][2],w[0][3])}),f=p.map(function(_,w){return n[_].calibrate(h[w])}),v=p.map(function(_){return c[_]}),m=[],g=[],b=[],f.length>0&&(i=Date.now(),x=Yn(f,v,.7,!1),a.stage3_nms=Date.now()-i,m=x.map(function(_){return f[_]}),g=x.map(function(_){return v[_]}),b=x.map(function(_,w){return Array(5).fill(0).map(function(A,S){var D=s[_].points.arraySync();return new ge(D[0][S]*(m[w].width+1)+m[w].left,D[0][S+5]*(m[w].height+1)+m[w].top)})})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose(),_.points.dispose()}),[2,{boxes:m,scores:g,points:b}]}})})}var sl=function(r){Z(n,r);function n(){return r.call(this,"Mtcnn")||this}return n.prototype.load=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,e)]})})},n.prototype.loadFromDisk=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,e)]})})},n.prototype.forwardInput=function(e,t){return t===void 0&&(t={}),$(this,void 0,void 0,function(){var a,i,o,s,u,c,l,d,p,h,f,v,m,g,b,x,y,_,w,A,S;return Q(this,function(D){switch(D.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(i=e.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},s=Date.now(),u=j(function(){return pv(Et(Ea.fromPixels(i)).toFloat())}),c=function(k){return u.dispose(),o.total=Date.now()-s,k},l=u.shape.slice(1),d=l[0],p=l[1],h=new zi(t),f=h.minFaceSize,v=h.scaleFactor,m=h.maxNumScales,g=h.scoreThresholds,b=h.scaleSteps,x=(b||mv(f,v,[d,p])).filter(function(k){var F=Hi(k,[d,p]);return Math.min(F.width,F.height)>$r}).slice(0,m),o.scales=x,o.pyramid=x.map(function(k){return Hi(k,[d,p])}),y=Date.now(),[4,gv(u,x,g[0],a.pnet,o)];case 1:return _=D.sent(),o.total_stage1=Date.now()-y,_.boxes.length?(o.stage2_numInputBoxes=_.boxes.length,y=Date.now(),[4,bv(i,_.boxes,g[1],a.rnet,o)]):[2,c({results:[],stats:o})];case 2:return w=D.sent(),o.total_stage2=Date.now()-y,w.boxes.length?(o.stage3_numInputBoxes=w.boxes.length,y=Date.now(),[4,_v(i,w.boxes,g[2],a.onet,o)]):[2,c({results:[],stats:o})];case 3:return A=D.sent(),o.total_stage3=Date.now()-y,S=A.boxes.map(function(k,F){return Ma(Sa({},new et(A.scores[F],new ka(k.left/p,k.top/d,k.width/p,k.height/d),{height:d,width:p})),new _m(A.points[F].map(function(T){return T.sub(new ge(k.left,k.top)).div(new ge(k.width,k.height))}),{width:k.width,height:k.height}))}),[2,c({results:S,stats:o})]}})})},n.prototype.forward=function(e,t){return t===void 0&&(t={}),$(this,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Me(e)];case 1:return[4,a.apply(this,[i.sent(),t])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(e,t){return t===void 0&&(t={}),$(this,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return a=this.forwardInput,[4,Me(e)];case 1:return[2,a.apply(this,[i.sent(),t])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(e){return fv(e)},n.prototype.extractParams=function(e){return hv(e)},n}(ht);var wv=.4,Cv=[new ge(1.603231,2.094468),new ge(6.041143,7.080126),new ge(2.882459,3.518061),new ge(4.266906,5.178857),new ge(9.041765,10.66308)],Ev=[117.001,114.697,97.404];var ul=function(r){Z(n,r);function n(){var e=this,t={withSeparableConvs:!0,iouThreshold:wv,classes:["face"],anchors:Cv,meanRgb:Ev,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=r.call(this,t)||this,e}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(e,t){return $(this,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return[4,this.detect(e,t)];case 1:return a=i.sent(),[2,a.map(function(o){return new et(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},n}(Is);var ct={ssdMobilenetv1:new Ss,tinyFaceDetector:new ul,tinyYolov2:new ol,mtcnn:new sl,faceLandmark68Net:new Ds,faceLandmark68TinyNet:new jm,faceRecognitionNet:new nl,faceExpressionNet:new Nm,ageGenderNet:new zm};var Dv=function(r){Z(n,r);function n(e,t,a){var i=r.call(this)||this;return i.parentTask=e,i.input=t,i.extractedFaces=a,i}return n}(Fn);var Gi=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a=this;return Q(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Xr(e,this.input,function(o){return $(a,void 0,void 0,function(){return Q(this,function(s){switch(s.label){case 0:return[4,Promise.all(o.map(function(u){return ct.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return t=i.sent(),[2,e.map(function(o,s){return Jc(o,t[s])})]}})})},n.prototype.withAgeAndGender=function(){return new qi(this,this.input)},n}(Dv);var ji=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t;return Q(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,Pa(e,this.input,function(i){return ct.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return t=a.sent(),[2,Jc(e,t)]}})})},n.prototype.withAgeAndGender=function(){return new Yi(this,this.input)},n}(Dv);var La=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Wa(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ua(this,this.input)},n}(Gi);var Va=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new za(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ha(this,this.input)},n}(ji);var kv=function(r){Z(n,r);function n(e,t,a){var i=r.call(this)||this;return i.parentTask=e,i.input=t,i.extractedFaces=a,i}return n}(Fn);var qi=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a=this;return Q(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),[4,Xr(e,this.input,function(o){return $(a,void 0,void 0,function(){return Q(this,function(s){switch(s.label){case 0:return[4,Promise.all(o.map(function(u){return ct.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return t=i.sent(),[2,e.map(function(o,s){var u=t[s],c=u.age,l=u.gender,d=u.genderProbability;return al(il(o,l,d),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Gi(this,this.input)},n}(kv);var Yi=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a,i,o;return Q(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?[4,Pa(e,this.input,function(u){return ct.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return t=s.sent(),a=t.age,i=t.gender,o=t.genderProbability,[2,al(il(e,i,o),a)]}})})},n.prototype.withFaceExpressions=function(){return new ji(this,this.input)},n}(kv);var Wa=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new La(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ua(this,this.input)},n}(qi);var za=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Va(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ha(this,this.input)},n}(Yi);var Sv=function(r){Z(n,r);function n(e,t){var a=r.call(this)||this;return a.parentTask=e,a.input=t,a}return n}(Fn);var Ua=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t;return Q(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,Xr(e,this.input,function(i){return Promise.all(i.map(function(o){return ct.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return t=a.sent(),[2,t.map(function(i,o){return rl(e[o],i)})]}})})},n.prototype.withFaceExpressions=function(){return new La(this,this.input)},n.prototype.withAgeAndGender=function(){return new Wa(this,this.input)},n}(Sv);var Ha=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t;return Q(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,Pa(e,this.input,function(i){return ct.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=a.sent(),[2,rl(e,t)]}})})},n.prototype.withFaceExpressions=function(){return new Va(this,this.input)},n.prototype.withAgeAndGender=function(){return new za(this,this.input)},n}(Sv);var Av=function(r){Z(n,r);function n(e,t,a){var i=r.call(this)||this;return i.parentTask=e,i.input=t,i.useTinyLandmarkNet=a,i}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ct.faceLandmark68TinyNet:ct.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(Fn);var Iv=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a,i,o,s=this;return Q(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),t=e.map(function(c){return c.detection}),this.input instanceof Pe?[4,Oi(this.input,t)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Pi(this.input,t)];case 4:i=u.sent(),u.label=5;case 5:return a=i,[4,Promise.all(a.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return o=u.sent(),a.forEach(function(c){return c instanceof Pe&&c.dispose()}),[2,e.map(function(c,l){return Ma(c,o[l])})]}})})},n.prototype.withFaceExpressions=function(){return new La(this,this.input)},n.prototype.withAgeAndGender=function(){return new Wa(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ua(this,this.input)},n}(Av);var Rv=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a,i,o;return Q(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?(t=e.detection,this.input instanceof Pe?[4,Oi(this.input,[t])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Pi(this.input,[t])];case 4:i=s.sent(),s.label=5;case 5:return a=i,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return o=s.sent(),a.forEach(function(u){return u instanceof Pe&&u.dispose()}),[2,Ma(e,o)]}})})},n.prototype.withFaceExpressions=function(){return new Va(this,this.input)},n.prototype.withAgeAndGender=function(){return new za(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Ha(this,this.input)},n}(Av);var Tv=function(r){Z(n,r);function n(e,t){t===void 0&&(t=new Cr);var a=r.call(this)||this;return a.input=e,a.options=t,a}return n}(Fn);var cl=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t,a,i;return Q(this,function(o){switch(o.label){case 0:return e=this,t=e.input,a=e.options,a instanceof zi?[4,ct.mtcnn.forward(t,a)]:[3,2];case 1:return[2,o.sent().map(function(s){return s.detection})];case 2:if(i=a instanceof dv?function(s){return ct.tinyFaceDetector.locateFaces(s,a)}:a instanceof Cr?function(s){return ct.ssdMobilenetv1.locateFaces(s,a)}:a instanceof Kr?function(s){return ct.tinyYolov2.locateFaces(s,a)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(t)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return $(e,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return a=i.sent(),[2,t(a.map(function(o){return Sa({},o)}))]}})})})},n.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Iv(this.runAndExtendWithFaceDetections(),this.input,e)},n.prototype.withFaceExpressions=function(){return new Gi(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new qi(this.runAndExtendWithFaceDetections(),this.input)},n}(Tv);var w_=function(r){Z(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return $(this,void 0,void 0,function(){var e,t;return Q(this,function(a){switch(a.label){case 0:return[4,new cl(this.input,this.options)];case 1:return e=a.sent(),t=e[0],e.forEach(function(i){i.score>t.score&&(t=i)}),[2,t]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return $(e,void 0,void 0,function(){var a;return Q(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return a=i.sent(),[2,t(a?Sa({},a):void 0)]}})})})},n.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Rv(this.runAndExtendWithFaceDetection(),this.input,e)},n.prototype.withFaceExpressions=function(){return new ji(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Yi(this.runAndExtendWithFaceDetection(),this.input)},n}(Tv);function ll(r,n){return n===void 0&&(n=new Cr),new cl(r,n)}function Fv(r,n){if(r.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(r),t=Array.from(n);return Math.sqrt(e.map(function(a,i){return a-t[i]}).reduce(function(a,i){return a+Math.pow(i,2)},0))}var NM=function(){function r(n,e){e===void 0&&(e=.6),this._distanceThreshold=e;var t=Array.isArray(n)?n:[n];if(!t.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,i=function(){return"person "+a++};this._labeledDescriptors=t.map(function(o){if(o instanceof Fi)return o;if(o instanceof Float32Array)return new Fi(i(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new Fi(i(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(n,e){return e.map(function(t){return Fv(t,n)}).reduce(function(t,a){return t+a},0)/(e.length||1)},r.prototype.matchDescriptor=function(n){var e=this;return this.labeledDescriptors.map(function(t){var a=t.descriptors,i=t.label;return new Wc(i,e.computeMeanDistance(n,a))}).reduce(function(t,a){return t.distance<a.distance?t:a})},r.prototype.findBestMatch=function(n){var e=this.matchDescriptor(n);return e.distance<this.distanceThreshold?e:new Wc("unknown",e.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},r.fromJSON=function(n){var e=n.labeledDescriptors.map(function(t){return Fi.fromJSON(t)});return new r(e,n.distanceThreshold)},r}();var E_=["fileInput"];function D_(r,n){r&1&&(M(0,"div",43)(1,"div",44),Y(2,"Checking Human"),N()())}function k_(r,n){r&1&&(M(0,"div",45),Ka(),M(1,"svg",46),ee(2,"path",47)(3,"polyline",48),N(),Y(4,"Verified humain photo"),N())}function S_(r,n){r&1&&(M(0,"div",49),Y(1," Not verified as humain "),N())}var Mv=(()=>{let n=class n{constructor(t){this.userService=t,this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1,this.user={},this.uploadedImageUrl="",this.modelUrl="https://justadudewhohacks.github.io/face-api.js/models/ssd_mobilenetv1_model-weights_manifest.json"}ngOnInit(){this.getUserProfile()}getUserProfile(){return nn(this,null,function*(){let t=yield localStorage.getItem("user");if(t){let i=JSON.parse(t).email;this.userService.getUserByEmail(i).subscribe(o=>{this.user=o})}})}updateProfileImage(){return nn(this,null,function*(){yield this.userService.uploadProfileImage(this.user.email,this.uploadedImageUrl).subscribe(()=>{this.user.image=this.uploadedImageUrl,this.uploadedImageUrl="",this.verifiedImageHumain=!1,this.NotVerifedHumain=!1,this.displayStatusImage=!1},t=>{})})}onFileSelected(t){return nn(this,null,function*(){let a=t.target.files[0];if(a){let i=new FormData;i.append("image",a),this.userService.uploadImage(i).subscribe(o=>nn(this,null,function*(){this.uploadedImageUrl=o.url,this.displayStatusImage=!0,yield this.detectFaces(o.url)}),o=>{})}})}detectFaces(t){return nn(this,null,function*(){yield ct.ssdMobilenetv1.loadFromUri(this.modelUrl);let a=yield km(t),i=yield ll(a);this.displayStatusImage=!1,i.length>0?(this.verifiedImageHumain=!0,this.NotVerifedHumain=!1):(this.NotVerifedHumain=!0,this.verifiedImageHumain=!1)})}};n.\u0275fac=function(a){return new(a||n)(oe(ir))},n.\u0275cmp=Ie({type:n,selectors:[["app-profile"]],viewQuery:function(a,i){if(a&1&&on(E_,5),a&2){let o;qt(o=Yt())&&(i.fileInput=o.first)}},decls:71,vars:16,consts:[[1,"h-100","gradient-custom-2"],[1,"container","py-5","h-100"],[1,"row","d-flex","justify-content-center","align-items-center","h-100"],[1,"col","col-lg-9","col-xl-7"],[1,"card"],[1,"rounded-top","text-white","d-flex","flex-row",2,"background-color","#000","height","200px"],[1,"ms-4","mt-5","d-flex","flex-column",2,"width","150px","height","150px"],["alt","Generic placeholder image",1,"img-fluid","img-thumbnail","mt-4","mb-2",2,"width","150px","height","150px","object-fit","cover","z-index","1",3,"src"],["type","button","data-mdb-button-init","","data-mdb-ripple-init","","data-mdb-ripple-color","dark","data-toggle","modal","data-target","#exampleModal",1,"btn","btn-outline-dark",2,"z-index","1"],[1,"ms-3",2,"margin-top","130px"],[1,"p-4","text-black",2,"background-color","#f8f9fa"],[1,"d-flex","justify-content-end","text-center","py-1"],[1,"mb-1","h5"],[1,"small","text-muted","mb-0"],[1,"px-3"],[1,"card-body","p-4","text-black"],[1,"mb-5"],[1,"lead","fw-normal","mb-1"],[1,"p-4",2,"margin-bottom","10px"],[1,"font-italic","mb-1"],[1,"font-italic","mb-0"],["id","exampleModal","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"flex","justify-center","h-screen","items-center","px-3"],[1,"rounded-lg","shadow-xl","bg-gray-50","md:w-1/2","w-[360px]"],[1,"m-4"],[1,"flex","items-center","justify-center","w-full"],[1,"flex","cursor-pointer","flex-col","w-full","h-32","border-2","rounded-md","border-dashed","hover:bg-gray-100","hover:border-gray-300"],[1,"flex","flex-col","items-center","justify-center","pt-7"],["width","370","height","320",3,"src"],["type","file",1,"opacity-0",3,"change"],["fileInput",""],["class","progress",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["data-dismiss","modal","type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"progress"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated",2,"width","100%"],[1,"alert","alert-success"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"feather","feather-check-circle"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["role","alert",1,"alert","alert-danger"]],template:function(a,i){a&1&&(M(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),ee(7,"img",7),M(8,"button",8),Y(9," Upload image "),N()(),M(10,"div",9)(11,"h5"),Y(12),N(),M(13,"p"),Y(14),N()()(),M(15,"div",10)(16,"div",11)(17,"div")(18,"p",12),Y(19,"N/A"),N(),M(20,"p",13),Y(21,"Projects"),N()(),M(22,"div",14)(23,"p",12),Y(24,"N/A"),N(),M(25,"p",13),Y(26,"Tasks"),N()()()(),M(27,"div",15)(28,"div",16)(29,"p",17),Y(30,"Personal Information"),N(),M(31,"div",18)(32,"p",19),Y(33),N(),M(34,"p",19),Y(35),N(),M(36,"p",20),Y(37),N(),M(38,"p",19),Y(39),N(),M(40,"p",19),Y(41),N(),M(42,"p",19),Y(43),N(),M(44,"p",19),Y(45),N(),M(46,"div",21)(47,"div",22)(48,"div",23)(49,"div",24)(50,"button",25)(51,"span",26),Y(52,"\xD7"),N()()(),M(53,"div",27)(54,"div",28)(55,"div",29)(56,"div",30)(57,"div",31)(58,"label",32)(59,"div",33),ee(60,"img",34),N(),M(61,"input",35,36),me("change",function(s){return i.onFileSelected(s)}),N()(),ze(63,D_,3,0,"div",37)(64,k_,5,0,"div",38),N(),ze(65,S_,2,0,"div",39),N()()()(),M(66,"div",40)(67,"button",41),Y(68,"Close"),N(),M(69,"button",42),me("click",function(){return i.updateProfileImage()}),Y(70,"Update image"),N()()()()()()()()()()()()()),a&2&&(X(7),ue("src",i.user.image!==""?i.user.image:"../assets/images/profile.jpg",Gs),X(5),Ql("",i.user.firstname," ",i.user.lastname,""),X(2),vt(i.user.job),X(19),ot("Firstname: ",i.user.firstname,""),X(2),ot("Lastname: ",i.user.lastname,""),X(2),ot("Email: ",i.user.email,""),X(2),ot("Phone: ",i.user.number,""),X(2),ot("Address: ",i.user.address,""),X(2),ot("Age: ",i.user.number,""),X(2),ot("Degree: ",i.user.degree,""),X(15),ue("src",i.uploadedImageUrl||"https://cdn.pixabay.com/photo/2017/02/07/02/16/cloud-2044823_960_720.png",Gs),X(3),ue("ngIf",i.displayStatusImage),X(),ue("ngIf",i.verifiedImageHumain),X(),ue("ngIf",i.NotVerifedHumain),X(4),ue("disabled",!i.verifiedImageHumain))},dependencies:[Kt],styles:[".gradient-custom-2[_ngcontent-%COMP%]{background:#fbc2eb;background:-webkit-linear-gradient(to right,rgba(251,194,235,1),rgba(166,193,238,1));background:linear-gradient(to right,#fbc2eb,#a6c1ee)}"]});let r=n;return r})();function A_(r,n){if(r&1&&(M(0,"div",15),Y(1),N()),r&2){let e=fe();X(),vt(e.errorMessage)}}var Nv=(()=>{let n=class n{constructor(t,a,i,o){this.authService=t,this.encryptionService=a,this.router=i,this.userService=o,this.authResponse={},this.status="",this.formRequest=new na({code:new kr("",[Dr.required])})}ngOnInit(){return nn(this,null,function*(){let t=yield localStorage.getItem("code");if(t){let a=JSON.parse(t);this.method=a.method,this.email=a.email}yield this.sendCode()})}timer(){let a=Rl(0,1e3).pipe(Ws(i=>120-i),Ml(i=>i>=0));this.countdown=a.pipe(Ws(i=>{let o=Math.floor(i/60),s=i%60;return`${this.pad(o)}:${this.pad(s)}`}))}pad(t){return t<10?`0${t}`:`${t}`}sendVerificationCode(t){this.method=="sms"&&this.authService.sendVerificationCode(t).subscribe(a=>{},a=>{}),this.method=="mail"&&this.authService.sendVerificationCodeMail(t).subscribe(a=>{},a=>{})}sendCode(){return nn(this,null,function*(){this.timer(),this.sendVerificationCode(this.email)})}resend(){this.sendCode()}verify(){this.formRequest.valid&&this.authService.verifyCode(this.formRequest.value.code.toString(),this.email).subscribe({next:t=>{this.authResponse=t,localStorage.setItem("token",t.access_token),this.userService.getUser(this.email).subscribe({next:a=>{let i={firstname:a.firstname,lastname:a.lastname,email:a.email},o=this.encryptionService.encrypt(JSON.stringify(a.authorities),"2f7");localStorage.setItem("authorities",o),localStorage.setItem("user",JSON.stringify(i)),this.router.navigate(["/home"])},error:a=>{}})},error:t=>{this.errorMessage="Invalid code"}})}isValidCode(){let t=this.formRequest.value.code;return t&&t.toString().length===6}};n.\u0275fac=function(a){return new(a||n)(oe(ia),oe(ar),oe(Xt),oe(ir))},n.\u0275cmp=Ie({type:n,selectors:[["app-sendcode"]],decls:26,vars:7,consts:[[1,"auth-wrapper"],[1,"auth-content"],[1,"auth-bg"],[1,"r"],[1,"r","s"],[1,"card"],[1,"card-body","text-center"],[1,"mb-4"],[1,"feather","icon-settings","auth-icon"],[3,"formGroup","ngSubmit"],[3,"click"],[1,"input-group","mb-3"],["type","number","placeholder","code","formControlName","code","required","",1,"form-control"],["type","submit",1,"btn","btn-primary","mb-4","shadow-2",3,"disabled"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"]],template:function(a,i){a&1&&(M(0,"div",0)(1,"div",1)(2,"div",2),ee(3,"span",3)(4,"span",4)(5,"span",4)(6,"span",3),N(),M(7,"div",5)(8,"div",6)(9,"div",7),ee(10,"i",8),N(),M(11,"form",9),me("ngSubmit",function(){return i.verify()}),M(12,"h3",7),Y(13,"We sent you a verification code"),N(),M(14,"h5",7),Y(15),M(16,"a",10),me("click",function(){return i.resend()}),Y(17,"Resend?"),N()(),M(18,"p"),Y(19),td(20,"async"),N(),M(21,"div",11),ee(22,"input",12),N(),M(23,"button",13),Y(24,"Verify"),N(),ze(25,A_,2,1,"div",14),N()()()()()),a&2&&(X(11),ue("formGroup",i.formRequest),X(4),ot("Please verifiy your ",i.method,"."),X(4),ot("Time left: ",nd(20,5,i.countdown),""),X(4),ue("disabled",!i.isValidCode()),X(2),ue("ngIf",i.errorMessage))},dependencies:[Kt,ur,or,gd,Cn,sr,cr,ra,aa,id]});let r=n;return r})();var I_=[{path:"",component:uu},{path:"login",component:uu},{path:"sendcode",component:Nv},{path:"resetpassword",component:Ud},{path:"newpassword",component:Hd},{path:"emailsended",component:Gd},{path:"notfound",component:cu},{path:"home",component:Xd,canActivate:[jd],children:[{path:"profile",component:Mv},{path:"users",loadChildren:()=>import("./chunk-PSYPVGM2.js").then(r=>r.UserModule)},{path:"roles",loadChildren:()=>import("./chunk-KXF6QG2E.js").then(r=>r.RoleModule)},{path:"config",loadChildren:()=>import("./chunk-6FS4SZ63.js").then(r=>r.ConfigManagementModule)},{path:"holiday",loadChildren:()=>import("./chunk-MJG7J77V.js").then(r=>r.HolidayManagementModule)},{path:"attendance",loadChildren:()=>import("./chunk-7VXRTI2R.js").then(r=>r.AttendanceManagementModule)},{path:"tasks",loadChildren:()=>import("./chunk-FMD2D7BV.js").then(r=>r.TaskManagementModule)},{path:"projects",loadChildren:()=>import("./chunk-TVJD56AC.js").then(r=>r.ProjectManagementModule)},{path:"payroll",loadChildren:()=>import("./chunk-SDSH5V5O.js").then(r=>r.PayrollManagementModule)},{path:"allowance",loadChildren:()=>import("./chunk-T2K76Z4F.js").then(r=>r.AllowanceRoutingModule)}]},{path:"**",component:cu}],Pv=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=Zn({type:n}),n.\u0275inj=er({imports:[$s.forRoot(I_),$s]});let r=n;return r})();var Ov=(()=>{let n=class n{ngOnInit(){}};n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=Ie({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(a,i){a&1&&ee(0,"router-outlet")},dependencies:[uo]});let r=n;return r})();var R_="@",T_=(()=>{let n=class n{constructor(t,a,i,o,s){this.doc=t,this.delegate=a,this.zone=i,this.animationType=o,this.moduleImpl=s,this._rendererFactoryPromise=null,this.scheduler=Xa(Gl,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-Y63LFA5K.js")).catch(a=>{throw new Nl(5300,!1)}).then(({\u0275createEngine:a,\u0275AnimationRendererFactory:i})=>{this._engine=a(this.animationType,this.doc,this.scheduler);let o=new i(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(t,a){let i=this.delegate.createRenderer(t,a);if(i.\u0275type===0)return i;typeof i.throwOnSyntheticProps=="boolean"&&(i.throwOnSyntheticProps=!1);let o=new dl(i);return a?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(s=>{let u=s.createRenderer(t,a);o.use(u)}).catch(s=>{o.use(i)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};n.\u0275fac=function(a){eo()},n.\u0275prov=Ct({token:n,factory:n.\u0275fac});let r=n;return r})(),dl=class{constructor(n){this.delegate=n,this.replay=[],this.\u0275type=1}use(n){if(this.delegate=n,this.replay!==null){for(let e of this.replay)e(n);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(n,e){return this.delegate.createElement(n,e)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}get destroyNode(){return this.delegate.destroyNode}appendChild(n,e){this.delegate.appendChild(n,e)}insertBefore(n,e,t,a){this.delegate.insertBefore(n,e,t,a)}removeChild(n,e,t){this.delegate.removeChild(n,e,t)}selectRootElement(n,e){return this.delegate.selectRootElement(n,e)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,e,t,a){this.delegate.setAttribute(n,e,t,a)}removeAttribute(n,e,t){this.delegate.removeAttribute(n,e,t)}addClass(n,e){this.delegate.addClass(n,e)}removeClass(n,e){this.delegate.removeClass(n,e)}setStyle(n,e,t,a){this.delegate.setStyle(n,e,t,a)}removeStyle(n,e,t){this.delegate.removeStyle(n,e,t)}setProperty(n,e,t){this.shouldReplay(e)&&this.replay.push(a=>a.setProperty(n,e,t)),this.delegate.setProperty(n,e,t)}setValue(n,e){this.delegate.setValue(n,e)}listen(n,e,t){return this.shouldReplay(e)&&this.replay.push(a=>a.listen(n,e,t)),this.delegate.listen(n,e,t)}shouldReplay(n){return this.replay!==null&&n.startsWith(R_)}};function Bv(r="animations"){return ql("NgAsyncAnimations"),Ul([{provide:jl,useFactory:(n,e,t)=>new T_(n,e,t,r),deps:[Ks,ld,to]},{provide:Ll,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var Lv=(()=>{let n=class n{constructor(t){this.platformId=t}intercept(t,a){if(od(this.platformId)){let i=localStorage.getItem("token");if(i){let o=t.clone({setHeaders:{Authorization:`Bearer ${i}`}});return a.handle(o).pipe(Tl(s=>Il(s)))}}return a.handle(t)}};n.\u0275fac=function(a){return new(a||n)(Vt(Bl))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac});let r=n;return r})();var M_=["mat-calendar-body",""];function N_(r,n){if(r&1&&(M(0,"tr",0)(1,"td",2),Y(2),N()()),r&2){let e=fe();X(),bn("padding-top",e._cellPadding)("padding-bottom",e._cellPadding),rn("colspan",e.numCols),X(),ot(" ",e.label," ")}}function P_(r,n){if(r&1&&(M(0,"td",2),Y(1),N()),r&2){let e=fe(2);bn("padding-top",e._cellPadding)("padding-bottom",e._cellPadding),rn("colspan",e._firstRowOffset),X(),ot(" ",e._firstRowOffset>=e.labelMinRequiredCells?e.label:""," ")}}function O_(r,n){if(r&1){let e=an();M(0,"td",5)(1,"button",6),me("click",function(a){let o=Je(e).$implicit,s=fe(2);return Ze(s._cellClicked(o,a))})("focus",function(a){let o=Je(e).$implicit,s=fe(2);return Ze(s._emitActiveDateChange(o,a))}),M(2,"span",7),Y(3),N(),ee(4,"span",8),N()()}if(r&2){let e=n.$implicit,t=n.$index,a=fe().$index,i=fe();bn("width",i._cellWidth)("padding-top",i._cellPadding)("padding-bottom",i._cellPadding),rn("data-mat-row",a)("data-mat-col",t),X(),nr("mat-calendar-body-disabled",!e.enabled)("mat-calendar-body-active",i._isActiveCell(a,t))("mat-calendar-body-range-start",i._isRangeStart(e.compareValue))("mat-calendar-body-range-end",i._isRangeEnd(e.compareValue))("mat-calendar-body-in-range",i._isInRange(e.compareValue))("mat-calendar-body-comparison-bridge-start",i._isComparisonBridgeStart(e.compareValue,a,t))("mat-calendar-body-comparison-bridge-end",i._isComparisonBridgeEnd(e.compareValue,a,t))("mat-calendar-body-comparison-start",i._isComparisonStart(e.compareValue))("mat-calendar-body-comparison-end",i._isComparisonEnd(e.compareValue))("mat-calendar-body-in-comparison-range",i._isInComparisonRange(e.compareValue))("mat-calendar-body-preview-start",i._isPreviewStart(e.compareValue))("mat-calendar-body-preview-end",i._isPreviewEnd(e.compareValue))("mat-calendar-body-in-preview",i._isInPreview(e.compareValue)),ue("ngClass",e.cssClasses)("tabindex",i._isActiveCell(a,t)?0:-1),rn("aria-label",e.ariaLabel)("aria-disabled",!e.enabled||null)("aria-pressed",i._isSelected(e.compareValue))("aria-current",i.todayValue===e.compareValue?"date":null)("aria-describedby",i._getDescribedby(e.compareValue)),X(),nr("mat-calendar-body-selected",i._isSelected(e.compareValue))("mat-calendar-body-comparison-identical",i._isComparisonIdentical(e.compareValue))("mat-calendar-body-today",i.todayValue===e.compareValue),X(),ot(" ",e.displayValue," ")}}function B_(r,n){if(r&1&&(M(0,"tr",3),ze(1,P_,2,6,"td",4),ro(2,O_,5,48,"td",9,no),N()),r&2){let e=n.$implicit,t=n.$index,a=fe();X(),Qa(1,t===0&&a._firstRowOffset?1:-1),X(),ao(e)}}function L_(r,n){if(r&1&&(M(0,"th",5)(1,"span",6),Y(2),N(),M(3,"span",2),Y(4),N()()),r&2){let e=n.$implicit;X(2),vt(e.long),X(2),vt(e.narrow)}}var V_=["*"];function W_(r,n){}function z_(r,n){if(r&1){let e=an();M(0,"mat-month-view",2),wn("activeDateChange",function(a){Je(e);let i=fe();return _n(i.activeDate,a)||(i.activeDate=a),Ze(a)}),me("_userSelection",function(a){Je(e);let i=fe();return Ze(i._dateSelected(a))})("dragStarted",function(a){Je(e);let i=fe();return Ze(i._dragStarted(a))})("dragEnded",function(a){Je(e);let i=fe();return Ze(i._dragEnded(a))}),N()}if(r&2){let e=fe();xn("activeDate",e.activeDate),ue("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)("comparisonStart",e.comparisonStart)("comparisonEnd",e.comparisonEnd)("startDateAccessibleName",e.startDateAccessibleName)("endDateAccessibleName",e.endDateAccessibleName)("activeDrag",e._activeDrag)}}function U_(r,n){if(r&1){let e=an();M(0,"mat-year-view",3),wn("activeDateChange",function(a){Je(e);let i=fe();return _n(i.activeDate,a)||(i.activeDate=a),Ze(a)}),me("monthSelected",function(a){Je(e);let i=fe();return Ze(i._monthSelectedInYearView(a))})("selectedChange",function(a){Je(e);let i=fe();return Ze(i._goToDateInView(a,"month"))}),N()}if(r&2){let e=fe();xn("activeDate",e.activeDate),ue("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)}}function H_(r,n){if(r&1){let e=an();M(0,"mat-multi-year-view",4),wn("activeDateChange",function(a){Je(e);let i=fe();return _n(i.activeDate,a)||(i.activeDate=a),Ze(a)}),me("yearSelected",function(a){Je(e);let i=fe();return Ze(i._yearSelectedInMultiYearView(a))})("selectedChange",function(a){Je(e);let i=fe();return Ze(i._goToDateInView(a,"year"))}),N()}if(r&2){let e=fe();xn("activeDate",e.activeDate),ue("selected",e.selected)("dateFilter",e.dateFilter)("maxDate",e.maxDate)("minDate",e.minDate)("dateClass",e.dateClass)}}function G_(r,n){}var j_=["button"];function q_(r,n){r&1&&(Ka(),M(0,"svg",3),ee(1,"path",4),N())}var Y_=[[["","matDatepickerToggleIcon",""]]],K_=["[matDatepickerToggleIcon]"];var $i=(()=>{let n=class n{constructor(){this.changes=new Ya,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(t,a){return`${t} \u2013 ${a}`}formatYearRangeLabel(t,a){return`${t} to ${a}`}};n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=Ct({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})(),Xi=class{constructor(n,e,t,a,i={},o=n,s){this.value=n,this.displayValue=e,this.ariaLabel=t,this.enabled=a,this.cssClasses=i,this.compareValue=o,this.rawValue=s}},X_=1,Vv=ho({passive:!1,capture:!0}),Er=ho({passive:!0,capture:!0}),Fs=ho({passive:!0}),qa=(()=>{let n=class n{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(t,a){this._elementRef=t,this._ngZone=a,this._platform=Xa(bd),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new je,this.previewChange=new je,this.activeDateChange=new je,this.dragStarted=new je,this.dragEnded=new je,this._didDragSinceMouseDown=!1,this._enterHandler=i=>{if(this._skipNextFocus&&i.type==="focus"){this._skipNextFocus=!1;return}if(i.target&&this.isRange){let o=this._getCellFromElement(i.target);o&&this._ngZone.run(()=>this.previewChange.emit({value:o.enabled?o:null,event:i}))}},this._touchmoveHandler=i=>{if(!this.isRange)return;let o=Wv(i),s=o?this._getCellFromElement(o):null;o!==i.target&&(this._didDragSinceMouseDown=!0),hl(i.target)&&i.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:s?.enabled?s:null,event:i}))},this._leaveHandler=i=>{this.previewEnd!==null&&this.isRange&&(i.type!=="blur"&&(this._didDragSinceMouseDown=!0),i.target&&this._getCellFromElement(i.target)&&!(i.relatedTarget&&this._getCellFromElement(i.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:i})))},this._mousedownHandler=i=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let o=i.target&&this._getCellFromElement(i.target);!o||!this._isInRange(o.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:o.rawValue,event:i})})},this._mouseupHandler=i=>{if(!this.isRange)return;let o=hl(i.target);if(!o){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:i})});return}o.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let s=this._getCellFromElement(o);this.dragEnded.emit({value:s?.rawValue??null,event:i})})},this._touchendHandler=i=>{let o=Wv(i);o&&this._mouseupHandler({target:o})},this._id=`mat-calendar-body-${X_++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,a.runOutsideAngular(()=>{let i=t.nativeElement;i.addEventListener("touchmove",this._touchmoveHandler,Vv),i.addEventListener("mouseenter",this._enterHandler,Er),i.addEventListener("focus",this._enterHandler,Er),i.addEventListener("mouseleave",this._leaveHandler,Er),i.addEventListener("blur",this._leaveHandler,Er),i.addEventListener("mousedown",this._mousedownHandler,Fs),i.addEventListener("touchstart",this._mousedownHandler,Fs),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(t,a){this._didDragSinceMouseDown||t.enabled&&this.selectedValueChange.emit({value:t.value,event:a})}_emitActiveDateChange(t,a){t.enabled&&this.activeDateChange.emit({value:t.value,event:a})}_isSelected(t){return this.startValue===t||this.endValue===t}ngOnChanges(t){let a=t.numCols,{rows:i,numCols:o}=this;(t.rows||a)&&(this._firstRowOffset=i&&i.length&&i[0].length?o-i[0].length:0),(t.cellAspectRatio||a||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/o}%`),(a||!this._cellWidth)&&(this._cellWidth=`${100/o}%`)}ngOnDestroy(){let t=this._elementRef.nativeElement;t.removeEventListener("touchmove",this._touchmoveHandler,Vv),t.removeEventListener("mouseenter",this._enterHandler,Er),t.removeEventListener("focus",this._enterHandler,Er),t.removeEventListener("mouseleave",this._leaveHandler,Er),t.removeEventListener("blur",this._leaveHandler,Er),t.removeEventListener("mousedown",this._mousedownHandler,Fs),t.removeEventListener("touchstart",this._mousedownHandler,Fs),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(t,a){let i=t*this.numCols+a;return t&&(i-=this._firstRowOffset),i==this.activeCell}_focusActiveCell(t=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Fl(1)).subscribe(()=>{setTimeout(()=>{let a=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");a&&(t||(this._skipNextFocus=!0),a.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(t){return fl(t,this.startValue,this.endValue)}_isRangeEnd(t){return ml(t,this.startValue,this.endValue)}_isInRange(t){return vl(t,this.startValue,this.endValue,this.isRange)}_isComparisonStart(t){return fl(t,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(t,a,i){if(!this._isComparisonStart(t)||this._isRangeStart(t)||!this._isInRange(t))return!1;let o=this.rows[a][i-1];if(!o){let s=this.rows[a-1];o=s&&s[s.length-1]}return o&&!this._isRangeEnd(o.compareValue)}_isComparisonBridgeEnd(t,a,i){if(!this._isComparisonEnd(t)||this._isRangeEnd(t)||!this._isInRange(t))return!1;let o=this.rows[a][i+1];if(!o){let s=this.rows[a+1];o=s&&s[0]}return o&&!this._isRangeStart(o.compareValue)}_isComparisonEnd(t){return ml(t,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(t){return vl(t,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(t){return this.comparisonStart===this.comparisonEnd&&t===this.comparisonStart}_isPreviewStart(t){return fl(t,this.previewStart,this.previewEnd)}_isPreviewEnd(t){return ml(t,this.previewStart,this.previewEnd)}_isInPreview(t){return vl(t,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(t){return this.isRange?this.startValue===t&&this.endValue===t?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===t?this._startDateLabelId:this.endValue===t?this._endDateLabelId:null:null}_getCellFromElement(t){let a=hl(t);if(a){let i=a.getAttribute("data-mat-row"),o=a.getAttribute("data-mat-col");if(i&&o)return this.rows[parseInt(i)][parseInt(o)]}return null}};n.\u0275fac=function(a){return new(a||n)(oe(Us),oe(to))},n.\u0275cmp=Ie({type:n,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[$a,On],attrs:M_,decls:7,vars:5,consts:[["aria-hidden","true"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"]],template:function(a,i){a&1&&(ze(0,N_,3,6,"tr",0),ro(1,B_,4,1,"tr",3,no),M(3,"label",1),Y(4),N(),M(5,"label",1),Y(6),N()),a&2&&(Qa(0,i._firstRowOffset<i.labelMinRequiredCells?0:-1),X(),ao(i.rows),X(2),ue("id",i._startDateLabelId),X(),ot(" ",i.startDateAccessibleName,`
`),X(),ue("id",i._endDateLabelId),X(),ot(" ",i.endDateAccessibleName,`
`))},dependencies:[io],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let r=n;return r})();function pl(r){return r?.nodeName==="TD"}function hl(r){let n;return pl(r)?n=r:pl(r.parentNode)?n=r.parentNode:pl(r.parentNode?.parentNode)&&(n=r.parentNode.parentNode),n?.getAttribute("data-mat-row")!=null?n:null}function fl(r,n,e){return e!==null&&n!==e&&r<e&&r===n}function ml(r,n,e){return n!==null&&n!==e&&r>=n&&r===e}function vl(r,n,e,t){return t&&n!==null&&e!==null&&n!==e&&r>=n&&r<=e}function Wv(r){let n=r.changedTouches[0];return document.elementFromPoint(n.clientX,n.clientY)}var tn=class{constructor(n,e){this.start=n,this.end=e}},Ms=(()=>{let n=class n{constructor(t,a){this.selection=t,this._adapter=a,this._selectionChanged=new Ya,this.selectionChanged=this._selectionChanged,this.selection=t}updateSelection(t,a){let i=this.selection;this.selection=t,this._selectionChanged.next({selection:t,source:a,oldValue:i})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(t){return this._adapter.isDateInstance(t)&&this._adapter.isValid(t)}};n.\u0275fac=function(a){eo()},n.\u0275prov=Ct({token:n,factory:n.\u0275fac});let r=n;return r})(),$_=(()=>{let n=class n extends Ms{constructor(t){super(null,t)}add(t){super.updateSelection(t,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let t=new n(this._adapter);return t.updateSelection(this.selection,this),t}};n.\u0275fac=function(a){return new(a||n)(Vt(En))},n.\u0275prov=Ct({token:n,factory:n.\u0275fac});let r=n;return r})();function Q_(r,n){return r||new $_(n)}var J_={provide:Ms,deps:[[new Wl,new zl,Ms],En],useFactory:Q_};var jv=new Hs("MAT_DATE_RANGE_SELECTION_STRATEGY");var gl=7,zv=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(t){let a=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._hasSameMonthAndYear(a,this._activeDate)||this._init()}get selected(){return this._selected}set selected(t){t instanceof tn?this._selected=t:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}constructor(t,a,i,o,s){this._changeDetectorRef=t,this._dateFormats=a,this._dateAdapter=i,this._dir=o,this._rangeStrategy=s,this._rerenderSubscription=ea.EMPTY,this.activeDrag=null,this.selectedChange=new je,this._userSelection=new je,this.dragStarted=new je,this.dragEnded=new je,this.activeDateChange=new je,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ji(null)).subscribe(()=>this._init())}ngOnChanges(t){let a=t.comparisonStart||t.comparisonEnd;a&&!a.firstChange&&this._setRanges(this.selected),t.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(t){let a=t.value,i=this._getDateFromDayOfMonth(a),o,s;this._selected instanceof tn?(o=this._getDateInCurrentMonth(this._selected.start),s=this._getDateInCurrentMonth(this._selected.end)):o=s=this._getDateInCurrentMonth(this._selected),(o!==a||s!==a)&&this.selectedChange.emit(i),this._userSelection.emit({value:i,event:t.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(t){let a=t.value,i=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(a),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(t){let a=this._activeDate,i=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&t.preventDefault();return;case 27:this._previewEnd!=null&&!xd(t)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:t}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:t})),t.preventDefault(),t.stopPropagation());return;default:return}this._dateAdapter.compareDate(a,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),t.preventDefault()}_handleCalendarBodyKeyup(t){(t.keyCode===32||t.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(gl+this._dateAdapter.getDayOfWeek(t)-this._dateAdapter.getFirstDayOfWeek())%gl,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(t){this._matCalendarBody._focusActiveCell(t)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:t,value:a}){if(this._rangeStrategy){let i=a?a.rawValue:null,o=this._rangeStrategy.createPreview(i,this.selected,t);if(this._previewStart=this._getCellCompareValue(o.start),this._previewEnd=this._getCellCompareValue(o.end),this.activeDrag&&i){let s=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,i,t);s&&(this._previewStart=this._getCellCompareValue(s.start),this._previewEnd=this._getCellCompareValue(s.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(t){if(this.activeDrag)if(t.value){let a=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,t.value,t.event);this.dragEnded.emit({value:a??null,event:t.event})}else this.dragEnded.emit({value:null,event:t.event})}_getDateFromDayOfMonth(t){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t)}_initWeekdays(){let t=this._dateAdapter.getFirstDayOfWeek(),a=this._dateAdapter.getDayOfWeekNames("narrow"),o=this._dateAdapter.getDayOfWeekNames("long").map((s,u)=>({long:s,narrow:a[u]}));this._weekdays=o.slice(t).concat(o.slice(0,t))}_createWeekCells(){let t=this._dateAdapter.getNumDaysInMonth(this.activeDate),a=this._dateAdapter.getDateNames();this._weeks=[[]];for(let i=0,o=this._firstWeekOffset;i<t;i++,o++){o==gl&&(this._weeks.push([]),o=0);let s=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),i+1),u=this._shouldEnableDate(s),c=this._dateAdapter.format(s,this._dateFormats.display.dateA11yLabel),l=this.dateClass?this.dateClass(s,"month"):void 0;this._weeks[this._weeks.length-1].push(new Xi(i+1,a[i],c,u,l,this._getCellCompareValue(s),s))}}_shouldEnableDate(t){return!!t&&(!this.minDate||this._dateAdapter.compareDate(t,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(t,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(t))}_getDateInCurrentMonth(t){return t&&this._hasSameMonthAndYear(t,this.activeDate)?this._dateAdapter.getDate(t):null}_hasSameMonthAndYear(t,a){return!!(t&&a&&this._dateAdapter.getMonth(t)==this._dateAdapter.getMonth(a)&&this._dateAdapter.getYear(t)==this._dateAdapter.getYear(a))}_getCellCompareValue(t){if(t){let a=this._dateAdapter.getYear(t),i=this._dateAdapter.getMonth(t),o=this._dateAdapter.getDate(t);return new Date(a,i,o).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(t){t instanceof tn?(this._rangeStart=this._getCellCompareValue(t.start),this._rangeEnd=this._getCellCompareValue(t.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(t),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(t){return!this.dateFilter||this.dateFilter(t)}_clearPreview(){this._previewStart=this._previewEnd=null}};n.\u0275fac=function(a){return new(a||n)(oe(tr),oe(Ja,8),oe(En,8),oe(fo,8),oe(jv,8))},n.\u0275cmp=Ie({type:n,selectors:[["mat-month-view"]],viewQuery:function(a,i){if(a&1&&on(qa,5),a&2){let o;qt(o=Yt())&&(i._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[$a,On],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"]],template:function(a,i){a&1&&(M(0,"table",0)(1,"thead",1)(2,"tr"),ro(3,L_,5,2,"th",5,no),N(),M(5,"tr",2),ee(6,"th",3),N()(),M(7,"tbody",4),me("selectedValueChange",function(s){return i._dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("previewChange",function(s){return i._previewChanged(s)})("dragStarted",function(s){return i.dragStarted.emit(s)})("dragEnded",function(s){return i._dragEnded(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),N()()),a&2&&(X(3),ao(i._weekdays),X(4),ue("label",i._monthLabel)("rows",i._weeks)("todayValue",i._todayDate)("startValue",i._rangeStart)("endValue",i._rangeEnd)("comparisonStart",i._comparisonRangeStart)("comparisonEnd",i._comparisonRangeEnd)("previewStart",i._previewStart)("previewEnd",i._previewEnd)("isRange",i._isRange)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1)("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName))},dependencies:[qa],encapsulation:2,changeDetection:0});let r=n;return r})(),jt=24,yl=4,Uv=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(t){let a=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),qv(this._dateAdapter,a,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(t){t instanceof tn?this._selected=t:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setSelectedYear(t)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}constructor(t,a,i){this._changeDetectorRef=t,this._dateAdapter=a,this._dir=i,this._rerenderSubscription=ea.EMPTY,this.selectedChange=new je,this.yearSelected=new je,this.activeDateChange=new je,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ji(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let a=this._dateAdapter.getYear(this._activeDate)-Ki(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let i=0,o=[];i<jt;i++)o.push(a+i),o.length==yl&&(this._years.push(o.map(s=>this._createCellForYear(s))),o=[]);this._changeDetectorRef.markForCheck()}_yearSelected(t){let a=t.value,i=this._dateAdapter.createDate(a,0,1),o=this._getDateFromYear(a);this.yearSelected.emit(i),this.selectedChange.emit(o)}_updateActiveDate(t){let a=t.value,i=this._activeDate;this.activeDate=this._getDateFromYear(a),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(t){let a=this._activeDate,i=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-yl);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,yl);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Ki(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,jt-Ki(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-jt*10:-jt);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?jt*10:jt);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(a,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),t.preventDefault()}_handleCalendarBodyKeyup(t){(t.keyCode===32||t.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_getActiveCell(){return Ki(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(t){let a=this._dateAdapter.getMonth(this.activeDate),i=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(t,a,1));return this._dateAdapter.createDate(t,a,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForYear(t){let a=this._dateAdapter.createDate(t,0,1),i=this._dateAdapter.getYearName(a),o=this.dateClass?this.dateClass(a,"multi-year"):void 0;return new Xi(t,i,i,this._shouldEnableYear(t),o)}_shouldEnableYear(t){if(t==null||this.maxDate&&t>this._dateAdapter.getYear(this.maxDate)||this.minDate&&t<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let a=this._dateAdapter.createDate(t,0,1);for(let i=a;this._dateAdapter.getYear(i)==t;i=this._dateAdapter.addCalendarDays(i,1))if(this.dateFilter(i))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(t){if(this._selectedYear=null,t instanceof tn){let a=t.start||t.end;a&&(this._selectedYear=this._dateAdapter.getYear(a))}else t&&(this._selectedYear=this._dateAdapter.getYear(t))}};n.\u0275fac=function(a){return new(a||n)(oe(tr),oe(En,8),oe(fo,8))},n.\u0275cmp=Ie({type:n,selectors:[["mat-multi-year-view"]],viewQuery:function(a,i){if(a&1&&on(qa,5),a&2){let o;qt(o=Yt())&&(i._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[On],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(a,i){a&1&&(M(0,"table",0)(1,"thead",1)(2,"tr"),ee(3,"th",2),N()(),M(4,"tbody",3),me("selectedValueChange",function(s){return i._yearSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),N()()),a&2&&(X(4),ue("rows",i._years)("todayValue",i._todayYear)("startValue",i._selectedYear)("endValue",i._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._getActiveCell()))},dependencies:[qa],encapsulation:2,changeDetection:0});let r=n;return r})();function qv(r,n,e,t,a){let i=r.getYear(n),o=r.getYear(e),s=Yv(r,t,a);return Math.floor((i-s)/jt)===Math.floor((o-s)/jt)}function Ki(r,n,e,t){let a=r.getYear(n);return Z_(a-Yv(r,e,t),jt)}function Yv(r,n,e){let t=0;return e?t=r.getYear(e)-jt+1:n&&(t=r.getYear(n)),t}function Z_(r,n){return(r%n+n)%n}var Hv=(()=>{let n=class n{get activeDate(){return this._activeDate}set activeDate(t){let a=this._activeDate,i=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(i,this.minDate,this.maxDate),this._dateAdapter.getYear(a)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(t){t instanceof tn?this._selected=t:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setSelectedMonth(t)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}constructor(t,a,i,o){this._changeDetectorRef=t,this._dateFormats=a,this._dateAdapter=i,this._dir=o,this._rerenderSubscription=ea.EMPTY,this.selectedChange=new je,this.monthSelected=new je,this.activeDateChange=new je,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Ji(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(t){let a=t.value,i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),a,1);this.monthSelected.emit(i);let o=this._getDateFromMonth(a);this.selectedChange.emit(o)}_updateActiveDate(t){let a=t.value,i=this._activeDate;this.activeDate=this._getDateFromMonth(a),this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(t){let a=this._activeDate,i=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,i?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(a,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),t.preventDefault()}_handleCalendarBodyKeyup(t){(t.keyCode===32||t.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let t=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(a=>a.map(i=>this._createCellForMonth(i,t[i]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(t){return t&&this._dateAdapter.getYear(t)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(t):null}_getDateFromMonth(t){let a=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1),i=this._dateAdapter.getNumDaysInMonth(a);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,Math.min(this._dateAdapter.getDate(this.activeDate),i))}_createCellForMonth(t,a){let i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1),o=this._dateAdapter.format(i,this._dateFormats.display.monthYearA11yLabel),s=this.dateClass?this.dateClass(i,"year"):void 0;return new Xi(t,a.toLocaleUpperCase(),o,this._shouldEnableMonth(t),s)}_shouldEnableMonth(t){let a=this._dateAdapter.getYear(this.activeDate);if(t==null||this._isYearAndMonthAfterMaxDate(a,t)||this._isYearAndMonthBeforeMinDate(a,t))return!1;if(!this.dateFilter)return!0;let i=this._dateAdapter.createDate(a,t,1);for(let o=i;this._dateAdapter.getMonth(o)==t;o=this._dateAdapter.addCalendarDays(o,1))if(this.dateFilter(o))return!0;return!1}_isYearAndMonthAfterMaxDate(t,a){if(this.maxDate){let i=this._dateAdapter.getYear(this.maxDate),o=this._dateAdapter.getMonth(this.maxDate);return t>i||t===i&&a>o}return!1}_isYearAndMonthBeforeMinDate(t,a){if(this.minDate){let i=this._dateAdapter.getYear(this.minDate),o=this._dateAdapter.getMonth(this.minDate);return t<i||t===i&&a<o}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(t){t instanceof tn?this._selectedMonth=this._getMonthInCurrentYear(t.start)||this._getMonthInCurrentYear(t.end):this._selectedMonth=this._getMonthInCurrentYear(t)}};n.\u0275fac=function(a){return new(a||n)(oe(tr),oe(Ja,8),oe(En,8),oe(fo,8))},n.\u0275cmp=Ie({type:n,selectors:[["mat-year-view"]],viewQuery:function(a,i){if(a&1&&on(qa,5),a&2){let o;qt(o=Yt())&&(i._matCalendarBody=o.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[On],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(a,i){a&1&&(M(0,"table",0)(1,"thead",1)(2,"tr"),ee(3,"th",2),N()(),M(4,"tbody",3),me("selectedValueChange",function(s){return i._monthSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),N()()),a&2&&(X(4),ue("label",i._yearLabel)("rows",i._months)("todayValue",i._todayMonth)("startValue",i._selectedMonth)("endValue",i._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._dateAdapter.getMonth(i.activeDate)))},dependencies:[qa],encapsulation:2,changeDetection:0});let r=n;return r})(),ew=1,Kv=(()=>{let n=class n{constructor(t,a,i,o,s){this._intl=t,this.calendar=a,this._dateAdapter=i,this._dateFormats=o,this._id=`mat-calendar-header-${ew++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>s.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-jt)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:jt)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(t,a){return this.calendar.currentView=="month"?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(a)&&this._dateAdapter.getMonth(t)==this._dateAdapter.getMonth(a):this.calendar.currentView=="year"?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(a):qv(this._dateAdapter,t,a,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let a=this._dateAdapter.getYear(this.calendar.activeDate)-Ki(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),i=a+jt-1,o=this._dateAdapter.getYearName(this._dateAdapter.createDate(a,0,1)),s=this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1));return[o,s]}};n.\u0275fac=function(a){return new(a||n)(oe($i),oe(Vl(()=>bl)),oe(En,8),oe(Ja,8),oe(tr))},n.\u0275cmp=Ie({type:n,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[On],ngContentSelectors:V_,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"]],template:function(a,i){a&1&&(qs(),M(0,"div",0)(1,"div",1)(2,"label",2),Y(3),N(),M(4,"button",3),me("click",function(){return i.currentPeriodClicked()}),M(5,"span",4),Y(6),N(),Ka(),M(7,"svg",5),ee(8,"polygon",6),N()(),Ol(),ee(9,"div",7),Ys(10),M(11,"button",8),me("click",function(){return i.previousClicked()}),N(),M(12,"button",9),me("click",function(){return i.nextClicked()}),N()()()),a&2&&(X(2),ue("id",i._periodButtonLabelId),X(),vt(i.periodButtonDescription),X(),rn("aria-label",i.periodButtonLabel)("aria-describedby",i._periodButtonLabelId),X(2),vt(i.periodButtonText),X(),nr("mat-calendar-invert",i.calendar.currentView!=="month"),X(4),ue("disabled",!i.previousEnabled()),rn("aria-label",i.prevButtonLabel),X(),ue("disabled",!i.nextEnabled()),rn("aria-label",i.nextButtonLabel))},dependencies:[Qs,Js],encapsulation:2,changeDetection:0});let r=n;return r})(),bl=(()=>{let n=class n{get startAt(){return this._startAt}set startAt(t){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get selected(){return this._selected}set selected(t){t instanceof tn?this._selected=t:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get activeDate(){return this._clampedActiveDate}set activeDate(t){this._clampedActiveDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(t){let a=this._currentView!==t?t:null;this._currentView=t,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),a&&this.viewChanged.emit(a)}constructor(t,a,i,o){this._dateAdapter=a,this._dateFormats=i,this._changeDetectorRef=o,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new je,this.yearSelected=new je,this.monthSelected=new je,this.viewChanged=new je(!0),this._userSelection=new je,this._userDragDrop=new je,this._activeDrag=null,this.stateChanges=new Ya,this._intlChanges=t.changes.subscribe(()=>{o.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new Ad(this.headerComponent||Kv),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(t){let a=t.minDate&&!this._dateAdapter.sameDate(t.minDate.previousValue,t.minDate.currentValue)?t.minDate:void 0,i=t.maxDate&&!this._dateAdapter.sameDate(t.maxDate.previousValue,t.maxDate.currentValue)?t.maxDate:void 0,o=a||i||t.dateFilter;if(o&&!o.firstChange){let s=this._getCurrentViewComponent();s&&(this._changeDetectorRef.detectChanges(),s._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(t){let a=t.value;(this.selected instanceof tn||a&&!this._dateAdapter.sameDate(a,this.selected))&&this.selectedChange.emit(a),this._userSelection.emit(t)}_yearSelectedInMultiYearView(t){this.yearSelected.emit(t)}_monthSelectedInYearView(t){this.monthSelected.emit(t)}_goToDateInView(t,a){this.activeDate=t,this.currentView=a}_dragStarted(t){this._activeDrag=t}_dragEnded(t){this._activeDrag&&(t.value&&this._userDragDrop.emit(t),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};n.\u0275fac=function(a){return new(a||n)(oe($i),oe(En,8),oe(Ja,8),oe(tr))},n.\u0275cmp=Ie({type:n,selectors:[["mat-calendar"]],viewQuery:function(a,i){if(a&1&&(on(zv,5),on(Hv,5),on(Uv,5)),a&2){let o;qt(o=Yt())&&(i.monthView=o.first),qt(o=Yt())&&(i.yearView=o.first),qt(o=Yt())&&(i.multiYearView=o.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[Jl([J_]),$a,On],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(a,i){if(a&1&&(ze(0,W_,0,0,"ng-template",0),M(1,"div",1),ze(2,z_,1,11)(3,U_,1,6)(4,H_,1,6),N()),a&2){let o;ue("cdkPortalOutlet",i._calendarHeaderPortal),X(2),Qa(2,(o=i.currentView)==="month"?2:o==="year"?3:o==="multi-year"?4:-1)}},dependencies:[Zs,wd,zv,Hv,Uv],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let r=n;return r})(),Gv={transformPanel:tu("transformPanel",[ei("void => enter-dropdown",Za("120ms cubic-bezier(0, 0, 0.2, 1)",ru([lr({opacity:0,transform:"scale(1, 0.8)"}),lr({opacity:1,transform:"scale(1, 1)"})]))),ei("void => enter-dialog",Za("150ms cubic-bezier(0, 0, 0.2, 1)",ru([lr({opacity:0,transform:"scale(0.7)"}),lr({transform:"none",opacity:1})]))),ei("* => void",Za("100ms linear",lr({opacity:0})))]),fadeInCalendar:tu("fadeInCalendar",[nu("void",lr({opacity:0})),nu("enter",lr({opacity:1})),ei("void => *",Za("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};var tw=new Hs("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let r=Xa(eu);return()=>r.scrollStrategies.reposition()}});function nw(r){return()=>r.scrollStrategies.reposition()}var rw={provide:tw,deps:[eu],useFactory:nw},aw=(()=>{let n=class n{constructor(t,a,i,o,s,u){this._elementRef=t,this._changeDetectorRef=a,this._globalModel=i,this._dateAdapter=o,this._rangeSelectionStrategy=s,this._subscriptions=new ea,this._animationDone=new Ya,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=u.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(t){let a=this._model.selection,i=t.value,o=a instanceof tn;if(o&&this._rangeSelectionStrategy){let s=this._rangeSelectionStrategy.selectionFinished(i,a,t.event);this._model.updateSelection(s,this)}else i&&(o||!this._dateAdapter.sameDate(i,a))&&this._model.add(i);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(t){this._model.updateSelection(t.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(t){this._isAnimating=t.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(t,a){this._model=t?this._globalModel.clone():this._globalModel,this._actionsPortal=t,a&&this._changeDetectorRef.detectChanges()}};n.\u0275fac=function(a){return new(a||n)(oe(Us),oe(tr),oe(Ms),oe(En),oe(jv,8),oe($i))},n.\u0275cmp=Ie({type:n,selectors:[["mat-datepicker-content"]],viewQuery:function(a,i){if(a&1&&on(bl,5),a&2){let o;qt(o=Yt())&&(i._calendar=o.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(a,i){a&1&&Xl("@transformPanel.start",function(s){return i._handleAnimationEvent(s)})("@transformPanel.done",function(s){return i._handleAnimationEvent(s)}),a&2&&(Kl("@transformPanel",i._animationState),js(i.color?"mat-"+i.color:""),nr("mat-datepicker-content-touch",i.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[On],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(a,i){if(a&1&&(M(0,"div",0)(1,"mat-calendar",1),me("yearSelected",function(s){return i.datepicker._selectYear(s)})("monthSelected",function(s){return i.datepicker._selectMonth(s)})("viewChanged",function(s){return i.datepicker._viewChanged(s)})("_userSelection",function(s){return i._handleUserSelection(s)})("_userDragDrop",function(s){return i._handleUserDragDrop(s)}),N(),ze(2,G_,0,0,"ng-template",2),M(3,"button",3),me("focus",function(){return i._closeButtonFocused=!0})("blur",function(){return i._closeButtonFocused=!1})("click",function(){return i.datepicker.close()}),Y(4),N()()),a&2){let o;nr("mat-datepicker-content-container-with-custom-header",i.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",i._actionsPortal),rn("aria-modal",!0)("aria-labelledby",(o=i._dialogLabelId)!==null&&o!==void 0?o:void 0),X(),js(i.datepicker.panelClass),ue("id",i.datepicker.id)("startAt",i.datepicker.startAt)("startView",i.datepicker.startView)("minDate",i.datepicker._getMinDate())("maxDate",i.datepicker._getMaxDate())("dateFilter",i.datepicker._getDateFilter())("headerComponent",i.datepicker.calendarHeaderComponent)("selected",i._getSelected())("dateClass",i.datepicker.dateClass)("comparisonStart",i.comparisonStart)("comparisonEnd",i.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",i.startDateAccessibleName)("endDateAccessibleName",i.endDateAccessibleName),X(),ue("cdkPortalOutlet",i._actionsPortal),X(),nr("cdk-visually-hidden",!i._closeButtonFocused),ue("color",i.color||"primary"),X(),vt(i._closeButtonText)}},dependencies:[_d,bl,Zs,Qs],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[Gv.transformPanel,Gv.fadeInCalendar]},changeDetection:0});let r=n;return r})();var iw=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275dir=Pl({type:n,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let r=n;return r})(),ow=(()=>{let n=class n{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(t){this._disabled=t}constructor(t,a,i){this._intl=t,this._changeDetectorRef=a,this._stateChanges=ea.EMPTY;let o=Number(i);this.tabIndex=o||o===0?o:null}ngOnChanges(t){t.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(t){this.datepicker&&!this.disabled&&(this.datepicker.open(),t.stopPropagation())}_watchStateChanges(){let t=this.datepicker?this.datepicker.stateChanges:Qi(),a=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:Qi(),i=this.datepicker?zs(this.datepicker.openedStream,this.datepicker.closedStream):Qi();this._stateChanges.unsubscribe(),this._stateChanges=zs(this._intl.changes,t,a,i).subscribe(()=>this._changeDetectorRef.markForCheck())}};n.\u0275fac=function(a){return new(a||n)(oe($i),oe(tr),Hl("tabindex"))},n.\u0275cmp=Ie({type:n,selectors:[["mat-datepicker-toggle"]],contentQueries:function(a,i,o){if(a&1&&$l(o,iw,5),a&2){let s;qt(s=Yt())&&(i._customIcon=s.first)}},viewQuery:function(a,i){if(a&1&&on(j_,5),a&2){let o;qt(o=Yt())&&(i._button=o.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(a,i){a&1&&me("click",function(s){return i._open(s)}),a&2&&(rn("tabindex",null)("data-mat-calendar",i.datepicker?i.datepicker.id:null),nr("mat-datepicker-toggle-active",i.datepicker&&i.datepicker.opened)("mat-accent",i.datepicker&&i.datepicker.color==="accent")("mat-warn",i.datepicker&&i.datepicker.color==="warn"))},inputs:{datepicker:[Zi.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Zi.None,"aria-label","ariaLabel"],disabled:[Zi.HasDecoratorInputTransform,"disabled","disabled",rd],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[Yl,$a,On],ngContentSelectors:K_,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(a,i){a&1&&(qs(Y_),M(0,"button",0,1),ze(2,q_,2,0,":svg:svg",2),Ys(3),N()),a&2&&(ue("disabled",i.disabled)("disableRipple",i.disableRipple),rn("aria-haspopup",i.datepicker?"dialog":null)("aria-label",i.ariaLabel||i._intl.openCalendarLabel)("tabindex",i.disabled?-1:i.tabIndex),X(2),Qa(2,i._customIcon?-1:2))},dependencies:[Js],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let r=n;return r})();var Xv=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=Zn({type:n}),n.\u0275inj=er({providers:[$i,rw],imports:[so,kd,Rd,Cd,Id,Ed,aw,ow,Kv,Sd]});let r=n;return r})();var $v=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=Zn({type:n}),n.\u0275inj=er({imports:[so,Vd,lo,po]});let r=n;return r})();var Qv=(()=>{let n=class n{};n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=Zn({type:n,bootstrap:[Ov]}),n.\u0275inj=er({providers:[hd(),Bv(),{provide:ud,useClass:Lv,multi:!0},oo],imports:[pd,Pv,cd,po,lo,Fd,au,Ld,Td,Nd,Bd,Xv,Dd,au,Md,Pd,Od,$v]});let r=n;return r})();dd().bootstrapModule(Qv).catch(r=>console.error(r));
